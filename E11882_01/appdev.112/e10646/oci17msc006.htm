<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Transaction Functions</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1023" />
<meta name="dcterms.created" content="2014-07-18T15:18:34Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Call Interface Programmer's Guide" />
<meta name="dcterms.identifier" content="E10646-15" />
<meta name="dcterms.isVersionOf" content="LNOCI" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="oci17msc005.htm" title="Previous" type="text/html" />
<link rel="Next" href="oci17msc007.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10646.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">33/79</span> <!-- End Header --><a id="i540469"></a>
<div id="LNOCI166" class="refsect1">
<h1 class="refsect1">Transaction Functions<a id="sthref3282"></a></h1>
<p><a href="#CIHFIBHC">Table 17-6</a> lists the transaction functions that are described in this section.</p>
<div id="LNOCI17276" class="tblformalwide">
<p class="titleintable"><a id="sthref3283"></a><a id="CIHFIBHC"></a>Table 17-6 Transaction Functions</p>
<table class="cellalignment1011" title="Transaction Functions" summary="This table is described in the preceding text" dir="ltr">
<thead>
<tr class="cellalignment1005">
<th class="cellalignment1012" id="r1c1-t60">Function</th>
<th class="cellalignment1012" id="r1c2-t60">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1005">
<td class="cellalignment1013" id="r2c1-t60" headers="r1c1-t60">
<p><a href="#i428845">"OCITransCommit()"</a></p>
</td>
<td class="cellalignment1013" headers="r2c1-t60 r1c2-t60">
<p>Commit a transaction on a service context</p>
</td>
</tr>
<tr class="cellalignment1005">
<td class="cellalignment1013" id="r3c1-t60" headers="r1c1-t60">
<p><a href="#i428849">"OCITransDetach()"</a></p>
</td>
<td class="cellalignment1013" headers="r3c1-t60 r1c2-t60">
<p>Detach a transaction from a service context</p>
</td>
</tr>
<tr class="cellalignment1005">
<td class="cellalignment1013" id="r4c1-t60" headers="r1c1-t60">
<p><a href="#i440625">"OCITransForget()"</a></p>
</td>
<td class="cellalignment1013" headers="r4c1-t60 r1c2-t60">
<p>Forget a prepared global transaction</p>
</td>
</tr>
<tr class="cellalignment1005">
<td class="cellalignment1013" id="r5c1-t60" headers="r1c1-t60">
<p><a href="#i545246">"OCITransMultiPrepare()"</a></p>
</td>
<td class="cellalignment1013" headers="r5c1-t60 r1c2-t60">
<p>Prepare a transaction with multiple branches in a single cell</p>
</td>
</tr>
<tr class="cellalignment1005">
<td class="cellalignment1013" id="r6c1-t60" headers="r1c1-t60">
<p><a href="#i545171">"OCITransPrepare()"</a></p>
</td>
<td class="cellalignment1013" headers="r6c1-t60 r1c2-t60">
<p>Prepare a global transaction for commit</p>
</td>
</tr>
<tr class="cellalignment1005">
<td class="cellalignment1013" id="r7c1-t60" headers="r1c1-t60">
<p><a href="#i428853">"OCITransRollback()"</a></p>
</td>
<td class="cellalignment1013" headers="r7c1-t60 r1c2-t60">
<p>Roll back a transaction</p>
</td>
</tr>
<tr class="cellalignment1005">
<td class="cellalignment1013" id="r8c1-t60" headers="r1c1-t60">
<p><a href="#i458405">"OCITransStart()"</a></p>
</td>
<td class="cellalignment1013" headers="r8c1-t60 r1c2-t60">
<p>Start a transaction on a service context</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformalwide" -->
<div id="LNOCI13112" class="refsect2"><a id="i428845"></a>
<h2 class="refsect2">OCITransCommit()<a id="sthref3284"></a></h2>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3285"></a>Purpose</p>
<p>Commits the transaction associated with a specified service context.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3286"></a>Syntax</p>
<pre>
sword OCITransCommit ( OCISvcCtx    *svchp,
                       OCIError     *errhp,
                       ub4          flags );
</pre></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3287"></a>Parameters</p>
<dl>
<dt><span class="bold">svchp</span> (IN)</dt>
<dd>
<p>The service context handle.</p>
</dd>
<dt><span class="bold">errhp</span> (IN)</dt>
<dd>
<p>An error handle that you can pass to <a href="oci17msc007.htm#i540516">OCIErrorGet()</a> for diagnostic information when there is an error.</p>
</dd>
<dt><span class="bold">flags (IN)</span></dt>
<dd>
<p>A flag used for one-phase commit optimization in global transactions.</p>
<p><code>OCI_DEFAULT</code> - If the transaction is nondistributed, the flags parameter is ignored, and <code>OCI_DEFAULT</code> can be passed as its value.</p>
<p><code>OCI_TRANS_TWOPHASE</code> - OCI applications managing global transactions should pass this value to the flags parameter for a two-phase commit. The default is one-phase commit.</p>
<p><code>OCI_TRANS_WRITEIMMED</code> - I/O is initiated by LGWR (Log Writer Process in the background) to write the (in-memory) redo buffers to the online redo logs. <code>IMMEDIATE</code> means that the redo buffers of the transaction are written out immediately by sending a message to LGWR, which processes the message immediately.</p>
<p><code>OCI_TRANS_WRITEBATCH</code> - No I/O is issued by LGWR to write the in-memory redo buffers of the transaction to the online redo logs. <code>BATCH</code> means that the LGWR batches the redo buffers before initiating I/O for the entire batch. An error occurs when you specify both <code>BATCH</code> and <code>IMMEDIATE</code>. <code>IMMEDIATE</code> is the default.</p>
<p><code>OCI_TRANS_WRITEWAIT</code> - LGWR is requested to write the redo for the commit to the online redo logs, and the commit waits for the redo buffers to be written to the online redo logs. <code>WAIT</code> means that the commit does not return until the in-memory redo buffers corresponding to the transaction are written in the (persistent) online redo logs.</p>
<p><code>OCI_TRANS_WRITENOWAIT</code> - LGWR is requested to write the redo for the commit to the online redo logs, but the commit returns without waiting for the buffers to be written to the online redo logs. <code>NOWAIT</code> means that the commit returns to the user before the in-memory redo buffers are flushed to the online redo logs. An error occurs when you specify both <code>WAIT</code> and <code>NOWAIT</code>. <code>WAIT</code> is the default.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
There is a potential for silent transaction loss when you use <code>OCI_TRANS_WRITENOWAIT</code>. Transaction loss occurs silently with shutdown abort, startup force, and any instance or node failure. On an Oracle RAC system, asynchronously committed changes may not be immediately available to read on other instances.</div>
<p>These last four options only affect the commit of top-level nondistributed transactions and are ignored for externally coordinated distributed transactions. They can be combined using the <code>OR</code> operator, subject to the stated restrictions.</p>
</dd>
</dl>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3288"></a>Comments</p>
<p>The transaction currently associated with the service context is committed. If it is a global transaction that the server cannot commit, this call additionally retrieves the state of the transaction from the database to be returned to the user in the error handle.</p>
<p>If the application has defined multiple transactions, this function operates on the transaction currently associated with the service context. If the application is working with only the implicit local transaction created when database changes are made, that implicit transaction is committed.</p>
<p>If the application is running in the object mode, then the modified or updated objects in the object cache for this transaction are also flushed and committed.</p>
<p>Under normal circumstances, <code>OCITransCommit()</code> returns with a status indicating that the transaction has either been committed or rolled back. With global transactions, it is possible that the transaction is now in doubt, meaning that it is neither committed nor terminated. In this case, <code>OCITransCommit()</code> attempts to retrieve the status of the transaction from the server. The status is returned.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="i485281"></a>Example</p>
<p><a href="#CIHGBHCE">Example 17-3</a> demonstrates the use of a simple local transaction, as described in <a href="oci08sca.htm#i431599">"Simple Local Transactions"</a>.</p>
<div id="LNOCI18345" class="example">
<p class="titleinexample"><a id="CIHGBHCE"></a>Example 17-3 Using OCITransCommit() in a Simple Local Transaction</p>
<pre>
int main()
{
  OCIEnv *envhp;
  OCIServer *srvhp;
  OCIError *errhp;
  OCISvcCtx *svchp;
  OCIStmt *stmthp;
  void      *tmp;
  text sqlstmt[128];

  OCIEnvCreate(&amp;envhp, OCI_DEFAULT, (void  *)0, 0, 0, 0,
        (size_t)0, (void  *)0);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;errhp, (ub4) OCI_HTYPE_ERROR,
                (size_t)0, (void  **) 0);
  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;srvhp, (ub4) OCI_HTYPE_SERVER,
                (size_t)0, (void  **) 0);

  OCIServerAttach( srvhp, errhp, (text *) 0, (sb4) 0, (ub4) OCI_DEFAULT);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;svchp, (ub4) OCI_HTYPE_SVCCTX,
                (size_t)0, (void  **) 0);

  OCIHandleAlloc((void  *)envhp, (void  **)&amp;stmthp, OCI_HTYPE_STMT, 0, 0);

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)srvhp, 0,
                  OCI_ATTR_SERVER, errhp);

  OCILogon(envhp, errhp, &amp;svchp, (text *)"HR", strlen("HR"),
                 (text *)"HR", strlen("HR"), 0, 0);

  /* update hr.employees employee_id=7902, increment salary */
  sprintf((char *)sqlstmt, "UPDATE EMPLOYEES SET SALARY = SALARY + 1 \
                                            WHERE  EMPLOYEE_ID = 7902");

  OCIStmtPrepare(stmthp, errhp, sqlstmt, strlen((char *)sqlstmt),
                 OCI_NTV_SYNTAX, 0);
  OCIStmtExecute(svchp, stmthp, errhp, 1, 0, 0, 0, 0);
  OCITransCommit(svchp, errhp, (ub4) 0);

  /* update hr.employees employee_id=7902, increment salary again, but rollback */
  OCIStmtExecute(svchp, stmthp, errhp, 1, 0, 0, 0, 0);
  OCITransRollback(svchp, errhp, (ub4) 0);
}
</pre></div>
<!-- class="example" --></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3289"></a>Related Functions</p>
<p><a href="#i428853">OCITransRollback()</a></p>
</div>
<!-- class="refsubsect" --></div>
<!-- class="refsect2" -->
<div id="LNOCI17277" class="refsect2"><a id="i428849"></a>
<h2 class="refsect2">OCITransDetach()<a id="sthref3290"></a></h2>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3291"></a>Purpose</p>
<p>Detaches a global transaction.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3292"></a>Syntax</p>
<pre>
sword OCITransDetach ( OCISvcCtx    *svchp,
                       OCIError     *errhp,
                       ub4          flags );
</pre></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3293"></a>Parameters</p>
<dl>
<dt><span class="bold">svchp</span> (IN)</dt>
<dd>
<p>The service context handle.</p>
</dd>
<dt><span class="bold">errhp</span> (IN)</dt>
<dd>
<p>An error handle that you can pass to <a href="oci17msc007.htm#i540516">OCIErrorGet()</a> for diagnostic information when there is an error.</p>
</dd>
<dt><span class="bold">flags</span> (IN)</dt>
<dd>
<p>You must pass a value of <code>OCI_DEFAULT</code> for this parameter.</p>
</dd>
</dl>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3294"></a>Comments</p>
<p>Detaches a global transaction from the service context handle. The transaction currently attached to the service context handle becomes inactive at the end of this call. The transaction may be resumed later by calling <a href="#i458405">OCITransStart()</a>, specifying a flags value of <code>OCI_TRANS_RESUME</code>.</p>
<p>When a transaction is detached, the value that was specified in the <code>timeout</code> parameter of <a href="#i458405">OCITransStart()</a> when the transaction was started is used to determine the amount of time the branch can remain inactive before being deleted by the server's <code>PMON</code> process.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The transaction can be resumed by a different process than the one that detached it, if the transaction has the same authorization. If this function is called before a transaction is actually started, this function has no effect.</div>
<p>For example code demonstrating the use of <code>OCITransDetach()</code>, see the Examples section of <a href="#i458405">OCITransStart()</a>.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3295"></a>Related Functions</p>
<p><a href="#i458405">OCITransStart()</a></p>
</div>
<!-- class="refsubsect" --></div>
<!-- class="refsect2" -->
<div id="LNOCI17278" class="refsect2"><a id="i440625"></a>
<h2 class="refsect2">OCITransForget()<a id="sthref3296"></a></h2>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3297"></a>Purpose</p>
<p>Causes the server to forget a heuristically completed global transaction.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3298"></a>Syntax</p>
<pre>
sword OCITransForget ( OCISvcCtx     *svchp, 
                       OCIError      *errhp,
                       ub4           flags );
</pre></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3299"></a><span class="bold">Parameters</span></p>
<dl>
<dt><span class="bold">svchp</span> (IN)</dt>
<dd>
<p>The service context handle in which the transaction resides.</p>
</dd>
<dt><span class="bold">errhp</span> (IN)</dt>
<dd>
<p>An error handle that you can pass to <a href="oci17msc007.htm#i540516">OCIErrorGet()</a> for diagnostic information when there is an error.</p>
</dd>
<dt>flags (IN)</dt>
<dd>
<p>You must pass <code>OCI_DEFAULT</code> for this parameter.</p>
</dd>
</dl>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3300"></a>Comments</p>
<p>Forgets a heuristically completed global transaction. The server deletes the status of the transaction from the system's pending transaction table.</p>
<p>You set the XID of the transaction to be forgotten as an attribute of the transaction handle (<code>OCI_ATTR_XID</code>).</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3301"></a>Related Functions</p>
<p><a href="#i428845">OCITransCommit()</a>, <a href="#i428853">OCITransRollback()</a></p>
</div>
<!-- class="refsubsect" --></div>
<!-- class="refsect2" -->
<div id="LNOCI17279" class="refsect2"><a id="i545246"></a>
<h2 class="refsect2">OCITransMultiPrepare()<a id="sthref3302"></a></h2>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3303"></a>Purpose</p>
<p>Prepares a transaction with multiple branches in a single call.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3304"></a>Syntax</p>
<pre>
sword OCITransMultiPrepare ( OCISvcCtx   *svchp, 
                             ub4         numBranches, 
                             OCITrans    **txns, 
                             OCIError    **errhp);
</pre></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3305"></a><span class="bold">Parameters</span></p>
<dl>
<dt>srvchp (IN)</dt>
<dd>
<p>The service context handle.</p>
</dd>
<dt>numBranches (IN)</dt>
<dd>
<p>The number of branches expected. It is also the array size for the next two parameters.</p>
</dd>
<dt>txns (IN)</dt>
<dd>
<p>The array of transaction handles for the branches to prepare. They should all have the <code>OCI_ATTR_XID</code> set. The global transaction ID should be the same.</p>
</dd>
<dt>errhp (IN)</dt>
<dd>
<p>The array of error handles. If <code>OCI_SUCCESS</code> is not returned, then these indicate which branches received which errors.</p>
</dd>
</dl>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3306"></a>Comments</p>
<p>Prepares the specified global transaction for commit. This call is valid only for distributed transactions. This call is an advanced performance feature intended for use only in situations where the caller is responsible for preparing all the branches in a transaction.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3307"></a>Related Functions</p>
<p><a href="#i545171">OCITransPrepare()</a></p>
</div>
<!-- class="refsubsect" --></div>
<!-- class="refsect2" -->
<div id="LNOCI17280" class="refsect2"><a id="i545171"></a>
<h2 class="refsect2">OCITransPrepare()<a id="sthref3308"></a></h2>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3309"></a>Purpose</p>
<p>Prepares a global transaction for commit.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3310"></a>Syntax</p>
<pre>
sword OCITransPrepare ( OCISvcCtx    *svchp, 
                        OCIError     *errhp,
                        ub4          flags );
</pre></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3311"></a><span class="bold">Parameters</span></p>
<dl>
<dt><span class="bold">svchp</span> (IN)</dt>
<dd>
<p>The service context handle.</p>
</dd>
<dt><span class="bold">errhp</span> (IN)</dt>
<dd>
<p>An error handle that you can pass to <a href="oci17msc007.htm#i540516">OCIErrorGet()</a> for diagnostic information when there is an error.</p>
</dd>
<dt>flags (IN)</dt>
<dd>
<p>You must pass <code>OCI_DEFAULT</code> for this parameter.</p>
</dd>
</dl>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3312"></a>Comments</p>
<p>Prepares the specified global transaction for commit.</p>
<p>This call is valid only for global transactions.</p>
<p>The call returns <code>OCI_SUCCESS_WITH_INFO</code> if the transaction has not made any changes. The error handle indicates that the transaction is read-only. The <code>flags</code> parameter is not currently used.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3313"></a>Related Functions</p>
<p><a href="#i428845">OCITransCommit()</a>, <a href="#i440625">OCITransForget()</a></p>
</div>
<!-- class="refsubsect" --></div>
<!-- class="refsect2" -->
<div id="LNOCI17281" class="refsect2"><a id="i428853"></a>
<h2 class="refsect2">OCITransRollback()<a id="sthref3314"></a></h2>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3315"></a>Purpose</p>
<p>Rolls back the current transaction.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3316"></a>Syntax</p>
<pre>
sword OCITransRollback ( void         *svchp, 
                         OCIError     *errhp,
                         ub4          flags );
</pre></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3317"></a>Parameters</p>
<dl>
<dt><span class="bold">svchp</span> (IN)</dt>
<dd>
<p>A service context handle. The transaction currently set in the service context handle is rolled back.</p>
</dd>
<dt><span class="bold">errhp</span> (IN)</dt>
<dd>
<p>An error handle that you can pass to <a href="oci17msc007.htm#i540516">OCIErrorGet()</a> for diagnostic information when there is an error.</p>
</dd>
<dt><span class="bold">flags</span> (IN)</dt>
<dd>
<p>You must pass a value of <code>OCI_DEFAULT</code> for this parameter.</p>
</dd>
</dl>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3318"></a>Comments</p>
<p>The current transaction&mdash; defined as the set of statements executed since the last <a href="#i428845">OCITransCommit()</a> or since <a href="oci16rel001.htm#i556608">OCISessionBegin()</a>&mdash;is rolled back.</p>
<p>If the application is running under object mode, then the modified or updated objects in the object cache for this transaction are also rolled back.</p>
<p>Attempting to roll back a global transaction that is not currently active causes an error.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3319"></a>Examples</p>
<p>For example code demonstrating the use of <code>OCITransRollback()</code> see the Examples section of <a href="#i428845">OCITransCommit()</a>.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3320"></a>Related Functions</p>
<p><a href="#i428845">OCITransCommit()</a></p>
</div>
<!-- class="refsubsect" --></div>
<!-- class="refsect2" -->
<div id="LNOCI17282" class="refsect2"><a id="i458405"></a>
<h2 class="refsect2">OCITransStart()<a id="sthref3321"></a></h2>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3322"></a>Purpose</p>
<p>Sets the beginning of a transaction.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3323"></a>Syntax</p>
<pre>
sword OCITransStart ( OCISvcCtx    *svchp, 
                      OCIError     *errhp, 
                      uword        timeout,
                      ub4          flags );
</pre></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3324"></a>Parameters</p>
<dl>
<dt><span class="bold">svchp</span> (IN/OUT)</dt>
<dd>
<p>The service context handle. The transaction context in the service context handle is initialized at the end of the call if the flag specified a new transaction to be started.</p>
</dd>
<dt>errhp (IN/OUT)</dt>
<dd>
<p>The OCI error handle. If there is an error, it is recorded in <code>err</code> and this function returns <code>OCI_ERROR</code>. Diagnostic information can be obtained by calling <a href="oci17msc007.htm#i540516">OCIErrorGet()</a>.</p>
</dd>
<dt>timeout (IN)</dt>
<dd>
<p>The time, in seconds, to wait for a transaction to become available for resumption when <code>OCI_TRANS_RESUME</code> is specified. When <code>OCI_TRANS_NEW</code> is specified, the timeout parameter indicates the number of seconds the transaction can be inactive before it is automatically terminated by the system. A transaction is inactive between the time it is detached (with <a href="#i428849">OCITransDetach()</a>) and the time it is resumed with <code>OCITransStart()</code>.</p>
</dd>
<dt>flags (IN)</dt>
<dd>
<p>Specifies whether a new transaction is being started or an existing transaction is being resumed. Also specifies serializability or read-only status. More than a single value can be specified. By default, a read/write transaction is started. The flag values are:</p>
</dd>
</dl>
<ul>
<li>
<p><code>OCI_TRANS_NEW</code> - Starts a new transaction branch. By default starts a tightly coupled and migratable branch.</p>
</li>
<li>
<p><code>OCI_TRANS_TIGHT</code> - Explicitly specifies a tightly coupled branch.</p>
</li>
<li>
<p><code>OCI_TRANS_LOOSE</code> - Specifies a loosely coupled branch.</p>
</li>
<li>
<p><code>OCI_TRANS_RESUME</code> - Resumes an existing transaction branch.</p>
</li>
<li>
<p><code>OCI_TRANS_READONLY</code> - Starts a read-only transaction.</p>
</li>
<li>
<p><code>OCI_TRANS_SERIALIZABLE</code> - Starts a serializable transaction.</p>
</li>
<li>
<p><code>OCI_TRANS_SEPARABLE</code> - Separates the transaction after each call.</p>
<p>This flag results in a warning that the transaction was started using <span class="italic">regular</span> transactions. Separated transactions are not supported through release 9.0.1 of the server.</p>
</li>
</ul>
<p>An error message results if there is an error in your code or the transaction service. The error indicates that you attempted an action on a transaction that has already been prepared.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3325"></a>Comments</p>
<p>This function sets the beginning of a global or serializable transaction. The transaction context currently associated with the service context handle is initialized at the end of the call if the <code>flags</code> parameter specifies that a new transaction should be started.</p>
<p>The XID of the transaction is set as an attribute of the transaction handle (<code>OCI_ATTR_XID</code>)</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3326"></a>Examples</p>
<p><a href="#CIHJJCAG">Example 17-4</a> and <a href="#CIHEIHBA">Example 17-5</a> demonstrate the use of OCI transactional calls for manipulating global transactions. The concept for a single session operating on different branches, as shown in <a href="#CIHJJCAG">Example 17-4</a>, is illustrated by <a href="oci08sca.htm#i433197">Figure 8-2</a>.</p>
<div id="LNOCI18346" class="example">
<p class="titleinexample"><a id="CIHJJCAG"></a>Example 17-4 Using OCITransStart() in a Single Session Operating on Different Branches</p>
<pre>
int main()
{
  OCIEnv *envhp;
  OCIServer *srvhp;
  OCIError *errhp;
  OCISvcCtx *svchp;
  OCISession *usrhp;
  OCIStmt *stmthp1, *stmthp2;
  OCITrans *txnhp1, *txnhp2;
  void      *tmp;
  XID gxid;
  text sqlstmt[128];

  OCIEnvCreate(&amp;envhp, OCI_DEFAULT, (void  *)0, 0, 0, 0,
        (size_t)0, (void  *)0);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;errhp, (ub4)
                OCI_HTYPE_ERROR, 52, (void  **) &amp;tmp);
  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;srvhp, (ub4)
               OCI_HTYPE_SERVER, 52, (void  **) &amp;tmp);

  OCIServerAttach( srvhp, errhp, (text *) 0, (sb4) 0, (ub4) OCI_DEFAULT);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;svchp, (ub4) OCI_HTYPE_SVCCTX,
                52, (void  **) &amp;tmp);

  OCIHandleAlloc((void  *)envhp, (void  **)&amp;stmthp1, OCI_HTYPE_STMT, 0, 0);
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;stmthp2, OCI_HTYPE_STMT, 0, 0);

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)srvhp, 0,
                  OCI_ATTR_SERVER, errhp);

  /* set the external name and internal name in server handle */
  OCIAttrSet((void  *)srvhp, OCI_HTYPE_SERVER, (void  *) "demo", 0,
                  OCI_ATTR_EXTERNAL_NAME, errhp);
  OCIAttrSet((void  *)srvhp, OCI_HTYPE_SERVER, (void  *) "txn demo", 0,
                          OCI_ATTR_INTERNAL_NAME, errhp);

  /* allocate a user context handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;usrhp, (ub4) OCI_HTYPE_SESSION,
                (size_t) 0, (void  **) 0);

  OCIAttrSet((void  *)usrhp, (ub4)OCI_HTYPE_SESSION, (void  *)"HR",
             (ub4)strlen("HR"), OCI_ATTR_USERNAME, errhp);
  OCIAttrSet((void  *)usrhp, (ub4)OCI_HTYPE_SESSION, (void  *)"HR",
             (ub4)strlen("HR"),OCI_ATTR_PASSWORD, errhp);

  OCISessionBegin (svchp, errhp, usrhp, OCI_CRED_RDBMS, 0);

  OCIAttrSet((void  *)svchp, (ub4)OCI_HTYPE_SVCCTX,
                (void  *)usrhp, (ub4)0, OCI_ATTR_SESSION, errhp);

  /* allocate transaction handle 1 and set it in the service handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;txnhp1,  OCI_HTYPE_TRANS, 0, 0);
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp1, 0,
                          OCI_ATTR_TRANS, errhp);

  /* start a transaction with global transaction id = [1000, 123, 1] */
  gxid.formatID = 1000; /* format id = 1000 */
  gxid.gtrid_length = 3; /* gtrid = 123 */
  gxid.data[0] = 1; gxid.data[1] = 2; gxid.data[2] = 3;
  gxid.bqual_length = 1; /* bqual = 1 */
  gxid.data[3] = 1;

  OCIAttrSet((void  *)txnhp1, OCI_HTYPE_TRANS, (void  *)&amp;gxid, sizeof(XID),
                          OCI_ATTR_XID, errhp);

  /* start global transaction 1 with 60-second time to live when detached */
  OCITransStart(svchp, errhp, 60, OCI_TRANS_NEW);

  /* update hr.employees employee_id=7902, increment salary */
  sprintf((char *)sqlstmt, "UPDATE EMPLOYEES SET SALARY = SALARY + 1 \
                                           WHERE EMPLOYEE_ID = 7902");
  OCIStmtPrepare(stmthp1, errhp, sqlstmt, strlen((char *)sqlstmt),
                 OCI_NTV_SYNTAX, 0);
  OCIStmtExecute(svchp, stmthp1, errhp, 1, 0, 0, 0, 0);

  /* detach the transaction */
  OCITransDetach(svchp, errhp, 0);

  /* allocate transaction handle 2 and set it in the service handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;txnhp2,  OCI_HTYPE_TRANS, 0, 0);

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp2, 0,
                          OCI_ATTR_TRANS, errhp);

  /* start a transaction with global transaction id = [1000, 124, 1] */
  gxid.formatID = 1000; /* format id = 1000 */
  gxid.gtrid_length = 3; /* gtrid = 124 */
  gxid.data[0] = 1; gxid.data[1] = 2; gxid.data[2] = 4;
  gxid.bqual_length = 1; /* bqual = 1 */
  gxid.data[3] = 1;

  OCIAttrSet((void  *)txnhp2, OCI_HTYPE_TRANS, (void  *)&amp;gxid, sizeof(XID),
                          OCI_ATTR_XID, errhp);

  /* start global transaction 2 with 90 second time to live when detached */
  OCITransStart(svchp, errhp, 90, OCI_TRANS_NEW);

  /* update hr.employees employee_id=7934, increment salary */
  sprintf((char *)sqlstmt, "UPDATE EMPLOYEES SET SALARY = SALARY + 1 \
                                            WHERE EMPLOYEE_ID = 7934");
  OCIStmtPrepare(stmthp2, errhp, sqlstmt, strlen((char *)sqlstmt),
                 OCI_NTV_SYNTAX, 0);
  OCIStmtExecute(svchp, stmthp2, errhp, 1, 0, 0, 0, 0);

  /* detach the transaction */
  OCITransDetach(svchp, errhp, 0);

  /* Resume transaction 1, increment salary and commit it */
  /* Set transaction handle 1 into the service handle */
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp1, 0,
                          OCI_ATTR_TRANS, errhp);

  /* attach to transaction 1, wait for 10 seconds if the transaction is busy */
  /* The wait is clearly not required in this example because no other */
  /* process/thread is using the transaction. It is only for illustration */
  OCITransStart(svchp, errhp, 10, OCI_TRANS_RESUME);
  OCIStmtExecute(svchp, stmthp1, errhp, 1, 0, 0, 0, 0);
  OCITransCommit(svchp, errhp, (ub4) 0);

  /* attach to transaction 2 and commit it */
  /* set transaction handle2 into the service handle */
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp2, 0,
                          OCI_ATTR_TRANS, errhp);
  OCITransCommit(svchp, errhp, (ub4) 0);
}
</pre></div>
<!-- class="example" -->
<div id="LNOCI18347" class="example">
<p class="titleinexample"><a id="CIHEIHBA"></a>Example 17-5 Using OCITransStart() in a Single Session Operating on Multiple Branches Sharing the Same Transaction</p>
<pre>
int main()
{
  OCIEnv *envhp;
  OCIServer *srvhp;
  OCIError *errhp;
  OCISvcCtx *svchp;
  OCISession *usrhp;
  OCIStmt *stmthp;
  OCITrans *txnhp1, *txnhp2;
  void      *tmp;
  XID gxid;
  text sqlstmt[128];

  OCIEnvCreate(&amp;envhp, OCI_DEFAULT, (void  *)0, 0, 0, 0,
        (size_t)0, (void  *)0);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;errhp, (ub4) OCI_HTYPE_ERROR,
                52, (void  **) &amp;tmp);
  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;srvhp, (ub4) OCI_HTYPE_SERVER,
                52, (void  **) &amp;tmp);

  OCIServerAttach( srvhp, errhp, (text *) 0, (sb4) 0, (ub4) OCI_DEFAULT);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;svchp, (ub4) OCI_HTYPE_SVCCTX,
                52, (void  **) &amp;tmp);

  OCIHandleAlloc((void  *)envhp, (void  **)&amp;stmthp, OCI_HTYPE_STMT, 0, 0);

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)srvhp, 0,
                  OCI_ATTR_SERVER, errhp);

  /* set the external name and internal name in server handle */
  OCIAttrSet((void  *)srvhp, OCI_HTYPE_SERVER, (void  *) "demo", 0,
                  OCI_ATTR_EXTERNAL_NAME, errhp);
  OCIAttrSet((void  *)srvhp, OCI_HTYPE_SERVER, (void  *) "txn demo2", 0,
                  OCI_ATTR_INTERNAL_NAME, errhp);

  /* allocate a user context handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;usrhp, (ub4) OCI_HTYPE_SESSION,
                (size_t) 0, (void  **) 0);

  OCIAttrSet((void  *)usrhp, (ub4)OCI_HTYPE_SESSION, (void  *)"HR",
             (ub4)strlen("HR"), OCI_ATTR_USERNAME, errhp);
  OCIAttrSet((void  *)usrhp, (ub4)OCI_HTYPE_SESSION, (void  *)"HR",
             (ub4)strlen("HR"),OCI_ATTR_PASSWORD, errhp);

  OCISessionBegin (svchp, errhp, usrhp, OCI_CRED_RDBMS, 0);

  OCIAttrSet((void  *)svchp, (ub4)OCI_HTYPE_SVCCTX,
                (void  *)usrhp, (ub4)0, OCI_ATTR_SESSION, errhp);

  /* allocate transaction handle 1 and set it in the service handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;txnhp1,  OCI_HTYPE_TRANS, 0, 0);
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp1, 0,
                          OCI_ATTR_TRANS, errhp);

  /* start a transaction with global transaction id = [1000, 123, 1] */
  gxid.formatID = 1000; /* format id = 1000 */
  gxid.gtrid_length = 3; /* gtrid = 123 */
  gxid.data[0] = 1; gxid.data[1] = 2; gxid.data[2] = 3;
  gxid.bqual_length = 1; /* bqual = 1 */
  gxid.data[3] = 1;

  OCIAttrSet((void  *)txnhp1, OCI_HTYPE_TRANS, (void  *)&amp;gxid, sizeof(XID),
                          OCI_ATTR_XID, errhp);

  /* start global transaction 1 with 60-second time to live when detached */
  OCITransStart(svchp, errhp, 60, OCI_TRANS_NEW);

  /* update hr.employees employee_id=7902, increment salary */
  sprintf((char *)sqlstmt, "UPDATE EMPLOYEES SET SALARY = SALARY + 1 \
                                            WHERE EMPLOYEE_ID = 7902");
  OCIStmtPrepare(stmthp, errhp, sqlstmt, strlen((char *)sqlstmt),
                 OCI_NTV_SYNTAX, 0);
  OCIStmtExecute(svchp, stmthp, errhp, 1, 0, 0, 0, 0);

  /* detach the transaction */
  OCITransDetach(svchp, errhp, 0);

  /* allocate transaction handle 2 and set it in the service handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;txnhp2,  OCI_HTYPE_TRANS, 0, 0);
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp2, 0,
                          OCI_ATTR_TRANS, errhp);

  /* start a transaction with global transaction id = [1000, 123, 2] */
  /* The global transaction is tightly coupled with earlier transactions */
  /* There is not much practical value in doing this but the example */
  /* illustrates the use of tightly coupled transaction branches. */
  /* In a practical case, the second transaction that tightly couples with */
  /* the first can be executed from a different process/thread. */

  gxid.formatID = 1000; /* format id = 1000 */
  gxid.gtrid_length = 3; /* gtrid = 123 */
  gxid.data[0] = 1; gxid.data[1] = 2; gxid.data[2] = 3;
  gxid.bqual_length = 1; /* bqual = 2 */
  gxid.data[3] = 2;

  OCIAttrSet((void  *)txnhp2, OCI_HTYPE_TRANS, (void  *)&amp;gxid,
sizeof(XID), OCI_ATTR_XID, errhp);

  /* start global transaction 2 with 90-second time to live when detached */
  OCITransStart(svchp, errhp, 90, OCI_TRANS_NEW);

  /* update hr.employees employee_id=7902, increment salary */
  /* This is possible even if the earlier transaction has locked this row */
  /* because the two global transactions are tightly coupled */
  OCIStmtExecute(svchp, stmthp, errhp, 1, 0, 0, 0, 0);

  /* detach the transaction */
  OCITransDetach(svchp, errhp, 0);

  /* Resume transaction 1 and prepare it. This returns */
  /* OCI_SUCCESS_WITH_INFO because all branches except the last branch */
  /* are treated as read-only transactions for tightly coupled transactions */

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp1, 0,
                          OCI_ATTR_TRANS, errhp);
  if (OCITransPrepare(svchp, errhp, (ub4) 0) == OCI_SUCCESS_WITH_INFO)
  {
    text errbuf[512];
    ub4 buflen;
    sb4 errcode;

    OCIErrorGet ((void  *) errhp, (ub4) 1, (text *) NULL, &amp;errcode,
    errbuf, (ub4) sizeof(errbuf), (ub4) OCI_HTYPE_ERROR);
    printf("OCITransPrepare - %s\n", errbuf);
  }

  /* attach to transaction 2 and commit it */
  /* set transaction handle2 into the service handle */
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp2, 0,
                          OCI_ATTR_TRANS, errhp);
  OCITransCommit(svchp, errhp, (ub4) 0);
}
</pre></div>
<!-- class="example" --></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3327"></a>Related Functions</p>
<p><a href="#i428849">OCITransDetach()</a></p>
</div>
<!-- class="refsubsect" --></div>
<!-- class="refsect2" --></div>
<!-- class="refsect1" --></div>
<!-- class="refentry" -->
<div class="refentry"></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1004">
<tr>
<td class="cellalignment1013">
<table class="cellalignment1009">
<tr>
<td class="cellalignment1008"><a href="oci17msc005.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1008"><a href="oci17msc007.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1015">
<table class="cellalignment1007">
<tr>
<td class="cellalignment1008"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1008"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1008"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1008"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1008"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1008"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
