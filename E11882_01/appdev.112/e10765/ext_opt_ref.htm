<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Extensible Optimizer Interface</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1" />
<meta name="dcterms.created" content="2010-03-08T13:16:29Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Data Cartridge Developer's Guide" />
<meta name="dcterms.identifier" content="E10765-02" />
<meta name="dcterms.isVersionOf" content="ADDCI" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2010,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="ext_idx_ref.htm" title="Previous" type="text/html" />
<link rel="Next" href="ext_agg_ref.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10765.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">32/36</span> <!-- End Header --><a id="CHEBFJDA"></a><a id="ADDCI4210"></a>
<h1 class="chapter"><span class="secnum">21</span> Extensible Optimizer Interface</h1>
<p>This chapter describes the functions and procedures that comprise the interface to the extensible optimizer.</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#i77435">Extensible Optimizer Interface</a></p>
</li>
<li>
<p><a href="#CHDIBEIG">User-Defined ODCIStats Functions</a></p>
</li>
</ul>
<a id="i77435"></a><a id="ADDCI5082"></a>
<div class="sect1">
<h2 class="sect1">Extensible Optimizer Interface</h2>
<p>This section discusses the components of the Extensible Optimizer interface.</p>
<p>The extensible optimizer interfaces support working with partitioned tables and domain indexes. This is accomplished in two ways:</p>
<ul>
<li>
<p>Additional attributes have been added to some system-defined object types that are parameters to the <code>ODCIStats</code> interface methods. For example, the <code>ODCIColInfo</code> type is enhanced to add information about the column's partition.</p>
</li>
<li>
<p>Arguments or semantics of the arguments have changed for some <code>ODCIStats</code> methods.</p>
</li>
</ul>
<p>Note that you must update your code for <code>ODCIStats2</code> version of the <code>ODCIStats</code> interfaces to use your statistics type with an indextype that implements the <code>ODCIIndex2</code> version of the extensible indexing interfaces.</p>
<div class="example">
<p class="titleinexample"><a id="ADDCI5083"></a><a id="sthref765"></a>Example 21-1 Using Statistics Functions in an Extensible Optimizer Interface</p>
<p>Consider an example of how the statistics functions might be used. Suppose, in the schema <code>HR</code>, we define the following:</p>
<pre>
CREATE OPERATOR Contains binding (VARCHAR2(4000), VARCHAR2(30))
   RETURN NUMBER USING Contains_fn;

CREATE TYPE stat1 (
   ...,
   STATIC FUNCTION ODCIStatsSelectivity(pred ODCIPredInfo, sel OUT NUMBER,
      args ODCIArgDescList, start NUMBER, stop NUMBER, doc VARCHAR2(4000),
      key VARCHAR2(30)) return NUMBER,
   STACTIC FUNCTION ODCIStatsFunctionCost(func ODCIFuncInfo, cost OUT
      ODCICost, args ODCIArgDescList, doc VARCHAR2(4000), key VARCHAR2(30))
      return NUMBER,
   STATIC FUNCTION ODCIStatsIndexCost(ia ODCIIndexInfo, sel NUMBER,
      cost OUT ODCICost, qi ODCIQueryInfo, pred ODCIPredInfo,
      args ODCIArgDescList, start NUMBER, stop NUMBER,
      key VARCHAR2(30)) return NUMBER,
   ...
);

CREATE TABLE T (resume VARCHAR2(4000));

CREATE INDEX T_resume on T(resume) INDEXTYPE IS indtype;

ASSOCIATE STATISTICS WITH FUNCTIONS Contains_fn USING stat1;

ASSOCIATE STATISTICS WITH INDEXTYPE indtype USING stat1 
   WITH SYSTEM MANAGED STORAGE TABLES;
</pre>
<p>When the optimizer encounters the query</p>
<pre>
SELECT * FROM T WHERE Contains(resume, 'ORACLE') = 1,
</pre>
<p>it computes the selectivity of the predicate by invoking the user-defined selectivity function for the functional implementation of the <code>Contains</code> operator. In this case, the selectivity function is <code>stat1.ODCIStatsSelectivity</code>. It is called as follows:</p>
<pre>
stat1.ODCIStatsSelectivity (
   ODCIPredInfo('HR', 'Contains_fn', NULL, 29),
   sel,
   ODCIArgDescList(
      ODCIArgDesc(ODCIConst.ArgLit,
                  NULL, NULL, NULL, NULL, NULL, NULL),
      ODCIArgDesc(ODCIConst.ArgLit,
                  NULL, NULL, NULL, NULL, NULL, NULL),
      ODCIArgDesc(ODCIConst.ArgCol, 'T', 'HR', '"RESUME"', NULL, NULL, NULL),
      ODCIArgDesc(ODCIConst.ArgLit,
                  NULL, NULL, NULL, NULL, NULL, NULL)),
      1,
      1,
      NULL,
      'ORACLE')
</pre>
<p>Suppose the selectivity function returns a selectivity of 3 (percent). When the domain index is being evaluated, then the optimizer calls the user-defined index cost function as follows:</p>
<pre>
stat1.ODCIStatsIndexCost (   ODCIIndexInfo('HR', 'T_RESUME',      ODCIColInfoList(ODCIColInfo('HR', 'T', '"RESUME"', NULL, NULL, NULL, 0, 0, 0, 0)), NULL, 0, 0, 0, 0),      3,      cost,      NULL,      ODCIPredInfo('HR', 'Contains', NULL, 13),      ODCIArgDescList( ODCIArgDesc(ODCIConst.ArgLit,                                   NULL, NULL, NULL, NULL, NULL, NULL),                       ODCIArgDesc(ODCIConst.ArgLit,                                   NULL, NULL, NULL, NULL, NULL, NULL),                       ODCIArgDesc(ODCIConst.ArgLit,                                   NULL, NULL, NULL, NULL, NULL, NULL)),      1,      1,      'ORACLE')
</pre>
<p>Suppose that the optimizer decides not to use the domain index because it is too expensive. Then it calls the user-defined cost function for the functional implementation of the operator as follows:</p>
<pre>
stat1.ODCIStatsFunctionCost (
   ODCIFuncInfo('HR', 'Contains_fn', NULL, 1),
   cost,
   ODCIArgDescList(  ODCIArgDesc(ODCIConst.ArgCol, 
                       'T', 'HR', '"RESUME"', NULL, NULL, NULL),
                     ODCIArgDesc(ODCIConst.ArgLit, 
                        NULL, NULL, NULL, NULL, NULL, NULL)),
   NULL,
   'ORACLE')
</pre>
<p>The following sections describe each statistics type function in greater detail.</p>
</div>
<!-- class="example" -->
<a id="ADDCI5084"></a>
<div class="sect2"><a id="sthref766"></a>
<h3 class="sect2">EXPLAIN PLAN</h3>
<p><code>EXPLAIN</code> <code>PLAN</code> shows the user-defined CPU and I/O costs for domain indexes in the <code>CPU_COST</code> and <code>IO_COST</code> columns of <code>PLAN_TABLE</code>. For example, suppose we have a table <code>Emp_tab</code> and a user-defined operator <code>Contains</code>. Further, suppose that there is a domain index <code>EmpResume_indx</code> on the <code>Resume_col</code> column of <code>Emp_tab</code>, and that the indextype of <code>EmpResume_indx</code> supports the operator <code>Contains</code>. Then, the query</p>
<pre>
SELECT * FROM Emp_tab WHERE Contains(Resume_col, 'Oracle') = 1
</pre>
<p>might have the following plan:</p>
<div class="inftblinformal">
<table class="cellalignment1250" title="Sample EXPLAIN PLAN" summary="EXPLAIN PLAN example" dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t2"><span class="bold">OPERATION</span></th>
<th class="cellalignment1247" id="r1c2-t2">OPTIONS</th>
<th class="cellalignment1247" id="r1c3-t2">OBJECT_NAME</th>
<th class="cellalignment1247" id="r1c4-t2">CPU_COST</th>
<th class="cellalignment1247" id="r1c5-t2">IO_COST</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t2" headers="r1c1-t2">
<pre>
SELECT STATEMENT
</pre></td>
<td class="cellalignment1243" headers="r2c1-t2 r1c2-t2">
<pre>
</pre></td>
<td class="cellalignment1243" headers="r2c1-t2 r1c3-t2">
<pre>
</pre></td>
<td class="cellalignment1243" headers="r2c1-t2 r1c4-t2">
<pre>
</pre></td>
<td class="cellalignment1243" headers="r2c1-t2 r1c5-t2">
<pre>
</pre></td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t2" headers="r1c1-t2">
<pre>
TABLE ACCESS
</pre></td>
<td class="cellalignment1243" headers="r3c1-t2 r1c2-t2">
<pre>
BY ROWID
</pre></td>
<td class="cellalignment1243" headers="r3c1-t2 r1c3-t2">
<pre>
EMP_TAB
</pre></td>
<td class="cellalignment1243" headers="r3c1-t2 r1c4-t2">
<pre>
</pre></td>
<td class="cellalignment1243" headers="r3c1-t2 r1c5-t2">
<pre>
</pre></td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r4c1-t2" headers="r1c1-t2">
<pre>
DOMAIN INDEX
</pre></td>
<td class="cellalignment1243" headers="r4c1-t2 r1c2-t2">
<pre>
</pre></td>
<td class="cellalignment1243" headers="r4c1-t2 r1c3-t2">
<pre>
EMPRESUME_INDX
</pre></td>
<td class="cellalignment1243" headers="r4c1-t2 r1c4-t2">
<pre>
300
</pre></td>
<td class="cellalignment1243" headers="r4c1-t2 r1c5-t2">
<pre>
4
</pre></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" --></div>
<!-- class="sect2" -->
<a id="ADDCI5085"></a>
<div class="sect2"><a id="sthref767"></a>
<h3 class="sect2">INDEX Hint</h3>
<p>The index hint applies to domain indexes. In other words, the index hint forces the optimizer to use the hinted index for a user-defined operator, if possible.</p>
</div>
<!-- class="sect2" -->
<a id="i76579"></a><a id="ADDCI5086"></a>
<div class="sect2">
<h3 class="sect2">ORDERED_PREDICATES Hint</h3>
<p>The hint <code>ORDERED_PREDICATES</code> forces the optimizer to preserve the order of predicate evaluation (except predicates used for index keys) as specified in the <code>WHERE</code> clause of a SQL DML statement.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDIBEIG"></a><a id="ADDCI5087"></a>
<div class="sect1">
<h2 class="sect1">User-Defined ODCIStats Functions</h2>
<p>User-defined <code>ODCIStats</code> functions are used for table columns, functions, package, type, indextype or domain indexes. These functions are described in the following sections.</p>
<div class="tblformal">
<p class="titleintable"><a id="ADDCI5088"></a><a id="sthref768"></a><a id="sthref769"></a>Table 21-1 Summary of User-Defined ODCIStats Functions</p>
<table class="cellalignment1246" title="Summary of User-Defined ODCIStats Functions" summary="Column 1 gives the function name, Column two provides its description" dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t3">Function</th>
<th class="cellalignment1247" id="r1c2-t3">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t3" headers="r1c1-t3">
<p><a href="#CHEDBEFB">ODCIGetInterfaces()</a></p>
</td>
<td class="cellalignment1243" headers="r2c1-t3 r1c2-t3">
<p>Discover which version of the <code>ODCIStats</code> interface the user has implemented.</p>
</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t3" headers="r1c1-t3">
<p><a href="#i77265">ODCIStatsCollect()</a></p>
</td>
<td class="cellalignment1243" headers="r3c1-t3 r1c2-t3">
<p>Called by the <code>DBMS_STATS</code> package to collect user-defined statistics on a table, a partition of a table, an index, or a partition of an index.</p>
</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r4c1-t3" headers="r1c1-t3">
<p><a href="#CHEDFDDJ">ODCIStatsDelete()</a></p>
</td>
<td class="cellalignment1243" headers="r4c1-t3 r1c2-t3">
<p>Deletes user-defined statistics on a table, a partition of a table, an index, or a partition of an index.</p>
</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r5c1-t3" headers="r1c1-t3">
<p><a href="#CHEBBEGF">ODCIStatsFunctionCost()</a></p>
</td>
<td class="cellalignment1243" headers="r5c1-t3 r1c2-t3">
<p>Computes the cost of a function.</p>
</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r6c1-t3" headers="r1c1-t3">
<p><a href="#CHEDHDAJ">ODCIStatsExchangePartition()</a></p>
</td>
<td class="cellalignment1243" headers="r6c1-t3 r1c2-t3">
<p>Exchanges domain index statistics when an <code>ALTER TABLE EXCHANGE PARTITION ... INCLULDING INDEXES</code> command is issued.</p>
</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r7c1-t3" headers="r1c1-t3">
<p><a href="#CHEHFCIG">ODCIStatsIndexCost()</a></p>
</td>
<td class="cellalignment1243" headers="r7c1-t3 r1c2-t3">
<p>Calculates the cost of a domain index scan.</p>
</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r8c1-t3" headers="r1c1-t3">
<p><a href="#CHEDEDGJ">ODCIStatsSelectivity()</a></p>
</td>
<td class="cellalignment1243" headers="r8c1-t3 r1c2-t3">
<p>Specifies the selectivity of a predicate.</p>
</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r9c1-t3" headers="r1c1-t3">
<p><a href="#CHEDHGGI">ODCIStatsTableFunction()</a></p>
</td>
<td class="cellalignment1243" headers="r9c1-t3 r1c2-t3">
<p>Provides cardinality statistics for table functions and input cursor expressions.</p>
</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r10c1-t3" headers="r1c1-t3">
<p><a href="#CHEGAICB">ODCIStatsUpdPartStatistics()</a></p>
</td>
<td class="cellalignment1243" headers="r10c1-t3 r1c2-t3">
<p>Updates statistics during partition maintenance operations. Patches the domain index statistics.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<a id="CHEDBEFB"></a><a id="ADDCI5089"></a>
<div class="sect2">
<h3 class="sect2">ODCIGetInterfaces()</h3>
<p><code>ODCIGetInterfaces</code> is invoked by the server to discover which version of the <code>ODCIStats</code> interface the user has implemented in the methods of the user-defined statistics type.</p>
<p class="subhead2"><a id="ADDCI5090"></a>Syntax</p>
<pre>
FUNCTION ODCIGetInterfaces(
   ifclist OUT ODCIObjectList)
RETURN NUMBER;
</pre>
<div class="inftblinformal">
<table class="cellalignment1250" title="Parameters of ODCIGetInterfaces" summary="First column lists a parameter; second column indicates the IN or OUT binding of the parameter, the third column describes the parameter." dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t4">Parameter</th>
<th class="cellalignment1247" id="r1c2-t4">IN/OUT</th>
<th class="cellalignment1247" id="r1c3-t4">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t4" headers="r1c1-t4">
<pre>
ifclist
</pre></td>
<td class="cellalignment1243" headers="r2c1-t4 r1c2-t4">
<pre>
OUT
</pre></td>
<td class="cellalignment1243" headers="r2c1-t4 r1c3-t4">The version of the <code>ODCIStats</code> interfaces implemented by the statistics type. This value should be <code>SYS.ODCISTATS2</code>.</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p class="subhead2"><a id="ADDCI5091"></a>Returns</p>
<p><code>ODCIConst.Success</code> on success, <code>ODCIConst.Error</code> otherwise.</p>
</div>
<!-- class="sect2" -->
<a id="i77265"></a><a id="ADDCI5093"></a>
<div class="sect2">
<h3 class="sect2">ODCIStatsCollect()</h3>
<p>Called by the <code>DBMS_STATS</code> package to collect user-defined statistics.</p>
<div class="inftblinformal">
<table class="cellalignment1250" title="Versions of method ODCIStatsCollect()" summary="Column 1 has lists the version of a function and column 2 gives its description." dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t5">Syntax</th>
<th class="cellalignment1247" id="r1c2-t5">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t5" headers="r1c1-t5">
<pre>
FUNCTION ODCIStatsCollect(
   col ODCIColInfo, 
   options ODCIStatsOptions, 
   statistics OUT RAW,
   env ODCIEnv) 
return NUMBER;
</pre></td>
<td class="cellalignment1243" headers="r2c1-t5 r1c2-t5">Called by the <code>DBMS_STATS</code> package to collect user-defined statistics on a table or a partition of a table.</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t5" headers="r1c1-t5">
<pre>
FUNCTION ODCIStatsCollect(
   ia ODCIIndexInfo, 
   options ODCIStatsOptions, 
   statistics OUT RAW,
   env ODCIEnv)
 return NUMBER;
</pre></td>
<td class="cellalignment1243" headers="r3c1-t5 r1c2-t5">Called to collect user-defined statistics on an index or a partition of an index.</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<div class="inftblinformal">
<table class="cellalignment1250" title="Parameters of ODCIStatsCollect" summary="First column lists a parameter; second column indicates the IN or OUT binding of the parameter, the third column describes the parameter." dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t6">Parameter</th>
<th class="cellalignment1247" id="r1c2-t6">IN/OUT</th>
<th class="cellalignment1247" id="r1c3-t6">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t6" headers="r1c1-t6"><code>col</code></td>
<td class="cellalignment1243" headers="r2c1-t6 r1c2-t6">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r2c1-t6 r1c3-t6">Column for which statistics are being collected</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t6" headers="r1c1-t6"><code>options</code></td>
<td class="cellalignment1243" headers="r3c1-t6 r1c2-t6">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r3c1-t6 r1c3-t6">Options passed to <code>DBMS_STATS</code></td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r4c1-t6" headers="r1c1-t6"><code>statistics</code></td>
<td class="cellalignment1243" headers="r4c1-t6 r1c2-t6">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r4c1-t6 r1c3-t6">User-defined statistics collected</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r5c1-t6" headers="r1c1-t6">env</td>
<td class="cellalignment1243" headers="r5c1-t6 r1c2-t6">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r5c1-t6 r1c3-t6">Contains general information about the environment in which the routine is executing</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r6c1-t6" headers="r1c1-t6"><code>ia</code></td>
<td class="cellalignment1243" headers="r6c1-t6 r1c2-t6">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r6c1-t6 r1c3-t6">Domain index for which statistics are being collected</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p class="subhead2"><a id="ADDCI5094"></a>Returns</p>
<p>The function returns <code>ODCIConst.Success</code>, <code>ODCIConst.Error</code>, or <code>ODCIConst.Warning.</code></p>
<p class="subhead2"><a id="ADDCI5095"></a>Usage Notes</p>
<ul>
<li>
<p>This function should be implemented as a <code>STATIC</code> type method.</p>
</li>
<li>
<p>If statistics are being collected for only one partition, the <code>TablePartition</code> field in the <code>ODCIColInfo</code> type is filled in with the name of the partition. Otherwise (if statistics must be collected for all the partitions or for the entire table), the <code>TablePartition</code> field is null.</p>
</li>
<li>
<p>If the <code>DBMS_STATS</code> package methods are executed to collect user-defined statistics on a partitioned table, then <code>n+1</code> <code>ODCIStatsCollect</code> calls are made, where <code>n</code> is the number of partitions in the table. The first <code>n</code> calls are made with the <code>TablePartition</code> attribute in <code>ODCIColInfo</code> filled in with the partition name and the <code>ODCIStatsOptions.CallProperty</code> set to <code>IntermediateCall</code>. The last call is made with <code>ODCIEnv.CallPropertyflag</code> set to <code>FinalCall</code> to allow you to collect aggregate statistics for the entire table.</p>
</li>
<li>
<p>If user-defined statistics are being collected for only one partition of the table, two <code>ODCIStatsCollect</code> calls are made. In the first, you should collect statistics for the partition. For this call, the <code>TablePartition</code> attribute of the <code>ODCIColInfo</code> structure is filled in and the <code>ODCIEnv.CallProperty</code> is set to <code>FirstCall</code>.</p>
</li>
<li>
<p>In the second call you can update the aggregate statistics of the table based upon the new statistics collected for the partition. In this call, the <code>ODCIEnv.CallPropertyflag</code> is set to <code>FinalCall</code> to indicate that it is the second call. The <code>ODCIColInfo.TablePartition</code> is filled in with the partition name in both the calls.</p>
</li>
<li>
<p>The <a href="#i77265">ODCIStatsCollect()</a> method is invoked only one time for a non-partitioned domain index, a partitioned domain index and a partition in a domain index. If the statistics are being collected only for one partition in a domain index, the <code>IndexPartitionNum</code> field in the <code>ODCIIndexInfo</code> type is filled in with the partition number. Otherwise, the <code>IndexPartitionNum</code> field is <code>null</code>.</p>
</li>
<li>
<p>Because the statistics <code>OUT RAW</code> argument of statistics is not used in the new interface, the cartridge developer should store the user-defined statistics result in some user-defined tables.</p>
</li>
<li>
<p>If a non-partitioned domain index is being <code>ANALYZE</code>d, the user should collect statistics for the domain index.</p>
</li>
<li>
<p>If a partitioned domain index is being <code>ANALYZE</code>d,</p>
<ul>
<li>
<p><code>ODCIEnv.CallProperty = StatsGlobalAndPartition</code> means that the user should collect statistics for all partitions in the domain index and then aggregate statistics of the domain index based upon the statistics collected for all the partitions</p>
</li>
<li>
<p><code>ODCIEnv.CallProperty = StatsGlobal</code> means that the user should aggregate domain index statistics from the statistics of all the domain index partitions.</p>
</li>
<li>
<p><code>ODCIEnv.CallProperty = StatsPartition</code> means that the user should collect statistics for all index partitions in the domain index.</p>
</li>
</ul>
</li>
<li>
<p>If only one partition of the domain index is being <code>ANALYZE</code>d,</p>
<ul>
<li>
<p><code>ODCIEnv.CallProperty = StatsGlobalAndPartition</code> means that the user should collect statistics for the single index partition and then aggregate statistics of the domain index based upon the statistics of all the partitions.</p>
</li>
<li>
<p><code>ODCIEnv.CallProperty = StatsGlobal</code> means that the user should aggregate domain index statistics from the statistics of all the index partitions.</p>
</li>
<li>
<p><code>ODCIEnv.CallProperty = StatsPartition</code> means that the user should collect statistics for the single index partition.</p>
</li>
</ul>
</li>
<li>
<p>Note that when <code>ODCIEnv.CallProperty = StatsGlobalAndPartition</code> or <code>StatsGlobal</code>, the user should aggregate statistics for the domain index, depending on the availability of the statistics collected for the other index partitions. If the statistics for all the index partitions are available, aggregate these statistics. If any one statistics for an index partition is absent, do nothing.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CHEDFDDJ"></a><a id="ADDCI5096"></a>
<div class="sect2">
<h3 class="sect2">ODCIStatsDelete()</h3>
<p><code>ODCIStatsDelete</code> is called to delete user-defined statistics.</p>
<div class="inftblinformal">
<table class="cellalignment1250" title="Versions of method ODCIStatsDelete()" summary="Column 1 has lists the version of a function and column 2 gives its description." dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t7">Syntax</th>
<th class="cellalignment1247" id="r1c2-t7">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t7" headers="r1c1-t7">
<pre>
FUNCTION ODCIStatsDelete(
   col ODCIColInfo, 
   statistics OUT RAW,
   env ODCIEnv) 
return NUMBER;
</pre></td>
<td class="cellalignment1243" headers="r2c1-t7 r1c2-t7">Deletes user-defined statistics on a table or a partition of a table.</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t7" headers="r1c1-t7">
<pre>
FUNCTION ODCIStatsDelete(
   ia ODCIIndexInfo, 
   statistics OUT RAW, 
   env ODCIEnv) 
return NUMBER;
</pre></td>
<td class="cellalignment1243" headers="r3c1-t7 r1c2-t7">Deletes user-defined statistics on an index or a partition of an index.</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<div class="inftblinformal">
<table class="cellalignment1250" title="Parameters of ODCIStatsDelete" summary="First column lists a parameter; second column indicates the IN or OUT binding of the parameter, the third column describes the parameter." dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t8">Parameter</th>
<th class="cellalignment1247" id="r1c2-t8">IN/OUT</th>
<th class="cellalignment1247" id="r1c3-t8">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t8" headers="r1c1-t8"><code>col</code></td>
<td class="cellalignment1243" headers="r2c1-t8 r1c2-t8">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r2c1-t8 r1c3-t8">Column for which statistics are being deleted</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t8" headers="r1c1-t8"><code>statistics</code></td>
<td class="cellalignment1243" headers="r3c1-t8 r1c2-t8">
<pre>
OUT
</pre></td>
<td class="cellalignment1243" headers="r3c1-t8 r1c3-t8">Contains table-level aggregate statistics for a partitioned table or index</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r4c1-t8" headers="r1c1-t8"><code>env</code></td>
<td class="cellalignment1243" headers="r4c1-t8 r1c2-t8">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r4c1-t8 r1c3-t8">Contains general information about the environment in which the routine is executing</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r5c1-t8" headers="r1c1-t8"><code>ia</code></td>
<td class="cellalignment1243" headers="r5c1-t8 r1c2-t8">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r5c1-t8 r1c3-t8">Domain index for which statistics are deleted</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p class="subhead2"><a id="ADDCI5097"></a>Returns</p>
<p><code>ODCIConst.Success</code>, <code>ODCIConst.Error</code>, or <code>ODCIConst.Warning.</code></p>
<p class="subhead2"><a id="ADDCI5098"></a>Usage Notes</p>
<ul>
<li>
<p>This function should be implemented as a <code>STATIC</code> method.</p>
</li>
<li>
<p>When the function is called for a non-partitioned table, the <code>statistics</code> argument in the <code>ODCIStatsDelete</code> interface is ignored.</p>
</li>
<li>
<p>If the statistics are being deleted for a partitioned table, the <code>ODCIStatsDelete</code> is called <code>n+1</code> times. The first <code>n</code> calls are with the partition name filled in the <code>ODCIColInfo</code> structure and the <code>ODCIEnv.CallProperty</code> set to <code>IntermediateCall</code>. The last call is made with the <code>ODCIEnv.CallProperty</code> set to <code>FinalCall</code>.</p>
</li>
<li>
<p>In the first call, delete the statistics for the specific partitions; and in the last call drop or clean up any structures created for holding statistics for the deleted table. The <code>ODCIColInfo.TablePartition</code> is set to null in the last call. In the first call, the <code>TablePartition</code> field is filled in.</p>
</li>
<li>
<p>If statistics are being deleted for only one partition and the <code>_minimal_stats_aggregation</code> parameter is set to <code>FALSE</code>, two <code>ODCIStatsDelete</code> calls are made. In each call, <code>ODCIColInfo.TablePartition</code> is filled in with the partition name. On the first call, delete any user-defined statistics collected for that partition. On the second call, update the aggregate statistics for the table.</p>
</li>
<li>
<p>If statistics are being deleted for one partition and <code>_minimal_stats_aggregation</code> is set to <code>TRUE</code>, <code>ODCIStatsDelete</code> is only called one to delete any user-defined statistics collected for that partition.</p>
</li>
<li>
<p>The initial value of <code>_minimal_stats_aggregation</code> is <code>TRUE</code>.</p>
</li>
<li>
<p>The <a href="#CHEDFDDJ">ODCIStatsDelete()</a> method is invoked only one time for non-partitioned domain index, partitioned domain index, or an index partition.</p>
</li>
<li>
<p>If the statistics is being deleted for a non-partitioned domain index, the user should delete user-defined statistics for the domain index.</p>
</li>
<li>
<p>If the statistics is being deleted for a partitioned domain index, the user should delete the aggregated statistics of the domain index and optionally delete user-defined statistics for all domain index partitions, depending on <code>Options</code> in <code>ODCIEnv.CallProperty</code>:</p>
<ul>
<li>
<p><code>ODCIEnv.CallProperty = StatsGlobalAndPartition</code> means that the user should delete statistics for all the domain index partitions and aggregated statistics of the domain index.</p>
</li>
<li>
<p><code>ODCIEnv.CallProperty = StatsGlobal</code> means that the user should delete the aggregated statistics of the domain index.</p>
</li>
<li>
<p><code>ODCIEnv.CallProperty = StatsPartition</code> is not valid option.</p>
</li>
</ul>
</li>
<li>
<p>If the statistics is being deleted for only one partition of the index, the user should delete user-defined statistics for the index partition.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CHEBBEGF"></a><a id="ADDCI5099"></a>
<div class="sect2">
<h3 class="sect2">ODCIStatsFunctionCost()</h3>
<p>Computes the cost of a function.</p>
<p class="subhead2"><a id="ADDCI5100"></a>Syntax</p>
<pre>
FUNCTION ODCIStatsFunctionCost(
   func ODCIFuncInfo, 
   cost OUT ODCICost, 
   args ODCIArgDescList, 
   <span class="italic">list</span>,
   env ODCIEnv) 
return NUMBER;
</pre>
<div class="inftblinformal">
<table class="cellalignment1250" title="Parameters of ODCIStatsFunctionCost" summary="First column lists a parameter; second column indicates the IN or OUT binding of the parameter, the third column describes the parameter." dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t9">Parameter</th>
<th class="cellalignment1247" id="r1c2-t9">IN/OUT</th>
<th class="cellalignment1247" id="r1c3-t9">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t9" headers="r1c1-t9">
<pre>
func
</pre></td>
<td class="cellalignment1243" headers="r2c1-t9 r1c2-t9">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r2c1-t9 r1c3-t9">Function or type method for which the cost is being computed</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t9" headers="r1c1-t9">
<pre>
cost
</pre></td>
<td class="cellalignment1243" headers="r3c1-t9 r1c2-t9">
<pre>
OUT
</pre></td>
<td class="cellalignment1243" headers="r3c1-t9 r1c3-t9">Computed cost (must be positive whole numbers)</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r4c1-t9" headers="r1c1-t9">
<pre>
args
</pre></td>
<td class="cellalignment1243" headers="r4c1-t9 r1c2-t9">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r4c1-t9 r1c3-t9">Descriptor of actual arguments with which the function or type method was called. If the function has <span class="italic">n</span> arguments, the <code>args</code> array contains <span class="italic">n</span> elements, each describing the actual arguments of the function or type method</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r5c1-t9" headers="r1c1-t9">
<pre>
<span class="codeinlineitalic">list</span>
</pre></td>
<td class="cellalignment1243" headers="r5c1-t9 r1c2-t9">&nbsp;</td>
<td class="cellalignment1243" headers="r5c1-t9 r1c3-t9">List of actual parameters to the function or type method; the number, position, and type of each argument must be identical in the function or type method.</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r6c1-t9" headers="r1c1-t9">
<pre>
env
</pre></td>
<td class="cellalignment1243" headers="r6c1-t9 r1c2-t9">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r6c1-t9 r1c3-t9">Contains general information about the environment in which the routine is executing</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p class="subhead2"><a id="ADDCI5101"></a>Returns</p>
<p><code>ODCIConst.Success</code>, <code>ODCIConst.Error</code>, or <code>ODCIConst.Warning.</code></p>
<p class="subhead2"><a id="ADDCI5102"></a>Usage Notes</p>
<p>This function should be implemented as a static type method.</p>
</div>
<!-- class="sect2" -->
<a id="CHEDHDAJ"></a><a id="ADDCI5103"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">ODCIStatsExchangePartition()</h3>
<p>Exchanges domain index statistics when an <code>ALTER TABLE EXCHANGE PARTITION ... INCLULDING INDEXES</code> command is issued.</p>
<p class="subhead2"><a id="ADDCI5104"></a>Syntax</p>
<pre>
FUNCTION ODCIStatsExchangePartition(
   ia ODCIIndexInfo, 
   ia1 ODCIIndexInfo,
   env ODCIEnv) 
return NUMBER;
</pre>
<div class="inftblinformal">
<table class="cellalignment1250" title="Parameters of ODCIStatsExchangePartition" summary="First column lists a parameter; second column indicates the IN or OUT binding of the parameter, the third column describes the parameter." dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t10">Parameter</th>
<th class="cellalignment1247" id="r1c2-t10">IN/OUT</th>
<th class="cellalignment1247" id="r1c3-t10">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t10" headers="r1c1-t10">
<pre>
ia
</pre></td>
<td class="cellalignment1243" headers="r2c1-t10 r1c2-t10">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r2c1-t10 r1c3-t10">Information about the partition that must be exchanged</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t10" headers="r1c1-t10">
<pre>
sia1
</pre></td>
<td class="cellalignment1243" headers="r3c1-t10 r1c2-t10">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r3c1-t10 r1c3-t10">Information about the index of the n-n-partitioned table with which the partition is exchanged</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r4c1-t10" headers="r1c1-t10">
<pre>
env
</pre></td>
<td class="cellalignment1243" headers="r4c1-t10 r1c2-t10">&nbsp;</td>
<td class="cellalignment1243" headers="r4c1-t10 r1c3-t10">Contains general information about the environment in which the routine is executing</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p class="subhead2"><a id="ADDCI5105"></a>Returns</p>
<p><code>ODCIConst.Success</code>, <code>ODCIConst.Error</code>, or <code>ODCIConst.Warning</code></p>
<p class="subhead2"><a id="ADDCI5106"></a>Usage Notes</p>
<ul>
<li>
<p>This method should be implemented as a <code>STATIC</code> type.</p>
</li>
<li>
<p>This method should be capable of converting the statistics associated with a domain index partition into statistics associated with a non-partitioned domain index, and the reverse. If the statistics are missing for one of the indexes or index partitions, the user should be able to delete these statistics.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CHEHFCIG"></a><a id="ADDCI5107"></a>
<div class="sect2">
<h3 class="sect2">ODCIStatsIndexCost()</h3>
<p>Calculates the cost of a domain index scan, either a scan of the entire index or a scan of one or more index partitions if a local domain index has been built.</p>
<p class="subhead2"><a id="ADDCI5108"></a>Syntax</p>
<pre>
FUNCTION ODCIStatsIndexCost(
   ia ODCIIndexInfo, 
   sel NUMBER, 
   cost OUT ODCICost, 
   qi ODCIQueryInfo, 
   pred ODCIPredInfo, 
   args ODCIArgDescList,
   start <span class="italic">operator_return_type</span>,
   stop <span class="italic">operator_return_type</span>,
   <span class="italic">list</span>, 
   env ODCIEnv) 
return NUMBER;
</pre>
<div class="inftblinformal">
<table class="cellalignment1250" title="Parameters of ODCIStatsIndexCost" summary="First column lists a parameter; second column indicates the IN or OUT binding of the parameter, the third column describes the parameter." dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t11">Parameter</th>
<th class="cellalignment1247" id="r1c2-t11">IN/OUT</th>
<th class="cellalignment1247" id="r1c3-t11">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t11" headers="r1c1-t11">
<pre>
ia
</pre></td>
<td class="cellalignment1243" headers="r2c1-t11 r1c2-t11">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r2c1-t11 r1c3-t11">domain index for which statistics are being collected</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t11" headers="r1c1-t11">
<pre>
sel
</pre></td>
<td class="cellalignment1243" headers="r3c1-t11 r1c2-t11">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r3c1-t11 r1c3-t11">the user-computed selectivity of the predicate</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r4c1-t11" headers="r1c1-t11">
<pre>
cost
</pre></td>
<td class="cellalignment1243" headers="r4c1-t11 r1c2-t11">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r4c1-t11 r1c3-t11">computed cost (must be positive whole numbers)</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r5c1-t11" headers="r1c1-t11">
<pre>
qi
</pre></td>
<td class="cellalignment1243" headers="r5c1-t11 r1c2-t11">&nbsp;</td>
<td class="cellalignment1243" headers="r5c1-t11 r1c3-t11">Information about the query</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r6c1-t11" headers="r1c1-t11">
<pre>
pred
</pre></td>
<td class="cellalignment1243" headers="r6c1-t11 r1c2-t11">&nbsp;</td>
<td class="cellalignment1243" headers="r6c1-t11 r1c3-t11">Information about the predicate</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r7c1-t11" headers="r1c1-t11">
<pre>
args
</pre></td>
<td class="cellalignment1243" headers="r7c1-t11 r1c2-t11">&nbsp;</td>
<td class="cellalignment1243" headers="r7c1-t11 r1c3-t11">Descriptor of <code>start</code>, <code>stop</code>, and actual value arguments with which the operator was called. If the operator has <span class="italic">n</span> arguments, the <code>args</code> array contains <span class="italic">n+1</span> elements, the first element describing the start value, the second element describing the stop value, and the remaining <span class="italic">n-1</span> elements describing the actual value arguments of the operator (that is, the arguments after the first)</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r8c1-t11" headers="r1c1-t11">
<pre>
start
</pre></td>
<td class="cellalignment1243" headers="r8c1-t11 r1c2-t11">&nbsp;</td>
<td class="cellalignment1243" headers="r8c1-t11 r1c3-t11">Lower bound of the operator (for example, 2 for a predicate <code>fn(...)</code> &gt; <code>2)</code></td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r9c1-t11" headers="r1c1-t11">
<pre>
stop
</pre></td>
<td class="cellalignment1243" headers="r9c1-t11 r1c2-t11">&nbsp;</td>
<td class="cellalignment1243" headers="r9c1-t11 r1c3-t11">Upper bound of the operator (for example, 5 for a predicate <code>fn(...)</code> <code>&lt;</code> <code>5</code>)</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r10c1-t11" headers="r1c1-t11">
<pre>
<span class="codeinlineitalic">list</span>
</pre></td>
<td class="cellalignment1243" headers="r10c1-t11 r1c2-t11">&nbsp;</td>
<td class="cellalignment1243" headers="r10c1-t11 r1c3-t11">List of actual parameters to the operator (excluding the first); the number, position, and type of each argument must be identical to the one in the operator.</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r11c1-t11" headers="r1c1-t11">
<pre>
env
</pre></td>
<td class="cellalignment1243" headers="r11c1-t11 r1c2-t11">&nbsp;</td>
<td class="cellalignment1243" headers="r11c1-t11 r1c3-t11">Contains general information about the environment in which the routine is executing</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p class="subhead2"><a id="ADDCI5109"></a>Returns</p>
<p><code>ODCIConst.Success</code>, <code>ODCIConst.Error</code>, or <code>ODCIConst.Warning</code></p>
<p class="subhead2"><a id="ADDCI5110"></a>Usage Notes</p>
<ul>
<li>
<p>For each table in the query, the optimizer uses partition pruning to determine the range of partitions that may be accessed. These partitions are called <span class="bold">interesting partitions</span>. The set of interesting partitions for a table is also the set of interesting partitions for all domain indexes on that table. The cost of a domain index can depend on the set of interesting partitions, so the optimizer passes a list of interesting index partitions to <code>ODCIStatsIndexCost</code> in the <code>args</code> argument (the type of this argument, <code>ODCIArgDescList</code>, is a list of <code>ODCIArgDesc</code> argument descriptor types) for those arguments that are columns. For non-partitioned domain indexes or for cases where no partition pruning is possible, no partition list is passed to <code>ODCIStatsIndexCost</code>, and you should assume that the entire index is accessed.</p>
</li>
<li>
<p>The domain index key can contain multiple column arguments (for example, the indexed column and column arguments from other tables appearing earlier in a join order). For each column appearing in the index key, the <code>args</code> argument contains the list of interesting partitions for the table. For example, for an index key</p>
<pre>
op(T1.c1, T2.c2) = 1
</pre>
<p>the optimizer passes a list of interesting partitions for tables <code>T1</code> and <code>T2</code> if they are partitioned and there is partition pruning for them.</p>
</li>
<li>
<p>This function should be implemented as a static type method.</p>
</li>
<li>
<p>Only a single call is made to the <a href="#CHEHFCIG">ODCIStatsIndexCost()</a> function for queries on partitioned or non-partitioned tables. For queries on partitioned tables, additional information is passed in the <a href="#CHEHFCIG">ODCIStatsIndexCost()</a> function. Note that some partitions in the list passed to <a href="#CHEHFCIG">ODCIStatsIndexCost()</a> may not actually be accessed by the query. The list of interesting partitions chiefly serves to exclude partitions that are definitely not accessed.</p>
</li>
<li>
<p>When the <a href="#CHEHFCIG">ODCIStatsIndexCost()</a> function is invoked, users can fill in a string in the <code>IndexCostInfo</code> field of the cost attribute to supply any additional information that might be helpful. The string (255 characters maximum) is displayed in the <code>OPTIONS</code> column in the <code>EXPLAIN PLAN</code> output when an execution plan chooses a domain index scan.</p>
</li>
<li>
<p>Users implementing this function must return <code>'SYS.ODCISTATS2'</code> in the <a href="#CHEDBEFB">ODCIGetInterfaces()</a> call.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CHEDEDGJ"></a><a id="ADDCI5111"></a>
<div class="sect2">
<h3 class="sect2">ODCIStatsSelectivity()</h3>
<p>Specifies the selectivity of a predicate. The selectivity of a predicate involving columns from a single table is the fraction of rows of that table that satisfy the predicate. For predicates involving columns from multiple tables (for example, join predicates), the selectivity should be computed as a fraction of rows in the Cartesian product of those tables.</p>
<p class="subhead2"><a id="ADDCI5112"></a>Syntax</p>
<pre>
FUNCTION ODCIStatsSelectivity(
   pred ODCIPredInfo, 
   sel OUT NUMBER, 
   args ODCIArgDescList, 
   start <span class="italic">function_return_type</span>, 
   stop <span class="italic">function_return_type</span>, 
   <span class="italic">list</span>, 
   env ODCIEnv) 
return NUMBER;
</pre>
<div class="inftblinformal">
<table class="cellalignment1250" title="Parameters of ODCIStatsSelectivity" summary="First column lists a parameter; second column indicates the IN or OUT binding of the parameter, the third column describes the parameter." dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t12">Parameter</th>
<th class="cellalignment1247" id="r1c2-t12">IN/OUT</th>
<th class="cellalignment1247" id="r1c3-t12">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t12" headers="r1c1-t12"><code>pred</code></td>
<td class="cellalignment1243" headers="r2c1-t12 r1c2-t12">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r2c1-t12 r1c3-t12">Predicate for which the selectivity is being computed</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t12" headers="r1c1-t12"><code>sel</code></td>
<td class="cellalignment1243" headers="r3c1-t12 r1c2-t12">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r3c1-t12 r1c3-t12">The computed selectivity, expressed as a number between (and including) 0 and 100, representing a percentage.</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r4c1-t12" headers="r1c1-t12"><code>args</code></td>
<td class="cellalignment1243" headers="r4c1-t12 r1c2-t12">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r4c1-t12 r1c3-t12">Descriptor of <code>start</code>, <code>stop</code>, and actual arguments with which the function, type method, or operator was called. If the function has <span class="italic">n</span> arguments, the <code>args</code> array contains <span class="italic">n+2</span> elements, the first element describing the start value, the second element describing the stop value, and the remaining <span class="italic">n</span> elements describing the actual arguments of the function, method, or operator</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r5c1-t12" headers="r1c1-t12"><code>start</code></td>
<td class="cellalignment1243" headers="r5c1-t12 r1c2-t12">&nbsp;</td>
<td class="cellalignment1243" headers="r5c1-t12 r1c3-t12">Lower bound of the function (for example, 2 for a predicate <code>fn(...)</code> <code>&gt;</code> <code>2</code>)</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r6c1-t12" headers="r1c1-t12"><code>stop</code></td>
<td class="cellalignment1243" headers="r6c1-t12 r1c2-t12">&nbsp;</td>
<td class="cellalignment1243" headers="r6c1-t12 r1c3-t12">Upper bound of the function (for example, 5 for a predicate <code>fn(...)</code> <code>&lt;</code> <code>5)</code></td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r7c1-t12" headers="r1c1-t12"><code><span class="codeinlineitalic">list</span></code></td>
<td class="cellalignment1243" headers="r7c1-t12 r1c2-t12">&nbsp;</td>
<td class="cellalignment1243" headers="r7c1-t12 r1c3-t12">List of actual parameters to the function or type method; the number, position, and type of each argument must be identical to the one in the function, type method, or operator.</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r8c1-t12" headers="r1c1-t12"><code>env</code></td>
<td class="cellalignment1243" headers="r8c1-t12 r1c2-t12">&nbsp;</td>
<td class="cellalignment1243" headers="r8c1-t12 r1c3-t12">Contains general information about the environment in which the routine is executing</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p class="subhead2"><a id="ADDCI5113"></a>Returns</p>
<p><code>ODCIConst.Success</code>, <code>ODCIConst.Error</code>, or <code>ODCIConst.Warning</code></p>
<p class="subhead2"><a id="ADDCI5114"></a>Usage Notes</p>
<ul>
<li>
<p>As in <code>ODCIStatsIndexCost</code>, the args argument contains a list of <span class="italic">interesting</span> partitions for the tables whose columns are referenced in the predicate for which the selectivity has to be computed. These interesting partitions are partitions that cannot be eliminated by partition pruning as possible candidates to be accessed. The set of interesting partitions is passed to the function only if partition pruning has occurred (in other words, the interesting partitions are a strict subset of all the partitions).</p>
</li>
<li>
<p>For example, when <code>ODCIStatsSelectivity</code> is called to compute the selectivity of the predicate:</p>
<pre>
f(T1.c1, T2.c2) &gt; 4
</pre>
<p>the optimizer passes the list of interesting partitions for the table <code>T1</code> (in the argument descriptor for column <code>T1.c1</code>) if partition pruning is possible; similarly for the table <code>T2</code>.</p>
<p>If a predicate contains columns from several tables, this information is indicated by the flag bit <code>PredMultiTable</code>, set in the <code>Flags</code> attribute of the <code>pred</code> argument.</p>
</li>
<li>
<p>This function should be implemented as a static type method.</p>
</li>
<li>
<p>Users implementing this interface must return <code>'SYS.ODCISTATS2'</code> in the <code>ODCIGetInterfaces</code> call.</p>
</li>
<li>
<p>The selectivity of a predicate involving columns from a single table is the fraction of rows of that table that satisfy the predicate. For predicates involving columns from multiple tables (for example, join predicates), the selectivity should be computed as a fraction of rows in the Cartesian product of those tables. For tables with partition pruning, the selectivity should be expressed relative to the cardinalities of the interesting partitions of the tables involved.</p>
<p>The selectivity of predicates involving columns on partitioned tables is computed relative to the rows in the interesting partitions. Thus, the selectivity of the predicate</p>
<pre>
g(T1.c1) &lt; 5
</pre>
<p>is the percentage of rows in the set of interesting partitions (or all partitions if no partition pruning is possible) that satisfies this predicate. For predicates with columns from multiple tables, the selectivity must be relative to the number of rows in the cartesian product of the tables.</p>
</li>
<li>
<p>For example, consider the predicate:</p>
<pre>
f(T1.c1, T2.c2) &gt; 4
</pre>
<p>Suppose that the number of rows in the interesting partitions is 1000 for <code>T1</code> and 5000 for <code>T2</code>. The selectivity of this predicate must be expressed as the percentage of the 5,000,000 rows in the Cartesian product of <code>T1</code> and <code>T2</code> that satisfy the predicate.</p>
</li>
<li>
<p>If a predicate contains columns from several tables, this information is indicated by the flag bit <code>PredMultiTable</code> set in the <code>Flags</code> attribute of the <code>pred</code> argument.</p>
</li>
<li>
<p>A selectivity expressed relative to the base cardinalities of the tables involved may be only an approximation of the true selectivity if cardinalities (and other statistics) of the tables have been reduced based on single-table predicates or other joins earlier in the join order. However, this approximation to the true selectivity should be acceptable to most applications.</p>
</li>
<li>
<p>Only one call is made to the <code>ODCIStatsSelectivity</code> function for queries on partitioned or non-partitioned tables. In the case of queries on partitioned tables, additional information is passed while calling the <code>ODCIStatsSelectivity</code> function.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CHEDHGGI"></a><a id="ADDCI5115"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">ODCIStatsTableFunction()</h3>
<p>This function provides cardinality statistics for table functions and input cursor expressions.</p>
<p class="subhead2"><a id="ADDCI5116"></a>Syntax</p>
<pre>
STATIC FUNCTION ODCIStatsTableFunction(
   func IN SYS.ODCIFuncInfo, 
   outStats OUT SYS.ODCITabFuncStats, 
   argDesc IN SYS.ODCIArgDescList, 
   <span class="italic">list</span>)
RETURN NUMBER;
</pre>
<div class="inftblinformal">
<table class="cellalignment1250" title="Parameters of ODCIStatsTableFunction" summary="First column lists a parameter; second column indicates the IN or OUT binding of the parameter, the third column describes the parameter." dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t13">Parameter</th>
<th class="cellalignment1247" id="r1c2-t13">IN/OUT</th>
<th class="cellalignment1247" id="r1c3-t13">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t13" headers="r1c1-t13"><code>func</code></td>
<td class="cellalignment1243" headers="r2c1-t13 r1c2-t13">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r2c1-t13 r1c3-t13">Table function name</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t13" headers="r1c1-t13"><code>outStats</code></td>
<td class="cellalignment1243" headers="r3c1-t13 r1c2-t13">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r3c1-t13 r1c3-t13">Number of rows expected to be returned</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r4c1-t13" headers="r1c1-t13"><code>argDesc</code></td>
<td class="cellalignment1243" headers="r4c1-t13 r1c2-t13">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r4c1-t13 r1c3-t13">Description of the arguments to the table function</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r5c1-t13" headers="r1c1-t13"><code><span class="codeinlineitalic">list</span></code></td>
<td class="cellalignment1243" headers="r5c1-t13 r1c2-t13">&nbsp;</td>
<td class="cellalignment1243" headers="r5c1-t13 r1c3-t13">The arguments' compile-time values. Expressions that only have values at run time are represented by nulls.</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p class="subhead2"><a id="ADDCI5117"></a>Returns</p>
<p><code>ODCIConst.Success</code>, <code>ODCIConst.Error</code>, or <code>ODCIConst.Warning.</code></p>
</div>
<!-- class="sect2" -->
<a id="CHEGAICB"></a><a id="ADDCI5118"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">ODCIStatsUpdPartStatistics()</h3>
<p>Updates statistics during partition maintenance operations. This lets the statistics type patch up the domain index statistics to correctly reflect the partition maintenance operation.</p>
<p class="subhead2"><a id="ADDCI5119"></a>Syntax</p>
<pre>
STATIC FUNCTION ODCIStatsCollect(
   ia ODCIIndexInfo,
   palist ODCIPartInfoList,
   env ODCIEnv) 
RETURN NUMBER
</pre>
<div class="inftblinformal">
<table class="cellalignment1250" title="Parameters of ODCIStatsUpdPartStatistics" summary="First column lists a parameter; second column indicates the IN or OUT binding of the parameter, the third column describes the parameter." dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t14">Parameter</th>
<th class="cellalignment1247" id="r1c2-t14">IN/OUT</th>
<th class="cellalignment1247" id="r1c3-t14">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t14" headers="r1c1-t14"><code>ia</code></td>
<td class="cellalignment1243" headers="r2c1-t14 r1c2-t14">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r2c1-t14 r1c3-t14">Contains information about the domain index. It does not contain any partition specific information</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t14" headers="r1c1-t14">palist</td>
<td class="cellalignment1243" headers="r3c1-t14 r1c2-t14">
<pre>
 
</pre></td>
<td class="cellalignment1243" headers="r3c1-t14 r1c3-t14">Contains information about the partitions that are to be dropped or added</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r4c1-t14" headers="r1c1-t14">
<pre>
env
</pre></td>
<td class="cellalignment1243" headers="r4c1-t14 r1c2-t14">&nbsp;</td>
<td class="cellalignment1243" headers="r4c1-t14 r1c3-t14">Environment handle passed to the routine</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p class="subhead2"><a id="ADDCI5120"></a>Returns</p>
<p><code>ODCIConst.Success</code>, <code>ODCIConst.Error</code>, or <code>ODCIConst.Warning.</code></p>
<ul>
<li>
<p>When the statistics type is specified by the <code>SYSTEM MANAGED</code> approach, then the <a href="#CHEGAICB">ODCIStatsUpdPartStatistics()</a> method is invoked only one time during PMO. Only DML and query are allowed in the method implementation.</p>
</li>
<li>
<p>If the user maintains the domain index statistics in a global non-partitioned table, then the user should delete the entry for the user-defined statistics for the dropped partition (and optionally add a <code>NULL</code> entry for added partition). They can then check if <code>ODCIEnv.CallProperty</code> is <code>StatsGlobalAndPartition</code> or <code>StatsPartition</code>. If <code>ODCIEnv.CallProperty</code> is <code>StatsGlobalAndPartition</code> then they should aggregate all the available index partition statistics. If <code>ODCIEnv.CallProperty</code> is <code>StatsPartition</code> they can simply delete the aggregate statistics, or leave the aggregate statistics as they are. <code>ODCIEnv.CallProperty</code> cannot be <code>StatsGlobal</code> for this call.</p>
</li>
<li>
<p>The user should use the information passed in by the <code>ODCIEnv.CallProperty</code> to determine the type of statistics to delete and adjust.</p>
</li>
<li>
<p>If the method returns <code>ODCIConst.Error</code>, the error is ignored and the partition management operation continues.</p>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1236">
<tr>
<td class="cellalignment1243">
<table class="cellalignment1241">
<tr>
<td class="cellalignment1240"><a href="ext_idx_ref.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1240"><a href="ext_agg_ref.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2010,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1245">
<table class="cellalignment1239">
<tr>
<td class="cellalignment1240"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1240"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1240"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1240"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1240"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1240"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
