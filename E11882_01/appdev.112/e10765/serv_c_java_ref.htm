<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Cartridge Services Using C, C++ and Java</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1" />
<meta name="dcterms.created" content="2010-03-08T13:16:29Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Data Cartridge Developer's Guide" />
<meta name="dcterms.identifier" content="E10765-02" />
<meta name="dcterms.isVersionOf" content="ADDCI" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2010,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="part4.htm" title="Previous" type="text/html" />
<link rel="Next" href="ext_types_ref.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10765.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">29/36</span> <!-- End Header --><a id="CIHIFJEJ"></a><a id="ADDCI4180"></a><a id="i76515"></a>
<h1 class="chapter"><span class="secnum">18</span> Cartridge Services Using C, C++ and Java</h1>
<p>This reference chapter describes cartridge services available to programmers using C/C++ and Java.</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#i1005149">OCI Access Functions for External Procedures</a></p>
</li>
<li>
<p><a href="#i1005084">OCIExtProcGetEnv</a></p>
</li>
<li>
<p><a href="#i76536">Installing Java Cartridge Services Files</a></p>
</li>
<li>
<p><a href="#BDCBAEGE"><span class="bold">Cartridge Services-Maintaining Context</span></a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink LNOCI190" href="../../appdev.112/e10646/oci20ext.htm#LNOCI190"><span class="italic">Oracle Call Interface Programmer's Guide</span></a> for more details on cartridge services using C</div>
<a id="i1005149"></a><a id="ADDCI4934"></a>
<div class="sect1">
<h2 class="sect1">OCI Access Functions for External Procedures</h2>
<p><span class="bold"><a id="sthref690"></a><a id="sthref691"></a><a id="sthref692"></a></span>When called from an external procedure, a service routine can raise exceptions, allocate memory, and get OCI handles for callbacks to the server. To use the functions, you must specify the <code>WITH</code> <code>CONTEXT</code> clause, which lets you pass a context structure to the external procedure. The context structure is declared in header file <code>ociextp.h</code> as follows:</p>
<pre>
typedef struct OCIExtProcContext OCIExtProcContext;
</pre>
<p>This section describes how service routines use the context information. For more information and examples of usage, see the chapter on external procedures in the <a class="olink ADFNS" href="../e41502/toc.htm"><span class="italic">Oracle Database Advanced Application Developer's Guide.</span></a></p>
<a id="ADDCI4935"></a>
<div class="sect2"><a id="sthref693"></a>
<h3 class="sect2">OCIExtProcAllocCallMemory</h3>
<p><span class="bold"><a id="sthref694"></a><a id="sthref695"></a></span>This service routine allocates <span class="italic">n</span> bytes of memory for the duration of the external procedure call. Any memory allocated by the function is freed as soon as control returns to PL/SQL.</p>
<div class="infoboxnotealso">
<p class="notep1">Note:</p>
Do not use any other function to allocate or free memory.</div>
<p>The C prototype for this function follows:</p>
<pre>
void *OCIExtProcAllocCallMemory(
   OCIExtProcContext *with_context, 
   size_t amount);
</pre>
<p>The parameters <span class="italic">with_context</span> and <span class="italic">amount</span> are the context pointer and number of bytes to allocate, respectively. The function returns an untyped pointer to the allocated memory. A return value of zero indicates failure.</p>
</div>
<!-- class="sect2" -->
<a id="ADDCI4936"></a>
<div class="sect2"><a id="sthref696"></a>
<h3 class="sect2">OCIExtProcRaiseExcp</h3>
<p><a id="sthref697"></a><a id="sthref698"></a>This service routine raises a predefined exception, which must have a valid Oracle error number in the range <code>1</code> to <code>32767</code>. After doing any necessary cleanup, the external procedure must return immediately. (No values are assigned to <code>OUT</code> or <code>IN</code> <code>OUT</code> parameters.) The C prototype for this function follows:</p>
<pre>
int OCIExtProcRaiseExcp(
   OCIExtProcContext *with_context, 
   size_t error_number);
</pre>
<p>The parameters <span class="italic">with_context</span> and <span class="italic">error_number</span> are the context pointer and Oracle error number. The return values <code>OCIEXTPROC_SUCCESS</code> and <code>OCIEXTPROC_ERROR</code> indicate success or failure.</p>
</div>
<!-- class="sect2" -->
<a id="ADDCI4937"></a>
<div class="sect2"><a id="sthref699"></a>
<h3 class="sect2">OCIExtProcRaiseExcpWithMsg</h3>
<p><a id="sthref700"></a><a id="sthref701"></a>This service routine raises a user-defined exception and returns a user-defined error message. The C prototype for this function follows:</p>
<pre>
int OCIExtProcRaiseExcpWithMsg(
   OCIExtProcContext *with_context, 
   size_t error_number,
   text   *error_message, 
   size_t  len);
</pre>
<p>The parameters <code>with_context</code>, <code>error_number</code>, and <code>error_message</code> are the context pointer, Oracle error number, and error message text. The parameter <span class="italic">len</span> stores the length of the error message. If the message is a null-terminated string, <span class="italic">len</span> is zero. The return values <code>OCIEXTPROC_SUCCESS</code> and <code>OCIEXTPROC_ERROR</code> indicate success or failure.</p>
</div>
<!-- class="sect2" -->
<a id="i1005084"></a><a id="ADDCI4938"></a>
<div class="sect2">
<h3 class="sect2">OCIExtProcGetEnv</h3>
<p>This service routine enables OCI callbacks to the database during an external procedure call. Use the OCI handles obtained by this function only for callbacks. If you use them for standard OCI calls, the handles establish a new connection to the database and cannot be used for callbacks in the same transaction. In other words, during an external procedure call, you can use OCI handles for callbacks or a new connection but not for both.</p>
<p>The C prototype for this function follows:</p>
<pre>
sword OCIExtProcGetEnv(
   OCIExtProcContext *with_context, 
   OCIEnv    **envh, 
   OCISvcCtx **svch, 
   OCIError  **errh);
</pre>
<p>The parameter <span class="italic">with_context</span> is the context pointer, and the parameters <span class="italic">envh</span>, <span class="italic">svch</span>, and <span class="italic">errh</span> are the OCI environment, service, and error handles, respectively. The return values <code>OCIEXTPROC_SUCCESS</code> and <code>OCIEXTPROC_ERROR</code> indicate success or failure.</p>
<p><a href="c_cpp_java.htm#i1005104">"Doing Callbacks"</a> shows how <code>OCIExtProcGetEnv</code> might be used in callbacks. For a working example, see the script extproc.sql in the PL/SQL demo directory.<a id="sthref702"></a><a id="sthref703"></a> (For the location of this directory, see your Oracle installation or user's guide.) This script demonstrates the calling of an external procedure. The companion file extproc.c contains the C source code for the external procedure. To run the demo, follow the instructions in <code>extproc</code>.<code>sql</code>. You must use an account that has <code>CREATE</code> <code>LIBRARY</code> privileges.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i76536"></a><a id="ADDCI4939"></a>
<div class="sect1">
<h2 class="sect1">Installing Java Cartridge Services Files</h2>
<p>The <code>ODCI.jar</code> and <code>CartridgeServices.jar</code> files must be installed into the <code>SYS</code> schema to use the Java classes described in this chapter.</p>
<p>If you installed the Java option, then you must install the <code>ODCI.jar</code> and <code>CartridgeServices.jar</code> files. You do not have to perform this task if you did not install the Java option.</p>
<p class="subhead2"><a id="ADDCI4940"></a>To install ODCI.jar and CartridgeServices.jar files</p>
<ol>
<li>
<p>Activate the SQL*Plus prompt.</p>
<pre>
C:\sqlplus
</pre></li>
<li>
<p>When prompted, login using the <code>system</code> account.</p>
<pre>
Enter user-name: system
Enter password: <span class="italic">password</span>
</pre></li>
<li>
<p>Use the server-side loadjava command to install the classes and create the synonyms in the <code>SYSTEM</code> schema.</p>
<pre>
SQL&gt; call dbms_java.loadjava('-resolve -synonym -grant public 
     -verbose vobs/jilip/Cartridge Services.jar');
SQL&gt; call dbms_java.loadjava('-resolve -synonym -grant public
     -verbose vobs/jlib/ODCI.jar');
</pre></li>
</ol>
<p>See the chapter on what to do after migrating or updating the database, in <a class="olink UPGRD" href="../../server.112/e23633/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a>, for further details on installing the <code>jar</code> files.</p>
</div>
<!-- class="sect1" -->
<a id="BDCBAEGE"></a><a id="ADDCI4941"></a>
<div class="sect1">
<h2 class="sect1"><span class="bold">Cartridge Services-<a id="sthref704"></a>Maintaining Context</span></h2>
<p>The Java cartridge service is used for maintaining context. It is similar to the OCI context management service. This class is necessary when switching context between the server and the cartridge code.</p>
<a id="ADDCI4942"></a>
<div class="sect2"><a id="sthref705"></a>
<h3 class="sect2">ContextManager</h3>
<p>ContextManager is a Constructor in class Oracle that extends Object.</p>
<p class="subhead2"><a id="ADDCI4943"></a><span class="bold">Class Interface</span></p>
<pre>
public static Hashtable ctx extends Object
</pre>
<p class="subhead2"><a id="ADDCI4944"></a><span class="bold">Variable</span></p>
<pre>
ctx public static Hashtable ctx
</pre>
<p class="subhead2"><a id="ADDCI4945"></a><span class="bold">Constructors</span></p>
<pre>
ContextManager public ContextManager()
</pre>
<p class="subhead2"><a id="ADDCI4946"></a><span class="bold">Methods</span></p>
<p>The following methods are available:</p>
<pre>
setContext (static method in class oracle)
getContext (static method in class oracle)
clearContext (static method in class oracle)
</pre></div>
<!-- class="sect2" -->
<a id="ADDCI4947"></a>
<div class="sect2"><a id="sthref706"></a>
<h3 class="sect2">CountException()</h3>
<p>Constructor that extends <code>Exception</code>.</p>
<pre>
Class oracle.CartridgeServices.CountException
</pre></div>
<!-- class="sect2" -->
<a id="ADDCI4948"></a>
<div class="sect2"><a id="sthref707"></a>
<h3 class="sect2">CountException(String)</h3>
<p>Constructor that extends <code>Exception</code>.</p>
<pre>
public CountException(String s)
</pre></div>
<!-- class="sect2" -->
<a id="ADDCI4949"></a>
<div class="sect2"><a id="sthref708"></a>
<h3 class="sect2">InvalidKeyException()</h3>
<p>Constructor that extends <code>Exception</code>.</p>
<pre>
public InvalidKeyException(String s)
</pre></div>
<!-- class="sect2" -->
<a id="ADDCI4950"></a>
<div class="sect2"><a id="sthref709"></a>
<h3 class="sect2">InvalidKeyException(String)</h3>
<p>Constructor that extends <code>Exception</code>.</p>
<pre>
public InvalidKeyException(String s)
</pre></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1236">
<tr>
<td class="cellalignment1243">
<table class="cellalignment1241">
<tr>
<td class="cellalignment1240"><a href="part4.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1240"><a href="ext_types_ref.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2010,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1245">
<table class="cellalignment1239">
<tr>
<td class="cellalignment1240"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1240"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1240"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1240"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1240"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1240"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
