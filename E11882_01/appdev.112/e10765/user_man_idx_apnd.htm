<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>User-Managed Local Domain Indexes</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1" />
<meta name="dcterms.created" content="2010-03-08T13:16:29Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Data Cartridge Developer's Guide" />
<meta name="dcterms.identifier" content="E10765-02" />
<meta name="dcterms.isVersionOf" content="ADDCI" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2010,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="pipe_paral_tbl_ref.htm" title="Previous" type="text/html" />
<link rel="Next" href="index.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10765.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">35/36</span> <!-- End Header --><a id="BABJGEEF"></a><a id="ADDCI5162"></a>
<h1 class="appendix"><span class="secnum">A</span> User-Managed Local Domain Indexes</h1>
<p>The user-managed approach for partitioning domain indexes has been the only method available until Oracle Database 11g Release 1, when system-managed partitioning was introduced. The user-managed approach has three significant limitations:</p>
<ul>
<li>
<p>Because the extensible indexing framework does not store information about the domain index related objects in the kernel, you must maintain tables and partitions by invoking user-supplied routines.</p>
</li>
<li>
<p>Because the kernel does not support equipartitioned tables, each partition has to have a set of tables and dependent schema objects, which must be managed programmatically in the user-managed indexing code.</p>
<p>As the number of partitions increases, the proliferation of domain index storage objects can become an obstacle to efficient operation. To use a table that contains images and has 1,000 partitions, an indexing schema that creates 64 bitmap indexes on its storage table (after it is extended to support local domain indexes) would need create and manage 1,000 domain index storage tables and 64,000 bitmap indexes.</p>
</li>
<li>
<p>During DML and query processing with local domain indexes, you would need a separate set of cursors for each partition; this is required because each partition has its own set of tables. As a consequence, applications that use a large number of partitions and require access to several partitions simultaneously must compile new SQL cursors at run-time, which impacts performance.</p>
</li>
</ul>
<p>Oracle recommends that you use the system-managed approach, as described in <a href="dom_idx.htm#BHADJHIF">Chapter 8, "Building Domain Indexes"</a>.</p>
<p>Oracle plans to deprecate the user-managed approach in a future release. Information provided in this appendix documents the specific differences between the user-managed and system managed processes and APIs.</p>
<a id="BHAGEIED"></a><a id="ADDCI5163"></a>
<div class="sect1">
<h2 class="sect1">Comparing User-Managed and System-Managed Domain Indexes</h2>
<p>An alternative approach would be to use system-managed domain indexes. It addresses these limitations and has the following benefits:</p>
<ul>
<li>
<p>Because the kernel performs many more maintenance tasks on behalf of the user, there is no need for programmatic support for table and partition maintenance operations. These operations can be implemented by taking actions in the server and by using a very minimal set of interface routines. The cartridge code can then be relatively unaware of partition issues.</p>
</li>
<li>
<p>The number of objects that must be managed to support local partitioned domain indexes is identical to the number for non-partitioned domain indexes. For local partitioned indexes, the domain index storage tables are equipartitioned with respect to the base tables; therefore, the number of domain index storage tables does not increase with an increase in the number of partitions.</p>
</li>
<li>
<p>A single set of query and DML statements can now access and manipulate the system-partitioned storage tables, facilitating cursor sharing and enhancing performance.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="ADDCI5164"></a>
<div class="sect1"><a id="sthref798"></a>
<h2 class="sect1">Truncating Domain Indexes</h2>
<p>There is no explicit statement for truncating a domain index. However, when the corresponding table is truncated, your indextype's truncate method is invoked. For example:</p>
<pre>
TRUNCATE TABLE MyEmployees;
</pre>
<p>truncates <code>ResumeTextIndex</code> by calling your <a href="#BABGGJHF">ODCIIndexTruncate()</a> method.</p>
</div>
<!-- class="sect1" -->
<a id="ADDCI5165"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" --><a id="sthref799"></a>
<h2 class="sect1">Creating Indextypes</h2>
<p>Use the following syntax to create indextypes for the user-managed domain indexes.</p>
<pre>
CREATE INDEXTYPE TextIndexType
FOR Contains (VARCHAR2, VARCHAR2)
USING TextIndexMethods;
</pre></div>
<!-- class="sect1" -->
<a id="ADDCI5166"></a>
<div class="sect1"><a id="sthref800"></a>
<h2 class="sect1">Using Domain Indexes for the Indextype</h2>
<p>In order for the indextype to be able to use local domain indexes, the methods have to be declared when the indextype is created:</p>
<pre>
CREATE INDEXTYPE TextIndexType
  FOR Contains (VARCHAR2, VARCHAR2)
  USING TextIndexMethods
  WITH LOCAL RANGE PARTITION;
</pre></div>
<!-- class="sect1" -->
<a id="ADDCI5167"></a>
<div class="sect1"><a id="sthref801"></a>
<h2 class="sect1">Partitioning Domain Indexes</h2>
<p>The user-managed approach uses the methods <a href="#i79090">ODCIIndexMergePartition()</a> and <a href="#i79095">ODCIIndexSplitPartition()</a> to support local domain indexes.</p>
</div>
<!-- class="sect1" -->
<a id="ADDCI5168"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" --><a id="sthref802"></a>
<h2 class="sect1">APIs for User-Managed Domain Indexes</h2>
<p>The following methods are used only in the user-managed implementation of domain indexes.</p>
<a id="BABGGJHF"></a><a id="ADDCI5169"></a>
<div class="sect2">
<h3 class="sect2">ODCIIndexTruncate()</h3>
<p>This is an index definition method. When a user issues a <code>TRUNCATE</code> statement against a table that contains a column or object type attribute indexed by your indextype, Oracle calls your <a href="#BABGGJHF">ODCIIndexTruncate()</a> method. This method should leave the domain index empty.</p>
<p class="subhead1"><a id="ADDCI5170"></a>Syntax</p>
<pre>
FUNCTION ODCIIndexTruncate(
   ia ODCIIndexInfo, 
   env ODCIEnv) 
RETURN NUMBER
</pre>
<div class="inftblinformal">
<table class="cellalignment1250" title="parameter(s) of the function" summary="Parameters and their descriptions" dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t2">Parameter</th>
<th class="cellalignment1247" id="r1c2-t2">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t2" headers="r1c1-t2">
<pre>
ia
</pre></td>
<td class="cellalignment1243" headers="r2c1-t2 r1c2-t2">Contains information about the indexed column</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t2" headers="r1c1-t2">
<pre>
env
</pre></td>
<td class="cellalignment1243" headers="r3c1-t2 r1c2-t2">The environment handle passed to the routine</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p class="subhead1"><a id="ADDCI5171"></a>Returns</p>
<p><code>ODCIConst.Success</code> on success, or <code>ODCIConst.Error</code> on error, or <code>ODCIConst.Warning</code>.</p>
<p>While truncating a local domain index, the first <span class="italic">N</span>+1 calls can return <code>ODCIConst.ErrContinue</code> too.</p>
<p class="subhead1"><a id="ADDCI5172"></a>Usage Notes</p>
<ul>
<li>
<p>This function should be implemented as a static type method.</p>
</li>
<li>
<p>After this function executes, the domain index should be empty (corresponding to the empty base table).</p>
</li>
<li>
<p>While the <a href="#BABGGJHF">ODCIIndexTruncate()</a> routine is being executed, the domain index is marked <code>LOADING</code>. If the <a href="#BABGGJHF">ODCIIndexTruncate()</a> routine returns with an <code>ODCIConst</code>.<code>Error</code> (or exception), the domain index is marked <code>FAILED</code>. The only operation permitted on <code>FAILED</code> domain indexes is <code>DROP</code> <code>INDEX</code>, <code>TRUNCATE</code> <code>TABLE</code> or <code>ALTER</code> <code>INDEX</code> <code>REBUILD</code>. If <a href="#BABGGJHF">ODCIIndexTruncate()</a> returns with <code>ODCIConst</code>.<code>Warning</code>, the operation succeeds but a warning message is returned to the user.</p>
</li>
<li>
<p>Every SQL statement executed by <a href="#BABGGJHF">ODCIIndexTruncate()</a> is treated as an independent operation. The changes made by <a href="#BABGGJHF">ODCIIndexTruncate()</a> are not guaranteed to be atomic.</p>
</li>
<li>
<p>This method is invoked for truncating a non-partitioned index, truncating a local domain index, and also for truncating a single index partition during <code>ALTER TABLE TRUNCATE PARTITION</code>.</p>
<p>For truncating a non-partitioned index, the <a href="#BABGGJHF">ODCIIndexTruncate()</a> is invoked with the <code>IndexPartition</code>, <code>TablePartition</code> and <code>callProperty</code> set to <code>NULL</code>.</p>
<p>For truncating a local domain index, the routine is invoked <span class="italic">N</span>+2 times, where <span class="italic">N</span> is the number of partitions.</p>
<p>For truncating a single index partition during <code>ALTER TABLE TRUNCATE PARTITION</code>, this routine is invoked with the <code>IndexPartition</code> and the <code>TablePartition</code> filled in and the <code>callProperty</code> set to <code>NULL</code>.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="i79090"></a><a id="ADDCI5173"></a>
<div class="sect2">
<h3 class="sect2">ODCIIndexMergePartition()</h3>
<p>Invoked when a <code>ALTER TABLE MERGE PARTITION</code> is issued on range partitioned table on which a domain index is defined.</p>
<p class="subhead1"><a id="ADDCI5174"></a>Syntax</p>
<pre>
FUNCTION ODCIIndexMergePartition(
   ia ODCIIndexInfo, 
   part_name1 ODCIPartInfo, 
   part_name2 ODCIPartInfo, 
   parms VARCHAR2, 
   env ODCIEnv) 
RETURN NUMBER
</pre>
<div class="inftblinformal">
<table class="cellalignment1250" title="parameter(s) of the function" summary="Parameters and their descriptions" dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t3">Parameter</th>
<th class="cellalignment1247" id="r1c2-t3">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t3" headers="r1c1-t3">
<pre>
ia
</pre></td>
<td class="cellalignment1243" headers="r2c1-t3 r1c2-t3">Contains index and table partition name for one of the partitions to be merged</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t3" headers="r1c1-t3">
<pre>
part_name1
</pre></td>
<td class="cellalignment1243" headers="r3c1-t3 r1c2-t3">Contains index and table partition name for the second partition to be merged</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r4c1-t3" headers="r1c1-t3">
<pre>
part_name2
</pre></td>
<td class="cellalignment1243" headers="r4c1-t3 r1c2-t3">Holds index and table partition name for the new merged partition</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r5c1-t3" headers="r1c1-t3">
<pre>
parms
</pre></td>
<td class="cellalignment1243" headers="r5c1-t3 r1c2-t3">Contains the parameter string for the resultant merged partition, essentially the default parameter string associated with the index.</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r6c1-t3" headers="r1c1-t3">
<pre>
env
</pre></td>
<td class="cellalignment1243" headers="r6c1-t3 r1c2-t3">The environment handle passed to the routine</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p class="subhead1"><a id="ADDCI5175"></a>Returns</p>
<p><code>ODCIConst.Success</code> on success, or <code>ODCIConst.Error</code> on error, or <code>ODCIConst.Warning</code>.</p>
<p class="subhead1"><a id="ADDCI5176"></a>Usage Notes</p>
<ul>
<li>
<p>The function should be implemented as a static type method.</p>
</li>
<li>
<p>You should create a new table representing the resultant merged partition and populate it with data from the merged partitions. Then drop the tables corresponding to the merged index partitions.</p>
</li>
<li>
<p>The newly created partition should pick the default parameter string associated with the index level. Resulting local index partitions are marked <code>UNUSABLE</code>; you should not attempt to populate the data in the new partition until after an <code>ALTER INDEX REBUILD PARTITION</code> call.</p>
</li>
<li>
<p>The old table and the dictionary entries for the old index partitions are deleted before the call to <a href="#i79090">ODCIIndexMergePartition()</a>, so the cartridge code for this routine should not rely on the existence of this data in the views.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="i79095"></a><a id="ADDCI5177"></a>
<div class="sect2">
<h3 class="sect2">ODCIIndexSplitPartition()</h3>
<p>Invoked when an <code>ALTER TABLE SPLIT PARTITION</code> is invoked on a partitioned table where a domain index is defined.</p>
<p class="subhead1"><a id="ADDCI5178"></a>Syntax</p>
<pre>
FUNCTION ODCIIndexSplitPartition(
   ia ODCIIndexInfo, 
   part_name1 ODCIPartInfo, 
   part_name2 ODCIPartInfo, 
   parms VARCHAR2, 
   env ODCIEnv) 
RETURN NUMBER
</pre>
<div class="inftblinformal">
<table class="cellalignment1250" title="parameter(s) of the function" summary="Parameters and their descriptions" dir="ltr">
<thead>
<tr class="cellalignment1237">
<th class="cellalignment1247" id="r1c1-t4">Parameter</th>
<th class="cellalignment1247" id="r1c2-t4">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r2c1-t4" headers="r1c1-t4">
<pre>
ia
</pre></td>
<td class="cellalignment1243" headers="r2c1-t4 r1c2-t4">Contains the information about the partition to be split</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r3c1-t4" headers="r1c1-t4">
<pre>
part_name1
</pre></td>
<td class="cellalignment1243" headers="r3c1-t4 r1c2-t4">Holds the index and table partition names for one of the new partitions</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r4c1-t4" headers="r1c1-t4">
<pre>
part_name2
</pre></td>
<td class="cellalignment1243" headers="r4c1-t4 r1c2-t4">Holds the index and table partition names for the other new partition</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r5c1-t4" headers="r1c1-t4">
<pre>
parms
</pre></td>
<td class="cellalignment1243" headers="r5c1-t4 r1c2-t4">Contains the parameter string for the new partitions, the string associated with the index partition that is being split.</td>
</tr>
<tr class="cellalignment1237">
<td class="cellalignment1243" id="r6c1-t4" headers="r1c1-t4">
<pre>
env
</pre></td>
<td class="cellalignment1243" headers="r6c1-t4 r1c2-t4">The environment handle passed to the routine</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p class="subhead1"><a id="ADDCI5179"></a>Returns</p>
<p><code>ODCIConst.Success</code> on success, or <code>ODCIConst.Error</code> on error, or <code>ODCIConst.Warning</code>.</p>
<p class="subhead1"><a id="ADDCI5180"></a>Usage Notes</p>
<ul>
<li>
<p>The function should be implemented as a static type method.</p>
</li>
<li>
<p>You must to drop the metadata corresponding to the partition that is split, and create metadata for the two newly created partitions.</p>
</li>
<li>
<p>The new tables should pick up the default parameter string associated with the split partition.</p>
</li>
<li>
<p>The index data corresponding to these partitions need not be computed since the indexes are marked <code>UNUSABLE</code>. The indexes can be built after an <code>ALTER INDEX REBUILD PARTITION</code> call makes the indexes usable again.</p>
</li>
<li>
<p>The old table and the old index partition's dictionary entries are deleted before the call to <a href="#i79095">ODCIIndexSplitPartition()</a>, so the cartridge code for this routine should not rely on the existence of this data in the views.</p>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1236">
<tr>
<td class="cellalignment1243">
<table class="cellalignment1241">
<tr>
<td class="cellalignment1240"><a href="pipe_paral_tbl_ref.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1240"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2010,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1245">
<table class="cellalignment1239">
<tr>
<td class="cellalignment1240"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1240"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1240"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1240"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1240"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1240"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
