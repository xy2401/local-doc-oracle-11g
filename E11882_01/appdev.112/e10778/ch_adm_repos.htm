<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Administering the DICOM Repository</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 009" />
<meta name="dcterms.created" content="2010-08-02T8:12:22Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Multimedia DICOM Developer's Guide" />
<meta name="dcterms.identifier" content="E10778-03" />
<meta name="dcterms.isVersionOf" content="IMDCM" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2007, 2010,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="dm_glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="ch_dtmod_docs.htm" title="Previous" type="text/html" />
<link rel="Next" href="ch_adm_ref.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10778.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">21/31</span> <!-- End Header --><a id="BACIFIHC"></a><a id="IMDCM9000"></a>
<h1 class="chapter"><span class="secnum">11</span> Administering the DICOM Repository</h1>
<p>This chapter uses code examples to show how to <a id="sthref821"></a>manage configuration documents in the DICOM data model repository. The code examples are written in PL/SQL to match the ORD_DICOM_ADMIN package, which is provided in PL/SQL only.</p>
<p>Oracle Multimedia DICOM provides capabilities for several administrative operations related to the data model repository. For example, administrators can review the Oracle-defined configuration documents in the DICOM data model repository before determining whether to add custom configuration documents for a particular organization (Steps 2 and 4 in <a href="#BACFHHAG">Section 11.2</a> describe this process). Using views or invoking data model utility functions, administrators can obtain attributes and other detailed information about these configuration documents. Working with the procedures and functions in the ORD_DICOM_ADMIN package, administrators can insert, update, export, or delete configuration documents from the repository. Administrators of the DICOM data model repository are assigned the ORDADMIN role.</p>
<p>This chapter includes these sections:</p>
<ul>
<li>
<p><a href="#BACICCCD">Sample Session 1: Inserting Two Documents</a></p>
</li>
<li>
<p><a href="#BACFHHAG">Sample Session 2: Updating a Mapping Document</a></p>
</li>
<li>
<p><a href="#BACCACEF">Sample Session 3: Deleting a Constraint Document</a></p>
</li>
<li>
<p><a href="#CHDEGHBF">Sample Session 4: Inserting a Stored Tag List Document</a></p>
</li>
</ul>
<p>See <a href="ch_adm_ref.htm#CHDCJFFF">Chapter 12</a> for reference information about the ORD_DICOM_ADMIN package.</p>
<p>For additional examples, articles, and other information about Oracle Multimedia DICOM and Oracle Multimedia, see the Oracle Multimedia Software section of the Oracle Technology Network Web site at</p>
<p><code><a href="http://www.oracle.com/technology/products/multimedia/">http://www.oracle.com/technology/products/multimedia/</a></code></p>
<a id="BACICCCD"></a><a id="IMDCM9100"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">11.1</span> Sample Session 1: Inserting Two Documents</h2>
<p>The following sample session shows the steps for inserting a mapping document and a constraint document into the repository. This sample assumes that the following prerequisite tasks have been completed:</p>
<ul>
<li>
<p>The directory object (<code>DICOMDIR</code>) has been created, and the administrator has been granted READ access.</p>
</li>
<li>
<p>The metadata schema associated with the mapping document has been registered with Oracle XML DB as a global XML schema.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<p><a class="olink ADXDB0600" href="../../appdev.112/e23094/xdb05sto.htm#ADXDB0600"><span class="italic">Oracle XML DB Developer's Guide</span></a> for more information about registering XML schemas</p>
</div>
</li>
</ul>
<p>Perform the following steps to insert a mapping document and a constraint document into the repository:</p>
<dl>
<dd><a id="IMDCM13811"></a><a id="sthref822"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Edit the Data Model</dt>
<dd>
<p>Prepare the data model for editing and lock it to prevent other administrators from making changes at the same time. For example:</p>
<pre>
exec ord_dicom_admin.editDataModel();
</pre>
<p>The data model remains locked until you publish the changes, perform a rollback operation, or exit the session.</p>
<p>Optionally, you can enter the following command to query the orddcm_documents view:</p>
<pre>
select * from orddcm_documents order by doc_id asc;
</pre>
<p>Review the list of documents.</p>
</dd>
<dd><a id="IMDCM13812"></a><a id="sthref823"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Insert the New Documents</dt>
<dd>
<p>First, insert the <a id="sthref824"></a><a id="sthref825"></a>sample mapping document (<code>sample_map.xml</code>), as follows:</p>
<pre>
exec ord_dicom_admin.insertDocument('sample_map.xml', 'MAPPING',
 xmltype(bfilename('DICOMDIR', 'sample_map.xml'), nls_charset_id('AL32UTF8')));
 
</pre>
<p>See <a href="ch_cncpt.htm#CIHFDGHC">Example 2-1</a> for the sample mapping document (<code>sample_map.xml</code>).</p>
<p>Then, insert the <a id="sthref826"></a><a id="sthref827"></a>sample constraint document (<code>sample_ct.xml</code>), as follows:</p>
<pre>
exec ord_dicom_admin.insertDocument('sample_ct.xml', 'CONSTRAINT',
 xmltype(bfilename('DICOMDIR', 'sample_ct.xml'), nls_charset_id('AL32UTF8')));
</pre>
<p>See <a href="ch_cncpt.htm#BCEHJHBH">Example 2-3</a> for the sample constraint document (<code>sample_ct.xml</code>).</p>
<p>Optionally, you can enter the following command to query the orddcm_documents view:</p>
<pre>
select * from orddcm_documents order by doc_id asc;
</pre>
<p>Review the list of documents to ensure that the inserted documents appear.</p>
<p>As another option, you can enter the following command to query the orddcm_document_refs view, and then review the document references:</p>
<pre>
select * from orddcm_document_refs order by doc_name, ref_by_doc_name asc;
</pre>
<p>At this point, you can run administrative tests as needed. In addition, you can call the rollbackDataModel( ) procedure to terminate the operation without publishing the changes. Or, you can continue with the next step.</p>
</dd>
<dd><a id="IMDCM13813"></a><a id="sthref828"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Publish the Changes</dt>
<dd>
<p>Publish the changes and unlock the data model, as follows:</p>
<pre>
exec ord_dicom_admin.publishDataModel();
</pre>
<p>The data model includes the inserted configuration documents.</p>
</dd>
</dl>
</div>
<!-- class="sect1" -->
<a id="BACFHHAG"></a><a id="IMDCM9200"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">11.2</span> Sample Session 2: Updating a Mapping Document</h2>
<p>The following sample session shows the steps for <a id="sthref829"></a><a id="sthref830"></a>updating a mapping document in the repository. This sample assumes that the following prerequisite tasks have been completed:</p>
<ul>
<li>
<p>The directory object (<code>DICOMDIR</code>) has been created, and the administrator has been granted READ and WRITE access.</p>
</li>
<li>
<p>The referenced metadata schema associated with the mapping document has been registered with Oracle XML DB as a global XML schema.</p>
<p>See <a class="olink ADXDB0600" href="../../appdev.112/e23094/xdb05sto.htm#ADXDB0600"><span class="italic">Oracle XML DB Developer's Guide</span></a> for information about registering XML schemas.</p>
</li>
</ul>
<p>Perform the following steps to update a mapping document in the repository:</p>
<dl>
<dd><a id="IMDCM13814"></a><a id="sthref831"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Edit the Data Model</dt>
<dd>
<p>As in <a href="#BACICCCD">Section 11.1</a>, prepare the data model for editing and lock it to prevent other administrators from making changes at the same time. For example:</p>
<pre>
exec ord_dicom_admin.editDataModel();
</pre>
<p>The data model remains locked until you publish the changes, perform a rollback operation, or exit the session.</p>
<p>Optionally, you can enter the following command to query the orddcm_documents view:</p>
<pre>
select * from orddcm_documents order by doc_id asc;
</pre>
<p>Review the list of documents.</p>
</dd>
<dd><a id="IMDCM13815"></a><a id="sthref832"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Export the Existing Document</dt>
<dd>
<p>Export the <a id="sthref833"></a><a id="sthref834"></a>sample mapping document (<code>sample_map.xml</code>) from the repository into a specified file (<code>sample_map_export.xml</code>) for editing. For example:</p>
<pre>
exec ord_dicom_admin.exportDocument('sample_map.xml', 'DICOMDIR', 
 'sample_map_export.xml');
</pre>
<p>See <a href="ch_cncpt.htm#CIHFDGHC">Example 2-1</a> for the sample mapping document (<code>sample_map.xml</code>).</p>
<p>The <code>sample_map_export.xml</code> file is available for editing with an XML editor.</p>
</dd>
<dd><a id="IMDCM13816"></a><a id="sthref835"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Delete the Existing Document</dt>
<dd>
<p>Delete the existing <a id="sthref836"></a><a id="sthref837"></a>mapping document (<code>sample_map.xml</code>) from the repository, as follows:</p>
<pre>
exec ord_dicom_admin.deleteDocument('sample_map.xml');
</pre>
<p>The repository no longer includes the sample mapping document.</p>
<p>Optionally, you can enter the following command to query the orddcm_documents view:</p>
<pre>
select * from orddcm_documents order by doc_id asc;
</pre>
<p>Review the list of documents to ensure that the deleted document no longer appears.</p>
</dd>
<dd><a id="IMDCM13817"></a><a id="sthref838"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Edit the Exported Document</dt>
<dd>
<p>Use an XML editor to edit the file that was exported in Step 2. Then, save the changes and check the permissions on the file before inserting it into the repository.</p>
</dd>
<dd><a id="IMDCM13818"></a><a id="sthref839"></a></dd>
<dt class="seghead">Step 5&nbsp;&nbsp;&nbsp;Insert the Edited Document</dt>
<dd>
<p>Insert the edited document (<code>sample_map_edited.xml</code>) into the repository, as follows:</p>
<pre>
exec ord_dicom_admin.insertDocument('sample_map_edited.xml', 'MAPPING',
 xmltype(bfilename('DICOMDIR', 'sample_map_edited.xml'), 
 nls_charset_id('AL32UTF8')));
</pre>
<p>Optionally, you can enter the following command to query the orddcm_documents view:</p>
<pre>
select * from orddcm_documents order by doc_id asc;
</pre>
<p>Review the list of documents to ensure that the updated document appears.</p>
<p>At this point, you can test your changes, run the extractMetadata( ) method on the edited mapping document to retrieve metadata from the embedded DICOM content as XML code, and then store it in a database table for searching or viewing. In addition, you can call the rollbackDataModel( ) procedure to terminate the operation without publishing the changes. Or, you can continue with the next step.</p>
</dd>
<dd><a id="IMDCM13819"></a><a id="sthref840"></a></dd>
<dt class="seghead">Step 6&nbsp;&nbsp;&nbsp;Publish the Changes</dt>
<dd>
<p>As in <a href="#BACICCCD">Section 11.1</a>, publish the changes and unlock the data model, as follows:</p>
<pre>
exec ord_dicom_admin.publishDataModel();
</pre>
<p>The data model includes the updated configuration document.</p>
</dd>
</dl>
</div>
<!-- class="sect1" -->
<a id="BACCACEF"></a><a id="IMDCM9300"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">11.3</span> Sample Session 3: Deleting a Constraint Document</h2>
<p>The following sample session shows the steps for <a id="sthref841"></a><a id="sthref842"></a>deleting a constraint document from the repository. This sample assumes that the following prerequisite task has been completed:</p>
<p>The directory object (<code>DICOMDIR</code>) has been created, and the administrator has been granted WRITE access.</p>
<p>Perform the following steps to delete a constraint document from the repository:</p>
<dl>
<dd><a id="IMDCM13820"></a><a id="sthref843"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Edit the Data Model</dt>
<dd>
<p>As in <a href="#BACICCCD">Section 11.1</a>, prepare the data model for editing and lock it to prevent other administrators from making changes at the same time. For example:</p>
<pre>
exec ord_dicom_admin.editDataModel();
</pre>
<p>The data model remains locked until you publish the changes, perform a rollback operation, or exit the session.</p>
<p>Optionally, you can enter the following command to query the orddcm_documents view:</p>
<pre>
select * from orddcm_documents order by doc_id asc;
</pre>
<p>Review the list of documents.</p>
</dd>
<dd><a id="IMDCM13821"></a><a id="sthref844"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Export the Existing Document (Optional and Recommended)</dt>
<dd>
<p>Export the <a id="sthref845"></a><a id="sthref846"></a>sample constraint document (<code>sample_ct.xml</code>) from the repository into a specified file (<code>sample_ct_export.xml</code>) for editing. For example:</p>
<pre>
exec ord_dicom_admin.exportDocument('sample_ct.xml', 'DICOMDIR', 
'sample_ct_export.xml');
</pre>
<p>See <a href="ch_cncpt.htm#BCEHJHBH">Example 2-3</a> for the sample constraint document (<code>sample_ct.xml</code>).</p>
<p>Optionally, you can enter the following command to query the orddcm_document_refs view, which shows the list of documents that are referenced by other documents in the repository:</p>
<pre>
select * from orddcm_document_refs order by doc_name, ref_by_doc_name asc;
</pre>
<p>Review the list of documents to check the references for the constraint document that you intend to delete.</p>
</dd>
<dd><a id="IMDCM13822"></a><a id="sthref847"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Delete the Document</dt>
<dd>
<p>Delete the <a id="sthref848"></a><a id="sthref849"></a>sample constraint document (<code>sample_ct.xml</code>), as follows:</p>
<pre>
exec ord_dicom_admin.deleteDocument('sample_ct.xml');
</pre>
<p>The repository no longer includes the sample constraint document.</p>
<p>Optionally, you can enter the following command to query the orddcm_documents view:</p>
<pre>
select * from orddcm_documents order by doc_id asc;
</pre>
<p>Review the list of documents to ensure that the deleted document no longer appears.</p>
<p>At this point, you can call the rollbackDataModel( ) procedure to terminate the operation without publishing the changes. Or, you can continue with the next step.</p>
</dd>
<dd><a id="IMDCM13823"></a><a id="sthref850"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Publish the Changes</dt>
<dd>
<p>Publish the changes and unlock the data model, as follows:</p>
<pre>
exec ord_dicom_admin.publishDataModel();
</pre>
<p>The data model does not include the deleted configuration document.</p>
</dd>
</dl>
</div>
<!-- class="sect1" -->
<a id="CHDEGHBF"></a><a id="IMDCM13618"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">11.4</span> Sample Session 4: Inserting a Stored Tag List Document</h2>
<p>This section describes two different approaches you can take to insert a stored tag list document into the repository:</p>
<ul>
<li>
<p><a href="#CHDCCAAJ">Section 11.4.1</a> describes how to insert a stored tag list document with a known set of attribute tags.</p>
<p>Follow the example in this section to create, and then insert, your own stored tag list document if you believe that you know the full set of attribute tags that all the constraint and mapping documents in your repository are likely to use.</p>
</li>
<li>
<p><a href="#CHDDFIEE">Section 11.4.2</a> describes how to generate and insert a stored tag list document from an existing repository that is populated with constraint and mapping documents.</p>
<p>Follow the examples in this section if you have an existing repository and want to generate, and then insert, a stored tag list document from tags used by your existing constraint and mapping documents.</p>
</li>
</ul>
<p>Select the appropriate approach to take advantage of the storage and performance benefits of the stored tag list feature.</p>
<p>The following subsections describe each approach:</p>
<ul>
<li>
<p><a href="#CHDCCAAJ">Inserting a Stored Tag List Document with a Known Set of Tags</a></p>
</li>
<li>
<p><a href="#CHDDFIEE">Generating and Inserting a Stored Tag List Document</a></p>
</li>
</ul>
<a id="CHDCCAAJ"></a><a id="IMDCM13621"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.4.1</span> Inserting a Stored Tag List Document with a Known Set of Tags</h3>
<p>You can create your own stored tag list document, and then insert it into the repository. Include all the attribute tags to be defined in the constraint and mapping documents in the repository in your document. <a href="#CHDCGHCD">Example 11-1</a> is a sample file (<code>sample_stl.xml</code>) that you can insert as the stored tag list document.</p>
<div class="example">
<p class="titleinexample"><a id="CHDCGHCD"></a><a id="IMDCM13622"></a>Example 11-1 Inserting a Stored Tag List Document with Known Attribute Tags</p>
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- 
 Copyright (c) 2008, Oracle. All rights reserved.
 
   NAME
     sample_stl.xml   - sample stored tag list 
 
--&gt;
&lt;ATTRIBUTE_TAG_LIST xmlns="http://xmlns.oracle.com/ord/dicom/attributeTag_1_0"
 xmlns:dt="http://xmlns.oracle.com/ord/dicom/datatype_1_0" 
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://xmlns.oracle.com/ord/dicom/attributeTag_1_0
 http://xmlns.oracle.com/ord/dicom/attributeTag_1_0"&gt;
  &lt;DOCUMENT_HEADER&gt;
    &lt;dt:DOCUMENT_CHANGE_LOG&gt;
      &lt;dt:DOCUMENT_MODIFIER&gt;ORACLE&lt;/dt:DOCUMENT_MODIFIER&gt;
      &lt;dt:DOCUMENT_MODIFICATION_DATE&gt;2009-02-25&lt;/dt:DOCUMENT_MODIFICATION_DATE&gt;
      &lt;dt:DOCUMENT_VERSION&gt;1.0&lt;/dt:DOCUMENT_VERSION&gt;
    &lt;/dt:DOCUMENT_CHANGE_LOG&gt;
  &lt;/DOCUMENT_HEADER&gt;
  &lt;ATTRIBUTE_TAG&gt;00020002&lt;/ATTRIBUTE_TAG&gt;
  &lt;ATTRIBUTE_TAG&gt;00020003&lt;/ATTRIBUTE_TAG&gt;
  &lt;ATTRIBUTE_TAG&gt;00100010&lt;/ATTRIBUTE_TAG&gt;
&lt;/ATTRIBUTE_TAG_LIST&gt;
</pre></div>
<!-- class="example" -->
<p>This approach assumes that the following prerequisite task has been completed:</p>
<p>The directory object (<code>DICOMDIR</code>) has been created, and the administrator has been granted READ access.</p>
<p>Perform the following steps to insert a stored tag list document with a known set of attribute tags into the repository:</p>
<dl>
<dd><a id="IMDCM13824"></a><a id="sthref851"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Edit the Data Model</dt>
<dd>
<p>As in <a href="#BACICCCD">Section 11.1</a>, prepare the data model for editing and lock it to prevent other administrators from making changes at the same time. For example:</p>
<pre>
exec ord_dicom_admin.editDataModel();
</pre>
<p>The data model remains locked until you publish the changes, perform a rollback operation, or exit the session.</p>
<p>At this point, to see which documents are stored in the repository, enter the following command to query the orddcm_documents view:</p>
<pre>
select doc_name from orddcm_documents order by doc_id asc;
</pre></dd>
<dd><a id="IMDCM13825"></a><a id="sthref852"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Insert the Stored Tag List Document</dt>
<dd>
<p>Insert the <a id="sthref853"></a><a id="sthref854"></a>sample stored tag list document file (<code>sample_stl.xml</code>), as follows:</p>
<pre>
exec ord_dicom_admin.insertDocument(
                           'sample_stl.xml',
                           'STORED_TAG_LIST',
                            xmltype(bfilename('DICOMDIR', 'sample_stl.xml'),
                            nls_charset_id('AL32UTF8') ) );
</pre></dd>
<dd><a id="IMDCM13826"></a><a id="sthref855"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Publish the Changes</dt>
<dd>
<p>Publish the changes and unlock the data model, as follows:</p>
<pre>
exec  ord_dicom_admin.publishDataModel;
</pre>
<p>The data model includes the inserted configuration documents.</p>
</dd>
</dl>
</div>
<!-- class="sect2" -->
<a id="CHDDFIEE"></a><a id="IMDCM13623"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.4.2</span> Generating and Inserting a Stored Tag List Document</h3>
<p>If you have an existing repository that is populated with constraint and mapping documents, you can generate a stored tag list document from tags used by your existing constraint and mapping documents, make changes to the tags as needed, and insert the stored tag list document into the repository.</p>
<p>To enforce specific rules for the attributes you want to include in your stored tag list, insert a preference document that defines those attribute rules. <a href="#CIHGHJEG">Example 11-2</a> shows a preference document (<code>sample_pf.xml</code>) that enforces the mandate attribute tags rule for mapping and constraint documents. The code statements where this operation is performed are highlighted in bold.</p>
<div class="example">
<p class="titleinexample"><a id="CIHGHJEG"></a><a id="IMDCM13827"></a>Example 11-2 Sample Preference Document for the Mandate Attribute Tags Rule</p>
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;DICOM_RUNTIME_PREFERENCES xmlns="http://xmlns.oracle.com/ord/dicom/preference_1_0"
  xmlns:dt="http://xmlns.oracle.com/ord/dicom/datatype_1_0" 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xsi:schemaLocation="http://xmlns.oracle.com/ord/dicom/preference_1_0 
  http://xmlns.oracle.com/ord/dicom/preference_1_0"&gt;
 &lt;DOCUMENT_HEADER&gt;
  &lt;dt:DOCUMENT_CHANGE_LOG&gt;
   &lt;dt:DOCUMENT_MODIFIER&gt;Developer 1&lt;/dt:DOCUMENT_MODIFIER&gt;
   &lt;dt:DOCUMENT_MODIFICATION_DATE&gt;2009-02-20&lt;/dt:DOCUMENT_MODIFICATION_DATE&gt;
   &lt;dt:DOCUMENT_VERSION&gt;0.2&lt;/dt:DOCUMENT_VERSION&gt;
   &lt;dt:MODIFICATION_COMMENT&gt; enable MANDATE_ATTR_TAGS_IN_STL&lt;/dt:MODIFICATION_COMMENT&gt;
  &lt;/dt:DOCUMENT_CHANGE_LOG&gt;
 &lt;/DOCUMENT_HEADER&gt;
 &lt;PREFERENCE_DEF&gt;
  &lt;PARAMETER&gt;<span class="bold">MANDATE_ATTR_TAGS_IN_STL</span>&lt;/PARAMETER&gt;
  &lt;DESCRIPTION&gt; allowed values true or false&lt;/DESCRIPTION&gt;
  &lt;VALUE&gt;<span class="bold">true</span>&lt;/VALUE&gt;
 &lt;/PREFERENCE_DEF&gt;
&lt;/DICOM_RUNTIME_PREFERENCES&gt;
</pre></div>
<!-- class="example" -->
<p>Because the value of the MANDATE_ATTR_TAGS_IN_STL parameter is set to <code>true</code>, all the tags used by the constraint and mapping documents are listed in the stored tag list document. See <a href="ch_dtmod_docs.htm#CIHCJAJI">Section 10.2.6.3</a> for more information about defining this parameter in preference documents.</p>
<p>This approach assumes that the following prerequisite task has been completed:</p>
<p>The directory object (<code>DICOMDIR</code>) has been created, and the administrator has been granted READ and WRITE access.</p>
<p>Perform the following steps to generate and insert a stored tag list document into the repository:</p>
<dl>
<dd><a id="IMDCM13828"></a><a id="sthref856"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Edit the Data Model</dt>
<dd>
<p>As in <a href="#BACICCCD">Section 11.1</a>, prepare the data model for editing and lock it to prevent other administrators from making changes at the same time. For example:</p>
<pre>
exec ord_dicom_admin.editDataModel();
</pre>
<p>The data model remains locked until you publish the changes, perform a rollback operation, or exit the session.</p>
<p>Optionally, you can enter the following command to query the orddcm_documents view:</p>
<pre>
select doc_name from orddcm_documents order by doc_id asc;
</pre>
<p>Review the list of documents to see which documents exist in your repository.</p>
</dd>
<dd><a id="IMDCM13829"></a><a id="sthref857"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Generate and Export the Stored Tag List Document to a File</dt>
<dd>
<p>Generate and export the <a id="sthref858"></a><a id="sthref859"></a>stored tag list document to the sample stored tag list document file (<code>sample_stl.xml</code>), as shown in <a href="#CHDFFBAB">Example 11-3</a>:</p>
<div class="example">
<p class="titleinexample"><a id="CHDFFBAB"></a><a id="IMDCM13657"></a>Example 11-3 Generating and Exporting a Stored Tag List Document to a File</p>
<pre>
--
-- Generate a tag list document and store in sample_stl.xml
-- in DICOMDIR
--
-- A stored tag list document must include all tags used by
-- mapping and constraint documents in the repository
-- to enforce the mandate_attr_tags_in_stl rule using a
-- preference document.
--
-- Use the 'ALL' option to ensure that the generated tag list
-- document contains all the tags used by mapping and constraint
-- documents.
--
set serveroutput on;
declare
  fid           UTL_FILE.FILE_TYPE;
  buf           VARCHAR2(32767);
  bytesLeft     INTEGER;
  pos           INTEGER;
  chunk         INTEGER;
  xml_clob      CLOB;
  xt            XMLType;
BEGIN

   xt := ORD_DICOM_ADMIN.generateTagListDocument('ALL');
   if (xt is null) then
    dbms_output.put_line('Repository has no documents');
    dbms_output.put_line('Tag list document is null');
    return;
   end if;

    -- write xml document to file using UTL_FILE
    -- let UTL_FILE report errors for directory and filename
    fid := utl_file.fopen( 'DICOMDIR', 'sample_stl.xml', 'w', 32767 );
 
 
    -- Read from clob and write to file
    select XMLSerialize(document xt as clob)        into xml_clob from dual;
    bytesLeft := dbms_lob.getLength( xml_clob );
    pos       := 1;
    WHILE bytesLeft &gt; 0 loop
      chunk := 32767;
      IF bytesLeft &lt; chunk THEN
        chunk := bytesLeft;
      END IF;
      dbms_lob.read(xml_clob, chunk, pos, buf );
      utl_file.put( fid, buf);  
      utl_file.fflush(fid);
      bytesLeft := bytesLeft - chunk;
      pos := pos + chunk;
    end loop;
 
    utl_file.fclose( fid );
 
    --free the temporary blob returned by xmltype
    if(dbms_lob.isTemporary(xml_clob) &lt;&gt; 0) then
      dbms_lob.freeTemporary(xml_clob);
    end if;
 
 
   exception
   WHEN OTHERS then
    -- free temp lobs
    if(dbms_lob.isTemporary(xml_clob) &lt;&gt; 0) then
      dbms_lob.freeTemporary(xml_clob);
    end if;
 
    raise;   -- original exception
END;
/
</pre></div>
<!-- class="example" --></dd>
<dd><a id="IMDCM13830"></a><a id="sthref860"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Optional: Edit the Stored Tag List Document</dt>
<dd>
<p>Use an XML editor to edit the stored tag list document file that was exported in Step 2. Make changes to the tags as needed, save the changes, and check the permissions on the file before inserting it into the repository.</p>
</dd>
<dd><a id="IMDCM13831"></a><a id="sthref861"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Insert the Stored Tag List Document</dt>
<dd>
<p>Insert the <a id="sthref862"></a><a id="sthref863"></a>generated stored tag list document (<code>sample_stl.xml</code>), as follows:</p>
<pre>
ord_dicom_admin.insertDocument(
                        'sample_stl.xml', 
                        'STORED_TAG_LIST',
                         xmltype(bfilename('DICOMDIR', 'sample_stl.xml'),
                         nls_charset_id('AL32UTF8') ) );
</pre></dd>
<dd><a id="IMDCM13832"></a><a id="sthref864"></a></dd>
<dt class="seghead">Step 5&nbsp;&nbsp;&nbsp;Optional: Enforce the Mandate Attribute Tags Rule</dt>
<dd>
<p>To enforce the mandate attribute tags rule, insert a preference document with the value of the MANDATE_ATTR_TAGS_IN_STL parameter set to <code>true</code>, as follows:</p>
<pre>
 exec ord_dicom_admin.insertDocument(
                           'sample_pf.xml', 
                           'PREFERENCE',
                            xmltype(bfilename('DICOMDIR', 'sample_pf.xml'),
                            nls_charset_id('AL32UTF8') ) );
</pre>
<p>See <a href="#CIHGHJEG">Example 11-2</a> for a sample preference document that enforces this rule.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If the MANDATE_ATTR_TAGS_IN_STL parameter is set to <code>true</code> in your preference document, and you attempt to insert any mapping or constraint documents that contain tags that are not listed in your stored tag list document, those documents are not inserted into the repository. See <a href="ch_dtmod_docs.htm#CIHCJAJI">Section 10.2.6.3</a> for more information about this preference parameter.</div>
<p>Optionally, you can enter the following command to query the orddcm_documents view:</p>
<pre>
select * from orddcm_documents order by doc_id asc;
</pre>
<p>Review the list of documents.</p>
</dd>
<dd><a id="IMDCM13833"></a><a id="sthref865"></a></dd>
<dt class="seghead">Step 6&nbsp;&nbsp;&nbsp;Publish the Changes</dt>
<dd>
<p>Publish the changes and unlock the data model, as follows:</p>
<pre>
exec  ord_dicom_admin.publishDataModel;
</pre></dd>
</dl>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1189">
<tr>
<td class="cellalignment1196">
<table class="cellalignment1194">
<tr>
<td class="cellalignment1193"><a href="ch_dtmod_docs.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1193"><a href="ch_adm_ref.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2007, 2010,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1198">
<table class="cellalignment1192">
<tr>
<td class="cellalignment1193"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1193"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1193"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1193"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1193"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1193"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
