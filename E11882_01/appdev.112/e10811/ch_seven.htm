<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Loading Images</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1" />
<meta name="dcterms.created" content="2009-08-03T6:35:42Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database 2 Day + PHP Developer's Guide" />
<meta name="dcterms.identifier" content="E10811-01" />
<meta name="dcterms.isVersionOf" content="TDPPH" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2009,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="ch_six.htm" title="Previous" type="text/html" />
<link rel="Next" href="ch_eight.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10811.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">10/12</span> <!-- End Header --><a id="CHDGIEJI"></a><a id="i1037182"></a>
<h1 class="chapter"><span class="secnum">7</span> Loading Images</h1>
<p>This chapter shows you how to change the application to upload a JPEG image for new employee records and display it on the Employees page. It has the following topics:</p>
<ul>
<li>
<p><a href="#i1037547">Using BLOBs to Store and Load Employee Images</a></p>
</li>
<li>
<p><a href="#CHDEJDCH">Resizing Images</a></p>
</li>
</ul>
<a id="i1037547"></a>
<div class="sect1">
<h2 class="sect1">Using BLOBs to Store and Load Employee Images</h2>
<p>In this section, you will <a id="sthref598"></a><a id="sthref599"></a><a id="sthref600"></a><a id="sthref601"></a>modify your application code to enable a photo to be stored in the record of an employee.</p>
<p>To enable images of employees to be stored in the employee records, perform the following tasks:</p>
<ol>
<li>
<p>Create the <code>chap7</code> directory, copy the application files from <code>chap6</code>, and change to the newly created directory:</p>
<p>On Windows:</p>
<pre>
mkdir c:\program files\Apache Group\Apache2\htdocs\chap7
cd c:\program files\Apache Group\Apache2\htdocs\chap7
copy ..\chap6\* .
</pre>
<p>On Linux:</p>
<pre>
mkdir $HOME/public_html/chap7
cd $HOME/public_html/chap7
cp ../chap6/* .
</pre></li>
<li>
<p>Open SQL Developer and open a connection to your HR sample schema.</p>
</li>
<li>
<p>Login to your HR sample schema as <span class="bold">hr</span>.</p>
</li>
<li>
<p>Open SQL Worksheet and enter the following <code>CREATE TABLE</code> statement to create a new table for storing employee images:</p>
<pre>
<span class="bold">CREATE TABLE employee_photos(</span>
<span class="bold">  employee_id        NUMBER,</span>
<span class="bold">  employee_thumbnail BLOB);</span>
</pre>
<img width="739" height="569" src="img/chap7_hrcreatetable.gif" alt="Description of chap7_hrcreatetable.gif follows" title="Description of chap7_hrcreatetable.gif follows" /><br />
<a id="sthref602" href="img_text/chap7_hrcreatetable.htm">Description of the illustration chap7_hrcreatetable.gif</a><br />
<br /></li>
<li>
<p>The <code>HR</code> user must have the <code>CREATE TABLE</code> privilege to perform this command. If you get an "insufficient privileges" error message, then log out as the <code>HR</code> user, log in as <code>system</code>, and execute the following <code>GRANT</code> command:</p>
<pre>
GRANT create table TO hr;
</pre>
<p>Then log in as <code>HR</code> again to execute the <code>CREATE TABLE</code> statement.</p>
</li>
<li>
<p>Edit the <code><a id="sthref603"></a><a id="sthref604"></a>anyco_ui.inc</code> file. Add a Photograph column to the <code>EMPLOYEES</code> table in the <code><a id="sthref605"></a><a id="sthref606"></a>ui_print_employees()</code> function:</p>
<pre>
&lt;th&gt;Commission&lt;br&gt;(%)&lt;/th&gt;
&lt;th&gt;Remuneration&lt;/th&gt;
<span class="bold">&lt;th&gt;Photograph&lt;/th&gt;</span>
</pre>
<p>The data for the Photograph column is populated with an <code>&lt;img&gt;</code> tag whose <code>src</code> attribute is defined as a URL reference to a new <code><a id="sthref607"></a><a id="sthref608"></a>anyco_im.php</code> file, which will display the image for each employee record.</p>
</li>
<li>
<p>Edit the <code><a id="sthref609"></a><a id="sthref610"></a>anyco_ui.inc</code> file. Add code in the <code><a id="sthref611"></a><a id="sthref612"></a>ui_print_employees()</code> function to generate an <code>&lt;img&gt;</code> tag referencing the <code>anyco_im.php</code> file with the employee identifier as a parameter:</p>
<pre>
echo '&lt;td align="right"&gt;'
     .htmlentities($emp['REMUNERATION']).'&lt;/td&gt;';
<span class="bold">echo '&lt;td&gt;&lt;img src="anyco_im.php?showempphoto='.$emp['EMPLOYEE_ID']</span>
<span class="bold">     .'" alt="Employee photo"&gt;&lt;/td&gt;';</span>
</pre></li>
<li>
<p>Edit the <code><a id="sthref613"></a><a id="sthref614"></a>anyco_ui.inc</code> file. To enable images to be uploaded when a new employee record is created, add an <a id="sthref615"></a><code>enctype</code> attribute to the <code>&lt;form&gt;</code> tag in the <code><a id="sthref616"></a><a id="sthref617"></a>ui_print_insert_employee()</code> function:</p>
<pre>
&lt;form method="post" action="$posturl"<span class="bold"> enctype="multipart/form-data"</span>&gt;
</pre>
<p>At the bottom of the form add an upload field with an input type of <code>file</code>:</p>
<pre>
&lt;tr&gt;
  &lt;td&gt;Commission (%)&lt;/td&gt;
  &lt;td&gt;&lt;input type="text" name="commpct" value="0" size="20"&gt;&lt;/td&gt;
&lt;/tr&gt;
<span class="bold">&lt;tr&gt;</span>
<span class="bold">  &lt;td&gt;Photo&lt;/td&gt;</span>
<span class="bold">  &lt;td&gt;&lt;input type="file" name="empphoto"&gt;&lt;/td&gt;</span>
<span class="bold">&lt;/tr&gt;</span>
</pre></li>
<li>
<p>Create the <code><a id="sthref618"></a><a id="sthref619"></a>anyco_im.php file.</code> This file accepts an employee identifier as a URL parameter, reads the image from the Photograph column for that employee record, and returns the thumbnail image to be displayed:</p>
<pre>
<span class="bold">&lt;?php    // anyco_im.php</span>

<span class="bold">require('anyco_cn.inc');</span>
<span class="bold">require('anyco_db.inc');</span>
<span class="bold">construct_image();</span>

<span class="bold">function construct_image()</span>
<span class="bold">{</span>
<span class="bold">  if (!isset($_GET['showempphoto'])) {</span>
<span class="bold">    return;</span>
<span class="bold">  }</span>

<span class="bold">  $empid = $_GET['showempphoto'];</span>

<span class="bold">  $conn = db_connect($err);</span>

<span class="bold">  if (!$conn) {</span>
<span class="bold">    return;</span>
<span class="bold">  }</span>

<span class="bold">  $query =</span>
<span class="bold">    'SELECT employee_thumbnail</span>
<span class="bold">     FROM   employee_photos</span>
<span class="bold">     WHERE  employee_id = :eid';</span>

<span class="bold">  $stid = oci_parse($conn, $query);</span>
<span class="bold">  $r = oci_bind_by_name($stid, ":eid", $empid, -1);</span>
<span class="bold">  if (!$r) {</span>
<span class="bold">    return;</span>
<span class="bold">  }</span>
<span class="bold">  $r = oci_execute($stid, OCI_DEFAULT);</span>
<span class="bold">  if (!$r) {</span>
<span class="bold">    return;</span>
<span class="bold">  }</span>

<span class="bold">  $arr = oci_fetch_row($stid);</span>
<span class="bold">  if (!$arr) {</span>
<span class="bold">    return;                     // photo not found</span>
<span class="bold">  }</span>

<span class="bold">  $result = $arr[0]-&gt;load();</span>

<span class="bold">  // If any text (or whitespace!) is printed before this header is sent,</span>
<span class="bold">  // the text is not displayed. The image also is not displayed properly.</span>
<span class="bold">  // Comment out the "header" line to see the text and debug.</span>
<span class="bold">  header("Content-type: image/JPEG");</span>
<span class="bold">  echo $result;</span>
<span class="bold">}</span>

<span class="bold">?&gt;</span>
</pre>
<p>The <a id="sthref620"></a><a id="sthref621"></a><code>construct_image()</code> function uses the <a id="sthref622"></a><a id="sthref623"></a><code>OCI-Lob-&gt;load()</code> function to retrieve the Oracle LOB data, which is the image data. The PHP <a id="sthref624"></a><a id="sthref625"></a><code>header()</code> function sets the MIME type in the HTTP response header to ensure the browser interprets the data as a JPEG image.</p>
<p>If you want to display other image types, then the <code><a id="sthref626"></a>Content-type</code> needs to be changed accordingly.</p>
</li>
<li>
<p>Edit the <code><a id="sthref627"></a><a id="sthref628"></a><a id="sthref629"></a>anyco_db.inc</code> file. Add a new function <code><a id="sthref630"></a><a id="sthref631"></a>db_insert_thumbnail()</code>to insert an image into the <a id="sthref632"></a><a id="sthref633"></a><code>EMPLOYEE_PHOTOS</code> table:</p>
<pre>
<span class="bold">function db_insert_thumbnail($conn, $empid, $imgfile, &amp;$e)</span>
<span class="bold">{</span>
<span class="bold">  $lob = oci_new_descriptor($conn, OCI_D_LOB);</span>
<span class="bold">  if (!$lob) {</span>
<span class="bold">    $e = db_error($conn, __FILE__, __LINE__);</span>
<span class="bold">    return false;</span>
<span class="bold">  }</span>

<span class="bold">  $insstmt =</span>
<span class="bold">    'INSERT INTO employee_photos (employee_id, employee_thumbnail)</span>
<span class="bold">     VALUES(:eid, empty_blob())</span>
<span class="bold">     RETURNING employee_thumbnail into :etn';</span>

<span class="bold">  $stmt = oci_parse($conn, $insstmt);</span>
<span class="bold">  $r = oci_bind_by_name($stmt, ':etn', $lob, -1, OCI_B_BLOB);</span>
<span class="bold">  if (!$r) {</span>
<span class="bold">    $e = db_error($stid, __FILE__, __LINE__);</span>
<span class="bold">    return false;</span>
<span class="bold">  }</span>
<span class="bold">  $r = oci_bind_by_name($stmt, ':eid', $empid, -1);</span>
<span class="bold">  if (!$r) {</span>
<span class="bold">    $e = db_error($stid, __FILE__, __LINE__);</span>
<span class="bold">    return false;</span>
<span class="bold">  }</span>
<span class="bold">  $r = oci_execute($stmt, OCI_DEFAULT);</span>
<span class="bold">  if (!$r) {</span>
<span class="bold">    $e = db_error($stid, __FILE__, __LINE__);</span>
<span class="bold">    return false;</span>
<span class="bold">  }</span>

<span class="bold">  if (!$lob-&gt;savefile($imgfile)) {</span>
<span class="bold">    $e = db_error($stid, __FILE__, __LINE__);</span>
<span class="bold">    return false;</span>
<span class="bold">  }</span>
<span class="bold">  $lob-&gt;free();</span>

<span class="bold">  return true;</span>
<span class="bold">}</span>
</pre>
<p>To tie the new <code><a id="sthref634"></a><a id="sthref635"></a>EMPLOYEE_PHOTOS</code> and <a id="sthref636"></a><a id="sthref637"></a><code>EMPLOYEES</code> tables together, you must use the same employee id in both tables.</p>
</li>
<li>
<p>Edit the <code><a id="sthref638"></a><a id="sthref639"></a>anyco_db.inc</code> file. Change the <code><a id="sthref640"></a><a id="sthref641"></a>$bindvars</code> parameter in the <code><a id="sthref642"></a><a id="sthref643"></a>db_execute_statement()</code> function to <code>&amp;$bindvars</code> so that <code><a id="sthref644"></a><a id="sthref645"></a>OUT</code> bind variable values are returned from the database. At the bottom of the function, add a loop to set any return bind values:</p>
<pre>
function db_execute_statement($conn, $statement, &amp;$e, <span class="bold">&amp;$bindvars</span> = array())
{
  ...
  $r = @oci_execute($stid);
  if (!$r) {
    $e = db_error($stid, __FILE__, __LINE__);
    return false;
  }
<span class="bold">  $outbinds = array();</span>
<span class="bold">  foreach ($bindvars as $b) {</span>
<span class="bold">    $outbinds[$b[0]] = $$b[0];</span>
<span class="bold">  }</span>
<span class="bold">   $bindvars = $outbinds;</span>
<span class="bold">   return true;</span>
}
</pre></li>
<li>
<p>Edit the <code><a id="sthref646"></a><a id="sthref647"></a>anyco.php</code> file. Change the INSERT statement in the <a id="sthref648"></a><a id="sthref649"></a><code>insert_new_emp()</code> function so that it returns the new employee identifier in the bind variable <code>:neweid</code>. This value is inserted with the image into the new <code>EMPLOYEE_PHOTOS</code> table.</p>
<pre>
$statement =
  'INSERT INTO employees
               (employee_id, first_name, last_name, email, hire_date,
               job_id, salary, commission_pct, department_id)
   VALUES (employees_seq.nextval, :fnm, :lnm, :eml, :hdt,
          :jid, :sal, :cpt, :did)
<span class="bold">   RETURNING employee_id into :neweid</span>';
</pre>
<p>Also in the <code>insert_new_emp()</code> function, add a call to the <a id="sthref650"></a><a id="sthref651"></a><code>array_push()</code> function to set a new <a id="sthref652"></a><a id="sthref653"></a>bind variable <code>NEWEID</code> at the end of the list of <code>array_push()</code> calls:</p>
<pre>
array_push($bindargs, array('CPT', $newemp['commpct'], -1));
array_push($bindargs, array('DID', $newemp['deptid'], -1));
<span class="bold">array_push($bindargs, array('NEWEID', null, 10));</span>
</pre>
<p>Because the value of <code>NEWID</code> is being retrieved with the RETURNING clause in the INSERT statement, its initial value is set to <code>NULL</code>. The length is set to 10 to allow enough digits in the return value.</p>
</li>
<li>
<p>Edit the <code>anyco.php</code> file. In the <code>insert_new_emp()</code> function, add a call between the <code>db_execute_statement()</code> and <code>construct_employees()</code> calls to insert the thumbnail image:</p>
<pre>
$r = db_execute_statement($conn, $statement, $err, $bindargs);
if ($r) {
<span class="bold">  $r = db_insert_thumbnail($conn, $bindargs['NEWEID'],</span>
<span class="bold">                           $_FILES['empphoto']['tmp_name'], $e);</span>
  construct_employees();
}
</pre></li>
<li>
<p>In a browser, <a id="sthref654"></a><a id="sthref655"></a>enter the following application URL:</p>
<p>On Windows:</p>
<pre>
http://localhost/chap7/anyco.php
</pre>
<p>On Linux:</p>
<pre>
http://localhost/~&lt;username&gt;/chap7/anyco.php
</pre></li>
<li>
<p>In the Departments page, click <span class="bold">Show Employees</span> to navigate to the Employees page:</p>
<img width="609" height="241" src="img/chap7_loadimg_005.gif" alt="Description of chap7_loadimg_005.gif follows" title="Description of chap7_loadimg_005.gif follows" /><br />
<a id="sthref656" href="img_text/chap7_loadimg_005.htm">Description of the illustration chap7_loadimg_005.gif</a><br />
<br /></li>
<li>
<p>In the Employees page, to insert a new employee record click <span class="bold">Insert new employee</span>:</p>
<img width="722" height="267" src="img/chap7_loadimg_006.gif" alt="Description of chap7_loadimg_006.gif follows" title="Description of chap7_loadimg_006.gif follows" /><br />
<a id="sthref657" href="img_text/chap7_loadimg_006.htm">Description of the illustration chap7_loadimg_006.gif</a><br />
<br /></li>
<li>
<p>The Insert New Employee form allows you to choose a thumbnail image on your system to be uploaded to the database. Enter your own values in the fields or use the values as shown. Click <span class="bold">Browse</span>:</p>
<img width="598" height="460" src="img/chap7_loadimg_007.gif" alt="Description of chap7_loadimg_007.gif follows" title="Description of chap7_loadimg_007.gif follows" /><br />
<a id="sthref658" href="img_text/chap7_loadimg_007.htm">Description of the illustration chap7_loadimg_007.gif</a><br />
<br /></li>
<li>
<p>In the File Upload window, browse for and select a JPEG image file, and click <span class="bold">Open</span>:</p>
<img width="634" height="451" src="img/chap7_loadimg_008.gif" alt="Description of chap7_loadimg_008.gif follows" title="Description of chap7_loadimg_008.gif follows" /><br />
<a id="sthref659" href="img_text/chap7_loadimg_008.htm">Description of the illustration chap7_loadimg_008.gif</a><br />
<br /></li>
<li>
<p>In the Insert New Employee page, click <span class="bold">Save</span>:</p>
<img width="612" height="460" src="img/chap7_loadimg_022.gif" alt="Description of chap7_loadimg_022.gif follows" title="Description of chap7_loadimg_022.gif follows" /><br />
<a id="sthref660" href="img_text/chap7_loadimg_022.htm">Description of the illustration chap7_loadimg_022.gif</a><br />
<br />
<p>The Employees page is displayed with the new employee record, including the image, which is displayed at its original size:</p>
<img width="723" height="482" src="img/chap7_loadimg_009.gif" alt="Description of chap7_loadimg_009.gif follows" title="Description of chap7_loadimg_009.gif follows" /><br />
<a id="sthref661" href="img_text/chap7_loadimg_009.htm">Description of the illustration chap7_loadimg_009.gif</a><br />
<br /></li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CHDEJDCH"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Resizing Images</h2>
<p>In this section, you will further <a id="sthref662"></a><a id="sthref663"></a><a id="sthref664"></a><a id="sthref665"></a>modify your application code to create a thumbnail image from a supplied image, and store the thumbnail image in the record of an employee.</p>
<p>You can use the PHP <a id="sthref666"></a><a id="sthref667"></a>GD graphics extension to resize employee images.</p>
<ol>
<li>
<p>Restart Apache. You can either use the ApacheMonitor utility, or you can use Windows Services.</p>
<p>To use the ApacheMonitor utility, navigate to the Apache <code>bin</code> directory and double click <code>ApacheMonitor.exe</code>. In a default installation, Apache <code>bin</code> is located at <code>c:\Program Files\Apache Group\Apache2\bin</code>.</p>
<p>You can access Windows Services from the Windows <span class="bold">Start</span> menu at <span class="bold">Start</span> &gt; <span class="bold">Control Panel</span> &gt; <span class="bold">Administrative Tools</span> &gt; <span class="bold">Services.</span> Select the <span class="bold">Standard</span> tab. Right click the Apache2 HTTP Server and then select <span class="bold">Restart</span>.</p>
</li>
<li>
<p>Edit the <code><a id="sthref668"></a><a id="sthref669"></a>anyco_db.inc</code> file. To resize the image to create a thumbnail image, add the following code before the call to <code>$lob-&gt;savefile($imgfile)</code> in the <code><a id="sthref670"></a><a id="sthref671"></a>db_insert_thumbnail()</code> function:</p>
<pre>
$r = oci_execute($stmt, OCI_DEFAULT);
if (!$r) {
  $e = db_error($stid, __FILE__, __LINE__);
  return false;
}

<span class="bold">// Resize the image to a thumbnail</span>
<span class="bold">define('MAX_THUMBNAIL_DIMENSION', 100);</span>
<span class="bold">$src_img = imagecreatefromjpeg($imgfile);</span>
<span class="bold">list($w, $h) = getimagesize($imgfile);</span>
<span class="bold">if ($w &gt; MAX_THUMBNAIL_DIMENSION || $h &gt; MAX_THUMBNAIL_DIMENSION)</span>
<span class="bold">{</span>
<span class="bold">  $scale =  MAX_THUMBNAIL_DIMENSION / (($h &gt; $w) ? $h : $w);</span>
<span class="bold">  $nw = $w * $scale;</span>
<span class="bold">  $nh = $h * $scale;</span>

<span class="bold">  $dest_img = imagecreatetruecolor($nw, $nh);</span>
<span class="bold">  imagecopyresampled($dest_img, $src_img, 0, 0, 0, 0, $nw, $nh, $w, $h);</span>

<span class="bold">  imagejpeg($dest_img, $imgfile);  // overwrite file with new thumbnail</span>

<span class="bold">  imagedestroy($src_img);</span>
<span class="bold">  imagedestroy($dest_img);</span>
<span class="bold">}</span>

if (!$lob-&gt;savefile($imgfile)) {
...
</pre>
<p>The <a id="sthref672"></a><a id="sthref673"></a><code>imagecreatefromjpeg()</code> function reads the <a id="sthref674"></a><a id="sthref675"></a>JPEG file and creates an internal representation used by subsequent GD functions. Next, new dimensions are calculated with the longest side no larger than 100 pixels. A template image with the new size is created using the <a id="sthref676"></a><a id="sthref677"></a><code>imagecreatetruecolor()</code> function. Data from the original image is sampled into it with the <a id="sthref678"></a><a id="sthref679"></a><code>imagecopyresampled()</code> function to create the thumbnail image. The thumbnail image is written back to the original file and the internal representations of the images are freed.</p>
<p>The existing code in the <a id="sthref680"></a><a id="sthref681"></a><code>db_insert_thumbnail()</code> function uploads the image file to the database as it did in the previous implementation.</p>
</li>
<li>
<p>Enter the following URL in your browser to <a id="sthref682"></a><a id="sthref683"></a>test the changes in your application:</p>
<p>On Windows:</p>
<pre>
http://localhost/chap7/anyco.php
</pre>
<p>On Linux:</p>
<pre>
http://localhost/~&lt;username&gt;/chap7/anyco.php
</pre></li>
<li>
<p>In the Departments page, navigate to the Employees page by clicking <span class="bold">Show Employees</span>:</p>
<img width="613" height="242" src="img/chap7_loadimg_018.gif" alt="Description of chap7_loadimg_018.gif follows" title="Description of chap7_loadimg_018.gif follows" /><br />
<a id="sthref684" href="img_text/chap7_loadimg_018.htm">Description of the illustration chap7_loadimg_018.gif</a><br />
<br /></li>
<li>
<p>In the Employees page, to insert a new employee record, click <span class="bold">Insert new employee</span>:</p>
<img width="619" height="480" src="img/chap7_loadimg_019.gif" alt="Description of chap7_loadimg_019.gif follows" title="Description of chap7_loadimg_019.gif follows" /><br />
<a id="sthref685" href="img_text/chap7_loadimg_019.htm">Description of the illustration chap7_loadimg_019.gif</a><br />
<br /></li>
<li>
<p>Enter the new employee details or use the values shown. To browse for an employee image, click <span class="bold">Browse</span>:</p>
<img width="614" height="460" src="img/chap7_loadimg_020.gif" alt="Description of chap7_loadimg_020.gif follows" title="Description of chap7_loadimg_020.gif follows" /><br />
<a id="sthref686" href="img_text/chap7_loadimg_020.htm">Description of the illustration chap7_loadimg_020.gif</a><br />
<br /></li>
<li>
<p>Locate and select a JPEG image with a size larger than 100 pixels, and click <span class="bold">Open</span>:</p>
<img width="634" height="451" src="img/chap7_loadimg_021.gif" alt="Description of chap7_loadimg_021.gif follows" title="Description of chap7_loadimg_021.gif follows" /><br />
<a id="sthref687" href="img_text/chap7_loadimg_021.htm">Description of the illustration chap7_loadimg_021.gif</a><br />
<br /></li>
<li>
<p>In the Insert New Image page, click <span class="bold">Save</span>:</p>
<img width="612" height="460" src="img/chap7_loadimg_022.gif" alt="Description of chap7_loadimg_022.gif follows" title="Description of chap7_loadimg_022.gif follows" /><br />
<a id="sthref688" href="img_text/chap7_loadimg_022.htm">Description of the illustration chap7_loadimg_022.gif</a><br />
<br />
<p>The Employees page shows the new uploaded JPEG image with a reduced image size, compared to the image loaded before including the image resize code:</p>
<img width="726" height="553" src="img/chap7_loadimg_023.gif" alt="Description of chap7_loadimg_023.gif follows" title="Description of chap7_loadimg_023.gif follows" /><br />
<a id="sthref689" href="img_text/chap7_loadimg_023.htm">Description of the illustration chap7_loadimg_023.gif</a><br />
<br /></li>
</ol>
</div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment943">
<tr>
<td class="cellalignment950">
<table class="cellalignment948">
<tr>
<td class="cellalignment947"><a href="ch_six.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment947"><a href="ch_eight.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2009,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment952">
<table class="cellalignment946">
<tr>
<td class="cellalignment947"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment947"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment947"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment947"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment947"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment947"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
