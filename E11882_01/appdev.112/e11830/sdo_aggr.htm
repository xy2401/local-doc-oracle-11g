<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Spatial Aggregate Functions</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 743" />
<meta name="description" content="Provides usage and reference information for indexing and storing spatial data and for developing spatial applications using Oracle Spatial and Graph and Oracle Locator." />
<meta name="dcterms.created" content="2013-11-26T3:11:46Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Spatial Developer's Guide" />
<meta name="dcterms.identifier" content="E11830-15" />
<meta name="dcterms.isVersionOf" content="SPATL" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="sdo_operat.htm" title="Previous" type="text/html" />
<link rel="Next" href="sdo_cs_ref.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e11830.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">30/51</span> <!-- End Header -->
<div id="SPATL130" class="chapter"><a id="g998149"></a>
<h1 class="chapter"><span class="secnum">20</span> Spatial <a id="sthref1229"></a><a id="sthref1230"></a>Aggregate Functions</h1>
<p>This chapter contains reference and usage information for the spatial aggregate functions, which are listed in <a href="#BABEJJBA">Table 20-1</a>.</p>
<div id="SPATL1042" class="tblformal">
<p class="titleintable"><a id="sthref1231"></a><a id="BABEJJBA"></a>Table 20-1 Spatial Aggregate Functions</p>
<table class="cellalignment740" title="Spatial Aggregate Functions" summary="Spatial Aggregate Functions" dir="ltr">
<thead>
<tr class="cellalignment734">
<th class="cellalignment741" id="r1c1-t2">Method</th>
<th class="cellalignment741" id="r1c2-t2">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment734">
<td class="cellalignment742" id="r2c1-t2" headers="r1c1-t2">
<p><a href="#BABFBFIA">SDO_AGGR_CENTROID</a></p>
</td>
<td class="cellalignment742" headers="r2c1-t2 r1c2-t2">
<p>Returns a geometry object that is the centroid ("center of gravity") of the specified geometry objects.</p>
</td>
</tr>
<tr class="cellalignment734">
<td class="cellalignment742" id="r3c1-t2" headers="r1c1-t2">
<p><a href="#CFAECIDC">SDO_AGGR_CONCAT_LINES</a></p>
</td>
<td class="cellalignment742" headers="r3c1-t2 r1c2-t2">
<p>Returns a geometry that concatenates the specified line or multiline geometries.</p>
</td>
</tr>
<tr class="cellalignment734">
<td class="cellalignment742" id="r4c1-t2" headers="r1c1-t2">
<p><a href="#i867365">SDO_AGGR_CONVEXHULL</a></p>
</td>
<td class="cellalignment742" headers="r4c1-t2 r1c2-t2">
<p>Returns a geometry object that is the convex hull of the specified geometry objects.</p>
</td>
</tr>
<tr class="cellalignment734">
<td class="cellalignment742" id="r5c1-t2" headers="r1c1-t2">
<p><a href="#i866716">SDO_AGGR_LRS_CONCAT</a></p>
</td>
<td class="cellalignment742" headers="r5c1-t2 r1c2-t2">
<p>Returns an LRS geometry object that concatenates specified LRS geometry objects.</p>
</td>
</tr>
<tr class="cellalignment734">
<td class="cellalignment742" id="r6c1-t2" headers="r1c1-t2">
<p><a href="#i867160">SDO_AGGR_MBR</a></p>
</td>
<td class="cellalignment742" headers="r6c1-t2 r1c2-t2">
<p>Returns the minimum bounding rectangle of the specified geometries.</p>
</td>
</tr>
<tr class="cellalignment734">
<td class="cellalignment742" id="r7c1-t2" headers="r1c1-t2">
<p><a href="#CFAFGDHB">SDO_AGGR_SET_UNION</a></p>
</td>
<td class="cellalignment742" headers="r7c1-t2 r1c2-t2">
<p>Takes a VARRAY of SDO_GEOMETRY objects as input, and returns the aggregate union of all geometry objects in the array.</p>
</td>
</tr>
<tr class="cellalignment734">
<td class="cellalignment742" id="r8c1-t2" headers="r1c1-t2">
<p><a href="#i867161">SDO_AGGR_UNION</a></p>
</td>
<td class="cellalignment742" headers="r8c1-t2 r1c2-t2">
<p>Returns a geometry object that is the topological union (<span class="italic">OR</span> operation) of the specified geometry objects.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p>See the usage information about spatial aggregate functions in <a href="sdo_intro.htm#i883627">Section 1.10</a>.</p>
<p>Most of these aggregate functions accept a parameter of type SDOAGGRTYPE, which is described in <a href="sdo_intro.htm#i885389">Section 1.10.1</a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Spatial aggregate functions are supported for two-dimensional geometries only, except for <a href="#i867160">SDO_AGGR_MBR</a>, which is supported for both two-dimensional and three-dimensional geometries.</div>
<div class="refentry"><a id="BABFBFIA"></a>
<div id="SPATL1043" class="refsect1">
<h2 class="refsect1"><a id="sthref1232"></a><a id="sthref1233"></a><a id="sthref1234"></a>SDO_AGGR_CENTROID</h2>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1235"></a>Format</p>
<p class="synopsis">SDO_AGGR_CENTROID(</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AggregateGeometry SDOAGGRTYPE</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) RETURN SDO_GEOMETRY;</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1236"></a>Description</p>
<p>Returns a geometry object that is the centroid ("center of gravity") of the specified geometry objects.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1237"></a>Parameters</p>
<dl>
<dt>AggregateGeometry</dt>
<dd>
<p>An object of type SDOAGGRTYPE (see <a href="sdo_intro.htm#i885389">Section 1.10.1</a>) that specifies the geometry column and dimensional array.</p>
</dd>
</dl>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1238"></a>Usage Notes</p>
<p>The behavior of the function depends on whether the geometry objects are all polygons, all points, or a mixture of polygons and points:</p>
<ul>
<li>
<p>If the geometry objects are all polygons, the centroid of all the objects is returned.</p>
</li>
<li>
<p>If the geometry objects are all points, the centroid of all the objects is returned.</p>
</li>
<li>
<p>If the geometry objects are a mixture of polygons and points (specifically, if they include at least one polygon and at least one point), any points are ignored, and the centroid of all the polygons is returned.</p>
</li>
</ul>
<p>The result is weighted by the area of each polygon in the geometry objects. If the geometry objects are a mixture of polygons and points, the points are not used in the calculation of the centroid. If the geometry objects are all points, the points have equal weight.</p>
<p>See also the information about the <a href="sdo_objgeom.htm#i860848">SDO_GEOM.SDO_CENTROID</a> function in <a href="sdo_objgeom.htm#BGHCIGBI">Chapter 24</a>.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1239"></a>Examples</p>
<p>The following example returns the centroid of the geometry objects in the COLA_MARKETS table. (The example uses the definitions and data from <a href="sdo_objrelschema.htm#i1004750">Section 2.1</a>.)</p>
<pre>
SELECT SDO_AGGR_CENTROID(SDOAGGRTYPE(shape, 0.005))
  FROM cola_markets;

SDO_AGGR_CENTROID(SDOAGGRTYPE(SHAPE,0.005))(SDO_GTYPE, SDO_SRID, SDO_POINT
--------------------------------------------------------------------------------
SDO_GEOMETRY(2001, NULL, SDO_POINT_TYPE(5.21295938, 5.00744233, NULL), NULL, NUL
L)
</pre></div>
<!-- class="refsubsect" --></div>
<!-- class="refsect1" -->
<a id="CFAECIDC"></a>
<div id="SPATL1044" class="refsect1">
<h2 class="refsect1"><a id="sthref1240"></a><a id="sthref1241"></a><a id="sthref1242"></a>SDO_AGGR_CONCAT_LINES</h2>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1243"></a>Format</p>
<p class="synopsis">SDO_AGGR_CONCAT_LINES(</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;geom SDO_GEOMETRY</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) RETURN SDO_GEOMETRY;</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1244"></a>Description</p>
<p>Returns a geometry that concatenates the specified line or multiline geometries.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1245"></a>Parameters</p>
<dl>
<dt>geom</dt>
<dd>
<p>Geometry objects.</p>
</dd>
</dl>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1246"></a>Usage Notes</p>
<p>Each input geometry must be a two-dimensional line or multiline geometry (that is, the SDO_GTYPE value must be 2002 or 2006). This function is not supported for LRS geometries. To perform an aggregate concatenation of LRS geometric segments, use the <a href="#i866716">SDO_AGGR_LRS_CONCAT</a> spatial aggregate function.</p>
<p>The input geometries must be line strings whose vertices are connected by straight line segments. Circular arcs and compound line strings are not supported.</p>
<p>If any input geometry is a multiline geometry, the elements of the geometry must be disjoint. If they are not disjoint, this function may return incorrect results.</p>
<p>The topological relationship between the geometries in each pair of geometries to be concatenated must be DISJOINT or TOUCH; and if the relationship is TOUCH, the geometries must intersect only at two end points.</p>
<p>You can use the <a href="sdo_util.htm#BJEHFCFG">SDO_UTIL.CONCAT_LINES</a> function (described in <a href="sdo_util.htm#CEGCFDED">Chapter 32</a>) to concatenate two line or multiline geometries.</p>
<p>An exception is raised if any input geometries are not line or multiline geometries, or if not all input geometries are based on the same coordinate system.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1247"></a>Examples</p>
<p>The following example inserts two line geometries in the COLA_MARKETS table, and then returns the aggregate concatenation of these geometries. (The example uses the data definitions from <a href="sdo_objrelschema.htm#i1004750">Section 2.1</a>.)</p>
<pre>
-- First, insert two line geometries.
INSERT INTO cola_markets VALUES(1001, 'line_1', SDO_GEOMETRY(2002, NULL, NULL, 
  SDO_ELEM_INFO_ARRAY(1,2,1), SDO_ORDINATE_ARRAY(1,1, 5,1)));
INSERT INTO cola_markets VALUES(1002, 'line_2', SDO_GEOMETRY(2002, NULL, NULL, 
  SDO_ELEM_INFO_ARRAY(1,2,1), SDO_ORDINATE_ARRAY(5,1, 8,1)));
-- Perform aggregate concatenation of all line geometries in layer.
SELECT SDO_AGGR_CONCAT_LINES(c.shape) FROM cola_markets c
   WHERE c.mkt_id &gt; 1000;

SDO_AGGR_CONCAT_LINES(C.SHAPE)(SDO_GTYPE, SDO_SRID, SDO_POINT(X, Y, Z), SDO_ELEM
--------------------------------------------------------------------------------
SDO_GEOMETRY(2002, NULL, NULL, SDO_ELEM_INFO_ARRAY(1, 2, 1), SDO_ORDINATE_ARRAY(
1, 1, 5, 1, 8, 1)) 
</pre></div>
<!-- class="refsubsect" --></div>
<!-- class="refsect1" -->
<a id="i867365"></a>
<div id="SPATL1045" class="refsect1">
<h2 class="refsect1"><a id="sthref1248"></a><a id="sthref1249"></a><a id="sthref1250"></a>SDO_AGGR_CONVEXHULL</h2>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1251"></a>Format</p>
<p class="synopsis">SDO_AGGR_CONVEXHULL(</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AggregateGeometry SDOAGGRTYPE</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) RETURN SDO_GEOMETRY;</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1252"></a>Description</p>
<p>Returns a geometry object that is the convex hull of the specified geometry objects.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1253"></a>Parameters</p>
<dl>
<dt>AggregateGeometry</dt>
<dd>
<p>An object of type SDOAGGRTYPE (see <a href="sdo_intro.htm#i885389">Section 1.10.1</a>) that specifies the geometry column and dimensional array.</p>
</dd>
</dl>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1254"></a>Usage Notes</p>
<p>See also the information about the <a href="sdo_objgeom.htm#i857920">SDO_GEOM.SDO_CONVEXHULL</a> function in <a href="sdo_objgeom.htm#BGHCIGBI">Chapter 24</a>.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1255"></a>Examples</p>
<p>The following example returns the convex hull of the geometry objects in the COLA_MARKETS table. (The example uses the definitions and data from <a href="sdo_objrelschema.htm#i1004750">Section 2.1</a>.)</p>
<pre>
SELECT SDO_AGGR_CONVEXHULL(SDOAGGRTYPE(shape, 0.005))
  FROM cola_markets;

SDO_AGGR_CONVEXHULL(SDOAGGRTYPE(SHAPE,0.005))(SDO_GTYPE, SDO_SRID, SDO_POI
--------------------------------------------------------------------------------
SDO_GEOMETRY(2003, NULL, NULL, SDO_ELEM_INFO_ARRAY(1, 1003, 1), SDO_ORDINATE_ARR
AY(8, 1, 10, 7, 10, 11, 8, 11, 6, 11, 1, 7, 1, 1, 8, 1))
</pre></div>
<!-- class="refsubsect" --></div>
<!-- class="refsect1" -->
<a id="i866716"></a>
<div id="SPATL1046" class="refsect1">
<h2 class="refsect1"><a id="sthref1256"></a><a id="sthref1257"></a><a id="sthref1258"></a><a id="sthref1259"></a>SDO_AGGR_LRS_CONCAT</h2>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1260"></a>Format</p>
<p class="synopsis">SDO_AGGR_LRS_CONCAT(</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AggregateGeometry SDOAGGRTYPE</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) RETURN SDO_GEOMETRY;</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1261"></a>Description</p>
<p>Returns an LRS geometry that concatenates specified LRS geometries.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1262"></a>Parameters</p>
<dl>
<dt>AggregateGeometry</dt>
<dd>
<p>An object of type SDOAGGRTYPE (see <a href="sdo_intro.htm#i885389">Section 1.10.1</a>) that specifies the geometry column and dimensional array.</p>
</dd>
</dl>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1263"></a>Usage Notes</p>
<p>This function performs an aggregate concatenation of any number of LRS geometries. If you want to control the order in which the geometries are concatenated, you must use a subquery with the NO_MERGE optimizer hint and the ORDER BY clause. (See the examples.)</p>
<p>The direction of the resulting segment is the same as the direction of the first geometry in the concatenation.</p>
<p>A <span class="italic">3D</span> format of this function (SDO_AGGR_LRS_CONCAT_3D) is available. For information about <span class="italic">3D</span> formats of LRS functions, see <a href="sdo_lrs_concepts.htm#i890852">Section 7.4</a>.)</p>
<p>For information about the Spatial linear referencing system, see <a href="sdo_lrs_concepts.htm#BABIIFFH">Chapter 7</a>.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1264"></a>Examples</p>
<p>The following example adds an LRS geometry to the LRS_ROUTES table, and then performs two queries that concatenate the LRS geometries in the table. The first query does not control the order of concatenation, and the second query controls the order of concatenation. Notice the difference in direction of the two segments: the segment resulting from the second query has decreasing measure values because the first segment in the concatenation (<code>Route0</code>) has decreasing measure values. (This example uses the definitions from the example in <a href="sdo_lrs_concepts.htm#i885918">Section 7.7</a>.)</p>
<pre>
-- Add a segment with route_id less than 1 (here, zero).
INSERT INTO lrs_routes VALUES(
  0,
  'Route0',
  SDO_GEOMETRY(
    3302,  -- Line string; 3 dimensions (X,Y,M); 3rd is measure dimension.
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,2,1), -- One line string, straight segments
    SDO_ORDINATE_ARRAY(
      5,14,5,   -- Starting point - 5 is measure from start.
      10,14,0)  -- Ending point - 0 measure (decreasing measure)
  )
);

1 row created.

-- Concatenate all routes (no ordering specified).
SELECT SDO_AGGR_LRS_CONCAT(SDOAGGRTYPE(route_geometry, 0.005))
    FROM lrs_routes;

SDO_AGGR_LRS_CONCAT(SDOAGGRTYPE(ROUTE_GEOMETRY,0.005))(SDO_GTYPE, SDO_SRID
--------------------------------------------------------------------------------
SDO_GEOMETRY(3302, NULL, NULL, SDO_ELEM_INFO_ARRAY(1, 2, 1), SDO_ORDINATE_ARRAY(
2, 2, 0, 2, 4, 2, 8, 4, 8, 12, 4, 12, 12, 10, 18, 8, 10, 22, 5, 14, 27, 10, 14, 
32))

-- Aggregate concatenation using subquery for ordering.
SELECT 
SDO_AGGR_LRS_CONCAT(SDOAGGRTYPE(route_geometry, 0.005)) 
FROM ( 
             SELECT /*+ NO_MERGE */ route_geometry 
             FROM lrs_routes 
             ORDER BY route_id); 

SDO_AGGR_LRS_CONCAT(SDOAGGRTYPE(ROUTE_GEOMETRY,0.005))(SDO_GTYPE, SDO_SRID
--------------------------------------------------------------------------------
SDO_GEOMETRY(3302, NULL, NULL, SDO_ELEM_INFO_ARRAY(1, 2, 1), SDO_ORDINATE_ARRAY(
2, 2, 32, 2, 4, 30, 8, 4, 24, 12, 4, 20, 12, 10, 14, 8, 10, 10, 5, 14, 5, 10, 14
, 0))
</pre></div>
<!-- class="refsubsect" --></div>
<!-- class="refsect1" -->
<a id="i867160"></a>
<div id="SPATL1047" class="refsect1"><a id="g997489"></a>
<h2 class="refsect1"><a id="sthref1265"></a><a id="sthref1266"></a><a id="sthref1267"></a>SDO_AGGR_MBR</h2>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1268"></a>Format</p>
<p class="synopsis">SDO_AGGR_MBR(</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;geom SDO_GEOMETRY</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) RETURN SDO_GEOMETRY;</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1269"></a>Description</p>
<p>Returns the minimum bounding rectangle (MBR) of the specified geometries, that is, a single rectangle that minimally encloses the geometries.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1270"></a>Parameters</p>
<dl>
<dt>geom</dt>
<dd>
<p>Geometry objects.</p>
</dd>
</dl>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1271"></a>Usage Notes</p>
<p>This function does not return an MBR geometry if a proper MBR cannot be constructed. Specifically:</p>
<ul>
<li>
<p>If the input geometries are all null, the function returns a null geometry.</p>
</li>
<li>
<p>If all data in the input geometries is on a single point, the function returns the point.</p>
</li>
<li>
<p>If all data in the input geometries consists of points on a straight line, the function returns a two-point line.</p>
</li>
</ul>
<p>The <a href="sdo_objtune.htm#CACHEGED">SDO_TUNE.EXTENT_OF</a> function, documented in <a href="sdo_objtune.htm#g1000942">Chapter 31</a>, also returns the MBR of geometries. The <a href="sdo_objtune.htm#CACHEGED">SDO_TUNE.EXTENT_OF</a> function has better performance than the SDO_AGGR_MBR function if a spatial index is defined on the geometry column; however, the <a href="sdo_objtune.htm#CACHEGED">SDO_TUNE.EXTENT_OF</a> function is limited to two-dimensional geometries, whereas the SDO_AGGR_MBR function is not. In addition, the <a href="sdo_objtune.htm#CACHEGED">SDO_TUNE.EXTENT_OF</a> function computes the extent for all geometries in a table; by contrast, the SDO_AGGR_MBR function can operate on subsets of rows.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1272"></a>Examples</p>
<p>The following example returns the minimum bounding rectangle of the geometry objects in the COLA_MARKETS table. (The example uses the definitions and data from <a href="sdo_objrelschema.htm#i1004750">Section 2.1</a>.)</p>
<pre>
SELECT SDO_AGGR_MBR(shape) FROM cola_markets;

SDO_AGGR_MBR(C.SHAPE)(SDO_GTYPE, SDO_SRID, SDO_POINT(X, Y, Z), SDO_ELEM_INFO, SD
--------------------------------------------------------------------------------
SDO_GEOMETRY(2003, NULL, NULL, SDO_ELEM_INFO_ARRAY(1, 1003, 3), SDO_ORDINATE_ARR
AY(1, 1, 10, 11)) 
</pre></div>
<!-- class="refsubsect" --></div>
<!-- class="refsect1" -->
<a id="CFAFGDHB"></a>
<div id="SPATL1417" class="refsect1">
<h2 class="refsect1"><a id="sthref1273"></a><a id="sthref1274"></a>SDO_AGGR_SET_UNION</h2>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1275"></a>Format</p>
<p class="synopsis">SDO_AGGR_SET_UNION(</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;geometry SDO_GEOMETRY_ARRAY</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tol NUMBER</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) RETURN SDO_GEOMETRY;</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1276"></a>Description</p>
<p>Takes a VARRAY of SDO_GEOMETRY objects as input, and returns the aggregate union of all geometry objects in the array.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1277"></a>Parameters</p>
<dl>
<dt>geometry</dt>
<dd>
<p>An array of geometry objects of object type SDO_GEOMETRY_ARRAY, which is defined as <code>VARRAY OF SDO_GEOMETRY</code>.</p>
</dd>
<dt>tol</dt>
<dd>
<p>Tolerance value (see <a href="sdo_intro.htm#i884589">Section 1.5.5</a>).</p>
</dd>
</dl>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1278"></a>Usage Notes</p>
<p>SDO_AGGR_SET_UNION provides faster performance than SDO_AGG_UNION but less flexibility, and SDO_AGGR_SET_UNION should be considered when performance is especially important and when it satisfies your functional needs.</p>
<p>SDO_AGGR_UNION is a SQL aggregate function, and therefore it very flexible and can be used with complex SQL GROUP BY clauses. However, SDO_AGGR_SET_UNION can be much faster than SDO_AGGR_UNION. SDO_AGGR_SET_UNION is useful when the geometries to be grouped can easily be gathered into a collection (that is, a VARRAY of SDO_GEOMETRY objects).</p>
<p>SDO_AGGR_SET_UNION:</p>
<ul>
<li>
<p><span class="italic">Cannot</span> aggregate a set of <span class="italic">overlapping</span> polygons. For overlapping polygons, use SDO_AGGR_UNION.</p>
</li>
<li>
<p><span class="italic">Can</span> effectively aggregate a set of <span class="italic">non- overlapping</span> polygons, including polygons that touch.</p>
</li>
<li>
<p>Can aggregate sets of lines and points, even if they overlap.</p>
</li>
</ul>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1279"></a>Examples</p>
<p>The following example creates a generic routine to build a geometry set to pass to SDO_AGGR_SET_UNION. It takes as input a table name, column name, and optional predicate to apply, and returns an SDO_GEOMETRY_ARRAY ready to use with SDO_AGGR_SET_UNION. (The example uses the definitions and data from <a href="sdo_objrelschema.htm#i1004750">Section 2.1</a>.)</p>
<pre>
CREATE OR REPLACE FUNCTION get_geom_set (table_name  VARCHAR2,
                                         column_name VARCHAR2,
                                         predicate   VARCHAR2 := NULL)
  RETURN SDO_GEOMETRY_ARRAY DETERMINISTIC AS
 
  type            cursor_type is REF CURSOR;
  query_crs       cursor_type ;
  g               SDO_GEOMETRY;
  GeometryArr     SDO_GEOMETRY_ARRAY;
  where_clause    VARCHAR2(2000);
BEGIN
  IF predicate IS NULL
  THEN
    where_clause := NULL;
  ELSE
    where_clause := ' WHERE ';
  END IF;
 
  GeometryArr := SDO_GEOMETRY_ARRAY();
  OPEN query_crs FOR ' SELECT ' || column_name ||
                     ' FROM ' || table_name ||
                       where_clause || predicate;
   LOOP
    FETCH query_crs into g;
     EXIT when query_crs%NOTFOUND ;
     GeometryArr.extend;
     GeometryArr(GeometryArr.count) := g;
   END LOOP;
   RETURN GeometryArr;
END;
/
 
SELECT sdo_aggr_set_union (get_geom_set ('COLA_MARKETS', 'SHAPE',
   'name &lt;&gt; ''cola_c'''), .0005 ) FROM dual;
 
SDO_AGGR_SET_UNION(GET_GEOM_SET('COLA_MARKETS','SHAPE','NAME&lt;&gt;''COLA_C'''),.0005
--------------------------------------------------------------------------------
SDO_GEOMETRY(2007, NULL, NULL, SDO_ELEM_INFO_ARRAY(1, 1003, 2, 11, 1003, 1), SDO
_ORDINATE_ARRAY(8, 11, 6, 9, 8, 7, 10, 9, 8, 11, 1, 7, 1, 1, 5, 1, 8, 1, 8, 6, 5
, 7, 1, 7))
</pre></div>
<!-- class="refsubsect" --></div>
<!-- class="refsect1" -->
<a id="i867161"></a>
<div id="SPATL1048" class="refsect1">
<h2 class="refsect1"><a id="sthref1280"></a><a id="sthref1281"></a>SDO_AGGR_UNION</h2>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1282"></a>Format</p>
<p class="synopsis">SDO_AGGR_UNION(</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AggregateGeometry SDOAGGRTYPE</p>
<p class="synopsis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) RETURN SDO_GEOMETRY;</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1283"></a>Description</p>
<p>Returns a geometry object that is the topological union (OR operation) of the specified geometry objects.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1284"></a>Parameters</p>
<dl>
<dt>AggregateGeometry</dt>
<dd>
<p>An object of type SDOAGGRTYPE (see <a href="sdo_intro.htm#i885389">Section 1.10.1</a>) that specifies the geometry column and dimensional array.</p>
</dd>
</dl>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1285"></a>Usage Notes</p>
<p>Do not use SDO_AGGR_UNION to merge line string or multiline string geometries; instead, use the <a href="#CFAECIDC">SDO_AGGR_CONCAT_LINES</a> spatial aggregate function.</p>
<p>See also the information about the <a href="sdo_objgeom.htm#i857624">SDO_GEOM.SDO_UNION</a> function in <a href="sdo_objgeom.htm#BGHCIGBI">Chapter 24</a>.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref1286"></a>Examples</p>
<p>The following example returns the union of all geometries except <code>cola_d</code> (in this case, <code>cola_a</code>, <code>cola_b</code>, and <code>cola_c</code>). (The example uses the definitions and data from <a href="sdo_objrelschema.htm#i1004750">Section 2.1</a>.)</p>
<pre>
SELECT SDO_AGGR_UNION(
  SDOAGGRTYPE(c.shape, 0.005))
  FROM cola_markets c
  WHERE c.name &lt;&gt; 'cola_d';

SDO_AGGR_UNION(SDOAGGRTYPE(C.SHAPE,0.005))(SDO_GTYPE, SDO_SRID, SDO_POINT(
--------------------------------------------------------------------------------
SDO_GEOMETRY(2007, NULL, NULL, SDO_ELEM_INFO_ARRAY(1, 1003, 2, 11, 1003, 1), SDO
_ORDINATE_ARRAY(8, 11, 6, 9, 8, 7, 10, 9, 8, 11, 1, 7, 1, 1, 5, 1, 8, 1, 8, 6, 5
, 7, 1, 7))
</pre>
<p>See also the more complex SDO_AGGR_UNION example in <a href="sdo_complex_queries.htm#CIHGJGAA">Section C.4</a>.</p>
</div>
<!-- class="refsubsect" --></div>
<!-- class="refsect1" --></div>
<!-- class="refentry" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment733">
<tr>
<td class="cellalignment742">
<table class="cellalignment738">
<tr>
<td class="cellalignment737"><a href="sdo_operat.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment737"><a href="sdo_cs_ref.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment744">
<table class="cellalignment736">
<tr>
<td class="cellalignment737"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment737"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment737"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment737"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment737"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment737"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
