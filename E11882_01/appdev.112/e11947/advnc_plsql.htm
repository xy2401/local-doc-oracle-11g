<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Running Background PL/SQL</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 737" />
<meta name="dcterms.created" content="2013-07-29T17:38:52Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Application Express Application Builder User's Guide" />
<meta name="dcterms.identifier" content="E11947-03" />
<meta name="dcterms.isVersionOf" content="HTMDB" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="advnc_act_log.htm" title="Previous" type="text/html" />
<link rel="Next" href="advnc_web_services.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e11947.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">120/138</span> <!-- End Header --><a id="BABGHIFB"></a>
<div id="HTMDB13004" class="sect1"><!-- infolevel="all" infotype="General" -->
<h1 class="sect1">Running Background <a id="sthref2111"></a><a id="sthref2112"></a><a id="sthref2113"></a>PL/SQL</h1>
<p>You can use the <code>APEX_PLSQL_JOB</code> package to run PL/SQL code in the background of your application. This is an effective approach for managing long running operations that do not need to complete for a user to continue working with your application.</p>
<p>Topics in this section include:</p>
<ul>
<li>
<p><a href="#BABDDBAG">Understanding the APEX_PLSQL_JOB Package</a></p>
</li>
<li>
<p><a href="#BABEICBI">About System Status Updates</a></p>
</li>
<li>
<p><a href="#BABHIHBG">Using a Process to Implement Background PL/SQL</a></p>
</li>
</ul>
<a id="BABDDBAG"></a>
<div id="HTMDB25879" class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Understanding the APEX_PLSQL_JOB <a id="sthref2114"></a><a id="sthref2115"></a><a id="sthref2116"></a>Package</h2>
<p><code>APEX_PLSQL_JOB</code> is a wrapper package around <code>DBMS_JOB</code> functionality offered in the Oracle database. Note that the <code>APEX_PLSQL_JOB</code> package only exposes that functionality which is necessary to run PL/SQL in the background. The following is a description of the <code>APEX_PLSQL_JOB</code> package:</p>
<pre>
SQL&gt; DESC APEX_PLSQL_JOB
FUNCTION JOBS_ARE_ENABLED RETURNS BOOLEAN
PROCEDURE PURGE_PROCESS
 Argument Name                  Type                    In/Out Default?
 ------------------------------ ----------------------- ------ --------
 P_JOB                          NUMBER                  IN
FUNCTION SUBMIT_PROCESS RETURNS NUMBER
 Argument Name                  Type                    In/Out Default?
 ------------------------------ ----------------------- ------ --------
 P_SQL                          VARCHAR2                IN
 P_WHEN                         VARCHAR2                IN     DEFAULT
 P_STATUS                       VARCHAR2                IN     DEFAULT
FUNCTION TIME_ELAPSED RETURNS NUMBER
 Argument Name                  Type                    In/Out Default?
 ------------------------------ ----------------------- ------ --------
 P_JOB                          NUMBER                  IN
PROCEDURE UPDATE_JOB_STATUS
 Argument Name                  Type                    In/Out Default?
 ------------------------------ ----------------------- ------ --------
 P_JOB                          NUMBER                  IN
 P_STATUS                       VARCHAR2                IN                         
</pre>
<p><a href="advnc_collections.htm#BABDFCEE">Table 15-1</a> describes the functions available in the <code>APEX_PLSQL_JOB</code> package.</p>
<div id="HTMDB26269" class="tblformal">
<p class="titleintable"><a id="sthref2117"></a><a id="sthref2118"></a>Table 15-3 APEX_PLSQL_JOB Package: Available Functions</p>
<table class="cellalignment725" title="APEX_PLSQL_JOB Package: Available Functions" summary="This table describes the functions available in the HTMLDB_PLSQL_JOBS package." dir="ltr">
<thead>
<tr class="cellalignment719">
<th class="cellalignment726" id="r1c1-t17">Function or Procedure</th>
<th class="cellalignment726" id="r1c2-t17">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment719">
<td class="cellalignment727" id="r2c1-t17" headers="r1c1-t17">
<p><code>SUBMIT_PROCESS</code></p>
</td>
<td class="cellalignment727" headers="r2c1-t17 r1c2-t17">
<p>Use this procedure to submit background PL/SQL. This procedure returns a unique job number. Because you can use this job number as a reference point for other procedures and functions in this package, it may be useful to store it in your own schema.</p>
</td>
</tr>
<tr class="cellalignment719">
<td class="cellalignment727" id="r3c1-t17" headers="r1c1-t17">
<p><code>UPDATE_JOB_STATUS</code></p>
</td>
<td class="cellalignment727" headers="r3c1-t17 r1c2-t17">
<p>Call this procedure to update the status of the currently running job. This procedure is most effective when called from the submitted PL/SQL.</p>
</td>
</tr>
<tr class="cellalignment719">
<td class="cellalignment727" id="r4c1-t17" headers="r1c1-t17">
<p><code>TIME_ELAPSED</code></p>
</td>
<td class="cellalignment727" headers="r4c1-t17 r1c2-t17">
<p>Use this function to determine how much time has elapsed since the job was submitted.</p>
</td>
</tr>
<tr class="cellalignment719">
<td class="cellalignment727" id="r5c1-t17" headers="r1c1-t17">
<p><code>JOBS_ARE_ENABLED</code></p>
</td>
<td class="cellalignment727" headers="r5c1-t17 r1c2-t17">
<p>Call this function to determine whether the database is currently in a mode that supports submitting jobs to the <code>APEX_PLSQL_JOB</code> package.</p>
</td>
</tr>
<tr class="cellalignment719">
<td class="cellalignment727" id="r6c1-t17" headers="r1c1-t17">
<p><code>PURGE_PROCESS</code></p>
</td>
<td class="cellalignment727" headers="r6c1-t17 r1c2-t17">
<p>Call this procedure to clean up submitted jobs. Submitted jobs stay in the <code>APEX_PLSQL_JOBS</code> view until either Oracle Application Express cleans out those records, or you call <code>PURGE_PROCESS</code> to manually remove them.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p>You can view all jobs submitted to the <code>APEX_PLSQL_JOB</code> package using the <code>APEX_PLSQL_JOBS</code> view. The following is the description of <code>APEX_PLSQL_JOBS</code> view:</p>
<pre>
SQL&gt; DESCRIBE APEX_PLSQL_JOBS
 Name                              Null?    Type
 --------------------------------- -------- ----------------------------
 ID                                         NUMBER
 JOB                                        NUMBER
 FLOW_ID                                    NUMBER
 OWNER                                      VARCHAR2(30)
 ENDUSER                                    VARCHAR2(30)
 CREATED                                    DATE
 MODIFIED                                   DATE
 STATUS                                     VARCHAR2(100)
 SYSTEM_STATUS                              VARCHAR2(4000)
 SYSTEM_MODIFIED                            DATE
 SECURITY_GROUP_ID                          NUMBER
</pre>
<p><a href="#BABFDCAH">Table 15-4</a> describes the columns available in <code>APEX_PLSQL_JOBS</code> view.</p>
<div id="HTMDB26270" class="tblformal">
<p class="titleintable"><a id="sthref2119"></a><a id="BABFDCAH"></a>Table 15-4 APEX_PLSQL_JOBS View Columns</p>
<table class="cellalignment725" title="APEX_PLSQL_JOBS View Columns" summary="This table describes the parameters available in HTMLDB_PLSQL_JOBS view." dir="ltr">
<thead>
<tr class="cellalignment719">
<th class="cellalignment726" id="r1c1-t18">Name</th>
<th class="cellalignment726" id="r1c2-t18">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment719">
<td class="cellalignment727" id="r2c1-t18" headers="r1c1-t18">
<p><code>ID</code></p>
</td>
<td class="cellalignment727" headers="r2c1-t18 r1c2-t18">
<p>A unique identifier for each row.</p>
</td>
</tr>
<tr class="cellalignment719">
<td class="cellalignment727" id="r3c1-t18" headers="r1c1-t18">
<p><code>JOB</code></p>
</td>
<td class="cellalignment727" headers="r3c1-t18 r1c2-t18">
<p>The job number assigned to each submitted PL/SQL job. The <code>APEX_PLSQL_JOB.SUBMIT_PROCESS</code> function returns this value. This is also the value you pass into other procedures and functions in the <code>APEX_PLSQL_JOB</code> package.</p>
</td>
</tr>
<tr class="cellalignment719">
<td class="cellalignment727" id="r4c1-t18" headers="r1c1-t18">
<p><code>FLOW_ID</code></p>
</td>
<td class="cellalignment727" headers="r4c1-t18 r1c2-t18">
<p>The application from which this job was submitted.</p>
</td>
</tr>
<tr class="cellalignment719">
<td class="cellalignment727" id="r5c1-t18" headers="r1c1-t18">
<p><code>OWNER</code></p>
</td>
<td class="cellalignment727" headers="r5c1-t18 r1c2-t18">
<p>The database schema that owns the application. This identifies what schema will parse this code when <code>DBMS_JOB</code> runs it.</p>
</td>
</tr>
<tr class="cellalignment719">
<td class="cellalignment727" id="r6c1-t18" headers="r1c1-t18">
<p><code>ENDUSER</code></p>
</td>
<td class="cellalignment727" headers="r6c1-t18 r1c2-t18">
<p>The end user (that is, who logged into the application) that caused this process to be submitted.</p>
</td>
</tr>
<tr class="cellalignment719">
<td class="cellalignment727" id="r7c1-t18" headers="r1c1-t18">
<p><code>CREATED</code></p>
</td>
<td class="cellalignment727" headers="r7c1-t18 r1c2-t18">
<p>The date when the job was submitted.</p>
</td>
</tr>
<tr class="cellalignment719">
<td class="cellalignment727" id="r8c1-t18" headers="r1c1-t18">
<p><code>MODIFIED</code></p>
</td>
<td class="cellalignment727" headers="r8c1-t18 r1c2-t18">
<p>The date when the status was modified.</p>
</td>
</tr>
<tr class="cellalignment719">
<td class="cellalignment727" id="r9c1-t18" headers="r1c1-t18">
<p><code>STATUS</code></p>
</td>
<td class="cellalignment727" headers="r9c1-t18 r1c2-t18">
<p>The user-defined status for this job. Calling <code>APEX_PLSQL_JOB.UPDATE_JOB_STATUS</code> updates this column.</p>
</td>
</tr>
<tr class="cellalignment719">
<td class="cellalignment727" id="r10c1-t18" headers="r1c1-t18">
<p><code>SYSTEM_STATUS</code></p>
</td>
<td class="cellalignment727" headers="r10c1-t18 r1c2-t18">
<p>The system defined status for this job.</p>
</td>
</tr>
<tr class="cellalignment719">
<td class="cellalignment727" id="r11c1-t18" headers="r1c1-t18">
<p><code>SYSTEM_MODIFIED</code></p>
</td>
<td class="cellalignment727" headers="r11c1-t18 r1c2-t18">
<p>The date when the system status was modified.</p>
</td>
</tr>
<tr class="cellalignment719">
<td class="cellalignment727" id="r12c1-t18" headers="r1c1-t18">
<p><code>SECURITY_GROUP_ID</code></p>
</td>
<td class="cellalignment727" headers="r12c1-t18 r1c2-t18">
<p>The unique ID assigned to your workspace. Developers can only see jobs submitted from their own workspace.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
APEX_PLSQL_JOBS in <a class="olink AEAPI353" href="../../appdev.112/e12510/apex_plsql_job.htm#AEAPI353"><span class="italic">Oracle Application Express API Reference</span></a></div>
</div>
<!-- class="sect2" -->
<a id="BABEICBI"></a>
<div id="HTMDB25880" class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">About System Status Updates</h2>
<p>Submitted jobs can contain any of the following system status settings:</p>
<ul>
<li>
<p><span class="bold">SUBMITTED</span> indicates the job has been submitted, but has not yet started. The DBMS_JOB does not guarantee immediate starting of jobs.</p>
</li>
<li>
<p><span class="bold">IN PROGRESS</span> indicates that the <code>DBMS_JOB</code> has started the process.</p>
</li>
<li>
<p><span class="bold">COMPLETED</span> indicates the job has finished.</p>
</li>
<li>
<p><span class="bold">BROKEN (sqlcode) sqlerrm</span> indicates there was a problem in your job that resulted in an error. The SQL code and SQL error message for the error should be included in the system status. Review this information to determine what went wrong.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="BABHIHBG"></a>
<div id="HTMDB25881" class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Using a Process to Implement Background <a id="sthref2120"></a><a id="sthref2121"></a>PL/SQL</h2>
<p>The following example runs a PL/SQL job in the background for testing and explanation:</p>
<pre>
001  BEGIN
002    FOR i IN 1 .. 100 LOOP
003      INSERT INTO emp(a,b) VALUES (:APP_JOB,i);
004      IF MOD(i,10) = 0 THEN
005        APEX_PLSQL_JOB.UPDATE_JOB_STATUS(
006          P_JOB     =&gt; :APP_JOB,
007          P_STATUS  =&gt; i || 'rows inserted');
008      END IF;
009      APEX_UTIL.PAUSE(2);
010    END LOOP;
011  END;
</pre>
<p>In this example, note that:</p>
<ul>
<li>
<p>Lines 002 to 010 run a loop that inserts 100 records into the <code>emp</code> table.</p>
</li>
<li>
<p><code>APP_JOB</code> is referenced as a bind variable inside the VALUES clause of the INSERT, and specified as the <code>P_JOB</code> parameter value in the call to <code>UPDATE_JOB_STATUS</code>.</p>
</li>
<li>
<p><code>APP_JOB</code> represents the job number which will be assigned to this process as it is submitted to <code>APEX_PLSQL_JOB</code>. By specifying this reserved item inside your process code, it will be replaced for you at execution time with the actual job number.</p>
</li>
<li>
<p>Note that this example calls to <code>UPDATE_JOB_STATUS</code> every ten records, INSIDE the block of code. Normally, Oracle transaction rules dictate updates made inside code blocks will not be seen until the entire transaction is committed. The <code>APEX_PLSQL_JOB.UPDATE_JOB_STATUS</code> procedure, however, has been implemented in such a way that the update will happen regardless of whether the job succeeds or fails. This last point is important for two reasons:</p>
<ol>
<li>
<p>Even if your status shows "100 rows inserted," it does not mean the entire operation was successful. If an error occurred at the time the block of code tried to commit, the <code>user_status</code> column of <code>APEX_PLSQL_JOBS</code> would not be affected because status updates are committed separately.</p>
</li>
<li>
<p>Updates are performed autonomously. You can view the job status before the job has completed. This gives you the ability to display status text about ongoing operations in the background as they are happening.</p>
</li>
</ol>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment718">
<tr>
<td class="cellalignment727">
<table class="cellalignment723">
<tr>
<td class="cellalignment722"><a href="advnc_act_log.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment722"><a href="advnc_web_services.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment729">
<table class="cellalignment721">
<tr>
<td class="cellalignment722"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment722"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment722"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment722"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment722"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment722"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
