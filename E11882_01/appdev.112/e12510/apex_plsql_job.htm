<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>APEX_PLSQL_JOB</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 736" />
<meta name="dcterms.created" content="2013-08-06T16:48:13Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Application Express API Reference" />
<meta name="dcterms.identifier" content="E12510-02" />
<meta name="dcterms.isVersionOf" content="AEAPI" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Prev" href="javascript_api.htm" title="Previous" type="text/html" />
<link rel="Next" href="apex_lang.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e12510.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">13/14</span> <!-- End Header -->
<div id="AEAPI353" class="chapter"><a id="BGBFGBIB"></a>
<h1 class="chapter"><span class="secnum">10</span> APEX_PLSQL_JOB</h1>
<p>You can use <code>APEX_PLSQL_JOB</code> package to run PL/SQL code in the background of your application. This is an effective approach for managing long running operations that do not need to complete for a user to continue working with your application.</p>
<p>Topics in this section include:</p>
<ul>
<li>
<p><a href="#BGBJBCFG">JOBS_ARE_ENABLED Function</a></p>
</li>
<li>
<p><a href="#BGBHCDDF">PURGE_PROCESS Procedure</a></p>
</li>
<li>
<p><a href="#BGBCJIJI">SUBMIT_PROCESS Function</a></p>
</li>
<li>
<p><a href="#BGBEDIFI">TIME_ELAPSED Function</a></p>
</li>
<li>
<p><a href="#BGBHHCHH">UPDATE_JOB_STATUS Procedure</a></p>
</li>
</ul>
<div class="refentry"><a id="BGBJBCFG"></a>
<hr />
<div id="AEAPI1177" class="refsect1">
<h2 class="refsect1">JOBS_ARE_ENABLED Function</h2>
<p>Call this function to determine whether or not the database is currently in a mode that supports submitting jobs to the APEX_PLSQL_JOB package.</p>
<p class="subhead2"><a id="AEAPI1178"></a>Syntax</p>
<pre>
APEX_PLSQL_JOB.JOBS_ARE_ENABLED
RETURN BOOLEAN;
</pre>
<p class="subhead2"><a id="AEAPI1179"></a>Parameters</p>
<p>None.</p>
<p class="subhead2"><a id="AEAPI1180"></a>Example</p>
<p>The following example shows how to use the <code>JOBS_ARE_ENABLED</code> function. In the example, if the function returns <code>TRUE</code> the message 'Jobs are enabled on this database instance' is displayed, otherwise the message 'Jobs are not enabled on this database instance' is displayed.</p>
<pre>
BEGIN
    IF APEX_PLSQL_JOB.JOBS_ARE_ENABLED THEN
        HTP.P('Jobs are enabled on this database instance.');
    ELSE
        HTP.P('Jobs are not enabled on this database instance.');
    END IF;
END;
</pre></div>
<!-- class="refsect1" -->
<a id="BGBHCDDF"></a>
<hr />
<div id="AEAPI1181" class="refsect1">
<h2 class="refsect1">PURGE_PROCESS Procedure</h2>
<p>Call this procedure to clean up submitted jobs. Submitted jobs stay in the <code>APEX_PLSQL_JOBS</code> view until either Oracle Application Express cleans out those records, or you call <code>PURGE_PROCESS</code> to manually remove them.</p>
<p class="subhead2"><a id="AEAPI1182"></a>Syntax</p>
<pre>
APEX_PLSQL_JOB.PURGE_PROCESS (
    p_job IN NUMBER);
</pre>
<p class="subhead2"><a id="AEAPI1183"></a>Parameters</p>
<p><a href="#BGBDBHFJ">Table 10-1</a> describes the parameters available in the <code>PURGE_PROCESS</code> procedure.</p>
<div id="AEAPI1184" class="tblformal">
<p class="titleintable"><a id="sthref151"></a><a id="BGBDBHFJ"></a>Table 10-1 PURGE_PROCESS Parameters</p>
<table class="cellalignment965" title="PURGE_PROCESS Parameters" summary="This table describes the parameters available in the REMOVE_PREFERENCE procedure." dir="ltr">
<thead>
<tr class="cellalignment959">
<th class="cellalignment966" id="r1c1-t2">Parameter</th>
<th class="cellalignment966" id="r1c2-t2">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment959">
<td class="cellalignment967" id="r2c1-t2" headers="r1c1-t2">
<p><code>p_job</code></p>
</td>
<td class="cellalignment967" headers="r2c1-t2 r1c2-t2">
<p>The job number that identifies the submitted job you wish to purge.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p class="subhead2"><a id="AEAPI1185"></a>Example</p>
<p>The following example shows how to use the <code>PURGE_PROCESS</code> procedure to purge the submitted job identified by a job number of 161. You could also choose to purge all or some of the current submitted jobs by referencing the <code>APEX_PLSQL_JOBS</code> view.</p>
<pre>
BEGIN
    APEX_PLSQL_JOB.PURGE_PROCESS(
        p_job =&gt; 161);
END;
</pre></div>
<!-- class="refsect1" -->
<a id="BGBCJIJI"></a>
<hr />
<div id="AEAPI1186" class="refsect1">
<h2 class="refsect1">SUBMIT_PROCESS Function</h2>
<p>Use this procedure to submit background PL/SQL. This procedure returns a unique job number. Because you can use this job number as a reference point for other procedures and functions in this package, it may be useful to store it in your own schema.</p>
<p class="subhead2"><a id="AEAPI1187"></a>Syntax</p>
<pre>
APEX_PLSQL_JOB.SUBMIT_PROCESS (
    p_sql IN VARCHAR2,
    p_when IN DATE DEFAULT SYSDATE,
    p_status IN VARCHAR2 DEFAULT 'PENDING')
RETURN NUMBER;
</pre>
<p class="subhead2"><a id="AEAPI1188"></a>Parameters</p>
<p><a href="#BGBGFHCE">Table 10-2</a> describes the parameters available in the <code>SUBMIT_PROCESS</code> function.</p>
<div id="AEAPI1189" class="tblformal">
<p class="titleintable"><a id="sthref152"></a><a id="BGBGFHCE"></a>Table 10-2 SUBMIT_PROCESS Parameters</p>
<table class="cellalignment965" title="SUBMIT_PROCESS Parameters" summary="This table describes the parameters available in the REMOVE_PREFERENCE procedure." dir="ltr">
<thead>
<tr class="cellalignment959">
<th class="cellalignment966" id="r1c1-t3">Parameter</th>
<th class="cellalignment966" id="r1c2-t3">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment959">
<td class="cellalignment967" id="r2c1-t3" headers="r1c1-t3">
<p><code>p_sql</code></p>
</td>
<td class="cellalignment967" headers="r2c1-t3 r1c2-t3">
<p>The process you wish to run in your job. This can be any valid anonymous block, for example:</p>
<pre>
'BEGIN &lt;your code&gt; END;'
or
'DECLARE &lt;your declaration&gt; 
BEGIN &lt;your code&gt; END;'
</pre></td>
</tr>
<tr class="cellalignment959">
<td class="cellalignment967" id="r3c1-t3" headers="r1c1-t3">
<p>p_when</p>
</td>
<td class="cellalignment967" headers="r3c1-t3 r1c2-t3">
<p>When you want to run it. The default is SYSDATE which means the job will run as soon as possible. You can also set the job to run in the future, for example:</p>
<p><code>sysdate + 1</code> - The job will run in 1 days time.</p>
<p><code>sysdate + (1/24)</code> - The job will run in 1 hours time.</p>
<p><code>sysdate + (10/24/60)</code> - The job will run in 10 minutes time.</p>
</td>
</tr>
<tr class="cellalignment959">
<td class="cellalignment967" id="r4c1-t3" headers="r1c1-t3">
<p>p_status</p>
</td>
<td class="cellalignment967" headers="r4c1-t3 r1c2-t3">
<p>Plain text status information for this job.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p class="subhead2"><a id="AEAPI1190"></a>Example</p>
<p>The following example shows how to use the <code>SUBMIT_PROCESS</code> function to submit a background process that will start as soon as possible.</p>
<pre>
DECLARE
    l_sql VARCHAR2(4000);
    l_job NUMBER;
BEGIN
    l_sql := 'BEGIN MY_PACKAGE.MY_PROCESS; END;';
    l_job := APEX_PLSQL_JOB.SUBMIT_PROCESS(
        p_sql =&gt; l_sql,
        p_status =&gt; 'Background process submitted');
    --store l_job for later reference
END;
</pre></div>
<!-- class="refsect1" -->
<a id="BGBEDIFI"></a>
<hr />
<div id="AEAPI1191" class="refsect1">
<h2 class="refsect1">TIME_ELAPSED Function</h2>
<p>Use this function to determine how much time has elapsed since the job was submitted.</p>
<p class="subhead2"><a id="AEAPI1192"></a>Syntax</p>
<pre>
APEX_PLSQL_JOB.TIME_ELAPSED(
    p_job IN NUMBER)
RETURN NUMBER;
</pre>
<p class="subhead2"><a id="AEAPI1193"></a>Parameters</p>
<p><a href="#BGBGIAEA">Table 10-3</a> describes the parameters available in the <code>TIME_ELAPSED</code> function.</p>
<div id="AEAPI1194" class="tblformal">
<p class="titleintable"><a id="sthref153"></a><a id="BGBGIAEA"></a>Table 10-3 TIME_ELAPSED Parameters</p>
<table class="cellalignment965" title="TIME_ELAPSED Parameters" summary="This table describes the parameters available in the REMOVE_PREFERENCE procedure." dir="ltr">
<thead>
<tr class="cellalignment959">
<th class="cellalignment966" id="r1c1-t4">Parameter</th>
<th class="cellalignment966" id="r1c2-t4">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment959">
<td class="cellalignment967" id="r2c1-t4" headers="r1c1-t4">
<p><code>p_job</code></p>
</td>
<td class="cellalignment967" headers="r2c1-t4 r1c2-t4">
<p>The job ID for the job you wish to see how long since it was submitted.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p class="subhead2"><a id="AEAPI1195"></a>Example</p>
<p>The following example shows how to use the <code>TIME_ELAPSED</code> function to get the time elapsed for the submitted job identified by the job number 161.</p>
<pre>
DECLARE
    l_time NUMBER;
BEGIN
    l_time := APEX_PLSQL_JOB.TIME_ELAPSED(p_job =&gt; 161);
END;
</pre></div>
<!-- class="refsect1" -->
<a id="BGBHHCHH"></a>
<hr />
<div id="AEAPI1196" class="refsect1">
<h2 class="refsect1">UPDATE_JOB_STATUS Procedure</h2>
<p>Call this procedure to update the status of the currently running job. This procedure is most effective when called from the submitted PL/SQL.</p>
<p class="subhead2"><a id="AEAPI1197"></a>Syntax</p>
<pre>
APEX_PLSQL_JOB.UPDATE_JOB_STATUS (
    p_job IN NUMBER,
    p_status IN VARCHAR2);
</pre>
<p class="subhead2"><a id="AEAPI1198"></a>Parameters</p>
<p><a href="#BGBHJHDE">Table 10-4</a> describes the parameters available in the UPDATE_JOB_STATUS procedure.</p>
<div id="AEAPI1199" class="tblformal">
<p class="titleintable"><a id="sthref154"></a><a id="BGBHJHDE"></a>Table 10-4 UPDATE_JOB_STATUS Parameters</p>
<table class="cellalignment965" title="UPDATE_JOB_STATUS Parameters" summary="This table describes the parameters available in the REMOVE_PREFERENCE procedure." dir="ltr">
<thead>
<tr class="cellalignment959">
<th class="cellalignment966" id="r1c1-t5">Parameter</th>
<th class="cellalignment966" id="r1c2-t5">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment959">
<td class="cellalignment967" id="r2c1-t5" headers="r1c1-t5">
<p><code>p_job</code></p>
</td>
<td class="cellalignment967" headers="r2c1-t5 r1c2-t5">
<p>Passed the reserved word JOB. When this code is executed it will have visibility to the job number via the reserved word JOB.</p>
</td>
</tr>
<tr class="cellalignment959">
<td class="cellalignment967" id="r3c1-t5" headers="r1c1-t5">
<p>p_status</p>
</td>
<td class="cellalignment967" headers="r3c1-t5 r1c2-t5">
<p>Plain text that you want associated with</p>
<p><code>JOB: p_job</code>.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p class="subhead2"><a id="AEAPI1200"></a>Example</p>
<p>The following example shows how to use the UPDATE_JOB_STATUS procedure. In this example, note that:</p>
<ul>
<li>
<p>Lines 002 to 010 run a loop that inserts 100 records into the emp table.</p>
</li>
<li>
<p><code>APP_JOB</code> is referenced as a bind variable inside the <code>VALUES</code> clause of the <code>INSERT</code>, and specified as the <code>p_job</code> parameter value in the call to <code>UPDATE_JOB_STATUS</code>.</p>
</li>
<li>
<p><code>APP_JOB</code> represents the job number which will be assigned to this process as it is submitted to <code>APEX_PLSQL_JOB</code>. By specifying this reserved item inside your process code, it will be replaced for you at execution time with the actual job number.</p>
</li>
<li>
<p>Note that this example calls to <code>UPDATE_JOB_STATUS</code> every ten records, inside the block of code. Normally, Oracle transaction rules dictate updates made inside code blocks will not be seen until the entire transaction is committed. The <code>APEX_PLSQL_JOB.UPDATE_JOB_STATUS</code> procedure, however, has been implemented in such a way that the update will happen regardless of whether or not the job succeeds or fails. This last point is important for two reasons:</p>
<ol>
<li>
<p>Even if your status shows "100 rows inserted", it does not mean the entire operation was successful. If an error occurred at the time the block of code tried to commit, the user_status column of <code>APEX_PLSQL_JOBS</code> would not be affected because status updates are committed separately.</p>
</li>
<li>
<p>Updates are performed autonomously. You can view the job status before the job has completed. This gives you the ability to display status text about ongoing operations in the background as they are happening.</p>
</li>
</ol>
</li>
</ul>
<pre>
BEGIN
    FOR i IN 1 .. 100 LOOP
        INSERT INTO emp(a,b) VALUES (:APP_JOB,i);
        IF MOD(i,10) = 0 THEN
            APEX_PLSQL_JOB.UPDATE_JOB_STATUS(
                P_JOB =&gt; :APP_JOB,
                P_STATUS =&gt; i || ' rows inserted');
        END IF;
        APEX_UTIL.PAUSE(2);
    END LOOP;
END;
</pre></div>
<!-- class="refsect1" --></div>
<!-- class="refentry" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment958">
<tr>
<td class="cellalignment967">
<table class="cellalignment963">
<tr>
<td class="cellalignment962"><a href="javascript_api.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment962"><a href="apex_lang.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment969">
<table class="cellalignment961">
<tr>
<td class="cellalignment962"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment962"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment962"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment962"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment962"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
