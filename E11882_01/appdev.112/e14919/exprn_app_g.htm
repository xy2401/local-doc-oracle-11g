<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Implementing Various Forms of Rule Actions With the Action Callback Procedure</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 033" />
<meta name="dcterms.created" content="2011-08-16T11:52:4Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Rules Manager and Expression Filter Developer's Guide" />
<meta name="dcterms.identifier" content="E14919-04" />
<meta name="dcterms.isVersionOf" content="EXPRN" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="exprn_app_f.htm" title="Previous" type="text/html" />
<link rel="Next" href="index.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e14919.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">35/36</span> <!-- End Header --><a id="BEJHAIJB"></a><a id="EXPRN566"></a>
<h1 class="appendix"><span class="secnum">G</span> Implementing Various Forms of Rule Actions With the Action Callback Procedure</h1>
<p>The action callback procedure<a id="sthref410"></a> configured for a rule class acts as a common entry point for executing the actions for all the rules in the rule class. This procedure is called once for each rule matching an event (primitive or composite). At the time of execution, this procedure has access to the events that matched the rule and the complete list of action preferences associated with the matched rule. The user implementing the action callback procedure can rely on this information to determine the appropriate action for each rule. Rules Manager provides maximum flexibility by not restricting the types of action preferences used for a rule class. In the simplest case, the action preferences associated with a rule can be one or more scalar values that are used as arguments to a common procedure (<code>OfferPromotion</code> from the example in Section 2.4) that executes the appropriate action for each rule. <a href="#BEJFGGHB">Table G-1</a> represents one such rule class that is created with three types of action preference - <code>PromoType</code>, <code>OfferedBy</code>, and <code>Discount</code>.</p>
<div class="tblformalwide">
<p class="titleintable"><a id="EXPRN567"></a><a id="sthref411"></a><a id="BEJFGGHB"></a>Table G-1 TravelPromotion Rule Class Table</p>
<table class="cellalignment998" title="TravelPromotion Rule Class Table" summary="The TravelPromotion rule class is created with three types of action preference, PromoType, OfferedVy, and Discount." dir="ltr">
<thead>
<tr class="cellalignment989">
<th class="cellalignment999" id="r1c1-t2">rlm$ruleId</th>
<th class="cellalignment999" id="r1c2-t2">rlm$rulecond</th>
<th class="cellalignment999" id="r1c3-t2">rlm$enabled</th>
<th class="cellalignment999" id="r1c4-t2">PromoType</th>
<th class="cellalignment999" id="r1c5-t2">OfferedBy</th>
<th class="cellalignment999" id="r1c6-t2">Discount</th>
<th class="cellalignment999" id="r1c7-t2">rlm$ruledesc</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment989">
<td class="cellalignment995" id="r2c1-t2" headers="r1c1-t2">
<p>AB_AV_ORL</p>
</td>
<td class="cellalignment995" headers="r2c1-t2 r1c2-t2">
<p>Airline='Abcair' and ToCity='Orlando'</p>
</td>
<td class="cellalignment995" headers="r2c1-t2 r1c3-t2">
<p>'Y'</p>
</td>
<td class="cellalignment995" headers="r2c1-t2 r1c4-t2">
<p>RentalCar</p>
</td>
<td class="cellalignment995" headers="r2c1-t2 r1c5-t2">
<p>Acar</p>
</td>
<td class="cellalignment995" headers="r2c1-t2 r1c6-t2">
<p>10</p>
</td>
<td class="cellalignment995" headers="r2c1-t2 r1c7-t2">
<p>Additional info</p>
</td>
</tr>
<tr class="cellalignment989">
<td class="cellalignment995" id="r3c1-t2" headers="r1c1-t2">
<p>AC_HT_SJC</p>
</td>
<td class="cellalignment995" headers="r3c1-t2 r1c2-t2">
<p>Airline='Acbair' and ToCity='San Jose'</p>
</td>
<td class="cellalignment995" headers="r3c1-t2 r1c3-t2">
<p>'Y'</p>
</td>
<td class="cellalignment995" headers="r3c1-t2 r1c4-t2">
<p>Hotel</p>
</td>
<td class="cellalignment995" headers="r3c1-t2 r1c5-t2">
<p>Ahotel</p>
</td>
<td class="cellalignment995" headers="r3c1-t2 r1c6-t2">
<p>5</p>
</td>
<td class="cellalignment995" headers="r3c1-t2 r1c7-t2">
<p>Additional info</p>
</td>
</tr>
<tr class="cellalignment989">
<td class="cellalignment995" id="r4c1-t2" headers="r1c1-t2">
<p>...</p>
</td>
<td class="cellalignment995" headers="r4c1-t2 r1c2-t2">
<p>...</p>
</td>
<td class="cellalignment995" headers="r4c1-t2 r1c3-t2">
<p>...</p>
</td>
<td class="cellalignment995" headers="r4c1-t2 r1c4-t2">
<p>...</p>
</td>
<td class="cellalignment995" headers="r4c1-t2 r1c5-t2">
<p>...</p>
</td>
<td class="cellalignment995" headers="r4c1-t2 r1c6-t2">
<p>...</p>
</td>
<td class="cellalignment995" headers="r4c1-t2 r1c7-t2">
<p>...</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformalwide" -->
<p>If you implement a single PL/SQL procedure in the database to offer all types of discounts by accepting appropriate arguments, the action callback procedure for the preceding rule class can make use of this procedure to execute appropriate actions, as follows:</p>
<pre>
CREATE or REPLACE PROCEDURE PromoAction (rlm$event  AddFlight,
                                         rlm$rule   TravelPromotion%ROWTYPE) is
BEGIN
   OfferPromotion(rlm$event.CustId,
                  rlm$rule.PromoType,
                  rlm$rule.OfferedBy,
                  rlm$rule.Discount);
END;
</pre>
<p>However, if you do not implement the action for all the rules with a single procedure but with a handful of procedures, the action callback procedure can be implemented to choose the appropriate procedure using one of the action preference values. For example, if the procedures used to offer hotel and rental car promotions are different, the preceding action callback procedure can be implemented as follows:</p>
<pre>
CREATE or REPLACE PROCEDURE PromoAction (rlm$event AddFlight,
                                         rlm$rule TravelPromotion%ROWTYPE) is
BEGIN
   CASE rlm$rule.PromoType
     WHEN 'RentalCar' then
       OfferRentalCarPromotion(rlm$event.CustId,
                               rlm$rule.OfferedBy,
                               rlm$rule.Discount);
     WHEN 'Hotel' then
       OfferHotelPromotion (rlm$event.CustId,
                            rlm$rule.OfferedBy,
                            rlm$rule.Discount);
     ELSE
       OfferPromotion(rlm$event.CustId,
                      rlm$rule.PromoType,
                      rlm$rule.OfferedBy,
                      rlm$rule.Discount);
   END CASE; 
END;
</pre>
<p>For complex rule applications requiring different actions for each rule, the PL/SQL commands that model the actions can be stored as the rule action preferences. For this purpose, the preceding rule class table can be configured to store the anonymous PL/SQL code blocks as the rule action preferences as described in <a href="#BEJEGJED">Table G-2</a>.</p>
<div class="tblformalwide">
<p class="titleintable"><a id="EXPRN568"></a><a id="sthref412"></a><a id="BEJEGJED"></a>Table G-2 Modified TravelPromotion Rule Class Table</p>
<table class="cellalignment998" title="Modified TravelPromotion Rule Class Table" summary="The TravelPromotion rule class modified to store the anonymous PL/SQL code blocks as the rule action preferences." dir="ltr">
<thead>
<tr class="cellalignment989">
<th class="cellalignment999" id="r1c1-t3">rlm$ruleId</th>
<th class="cellalignment999" id="r1c2-t3">rlm$rulecond</th>
<th class="cellalignment999" id="r1c3-t3">rlm$enabled</th>
<th class="cellalignment999" id="r1c4-t3">ActionCommands</th>
<th class="cellalignment999" id="r1c5-t3">rlm$ruledesc</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment989">
<td class="cellalignment995" id="r2c1-t3" headers="r1c1-t3">
<p>AB_AV_ORL</p>
</td>
<td class="cellalignment995" headers="r2c1-t3 r1c2-t3">
<p>Airline='Abcair' and ToCity='Orlando'</p>
</td>
<td class="cellalignment995" headers="r2c1-t3 r1c3-t3">
<p>'Y'</p>
</td>
<td class="cellalignment995" headers="r2c1-t3 r1c4-t3">
<p>begin</p>
<p>OfferAcarPromotion(:1,10);</p>
<p>end;</p>
</td>
<td class="cellalignment995" headers="r2c1-t3 r1c5-t3">
<p>Additional info</p>
</td>
</tr>
<tr class="cellalignment989">
<td class="cellalignment995" id="r3c1-t3" headers="r1c1-t3">
<p>AC_HT_SJC</p>
</td>
<td class="cellalignment995" headers="r3c1-t3 r1c2-t3">
<p>Airline='Acbair' and ToCity='San Jose'</p>
</td>
<td class="cellalignment995" headers="r3c1-t3 r1c3-t3">
<p>'Y'</p>
</td>
<td class="cellalignment995" headers="r3c1-t3 r1c4-t3">
<p>begin</p>
<p>OfferAhotelPromotion (:1, 5);</p>
<p>end;</p>
</td>
<td class="cellalignment995" headers="r3c1-t3 r1c5-t3">
<p>Additional info</p>
</td>
</tr>
<tr class="cellalignment989">
<td class="cellalignment995" id="r4c1-t3" headers="r1c1-t3">
<p>...</p>
</td>
<td class="cellalignment995" headers="r4c1-t3 r1c2-t3">
<p>...</p>
</td>
<td class="cellalignment995" headers="r4c1-t3 r1c3-t3">
<p>...</p>
</td>
<td class="cellalignment995" headers="r4c1-t3 r1c4-t3">
<p>...</p>
</td>
<td class="cellalignment995" headers="r4c1-t3 r1c5-t3">
<p>...</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformalwide" -->
<p>For the preceding rule class configuration, you can implement the action callback procedure to execute the anonymous PL/SQL code blocks using the <code>EXECUTE IMMEDIATE</code> command shown as follows.</p>
<pre>
CREATE or REPLACE PROCEDURE PromoAction (rlm$event AddFlight,
                                         rlm$rule  TravelPromotion%ROWTYPE) is
BEGIN
  EXECUTE IMMEDIATE rlm$rule.ActionCommands USING rlm$event.CustId;
END;
/
</pre>
<p>A rules application in the database can use a combination of the previous three procedures to model complex action execution logic. For this purpose, the rule class can be created with as high as 997 action preference columns, each with any valid SQL data type (including <code>RAW</code>, <code>CLOB</code>, and <code>XML</code>).</p>
</div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment988">
<tr>
<td class="cellalignment995">
<table class="cellalignment993">
<tr>
<td class="cellalignment992"><a href="exprn_app_f.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment992"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment997">
<table class="cellalignment991">
<tr>
<td class="cellalignment992"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment992"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment992"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment992"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment992"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment992"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
