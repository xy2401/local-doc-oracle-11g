<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Accessing Data Through URIs</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 748" />
<meta name="description" content="This manual describes Oracle XML&nbsp;DB. It includes guidelines and examples for storing, generating, accessing, searching, validating, transforming, evolving, and indexing XML data in Oracle Database." />
<meta name="dcterms.created" content="2014-02-20T9:56:16Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="XML DB Developer's Guide" />
<meta name="dcterms.identifier" content="E23094-04" />
<meta name="dcterms.isVersionOf" content="ADXDB" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="xdb14vie.htm" title="Previous" type="text/html" />
<link rel="Next" href="partpg5.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e23094.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">31/54</span> <!-- End Header -->
<div id="ADXDB1900" class="chapter"><a id="BABIBHDB"></a>
<h1 class="chapter"><span class="secnum">20</span> Accessing Data Through URIs</h1>
<p>This chapter describes how to generate and store URLs in the database and how to retrieve data pointed to by those URLs. Three kinds of URIs are discussed:</p>
<ul>
<li>
<p>DBUris &ndash; addresses to relational data in the database</p>
</li>
<li>
<p>XDBUris &ndash; addresses to data in Oracle XML&nbsp;DB Repository</p>
</li>
<li>
<p>HTTPUris &ndash; Web addresses that use the Hyper Text Transfer Protocol (HTTP(S))</p>
</li>
</ul>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#BABIBGDA">Overview of Oracle XML&nbsp;DB URL Features</a></p>
</li>
<li>
<p><a href="#BABJGBAH">URIs and URLs</a></p>
</li>
<li>
<p><a href="#i1024876">URIType and its Subtypes</a></p>
</li>
<li>
<p><a href="#BABHADAI">Accessing Data using URIType Instances</a></p>
</li>
<li>
<p><a href="#i1031623">XDBUris: Pointers to Repository Resources</a></p>
</li>
<li>
<p><a href="#i1027988">DBUris: Pointers to Database Data</a></p>
</li>
<li>
<p><a href="#i1025294">Creating New Subtypes of URIType using Package URIFACTORY</a></p>
</li>
<li>
<p><a href="#i1025408">SYS_DBURIGEN SQL Function</a></p>
</li>
<li>
<p><a href="#i1025534">DBUriServlet</a></p>
</li>
</ul>
<a id="BABIBGDA"></a>
<div id="ADXDB5224" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Overview of Oracle XML&nbsp;DB URL Features</h2>
<p>The two main features described in this chapter are these:</p>
<ul>
<li>
<p><span class="italic">Using paths as an indirection mechanism &ndash;</span> You can store a path in the database and then access its target <span class="italic">indirectly</span> by referring to the path. The paths in question are various kinds of Uniform Resource Identifier (URI).</p>
</li>
<li>
<p><span class="italic">Using paths that target database data to produce XML documents &ndash;</span> One kind of URI that you can use for indirection in particular, a <span class="italic">DBUri</span>, provides a convenient XPath notation for addressing <span class="italic">database data</span>. You can use a DBUri to construct an <span class="italic">XML document</span> that contains database data and whose structure reflects the database structure.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="BABJGBAH"></a>
<div id="ADXDB5225" class="sect1">
<h2 class="sect1">URIs and URLs</h2>
<p>In developing Web-based XML applications, you often refer to data located on a network using <span class="glossaryterm">Uniform Resource Identifiers</span>, or <span class="glossaryterm">URI</span>s. A <span class="glossaryterm">URL</span>, or <span class="glossaryterm">Uniform Resource Locator</span>, is a URI that accesses an object using an Internet protocol.</p>
<p>A URI has two parts, separated by a number sign (<code><span class="codeinlinebold">#</span></code>):</p>
<ul>
<li>
<p>A URL part, that identifies a document.</p>
</li>
<li>
<p>A fragment part, that identifies a fragment within the document. The notation for the fragment depends on the document type. For HTML documents, it is an anchor name. For XML documents, it is an XPath expression.</p>
</li>
</ul>
<p>These are typical URIs:</p>
<ul>
<li>
<p><span class="italic">For HTML &ndash;</span> <code>http://www.example.com/document1#some_anchor</code>, where <code>some_anchor</code> is a named anchor in the HTML document.</p>
</li>
<li>
<p><span class="italic">For XML &ndash;</span> <code>http://www.example.com/xml_doc#/po/cust/custname</code>, where:</p>
<ul>
<li>
<p><code>http://www.example.com/xml_doc</code> identifies the location of the XML document.</p>
</li>
<li>
<p><code>/po/cust/custname</code> identifies a fragment within the document. This portion is defined by the W3C XPointer recommendation.</p>
</li>
</ul>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><code><a href="http://www.w3.org/2002/ws/Activity.html">http://www.w3.org/2002/ws/Activity.html</a></code> an explanation of HTTP(S) URL notation</p>
</li>
<li>
<p><code><a href="http://www.w3.org/TR/xpath">http://www.w3.org/TR/xpath</a></code> for an explanation of the XML XPath notation</p>
</li>
<li>
<p><code><a href="http://www.w3.org/TR/xptr/">http://www.w3.org/TR/xptr/</a></code> for an explanation of the XML XPointer notation</p>
</li>
<li>
<p><code><a href="http://xml.coverpages.org/xmlMediaMIME.html">http://xml.coverpages.org/xmlMediaMIME.html</a></code> for a discussion of MIME types</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="i1024876"></a>
<div id="ADXDB5226" class="sect1">
<h2 class="sect1">URIType and its Subtypes</h2>
<p>Oracle XML&nbsp;DB can represent paths of various kinds as database objects. These are the available path object types:</p>
<ul>
<li>
<p><code><span class="codeinlinebold"><a id="sthref1284"></a>HTTPURIType</span></code> &ndash; An object of this type is called an <span class="glossaryterm"><a id="sthref1285"></a>HTTPUri</span> and represents a URL that begins with <code><span class="codeinlinebold">http://</span></code>. With <code>HTTPURIType</code>, you can create objects that represent links to remote <span class="italic">Web pages</span> (or files) and retrieve those Web pages by calling object methods. Applications using <code>HTTPUriType</code> must have the proper access privileges. <code>HTTPUriType</code> implements the Hyper Text Transfer Protocol (HTTP(S)) for accessing remote Web pages. <code>HTTPURIType</code> uses package <code>UTL_HTTP</code> to fetch data, so session settings and access control for this package can also be used to influence HTTP fetches.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#i1031614">"HTTPURIType PL/SQL Method GETCONTENTTYPE()"</a></p>
</li>
<li>
<p><a class="olink DBSEG40012" href="../../network.112/e36292/authorization.htm#DBSEG40012"><span class="italic">Oracle Database Security Guide</span></a> for information about managing fine-grained access to external network services</p>
</li>
</ul>
</div>
</li>
<li>
<p><code><span class="codeinlinebold"><a id="sthref1286"></a>DBURIType</span></code> &ndash; An object of this type is called a <span class="glossaryterm"><a id="sthref1287"></a>DBUri</span> and represents a URI that targets database data &ndash; a table, one or more rows, or a single column. With <code>DBURIType</code>, you can create objects that represent links to <span class="italic">database data</span>, and retrieve such data <span class="italic">as XML</span> by calling object methods. A DBUri uses a simple form of XPath expression as its URI syntax &ndash; for example, the following XPath expression is a DBUri reference to the row of table <code>HR.employees</code> where column <code>first_name</code> has value <code>Jack</code>:</p>
<pre>
/HR/EMPLOYEES/ROW[FIRST_NAME="Jack"] 
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also :</p>
<a href="#i1027988">DBUris: Pointers to Database Data</a></div>
</li>
<li>
<p><code><span class="codeinlinebold"><a id="sthref1288"></a>XDBURIType</span></code> &ndash; An object of this type is called an <span class="glossaryterm"><a id="sthref1289"></a>XDBUri</span>, and represents a URI that targets a resource in Oracle XML&nbsp;DB Repository. With <code>XDBURIType</code>, you can create objects that represent links to <span class="italic">repository resources</span>, and retrieve all or part of any resource by calling object methods. The URI syntax for an XDBUri is a repository resource address optionally followed by an XPath expression. For example, <code>/public/hr/doc1.xml#/purchaseOrder/lineItem</code> is an XDBUri reference to the <code>lineItem</code> child element of the root element <code>purchaseOrder</code> in repository file <code>doc1.xml</code> in folder <code>/public/hr</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also :</p>
<a href="#i1031623">XDBUris: Pointers to Repository Resources</a></div>
</li>
</ul>
<p>Each of these object types is derived from an <span class="italic">abstract</span> object type, <code><span class="codeinlinebold">URIType</span></code>. As an abstract type, it has <span class="italic">no</span> instances (objects). Only its subtypes have instances.</p>
<p>Type <code>URIType</code> provides the following features:</p>
<ul>
<li>
<p><span class="italic">Unified access to data stored inside and outside the server.</span> Because you can use <code>URIType</code> values to store pointers to <a id="sthref1290"></a>HTTP(S) and DBUris, you can create queries and indexes without worrying about where the data resides.</p>
</li>
<li>
<p><span class="italic">Mapping of URIs in XML Documents to Database Columns.</span> When an XML document is broken up and stored in object-relational tables and columns, any URIs contained in the document are mapped to database columns of the appropriate <code>URIType</code> subtype.</p>
</li>
</ul>
<p>You can reference data stored in relational columns and expose it to the external world using URIs. Oracle Database provides a standard servlet, DBUriServlet, that interprets DBUris. It also provides PL/SQL package <code>UTL_HTTP</code> and Java class <code>java.net.URL</code>, which you can use to fetch URL references.</p>
<p><code>URIType</code> columns can be indexed natively in Oracle Database using Oracle Text &ndash; no special data store is needed.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#i1025294">"Creating New Subtypes of URIType using Package URIFACTORY"</a> for information about defining new <code>URIType</code> subtypes</p>
</li>
<li>
<p><a href="xdb_indexing.htm#CHDEADIH">Chapter 6, "Indexing XMLType Data"</a></p>
</li>
</ul>
</div>
<div id="ADXDB5227" class="sect2"><a id="sthref1291"></a>
<h3 class="sect2">DBUris and <a id="sthref1292"></a>XDBUris &ndash; What For?</h3>
<p>The following are typical uses of DBUris and XDBUris:</p>
<ul>
<li>
<p>You can reference XSLT style sheets from within database-generated Web pages. PL/SQL package <code><a id="sthref1293"></a><a id="sthref1294"></a>DBMS_METADATA</code> uses DBUris to reference XSL style sheets. An XDBUri can be used to reference XSLT style sheets stored in Oracle XML&nbsp;DB Repository.</p>
</li>
<li>
<p>You can reference HTML text, images and other data stored in the database. URLs can be used to point to data stored in database tables or in repository folders.</p>
</li>
<li>
<p>You can improve performance by bypassing the Web server. Replace a global URL in your XML document with a reference to the database, and use a servlet, a DBUri, or an XDBUri to retrieve the targeted content. Using a DBUri or an XDBUri generally provides better performance than using a servlet, because you interact directly with the database rather than through a Web server.</p>
</li>
<li>
<p>With a DBUri, you can access an XML document in the database without using SQL.</p>
</li>
<li>
<p>Whenever a repository resource is stored in a database table to which you have access, you can use either an XDBUri or a DBUri to access its content.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS026" href="../../appdev.112/e40758/d_metada.htm#ARPLS026"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a>, "DBMS_METADATA package"</div>
</div>
<!-- class="sect2" -->
<div id="ADXDB5228" class="sect2"><a id="sthref1295"></a>
<h3 class="sect2">URIType Methods</h3>
<p>Abstract object type <code>URIType</code> includes PL/SQL methods that can be used with each of its subtypes. Each of these methods can be overridden by any of the subtypes. <a href="#g1032380">Table 20-1</a> lists the <code>URIType</code> PL/SQL methods. In addition, each of the subtypes has a constructor with the same name as the subtype.</p>
<div id="ADXDB5229" class="tblhruleformal">
<p class="titleintable"><a id="sthref1296"></a><a id="g1032380"></a>Table 20-1 URIType PL/SQL Methods</p>
<table class="cellalignment1032" title="URIType PL/SQL Methods " summary="This table describes the URIType member functions." dir="ltr">
<thead>
<tr class="cellalignment1020">
<th class="cellalignment1027" id="r1c1-t8">URIType Method</th>
<th class="cellalignment1027" id="r1c2-t8">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r2c1-t8" headers="r1c1-t8">
<pre>
getURL()
</pre></td>
<td class="cellalignment1028" headers="r2c1-t8 r1c2-t8">
<p>Returns the URL of the <code>URIType</code> instance.</p>
<p>Use this method instead of referencing a URL directly. <code>URIType</code> subtypes override this method to provide the correct URL. For example, <code>HTTPURIType</code> stores a URL without prefix <code>http://</code>. Method <code>getURL()</code> then prepends the prefix and returns the entire URL.</p>
</td>
</tr>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r3c1-t8" headers="r1c1-t8">
<pre>
getExternalURL()
</pre></td>
<td class="cellalignment1028" headers="r3c1-t8 r1c2-t8">
<p>Similar to <code>getURL()</code>, but <code>getExternalURL()</code> escapes characters in the URL, to conform with the URL specification. For example, spaces are converted to the escaped value <code>%20</code>.</p>
</td>
</tr>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r4c1-t8" headers="r1c1-t8">
<pre>
getContentType()
</pre></td>
<td class="cellalignment1028" headers="r4c1-t8 r1c2-t8">
<p>Returns the MIME content type for the URI.</p>
<p><span class="italic">HTTPUri:</span> To return the content type, the URL is followed and the MIME header examined.</p>
<p><span class="italic">DBUri:</span> The returned content type is either <code>text/plain</code> (for a scalar value) or <code>text/xml</code> (otherwise).</p>
<p><span class="italic">XDBUri:</span> The value of the <code>ContentType</code> metadata property of the repository resource is returned.</p>
</td>
</tr>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r5c1-t8" headers="r1c1-t8">
<pre>
getCLOB()
</pre></td>
<td class="cellalignment1028" headers="r5c1-t8 r1c2-t8">
<p>Returns the target of the URI as a <code>CLOB</code> value. The database character set is used for encoding the data.</p>
<p><span class="italic">DBUri:</span> <span class="italic">XML</span> data is returned (unless node-test <code>text()</code> is used, in which case the targeted data is returned as is). When a <code>BLOB</code> column is targeted, the binary data in the column is <span class="italic">translated as hexadecimal character data</span>.</p>
</td>
</tr>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r6c1-t8" headers="r1c1-t8">
<pre>
getBLOB()
</pre></td>
<td class="cellalignment1028" headers="r6c1-t8 r1c2-t8">
<p>Returns the target of the URI as a <code>BLOB</code> value. No character conversion is performed, and the character encoding is that of the URI target. This method can also be used to fetch binary data.</p>
<p><span class="italic">DBUri:</span> When applied to a DBUri that targets a <code>BLOB</code> column, <code>getBLOB()</code> returns the binary data <span class="italic">translated as hexadecimal character data</span>. When applied to a DBUri that targets <span class="italic">non</span>-binary data, the data is returned in the database character set.</p>
</td>
</tr>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r7c1-t8" headers="r1c1-t8">
<pre>
getXML()
</pre></td>
<td class="cellalignment1028" headers="r7c1-t8 r1c2-t8">
<p>Returns the target of the URI as an <code>XMLType</code> instance. Using this, an application that performs operations other than <code>getCLOB()</code> and <code>getBLOB()</code> can use <code>XMLType</code> methods to do those operations. This throws an exception if the URI does not target a well-formed XML document.</p>
</td>
</tr>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r8c1-t8" headers="r1c1-t8">
<pre>
createURI()
</pre></td>
<td class="cellalignment1028" headers="r8c1-t8 r1c2-t8">
<p>Constructs an instance of one of the <code>URIType</code> subtypes.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<a id="i1031614"></a>
<div id="ADXDB5230" class="sect3">
<h4 class="sect3">HTTPURIType PL/SQL Method GETCONTENTTYPE()</h4>
<p><code>HTTPURIType</code> PL/SQL method <code>getContentType()</code> returns the MIME information for its targeted document. You can use this information to decide whether to retrieve the document as a <code>BLOB</code> value or a <code>CLOB</code> value. For example, you might treat a Web page with a MIME type of <code>x/jpeg</code> as a <code>BLOB</code> value, and one with a MIME type of <code>text/plain</code> or <code>text/html</code> as a <code>CLOB</code> value.</p>
<p><a href="#CBAFDAFH">Example 20-1</a> tests the HTTP content type to determine whether to retrieve data as a <code>CLOB</code> or <code>BLOB</code> value. The content-type data is the HTTP header, for <code>HTTPURIType</code>, or the metadata of the database column, for <code>DBURIType</code>.</p>
<div id="ADXDB5231" class="example">
<p class="titleinexample"><a id="CBAFDAFH"></a>Example 20-1 Using HTTPURIType PL/SQL Method GETCONTENTTYPE()</p>
<pre>
DECLARE
  httpuri HTTPURIType;
  y CLOB;
  x BLOB;
BEGIN
  httpuri := HTTPURIType('http://www.oracle.com/index.html');
  DBMS_OUTPUT.put_line(httpuri.<span class="bold">getContentType</span>());
  IF httpuri.getContentType() = 'text/html'
  THEN
     y := httpuri.getCLOB();
  END IF;
  IF httpuri.getContentType() = 'application-x/bin'
  THEN
     x := httpuri.getBLOB();
  END IF;
END;
/
<span class="bold">text/html</span>
</pre></div>
<!-- class="example" --></div>
<!-- class="sect3" -->
<div id="ADXDB5232" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1297"></a>
<h4 class="sect3">DBURIType PL/SQL Method GETCONTENTTYPE()</h4>
<p>PL/SQL method <code>getContentType()</code> returns the MIME information for a URL. If a DBUri targets a scalar value, then the MIME content type returned is <code>text/plain</code>. Otherwise, the type returned is <code>text/xml</code>.</p>
<pre>
CREATE TABLE dbtab (a VARCHAR2(20), b BLOB);
</pre>
<p>DBUris corresponding to the following XPath expressions have content type <code>text/xml</code>, because each targets a complete column of XML data.</p>
<ul>
<li>
<p><code>/HR/DBTAB/ROW/A</code></p>
</li>
<li>
<p><code>/HR/DBTAB/ROW/B</code></p>
</li>
</ul>
<p>DBUris corresponding to the following XPath expressions have content type <code>text/plain</code>, because each targets a scalar value.</p>
<ul>
<li>
<p><code>/HR/DBTAB/ROW/A/text()</code></p>
</li>
<li>
<p><code>/HR/DBTAB/ROW/B/text()</code></p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<div id="ADXDB5233" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1298"></a>
<h4 class="sect3">DBURIType PL/SQL Method GETCLOB()</h4>
<p>When PL/SQL method <code>getCLOB()</code> is applied to a DBUri, the targeted data is returned as <span class="italic">XML</span> data, using the targeted column or table name as an XML element name. If the target XPath uses node-test <code>text()</code>, then the data is returned as text without an enclosing XML tag. In both cases, the returned data is in the database character set.</p>
<p>For example: If applied to a DBUri with XPath <code>/HR/DBTAB/ROW/A/text(),</code> where <code>A</code> is a non-binary column, the data in column <code>A</code> is returned as is. Without XPath node-test <code>text()</code>, the result is the data wrapped in XML:</p>
<pre>
&lt;HR&gt;&lt;DBTAB&gt;&lt;ROW&gt;&lt;A&gt;<span class="italic">...data_in_column_A...</span>&lt;/A&gt;&lt;/ROW&gt;&lt;/DBTAB&gt;&lt;/HR&gt;
</pre>
<p>When applied to a DBUri that targets a <span class="italic">binary</span> (<code>BLOB</code>) column, the binary data in the column is <span class="italic">translated as hexadecimal character data</span>.</p>
<p>For example: If applied to a DBUri with XPath <code>/HR/DBTAB/ROW/B/text(),</code> where <code>B</code> is a <code>BLOB</code> column, the targeted binary data is translated to hexadecimal character data and returned. Without XPath node-test <code>text()</code>, the result is the translated data wrapped in XML:</p>
<pre>
&lt;HR&gt;&lt;DBTAB&gt;&lt;ROW&gt;&lt;B&gt;<span class="italic">...data_translated_to_hex...</span>&lt;/B&gt;&lt;/ROW&gt;&lt;/DBTAB&gt;&lt;/HR&gt;
</pre></div>
<!-- class="sect3" -->
<div id="ADXDB5234" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1299"></a>
<h4 class="sect3">DBURIType PL/SQL Method GETBLOB()</h4>
<p>When applied to a DBUri that targets a <code>BLOB</code> column, <code>getBLOB()</code> returns the binary data <span class="italic">translated as hexadecimal character data</span>. When applied to a DBUri that targets <span class="italic">non</span>-binary data, <code>getBLOB()</code> returns the data (as a <code>BLOB</code> value) in the database character set.</p>
<p>For example, consider table <code>dbtab</code>:</p>
<pre>
CREATE TABLE dbtab (a VARCHAR2(20), b BLOB);
</pre>
<p>When <code>getBLOB()</code> is applied to a DBUri corresponding to XPath expression <code>/HR/DBTAB/ROW/B</code>, it returns a <code>BLOB</code> value containing an XML document with root element <code>B</code> whose content is the hexadecimal-character translation of the binary data of column <code>B</code>.</p>
<p>When <code>getBLOB()</code> is applied to a DBUri corresponding to XPath expression <code>/HR/DBTAB/ROW/B/text()</code>, it returns a <code>BLOB</code> value containing only the hexadecimal-character translation of the binary data of column <code>B</code>.</p>
<p>When <code>getBLOB()</code> is applied to a DBUri corresponding to XPath expression <code>/HR/DBTAB/ROW/</code><code><span class="codeinlinebold">A</span></code><code>/text()</code>, which targets <span class="italic">non</span>-binary data, it returns a <code>BLOB</code> value containing the data of column <code>A</code>, in the database character set.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABHADAI"></a>
<div id="ADXDB5235" class="sect1">
<h2 class="sect1">Accessing Data using URIType Instances</h2>
<p>To use instances of <code>URIType</code> subtypes for indirection, you generally store such instances in the database and then use them in queries with a PL/SQL method such as <code>getCLOB()</code> to retrieve the targeted data. This section illustrates how to do this.</p>
<p>You can create database columns using <code>URIType</code> or any of its subtypes, or you can store just the text of each URI as a string and then create the needed <code>URIType</code> instances on demand, when the URIs are accessed. You can store objects of different <code>URIType</code> subtypes in the same <code>URIType</code> database column.</p>
<p>You can also define your own object types that inherit from the <code>URIType</code> subtypes. Deriving new types lets you use custom techniques to retrieve, transform, or filter data.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#i1025294">"Creating New Subtypes of URIType using Package URIFACTORY"</a> for information about defining new <code>URIType</code> subtypes</p>
</li>
<li>
<p><a href="xdb03usg.htm#BABDIDHA">"XSL Transformation and Oracle XML&nbsp;DB"</a> for information about transforming XML data</p>
</li>
</ul>
</div>
<p><a href="#BABBACBF">Example 20-2</a> stores an HTTPUri and a DBUri (instances of <code>URIType</code> subtypes <code>HTTPURIType</code> and <code>DBURIType</code>) in the same database column of type <code>URIType</code>. A query retrieves the data addressed by each of the URIs. The first URI is a Web-page URL. The second URI references data in table <code>employees</code> of standard database schema <code>HR</code>. (For brevity, only the beginning of the Web page is shown.)</p>
<div id="ADXDB5236" class="example">
<p class="titleinexample"><a id="BABBACBF"></a>Example 20-2 Creating and Querying a URI Column</p>
<pre>
CREATE TABLE uri_tab (url URIType);
Table created.
 
INSERT INTO uri_tab VALUES (<span class="bold">HTTPURIType.createURI</span>('http://www.oracle.com'));
1 row created.
 
INSERT INTO uri_tab VALUES (<span class="bold">DBURIType.createURI</span>(
                              '/HR/EMPLOYEES/ROW[FIRST_NAME="Jack"]'));
1 row created.
 
SELECT e.url.getCLOB() FROM uri_tab e;
 
E.URL.GETCLOB()
-------------------------------------------------------------------
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;html&gt;
&lt;head&gt;
<span class="bold">. . .</span>
 
&lt;?xml version="1.0"?&gt;
 &lt;ROW&gt;
  &lt;EMPLOYEE_ID&gt;177&lt;/EMPLOYEE_ID&gt;
  &lt;FIRST_NAME&gt;Jack&lt;/FIRST_NAME&gt;
  &lt;LAST_NAME&gt;Livingston&lt;/LAST_NAME&gt;
  &lt;EMAIL&gt;JLIVINGS&lt;/EMAIL&gt;
  &lt;PHONE_NUMBER&gt;011.44.1644.429264&lt;/PHONE_NUMBER&gt;
  &lt;HIRE_DATE&gt;23-APR-06&lt;/HIRE_DATE&gt;
  &lt;JOB_ID&gt;SA_REP&lt;/JOB_ID&gt;
  &lt;SALARY&gt;8400&lt;/SALARY&gt;
  &lt;COMMISSION_PCT&gt;.2&lt;/COMMISSION_PCT&gt;
  &lt;MANAGER_ID&gt;149&lt;/MANAGER_ID&gt;
  &lt;DEPARTMENT_ID&gt;80&lt;/DEPARTMENT_ID&gt;
 &lt;/ROW&gt;
 
2 rows selected.
</pre></div>
<!-- class="example" -->
<p>To use <code>URIType</code> PL/SQL method <code>createURI()</code>, you must know the particular <code>URIType</code> subtype to use. PL/SQL method <code>getURI()</code> of package <code>URIFACTORY</code> lets you instead use the flexibility of late binding, determining the particular type information at run time.</p>
<p><code>URIFACTORY.getURI()</code> takes as argument a URI string. It returns a <code>URIType</code> instance of the appropriate subtype (<code>HTTPURIType, DBURIType,</code> or <code>XDBURIType</code>), based on the form of the URI string:</p>
<ul>
<li>
<p>If the URI starts with <code>http://</code>, then <code>getURI()</code> creates and returns an HTTPUri.</p>
</li>
<li>
<p>If the URI starts with either <code>/oradb/</code> or <code>/dburi/</code>, then <code>getURI()</code> creates and returns a DBUri.</p>
</li>
<li>
<p>Otherwise, <code>getURI()</code> creates and returns an XDBUri.</p>
</li>
</ul>
<p><a href="#CBABEBGC">Example 20-3</a> is similar to <a href="#BABBACBF">Example 20-2</a>, but it uses two different ways to obtain documents targeted by URIs:</p>
<ul>
<li>
<p>PL/SQL method <code>SYS.URIFACTORY.getURI()</code> with <span class="italic">absolute</span> URIs:</p>
<ul>
<li>
<p>an HTTPUri that targets HTTP address <code>http://www.oracle.com</code></p>
</li>
<li>
<p>a DBUri that targets database address <code>/oradb/HR/EMPLOYEES/ROW[EMPLOYEE_ID=200]</code></p>
</li>
</ul>
</li>
<li>
<p>Constructor <code>SYS.HTTPURIType()</code> with a <span class="italic">relative</span> URL (no <code>http://</code>). The same HTTPUri is used as for the absolute URI: the Oracle home page.</p>
</li>
</ul>
<p>In <a href="#CBABEBGC">Example 20-3</a>, the URI strings passed to <code>getURI()</code> are hard-coded, but they could just as easily be string values that are obtained by an application at run time.</p>
<div id="ADXDB5237" class="example">
<p class="titleinexample"><a id="CBABEBGC"></a>Example 20-3 <a id="sthref1300"></a><a id="sthref1301"></a>Using Different Kinds of URI, Created in Different Ways</p>
<pre>
CREATE TABLE uri_tab (docUrl SYS.URIType, docName VARCHAR2(200));
Table created.
 
-- Insert an HTTPUri with absolute URL into SYS.URIType using URIFACTORY.
-- The target is Oracle home page.
INSERT INTO uri_tab VALUES
  (SYS.URIFACTORY.<span class="bold">getURI</span>('http://www.oracle.com'), '<span class="bold">AbsURL</span>');
1 row created.
 
-- Insert an HTTPUri with relative URL using constructor SYS.HTTPURIType.
-- Note the absence of prefix http://. The target is the same.
INSERT INTO uri_tab VALUES (SYS.<span class="bold">HTTPURIType</span>('www.oracle.com'), '<span class="bold">RelURL</span>');
1 row created.

-- Insert a DBUri that targets employee data from table HR.employees.
INSERT INTO uri_tab VALUES
  (SYS.URIFACTORY.<span class="bold">getURI</span>('/oradb/HR/EMPLOYEES/ROW[EMPLOYEE_ID=200]'), '<span class="bold">Emp200</span>');
1 row created.

-- Extract all of the documents.
SELECT e.docUrl.getCLOB(), docName FROM uri_tab e;
 
E.DOCURL.GETCLOB()
-----------------
DOCNAME
------------------------------------
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;html&gt;
&lt;head&gt;
<span class="bold">. . .</span>
<span class="bold">AbsURL</span>
 
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
&lt;head&gt;
<span class="bold">. . .</span>
<span class="bold">RelURL</span>

&lt;?xml version="1.0"?&gt;
 &lt;ROW&gt;
  &lt;EMPLOYEE_ID&gt;200&lt;/EMPLOYEE_ID&gt;
  &lt;FIRST_NAME&gt;Jennifer&lt;/FIRST_NAME&gt;
  &lt;LAST_NAME&gt;Whalen&lt;/LAST_NAME&gt;
  &lt;EMAIL&gt;JWHALEN&lt;/EMAIL&gt;
  &lt;PHONE_NUMBER&gt;515.123.4444&lt;/PHONE_NUMBER&gt;
  &lt;HIRE_DATE&gt;17-SEP-03&lt;/HIRE_DATE&gt;
  &lt;JOB_ID&gt;AD_ASST&lt;/JOB_ID&gt;
  &lt;SALARY&gt;4400&lt;/SALARY&gt;
  &lt;MANAGER_ID&gt;101&lt;/MANAGER_ID&gt;
  &lt;DEPARTMENT_ID&gt;10&lt;/DEPARTMENT_ID&gt;
 &lt;/ROW&gt;
<span class="bold">Emp200</span>

3 rows selected.
 
-- In PL/SQL
CREATE OR REPLACE FUNCTION returnclob
  RETURN CLOB
  IS a SYS.URIType;
BEGIN
  SELECT docUrl INTO a FROM uri_Tab WHERE docName LIKE '<span class="bold">Emp200</span>%';
  RETURN a.getCLOB;
END;
/
Function created.
 
SELECT returnclob() FROM DUAL;
 
RETURNCLOB()
---------------------------------------------------------------
&lt;?xml version="1.0"?&gt;
 &lt;ROW&gt;
  &lt;EMPLOYEE_ID&gt;200&lt;/EMPLOYEE_ID&gt;
  &lt;FIRST_NAME&gt;Jennifer&lt;/FIRST_NAME&gt;
  &lt;LAST_NAME&gt;Whalen&lt;/LAST_NAME&gt;
  &lt;EMAIL&gt;JWHALEN&lt;/EMAIL&gt;
  &lt;PHONE_NUMBER&gt;515.123.4444&lt;/PHONE_NUMBER&gt;
  &lt;HIRE_DATE&gt;17-SEP-03&lt;/HIRE_DATE&gt;
  &lt;JOB_ID&gt;AD_ASST&lt;/JOB_ID&gt;
  &lt;SALARY&gt;4400&lt;/SALARY&gt;
  &lt;MANAGER_ID&gt;101&lt;/MANAGER_ID&gt;
  &lt;DEPARTMENT_ID&gt;10&lt;/DEPARTMENT_ID&gt;
 &lt;/ROW&gt;
 
1 row selected.
</pre></div>
<!-- class="example" --></div>
<!-- class="sect1" -->
<a id="i1031623"></a>
<div id="ADXDB5238" class="sect1">
<h2 class="sect1">XDBUris: Pointers to Repository Resources</h2>
<p><code>XDBURIType</code> is a subtype of <code>URIType</code> that provides a way to expose resources in Oracle XML&nbsp;DB Repository using URIs. Instances of type <code>XDBURIType</code> are called <span class="glossaryterm"><a id="sthref1302"></a>XDBUris</span>.</p>
<div id="ADXDB5239" class="sect2"><a id="sthref1303"></a>
<h3 class="sect2">XDBUri URI Syntax</h3>
<p>The URL portion of an XDBUri URI is the hierarchical address of the targeted repository resource &ndash; it is a <span class="italic">repository</span> path (<span class="italic">not</span> an XPath expression).</p>
<p>The optional fragment portion of the URI uses the XPath syntax, and is separated from the URL part by a number-sign (<code>#</code>). It is appropriate only if the targeted resource is an <span class="italic">XML</span> document, in which case the fragment portion targets one or more parts of the XML document. If the targeted resource is not an XML document, then omit the fragment and number-sign.</p>
<p>The following are examples of XDBUri URIs:</p>
<ul>
<li>
<p><code>/public/hr/image27.jpg</code></p>
</li>
<li>
<p><code>/public/hr/doc1.xml#/PurchaseOrder/LineItem</code></p>
</li>
</ul>
<p>Based on the form of these URIs:</p>
<ul>
<li>
<p><code>/public/hr</code> is a folder resource in Oracle XML&nbsp;DB Repository.</p>
</li>
<li>
<p><code>image27.jpg</code> and <code>doc1.xml</code> are resources in folder <code>/public/hr</code>.</p>
</li>
<li>
<p>Resource <code>doc1.xml</code> is a file resource, and it contains an XML document.</p>
</li>
<li>
<p>The XPath expression /<code>PurchaseOrder/LineItem</code> refers to the <code>LineItem</code> child element in element <code>PurchaseOrder</code> of XML document <code>doc1.xml</code>.</p>
</li>
</ul>
<p>You can create an XDBUri using PL/SQL method <code>getURI()</code> of package <code>URIFACTORY</code>.</p>
<p><code>XDBURIType</code> is the <span class="italic">default</span> <code>URIType</code> used when generating instances using <code>URIFACTORY</code> PL/SQL method <code>getURI()</code>, unless the URI has one of the recognized prefixes <code>http://</code>, <code>/dburi</code>, or <code>/oradb</code>.</p>
<p>For example, if resource <code>doc1.xml</code> is present in repository folder <code>/public/hr</code>, then the following query returns an XDBUri that targets that resource.</p>
<pre>
SELECT SYS.URIFACTORY.getURI('/public/hr/doc1.xml') FROM DUAL;
</pre>
<p>It is the lack of a special prefix that determines that the type is <code>XDBURIType</code>, not any particular resource file extension or the presence of <code>#</code> followed by an XPath expression. Even if the resource were named <code>foo.bar</code> instead of <code>doc1.xml</code>, the returned <code>URIType</code> instance would still be an XDBUri.</p>
</div>
<!-- class="sect2" -->
<div id="ADXDB5240" class="sect2"><a id="sthref1304"></a>
<h3 class="sect2">XDBUri Examples</h3>
<p><a href="#CBAHDCAA">Example 20-4</a> creates an XDBUri, inserts values into a purchase-order table, and then selects all of the purchase orders. Because there is no special prefix used in the URI passed to <code>URIFACTORY.getURI()</code>, the created <code>URIType</code> instance is an XDBUri.</p>
<div id="ADXDB5241" class="example">
<p class="titleinexample"><a id="CBAHDCAA"></a>Example 20-4 Access a Repository Resource by URI using an XDBUri</p>
<pre>
DECLARE
res BOOLEAN;
postring VARCHAR2(100):= '&lt;?xml version="1.0"?&gt;
&lt;ROW&gt;
&lt;PO&gt;999&lt;/PO&gt;
&lt;/ROW&gt;';
BEGIN
res:=DBMS_XDB.createFolder('/public/orders/');
res:=DBMS_XDB.createResource('/public/orders/po1.xml', postring);
END;
/
PL/SQL procedure successfully completed.
 
CREATE TABLE uri_tab (poUrl SYS.URIType, poName VARCHAR2(1000));
Table created.
 
-- Create an abstract type column so any type of URI can be used
-- Insert an absolute URL into poUrl.
-- The factory will create an XDBURIType because there is no prefix.
-- Here, po1.xml is an XML file that is stored in /public/orders/
-- of the XML repository.
INSERT INTO uri_tab VALUES
  (URIFACTORY.getURI('/public/orders/po1.xml'), 'SomePurchaseOrder');
1 row created.
 
-- Get all the purchase orders
SELECT e.poUrl.getCLOB(), poName FROM uri_tab e;
 
E.POURL.GETCLOB()
-----------------
PONAME
------
&lt;?xml version="1.0"?&gt;
&lt;ROW&gt;
&lt;PO&gt;999&lt;/PO&gt;
&lt;/ROW&gt;
SomePurchaseOrder
 
1 row selected.
 
-- Using PL/SQL, you can access table uri_tab as follows:
CREATE OR REPLACE FUNCTION returnclob
  RETURN CLOB
  IS a URIType;
BEGIN
  -- Get absolute URL for purchase order named like 'Some%'
   SELECT poUrl INTO a FROM uri_tab WHERE poName LIKE 'Some%';
   RETURN a.getCLOB();
END;
/ 
Function created.
 
SELECT returnclob() FROM DUAL;
 
RETURNCLOB()
---------------------
&lt;?xml version="1.0"?&gt;
&lt;ROW&gt;
&lt;PO&gt;999&lt;/PO&gt;
&lt;/ROW&gt;
 
1 row selected.
</pre></div>
<!-- class="example" -->
<p>Because PL/SQL method <code>getXML()</code> returns an <code>XMLType</code> instance, you can use it with SQL/XML functions such as <code>XMLQuery</code>. The query in <a href="#CBAEABDF">Example 20-5</a> illustrates this. The query retrieves all purchase orders numbered 999.</p>
<div id="ADXDB5242" class="example">
<p class="titleinexample"><a id="CBAEABDF"></a>Example 20-5 Using PL/SQL Method GETXML() with XMLCAST and XMLQUERY</p>
<pre>
SELECT e.poUrl.getCLOB() FROM uri_tab e
  WHERE XMLCast(XMLQuery('$po/ROW/PO'
                         PASSING e.poUrl.getXML() AS "po"
                         RETURNING CONTENT)
                AS VARCHAR2(24))
        = '999';

E.POURL.GETCLOB()
---------------------
&lt;?xml version="1.0"?&gt;
&lt;ROW&gt;
&lt;PO&gt;999&lt;/PO&gt;
&lt;/ROW&gt;
 
1 row selected.
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1027988"></a>
<div id="ADXDB5243" class="sect1">
<h2 class="sect1"><a id="sthref1305"></a><a id="sthref1306"></a>DBUris: Pointers to Database Data</h2>
<p>A DBUri is a URI that targets <span class="italic">database data</span>. As for all instances of <code>URIType</code> subtypes, a DBUri provides an indirection mechanism for accessing data. In addition, <code>DBURIType</code> lets you do the following:</p>
<ul>
<li>
<p>Address database data using XPath notation. This, in effect, lets you visualize and access the database as if it were XML data.</p>
<p>For example, a DBUri can use an expression such as <code>/HR/EMPLOYEES/ROW[FIRST_NAME="Jack"]</code> to target the row of table <code>HR.employees</code> where column <code>first_name</code> has value <code>Jack</code>.</p>
</li>
<li>
<p><span class="italic">Construct an XML document</span> that contains database data targeted by a DBUri and whose structure reflects the database structure.</p>
<p>For example: A DBUri with XPath <code>/HR/DBTAB/ROW/A</code> can be used to construct an XML document that wraps the data of column <code>A</code> in XML elements that reflect the database structure and are named accordingly:</p>
<pre>
&lt;HR&gt;&lt;DBTAB&gt;&lt;ROW&gt;&lt;A&gt;<span class="italic">...data_in_column_A...</span>&lt;/A&gt;&lt;/ROW&gt;&lt;/DBTAB&gt;&lt;/HR&gt;
</pre></li>
</ul>
<p>A DBUri does not reference a global location as does an HTTPUri. You can, however, also access objects addressed by a DBUri in a global manner, by appending the DBUri to an HTTPUri that identifies a servlet that handles DBUris &ndash; see <a href="#i1025534">"DBUriServlet"</a> .</p>
<div id="ADXDB5244" class="sect2"><a id="sthref1307"></a>
<h3 class="sect2">Viewing the Database as XML Data</h3>
<p>You can access only those database schemas to which you have been granted access privileges. This portion of the database is, in effect, your own view of the database.</p>
<p>Using <code>DBURIType</code>, you can have corresponding <span class="italic">XML</span> views of the database, which are portions of the database to which you have access, presented <span class="italic">in the form of XML data</span>. This means all kinds database data, not just data that is stored as XML. When visualized this way, the database data is effectively wrapped in XML elements, resulting in one or more XML documents.</p>
<p>Such "XML views" are not database views, in the technical sense of the term. "View" here means only an abstract perspective that can be useful for understanding <code>DBURIType</code>. You can think of <code>DBURIType</code> as providing a way to visualize and access the database <span class="italic">as if it were</span> XML data.</p>
<p>However, <code>DBURIType</code> does not just provide an exercise in visualization and an additional means to access database data. Each "XML view" can be realized as an XML document &ndash; that is, you can use <code>DBURIType</code> to generate XML documents using database data.</p>
<p>All of this is another way of saying that <code>DBURIType</code> lets you use XPath notation to 1) address and access any database data to which you have access and 2) construct XML representations of that data.</p>
<p><a href="#i1030162">Figure 20-1</a> illustrates the relation between a relational table, <code>HR.employees</code>, a corresponding XML view of a portion of that table, and the corresponding DBUri URI (a simple XPath expression). In this case, the portion of the data exposed as XML is the row where <code>employee_id</code> is <code>200</code>. The URI can be used to access the data and construct an XML document that reflects the "XML view".</p>
<div id="ADXDB5245" class="figure">
<p class="titleinfigure"><a id="i1030162"></a>Figure 20-1 A DBUri Corresponds to an XML Visualization of Relational Data</p>
<img width="633" height="284" src="img/adxdb053.gif" alt="Description of Figure 20-1 follows" /><br />
<a id="sthref1308" href="img_text/adxdb053.htm">Description of "Figure 20-1 A DBUri Corresponds to an XML Visualization of Relational Data"</a><br />
<br /></div>
<!-- class="figure" -->
<p>The XML elements in the "XML view" and the steps in the URI XPath expression both reflect the database table and column names. Note the use of <code><span class="codeinlinebold">ROW</span></code> to indicate a row in the database table &ndash; both in the "XML view" and in the URI XPath expression.</p>
<p>Note also that the XPath expression contains a root-element step, <code><span class="codeinlinebold">oradb</span></code>. This is used to indicate that the URI corresponds to a DBUri, not an HTTPUri or an XDBUri. Whenever this correspondence is understood from context, this XPath step can be skipped. For example, if it is known that the path in question is a path to database data, the following URIs are equivalent:</p>
<ul>
<li>
<p><code><span class="codeinlinebold">/oradb</span></code><code>/HR/EMPLOYEES/ROW[EMPLOYEE_ID=200]/LAST_NAME</code></p>
</li>
<li>
<p><code>/HR/EMPLOYEES/ROW[EMPLOYEE_ID=200]/LAST_NAME</code></p>
</li>
</ul>
<p>Whenever the URI context is not clear, however, you must use the prefix <code>/oradb</code> to distinguish a URI as corresponding to a DBUri. In particular, you must supply the prefix to <code>URIFACTORY</code> PL/SQL methods and to DBUriServlet.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#i1025294">"Creating New Subtypes of URIType using Package URIFACTORY"</a></p>
</li>
<li>
<p><a href="#i1025534">"DBUriServlet"</a></p>
</li>
<li>
<p><a href="xdb13gen.htm#g1047191">Chapter 18, "Generating XML Data from the Database"</a> for other ways to generate XML from database data</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<div id="ADXDB5246" class="sect2"><a id="sthref1309"></a>
<h3 class="sect2">DBUri URI Syntax</h3>
<p>An XPath expression is a path into XML data that addresses one or more XML nodes. A DBUri exploits the notion of a virtual XML user visualization of the database to use a <span class="italic">simple form</span> of XPath expression as a URI to address database data. This is so, regardless of the type of data, in particular, whether or not the data is XML.</p>
<p>Thus, for <code>DBURIType</code>, Oracle Database supports only a subset of the full XPath or XPointer syntax. There are no syntax restrictions for <span class="bolditalic">X</span>DBUri XPath expressions. There is also an exception in the DBUri case: data in <code>XMLType</code> tables. For an <code>XMLType</code> table, the simple XPath form is used to address the table itself within the database. Then, to address particular XML data in the table, the remainder of the XPath expression can use the full XPath syntax. This exception applies only to <code>XMLType</code> <span class="italic">tables</span>, not to <code>XMLType</code> columns.</p>
<p>In any case, unlike an XDBUri, a DBUri URI does not use a number-sign (<code>#</code>) to separate the URL portion of a URI from a fragment (XPath) portion. <code>DBURIType</code> does not use URI fragments. Instead, the entire URI is treated as a (simple) XPath expression.</p>
<p>You can create DBUris to any database data to which you have access. XPath expressions such as the following are allowed:</p>
<ul>
<li>
<p><code>/</code><code><span class="codeinlineitalic">database_schema</span></code><code>/</code><code><span class="codeinlineitalic">table</span></code></p>
</li>
<li>
<p><code>/</code><code><span class="codeinlineitalic">database_schema</span></code><code>/</code><code><span class="codeinlineitalic">table</span></code><code>/ROW[</code><code><span class="codeinlineitalic">predicate_expression</span></code><code>]/</code><code><span class="codeinlineitalic">column</span></code></p>
</li>
<li>
<p><code>/</code><code><span class="codeinlineitalic">database_schema</span></code><code>/</code><code><span class="codeinlineitalic">table</span></code><code>/ROW[</code><code><span class="codeinlineitalic">predicate_expression</span></code><code>]/</code><code><span class="codeinlineitalic">object_column</span></code><code>/</code><code><span class="codeinlineitalic">attribute</span></code></p>
</li>
<li>
<p><code>/</code><code><span class="codeinlineitalic">database_schema</span></code><code>/</code><code><span class="codeinlineboldital">XMLType_table</span></code><code>/ROW/</code><code><span class="codeinlineitalic">XPath_expression</span></code></p>
</li>
</ul>
<p>In the last case, <code><span class="codeinlineitalic">XMLType_table</span></code> is an <code>XMLType</code> table, and <code><span class="codeinlineitalic">XPath_expression</span></code> is <span class="italic">any</span> XPath expression. For tables that are <span class="italic">not</span> <code>XMLType</code>, a DBUri XPath expression must end at a column (it cannot address specific data inside a column). This restriction includes <code>XMLType</code> columns, LOB columns, and <code>VARCHAR2</code> columns that contain XML data.</p>
<p>A DBUri XPath expression can do any of the following:</p>
<ul>
<li>
<p>Target an entire table.</p>
<p>For example, <code>/HR/EMPLOYEES</code> targets table <code>employees</code> of database schema <code>HR</code>.</p>
</li>
<li>
<p>Include XPath predicates at any step in the path, except the database schema and table steps.</p>
<p>For example, <code>/HR/EMPLOYEES/ROW[EMPLOYEE_ID=200]/EMAIL</code> targets column <code>email</code> of table <code>HR.employees</code>, where <code>employee_id</code> is <code>200</code>.</p>
</li>
<li>
<p>Use the <code>text()</code> XPath node test on data with scalar content. This is the <span class="italic">only</span> node test that can be used, and it cannot be used with the table or row step.</p>
</li>
</ul>
<p>The following can be used in DBUri (XPath) <span class="italic">predicate</span> expressions:</p>
<ul>
<li>
<p>Boolean operators <code>and</code>, <code>or</code>, and <code>not</code></p>
</li>
<li>
<p>Relational operators <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>!=</code>, <code>&gt;=</code>, <code>=</code>, <code>mod</code>, <code>div</code>, <code>*</code> (multiply)</p>
</li>
</ul>
<p>A DBUri XPath expression <span class="italic">must</span> do all of the following:</p>
<ul>
<li>
<p>Use only the <span class="italic">child</span> XPath axis &ndash; other axes, such as parent, are not allowed.</p>
</li>
<li>
<p>Either specify a database schema or specify <code>PUBLIC</code> to resolve the table name without a specific schema.</p>
</li>
<li>
<p>Specify a database view or table name.</p>
</li>
<li>
<p>Include a <code>ROW</code> step, if a database column is targeted.</p>
</li>
<li>
<p>Identify a <span class="italic">single</span> data value, which can be an object-type instance or a collection.</p>
</li>
<li>
<p>Result in well-formed XML when it is used to generate XML data using database data.</p>
<p>An example of a DBUri that does <span class="italic">not</span> result in well-formed XML is <code>/HR/EMPLOYEES/ROW/LAST_NAME</code>. It returns more than one <code>&lt;LAST_NAME&gt;</code> element fragment, with no single root element.</p>
</li>
<li>
<p>Use <span class="italic">none</span> of the following:</p>
<ul>
<li>
<p><code>*</code> (wildcard)</p>
</li>
<li>
<p><code>.</code> (self)</p>
</li>
<li>
<p><code>..</code> (parent)</p>
</li>
<li>
<p><code>//</code> (descendant or self)</p>
</li>
<li>
<p>XPath functions, such as <code>count</code></p>
</li>
</ul>
</li>
</ul>
<p>A DBUri XPath expression can optionally be prefixed by <code><span class="codeinlinebold">/oradb</span></code> or <code><span class="codeinlinebold">/dburi</span></code> (the two are equivalent) to distinguish it. This prefix is case-insensitive. However, the rest of the DBUri XPath expression is <span class="italic">case-sensitive</span>, as are XPath expressions generally. Thus, for example, to specify table <code>HR.employees</code> as a DBUri XPath expression, you must use <code>HR/EMPLOYEES</code>, not <code>hr/employees</code> (or a mixed-case combination), because table and column names are uppercase, by default.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<code><a href="http://www.w3.org/TR/xpath">http://www.w3.org/TR/xpath</a></code> on XPath notation</div>
</div>
<!-- class="sect2" -->
<div id="ADXDB5247" class="sect2"><a id="sthref1310"></a>
<h3 class="sect2">DB<a id="sthref1311"></a>Uris are Scoped to a Database and Session</h3>
<p>The content of the XML views you have of the database, and hence of the XML documents that you can construct, reflects the permissions you have for accessing particular database data at a given time. That is, a DBUri is scoped to a given database session, so the same DBUri can give different results in the same query, depending on the session context (which user is connected and what privileges the user has).</p>
<p>To complicate things a bit, there is also an XML element <code>PUBLIC</code>, under which database data is accessible without any database-schema qualification. This is a convenience feature, but it can also lead to some confusion if you forget that the XML views of the database for a given user depend on the specific access the user has to the database at a given time.</p>
<p>XML element <code>PUBLIC</code> corresponds to the use of a <span class="italic">public synonym</span>. For example, when queried by user <code>quine</code>, the following query tries to match table <code>foo</code> under database schema <code>quine</code>, but if no such table exists, it tries to match a public synonym named <code>foo</code>.</p>
<pre>
SELECT * FROM foo;
</pre>
<p>In the same way, XML element <code>PUBLIC</code> contains all of the database data visible to a given user and all of the data visible to that user through public synonyms. So, the same DBUri URI <code>/PUBLIC/FOO</code> can resolve to <code>quine.foo</code> when user <code>quine</code> is connected, and resolve to <code>curry.foo</code> when user <code>curry</code> is connected.</p>
</div>
<!-- class="sect2" -->
<a id="i1032139"></a>
<div id="ADXDB5248" class="sect2">
<h3 class="sect2"><a id="sthref1312"></a>DBUri Examples</h3>
<p>A DBUri can identify a table, a row, a column in a row, or an attribute of an object column. The following sections describe how to target different object types.</p>
<div id="ADXDB5249" class="sect3"><a id="sthref1313"></a>
<h4 class="sect3">Targeting a Table</h4>
<p>You can target a complete database table, using this syntax:</p>
<pre>
/<span class="italic">database_schema</span>/<span class="italic">table</span>
</pre>
<p><a href="#BABHFEIC">Example 20-6</a> uses a DBUri that targets a complete table. An XML document is returned that corresponds to the table contents. The top-level XML element is named for the table. The values of each row are enclosed in a <code>ROW</code> element.</p>
<div id="ADXDB5250" class="example">
<p class="titleinexample"><a id="BABHFEIC"></a>Example 20-6 Targeting a Complete Table using a DBUri</p>
<pre>
CREATE TABLE uri_tab (url URIType);
Table created.
 
INSERT INTO uri_tab VALUES
       (DBURIType.createURI('/HR/EMPLOYEES'));
1 row created.
 
SELECT e.url.getCLOB() FROM uri_tab e;

E.URL.GETCLOB()
---------------
&lt;?xml version="1.0"?&gt;
&lt;<span class="bold">EMPLOYEES</span>&gt;
 &lt;<span class="bold">ROW</span>&gt;
  &lt;EMPLOYEE_ID&gt;100&lt;/EMPLOYEE_ID&gt;
  &lt;FIRST_NAME&gt;Steven&lt;/FIRST_NAME&gt;
  &lt;LAST_NAME&gt;King&lt;/LAST_NAME&gt;
  &lt;EMAIL&gt;SKING&lt;/EMAIL&gt;
  &lt;PHONE_NUMBER&gt;515.123.4567&lt;/PHONE_NUMBER&gt;
  &lt;HIRE_DATE&gt;17-JUN-03&lt;/HIRE_DATE&gt;
  &lt;JOB_ID&gt;AD_PRES&lt;/JOB_ID&gt;
  &lt;SALARY&gt;24000&lt;/SALARY&gt;
  &lt;DEPARTMENT_ID&gt;90&lt;/DEPARTMENT_ID&gt;
 &lt;/ROW&gt;
 &lt;ROW&gt;
  &lt;EMPLOYEE_ID&gt;101&lt;/EMPLOYEE_ID&gt;
  &lt;FIRST_NAME&gt;Neena&lt;/FIRST_NAME&gt;
  &lt;LAST_NAME&gt;Kochhar&lt;/LAST_NAME&gt;
  &lt;EMAIL&gt;NKOCHHAR&lt;/EMAIL&gt;
  &lt;PHONE_NUMBER&gt;515.123.4568&lt;/PHONE_NUMBER&gt;
  &lt;HIRE_DATE&gt;21-SEP-05&lt;/HIRE_DATE&gt;
  &lt;JOB_ID&gt;AD_VP&lt;/JOB_ID&gt;
  &lt;SALARY&gt;17000&lt;/SALARY&gt;
  &lt;MANAGER_ID&gt;100&lt;/MANAGER_ID&gt;
  &lt;DEPARTMENT_ID&gt;90&lt;/DEPARTMENT_ID&gt;
 &lt;/ROW&gt;
 <span class="bold">. . .</span>
 
1 row selected.
</pre></div>
<!-- class="example" --></div>
<!-- class="sect3" -->
<div id="ADXDB5251" class="sect3"><a id="sthref1314"></a>
<h4 class="sect3">Targeting a <a id="sthref1315"></a>Row in a Table</h4>
<p>You can target one or more specific rows of a table, using this syntax:</p>
<pre>
/<span class="italic">database_schema</span>/<span class="italic">table</span>/ROW[<span class="italic">predicate_expression</span>]
</pre>
<p><a href="#BABIIEEF">Example 20-7</a> uses a DBUri that targets a single table row. The XPath predicate expression identifies the single table row that corresponds to employee number 200. The result is an XML document with <code>ROW</code> as the top-level element.</p>
<div id="ADXDB5252" class="example">
<p class="titleinexample"><a id="BABIIEEF"></a>Example 20-7 Targeting a Particular Row in a Table using a DBUri</p>
<pre>
CREATE TABLE uri_tab (url URIType);
Table created.
 
INSERT INTO uri_tab VALUES
       (DBURIType.createURI('/HR/EMPLOYEES/<span class="bold">ROW[EMPLOYEE_ID=200]</span>'));
1 row created.
 
SELECT e.url.getCLOB() FROM uri_tab e;
 
E.URL.GETCLOB()
-------------------------------------------------------
&lt;?xml version="1.0"?&gt;
 &lt;ROW&gt;
  &lt;EMPLOYEE_ID&gt;<span class="bold">200</span>&lt;/EMPLOYEE_ID&gt;
  &lt;FIRST_NAME&gt;Jennifer&lt;/FIRST_NAME&gt;
  &lt;LAST_NAME&gt;Whalen&lt;/LAST_NAME&gt;
  &lt;EMAIL&gt;JWHALEN&lt;/EMAIL&gt;
  &lt;PHONE_NUMBER&gt;515.123.4444&lt;/PHONE_NUMBER&gt;
  &lt;HIRE_DATE&gt;17-SEP-03&lt;/HIRE_DATE&gt;
  &lt;JOB_ID&gt;AD_ASST&lt;/JOB_ID&gt;
  &lt;SALARY&gt;4400&lt;/SALARY&gt;
  &lt;MANAGER_ID&gt;101&lt;/MANAGER_ID&gt;
  &lt;DEPARTMENT_ID&gt;10&lt;/DEPARTMENT_ID&gt;
 &lt;/ROW&gt;
 
1 row selected.
</pre></div>
<!-- class="example" --></div>
<!-- class="sect3" -->
<div id="ADXDB5253" class="sect3"><a id="sthref1316"></a>
<h4 class="sect3">Targeting a <a id="sthref1317"></a>Column</h4>
<p>You can target a specific column, using this syntax:</p>
<pre>
/<span class="italic">database_schema</span>/<span class="italic">table</span>/ROW[<span class="italic">predicate_expression</span>]/<span class="italic">column</span>
</pre>
<p>You can target a specific attribute of an object column, using this syntax:</p>
<pre>
/<span class="italic">database_schema</span>/<span class="italic">table</span>/ROW[<span class="italic">predicate_expression</span>]/<span class="italic">object_column</span>/<span class="italic">attribute</span>
</pre>
<p>You can target a specific object column whose attributes have specific values, using this syntax:</p>
<pre>
/<span class="italic">database_schema</span>/<span class="italic">table</span>/ROW[<span class="italic">predicate_expression_with_attributes</span>]/<span class="italic">object_column</span>
</pre>
<p><a href="#BABGJBEB">Example 20-8</a> uses a DBUri that targets column <code>last_name</code> for the same employee as in <a href="#BABIIEEF">Example 20-7</a>. The top-level XML element is named for the targeted column.</p>
<div id="ADXDB5254" class="example">
<p class="titleinexample"><a id="BABGJBEB"></a>Example 20-8 Targeting a Specific Column using a DBUri</p>
<pre>
CREATE TABLE uri_tab (url URIType);
Table created.
 
INSERT INTO uri_tab VALUES
       (DBURIType.createURI('/HR/EMPLOYEES/ROW[EMPLOYEE_ID=200]/LAST_NAME'));
1 row created.
 
SELECT e.url.getCLOB() FROM uri_tab e;
 
E.URL.GETCLOB()
------------------------------
&lt;?xml version="1.0"?&gt;
 &lt;LAST_NAME&gt;Whalen&lt;/LAST_NAME&gt;
 
1 row selected.
</pre></div>
<!-- class="example" -->
<p><a href="#CBAEGIHJ">Example 20-9</a> uses a DBUri that targets a <code>CUST_ADDRESS</code> object column containing city and postal code attributes with certain values. The top-level XML element is named for the column, and it contains child elements for each of the object attributes.</p>
<div id="ADXDB5255" class="example">
<p class="titleinexample"><a id="CBAEGIHJ"></a>Example 20-9 Targeting an Object Column with Specific Attribute Values using a DBUri</p>
<pre>
CREATE TABLE uri_tab (url URIType);
Table created.
 
INSERT INTO uri_tab VALUES
  (DBURIType.createURI(
     '/OE/CUSTOMERS/ROW[CUST_ADDRESS/CITY="Poughkeepsie" and
                        CUST_ADDRESS/POSTAL_CODE=12601]/CUST_ADDRESS'));
1 row created.
 
SELECT e.url.getCLOB() FROM uri_tab e;
 
E.URL.GETCLOB()
---------------
&lt;?xml version="1.0"?&gt;
 &lt;CUST_ADDRESS&gt;
  &lt;STREET_ADDRESS&gt;33 Fulton St&lt;/STREET_ADDRESS&gt;
  &lt;POSTAL_CODE&gt;12601&lt;/POSTAL_CODE&gt;
  &lt;CITY&gt;Poughkeepsie&lt;/CITY&gt;
  &lt;STATE_PROVINCE&gt;NY&lt;/STATE_PROVINCE&gt;
  &lt;COUNTRY_ID&gt;US&lt;/COUNTRY_ID&gt;
 &lt;/CUST_ADDRESS&gt;
 
1 row selected.
</pre>
<p>The DBUri identifies the object that has a <code>CITY</code> attribute with <code>Poughkeepsie</code> as value and a <code>POSTAL_CODE</code> attribute with <code>12601</code> as value.</p>
</div>
<!-- class="example" --></div>
<!-- class="sect3" -->
<div id="ADXDB5256" class="sect3"><a id="sthref1318"></a>
<h4 class="sect3">Retrieving the <a id="sthref1319"></a>Text Value of a Column</h4>
<p>In many cases, it can be useful to retrieve only the text values of a column and not the enclosing tags. For example, if XSLT style sheets are stored in a <code>CLOB</code> column, you can retrieve the document text without having any enclosing column-name tags. You can use the <code>text()</code> XPath node test for this. It specifies that you want only the text value of the node. Use the following syntax:</p>
<pre>
/oradb/<span class="italic">database_schema</span>/<span class="italic">table</span>/ROW[<span class="italic">predicate_expression</span>]/<span class="italic">column</span>/<span class="bold">text()</span>
</pre>
<p><a href="#CBAGJCHE">Example 20-10</a> retrieves the text value of the employee <code>last_name</code> column for employee number 200, without the XML tags.</p>
<div id="ADXDB5257" class="example">
<p class="titleinexample"><a id="CBAGJCHE"></a>Example 20-10 Retrieve Only the Text Value of a Node using a DBUri</p>
<pre>
CREATE TABLE uri_tab (url URIType);
Table created.

INSERT INTO uri_tab VALUES
       (DBURIType.createURI(
          '/HR/EMPLOYEES/ROW[EMPLOYEE_ID=200]/LAST_NAME/text()'));

1 row created.

SELECT e.url.getCLOB() FROM uri_tab e;

E.URL.GETCLOB()
---------------
Whalen
 
1 row selected.
</pre></div>
<!-- class="example" --></div>
<!-- class="sect3" -->
<div id="ADXDB5258" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1320"></a>
<h4 class="sect3">Targeting a Collection</h4>
<p>You can target a database collection, such as an ordered collection table. You must, however, target the entire collection &ndash; you cannot target individual members of a collection. When a collection is targeted, the XML document produced by the DBUri contains each collection member as an XML element, with all such elements enclosed in a element named for the <span class="italic">type</span> of the collection.</p>
<p><a href="#CBABCBGH">Example 20-11</a> uses a DBUri that targets a collection of numbers. The top-level XML element is named for the collection, and its children are named for the collection <span class="italic">type</span> (<code>NUMBER</code>).</p>
<div id="ADXDB5259" class="example">
<p class="titleinexample"><a id="CBABCBGH"></a>Example 20-11 Targeting a Collection using a DBUri</p>
<pre>
CREATE TYPE num_collection AS VARRAY(10) OF NUMBER;
/
Type created.
 
CREATE TABLE orders (item VARCHAR2(10), quantities num_collection);
Table created.
 
INSERT INTO orders VALUES ('boxes', num_collection(3, 7, 4, 9));
1 row created.
 
SELECT * FROM orders;
 
ITEM
----
QUANTITIES
----------
boxes
NUM_COLLECTION(3, 7, 4, 9)
 
1 row selected.
 
SELECT DBURIType('/HR/ORDERS/ROW[ITEM="boxes"]/QUANTITIES').getCLOB() FROM DUAL;
 
DBURITYPE('/HR/ORDERS/ROW[ITEM="BOXES"]/QUANTITIES').GETCLOB()
--------------------------------------------------------------
&lt;?xml version="1.0"?&gt;
 &lt;QUANTITIES&gt;
  &lt;NUMBER&gt;3&lt;/NUMBER&gt;
  &lt;NUMBER&gt;7&lt;/NUMBER&gt;
  &lt;NUMBER&gt;4&lt;/NUMBER&gt;
  &lt;NUMBER&gt;9&lt;/NUMBER&gt;
 &lt;/QUANTITIES&gt;
 
1 row selected.
</pre></div>
<!-- class="example" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1025294"></a>
<div id="ADXDB5260" class="sect1">
<h2 class="sect1"><a id="sthref1321"></a><a id="sthref1322"></a>Creating New Subtypes of URIType using Package URIFACTORY</h2>
<p>You can use PL/SQL package <code>URIFACTORY</code> to do more than create <code>URIType</code> instances. Additional PL/SQL methods are listed in <a href="#g1047970">Table 20-2</a>.</p>
<div id="ADXDB5261" class="tblhruleformalwide">
<p class="titleintable"><a id="sthref1323"></a><a id="g1047970"></a>Table 20-2 URIFACTORY PL/SQL Methods</p>
<table class="cellalignment1032" title="URIFACTORY PL/SQL Methods" summary="This table describes UriFactory functions and procedures." dir="ltr">
<thead>
<tr class="cellalignment1020">
<th class="cellalignment1027" id="r1c1-t12">PL/SQL Method</th>
<th class="cellalignment1027" id="r1c2-t12">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r2c1-t12" headers="r1c1-t12">
<pre>
getURI()
</pre></td>
<td class="cellalignment1028" headers="r2c1-t12 r1c2-t12">
<p>Returns the URL of the <code>URIType</code> instance.</p>
</td>
</tr>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r3c1-t12" headers="r1c1-t12">
<p><code>escapeURI()</code></p>
</td>
<td class="cellalignment1028" headers="r3c1-t12 r1c2-t12">
<p>Escapes the URI string by replacing characters that are not permitted in URIs by their equivalent escape sequence.</p>
</td>
</tr>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r4c1-t12" headers="r1c1-t12">
<p><code>unescapeURI()</code></p>
</td>
<td class="cellalignment1028" headers="r4c1-t12 r1c2-t12">
<p>Removes escaping from a given URI.</p>
</td>
</tr>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r5c1-t12" headers="r1c1-t12">
<p><code>registerURLHandler()</code></p>
</td>
<td class="cellalignment1028" headers="r5c1-t12 r1c2-t12">
<p>Registers a particular type name for handling a particular URL. This is called by <code>getURI()</code> to generate an instance of the type.</p>
<p>A Boolean argument can be used to indicate that the prefix must be stripped off before calling the appropriate type constructor.</p>
</td>
</tr>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r6c1-t12" headers="r1c1-t12">
<p><code>unregisterURLHandler()</code></p>
</td>
<td class="cellalignment1028" headers="r6c1-t12 r1c2-t12">
<p>Unregisters a URL handler.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformalwide" -->
<p>Of particular note is that you can use package <code>URIFACTORY</code> to define new subtypes of type <code>URIType</code>. You can then use those subtypes to provide specialized processing of URIs. In particular, you can define <code>URIType</code> subtypes that correspond to particular protocols &ndash; <code>URIFACTORY</code> then recognizes and processes instances of those subtypes accordingly.</p>
<p>Defining new types and creating database columns specific to the new types has these advantages:</p>
<ul>
<li>
<p>It provides an implicit <span class="italic">constraint</span> on the columns to contain only instances of those types. This can be useful for implementing specialized indexes on a column for specific protocols. For a DBUri, for instance, you can implement specialized indexes that fetch data directly from disk blocks, rather than executing SQL queries.</p>
</li>
<li>
<p>You can have different constraints on different columns, based on the type. For a HTTPUri, for instance, you can define proxy and firewall constraints on a column, so that any access through the HTTP uses the proxy server.</p>
</li>
</ul>
<a id="i1030939"></a>
<div id="ADXDB5262" class="sect2">
<h3 class="sect2">Registering New URIType Subtypes with Package URIFACTORY</h3>
<p>To provide specialized processing of URIs, you define and register a new URIType subtype, as follows:</p>
<ol>
<li>
<p>Create the new type using SQL statement <code>CREATE TYPE</code>. The type must implement PL/SQL method <code>createURI()</code>.</p>
</li>
<li>
<p>Optionally override the default methods, to perform specialized processing when retrieving data or to transform the XML data before displaying it.</p>
</li>
<li>
<p>Choose a new URI prefix, to identify URIs that use this specialized processing.</p>
</li>
<li>
<p>Register the new prefix using PL/SQL method <code>registerURLHandler()</code>, so that package <code>URIFACTORY</code> can create an instance of your new subtype when it receives a URI starting with the new prefix you defined.</p>
</li>
</ol>
<p>After the new subtype is defined, a URI with the new prefix is recognized by <code>URIFACTORY</code> methods, and you can create and use instances of the new type.</p>
<p>For example, suppose that you define a new protocol prefix, <code>ecom://</code>, and define a subtype of <code>URIType</code> to handle it. Perhaps the new subtype implements some special logic for PL/SQL method <code>getCLOB()</code>, or perhaps it makes some changes to XML tags or data in method <code>getXML()</code>. After you register prefix <code>ecom://</code> with <code>URIFACTORY</code>, a call to <code>getURI()</code> generates an instance of the new <code>URIType</code> subtype for a URI with that prefix.</p>
<p><a href="#CBAHBBAG">Example 20-12</a> creates a new type, <code>ECOMURIType</code>, to handle a new protocol, <code>ecom://</code>. The example stores three different kinds of URIs in a single table: an HTTPUri, a DBUri, and an instance of the new type, <code>ECOMURIType</code>. To run this example, you would need to define each of the <code>ECOMURIType</code> member functions.</p>
<div id="ADXDB5263" class="example">
<p class="titleinexample"><a id="CBAHBBAG"></a>Example 20-12 URIFACTORY: Registering the ECOM Protocol</p>
<pre>
CREATE TABLE url_tab (urlcol varchar2(80));
Table created.
 
-- Insert an HTTP URL reference
INSERT INTO url_tab VALUES ('http://www.oracle.com/');
1 row created.
 
-- Insert a DBUri
INSERT INTO url_tab VALUES ('/oradb/HR/EMPLOYEES/ROW[FIRST_NAME="Jack"]');
1 row created.
 
-- Create a new type to handle a new protocol called ecom://
-- This is just an example template. For this to run, the implementations
-- of these functions must be specified.
CREATE OR REPLACE TYPE ECOMURIType UNDER SYS.URIType (
  OVERRIDING MEMBER FUNCTION getCLOB RETURN CLOB,
  OVERRIDING MEMBER FUNCTION getBLOB RETURN BLOB,
  OVERRIDING MEMBER FUNCTION getExternalURL RETURN VARCHAR2,
  OVERRIDING MEMBER FUNCTION getURI RETURN VARCHAR2,
  -- Must have this for registering with the URL handler
  STATIC FUNCTION createURI(url IN VARCHAR2) RETURN ECOMURIType);
/
-- Register a new handler for the ecom:// prefixes
BEGIN
  -- The handler type name is ECOMURIType; schema is HR
  -- Ignore the prefix case, so that URIFACTORY creates the same subtype
  -- for URIs beginning with ECOM://, ecom://, eCom://, and so on.
  -- Strip the prefix before calling PL/SQL method createURI(),
  -- so that the string 'ecom://' is not stored inside the
  -- ECOMURIType object. It is added back automatically when
  -- you call ECOMURIType.getURI().
  URIFACTORY.registerURLHandler (prefix =&gt; 'ecom://',
                                 schemaname =&gt; 'HR',
                                 typename =&gt; 'ECOMURITYPE',
                                 ignoreprefixcase =&gt; TRUE,
                                 stripprefix =&gt; TRUE);
END;
/
PL/SQL procedure successfully completed.
 
-- Insert this new type of URI into the table
INSERT INTO url_tab VALUES ('ECOM://company1/company2=22/comp');
1 row created.
 
-- Use the factory to generate an instance of the appropriate
-- subtype for each URI in the table.

-- You would need to define the member functions for this to work:
SELECT urifactory.getURI(urlcol) FROM url_tab;

-- This would generate:
HTTPURIType('www.oracle.com'); -- an HTTPUri
DBURIType('/oradb/HR/EMPLOYEES/ROW[FIRST_NAME="Jack"]', null); -- a DBUri
ECOMURIType('company1/company2=22/comp'); -- an ECOMURIType instance
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1025408"></a>
<div id="ADXDB5264" class="sect1">
<h2 class="sect1">SYS_DBURIGEN SQL <a id="sthref1324"></a><a id="sthref1325"></a>Function</h2>
<p>You can create a DBUri by providing an XPath expression to constructor <code>DBURIType</code> or to appropriate <code>URIFACTORY</code> PL/SQL methods. With Oracle SQL function <code>sys_DburiGen</code>, you can alternatively create a DBUri with an <span class="italic">XPath that is composed</span> from database columns and their values.</p>
<p>Oracle SQL function <code>sys_DburiGen</code> takes as its argument one or more database columns or attributes, and optionally a rowid, and generates a DBUri that targets a particular column or row object. Function <code>sys_DburiGen</code> takes an additional parameter that indicates whether the text value of the node is needed. See <a href="#i1030921">Figure 20-2</a>.</p>
<div id="ADXDB5265" class="figure">
<p class="titleinfigure"><a id="i1030921"></a>Figure 20-2 SYS_DBURIGEN Syntax</p>
<img width="661" height="95" src="img/sys_dburigen.gif" alt="Description of Figure 20-2 follows" /><br />
<a id="sthref1326" href="img_text/sys_dburigen.htm">Description of "Figure 20-2 SYS_DBURIGEN Syntax"</a><br />
<br /></div>
<!-- class="figure" -->
<p>All columns or attributes referenced must reside in the same table. They must each reference a unique value. If you specify multiple columns, then the initial columns identify the row, and the last column identifies the column within that row. If you do not specify a database schema, then the table name is interpreted as a public synonym.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF" href="../../server.112/e41084/toc.htm"><span class="italic">Oracle Database SQL Language Reference</span></a></div>
<p><a href="#CBAHAHIB">Example 20-13</a> uses Oracle SQL function <code>sys_DburiGen</code> to generate a DBUri that targets column <code>email</code> of table <code>HR.employees</code> where <code>employee_id</code> is <code>206</code>:</p>
<div id="ADXDB5266" class="example">
<p class="titleinexample"><a id="CBAHAHIB"></a>Example 20-13 SYS_DBURIGEN: <a id="sthref1327"></a>Generating a DBUri that Targets a Column</p>
<pre>
SELECT sys_DburiGen(employee_id, email)
  FROM employees
  WHERE employee_id = 206;

SYS_DBURIGEN(EMPLOYEE_ID,EMAIL)(URL, SPARE)
-------------------------------------------------------------------
DBURITYPE('/PUBLIC/EMPLOYEES/ROW[EMPLOYEE_ID = "206"]/EMAIL', NULL)

1 row selected.
</pre></div>
<!-- class="example" -->
<div id="ADXDB5267" class="sect2"><a id="sthref1328"></a>
<h3 class="sect2">Rules for Passing Columns or Object Attributes to <a id="sthref1329"></a>SYS_DBURIGEN</h3>
<p>A column or attribute passed to Oracle SQL function <code>sys_DburiGen</code> must obey the following rules:</p>
<ul>
<li>
<p><span class="italic">Same table:</span> All columns referenced in function <code>sys_DburiGen</code> must come from the same table or view.</p>
</li>
<li>
<p><span class="italic">Unique mapping:</span> The column or object attribute must be uniquely mappable back to the table or view from which it came. The only virtual columns allowed are those produced with <code>value</code> or <code>ref</code>. The column can come from a subquery with a SQL <code>TABLE</code> collection expression, that is, <code>TABLE(...)</code>, or from an inline view (as long as the inline view does not rename the columns).</p>
<p>See <a class="olink SQLRF30047" href="../../server.112/e41084/statements_10002.htm#SQLRF30047"><span class="italic">Oracle Database SQL Language Reference</span></a> for information about the SQL <code>TABLE</code> collection expression.</p>
</li>
<li>
<p><span class="italic">Key columns:</span> Either the rowid or a set of key columns must be specified. The list of key columns is not required to be declared as a unique or primary key, as long as the columns uniquely identify a particular row in the result.</p>
</li>
<li>
<p><code><span class="codeinlinebold">PUBLIC</span></code> <span class="italic">element:</span> If the table or view targeted by the rowid or key columns does not specify a database schema, then the <code>PUBLIC</code> keyword is used. When a DBUri is accessed, the table name resolves to the same table, synonym, or database view that was visible by that name when the DBUri was created.</p>
</li>
<li>
<p><span class="italic">Optional</span> <code><span class="codeinlinebold"><a id="sthref1330"></a>text()</span></code> <span class="italic">argument:</span> By default, <code>DBURIType</code> constructs an XML document. Use <code>text()</code> as the third argument to <code>sys_DburiGen</code> to create a DBUri that targets a text node (no XML elements). For example:</p>
<pre>
SELECT sys_DburiGen(employee_id, last_name, 'text()') FROM hr.employees,
  WHERE employee_id=200;
</pre>
<p>This constructs a DBUri with the following URI:</p>
<pre>
/HR/EMPLOYEES/ROW[EMPLOYEE_ID=200]/LAST_NAME/text()
</pre></li>
<li>
<p><span class="italic">Single-column argument:</span> If there is a single-column argument, then the column is used as both the key column to identify the row and the referenced column.</p>
</li>
</ul>
<p>The query in <a href="#CBAHEEEI">Example 20-14</a> uses <code>employee_id</code> as both the key column and the referenced column. It generates a DBUri that targets the row with <code>employee_id</code> 200.</p>
<div id="ADXDB5268" class="example">
<p class="titleinexample"><a id="CBAHEEEI"></a>Example 20-14 Passing Columns with Single Arguments to SYS_DBURIGEN</p>
<pre>
SELECT sys_DburiGen(employee_id) FROM employees
  WHERE employee_id=200;
 
SYS_DBURIGEN(EMPLOYEE_ID)(URL, SPARE)
-------------------------------------
DBURITYPE('/PUBLIC/EMPLOYEES/ROW[EMPLOYEE_ID=''200'']/EMPLOYEE_ID', NULL)
 
1 row selected.
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<div id="ADXDB5269" class="sect2"><a id="sthref1331"></a>
<h3 class="sect2"><a id="sthref1332"></a>SYS_DBURIGEN SQL Function: Examples</h3>
<div id="ADXDB5270" class="example">
<p class="titleinexample"><a id="sthref1333"></a>Example 20-15 Inserting Database References using SYS_DBURIGEN</p>
<pre>
CREATE TABLE doc_list_tab (docno NUMBER PRIMARY KEY, doc_ref SYS.DBURIType);
Table created.

-- Insert a DBUri that targets the row with employee_id=177
INSERT INTO doc_list_tab VALUES(1001, (SELECT sys_DburiGen(rowid, employee_id)
                                         FROM employees WHERE employee_id=177));
1 row created.
 
-- Insert a DBUri that targets the last_name column of table employees
INSERT INTO doc_list_tab VALUES(1002,
                                (SELECT sys_DburiGen(employee_id, last_name)
                                   FROM employees WHERE employee_id=177));
1 row created.
 
SELECT * FROM doc_list_tab;
 
     DOCNO
----------
DOC_REF(URL, SPARE)
-----------------------------------------------------
      1001
DBURITYPE('/PUBLIC/EMPLOYEES/ROW[ROWID=''AAAQCcAAFAAAABSABN'']/EMPLOYEE_ID', NULL)
 
      1002
DBURITYPE('/PUBLIC/EMPLOYEES/ROW[EMPLOYEE_ID=''177'']/LAST_NAME', NULL)
 
2 rows selected.
</pre></div>
<!-- class="example" -->
<div id="ADXDB5911" class="sect3"><a id="sthref1334"></a>
<h4 class="sect3">Returning Partial Results</h4>
<p>When selecting from a large column, you might sometimes want to retrieve only a portion of the result, and create a URL to the column instead. For example, consider the case of a travel story Web site. If travel stories are stored in a table, and users search for a set of relevant stories, then you do not want to list each entire story in the search-result page. Instead, you might show just the first 20 characters of each story, to represent the gist, and then return a URL to the full story. This can be done as follows:</p>
<p><a href="#CBAFABCA">Example 20-16</a> creates the travel story table.</p>
<div id="ADXDB5272" class="example">
<p class="titleinexample"><a id="CBAFABCA"></a>Example 20-16 Creating the Travel Story Table</p>
<pre>
CREATE TABLE travel_story (story_name VARCHAR2(100), story CLOB);
Table created.

INSERT INTO travel_story
  VALUES ('Egypt', 'This is the story of my time in Egypt....');
1 row created.
</pre></div>
<!-- class="example" -->
<p><a href="#CBAGCAJC">Example 20-17</a> creates a function that returns only the first 20 characters from the story.</p>
<div id="ADXDB5912" class="example">
<p class="titleinexample"><a id="CBAGCAJC"></a>Example 20-17 A Function that Returns the First 20 Characters</p>
<pre>
CREATE OR REPLACE FUNCTION charfunc(clobval IN CLOB) RETURN VARCHAR2 IS
  res VARCHAR2(20);
  amount NUMBER := 20;
BEGIN
  DBMS_LOB.read(clobval, amount, 1, res);
  RETURN res;
END;
/
Function created.
</pre></div>
<!-- class="example" -->
<p><a href="#CBAGFCHF">Example 20-18</a> creates a view that selects only the first twenty characters from the travel story, and returns a DBUri to the story column.</p>
<div id="ADXDB5913" class="example">
<p class="titleinexample"><a id="CBAGFCHF"></a>Example 20-18 Creating a Travel View for Use with SYS_DBURIGEN</p>
<pre>
CREATE OR REPLACE VIEW travel_view AS
  SELECT story_name, charfunc(story) short_story,
         sys_DburiGen(story_name, story, 'text()') story_link
  FROM travel_story;
View created.
 
SELECT * FROM travel_view;
 
STORY_NAME
----------
SHORT_STORY
-----------
STORY_LINK(URL, SPARE)
----------------------
Egypt
This is the story of
DBURITYPE('/PUBLIC/TRAVEL_STORY/ROW[STORY_NAME=''Egypt'']/STORY/text()', NULL)
 
1 row selected.
</pre></div>
<!-- class="example" --></div>
<!-- class="sect3" -->
<div id="ADXDB5914" class="sect3"><a id="sthref1335"></a>
<h4 class="sect3">RETURNING URLs to Inserted Objects</h4>
<p>You can use Oracle SQL function <code><a id="sthref1336"></a>sys_DburiGen</code> in the <code>RETURNING</code> clause of DML statements to retrieve the URL of an object as it is inserted.</p>
<p>In <a href="#CBAFEDEH">Example 20-19</a>, whenever a document is inserted into table <code>clob_tab</code>, its URL is inserted into table <code>uri_tab</code>. This is done using Oracle SQL function <code><a id="sthref1337"></a>sys_DburiGen</code> in the <code>RETURNING</code> clause of the <code>INSERT</code> statement.</p>
<div id="ADXDB5274" class="example">
<p class="titleinexample"><a id="CBAFEDEH"></a>Example 20-19 Retrieving a URL using SYS_DBURIGEN in RETURNING Clause</p>
<pre>
CREATE TABLE clob_tab (docid NUMBER, doc CLOB);
Table created.

CREATE TABLE uri_tab (docs SYS.DBURIType);
Table created.
</pre>
<p>In PL/SQL, specify the storage of the URL of the inserted document as part of the insertion operation, using the <code>RETURNING</code> clause and <code>EXECUTE IMMEDIATE</code>:</p>
<pre>
DECLARE
  ret SYS.DBURIType;
BEGIN
  -- execute the insert operation and get the URL
  EXECUTE IMMEDIATE 
    'INSERT INTO clob_tab VALUES (1, ''TEMP CLOB TEST'') 
       RETURNING sys_DburiGen(docid, doc, ''text()'') INTO :1'
    RETURNING INTO ret;
  -- Insert the URL into uri_tab
  INSERT INTO uri_tab VALUES (ret);
END;
/

SELECT e.docs.getURL() FROM hr.uri_tab e;
E.DOCS.GETURL()
------------------------------------------------
/ORADB/PUBLIC/CLOB_TAB/ROW[DOCID='1']/DOC/text()
 
1 row selected.
</pre></div>
<!-- class="example" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1025534"></a>
<div id="ADXDB5275" class="sect1">
<h2 class="sect1"><a id="sthref1338"></a><a id="sthref1339"></a><a id="sthref1340"></a>DBUriServlet</h2>
<p>Oracle XML&nbsp;DB Repository resources can be retrieved using the HTTP server that is incorporated in Oracle XML&nbsp;DB. Oracle Database also includes a servlet, <span class="glossaryterm"><a id="sthref1341"></a>DBUriServlet</span>, that makes any kind of database data available through HTTP(S) URLs. The data can be returned as plain text, HTML, or XML.</p>
<p>A Web client or application can access such data without using SQL or a specialized database API. You can retrieve the data by linking to it on a Web page or by requesting it through HTTP-aware APIs of Java, PL/SQL, and Perl. You can display or process the data using an application such as a Web browser or an XML-aware spreadsheet. DBUriServlet can generate content that is XML data or not, and it can transform the result using XSLT style sheets.</p>
<p>You make database data Web-accessible by using a URI that is composed of a servlet address (URL) plus a DBUri URI that specifies which database data to retrieve. This is the syntax, where <code>http://</code><code><span class="codeinlineitalic">server:port</span></code> is the URL of the servlet (server and port), and <code>/oradb/</code><code><span class="codeinlineitalic">database_schema</span></code><code>/</code><code><span class="codeinlineitalic">table</span></code> is the DBUri URI (any DBUri URI can be used):</p>
<pre>
http://<span class="italic">server</span>:<span class="italic">port</span>/<span class="bold">oradb</span>/<span class="italic">database_schema</span><span class="italic">/</span><span class="italic">table</span>
</pre>
<p>When using XPath notation in a URL for the servlet, you might need to escape certain characters. You can use <code>URIType</code> PL/SQL method <code>getExternalURL()</code> to do this.</p>
<p>You can either use <code>DBUriServlet</code>, which is pre-installed as part of Oracle XML&nbsp;DB, or write your own servlet that runs on a servlet engine. The servlet reads the URI portion of the invoking URL, creates a DBUri using that URI, calls <code>URIType</code> PL/SQL methods to retrieve the data, and returns the values in a form such as a Web page, an XML document, or a plain-text document.</p>
<p>The MIME type to use is specified to the servlet through the URI:</p>
<ul>
<li>
<p>By default, the servlet produces MIME types <code>text/xml</code> and <code>text/plain</code>. If the DBUri path ends in <code>text()</code>, then <code>text/plain</code> is used. Otherwise, an XML document is generated with MIME type <code>text/xml</code>.</p>
</li>
<li>
<p>You can override the default MIME type, setting it to <code>binary/x-jpeg</code> or some other value, by using the <code>contenttype</code> argument to the servlet.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="xdb23jv1.htm#g1050187">Chapter 32, "Writing Oracle XML&nbsp;DB Applications in Java"</a>, for information about Oracle XML&nbsp;DB servlets</div>
<p><a href="#g1049621">Table 20-3</a> describes each of the optional URL parameters you can pass to DBUriServlet to customize its output.</p>
<div id="ADXDB5277" class="tblhruleformal">
<p class="titleintable"><a id="sthref1342"></a><a id="g1049621"></a>Table 20-3 DBUriServlet: Optional Arguments</p>
<table class="cellalignment1032" title="DBUriServlet: Optional Arguments " summary="This table describes the DBUri Servlet optional arguments." dir="ltr">
<thead>
<tr class="cellalignment1020">
<th class="cellalignment1027" id="r1c1-t15">Argument</th>
<th class="cellalignment1027" id="r1c2-t15">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r2c1-t15" headers="r1c1-t15">
<pre>
rowsettag
</pre></td>
<td class="cellalignment1028" headers="r2c1-t15 r1c2-t15">
<p>Changes the default root tag name for the XML document. For example:</p>
<pre>
http://<span class="italic">server</span>:8080/oradb/HR/EMPLOYEES<span class="bold">?rowsettag=OracleEmployees</span>
</pre></td>
</tr>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r3c1-t15" headers="r1c1-t15">
<pre>
contenttype
</pre></td>
<td class="cellalignment1028" headers="r3c1-t15 r1c2-t15">
<p>Specifies the MIME type of the generated document. For example:</p>
<pre>
http://<span class="italic">server</span>:8080/oradb/HR/EMPLOYEES<span class="bold">?contenttype=text/plain</span>
</pre></td>
</tr>
<tr class="cellalignment1020">
<td class="cellalignment1028" id="r4c1-t15" headers="r1c1-t15">
<pre>
transform
</pre></td>
<td class="cellalignment1028" headers="r4c1-t15 r1c2-t15">
<p>Passes a URL to <code>URIFACTORY</code>, which retrieves the XSL style sheet at that location. This style sheet is then applied to the XML document being returned by the servlet. For example:</p>
<pre>
http://<span class="italic">server</span>:8080/oradb/HR/EMPLOYEES<span class="bold">?transform=/oradb/QUINE/XSLS/DOC/text()</span>&amp;contenttype=text/html
</pre></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<div id="ADXDB5915" class="sect2"><a id="sthref1343"></a>
<h3 class="sect2">Overriding the <a id="sthref1344"></a>MIME Type using a URL</h3>
<p>To retrieve the <code>employee_id</code> column of the <code>employee</code> table, you can use a URL such as one of the following, where computer <code><span class="codeinlineitalic">server.oracle.com</span></code> is running Oracle Database with a Web service listening to requests on port 8080. Step <code>oradb</code> is the virtual path that maps to the servlet.</p>
<ul>
<li>
<pre>
http://<span class="italic">server.oracle.com</span>:8080/oradb/QUINE/A/ROW[B=200]/C/text()
</pre>
<p>Produces a content type of text/plain</p>
</li>
<li>
<pre>
http://<span class="italic">server.oracle.com</span>:8080/oradb/QUINE/A/ROW[B=200]/C
</pre>
<p>Produces a content type of text/xml</p>
</li>
</ul>
<p>To override the content type, you can use a URL that passes <code>text/html</code> to the servlet as the <code>contenttype</code> parameter:</p>
<ul>
<li>
<pre>
http://<span class="italic">server.oracle.com</span>:8080/oradb/QUINE/A/ROW[B=200]/C<span class="bold">?contenttype=text/html</span>
</pre>
<p>Produces a content type of text/html</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<div id="ADXDB5278" class="sect2"><a id="sthref1345"></a>
<h3 class="sect2">Customizing <a id="sthref1346"></a>DBUriServlet</h3>
<p>DBUriServlet is built into the database &ndash; to customize the servlet, you must edit the Oracle XML&nbsp;DB configuration file, <code>xdbconfig.xml</code>. You can edit it with database schema (user account) <code>XDB</code>, using WebDAV, FTP, Oracle Enterprise Manager, or PL/SQL. To update the file using FTP or WebDAV, download the document, edit it, and save it back into the database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="xdb23jv1.htm#g1050187">Chapter 32, "Writing Oracle XML&nbsp;DB Applications in Java"</a></p>
</li>
<li>
<p><a href="appaman.htm#g645751">Chapter 34, "Administering Oracle XML&nbsp;DB"</a></p>
</li>
<li>
<p><a class="olink TDPSG20030" href="../../server.112/e10575/tdpsg_user_accounts.htm#TDPSG20030"><span class="italic">Oracle Database 2 Day + Security Guide</span></a> for information about database schema <code>XDB</code></p>
</li>
</ul>
</div>
<p>DBUriServlet is installed at <code>/oradb/*</code>, which is the address specified in the <code>servlet-pattern</code> tag of <code>xdbconfig.xml</code>. The asterisk (<code>*</code>) is necessary to indicate that any path following <code>oradb</code> is to be mapped to the same servlet. <code>oradb</code> is published as the virtual path. You can change the path that is used to access the servlet.</p>
<p>In <a href="#CBABGAJC">Example 20-20</a>, the configuration file is modified to install DBUriServlet under <code>/dburi/*</code>.</p>
<div id="ADXDB5279" class="example">
<p class="titleinexample"><a id="CBABGAJC"></a>Example 20-20 Changing the Installation Location of DBUriServlet</p>
<pre>
DECLARE
  doc XMLType;
  doc2 XMLType;
BEGIN
  doc := DBMS_XDB.cfg_get();
  SELECT 
    updateXML(doc,
'/xdbconfig/sysconfig/protocolconfig/httpconfig/webappconfig/servletconfig/
servlet-mappings/servlet-mapping[servlet-name="DBUriServlet"]/<span class="bold">servlet-pattern</span>/
text()', 
              '<span class="bold">/dburi/*</span>')
    INTO doc2 FROM DUAL;
  DBMS_XDB.cfg_update(doc2);
  COMMIT;
END;
/
</pre></div>
<!-- class="example" -->
<p>Security parameters, the servlet display-name, and the description can also be customized in configuration file <code>xdbconfig.xml</code>. The servlet can be removed by deleting its servlet-pattern. This can also be done using Oracle SQL function <code>updateXML</code> to update the servlet-mapping element to <code>NULL</code>.</p>
</div>
<!-- class="sect2" -->
<div id="ADXDB5280" class="sect2"><a id="sthref1347"></a>
<h3 class="sect2"><a id="sthref1348"></a><a id="sthref1349"></a>DBUriServlet Security</h3>
<p>Servlet security is handled by Oracle Database using roles. When users log in to the servlet, they use their database user name and password. The servlet checks to ensure that the user logging has one of the roles specified in the configuration file using parameter <code>security-role-ref</code>). By default, the servlet is available to role <code><a id="sthref1350"></a><a id="sthref1351"></a>authenticatedUser</code>, and any user who logs into the servlet with a valid database password has this role.</p>
<p>The role parameter can be changed to restrict access to any specific database roles. To change from the default <code>authenticatedUser</code> role to a role that you have created, you modify the Oracle XML&nbsp;DB configuration file.</p>
<p><a href="#CBABCHAE">Example 20-21</a> changes the default role <code>authenticatedUser</code> to role <code>servlet-users</code> (which you must have created).</p>
<div id="ADXDB5281" class="example">
<p class="titleinexample"><a id="CBABCHAE"></a>Example 20-21 Restricting Servlet Access to a Database Role</p>
<pre>
DECLARE
  doc  XMLType;
  doc2 XMLType;
  doc3 XMLType;
BEGIN
  doc := DBMS_XDB.cfg_get();
  SELECT updateXML(doc,
'/xdbconfig/sysconfig/protocolconfig/httpconfig/webappconfig/servletconfig/
servlet-list/servlet[servlet-name="DBUriServlet"]/security-role-ref/<span class="bold">role-name</span>/
text()',
                   '<span class="bold">servlet-users</span>')
    INTO doc2 FROM DUAL;
  SELECT updateXML(doc2,
'/xdbconfig/sysconfig/protocolconfig/httpconfig/webappconfig/servletconfig/
servlet-list/servlet[servlet-name="DBUriServlet"]/security-role-ref/<span class="bold">role-link</span>/
text()',
                   '<span class="bold">servlet-users</span>')
    INTO doc3 FROM DUAL;
  DBMS_XDB.cfg_update(doc3);
  COMMIT;
END;
/
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<div id="ADXDB5282" class="sect2"><a id="sthref1352"></a>
<h3 class="sect2">Configuring Package <a id="sthref1353"></a><a id="sthref1354"></a>URIFACTORY to Handle DBUris</h3>
<p>A URL such as <code>http://</code><code><span class="codeinlineitalic">server</span></code><code>/</code><code><span class="codeinlineitalic">servlets</span></code><code>/</code><code><span class="codeinlinebold">oradb</span></code> is handled by DBUriServlet (or by a custom servlet). When a URL such as this is stored as a <code>URIType</code> instance, it is generally desirable to use subtype <code>DBURIType</code>, since this URI targets database data.</p>
<p>However, if a <code>URIType</code> instance is created using PL/SQL methods of package <code>URIFACTORY</code>, then, by default, the subtype used is <code>HTTPURIType</code>, not <code>DBURIType</code>. This is because <code>URIFACTORY</code> looks only at the URI prefix, sees <code>http://</code>, and assumes that the URI targets a Web page. This results in unnecessary layers of communication and perhaps extra character conversions.</p>
<p>To make things more efficient, you can teach <code>URIFACTORY</code> that URIs of the given form represent database accesses and so should be realized as DBUris, not HTTPUris. You do this by registering a handler for this URI as a prefix, specifying <code>DBURIType</code> as the type of instance to generate.</p>
<p><a href="#CBAHACBC">Example 20-22</a> effectively tells <code>URIFACTORY</code> that any URI string starting with <code>http://</code><code><span class="codeinlineitalic">server</span></code><code>/</code><code><span class="codeinlineitalic">servlets</span></code><code>/oradb</code> corresponds to a database access.</p>
<div id="ADXDB5283" class="example">
<p class="titleinexample"><a id="CBAHACBC"></a>Example 20-22 Registering a Handler for a DBUri Prefix</p>
<pre>
BEGIN
  URIFACTORY.registerURLHandler('http://<span class="italic">server</span>/<span class="italic">servlets</span>/oradb',
                             'SYS', 'DBURIType', true, true);
END;
/
</pre></div>
<!-- class="example" -->
<p>After you execute this code, all <code>getURI()</code> calls in the same session automatically create DBUris for any URI strings with prefix <code>http://</code><code><span class="codeinlineitalic">server</span></code><code>/</code><code><span class="codeinlineitalic">servlets</span></code><code>/oradb</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS800" href="../../appdev.112/e40758/t_dburi.htm#ARPLS800"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about <code>URIFACTORY</code> functions</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1019">
<tr>
<td class="cellalignment1028">
<table class="cellalignment1024">
<tr>
<td class="cellalignment1023"><a href="xdb14vie.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1023"><a href="partpg5.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1030">
<table class="cellalignment1022">
<tr>
<td class="cellalignment1023"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1023"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1023"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1023"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1023"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1023"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
