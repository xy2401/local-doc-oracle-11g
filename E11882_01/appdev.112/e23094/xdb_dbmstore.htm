<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>PL/SQL Package DBMS_XMLSTORE</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 748" />
<meta name="description" content="This manual describes Oracle XML&nbsp;DB. It includes guidelines and examples for storing, generating, accessing, searching, validating, transforming, evolving, and indexing XML data in Oracle Database." />
<meta name="dcterms.created" content="2014-02-20T9:56:15Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="XML DB Developer's Guide" />
<meta name="dcterms.identifier" content="E23094-04" />
<meta name="dcterms.isVersionOf" content="ADXDB" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="xdb10pls.htm" title="Previous" type="text/html" />
<link rel="Next" href="xdb11jav.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e23094.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">24/54</span> <!-- End Header -->
<div id="ADXDB1200" class="chapter"><a id="CACFIFHF"></a>
<h1 class="chapter"><span class="secnum">14</span> PL/SQL Package <a id="sthref1106"></a><a id="sthref1107"></a>DBMS_XMLSTORE</h1>
<p>This chapter introduces you to the PL/SQL package <code>DBMS_XMLSTORE</code>. This package is used to insert, update, and delete data from XML documents in object-relational tables.</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#BABCCGCD">Overview of PL/SQL Package DBMS_XMLSTORE</a></p>
</li>
<li>
<p><a href="#CACIDHFI">Using Package DBMS_XMLSTORE</a></p>
</li>
<li>
<p><a href="#CACEJGEH">Inserting with DBMS_XMLSTORE</a></p>
</li>
<li>
<p><a href="#CACBHIED">Updating with DBMS_XMLSTORE</a></p>
</li>
<li>
<p><a href="#BABHEEAA">Deleting with DBMS_XMLSTORE</a></p>
</li>
</ul>
<a id="BABCCGCD"></a>
<div id="ADXDB4923" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Overview of PL/SQL Package DBMS_XMLSTORE</h2>
<p>PL/SQL package <code>DBMS_XMLSTORE</code> enables DML operations to be performed on relational tables using XML. It takes a canonical XML mapping similar to that produced by package <code>DBMS_XMLGEN</code>; converts it to object-relational constructs; and then inserts, updates or deletes the corresponding value from relational tables.</p>
<p>The functionality of package <code>DBMS_XMLSTORE</code> is similar to that of package <code><a id="sthref1108"></a><a id="sthref1109"></a>DBMS_XMLSAVE</code>, which is part of the Oracle XML SQL Utility (XSU). There are, however, some important differences:</p>
<ul>
<li>
<p><code>DBMS_XMLSTORE</code> is written in C and compiled into the kernel, so it provides higher performance.</p>
</li>
<li>
<p><code>DBMS_XMLSTORE</code> uses the Simple API for XML (SAX) to parse the input XML document, so it has higher scalability and lower memory requirements. <code>DBMS_XMLSTORE</code> lets you input <code>XMLType</code> data, in addition to <code>CLOB</code> and <code>VARCHAR.</code></p>
</li>
<li>
<p>PL/SQL functions <code><a id="sthref1110"></a><a id="sthref1111"></a>insertXML</code>, <code><a id="sthref1112"></a><a id="sthref1113"></a>updateXML</code>, and <code><a id="sthref1114"></a><a id="sthref1115"></a>deleteXML</code>, which are also present in package <code>DBMS_XMLSAVE</code>, have been enhanced in package <code>DBMS_XMLSTORE</code> to take <code>XMLType</code> instances in addition to <code>CLOB</code> values and strings. This provides for better integration with Oracle XML&nbsp;DB functionality.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="CACIDHFI"></a>
<div id="ADXDB4924" class="sect1">
<h2 class="sect1">Using Package DBMS_XMLSTORE</h2>
<p>To use PL/SQL package <code>DBMS_XMLSTORE</code>, follow these steps:</p>
<ol>
<li>
<p>Create a context handle by calling function <code>DBMS_XMLSTORE.</code><code><span class="codeinlinebold">newContext</span></code> and supplying it with the table name to use for the DML operations. For case sensitivity, double-quote (<code>"</code>) the string that is passed to the function.</p>
<p>By default, XML documents are expected to use the <code>&lt;ROW&gt;</code> tag to identify rows. This is the same default used by package <code>DBMS_XMLGEN</code> when generating XML data. You can use function <code>setRowTag</code> to override this behavior.</p>
</li>
<li>
<p>For <span class="italic">inserts</span>, to improve performance you can specify the list of columns to insert by calling procedure <code>DBMS_XMLSTORE.</code><code><span class="codeinlinebold"><a id="sthref1116"></a><a id="sthref1117"></a>setUpdateColumn</span></code> for each column. The default behavior (if you do not specify the list of columns) is to insert values for each column whose corresponding element is present in the XML document.</p>
</li>
<li id="CACIDIGB">
<p>For <span class="italic">updates</span>, use function <code>DBMS_XMLSTORE.</code><code><span class="codeinlinebold"><a id="sthref1118"></a><a id="sthref1119"></a>setKeyColumn</span></code> to specify one or more (pseudo-) key columns, which are used to specify the <span class="italic">rows</span> to update. You do this in the <code>WHERE</code> clause of a SQL <code>UPDATE</code> statement. The columns that you specify need not be keys of the table, but together they must uniquely specify the rows to update.</p>
<p>For example, in table <code>employees</code>, column <code>employee_id</code> uniquely identifies rows (it is a key of the table). If the XML document that you use to update the table contains element <code>&lt;EMPLOYEE_ID&gt;2176&lt;/EMPLOYEE_ID&gt;</code>, then the rows where <code>employee_id</code> equals <code>2176</code> are updated.</p>
<p>To improve performance, you can also specify the list of update columns using <code>DBMS_XMLSTORE.setUpdateColumn</code>. The default behavior is to update <span class="italic">all</span> of the columns in the row(s) identified by <code>setKeyColumn</code> whose corresponding elements are present in the XML document.</p>
</li>
<li>
<p>For <span class="italic">deletions</span> you specify (pseudo-) key columns to identify the row(s) to delete. You do this the same way you specify rows to update&thinsp;&mdash;&thinsp;see step <a href="#CACIDIGB">3</a>.</p>
</li>
<li>
<p>Provide a document to PL/SQL function <code>insertXML</code>, <code>updateXML</code>, or <code>deleteXML</code>. You can <span class="italic">repeat</span> this step to update several XML documents.</p>
</li>
<li>
<p>Close the context by calling function <code>DBMS_XMLSTORE.</code><code><span class="codeinlinebold"><a id="sthref1120"></a><a id="sthref1121"></a>closeContext</span></code>.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CACEJGEH"></a>
<div id="ADXDB4925" class="sect1">
<h2 class="sect1">Inserting with DBMS_XMLSTORE</h2>
<p>To insert an XML document into a table or view, you supply the table or view name and the document. <code>DBMS_XMLSTORE</code> parses the document and then creates an <code>INSERT</code> statement into which it binds all the values. By default, <code>DBMS_XMLSTORE</code> inserts values into all the columns represented by elements in the XML document.</p>
<p><a href="#CFHBJEBH">Example 14-1</a> uses <code>DBM_XMLSTORE</code> to insert the information for two new employees into the <code>employees</code> table. The information is provided in the form of XML data.</p>
<div id="ADXDB4926" class="example">
<p class="titleinexample"><a id="CFHBJEBH"></a>Example 14-1 Inserting Data with Specified Columns</p>
<pre>
SELECT employee_id AS EMP_ID, salary, hire_date, job_id, email, last_name
  FROM employees WHERE department_id = 30;

EMP_ID     SALARY HIRE_DATE JOB_ID     EMAIL       LAST_NAME
------ ---------- --------- ---------- ---------- ----------
   114      11000 07-DEC-94 PU_MAN     DRAPHEAL     Raphaely
   115       3100 18-MAY-95 PU_CLERK   AKHOO            Khoo
   116       2900 24-DEC-97 PU_CLERK   SBAIDA          Baida
   117       2800 24-JUL-97 PU_CLERK   STOBIAS        Tobias
   118       2600 15-NOV-98 PU_CLERK   GHIMURO        Himuro
   119       2500 10-AUG-99 PU_CLERK   KCOLMENA   Colmenares

6 rows selected.

DECLARE
  insCtx DBMS_XMLSTORE.ctxType;
  rows NUMBER;
  xmlDoc CLOB :=
    '&lt;ROWSET&gt;
       &lt;ROW num="1"&gt;
         &lt;EMPLOYEE_ID&gt;920&lt;/EMPLOYEE_ID&gt;
         &lt;SALARY&gt;1800&lt;/SALARY&gt;
         &lt;DEPARTMENT_ID&gt;30&lt;/DEPARTMENT_ID&gt;
         &lt;HIRE_DATE&gt;17-DEC-2002&lt;/HIRE_DATE&gt;
         &lt;LAST_NAME&gt;Strauss&lt;/LAST_NAME&gt;
         &lt;EMAIL&gt;JSTRAUSS&lt;/EMAIL&gt;
         &lt;JOB_ID&gt;ST_CLERK&lt;/JOB_ID&gt;
       &lt;/ROW&gt;
       &lt;ROW&gt;
         &lt;EMPLOYEE_ID&gt;921&lt;/EMPLOYEE_ID&gt;
         &lt;SALARY&gt;2000&lt;/SALARY&gt;
         &lt;DEPARTMENT_ID&gt;30&lt;/DEPARTMENT_ID&gt;
         &lt;HIRE_DATE&gt;31-DEC-2004&lt;/HIRE_DATE&gt;
         &lt;LAST_NAME&gt;Jones&lt;/LAST_NAME&gt;
         &lt;EMAIL&gt;EJONES&lt;/EMAIL&gt;
         &lt;JOB_ID&gt;ST_CLERK&lt;/JOB_ID&gt;
       &lt;/ROW&gt;
     &lt;/ROWSET&gt;';
BEGIN
  insCtx := DBMS_XMLSTORE.<span class="bold">newContext</span>('HR.EMPLOYEES'); -- Get saved context
  DBMS_XMLSTORE.clearUpdateColumnList(insCtx); -- Clear the update settings
 
  -- Set the columns to be updated as a list of values 
  DBMS_XMLSTORE.<span class="bold">setUpdateColumn</span>(insCtx, 'EMPLOYEE_ID'); 
  DBMS_XMLSTORE.<span class="bold">setUpdateColumn</span>(insCtx, 'SALARY'); 
  DBMS_XMLSTORE.<span class="bold">setUpdateColumn</span>(insCtx, 'HIRE_DATE');
  DBMS_XMLSTORE.<span class="bold">setUpdateColumn</span>(insCtx, 'DEPARTMENT_ID'); 
  DBMS_XMLSTORE.<span class="bold">setUpdateColumn</span>(insCtx, 'JOB_ID');
  DBMS_XMLSTORE.<span class="bold">setUpdateColumn</span>(insCtx, 'EMAIL');
  DBMS_XMLSTORE.<span class="bold">setUpdateColumn</span>(insCtx, 'LAST_NAME');

  -- Insert the doc. 
  rows := DBMS_XMLSTORE.<span class="bold">insertXML</span>(insCtx, xmlDoc);
  DBMS_OUTPUT.put_line(rows || ' <span class="bold">rows inserted.</span>');

  -- Close the context
  DBMS_XMLSTORE.<span class="bold">closeContext</span>(insCtx); 
END;
/

<span class="bold">2 rows inserted.</span>
 
PL/SQL procedure successfully completed.

SELECT employee_id AS EMP_ID, salary, hire_date, job_id, email, last_name
  FROM employees WHERE department_id = 30;

EMP_ID     SALARY HIRE_DATE JOB_ID     EMAIL       LAST_NAME
------ ---------- --------- ---------- ---------- ----------
   114      11000 07-DEC-94 PU_MAN     DRAPHEAL     Raphaely
   115       3100 18-MAY-95 PU_CLERK   AKHOO            Khoo
   116       2900 24-DEC-97 PU_CLERK   SBAIDA          Baida
   117       2800 24-JUL-97 PU_CLERK   STOBIAS        Tobias
   118       2600 15-NOV-98 PU_CLERK   GHIMURO        Himuro
   119       2500 10-AUG-99 PU_CLERK   KCOLMENA   Colmenares
   <span class="bold">920       1800 17-DEC-02 ST_CLERK   STRAUSS       Strauss</span>
   <span class="bold">921       2000 31-DEC-04 ST_CLERK   EJONES          Jones</span>

8 rows selected.
</pre></div>
<!-- class="example" --></div>
<!-- class="sect1" -->
<a id="CACBHIED"></a>
<div id="ADXDB4927" class="sect1">
<h2 class="sect1">Updating with DBMS_XMLSTORE</h2>
<p>To update (modify) existing data using package <code>DBMS_XMLSTORE</code>, you must specify which rows to update. In SQL, you would do that using a <code>WHERE</code> clause in an <code>UPDATE</code> statement. With <code>DBMS_XMLSTORE</code>, you do it by calling procedure <code>setKeyColumn</code> once for <span class="italic">each</span> of the columns that are used collectively to identify the row.</p>
<p>You can think of this set of columns as acting like a set of key columns: <span class="italic">together, they specify a unique row</span> to be updated. However, the columns that you use (with <code>setKeyColumn</code>) need <span class="italic">not</span> be keys of the table&thinsp;&mdash;&thinsp;as long as they uniquely specify a row, they can be used with calls to <code>setKeyColumn</code>.</p>
<p><a href="#CFHEHGCA">Example 14-2</a> uses <code>DBM_XMLSTORE</code> to update information. Assuming that the first name for employee number 188 is incorrectly recorded as Kelly, this example corrects that first name to Pat. Since column <code>employee_id</code> is a primary key for table <code>employees</code>, a single call to <code>setKeyColumn</code> specifying column <code>employee_id</code> is sufficient to identify a unique row for updating.</p>
<div id="ADXDB4928" class="example">
<p class="titleinexample"><a id="CFHEHGCA"></a>Example 14-2 Updating Data with Key Columns</p>
<pre>
SELECT employee_id, first_name FROM employees WHERE employee_id = 188;

EMPLOYEE_ID FIRST_NAME
----------- ----------
        188 <span class="bold">Kelly</span>
 
1 row selected.

DECLARE
  updCtx DBMS_XMLSTORE.ctxType; 
  rows NUMBER;
  xmlDoc CLOB :=
    '&lt;ROWSET&gt;
       &lt;ROW&gt;
         &lt;EMPLOYEE_ID&gt;188&lt;/EMPLOYEE_ID&gt;
         &lt;FIRST_NAME&gt;<span class="bold">Pat</span>&lt;/FIRST_NAME&gt;
       &lt;/ROW&gt;
     &lt;/ROWSET&gt;';
BEGIN
   updCtx := DBMS_XMLSTORE.newContext('HR.EMPLOYEES'); -- get the context
   DBMS_XMLSTORE.clearUpdateColumnList(updCtx);        -- clear update settings

   -- Specify that column employee_id is a "key" to identify the row to update.
   DBMS_XMLSTORE.<span class="bold">setKeyColumn</span>(updCtx, 'EMPLOYEE_ID'); 
   rows := DBMS_XMLSTORE.<span class="bold">updateXML</span>(updCtx, xmlDoc);    -- update the table
   DBMS_XMLSTORE.closeContext(updCtx);                 -- close the context
END;
/

SELECT employee_id, first_name FROM employees WHERE employee_id = 188;

EMPLOYEE_ID FIRST_NAME
----------- ----------
        188 <span class="bold">Pat</span>
 
1 row selected.
</pre></div>
<!-- class="example" -->
<p>The following <code>UPDATE</code> statement is equivalent to the use of <code>DBM_XMLSTORE</code> in <a href="#CFHEHGCA">Example 14-2</a>:</p>
<pre>
UPDATE hr.employees SET first_name = 'Pat' WHERE employee_id = 188; 
</pre></div>
<!-- class="sect1" -->
<a id="BABHEEAA"></a>
<div id="ADXDB4929" class="sect1">
<h2 class="sect1">Deleting with DBMS_XMLSTORE</h2>
<p>Deletions are treated similarly to updates: you specify the key or pseudo-key columns that identify the rows to delete.</p>
<div id="ADXDB4930" class="example">
<p class="titleinexample"><a id="sthref1122"></a>Example 14-3 DBMS_XMLSTORE.DELETEXML Example</p>
<pre>
SELECT employee_id FROM employees WHERE employee_id = 188;
 
EMPLOYEE_ID
-----------
        188
 
1 row selected.
 
DECLARE
  delCtx DBMS_XMLSTORE.ctxType;
  rows NUMBER;
  xmlDoc CLOB :=
    '&lt;ROWSET&gt;
       &lt;ROW&gt;
         &lt;EMPLOYEE_ID&gt;188&lt;/EMPLOYEE_ID&gt;
         &lt;DEPARTMENT_ID&gt;50&lt;/DEPARTMENT_ID&gt;
       &lt;/ROW&gt;
     &lt;/ROWSET&gt;';
BEGIN
  delCtx  := DBMS_XMLSTORE.newContext('HR.EMPLOYEES');
  DBMS_XMLSTORE.setKeyColumn(delCtx, 'EMPLOYEE_ID');
  rows := DBMS_XMLSTORE.<span class="bold">deleteXML</span>(delCtx, xmlDoc);
  DBMS_XMLSTORE.closeContext(delCtx);
END;
/
 
SELECT employee_id FROM employees WHERE employee_id = 188;
 
no rows selected.
</pre></div>
<!-- class="example" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1019">
<tr>
<td class="cellalignment1028">
<table class="cellalignment1024">
<tr>
<td class="cellalignment1023"><a href="xdb10pls.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1023"><a href="xdb11jav.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1030">
<table class="cellalignment1022">
<tr>
<td class="cellalignment1023"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1023"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1023"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1023"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1023"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1023"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
