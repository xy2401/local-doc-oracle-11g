<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Using Oracle Flashback Technology</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1032" />
<meta name="dcterms.created" content="2014-12-06T1:49:50Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Advanced Application Developer's Guide" />
<meta name="dcterms.identifier" content="E41502-06" />
<meta name="dcterms.isVersionOf" content="ADFNS" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="adfns_part_special.htm" title="Previous" type="text/html" />
<link rel="Next" href="adfns_environments.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e41502.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">22/31</span> <!-- End Header -->
<div id="ADFNS1008" class="chapter"><a id="g1026131"></a> <a id="i1020531"></a>
<h1 class="chapter"><span class="secnum">12</span> Using Oracle Flashback Technology</h1>
<p>This chapter explains how to use Oracle Flashback Technology in database applications.</p>
<p class="subhead2"><a id="sthref796"></a>Topics:</p>
<ul>
<li>
<p><a href="#i1009447">Overview of Oracle Flashback Technology</a></p>
</li>
<li>
<p><a href="#i1008155">Configuring Your Database for Oracle Flashback Technology</a></p>
</li>
<li>
<p><a href="#i1008579">Using Oracle Flashback Query (SELECT AS OF)</a></p>
</li>
<li>
<p><a href="#i1019938">Using Oracle Flashback Version Query</a></p>
</li>
<li>
<p><a href="#i1007455">Using Oracle Flashback Transaction Query</a></p>
</li>
<li>
<p><a href="#BJFBFGCC">Using Oracle Flashback Transaction Query with Oracle Flashback Version Query</a></p>
</li>
<li>
<p><a href="#i1017341">Using DBMS_FLASHBACK Package</a></p>
</li>
<li>
<p><a href="#BJFIHEIA">Using Flashback Transaction</a></p>
</li>
<li>
<p><a href="#BJFFDCEH">Using Flashback Data Archive (Oracle Total Recall)</a></p>
</li>
<li>
<p><a href="#g1703520">General Guidelines for Oracle Flashback Technology</a></p>
</li>
<li>
<p><a href="#g1703502">Performance Guidelines for Oracle Flashback Technology</a></p>
</li>
</ul>
<a id="i1009447"></a>
<div id="ADFNS01001" class="sect1">
<h2 class="sect1">Overview of Oracle Flashback Technology</h2>
<p><a id="sthref797"></a>Oracle Flashback Technology is a group of Oracle Database features that let you view past states of database objects or to return database objects to a previous state without using point-in-time media recovery.</p>
<p>With flashback features, you can:</p>
<ul>
<li>
<p>Perform queries that return past data</p>
</li>
<li>
<p>Perform queries that return metadata that shows a detailed history of changes to the database</p>
</li>
<li>
<p>Recover tables or rows to a previous point in time</p>
</li>
<li>
<p>Automatically track and archive transactional data changes</p>
</li>
<li>
<p>Roll back a transaction and its dependent transactions while the database remains online</p>
</li>
</ul>
<p>Oracle Flashback features use the <a id="sthref798"></a>Automatic Undo Management (AUM) system to obtain metadata and historical data for transactions. They rely on <span class="glossaryterm"><a id="sthref799"></a>undo data</span>, which are records of the effects of individual transactions. For example, if a user runs an <code dir="ltr">UPDATE</code> statement to change a salary from 1000 to 1100, then Oracle Database stores the value 1000 in the undo data.</p>
<p>Undo data is persistent and survives a database shutdown. By using flashback features, you can use undo data to query past data or recover from logical damage. Besides using it in flashback features, Oracle Database uses undo data to perform these actions:</p>
<ul>
<li>
<p>Roll back active transactions</p>
</li>
<li>
<p>Recover terminated transactions by using database or process recovery</p>
</li>
<li>
<p>Provide read consistency for SQL queries</p>
</li>
</ul>
<p class="subhead2"><a id="sthref800"></a>Topics:</p>
<ul>
<li>
<p><a href="#g1025538">Application Development Features</a></p>
</li>
<li>
<p><a href="#g1025551">Database Administration Features</a></p>
</li>
</ul>
<p>For additional general information about flashback features, see <a class="olink CNCPT1439" href="../../server.112/e40540/cncptdba.htm#CNCPT1439"><span class="italic">Oracle Database Concepts</span></a></p>
<a id="g1025538"></a>
<div id="ADFNS598" class="sect2">
<h3 class="sect2">Application Development Features</h3>
<p><a id="sthref801"></a>In application development, you can use these flashback features to report historical data or undo erroneous changes. (You can also use these features interactively as a database user or administrator.)</p>
<p class="subhead2"><a id="ADFNS599"></a>Oracle Flashback Query</p>
<p>Use this feature to retrieve data for an earlier time that you specify with the <code dir="ltr">AS</code> <code dir="ltr">OF</code> clause of the <code dir="ltr">SELECT</code> statement. For more information, see <a href="#i1008579">"Using Oracle Flashback Query (SELECT AS OF)"</a>.</p>
<p class="subhead2"><a id="ADFNS600"></a>Oracle Flashback Version Query</p>
<p>Use this feature to retrieve metadata and historical data for a specific time interval (for example, to view all the rows of a table that ever existed during a given time interval). Metadata for each row version includes start and end time, type of change operation, and identity of the transaction that created the row version. To create an Oracle Flashback Version Query, use the <code dir="ltr">VERSIONS</code> <code dir="ltr">BETWEEN</code> clause of the <code dir="ltr">SELECT</code> statement. For more information, see <a href="#i1019938">"Using Oracle Flashback Version Query"</a>.</p>
<p class="subhead2"><a id="ADFNS601"></a>Oracle Flashback Transaction Query</p>
<p>Use this feature to retrieve metadata and historical data for a given transaction or for all transactions in a given time interval. To perform an Oracle Flashback Transaction Query, select from the static data dictionary view <code dir="ltr">FLASHBACK_TRANSACTION_QUERY</code>. For more information, see <a href="#i1007455">"Using Oracle Flashback Transaction Query"</a>.</p>
<p>Typically, you use Oracle Flashback Transaction Query with an Oracle Flashback Version Query that provides the transaction IDs for the rows of interest (see <a href="#BJFBFGCC">"Using Oracle Flashback Transaction Query with Oracle Flashback Version Query"</a>).</p>
<p class="subhead2"><a id="ADFNS602"></a>DBMS_FLASHBACK Package</p>
<p>Use this feature to set the internal Oracle Database clock to an earlier time so that you can examine data that was current at that time, or to roll back a transaction and its dependent transactions while the database remains online (see <a href="#BJFIIEAA">Flashback Transaction</a>). For more information, see <a href="#i1017341">"Using DBMS_FLASHBACK Package"</a>.</p>
<p class="subhead2"><a id="BJFIIEAA"></a><a id="ADFNS603"></a>Flashback Transaction</p>
<p>Use Flashback Transaction to roll back a transaction and its dependent transactions while the database remains online. This recovery operation uses undo data to create and run the corresponding compensating transactions that return the affected data to its original state. (Flashback Transaction is part of <code dir="ltr">DBMS_FLASHBACK</code> package.) For more information, see <a href="#i1017341">"Using DBMS_FLASHBACK Package"</a>.</p>
<p class="subhead2"><a id="ADFNS604"></a>Flashback Data Archive (Oracle Total Recall)</p>
<p>Use Flashback Data Archive to automatically track and archive both regular queries and Oracle Flashback Query, ensuring SQL-level access to the versions of database objects without getting a snapshot-too-old error. For more information, see <a href="#BJFFDCEH">"Using Flashback Data Archive (Oracle Total Recall)"</a>.</p>
</div>
<!-- class="sect2" -->
<a id="g1025551"></a>
<div id="ADFNS605" class="sect2">
<h3 class="sect2">Database Administration Features</h3>
<p><a id="sthref802"></a>These flashback features are primarily for data recovery. Typically, you use these features only as a database administrator.</p>
<p>This chapter focuses on the <a href="#g1025538">"Application Development Features"</a>. For more information about the database administration features, see <a class="olink ADMIN015" href="../../server.112/e25494/tables.htm#ADMIN015"><span class="italic">Oracle Database Administrator's Guide</span></a> and the <a class="olink BRADV80055" href="../../backup.112/e10642/rcmflash.htm#BRADV80055"><span class="italic">Oracle Database Backup and Recovery User's Guide</span></a>.</p>
<p class="subhead2"><a id="ADFNS606"></a>Oracle Flashback Table</p>
<p>Use this feature to restore a table to its state at a previous point in time. You can restore a table while the database is on line, undoing changes to only the specified table.</p>
<p class="subhead2"><a id="ADFNS607"></a>Oracle Flashback Drop</p>
<p>Use this feature to recover a dropped table. This feature reverses the effects of a <code dir="ltr">DROP</code> <code dir="ltr">TABLE</code> statement.</p>
<p class="subhead2"><a id="ADFNS608"></a>Oracle Flashback Database</p>
<p>Use this feature to quickly return the database to an earlier point in time, by undoing all of the changes that have taken place since then. This is fast, because you do not have to restore database backups.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1008155"></a>
<div id="ADFNS01002" class="sect1">
<h2 class="sect1">Configuring Your Database for Oracle Flashback Technology</h2>
<p><a id="sthref803"></a>Before you can use flashback features in your application, you or your database administrator must perform the configuration tasks described in these topics:</p>
<ul>
<li>
<p><a href="#BJFDJCJD">Configuring Your Database for Automatic Undo Management</a></p>
</li>
<li>
<p><a href="#BJFGJHCJ">Configuring Your Database for Oracle Flashback Transaction Query</a></p>
</li>
<li>
<p><a href="#BJFHBGGE">Configuring Your Database for Flashback Transaction</a></p>
</li>
<li>
<p><a href="#BJFJDBAJ">Enabling Oracle Flashback Operations on Specific LOB Columns</a></p>
</li>
<li>
<p><a href="#BJFJAHBJ">Granting Necessary Privileges</a></p>
</li>
</ul>
<a id="BJFDJCJD"></a>
<div id="ADFNS609" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Configuring Your Database for Automatic Undo Management</h3>
<p>To configure your database for Automatic Undo Management (AUM), you or your database administrator must:</p>
<ul>
<li>
<p>Create an undo tablespace with enough space to keep the required data for flashback operations.</p>
<p>The more often users update the data, the more space is required. The database administrator usually calculates the space requirement.</p>
</li>
<li>
<p>Enable AUM, as explained in <a class="olink ADMIN013" href="../../server.112/e25494/undo.htm#ADMIN013"><span class="italic">Oracle Database Administrator's Guide</span></a>. Set these database initialization parameters:</p>
<ul>
<li>
<p><code dir="ltr">UNDO_MANAGEMENT</code></p>
</li>
<li>
<p><code dir="ltr">UNDO_TABLESPACE</code></p>
</li>
<li>
<p><code dir="ltr">UNDO_RETENTION</code></p>
</li>
</ul>
<p>For a fixed-size undo tablespace, Oracle Database automatically tunes the system to give the undo tablespace the best possible undo retention.</p>
<p>For an automatically extensible undo tablespace, Oracle Database retains undo data longer than the longest query duration and the low threshold of undo retention specified by the <code dir="ltr">UNDO_RETENTION</code> parameter.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can query <code dir="ltr">V$UNDOSTAT</code>.<code dir="ltr">TUNED_UNDORETENTION</code> to determine the amount of time for which undo is retained for the current undo tablespace. For more information about <code dir="ltr">V$UNDOSTAT</code>, see <a class="olink REFRN30295" href="../../server.112/e40402/dynviews_3118.htm#REFRN30295"><span class="italic">Oracle Database Reference</span></a>.</div>
<p>Setting <code dir="ltr">UNDO_RETENTION</code> does not guarantee that unexpired undo data is not discarded. If the system needs more space, Oracle Database can overwrite unexpired undo with more recently generated undo data.</p>
</li>
<li>
<p>Specify the <a id="sthref804"></a><code dir="ltr">RETENTION</code> <code dir="ltr">GUARANTEE</code> clause for the undo tablespace to ensure that unexpired undo data is not discarded.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMIN013" href="../../server.112/e25494/undo.htm#ADMIN013"><span class="italic">Oracle Database Administrator's Guide</span></a> for more information about creating an undo tablespace and enabling AUM</div>
</div>
<!-- class="sect2" -->
<a id="BJFGJHCJ"></a>
<div id="ADFNS610" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Configuring Your Database for Oracle Flashback Transaction Query</h3>
<p>To configure your database for the Oracle Flashback Transaction Query feature, you or your database administrator must:</p>
<ul>
<li>
<p>Ensure that Oracle Database is running with version 10.0 compatibility.</p>
</li>
<li>
<p>Enable supplemental logging:</p>
<pre dir="ltr">
ALTER DATABASE ADD SUPPLEMENTAL LOG DATA;
</pre></li>
</ul>
</div>
<!-- class="sect2" -->
<a id="BJFHBGGE"></a>
<div id="ADFNS611" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Configuring Your Database for Flashback Transaction</h3>
<p>To configure your database for the Flashback Transaction feature, you or your database administrator must:</p>
<ul>
<li>
<p>With the database mounted but not open, enable <code dir="ltr">ARCHIVELOG</code>:</p>
<pre dir="ltr">
ALTER DATABASE ARCHIVELOG;
</pre></li>
<li>
<p>Open at least one archive log:</p>
<pre dir="ltr">
ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre></li>
<li>
<p>If not done, enable minimal and primary key supplemental logging:</p>
<pre dir="ltr">
ALTER DATABASE ADD SUPPLEMENTAL LOG DATA;
ALTER DATABASE ADD SUPPLEMENTAL LOG DATA (PRIMARY KEY) COLUMNS;
</pre></li>
<li>
<p>If you want to track foreign key dependencies, enable foreign key supplemental logging:</p>
<pre dir="ltr">
ALTER DATABASE ADD SUPPLEMENTAL LOG DATA (FOREIGN KEY) COLUMNS;
</pre></li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you have very many foreign key constraints, enabling foreign key supplemental logging might not be worth the performance penalty.</div>
</div>
<!-- class="sect2" -->
<a id="BJFJDBAJ"></a>
<div id="ADFNS612" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Enabling Oracle Flashback Operations on Specific LOB Columns</h3>
<p>To enable flashback operations on specific LOB columns of a table, use the <code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> statement with the <a id="sthref805"></a><code dir="ltr">RETENTION</code> option.</p>
<p>Because undo data for LOB columns can be voluminous, you must define which LOB columns to use with flashback operations.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADLOB101" href="../../appdev.112/e18294/adlob_tables.htm#ADLOB101"><span class="italic">Oracle Database SecureFiles and Large Objects Developer's Guide</span></a> to learn about LOB storage and the <code dir="ltr">RETENTION</code> parameter</div>
</div>
<!-- class="sect2" -->
<a id="BJFJAHBJ"></a>
<div id="ADFNS613" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Granting Necessary Privileges</h3>
<p><a id="sthref806"></a>You or your database administrator must grant privileges to users, roles, or applications that must use these flashback features. For information about the <code dir="ltr">GRANT</code> statement, see <a class="olink SQLRF01603" href="../../server.112/e41084/statements_9013.htm#SQLRF01603"><span class="italic">Oracle Database SQL Language Reference</span></a>.</p>
<p class="subhead2"><a id="ADFNS614"></a>For Oracle Flashback Query and Oracle Flashback Version Query</p>
<p>To allow access to specific objects during queries, grant <code dir="ltr">FLASHBACK</code> and <code dir="ltr">SELECT</code> privileges on those objects.</p>
<p>To allow queries on all tables, grant the <code dir="ltr">FLASHBACK</code> <code dir="ltr">ANY</code> <code dir="ltr">TABLE</code> privilege.</p>
<p class="subhead2"><a id="ADFNS615"></a>For Oracle Flashback Transaction Query</p>
<p>Grant the <code dir="ltr">SELECT</code> <code dir="ltr">ANY</code> <code dir="ltr">TRANSACTION</code> privilege.</p>
<p>To allow execution of undo SQL code retrieved by an Oracle Flashback Transaction Query, grant <code dir="ltr">SELECT</code>, <code dir="ltr">UPDATE</code>, <code dir="ltr">DELETE</code>, and <code dir="ltr">INSERT</code> privileges for specific tables.</p>
<p class="subhead2"><a id="ADFNS616"></a>For DBMS_FLASHBACK Package</p>
<p>To allow access to the features in the <code dir="ltr">DBMS_FLASHBACK</code> package, grant the <code dir="ltr">EXECUTE</code> privilege on <code dir="ltr">DBMS_FLASHBACK</code>.</p>
<p class="subhead2"><a id="ADFNS617"></a>For Flashback Data Archive (Oracle Total Recall)</p>
<p>To allow a specific user to enable Flashback Data Archive on tables, using a specific Flashback Data Archive, grant the <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> object privilege on that Flashback Data Archive to that user. To grant the <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> object privilege, you must either be logged on as <code dir="ltr">SYSDBA</code> or have <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> <code dir="ltr">ADMINISTER</code> system privilege.</p>
<p>To allow execution of these statements, grant the <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> <code dir="ltr">ADMINISTER</code> system privilege:</p>
<ul>
<li>
<p><code dir="ltr">CREATE</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code></p>
</li>
<li>
<p><code dir="ltr">ALTER</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code></p>
</li>
<li>
<p><code dir="ltr">DROP</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code></p>
</li>
</ul>
<p>To grant the <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> <code dir="ltr">ADMINISTER</code> system privilege, you must be logged on as <code dir="ltr">SYSDBA</code>.</p>
<p>To create a default Flashback Data Archive, using either the <code dir="ltr">CREATE</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> or <code dir="ltr">ALTER</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> statement, you must be logged on as <code dir="ltr">SYSDBA</code>.</p>
<p>To disable Flashback Data Archive for a table that has been enabled for Flashback Data Archive, you must either be logged on as <code dir="ltr">SYSDBA</code> or have the <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> <code dir="ltr">ADMINISTER</code> system privilege.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1008579"></a>
<div id="ADFNS01003" class="sect1">
<h2 class="sect1">Using Oracle Flashback Query (SELECT AS OF)</h2>
<p><a id="sthref807"></a>To use Oracle Flashback Query, use a <a id="sthref808"></a><code dir="ltr">SELECT</code> statement with an <code dir="ltr">AS</code> <code dir="ltr">OF</code> clause. Oracle Flashback Query retrieves data as it existed at an earlier time. The query explicitly references a past time through a time stamp or System Change Number (SCN). It returns committed data that was current at that point in time.</p>
<p>Uses of Oracle Flashback Query include:</p>
<ul>
<li>
<p>Recovering lost data or undoing incorrect, committed changes.</p>
<p>For example, if you mistakenly delete or update rows, and then commit them, you can immediately undo the mistake.</p>
</li>
<li>
<p>Comparing current data with the corresponding data at an earlier time.</p>
<p>For example, you can run a daily report that shows the change in data from yesterday. You can compare individual rows of table data or find intersections or unions of sets of rows.</p>
</li>
<li>
<p>Checking the state of transactional data at a particular time.</p>
<p>For example, you can verify the account balance of a certain day.</p>
</li>
<li>
<p>Simplifying application design by removing the need to store some kinds of temporal data.</p>
<p>Oracle Flashback Query lets you retrieve past data directly from the database.</p>
</li>
<li>
<p>Applying packaged applications, such as report generation tools, to past data.</p>
</li>
<li>
<p>Providing self-service error correction for an application, thereby enabling users to undo and correct their errors.</p>
</li>
</ul>
<p class="subhead2"><a id="sthref809"></a>Topics:</p>
<ul>
<li>
<p><a href="#g1025568">Example of Examining and Restoring Past Data</a></p>
</li>
<li>
<p><a href="#g1025584">Guidelines for Oracle Flashback Query</a></p>
</li>
</ul>
<p>For more information about the <code dir="ltr">SELECT</code> <code dir="ltr">AS</code> <code dir="ltr">OF</code> statement, see <a class="olink SQLRF01702" href="../../server.112/e41084/statements_10002.htm#SQLRF01702"><span class="italic">Oracle Database SQL Language Reference</span></a>.</p>
<a id="g1025568"></a>
<div id="ADFNS618" class="sect2">
<h3 class="sect2">Example of Examining and Restoring Past Data</h3>
<p>Suppose that you discover at 12:30 PM that the row for employee Chung was deleted from the <code dir="ltr">employees</code> table, and you know that at 9:30AM the data for Chung was correctly stored in the database. You can use Oracle Flashback Query to examine the contents of the table at 9:30 AM to find out what data was lost. If appropriate, you can restore the lost data.</p>
<p><a href="#BABHIHFF">Example 12-1</a> retrieves the state of the record for <code dir="ltr">Chung</code> at 9:30AM, April 4, 2004:</p>
<div id="ADFNS619" class="example">
<p class="titleinexample"><a id="BABHIHFF"></a>Example 12-1 Retrieving a Lost Row with Oracle Flashback Query</p>
<pre dir="ltr">
SELECT * FROM employees
AS OF TIMESTAMP
TO_TIMESTAMP('2004-04-04 09:30:00', 'YYYY-MM-DD HH:MI:SS')
WHERE last_name = 'Chung';
</pre></div>
<!-- class="example" -->
<p><a href="#BABJJCFE">Example 12-2</a> restores Chung's information to the <code dir="ltr">employees</code> table:</p>
<div id="ADFNS620" class="example">
<p class="titleinexample"><a id="BABJJCFE"></a>Example 12-2 Restoring a Lost Row After Oracle Flashback Query</p>
<pre dir="ltr">
INSERT INTO employees (
  SELECT * FROM employees
  AS OF TIMESTAMP
  TO_TIMESTAMP('2004-04-04 09:30:00', 'YYYY-MM-DD HH:MI:SS')
  WHERE last_name = 'Chung'
);
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<a id="g1025584"></a>
<div id="ADFNS621" class="sect2">
<h3 class="sect2">Guidelines for Oracle Flashback Query</h3>
<ul>
<li>
<p>You can specify or omit the <code dir="ltr">AS</code> <code dir="ltr">OF</code> clause for each table and specify different times for different tables.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If a table is a Flashback Data Archive and you specify a time for it that is earlier than its creation time, the query returns zero rows for that table, rather than causing an error. (For information about Flashback Data Archives, see <a href="#BJFFDCEH">"Using Flashback Data Archive (Oracle Total Recall)"</a>.)</div>
</li>
<li>
<p>You can use the <code dir="ltr">AS</code> <code dir="ltr">OF</code> clause in queries to perform data definition language (DDL) operations (such as creating and truncating tables) or data manipulation language (DML) statements (such as <code dir="ltr">INSERT</code> and <code dir="ltr">DELETE</code>) in the same session as Oracle Flashback Query.</p>
</li>
<li>
<p>To use the result of Oracle Flashback Query in a DDL or DML statement that affects the current state of the database, use an <code dir="ltr">AS</code> <code dir="ltr">OF</code> clause inside an <code dir="ltr">INSERT</code> or <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> <code dir="ltr">AS</code> <code dir="ltr">SELECT</code> statement.</p>
</li>
<li>
<p>If a possible 3-second error (maximum) is important to Oracle Flashback Query in your application, use an SCN instead of a time stamp. See <a href="#g1703520">"General Guidelines for Oracle Flashback Technology"</a>.</p>
</li>
<li>
<p>You can create a view that refers to past data by using the <code dir="ltr">AS</code> <code dir="ltr">OF</code> clause in the <code dir="ltr">SELECT</code> statement that defines the view.</p>
<p>If you specify a relative time by subtracting from the current time on the database host, the past time is recalculated for each query. For example:</p>
<pre dir="ltr">
CREATE VIEW hour_ago AS
  SELECT * FROM employees
    AS OF TIMESTAMP (SYSTIMESTAMP - INTERVAL '60' MINUTE);
</pre>
<p><code dir="ltr">SYSTIMESTAMP</code> refers to the time zone of the database host environment.</p>
</li>
<li>
<p>You can use the <code dir="ltr">AS</code> <code dir="ltr">OF</code> clause in self-joins, or in set operations such as <code dir="ltr">INTERSECT</code> and <code dir="ltr">MINUS</code>, to extract or compare data from two different times.</p>
<p>You can store the results by preceding Oracle Flashback Query with a <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> <code dir="ltr">AS</code> <code dir="ltr">SELECT</code> or <code dir="ltr">INSERT</code> <code dir="ltr">INTO</code> <code dir="ltr">TABLE</code> <code dir="ltr">SELECT</code> statement. For example, this query reinserts into table <code dir="ltr">employees</code> the rows that existed an hour ago:</p>
<pre dir="ltr">
INSERT INTO employees
    (SELECT * FROM employees
     AS OF TIMESTAMP (SYSTIMESTAMP - INTERVAL '60' MINUTE)
    MINUS SELECT * FROM employees;
</pre>
<p><code dir="ltr">SYSTIMESTAMP</code> refers to the time zone of the database host environment.</p>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1019938"></a>
<div id="ADFNS01004" class="sect1">
<h2 class="sect1">Using Oracle Flashback Version Query</h2>
<p><a id="sthref810"></a>Use Oracle Flashback Version Query to retrieve the different versions of specific rows that existed during a given time interval. A row version is created whenever a <code dir="ltr">COMMIT</code> statement is executed.</p>
<p>Specify Oracle Flashback Version Query using the <a id="sthref811"></a><code dir="ltr">VERSIONS</code> <code dir="ltr">BETWEEN</code> clause of the <code dir="ltr">SELECT</code> statement. The syntax is:</p>
<pre dir="ltr">
VERSIONS {BETWEEN {SCN | TIMESTAMP} <span class="codeinlineitalic">start</span> AND <span class="codeinlineitalic">end</span>}
</pre>
<p>where <code dir="ltr"><span class="codeinlineitalic">start</span></code> and <code dir="ltr"><span class="codeinlineitalic">end</span></code> are expressions representing the start and end, respectively, of the time interval to be queried. The time interval includes (<code dir="ltr"><span class="codeinlineitalic">start</span></code> and <code dir="ltr"><span class="codeinlineitalic">end</span></code>).</p>
<p>Oracle Flashback Version Query returns a table with a row for each version of the row that existed at any time during the specified time interval. Each row in the table includes pseudocolumns of metadata about the row version, described in <a href="#g1020732">Table 12-1</a>. This information can reveal when and how a particular change (perhaps erroneous) occurred to your database.</p>
<div id="ADFNS622" class="tblhruleformal">
<p class="titleintable"><a id="sthref812"></a><a id="g1020732"></a>Table 12-1 Oracle Flashback Version Query Row Data Pseudocolumns</p>
<table class="cellalignment1273" title=" Oracle Flashback Version Query Row Data Pseudocolumns" summary="This table summarizes the pseudocolumns of Flashback Version Query rows." dir="ltr">
<thead>
<tr class="cellalignment1267">
<th class="cellalignment1274" id="r1c1-t7">Pseudocolumn Name</th>
<th class="cellalignment1274" id="r1c2-t7">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1267">
<td class="cellalignment1275" id="r2c1-t7" headers="r1c1-t7">
<p><code dir="ltr"><a id="sthref813"></a>VERSIONS_STARTSCN</code></p>
<p><code dir="ltr"><a id="sthref814"></a>VERSIONS_STARTTIME</code></p>
</td>
<td class="cellalignment1275" headers="r2c1-t7 r1c2-t7">
<p>Starting System Change Number (SCN) or <code dir="ltr">TIMESTAMP</code> when the row version was created. This pseudocolumn identifies the time when the data first had the values reflected in the row version. Use this pseudocolumn to identify the past target time for Oracle Flashback Table or Oracle Flashback Query.</p>
<p>If this pseudocolumn is <code dir="ltr">NULL</code>, then the row version was created before <code dir="ltr"><span class="codeinlineitalic">start</span></code>.</p>
</td>
</tr>
<tr class="cellalignment1267">
<td class="cellalignment1275" id="r3c1-t7" headers="r1c1-t7">
<p><code dir="ltr"><a id="sthref815"></a>VERSIONS_ENDSCN</code></p>
<p><code dir="ltr"><a id="sthref816"></a>VERSIONS_ENDTIME</code></p>
</td>
<td class="cellalignment1275" headers="r3c1-t7 r1c2-t7">
<p>SCN or <code dir="ltr">TIMESTAMP</code> when the row version expired.</p>
<p>If this pseudocolumn is <code dir="ltr">NULL</code>, then either the row version was current at the time of the query or the row corresponds to a <code dir="ltr">DELETE</code> operation.</p>
</td>
</tr>
<tr class="cellalignment1267">
<td class="cellalignment1275" id="r4c1-t7" headers="r1c1-t7">
<p><code dir="ltr"><a id="sthref817"></a>VERSIONS_XID</code></p>
</td>
<td class="cellalignment1275" headers="r4c1-t7 r1c2-t7">
<p>Identifier of the transaction that created the row version.</p>
</td>
</tr>
<tr class="cellalignment1267">
<td class="cellalignment1275" id="r5c1-t7" headers="r1c1-t7">
<p><code dir="ltr"><a id="sthref818"></a>VERSIONS_OPERATION</code></p>
</td>
<td class="cellalignment1275" headers="r5c1-t7 r1c2-t7">
<p>Operation performed by the transaction: <code dir="ltr">I</code> for insertion, <code dir="ltr">D</code> for deletion, or <code dir="ltr">U</code> for update. The version is that of the row that was inserted, deleted, or updated; that is, the row after an <code dir="ltr">INSERT</code> operation, the row before a <code dir="ltr">DELETE</code> operation, or the row affected by an <code dir="ltr">UPDATE</code> operation.</p>
<p>For user updates of an index key, Oracle Flashback Version Query might treat an <code dir="ltr">UPDATE</code> operation as two operations, <code dir="ltr">DELETE</code> plus <code dir="ltr">INSERT</code>, represented as two version rows with a <code dir="ltr">D</code> followed by an <code dir="ltr">I</code> <code dir="ltr">VERSIONS_OPERATION</code>.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<p>A given row version is valid starting at its time <code dir="ltr">VERSIONS_START*</code> up to, but not including, its time <code dir="ltr">VERSIONS_END*</code>. That is, it is valid for any time <span class="italic">t</span> such that <code dir="ltr">VERSIONS_START*</code> <span class="bold">&lt;=</span> <span class="italic">t</span> <span class="bold">&lt;</span> <code dir="ltr">VERSIONS_END*</code>. For example, this output indicates that the salary was 10243 from September 9, 2002, included, to November 25, 2003, excluded.</p>
<pre dir="ltr">
VERSIONS_START_TIME     VERSIONS_END_TIME     SALARY
-------------------     -----------------     ------
09-SEP-2003             25-NOV-2003           10243
</pre>
<p>Here is a typical use of Oracle Flashback Version Query:</p>
<pre dir="ltr">
SELECT versions_startscn, versions_starttime,
       versions_endscn, versions_endtime,
       versions_xid, versions_operation,
       last_name, salary
  FROM employees
  VERSIONS BETWEEN TIMESTAMP
      TO_TIMESTAMP('2008-12-18 14:00:00', 'YYYY-MM-DD HH24:MI:SS')
  AND TO_TIMESTAMP('2008-12-18 17:00:00', 'YYYY-MM-DD HH24:MI:SS')
  WHERE first_name = 'John';
</pre>
<p>You can use <code dir="ltr">VERSIONS_XID</code> with Oracle Flashback Transaction Query to locate this transaction's metadata, including the SQL required to undo the row change and the user responsible for the change&mdash;see <a href="#i1007455">"Using Oracle Flashback Transaction Query"</a>.</p>
<p>Flashback Version Query allows index-only access only with IOTs (index-organized tables), but index fast full scan is not allowed.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF01702" href="../../server.112/e41084/statements_10002.htm#SQLRF01702"><span class="italic">Oracle Database SQL Language Reference</span></a> for information about Oracle Flashback Version Query pseudocolumns and the syntax of the <code dir="ltr">VERSIONS</code> clause</div>
</div>
<!-- class="sect1" -->
<a id="i1007455"></a>
<div id="ADFNS01005" class="sect1">
<h2 class="sect1">Using Oracle Flashback Transaction Query</h2>
<p>Use Oracle Flashback Transaction Query to retrieve metadata and historical data for a given transaction or for all transactions in a given time interval. <a id="sthref819"></a>Oracle Flashback Transaction Query queries the static data dictionary view <code dir="ltr"><a id="sthref820"></a>FLASHBACK_TRANSACTION_QUERY</code>, whose columns are described in <a class="olink REFRN29086" href="../../server.112/e40402/statviews_5125.htm#REFRN29086"><span class="italic">Oracle Database Reference</span></a>.</p>
<p>The column <code dir="ltr">UNDO_SQL</code> shows the SQL code that is the logical opposite of the DML operation performed by the transaction. You can usually use this code to reverse the logical steps taken during the transaction. However, there are cases where the <code dir="ltr">SQL_UNDO</code> code is not the exact opposite of the original transaction. For example, a <code dir="ltr">SQL_UNDO</code> <code dir="ltr">INSERT</code> operation might not insert a row back in a table at the same <code dir="ltr">ROWID</code> from which it was deleted.</p>
<p>This statement queries the <code dir="ltr">FLASHBACK_TRANSACTION_QUERY</code> view for transaction information, including the transaction ID, the operation, the operation start and end SCNs, the user responsible for the operation, and the SQL code that shows the logical opposite of the operation:</p>
<pre dir="ltr">
SELECT xid, operation, start_scn, commit_scn, logon_user, undo_sql
FROM flashback_transaction_query
WHERE xid = HEXTORAW('000200030000002D');
</pre>
<p>This statement uses Oracle Flashback Version Query as a subquery to associate each row version with the <code dir="ltr">LOGON_USER</code> responsible for the row data change:</p>
<pre dir="ltr">
SELECT xid, logon_user
FROM flashback_transaction_query
WHERE xid IN (
  SELECT versions_xid FROM employees VERSIONS BETWEEN TIMESTAMP
  TO_TIMESTAMP('2003-07-18 14:00:00', 'YYYY-MM-DD HH24:MI:SS') AND
  TO_TIMESTAMP('2003-07-18 17:00:00', 'YYYY-MM-DD HH24:MI:SS')
);
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you query <code dir="ltr">FLASHBACK_TRANSACTION_QUERY</code> without specifying <code dir="ltr">XID</code> in the <code dir="ltr">WHERE</code> clause, the query scans many unrelated rows, degrading performance.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink BRADV81517" href="../../backup.112/e10642/rcmflash.htm#BRADV81517"><span class="italic">Oracle Database Backup and Recovery User's Guide.</span></a> for information about how a database administrator can use Flashback Table to restore an entire table, rather than individual rows</p>
</li>
<li>
<p><a class="olink ADMIN01512" href="../../server.112/e25494/tables.htm#ADMIN01512"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about how a database administrator can use Flashback Table to restore an entire table, rather than individual rows</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="BJFBFGCC"></a>
<div id="ADFNS1006" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Using Oracle Flashback Transaction Query with Oracle Flashback Version Query</h2>
<p>In this example, a database administrator does this:</p>
<pre dir="ltr">
DROP TABLE emp;
CREATE TABLE emp (
  empno   NUMBER PRIMARY KEY,
  empname VARCHAR2(16),
  salary  NUMBER
);
INSERT INTO emp (empno, empname, salary) VALUES (111, 'Mike', 555);
COMMIT;

DROP TABLE dept;
CREATE TABLE dept (
  deptno   NUMBER,
  deptname VARCHAR2(32)
);
INSERT INTO dept (deptno, deptname) VALUES (10, 'Accounting');
COMMIT;
</pre>
<p>Now <code dir="ltr">emp</code> and <code dir="ltr">dept</code> have one row each. In terms of row versions, each table has one version of one row. Suppose that an erroneous transaction deletes <code dir="ltr">empno</code> <code dir="ltr">111</code> from table <code dir="ltr">emp</code>:</p>
<pre dir="ltr">
UPDATE emp SET salary = salary + 100 WHERE empno = 111;
INSERT INTO dept (deptno, deptname) VALUES (20, 'Finance');
DELETE FROM emp WHERE empno = 111;
COMMIT;
</pre>
<p>Next, a transaction reinserts <code dir="ltr">empno</code> <code dir="ltr">111</code> into the <code dir="ltr">emp</code> table with a new employee name:</p>
<pre dir="ltr">
INSERT INTO emp (empno, empname, salary) VALUES (111, 'Tom', 777);
UPDATE emp SET salary = salary + 100 WHERE empno = 111;
UPDATE emp SET salary = salary + 50 WHERE empno = 111;
COMMIT;
</pre>
<p>The database administrator detects the application error and must diagnose the problem. The database administrator issues this query to retrieve versions of the rows in the <code dir="ltr">emp</code> table that correspond to empno <code dir="ltr">111</code>. The query uses Oracle Flashback Version Query pseudocolumns:</p>
<pre dir="ltr">
SELECT versions_xid XID, versions_startscn START_SCN,
  versions_endscn END_SCN, versions_operation OPERATION,
  empname, salary
FROM emp
VERSIONS BETWEEN SCN MINVALUE AND MAXVALUE
WHERE empno = 111;
</pre>
<p>Results are similar to:</p>
<pre dir="ltr">
XID               START_SCN    END_SCN O EMPNAME              SALARY
---------------- ---------- ---------- - ---------------- ----------
09001100B2200000   10093466            I Tom                     927
030002002B210000   10093459            D Mike                    555
0800120096200000   10093375   10093459 I Mike                    555
 
3 rows selected.
</pre>
<p>The results table rows are in descending chronological order. The third row corresponds to the version of the row in the table <code dir="ltr">emp</code> that was inserted in the table when the table was created. The second row corresponds to the row in <code dir="ltr">emp</code> that the erroneous transaction deleted. The first row corresponds to the version of the row in <code dir="ltr">emp</code> that was reinserted with a new employee name.</p>
<p>The database administrator identifies transaction <code dir="ltr">030002002B210000</code> as the erroneous transaction and uses Oracle Flashback Transaction Query to audit all changes made by this transaction:</p>
<pre dir="ltr">
SELECT  xid, start_scn, commit_scn, operation, logon_user, undo_sql
FROM flashback_transaction_query
WHERE xid = HEXTORAW('<span class="bold">000200030000002D</span>');
</pre>
<p>Results are similar to:</p>
<pre dir="ltr">
XID               START_SCN COMMIT_SCN OPERATION LOGON_USER
---------------- ---------- ---------- --------- ------------------------------
UNDO_SQL
--------------------------------------------------------------------------------
 
030002002B210000   10093452   10093459 DELETE    HR
insert into "HR"."EMP"("EMPNO","EMPNAME","SALARY") values ('111','Mike','655');
 
030002002B210000   10093452   10093459 INSERT    HR
delete from "HR"."DEPT" where ROWID = 'AAATjuAAEAAAAJrAAB';
 
030002002B210000   10093452   10093459 UPDATE    HR
update "HR"."EMP" set "SALARY" = '555' where ROWID = 'AAATjsAAEAAAAJ7AAA';
 
030002002B210000   10093452   10093459 BEGIN     HR
 
 
4 rows selected.
</pre>
<p>To make the result of the next query easier to read, the database administrator uses these SQL*Plus commands:</p>
<pre dir="ltr">
COLUMN operation FORMAT A9
COLUMN table_name FORMAT A10
COLUMN table_owner FORMAT A11
</pre>
<p>To see the details of the erroneous transaction and all subsequent transactions, the database administrator performs this query:</p>
<pre dir="ltr">
SELECT xid, start_scn, commit_scn, operation, table_name, table_owner
FROM flashback_transaction_query
WHERE table_owner = 'HR'
AND start_timestamp &gt;=
  TO_TIMESTAMP ('2002-04-16 11:00:00','YYYY-MM-DD HH:MI:SS');
</pre>
<p>Results are similar to:</p>
<pre dir="ltr">
XID               START_SCN COMMIT_SCN OPERATION TABLE_NAME TABLE_OWNER
---------------- ---------- ---------- --------- ---------- -----------
02000E0074200000   10093435   10093446 INSERT    DEPT       HR
030002002B210000   10093452   10093459 DELETE    EMP        HR
030002002B210000   10093452   10093459 INSERT    DEPT       HR
030002002B210000   10093452   10093459 UPDATE    EMP        HR
0800120096200000   10093374   10093375 INSERT    EMP        HR
09001100B2200000   10093462   10093466 UPDATE    EMP        HR
09001100B2200000   10093462   10093466 UPDATE    EMP        HR
09001100B2200000   10093462   10093466 INSERT    EMP        HR
 
8 rows selected.
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
Because the preceding query does not specify the <code dir="ltr">XID</code> in the <code dir="ltr">WHERE</code> clause, it scans many unrelated rows, degrading performance.</div>
</div>
<!-- class="sect1" -->
<a id="i1017341"></a>
<div id="ADFNS01009" class="sect1">
<h2 class="sect1">Using DBMS_FLASHBACK Package</h2>
<p><a id="sthref821"></a>The <code dir="ltr">DBMS_FLASHBACK</code> package provides the same functionality as Oracle Flashback Query, but Oracle Flashback Query is sometimes more convenient.</p>
<p>The <code dir="ltr">DBMS_FLASHBACK</code> package acts as a time machine: you can turn back the clock, perform normal queries as if you were at that earlier time, and then return to the present. Because you can use the <code dir="ltr">DBMS_FLASHBACK</code> package to perform queries on past data without special clauses such as <code dir="ltr">AS</code> <code dir="ltr">OF</code> or <code dir="ltr">VERSIONS</code> <code dir="ltr">BETWEEN</code>, you can reuse existing PL/SQL code to query the database at earlier times.</p>
<p>You must have the <code dir="ltr">EXECUTE</code> privilege on the <code dir="ltr">DBMS_FLASHBACK</code> package.</p>
<p>To use the <code dir="ltr">DBMS_FLASHBACK</code> package in your PL/SQL code:</p>
<ol>
<li>
<p>Specify a past time by invoking either <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">ENABLE_AT_TIME</code> or <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">ENABLE_AT_SYSTEM_CHANGE_NUMBER</code>.</p>
</li>
<li>
<p>Perform regular queries (that is, queries without special flashback-feature syntax such as <code dir="ltr">AS</code> <code dir="ltr">OF</code>). Do not perform DDL or DML operations.</p>
<p>The database is queried at the specified past time.</p>
</li>
<li>
<p>Return to the present by invoking <code dir="ltr">DBMS_FLASHBACK.DISABLE</code>.</p>
<p>You must invoke <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">DISABLE</code> before invoking <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">ENABLE_AT_TIME</code> or <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">ENABLE_AT_SYSTEM_CHANGE_NUMBER</code> again. You cannot nest enable/disable pairs.</p>
</li>
</ol>
<p>To use a cursor to store the results of queries, open the cursor before invoking <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">DISABLE</code>. After storing the results and invoking <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">DISABLE</code>, you can:</p>
<ul>
<li>
<p>Perform <code dir="ltr">INSERT</code> or <code dir="ltr">UPDATE</code> operations to modify the current database state by using the stored results from the past.</p>
</li>
<li>
<p>Compare current data with the past data. After invoking <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">DISABLE</code>, open a second cursor. Fetch from the first cursor to retrieve past data; fetch from the second cursor to retrieve current data. You can store the past data in a temporary table and then use set operators such as <code dir="ltr">MINUS</code> or <code dir="ltr">UNION</code> to contrast or combine the past and current data.</p>
</li>
</ul>
<p>You can invoke <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">GET_SYSTEM_CHANGE_NUMBER</code> at any time to get the current System Change Number (SCN). <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">GET_SYSTEM_CHANGE_NUMBER</code> always returns the current SCN regardless of previous invocations of <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">ENABLE</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ARPLS142" href="../../appdev.112/e40758/d_flashb.htm#ARPLS142"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for details of the <code dir="ltr">DBMS_FLASHBACK</code> package</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="BJFIHEIA"></a>
<div id="ADFNS1010" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Using Flashback Transaction</h2>
<p><a id="sthref822"></a><a id="sthref823"></a>The <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">TRANSACTION_BACKOUT</code> procedure rolls back a transaction and its dependent transactions while the database remains online. This recovery operation uses undo data to create and run the <span class="bold">compensating transactions</span> that return the affected data to its original state.</p>
<p>The transactions being rolled back are subject to these restrictions:</p>
<ul>
<li>
<p>They cannot have performed DDL operations that changed the logical structure of database tables.</p>
</li>
<li>
<p>They cannot use Large Object (LOB) Data Types:</p>
<ul>
<li>
<p><code dir="ltr">BFILE</code></p>
</li>
<li>
<p><code dir="ltr">BLOB</code></p>
</li>
<li>
<p><code dir="ltr">CLOB</code></p>
</li>
<li>
<p><code dir="ltr">NCLOB</code></p>
</li>
</ul>
</li>
<li>
<p>They cannot use features that LogMiner does not support.</p>
<p>The features that LogMiner supports depends on the value of the <code dir="ltr">COMPATIBLE</code> initialization parameter for the database that is rolling back the transaction. The default value is the release number of the most recent major release.</p>
<p>Flashback Transaction inherits SQL data type support from LogMiner. Therefore, if LogMiner fails due to an unsupported SQL data type in a the transaction, Flashback Transaction fails too.</p>
<p>Some data types, though supported by LogMiner, do not generate undo information as part of operations that modify columns of such types. Therefore, Flashback Transaction does not support tables containing these data types. These include tables with BLOB, CLOB and XML type.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SBYDB00305" href="../../server.112/e41134/data_support.htm#SBYDB00305"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for information about data type and DDL support on a logical standby database</p>
</li>
<li>
<p><a class="olink SQLRF50994" href="../../server.112/e41084/sql_elements001.htm#SQLRF50994"><span class="italic">Oracle Database SQL Language Reference</span></a> for information about LOB data types</p>
</li>
<li>
<p><a class="olink SUTIL019" href="../../server.112/e22490/logminer.htm#SUTIL019"><span class="italic">Oracle Database Utilities</span></a> for information about LogMiner</p>
</li>
<li>
<p><a class="olink ADMIN11112" href="../../server.112/e25494/create.htm#ADMIN11112"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about the <code dir="ltr">COMPATIBLE</code> initialization parameter</p>
</li>
</ul>
</div>
<p class="subhead2"><a id="sthref824"></a>Topics:</p>
<ul>
<li>
<p><a href="#CHDIEIGE">Dependent Transactions</a></p>
</li>
<li>
<p><a href="#BJFFDAEJ">TRANSACTION_BACKOUT Parameters</a></p>
</li>
<li>
<p><a href="#BJFHDDBG">TRANSACTION_BACKOUT Reports</a></p>
</li>
</ul>
<a id="CHDIEIGE"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Dependent Transactions</h3>
<p>In the context of Flashback Transaction, transaction 2 can <a id="sthref825"></a><a id="sthref826"></a>depend on transaction 1 in any of these ways:</p>
<ul>
<li>
<p><a id="sthref827"></a><span class="bold">Write-after-write dependency</span></p>
<p>Transaction 1 changes a row of a table, and later transaction 2 changes the same row.</p>
</li>
<li>
<p><a id="sthref828"></a><a id="sthref829"></a><span class="bold">Primary key dependency</span></p>
<p>A table has a primary key constraint on column c. In a row of the table, column c has the value v. Transaction 1 deletes that row, and later transaction 2 inserts a row into the same table, assigning the value v to column c.</p>
</li>
<li>
<p><a id="sthref830"></a><a id="sthref831"></a><span class="bold">Foreign key dependency</span></p>
<p>In table b, column b1 has a foreign key constraint on column a1 of table a. Transaction 1 changes a value in a1, and later transaction 2 changes a value in b1.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="BJFFDAEJ"></a>
<div id="ADFNS626" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">TRANSACTION_BACKOUT Parameters</h3>
<p>The parameters of the <code dir="ltr">TRANSACTION_BACKOUT</code> procedure are:</p>
<ul>
<li>
<p>Number of transactions to be backed out</p>
</li>
<li>
<p>List of transactions to be backed out, identified either by name or by XID</p>
</li>
<li>
<p>Time hint, if you identify transactions by name</p>
<p>Specify a time that is earlier than any transaction started.</p>
</li>
<li>
<p>Backout option from <a href="#g4913725">Table 12-2</a></p>
</li>
</ul>
<p>For the syntax of the <code dir="ltr">TRANSACTION_BACKOUT</code> procedure and detailed parameter descriptions, see <a class="olink ARPLS142" href="../../appdev.112/e40758/d_flashb.htm#ARPLS142"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a>.</p>
<div id="ADFNS627" class="tblformal">
<p class="titleintable"><a id="sthref832"></a><a id="g4913725"></a>Table 12-2 Flashback TRANSACTION_BACKOUT Options</p>
<table class="cellalignment1278" title="Flashback TRANSACTION_BACKOUT Options" summary="This table summarizes the Flashback TRANSACTION_BACKOUT options." dir="ltr">
<thead>
<tr class="cellalignment1267">
<th class="cellalignment1274" id="r1c1-t14">Option</th>
<th class="cellalignment1274" id="r1c2-t14">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1267">
<td class="cellalignment1275" id="r2c1-t14" headers="r1c1-t14">
<p><code dir="ltr">CASCADE</code></p>
</td>
<td class="cellalignment1275" headers="r2c1-t14 r1c2-t14">
<p>Backs out specified transactions and all dependent transactions in a post-order fashion (that is, children are backed out before parents are backed out).</p>
<p>Without <code dir="ltr">CASCADE</code>, if any dependent transaction is not specified, an error occurs.</p>
</td>
</tr>
<tr class="cellalignment1267">
<td class="cellalignment1275" id="r3c1-t14" headers="r1c1-t14">
<p><code dir="ltr">NOCASCADE</code></p>
</td>
<td class="cellalignment1275" headers="r3c1-t14 r1c2-t14">
<p>Default. Backs out specified transactions, which are expected to have no dependent transactions. First dependent transactions causes an error and appears in <code dir="ltr">*_FLASHBACK_TXN_REPORT</code>.</p>
</td>
</tr>
<tr class="cellalignment1267">
<td class="cellalignment1275" id="r4c1-t14" headers="r1c1-t14">
<p><code dir="ltr">NOCASCADE_FORCE</code></p>
</td>
<td class="cellalignment1275" headers="r4c1-t14 r1c2-t14">
<p>Backs out specified transactions, ignoring dependent transactions. Server runs undo SQL statements for specified transactions in reverse order of commit times.</p>
<p>If no constraints break and you are satisfied with the result, you can commit the changes; otherwise, you can roll them back.</p>
</td>
</tr>
<tr class="cellalignment1267">
<td class="cellalignment1275" id="r5c1-t14" headers="r1c1-t14">
<p><code dir="ltr">NONCONFLICT_ONLY</code></p>
</td>
<td class="cellalignment1275" headers="r5c1-t14 r1c2-t14">
<p>Backs out changes to nonconflicting rows of the specified transactions. Database remains consistent, but transaction atomicity is lost.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p><code dir="ltr">TRANSACTION_BACKOUT</code> analyzes the transactional dependencies, performs DML operations, and generates reports. <code dir="ltr">TRANSACTION_BACKOUT</code> does not commit the DML operations that it performs as part of transaction backout, but it holds all the required locks on rows and tables in the right form, preventing other dependencies from entering the system. To make the transaction backout permanent, you must explicitly commit the transaction.</p>
</div>
<!-- class="sect2" -->
<a id="BJFHDDBG"></a>
<div id="ADFNS628" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">TRANSACTION_BACKOUT Reports</h3>
<p>To see the reports that <code dir="ltr">TRANSACTION_BACKOUT</code> generates, query the static data dictionary views <code dir="ltr">*_FLASHBACK_TXN_STATE</code> and <code dir="ltr">*_FLASHBACK_TXN_REPORT</code>.</p>
<a id="g4914795"></a>
<div id="ADFNS629" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">*_FLASHBACK_TXN_STATE</h4>
<p>The static data dictionary view <code dir="ltr">*_FLASHBACK_TXN_STATE</code> shows whether a transaction is active or backed out. If a transaction appears in this view, it is backed out.</p>
<p><code dir="ltr">*_FLASHBACK_TXN_STATE</code> is maintained atomically for compensating transactions. If a compensating transaction is backed out, all changes that it made are also backed out, and <code dir="ltr">*_FLASHBACK_TXN_STATE</code> reflects this. For example, if compensating transaction <code dir="ltr">ct</code> backs out transactions <code dir="ltr">t1</code> and <code dir="ltr">t2</code>, then <code dir="ltr">t1</code> and <code dir="ltr">t2</code> appear in <code dir="ltr">*_FLASHBACK_TXN_STATE</code>. If <code dir="ltr">ct</code> itself is later backed out, the effects of <code dir="ltr">t1</code> and <code dir="ltr">t2</code> are reinstated, and <code dir="ltr">t1</code> and <code dir="ltr">t2</code> disappear from <code dir="ltr">*_FLASHBACK_TXN_STATE</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN23588" href="../../server.112/e40402/statviews_3193.htm#REFRN23588"><span class="italic">Oracle Database Reference</span></a> for more information about <code dir="ltr">*_FLASHBACK_TXN_STATE</code></div>
</div>
<!-- class="sect3" -->
<a id="g4914815"></a>
<div id="ADFNS630" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">*_FLASHBACK_TXN_REPORT</h4>
<p>The static data dictionary view <code dir="ltr">*_FLASHBACK_TXN_REPORT</code> provides a detailed report for each backed-out transaction.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN23587" href="../../server.112/e40402/statviews_3192.htm#REFRN23587"><span class="italic">Oracle Database Reference</span></a> for more information about <code dir="ltr">*_FLASHBACK_TXN_REPORT</code></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BJFFDCEH"></a>
<div id="ADFNS01011" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Using Flashback Data Archive (Oracle Total Recall)</h2>
<p><a id="sthref833"></a><a id="sthref834"></a>A Flashback Data Archive provides the ability to track and store transactional changes to a table over its lifetime. A Flashback Data Archive is useful for compliance with record stage policies and audit reports.</p>
<p>A Flashback Data Archive consists of one or more tablespaces or parts thereof. You can have multiple Flashback Data Archives. If you are logged on as <code dir="ltr">SYSDBA</code>, you can specify a default Flashback Data Archive for the system. A Flashback Data Archive is configured with retention time. Data archived in the Flashback Data Archive is retained for the retention time.</p>
<p>By default, flashback archiving is off for any table. You can enable flashback archiving for a table if all of these conditions are true:</p>
<ul>
<li>
<p>You have the <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> object privilege on the Flashback Data Archive to use for that table.</p>
</li>
<li>
<p>The table is neither nested, clustered, temporary, remote, or external.</p>
</li>
<li>
<p>The table contains neither <code dir="ltr">LONG</code> nor nested columns.</p>
</li>
<li>
<p>The table does not use any of these Flashback Data Archive reserved words as column names:</p>
<ul>
<li>
<p><code dir="ltr">STARTSCN</code></p>
</li>
<li>
<p><code dir="ltr">ENDSCN</code></p>
</li>
<li>
<p><code dir="ltr">RID</code></p>
</li>
<li>
<p><code dir="ltr">XID</code></p>
</li>
<li>
<p><code dir="ltr">OP</code></p>
</li>
<li>
<p><code dir="ltr">OPERATION</code></p>
</li>
</ul>
</li>
</ul>
<p>After flashback archiving is enabled for a table, you can disable it only if you either have the <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> <code dir="ltr">ADMINISTER</code> system privilege or you are logged on as <code dir="ltr">SYSDBA</code>.</p>
<p>When choosing a Flashback Data Archive for a specific table, consider the data retention requirements for the table and the retention times of the Flashback Data Archives on which you have the <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> object privilege.</p>
<p class="subhead2"><a id="sthref835"></a>Topics:</p>
<ul>
<li>
<p><a href="#BJFBJCCF">Creating a Flashback Data Archive</a></p>
</li>
<li>
<p><a href="#BJFIEEII">Altering a Flashback Data Archive</a></p>
</li>
<li>
<p><a href="#BJFBCABH">Dropping a Flashback Data Archive</a></p>
</li>
<li>
<p><a href="#BJFCDJAD">Specifying the Default Flashback Data Archive</a></p>
</li>
<li>
<p><a href="#BJFEIJEE">Enabling and Disabling Flashback Data Archive</a></p>
</li>
<li>
<p><a href="#BJFJHDAG">DDL Statements on Tables Enabled for Flashback Data Archive</a></p>
</li>
<li>
<p><a href="#BJFCAFDG">Viewing Flashback Data Archive Data</a></p>
</li>
<li>
<p><a href="#BJFJCEGD">Flashback Data Archive Scenarios</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<code dir="ltr"><a href="http://www.oracle.com/database/total-recall.html">http://www.oracle.com/database/total-recall.html</a></code> for more information about Oracle Total Recall</div>
<a id="BJFBJCCF"></a>
<div id="ADFNS631" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Creating a Flashback Data Archive</h3>
<p>Create a Flashback Data Archive with the <code dir="ltr">CREATE</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> statement, specifying:</p>
<ul>
<li>
<p>Name of the Flashback Data Archive</p>
</li>
<li>
<p>Name of the first tablespace of the Flashback Data Archive</p>
</li>
<li>
<p>(Optional) Maximum amount of space that the Flashback Data Archive can use in the first tablespace</p>
<p>The default is unlimited. Unless your space quota on the first tablespace is also unlimited, you must specify this value; otherwise, error ORA-55621 occurs.</p>
</li>
<li>
<p>Retention time (number of days that Flashback Data Archive data for the table is guaranteed to be stored)</p>
</li>
<li>
<p>As of Oracle Database 11<span class="italic">g</span> Release 2 (11.2.0.4): (Optional) Whether to optimize the storage of data in the history tables maintained in the Flashback Data Archive, using <code dir="ltr">[NO]</code> <code dir="ltr">OPTIMIZE</code> <code dir="ltr">DATA</code>.</p>
<p>The default is <code dir="ltr">NO</code> <code dir="ltr">OPTIMIZE</code> <code dir="ltr">DATA</code>.</p>
</li>
</ul>
<p>If you are logged on as <code dir="ltr">SYSDBA</code>, you can also specify that this is the default Flashback Data Archive for the system. If you omit this option, you can still make this Flashback Data Archive the default later (see <a href="#BJFCDJAD">"Specifying the Default Flashback Data Archive"</a>).</p>
<p class="subhead2"><a id="ADFNS632"></a>Examples</p>
<ul>
<li>
<p>Create a default Flashback Data Archive named <code dir="ltr">fla1</code> that uses up to 10 G of tablespace <code dir="ltr">tbs1</code>, whose data are retained for one year:</p>
<pre dir="ltr">
CREATE FLASHBACK ARCHIVE DEFAULT fla1 TABLESPACE tbs1
  QUOTA 10G RETENTION 1 YEAR;
</pre></li>
<li>
<p>Create a Flashback Data Archive named <code dir="ltr">fla2</code> that uses tablespace <code dir="ltr">tbs2</code>, whose data are retained for two years:</p>
<pre dir="ltr">
CREATE FLASHBACK ARCHIVE fla2 TABLESPACE tbs2 RETENTION 2 YEAR;
</pre></li>
</ul>
<p>For more information about the <code dir="ltr">CREATE</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> statement, see <a class="olink SQLRF012" href="../../server.112/e41084/statements_5.htm#SQLRF012"><span class="italic">Oracle Database SQL Language Reference</span></a>.</p>
</div>
<!-- class="sect2" -->
<a id="BJFIEEII"></a>
<div id="ADFNS633" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Altering a Flashback Data Archive</h3>
<p>With the <code dir="ltr">ALTER</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> statement, you can:</p>
<ul>
<li>
<p>Change the retention time of a Flashback Data Archive</p>
</li>
<li>
<p>Purge some or all of its data</p>
</li>
<li>
<p>Add, modify, and remove tablespaces</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Removing all tablespaces of a Flashback Data Archive causes an error.</div>
</li>
</ul>
<p>If you are logged on as <code dir="ltr">SYSDBA</code>, you can also use the <code dir="ltr">ALTER</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> statement to make a specific file the default Flashback Data Archive for the system.</p>
<p class="subhead2"><a id="ADFNS634"></a>Examples</p>
<ul>
<li>
<p>Make Flashback Data Archive <code dir="ltr">fla1</code> the default Flashback Data Archive:</p>
<pre dir="ltr">
ALTER FLASHBACK ARCHIVE fla1 SET DEFAULT;
</pre></li>
<li>
<p>To Flashback Data Archive <code dir="ltr">fla1</code>, add up to 5 G of tablespace <code dir="ltr">tbs3</code>:</p>
<pre dir="ltr">
ALTER FLASHBACK ARCHIVE fla1 ADD TABLESPACE tbs3 QUOTA 5G;
</pre></li>
<li>
<p>To Flashback Data Archive <code dir="ltr">fla1</code>, add as much of tablespace <code dir="ltr">tbs4</code> as needed:</p>
<pre dir="ltr">
ALTER FLASHBACK ARCHIVE fla1 ADD TABLESPACE tbs4;
</pre></li>
<li>
<p>Change the maximum space that Flashback Data Archive <code dir="ltr">fla1</code> can use in tablespace <code dir="ltr">tbs3</code> to 20 G:</p>
<pre dir="ltr">
ALTER FLASHBACK ARCHIVE fla1 MODIFY TABLESPACE tbs3 QUOTA 20G;
</pre></li>
<li>
<p>Allow Flashback Data Archive <code dir="ltr">fla1</code> to use as much of tablespace <code dir="ltr">tbs1</code> as needed:</p>
<pre dir="ltr">
ALTER FLASHBACK ARCHIVE fla1 MODIFY TABLESPACE tbs1;
</pre></li>
<li>
<p>Change the retention time for Flashback Data Archive <code dir="ltr">fla1</code> to two years:</p>
<pre dir="ltr">
ALTER FLASHBACK ARCHIVE fla1 MODIFY RETENTION 2 YEAR;
</pre></li>
<li>
<p>Remove tablespace <code dir="ltr">tbs2</code> from Flashback Data Archive <code dir="ltr">fla1</code>:</p>
<pre dir="ltr">
ALTER FLASHBACK ARCHIVE fla1 REMOVE TABLESPACE tbs2;
</pre>
<p>(Tablespace <code dir="ltr">tbs2</code> is not dropped.)</p>
</li>
<li>
<p>Purge all historical data from Flashback Data Archive <code dir="ltr">fla1</code>:</p>
<pre dir="ltr">
ALTER FLASHBACK ARCHIVE fla1 PURGE ALL;
</pre></li>
<li>
<p>Purge all historical data older than one day from Flashback Data Archive <code dir="ltr">fla1</code>:</p>
<pre dir="ltr">
ALTER FLASHBACK ARCHIVE fla1
  PURGE BEFORE TIMESTAMP (SYSTIMESTAMP - INTERVAL '1' DAY);
</pre></li>
<li>
<p>Purge all historical data older than SCN 728969 from Flashback Data Archive <code dir="ltr">fla1</code>:</p>
<pre dir="ltr">
ALTER FLASHBACK ARCHIVE fla1 PURGE BEFORE SCN 728969;
</pre></li>
</ul>
<p>For more information about the <code dir="ltr">ALTER</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> statement, see <a class="olink SQLRF20009" href="../../server.112/e41084/statements_1008.htm#SQLRF20009"><span class="italic">Oracle Database SQL Language Reference</span></a>.</p>
</div>
<!-- class="sect2" -->
<a id="BJFBCABH"></a>
<div id="ADFNS635" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Dropping a Flashback Data Archive</h3>
<p>Drop a Flashback Data Archive with the <code dir="ltr">DROP</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> statement. Dropping a Flashback Data Archive deletes its historical data, but does not drop its tablespaces.</p>
<p class="subhead2"><a id="ADFNS636"></a>Example</p>
<p>Remove Flashback Data Archive <code dir="ltr">fla1</code> and all its historical data, but not its tablespaces:</p>
<pre dir="ltr">
DROP FLASHBACK ARCHIVE fla1;
</pre>
<p>For more information about the <code dir="ltr">DROP</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> statement, see <a class="olink SQLRF20010" href="../../server.112/e41084/statements_8015.htm#SQLRF20010"><span class="italic">Oracle Database SQL Language Reference</span></a>.</p>
</div>
<!-- class="sect2" -->
<a id="BJFCDJAD"></a>
<div id="ADFNS637" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Specifying the Default Flashback Data Archive</h3>
<p>By default, the system has no default Flashback Data Archive. If you are logged on as <code dir="ltr">SYSDBA</code>, you can specify default Flashback Data Archive in either of these ways:</p>
<ul>
<li>
<p>Specify the name of an existing Flashback Data Archive in the <code dir="ltr">SET</code> <code dir="ltr">DEFAULT</code> clause of the <code dir="ltr">ALTER</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> statement. For example:</p>
<pre dir="ltr">
ALTER FLASHBACK ARCHIVE fla1 SET DEFAULT;
</pre>
<p>If <code dir="ltr">fla1</code> does not exist, an error occurs.</p>
</li>
<li>
<p>Include <code dir="ltr">DEFAULT</code> in the <code dir="ltr">CREATE</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> statement when you create a Flashback Data Archive. For example:</p>
<pre dir="ltr">
CREATE FLASHBACK ARCHIVE DEFAULT fla2 TABLESPACE tbs1
  QUOTA 10G RETENTION 1 YEAR;
</pre></li>
</ul>
<p>The default Flashback Data Archive for the system is the default Flashback Data Archive for every user who does not have his or her own default Flashback Data Archive.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SQLRF012" href="../../server.112/e41084/statements_5.htm#SQLRF012"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information about the <code dir="ltr">CREATE</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> statement</p>
</li>
<li>
<p><a class="olink SQLRF00802" href="../../server.112/e41084/statements_1004.htm#SQLRF00802"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information about the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> statement</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BJFEIJEE"></a>
<div id="ADFNS638" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Enabling and Disabling Flashback Data Archive</h3>
<p>By default, flashback archiving is disabled for any table. You can enable flashback archiving for a table if you have the <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> object privilege on the Flashback Data Archive to use for that table.</p>
<p>To enable flashback archiving for a table, include the <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> clause in either the <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> or <code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> statement. In the <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> clause, you can specify the Flashback Data Archive where the historical data for the table are stored. The default is the default Flashback Data Archive for the system. If you specify a nonexistent Flashback Data Archive, an error occurs.</p>
<p>If you enable flashback archiving for a table, but AUM is disabled, error ORA-55614 occurs when you try to modify the table.</p>
<p>If a table has flashback archiving enabled, and you try to enable it again with a different Flashback Data Archive, an error occurs.</p>
<p>After flashback archiving is enabled for a table, you can disable it only if you either have the <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> <code dir="ltr">ADMINISTER</code> system privilege or you are logged on as <code dir="ltr">SYSDBA</code>. To disable flashback archiving for a table, specify <code dir="ltr">NO</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> in the <code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> statement. (It is unnecessary to specify <code dir="ltr">NO</code> <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> in the <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> statement, because that is the default.)</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF30014" href="../../server.112/e41084/statements_7002.htm#SQLRF30014"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information about the <code dir="ltr">FLASHBACK</code> <code dir="ltr">ARCHIVE</code> clause of the <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> statement, including restrictions on its use</div>
<p class="subhead2"><a id="ADFNS639"></a>Examples</p>
<ul>
<li>
<p>Create table <code dir="ltr">employee</code> and store the historical data in the default Flashback Data Archive:</p>
<pre dir="ltr">
CREATE TABLE employee (EMPNO NUMBER(4) NOT NULL, ENAME VARCHAR2(10),
  JOB VARCHAR2(9), MGR NUMBER(4)) FLASHBACK ARCHIVE;
</pre></li>
<li>
<p>Create table <code dir="ltr">employee</code> and store the historical data in the Flashback Data Archive <code dir="ltr">fla1</code>:</p>
<pre dir="ltr">
CREATE TABLE employee (EMPNO NUMBER(4) NOT NULL, ENAME VARCHAR2(10),
  JOB VARCHAR2(9), MGR NUMBER(4)) FLASHBACK ARCHIVE fla1;
</pre></li>
<li>
<p>Enable flashback archiving for the table <code dir="ltr">employee</code> and store the historical data in the default Flashback Data Archive:</p>
<pre dir="ltr">
ALTER TABLE employee FLASHBACK ARCHIVE;
</pre></li>
<li>
<p>Enable flashback archiving for the table <code dir="ltr">employee</code> and store the historical data in the Flashback Data Archive <code dir="ltr">fla1</code>:</p>
<pre dir="ltr">
ALTER TABLE employee FLASHBACK ARCHIVE fla1;
</pre></li>
<li>
<p>Disable flashback archiving for the table <code dir="ltr">employee</code>:</p>
<pre dir="ltr">
ALTER TABLE employee NO FLASHBACK ARCHIVE;
</pre></li>
</ul>
</div>
<!-- class="sect2" -->
<a id="BJFJHDAG"></a>
<div id="ADFNS640" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">DDL Statements on Tables Enabled for Flashback Data Archive</h3>
<p>Flashback Data Archive supports only these <a id="sthref836"></a>DDL statements:</p>
<ul>
<li>
<p><code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> statement that does any of the following:</p>
<ul>
<li>
<p>Adds, drops, renames, or modifies a column</p>
</li>
<li>
<p>Adds, drops, or renames a constraint</p>
</li>
<li>
<p>Drops or truncates a partition or subpartition operation</p>
</li>
</ul>
</li>
<li>
<p><code dir="ltr">TRUNCATE</code> <code dir="ltr">TABLE</code> statement</p>
</li>
<li>
<p><code dir="ltr">RENAME</code> statement that renames a table</p>
</li>
</ul>
<p>Flashback Data Archive does not support DDL statements that move, split, merge, or coalesce partitions or subpartitions, move tables, or convert <code dir="ltr">LONG</code> columns to <code dir="ltr">LOB</code> columns.</p>
<p>For example, the following DDL statements cause error ORA-55610 when used on a table enabled for Flashback Data Archive:</p>
<ul>
<li>
<p><code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> statement that includes an <code dir="ltr">UPGRADE</code> <code dir="ltr">TABLE</code> clause, with or without an <code dir="ltr">INCLUDING</code> <code dir="ltr">DATA</code> clause</p>
</li>
<li>
<p><code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> statement that moves or exchanges a partition or subpartition operation</p>
</li>
<li>
<p><code dir="ltr">DROP</code> <code dir="ltr">TABLE</code> statement</p>
</li>
</ul>
<p>If you must use unsupported DDL statements on a table enabled for Flashback Data Archive, use the <code dir="ltr">DBMS_FLASHBACK_ARCHIVE</code>.<code dir="ltr">DISASSOCIATE_FBA</code> procedure to disassociate the base table from its Flashback Data Archive. To reassociate the Flashback Data Archive with the base table afterward, use the <code dir="ltr">DBMS_FLASHBACK_ARCHIVE</code>.<code dir="ltr">REASSOCIATE_FBA</code> procedure.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SQLRF01001" href="../../server.112/e41084/statements_3001.htm#SQLRF01001"><span class="italic">Oracle Database SQL Language Reference</span></a> for information about the <code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> statement</p>
</li>
<li>
<p><a class="olink SQLRF01707" href="../../server.112/e41084/statements_10007.htm#SQLRF01707"><span class="italic">Oracle Database SQL Language Reference</span></a> for information about the <code dir="ltr">TRUNCATE</code> <code dir="ltr">TABLE</code> statement</p>
</li>
<li>
<p><a class="olink SQLRF01608" href="../../server.112/e41084/statements_9019.htm#SQLRF01608"><span class="italic">Oracle Database SQL Language Reference</span></a> for information about the <code dir="ltr">RENAME</code> statement</p>
</li>
<li>
<p><a class="olink SQLRF01806" href="../../server.112/e41084/statements_9003.htm#SQLRF01806"><span class="italic">Oracle Database SQL Language Reference</span></a> for information about the <code dir="ltr">DROP</code> <code dir="ltr">TABLE</code> statement</p>
</li>
<li>
<p><a class="olink ARPLS66402" href="../../appdev.112/e40758/d_flashb.htm#ARPLS66402"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code dir="ltr">DBMS_FLASHBACK_ARCHIVE</code> package</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BJFCAFDG"></a>
<div id="ADFNS641" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Viewing Flashback Data Archive Data</h3>
<p><a href="#BJFJFFJD">Table 12-3</a> lists and briefly describes the static data dictionary views that you can query for information about Flashback Data Archive files.</p>
<div id="ADFNS642" class="tblformal">
<p class="titleintable"><a id="sthref837"></a><a id="BJFJFFJD"></a>Table 12-3 Static Data Dictionary Views for Flashback Data Archive Files</p>
<table class="cellalignment1278" title="Static Data Dictionary Views for Flashback Data Archive Files" summary="This table summarizes the static data dictionary views that display information about Flashback Data Archives." dir="ltr">
<thead>
<tr class="cellalignment1267">
<th class="cellalignment1274" id="r1c1-t22">View</th>
<th class="cellalignment1274" id="r1c2-t22">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1267">
<td class="cellalignment1275" id="r2c1-t22" headers="r1c1-t22">
<p><code dir="ltr">*_FLASHBACK_ARCHIVE</code></p>
</td>
<td class="cellalignment1275" headers="r2c1-t22 r1c2-t22">
<p>Displays information about Flashback Data Archive files.</p>
</td>
</tr>
<tr class="cellalignment1267">
<td class="cellalignment1275" id="r3c1-t22" headers="r1c1-t22">
<p><code dir="ltr">*_FLASHBACK_ARCHIVE_TS</code></p>
</td>
<td class="cellalignment1275" headers="r3c1-t22 r1c2-t22">
<p>Displays tablespaces of Flashback Data Archive files.</p>
</td>
</tr>
<tr class="cellalignment1267">
<td class="cellalignment1275" id="r4c1-t22" headers="r1c1-t22">
<p><code dir="ltr">*_FLASHBACK_ARCHIVE_TABLES</code></p>
</td>
<td class="cellalignment1275" headers="r4c1-t22 r1c2-t22">
<p>Displays information about tables that are enabled for Data Flashback Archive files.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink REFRN26719" href="../../server.112/e40402/statviews_5310.htm#REFRN26719"><span class="italic">Oracle Database Reference</span></a> for detailed information about <code dir="ltr">*_FLASHBACK_ARCHIVE</code></p>
</li>
<li>
<p><a class="olink REFRN23720" href="../../server.112/e40402/statviews_3191.htm#REFRN23720"><span class="italic">Oracle Database Reference</span></a> for detailed information about <code dir="ltr">*_FLASHBACK_ARCHIVE_TS</code></p>
</li>
<li>
<p><a class="olink REFRN26715" href="../../server.112/e40402/statviews_5311.htm#REFRN26715"><span class="italic">Oracle Database Reference</span></a> for detailed information about <code dir="ltr">*_FLASHBACK_ARCHIVE_TABLES</code></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BJFJCEGD"></a>
<div id="ADFNS643" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Flashback Data Archive Scenarios</h3>
<ul>
<li>
<p><a href="#BJFEDBHJ">Scenario: Using Flashback Data Archive to Enforce Digital Shredding</a></p>
</li>
<li>
<p><a href="#BJFCJBAC">Scenario: Using Flashback Data Archive to Access Historical Data</a></p>
</li>
<li>
<p><a href="#BJFDJJJJ">Scenario: Using Flashback Data Archive to Generate Reports</a></p>
</li>
<li>
<p><a href="#BJFDEBFC">Scenario: Using Flashback Data Archive for Auditing</a></p>
</li>
<li>
<p><a href="#BJFIEJGG">Scenario: Using Flashback Data Archive to Recover Data</a></p>
</li>
</ul>
<a id="BJFEDBHJ"></a>
<div id="ADFNS644" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Scenario: Using Flashback Data Archive to Enforce Digital Shredding</h4>
<p>Your company wants to "shred" (delete) historical data changes to the <code dir="ltr">Taxes</code> table after ten years. When you create the Flashback Data Archive for <code dir="ltr">Taxes</code>, you specify a retention time of ten years:</p>
<pre dir="ltr">
CREATE FLASHBACK ARCHIVE taxes_archive TABLESPACE tbs1 RETENTION 10 YEAR;
</pre>
<p>When history data from transactions on <code dir="ltr">Taxes</code> exceeds the age of ten years, it is purged. (The <code dir="ltr">Taxes</code> table itself, and history data from transactions less than ten years old, are not purged.)</p>
</div>
<!-- class="sect3" -->
<a id="BJFCJBAC"></a>
<div id="ADFNS645" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Scenario: Using Flashback Data Archive to Access Historical Data</h4>
<p>You want to be able to retrieve the inventory of all items at the beginning of the year from the table <code dir="ltr">inventory</code>, and to be able to retrieve the stock price for each symbol in your portfolio at the close of business on any specified day of the year from the table <code dir="ltr">stock_data</code>.</p>
<p>Create a default Flashback Data Archive named <code dir="ltr">fla1</code> that uses up to 10 G of tablespace <code dir="ltr">tbs1</code>, whose data are retained for five years (you must be logged on as <code dir="ltr">SYSDBA</code>):</p>
<pre dir="ltr">
CREATE FLASHBACK ARCHIVE DEFAULT fla1 TABLESPACE tbs1
  QUOTA 10G RETENTION 5 YEAR;
</pre>
<p>Enable Flashback Data Archive for the tables <code dir="ltr">inventory</code> and <code dir="ltr">stock_data</code>, and store the historical data in the default Flashback Data Archive:</p>
<pre dir="ltr">
ALTER TABLE inventory FLASHBACK ARCHIVE;
ALTER TABLE stock_data FLASHBACK ARCHIVE;
</pre>
<p>To retrieve the inventory of all items at the beginning of the year 2007, use this query:</p>
<pre dir="ltr">
SELECT product_number, product_name, count FROM inventory AS OF
  TIMESTAMP TO_TIMESTAMP ('2007-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS');
</pre>
<p>To retrieve the stock price for each symbol in your portfolio at the close of business on July 23, 2007, use this query:</p>
<pre dir="ltr">
SELECT symbol, stock_price FROM stock_data AS OF
  TIMESTAMP TO_TIMESTAMP ('2007-07-23 16:00:00', 'YYYY-MM-DD HH24:MI:SS')
  WHERE symbol IN my_portfolio;
</pre></div>
<!-- class="sect3" -->
<a id="BJFDJJJJ"></a>
<div id="ADFNS646" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Scenario: Using Flashback Data Archive to Generate Reports</h4>
<p>You want users to be able to generate reports from the table <code dir="ltr">investments</code>, for data stored in the past five years.</p>
<p>Create a default Flashback Data Archive named <code dir="ltr">fla2</code> that uses up to 20 G of tablespace <code dir="ltr">tbs1</code>, whose data are retained for five years (you must be logged on as <code dir="ltr">SYSDBA</code>):</p>
<pre dir="ltr">
CREATE FLASHBACK ARCHIVE DEFAULT fla2 TABLESPACE tbs1
  QUOTA 20G RETENTION 5 YEAR;
</pre>
<p>Enable Flashback Data Archive for the table <code dir="ltr">investments</code>, and store the historical data in the default Flashback Data Archive:</p>
<pre dir="ltr">
ALTER TABLE investments FLASHBACK ARCHIVE;
</pre>
<p>Lisa wants a report on the performance of her investments at the close of business on December 31, 2006. She uses this query:</p>
<pre dir="ltr">
SELECT * FROM investments AS OF
  TIMESTAMP TO_TIMESTAMP ('2006-12-31 16:00:00', 'YYYY-MM-DD HH24:MI:SS')
  WHERE name = 'LISA';
</pre></div>
<!-- class="sect3" -->
<a id="BJFDEBFC"></a>
<div id="ADFNS648" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Scenario: Using Flashback Data Archive for Auditing</h4>
<p>A medical insurance company must audit a medical clinic. The medical insurance company has its claims in the table <code dir="ltr">Billings</code>, and creates a default Flashback Data Archive named <code dir="ltr">fla4</code> that uses up to 100 G of tablespace <code dir="ltr">tbs1</code>, whose data are retained for 10 years:</p>
<pre dir="ltr">
CREATE FLASHBACK ARCHIVE DEFAULT fla4 TABLESPACE tbs1
  QUOTA 100G RETENTION 10 YEAR;
</pre>
<p>The company enables Flashback Data Archive for the table <code dir="ltr">Billings</code>, and stores the historical data in the default Flashback Data Archive:</p>
<pre dir="ltr">
ALTER TABLE Billings FLASHBACK ARCHIVE;
</pre>
<p>On May 1, 2007, clients were charged the wrong amounts for some diagnoses and tests. To see the records as of May 1, 2007, the company uses this query:</p>
<pre dir="ltr">
SELECT date_billed, amount_billed, patient_name, claim_Id,
  test_costs, diagnosis FROM Billings AS OF TIMESTAMP
  TO_TIMESTAMP('2007-05-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS');
</pre></div>
<!-- class="sect3" -->
<a id="BJFIEJGG"></a>
<div id="ADFNS649" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Scenario: Using Flashback Data Archive to Recover Data</h4>
<p>An end user recovers from erroneous transactions that were previously committed in the database. The undo data for the erroneous transactions is no longer available, but because the required historical information is available in the Flashback Data Archive, Flashback Query works seamlessly.</p>
<p>Lisa manages a software development group whose product sales are doing well. On November 3, 2007, she decides to give all her level-three employees who have more than two years of experience a salary increase of 10% and a promotion to level four. Lisa asks her HR representative, Bob, to make the changes.</p>
<p>Using the HR web application, Bob updates the <code dir="ltr">employee</code> table to give Lisa's level-three employees a 10% raise and a promotion to level four. Then Bob finishes his work for the day and leaves for home, unaware that he omitted the requirement of two years of experience in his transaction. A few days later, Lisa checks to see if Bob has done the updates and finds that everyone in the group was given a raise! She calls Bob immediately and asks him to correct the error.</p>
<p>At first, Bob thinks he cannot return the employee table to its prior state without going to the backups. Then he remembers that the <code dir="ltr">employee</code> table has Flashback Data Archive enabled.</p>
<p>First, he verifies that no other transaction modified the <code dir="ltr">employee</code> table after his: The commit time stamp from the transaction query corresponds to Bob's transaction, two days ago.</p>
<p>Next, Bob uses these statements to return the <code dir="ltr">employee</code> table to the way it was before his erroneous change:</p>
<pre dir="ltr">
DELETE EMPLOYEE WHERE MANAGER = 'LISA JOHNSON';
INSERT INTO EMPLOYEE
  SELECT * FROM EMPLOYEE
    AS OF TIMESTAMP (SYSTIMESTAMP - INTERVAL '2' DAY)
      WHERE MANAGER = 'LISA JOHNSON';
</pre>
<p>Bob then reexecutes the update that Lisa had requested.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="g1703520"></a>
<div id="ADFNS01012" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">General Guidelines for Oracle Flashback Technology</h2>
<ul>
<li>
<p>Use the <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">ENABLE</code> and <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">DISABLE</code> procedures around SQL code that you do not control, or when you want to use the same past time for several consecutive queries.</p>
</li>
<li>
<p>Use Oracle Flashback Query, Oracle Flashback Version Query, or Oracle Flashback Transaction Query for SQL code that you write, for convenience. An Oracle Flashback Query, for example, is flexible enough to do comparisons and store results in a single query.</p>
</li>
<li>
<p>To obtain an SCN to use later with a flashback feature, use <code dir="ltr">DBMS_FLASHBACK</code>.<code dir="ltr">GET_SYSTEM_CHANGE_NUMBER</code>.</p>
</li>
<li>
<p>To compute or retrieve a past time to use in a query, use a function return value as a time stamp or SCN argument. For example, add or subtract an <code dir="ltr">INTERVAL</code> value to the value of the <code dir="ltr">SYSTIMESTAMP</code> function.</p>
</li>
<li>
<p>Use Oracle Flashback Query, Oracle Flashback Version Query, and Oracle Flashback Transaction Query locally or remotely. An example of a remote Oracle Flashback Query is:</p>
<pre dir="ltr">
SELECT * FROM employees@some_remote_host AS OF 
    TIMESTAMP (SYSTIMESTAMP - INTERVAL '60' MINUTE);
</pre></li>
<li>
<p>To ensure database consistency, always perform a <code dir="ltr">COMMIT</code> or <code dir="ltr">ROLLBACK</code> operation before querying past data.</p>
</li>
<li>
<p>Remember that all flashback processing uses the current session settings, such as national language and character set, not the settings that were in effect at the time being queried.</p>
</li>
<li>
<p>Remember that DDLs that alter the structure of a table (such as drop/modify column, move table, drop partition, truncate table/partition, and add constraint) invalidate any existing undo data for the table. If you try to retrieve data from a time before such a DDL executed, error ORA-01466 occurs. DDL operations that alter the storage attributes of a table (such as <code dir="ltr">PCTFREE</code>, <code dir="ltr">INITRANS</code>, and <code dir="ltr">MAXTRANS</code>) do not invalidate undo data.</p>
</li>
<li>
<p>To query past data at a precise time, use an SCN. If you use a time stamp, the actual time queried might be up to 3 seconds earlier than the time you specify. Oracle Database uses SCNs internally and maps them to time stamps at a granularity of 3 seconds.</p>
<p>For example, suppose that the SCN values 1000 and 1005 are mapped to the time stamps 8:41 AM and 8:46 AM, respectively. A query for a time between 8:41:00 and 8:45:59 AM is mapped to SCN 1000; an Oracle Flashback Query for 8:46 AM is mapped to SCN 1005. Therefore, if you specify a time that is slightly after a DDL operation (such as a table creation) Oracle Database might use an SCN that is just before the DDL operation, causing error ORA-01466.</p>
</li>
<li>
<p>You cannot retrieve past data from a dynamic performance (<code dir="ltr">V$</code>) view. A query on such a view always returns current data.</p>
</li>
<li>
<p>You can perform queries on past data in static data dictionary views, such as <code dir="ltr">*_TABLES</code>.</p>
</li>
<li>
<p>As of Oracle Database 11<span class="italic">g</span> Release 2 (11.2.0.4), you can enable optimization of data storage for history tables maintained by Flashback Data Archive by specifying <code dir="ltr">OPTIMIZE</code> <code dir="ltr">DATA</code> when creating or altering a Flashback Data Archive.</p>
<p><code dir="ltr">OPTIMIZE</code> <code dir="ltr">DATA</code> optimizes the storage of data in history tables by using any of these features:</p>
<ul>
<li>
<p>Advanced Row Compression</p>
</li>
<li>
<p>Advanced LOB Compression</p>
</li>
<li>
<p>Advanced LOB Deduplication</p>
</li>
<li>
<p>Segment-level compression tiering</p>
</li>
<li>
<p>Row-level compression tiering</p>
</li>
</ul>
<p>The default is not to optimize the storage of data in history tables.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="g1703502"></a>
<div id="ADFNS01013" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Performance Guidelines for Oracle Flashback Technology</h2>
<ul>
<li>
<p><a id="sthref838"></a>Use the <a id="sthref839"></a><code dir="ltr">DBMS_STATS</code> package to generate statistics for all tables involved in an Oracle Flashback Query. Keep the statistics current. Oracle Flashback Query uses the cost-based optimizer, which relies on these statistics.</p>
</li>
<li>
<p>Minimize the amount of undo data that must be accessed. Use queries to select small sets of past data using indexes, not to scan entire tables. If you must scan a full table, add a parallel hint to the query.</p>
<p>The performance cost in I/O is the cost of paging in data and undo blocks that are not in the buffer cache. The performance cost in CPU use is the cost of applying undo information to affected data blocks. When operating on changes in the recent past, flashback operations are CPU-bound.</p>
<p>It is recommended that you have enough buffer cache, so that the versions query for the archiver finds the undo data in the buffer cache. Buffer cache access is significantly faster than disk access.</p>
</li>
<li>
<p>For Oracle Flashback Version Query, use index structures. Oracle Database keeps undo data for index changes and data changes. Performance of index lookup-based Oracle Flashback Version Query is an order of magnitude faster than the full table scans that are otherwise needed.</p>
</li>
<li>
<p>In an Oracle Flashback Transaction Query, the <code dir="ltr">xid</code> column is of the type <code dir="ltr">RAW(8)</code>. To take advantage of the index built on the <code dir="ltr">xid</code> column, use the <code dir="ltr">HEXTORAW</code> conversion function: <code dir="ltr">HEXTORAW(xid)</code>.</p>
</li>
<li>
<p>An Oracle Flashback Query against a materialized view does not take advantage of query rewrite optimization.</p>
</li>
</ul>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1266">
<tr>
<td class="cellalignment1275">
<table class="cellalignment1271">
<tr>
<td class="cellalignment1270"><a href="adfns_part_special.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1270"><a href="adfns_environments.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1277">
<table class="cellalignment1269">
<tr>
<td class="cellalignment1270"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1270"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1270"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1270"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1270"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1270"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
