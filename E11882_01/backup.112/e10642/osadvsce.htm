<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Performing User-Managed Recovery: Advanced Scenarios</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1054" />
<meta name="description" content="A guide to backup and recovery of Oracle databases, including RMAN backup and recovery, RMAN data transfer, Oracle Flashback Technology, and user-managed backup and recovery" />
<meta name="dcterms.created" content="2015-05-13T14:1:12Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Backup and Recovery User's Guide" />
<meta name="dcterms.identifier" content="E10642-08" />
<meta name="dcterms.isVersionOf" content="BRADV" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="osrecvry.htm" title="Previous" type="text/html" />
<link rel="Next" href="glossary.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10642.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">45/47</span> <!-- End Header -->
<div id="BRADV018" class="chapter"><a id="CACJIFBI"></a>
<h1 class="chapter"><span class="secnum">30</span> Performing User-Managed Recovery: Advanced Scenarios</h1>
<p><a id="sthref2151"></a><a id="sthref2152"></a>This <a id="sthref2153"></a>chapter describes several common media failure scenarios. It shows how to recover from each failure when using a user-managed backup and recovery strategy, that is, a strategy that does not depend on Recovery Manager. This chapter contains the following topics:<a id="sthref2154"></a><a id="sthref2155"></a></p>
<ul>
<li>
<p><a href="#CHDFDCGD">Responding to the Loss of a Subset of the Current Control Files</a></p>
</li>
<li>
<p><a href="#CHDGJAEH">Recovering After the Loss of All Current Control Files</a></p>
</li>
<li>
<p><a href="#CHDJAABB">Re-Creating a Control File</a></p>
</li>
<li>
<p><a href="#i1006226">Re-Creating Data Files When Backups Are Unavailable</a></p>
</li>
<li>
<p><a href="#i1007808">Recovering NOLOGGING Tables and Indexes</a></p>
</li>
<li>
<p><a href="#i1006303">Recovering Transportable Tablespaces</a></p>
</li>
<li>
<p><a href="#CACFFJFB">Recovering After the Loss of Online Redo Log Files</a></p>
</li>
<li>
<p><a href="#i1008043">Recovering from a Dropped Table Without Using Flashback Features</a></p>
</li>
<li>
<p><a href="#CACFJHED">Dropping a Database with SQL*Plus</a></p>
</li>
</ul>
<a id="CHDFDCGD"></a>
<div id="BRADV90039" class="sect1">
<h2 class="sect1">Responding to the Loss of a Subset of the Current Control Files</h2>
<p><a id="sthref2156"></a><a id="sthref2157"></a>Use the following procedures to recover a database if a permanent media failure has damaged one or more control files of a database and at least one current control file has <span class="italic">not</span> been damaged by the media failure.</p>
<div id="BRADV90040" class="sect2"><a id="sthref2158"></a>
<h3 class="sect2">Copying a Multiplexed Control File to a Default Location</h3>
<p><a id="sthref2159"></a><a id="sthref2160"></a>If the disk and file system containing the lost control file are intact, then you can simply copy an intact control file to the location of the missing control file. In this case, you do not have to edit the <code dir="ltr">CONTROL_FILES</code> initialization parameter.</p>
<p class="subhead2"><a id="BRADV508"></a>To replace a damaged control file by copying a multiplexed control file:<a id="sthref2161"></a><a id="sthref2162"></a></p>
<ol>
<li>
<p><a id="sthref2163"></a><a id="sthref2164"></a><a id="sthref2165"></a><a id="sthref2166"></a>If the instance is still running, then shut it down:</p>
<pre dir="ltr">
SQL&gt; SHUTDOWN ABORT
</pre></li>
<li>
<p>Correct the hardware problem that caused the media failure. If you cannot repair the hardware problem quickly, then proceed with database recovery by restoring damaged control files to an alternative storage device, as described in <a href="#CHDCAABA">"Copying a Multiplexed Control File to a Nondefault Location"</a>.</p>
</li>
<li>
<p>Use an intact multiplexed copy of the database's current control file to copy over the damaged control files. For example, to replace <code dir="ltr">bad_cf.f</code> with <code dir="ltr">good_cf.f</code>, you might enter:</p>
<pre dir="ltr">
% cp /oracle/good_cf.f /oracle/dbs/bad_cf.f
</pre></li>
<li>
<p>Start a new instance and mount and open the database. For example, enter:</p>
<pre dir="ltr">
SQL&gt; STARTUP
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CHDCAABA"></a>
<div id="BRADV90041" class="sect2">
<h3 class="sect2">Copying a Multiplexed Control File to a Nondefault Location</h3>
<p>Assuming that the disk and file system containing the lost control file are not intact, then you cannot copy a good control file to the location of the missing control file. In this case, you must alter the <code dir="ltr">CONTROL_FILES</code> initialization parameter to indicate a new location for the missing control file.</p>
<p class="subhead2"><a id="BRADV509"></a><a id="sthref2167"></a><a id="sthref2168"></a>To restore a control file to a nondefault location:</p>
<ol>
<li>
<p><a id="sthref2169"></a><a id="sthref2170"></a><a id="sthref2171"></a><a id="sthref2172"></a>If the instance is still running, then shut it down:</p>
<pre dir="ltr">
SQL&gt; SHUTDOWN ABORT
</pre></li>
<li>
<p>If you cannot correct the hardware problem that caused the media failure, then copy the intact control file to alternative location.</p>
<p>For example, to copy a good version of <code dir="ltr">control01.dbf</code> to a new disk location you might issue the following commands:</p>
<pre dir="ltr">
% cp /disk1/oradata/trgt/control01.dbf /new_disk/control01.dbf
</pre></li>
<li>
<p>Edit the parameter file of the database so that the <a id="sthref2173"></a><a id="sthref2174"></a><code dir="ltr">CONTROL_FILES</code> parameter reflects the current locations of all control files and excludes all control files that were not restored.</p>
<p>Assume that the initialization parameter file contains the following setting:</p>
<pre dir="ltr">
CONTROL_FILES='/disk1/oradata/trgt/control01.dbf','/bad_disk/control02.dbf'
</pre>
<p>You can edit the <code dir="ltr">CONTROL_FILES</code> initialization parameter as follows:</p>
<pre dir="ltr">
CONTROL_FILES='/disk1/oradata/trgt/control01.dbf','/new_disk/control02.dbf'
</pre></li>
<li>
<p>Start a new instance and mount and open the database. For example:</p>
<pre dir="ltr">
SQL&gt; STARTUP
</pre></li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDGJAEH"></a>
<div id="BRADV90042" class="sect1">
<h2 class="sect1">Recovering After the Loss of All Current Control Files</h2>
<p>Use the following procedures to restore a backup control file if a permanent media failure has damaged all control files of a database and you have a backup of the control file. When a control file is inaccessible, you can start the instance, but not mount the database. If you attempt to mount the database when the control file is unavailable, then you receive the following error message:</p>
<pre dir="ltr">
ORA-00205: error in identifying control file, check alert log for more info 
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
The easiest way to locate trace files and the alert log is to run the following SQL query: <code dir="ltr">SELECT NAME, VALUE FROM V$DIAG_INFO</code>.</div>
<p>You cannot mount and open the database until the control file is accessible again. If you restore a backup control file, then you must open the database with the <code dir="ltr">RESETLOGS</code> option.</p>
<p>As indicated in <a href="#CHDHFGEI">Table 30-1</a>, the procedure for restoring the control file depends on whether the online redo logs are available.</p>
<div id="BRADV510" class="tblruleformal">
<p class="titleintable"><a id="sthref2175"></a><a id="CHDHFGEI"></a>Table 30-1 Scenarios When Control Files Are Lost</p>
<table class="cellalignment1945" title="Scenarios When Control Files Are Lost" summary="This table lists restore procedures for several scenarios in which the control files are lost, depending upon the status of the online logs and datafiles." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t3">Status of Online Logs</th>
<th class="cellalignment1941" id="r1c2-t3">Status of Data Files</th>
<th class="cellalignment1941" id="r1c3-t3">Restore Procedure</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t3" headers="r1c1-t3">
<p>Available</p>
</td>
<td class="cellalignment1942" headers="r2c1-t3 r1c2-t3">
<p>Current</p>
</td>
<td class="cellalignment1942" headers="r2c1-t3 r1c3-t3">
<p>If the online logs contain redo necessary for recovery, then restore a backup control file and apply the logs during recovery. You must specify the file name of the online logs containing the changes to open the database. After recovery, open the database with the <code dir="ltr">RESETLOGS</code> option.</p>
<p><span class="bold">Note:</span> If you re-create a control file, then it is not necessary to use the <code dir="ltr">OPEN</code> <code dir="ltr">RESETLOGS</code> option after recovery when the online redo logs are accessible.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t3" headers="r1c1-t3">
<p>Unavailable</p>
</td>
<td class="cellalignment1942" headers="r3c1-t3 r1c2-t3">
<p>Current</p>
</td>
<td class="cellalignment1942" headers="r3c1-t3 r1c3-t3">
<p>If the online logs contain redo necessary for recovery, then re-create the control file. Because the online redo logs are inaccessible, open <code dir="ltr">RESETLOGS</code>.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t3" headers="r1c1-t3">
<p>Available</p>
</td>
<td class="cellalignment1942" headers="r4c1-t3 r1c2-t3">
<p>Backup</p>
</td>
<td class="cellalignment1942" headers="r4c1-t3 r1c3-t3">
<p>Restore a backup control file, perform complete recovery, and then open the database with the <code dir="ltr">RESETLOGS</code> option.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r5c1-t3" headers="r1c1-t3">
<p>Unavailable</p>
</td>
<td class="cellalignment1942" headers="r5c1-t3 r1c2-t3">
<p>Backup</p>
</td>
<td class="cellalignment1942" headers="r5c1-t3 r1c3-t3">
<p>Restore a backup control file, perform incomplete recovery, and then open <code dir="ltr">RESETLOGS</code>.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" -->
<a id="CHDBHFGF"></a>
<div id="BRADV90043" class="sect2">
<h3 class="sect2">Recovering with a Backup Control File in the Default Location</h3>
<p>If possible, restore the control file to its original location. In this way, you avoid having to specify new control file locations in the initialization parameter file.</p>
<p class="subhead2"><a id="BRADV511"></a>To restore a backup control file to its default location:</p>
<ol>
<li>
<p>If the instance is still running, shut it down:</p>
<pre dir="ltr">
SQL&gt; SHUTDOWN ABORT
</pre></li>
<li>
<p>Correct the hardware problem that caused the media failure.</p>
</li>
<li>
<p>Restore the backup control file to all locations specified in the <code dir="ltr">CONTROL_FILES</code> parameter file. For example, if <code dir="ltr">/disk1/oradata/trgt/control01.dbf</code> and <code dir="ltr">/disk2/oradata/trgt/control02.dbf</code> are the control file locations listed in the server parameter file, then use an operating system utility to restore the backup control file to these locations:</p>
<pre dir="ltr">
% cp /backup/control01.dbf /disk1/oradata/trgt/control01.dbf
% cp /backup/control02.dbf /disk2/oradata/trgt/control02.dbf
</pre></li>
<li>
<p>Start a new instance and mount the database. For example, enter:</p>
<pre dir="ltr">
SQL&gt; STARTUP MOUNT 
</pre></li>
<li>
<p>Begin recovery by executing the <code dir="ltr">RECOVER</code> command with the <code dir="ltr">USING</code> <code dir="ltr">BACKUP</code> <code dir="ltr">CONTROLFILE</code> clause. Specify <code dir="ltr">UNTIL</code> <code dir="ltr">CANCEL</code> if you are performing incomplete recovery. For example, enter:</p>
<pre dir="ltr">
SQL&gt; RECOVER DATABASE USING BACKUP CONTROLFILE UNTIL CANCEL
</pre></li>
<li>
<p>Apply the prompted archived logs. If you then receive another message saying that the required archived log is missing, then it probably means that a necessary redo record is located in the online redo logs. This situation can occur when unarchived changes were located in the online logs when the instance failed.</p>
<p>For example, assume that you see the following:</p>
<pre dir="ltr">
ORA-00279: change 55636 generated at 11/08/2002 16:59:47 needed for thread 1
ORA-00289: suggestion : /oracle/work/arc_dest/arcr_1_111.arc
ORA-00280: change 55636 for thread 1 is in sequence #111
Specify log: {&lt;RET&gt;=suggested | filename | AUTO | CANCEL}
</pre>
<p>You can specify the name of an online redo log and press Enter (you may have to try this a few times until you find the correct log):</p>
<pre dir="ltr">
<span class="italic">ORACLE_HOME</span>/oradata/redo01.dbf
Log applied.
Media recovery complete.
</pre>
<p>If the online logs are inaccessible, then you can cancel recovery without applying them. If all data files are current, and if redo in the online logs is required for recovery, then you cannot open the database without applying the online logs. If the online logs are inaccessible, then you must re-create the control file, using the procedure described in <a href="#CHDJAABB">"Re-Creating a Control File"</a>.</p>
</li>
<li>
<p>Open the database with the <code dir="ltr">RESETLOGS</code> option after finishing recovery:</p>
<pre dir="ltr">
SQL&gt; ALTER DATABASE OPEN RESETLOGS;
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<div id="BRADV90044" class="sect2"><a id="sthref2176"></a>
<h3 class="sect2">Recovering with a Backup Control File in a Nondefault Location</h3>
<p>If you cannot restore the control file to its original place because the media damage is too severe, then you must specify new control file locations in the server parameter file. A valid control file must be available in all locations specified by the <code dir="ltr">CONTROL_FILES</code> initialization parameter. If not, then the database prevents you from the mounting the database.</p>
<p class="subhead2"><a id="BRADV512"></a>To restore a control file to a nondefault location:</p>
<p>Follow the steps in <a href="#CHDBHFGF">"Recovering with a Backup Control File in the Default Location"</a>, except after Step 2 add the following step:</p>
<p>Edit all locations specified in the <code dir="ltr">CONTROL_FILES</code> initialization parameter to reflect the new control file locations. Assume that the control file locations listed in the server parameter file are as follows, and both disks are inaccessible:</p>
<pre dir="ltr">
CONTROL_FILES='/disk1/oradata/trgt/control01.dbf',
              '/disk2/oradata/trgt/control02.dbf'
</pre>
<p>You can edit the initialization parameter file and specify accessible locations, as shown in the following example:</p>
<pre dir="ltr">
CONTROL_FILES='/disk3/cf/control01.dbf','/disk4/cf/control02.dbf'
</pre></div>
<!-- class="sect2" -->
<a id="CHDCGGDI"></a>
<div id="BRADV223" class="sect2">
<h3 class="sect2">Recovering Through an Added Data File with a Backup Control File</h3>
<p><a id="sthref2177"></a><a id="sthref2178"></a><a id="sthref2179"></a>If database recovery with a backup control file rolls forward through a <code dir="ltr">CREATE</code> <code dir="ltr">TABLESPACE</code> or an <code dir="ltr">ALTER</code> <code dir="ltr">TABLESPACE</code> <code dir="ltr">ADD</code> <code dir="ltr">DATAFILE</code> operation, then the database stops recovery when applying the redo record for the added files and lets you confirm the file names.</p>
<p>For example, suppose that the following sequence of events occurs:</p>
<ol>
<li>
<p>You back up the database.</p>
</li>
<li>
<p>You create a tablespace containing the following data files: <code dir="ltr">/disk1/oradata/trgt/test01.dbf</code> and <code dir="ltr">/disk1/oradata/trgt/test02.dbf</code>.</p>
</li>
<li>
<p><a id="sthref2180"></a>You restore a backup control file and perform media recovery through the <code dir="ltr">CREATE</code> <code dir="ltr">TABLESPACE</code> operation.</p>
</li>
</ol>
<p>You may see the following error when applying the <code dir="ltr">CREATE</code> <code dir="ltr">TABLESPACE</code> redo data:</p>
<pre dir="ltr">
ORA-00283: recovery session canceled due to errors 
ORA-01244: unnamed datafile(s) added to control file by media recovery
ORA-01110: data file 11: '/disk1/oradata/trgt/test02.dbf'
ORA-01110: data file 10: '/disk1/oradata/trgt/test01.dbf'
</pre>
<p class="subhead2"><a id="BRADV513"></a>To recover through an ADD DATAFILE operation:</p>
<ol>
<li>
<p>View the files added by querying <code dir="ltr">V$DATAFILE</code>., as in the following example:</p>
<pre dir="ltr">
SELECT FILE#,NAME 
FROM V$DATAFILE;

FILE#           NAME
--------------- ----------------------
1               /disk1/oradata/trgt/system01.dbf
.
.
.
10               /disk1/oradata/trgt/UNNAMED00001
11               /disk1/oradata/trgt/UNNAMED00002
</pre></li>
<li>
<p>If multiple unnamed files exist, then determine which unnamed file corresponds to which data file by using one of these methods:</p>
<ul>
<li>
<p>Open the <code dir="ltr">alert_</code><code dir="ltr"><span class="codeinlineitalic">SID</span></code><code dir="ltr">.log</code>, which contains messages about the original file location for each unnamed file.</p>
</li>
<li>
<p>Derive the original file location of each unnamed file from the error message and <code dir="ltr">V$DATAFILE</code>: each unnamed file corresponds to the file in the error message with the same file number.</p>
</li>
</ul>
</li>
<li>
<p><a id="sthref2181"></a>Issue the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">RENAME</code> <code dir="ltr">FILE</code> statement to rename the data files. For example, enter:</p>
<pre dir="ltr">
ALTER DATABASE RENAME FILE '/db/UNNAMED00001' TO
                           '/disk1/oradata/trgt/test01.dbf';
ALTER DATABASE RENAME FILE '/db/UNNAMED00002' TO
                           '/disk1/oradata/trgt/test02.dbf';
</pre></li>
<li>
<p>Continue recovery by issuing the recovery statement. For example:</p>
<pre dir="ltr">
RECOVER AUTOMATIC DATABASE USING BACKUP CONTROLFILE UNTIL CANCEL
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="i1006268"></a>
<div id="BRADV227" class="sect2">
<h3 class="sect2">Recovering Read-Only Tablespaces with a Backup Control File</h3>
<p>If you have a read-only tablespace on read-only or slow media, then you may encounter errors or poor performance when recovering with the <a id="sthref2182"></a><code dir="ltr">USING</code> <code dir="ltr">BACKUP</code> <code dir="ltr">CONTROLFILE</code> option. This situation occurs when the backup control file indicates that a tablespace was read/write when the control file was backed up. In this case, media recovery may attempt to write to the files. For read-only media, the database issues an error saying that it cannot write to the files. For slow media, such as a hierarchical storage system backed up by tapes, performance may suffer.</p>
<p>To avoid these problems, use current control files rather than backups to recover the database. If you must use a backup control file, then you can also avoid this problem if the read-only tablespace has not suffered a media failure. You have the following alternatives for recovering read-only and slow media when using a backup control file:</p>
<ul>
<li>
<p>Take data files from read-only tablespaces offline before doing recovery with a backup control file, and then bring the files online at the end of media recovery.</p>
</li>
<li>
<p>Use the correct version of the control file for the recovery. If the tablespace will be read-only when recovery completes, then the control file backup must be from a time when the tablespace was read-only. Similarly, if the tablespace will be read/write at the end of recovery, then the control file must be from a time when the tablespace was read/write.</p>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDJAABB"></a>
<div id="BRADV90045" class="sect1">
<h2 class="sect1">Re-Creating a Control File</h2>
<p><a id="sthref2183"></a><a id="sthref2184"></a><a id="sthref2185"></a>If all control files have been lost in a permanent media failure, but all online redo log members remain intact, then you can recover the database after creating a new control file. You are <span class="italic">not</span> required to open the database with the <code dir="ltr">RESETLOGS</code> option after the recovery.</p>
<p>Depending on the existence and currency of a control file backup, you have the options listed in <a href="#CHDJJGII">Table 30-2</a> for generating the text of the <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> statement. The changes to the database are recorded in the <span class="italic">alert_SID.log</span>, so check this log when you are deciding which option to choose.</p>
<div id="BRADV514" class="tblruleformal">
<p class="titleintable"><a id="sthref2186"></a><a id="CHDJJGII"></a>Table 30-2 Options for Creating the Control File</p>
<table class="cellalignment1945" title="Options for Creating the Control File" summary="This table details different options for recreating your control file, depending upon available resources." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t4">If you . . .</th>
<th class="cellalignment1941" id="r1c2-t4">Then . . .</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t4" headers="r1c1-t4">
<p>Executed <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">BACKUP</code> <code dir="ltr">CONTROLFILE</code> <code dir="ltr">TO</code> <code dir="ltr">TRACE</code> <code dir="ltr">NORESETLOGS</code> after you made the last structural change to the database, and if you have saved the SQL command trace output</p>
</td>
<td class="cellalignment1942" headers="r2c1-t4 r1c2-t4">
<p>Use the <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> statement from the trace output as-is.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t4" headers="r1c1-t4">
<p>Performed your most recent execution of <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">BACKUP</code> <code dir="ltr">CONTROLFILE</code> <code dir="ltr">TO</code> <code dir="ltr">TRACE</code> before you made a structural change to the database</p>
</td>
<td class="cellalignment1942" headers="r3c1-t4 r1c2-t4">
<p>Edit the output of <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">BACKUP</code> <code dir="ltr">CONTROLFILE</code> <code dir="ltr">TO</code> <code dir="ltr">TRACE</code> to reflect the change. For example, if you recently added a data file to the database, then add this data file to the <code dir="ltr">DATAFILE</code> clause of the <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> statement.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t4" headers="r1c1-t4">
<p>Backed up the control file with the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">BACKUP</code> <code dir="ltr">CONTROLFILE</code> <code dir="ltr">TO</code> <code dir="ltr"><span class="codeinlineitalic">filename</span></code> statement (not the <code dir="ltr">TO</code> <code dir="ltr">TRACE</code> option)</p>
</td>
<td class="cellalignment1942" headers="r4c1-t4 r1c2-t4">
<p>Use the control file copy to obtain SQL output. Create a temporary database instance, mount the backup control file, and then run <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">BACKUP</code> <code dir="ltr">CONTROLFILE</code> <code dir="ltr">TO</code> <code dir="ltr">TRACE</code> <code dir="ltr">NORESETLOGS</code>. If the control file copy predated a recent structural change, then edit the trace option to reflect the change.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r5c1-t4" headers="r1c1-t4">
<p>Do not have a control file backup in either <code dir="ltr">TO</code> <code dir="ltr">TRACE</code> format or <code dir="ltr">TO</code> <code dir="ltr"><span class="codeinlineitalic">filename</span></code> format</p>
</td>
<td class="cellalignment1942" headers="r5c1-t4 r1c2-t4">
<p>Execute the <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> statement manually (See <a class="olink SQLRF01203" href="../../server.112/e41084/statements_5003.htm#SQLRF01203"><span class="italic">Oracle Database SQL Language Reference</span></a>).</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" -->
<div class="infobox-note">
<p class="notep1">Note:</p>
If your character set is not the default US7ASCII, then you must specify the character set as an argument to the <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> statement. The database character set is written to the alert log at startup. The character set information is also recorded in the <code dir="ltr">BACKUP</code> <code dir="ltr">CONTROLFILE</code> <code dir="ltr">TO</code> <code dir="ltr">TRACE</code> output.</div>
<p class="subhead2"><a id="BRADV515"></a><a id="sthref2187"></a>To create a new control file and recover the database:</p>
<ol>
<li>
<p>Start the database in <code dir="ltr">NOMOUNT</code> mode. For example, enter:</p>
<pre dir="ltr">
STARTUP NOMOUNT
</pre></li>
<li>
<p>Create the control file with the <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> statement, specifying the <code dir="ltr">NORESETLOGS</code> option (See to <a href="#CHDJJGII">Table 30-2</a> for options). The following example assumes that the character set is the default US7ASCII:</p>
<pre dir="ltr">
CREATE CONTROLFILE REUSE DATABASE SALES NORESETLOGS ARCHIVELOG
     MAXLOGFILES 32
     MAXLOGMEMBERS 2
     MAXDATAFILES 32
     MAXINSTANCES 16
     MAXLOGHISTORY 1600
LOGFILE
     GROUP 1 (
       '/diska/prod/sales/db/log1t1.dbf',
       '/diskb/prod/sales/db/log1t2.dbf'
     )  SIZE 100K
     GROUP 2 (
       '/diska/prod/sales/db/log2t1.dbf',
       '/diskb/prod/sales/db/log2t2.dbf'
     )  SIZE 100K
DATAFILE
     '/diska/prod/sales/db/database1.dbf',
     '/diskb/prod/sales/db/filea.dbf';
</pre>
<p>After creating the control file, the instance mounts the database.</p>
</li>
<li>
<p>Recover the database as usual (<span class="italic">without</span> specifying the <code dir="ltr">USING</code> <code dir="ltr">BACKUP</code> <code dir="ltr">CONTROLFILE</code> clause):</p>
<pre dir="ltr">
RECOVER DATABASE
</pre></li>
<li>
<p>Open the database after recovery completes (The <code dir="ltr">RESETLOGS</code> option is not required):</p>
<pre dir="ltr">
ALTER DATABASE OPEN;
</pre></li>
<li>
<p>Immediately back up the control file. The following SQL statement backs up a database's control file to <code dir="ltr">/backup/control01.dbf</code>:</p>
<pre dir="ltr">
ALTER DATABASE BACKUP CONTROLFILE TO '/backup/control01.dbf' REUSE;
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="osbackup.htm#g1020041">"Backing Up the Control File to a Trace File"</a>, and <a href="#i1006226">"Re-Creating Data Files When Backups Are Unavailable"</a></div>
</li>
</ol>
<a id="i1006820"></a>
<div id="BRADV225" class="sect2">
<h3 class="sect2">Recovering Through a RESETLOGS with a Created Control File</h3>
<p>You can recover backups through an <code dir="ltr">OPEN</code> <code dir="ltr">RESETLOGS</code> operation so long as:</p>
<ul>
<li>
<p>You have a current, backup, or created control file that detects prior incarnations</p>
</li>
<li>
<p>You have all available archived redo logs</p>
</li>
</ul>
<p>If you must re-create the control file, then the trace file generated by <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">BACKUP</code> <code dir="ltr">CONTROLFILE</code> <code dir="ltr">TO</code> <code dir="ltr">TRACE</code> contains the necessary commands to reconstruct the complete incarnation history. The <code dir="ltr">V$DATABASE_INCARNATION</code> view displays the RESETLOGS history of the control file, and the <code dir="ltr">V$LOG_HISTORY</code> view displays the archived log history.</p>
<p>It is possible for the incarnation history to be incomplete in the in re-created control file. For example, archived logs necessary for recovery may be missing. In this case, it is possible to create incarnation records explicitly with the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">REGISTER</code> <code dir="ltr">LOGFILE</code> statement.</p>
<p>In the following example, you register four logs that are necessary for recovery but are not recorded in the re-created control file, and then recover the database:</p>
<pre dir="ltr">
ALTER DATABASE REGISTER LOGFILE '/disk1/oradata/trgt/arch/arcr_1_1_42343523.arc';
ALTER DATABASE REGISTER LOGFILE '/disk1/oradata/trgt/arch/arcr_1_1_34546466.arc';
ALTER DATABASE REGISTER LOGFILE '/disk1/oradata/trgt/arch/arcr_1_1_23435466.arc';
ALTER DATABASE REGISTER LOGFILE '/disk1/oradata/trgt/arch/arcr_1_1_12343533.arc';
RECOVER AUTOMATIC DATABASE;
</pre></div>
<!-- class="sect2" -->
<a id="i1006277"></a>
<div id="BRADV90046" class="sect2">
<h3 class="sect2">Recovery of Read-Only Files with a Re-Created Control File</h3>
<p>If a current or backup control file is unavailable for recovery, then you can execute a <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> statement. Read-only files should not be listed in the <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> statement so that recovery can skip these files. No recovery is required for read-only data files unless you restored backups of these files from a time when the data files were read/write.</p>
<p>After you create a control file and attempt to mount and open the database, the database performs a data dictionary check against the files listed in the control file. For each file that is not listed in the <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> statement but is present in the data dictionary, an entry is created for them in the control file. These files are named as <code dir="ltr">MISSING</code><code dir="ltr"><span class="codeinlineitalic">nnnnn</span></code>, where <code dir="ltr"><span class="codeinlineitalic">nnnnn</span></code> is a 5-digit number starting with <code dir="ltr">0</code>.</p>
<p>After the database is open, rename the read-only files to their correct file names by executing the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">RENAME</code> <code dir="ltr">FILE</code> statement for all the files whose names are prefixed with <code dir="ltr">MISSING</code>.</p>
<p class="subhead2"><a id="BRADV516"></a>To prepare for a scenario in which you might have to re-create the control file:</p>
<p>Run the following statement when the database is mounted or open to obtain the <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> syntax:</p>
<pre dir="ltr">
ALTER DATABASE BACKUP CONTROLFILE TO TRACE;
</pre>
<p>The preceding SQL statement produces a trace file that you can edit and use as a script to re-create the control file. You can specify either the <code dir="ltr">RESETLOGS</code> or <code dir="ltr">NORESETLOGS</code> (default) keywords to generate <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> <code dir="ltr">...</code> <code dir="ltr">RESETLOGS</code> or <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> <code dir="ltr">...</code> <code dir="ltr">NORESETLOGS</code> versions of the script.</p>
<p>All the restrictions related to read-only files in <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> statements also apply to offline normal tablespaces, except that you must to bring the tablespace online after the database is open. You should omit temp files from the <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> statement and add them after opening the database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="osbackup.htm#g1020041">"Backing Up the Control File to a Trace File"</a> to learn how to make trace backups of the control file</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006226"></a>
<div id="BRADV224" class="sect1">
<h2 class="sect1">Re-Creating Data Files When Backups Are Unavailable</h2>
<p><span class="bold"><a id="sthref2188"></a><a id="sthref2189"></a><a id="sthref2190"></a></span>If a data file is damaged and no backup of the file is available, then you can still recover the data file if:</p>
<ul>
<li>
<p>All archived log files written after the creation of the original data file are available</p>
</li>
<li>
<p>The control file contains the name of the damaged file (that is, the control file is current, or is a backup taken after the damaged data file was added to the database)</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You cannot re-create any of the data files for the <code dir="ltr">SYSTEM</code> tablespace by using the <code dir="ltr">CREATE</code> <code dir="ltr">DATAFILE</code> clause of the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> statement because the necessary redo is not available.</div>
</li>
</ul>
<p class="subhead2"><a id="BRADV517"></a>To re-create a data file for recovery:</p>
<ol>
<li>
<p><a id="sthref2191"></a>Create a new, empty data file to replace a damaged data file that has no corresponding backup. For example, assume that the data file <code dir="ltr">/disk1/oradata/trgt/users01.dbf</code> has been damaged, and no backup is available. The following statement re-creates the original data file (same size) on <code dir="ltr">disk2</code>:</p>
<pre dir="ltr">
ALTER DATABASE CREATE DATAFILE '/disk1/oradata/trgt/users01.dbf' AS
                               '/disk2/users01.dbf';
</pre>
<p>This statement creates an empty file that is the same size as the lost file. The database looks at information in the control file and the data dictionary to obtain size information. The old data file is renamed as the new data file.</p>
</li>
<li>
<p>Perform media recovery on the empty data file. For example, enter:</p>
<pre dir="ltr">
RECOVER DATAFILE '/disk2/users01.dbf'
</pre></li>
<li>
<p>All archived logs written after the original data file was created must be applied to the new, empty version of the lost data file during recovery.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="i1007808"></a>
<div id="BRADV90047" class="sect1">
<h2 class="sect1">Recovering NOLOGGING Tables and Indexes</h2>
<p>You can create tables and indexes with the <a id="sthref2192"></a><a id="sthref2193"></a><a id="sthref2194"></a><code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> <code dir="ltr">AS</code> <code dir="ltr">SELECT</code> statement. You can also specify that the database create them with the <code dir="ltr">NOLOGGING</code> option. When you create a table or index as <code dir="ltr">NOLOGGING</code>, the database does not generate redo log records for the operation. Thus, you cannot recover objects created with <code dir="ltr">NOLOGGING</code>, even if you run in <code dir="ltr">ARCHIVELOG</code> mode.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you cannot afford to lose tables or indexes created with <code dir="ltr">NOLOGGING</code>, then make a backup after the unrecoverable table or index is created.</div>
<p>Be aware that when you perform media recovery, and some tables or indexes are created normally whereas others are created with the <code dir="ltr">NOLOGGING</code> option, the <code dir="ltr">NOLOGGING</code> objects are marked logically corrupt by the <code dir="ltr">RECOVER</code> operation. Any attempt to access the unrecoverable objects returns an <a id="sthref2195"></a><a id="sthref2196"></a><a id="sthref2197"></a><code dir="ltr">ORA-01578</code> error message. Drop the <code dir="ltr">NOLOGGING</code> objects and re-create them if needed.</p>
<p>Because it is possible to create a table with the <code dir="ltr">NOLOGGING</code> option and then create an index with the <code dir="ltr">LOGGING</code> option on that table, the index is not marked as logically corrupt after you perform media recovery. The table was unrecoverable (and thus marked as corrupt after recovery), however, so the index points to corrupt blocks. The index must be dropped, and the table and index must be re-created if necessary.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SBYDB00920" href="../../server.112/e41134/scenarios.htm#SBYDB00920"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for information about the effect of <code dir="ltr">NOLOGGING</code> on a database</div>
</div>
<!-- class="sect1" -->
<a id="i1006303"></a>
<div id="BRADV228" class="sect1">
<h2 class="sect1">Recovering Transportable Tablespaces</h2>
<p><a id="sthref2198"></a><a id="sthref2199"></a><a id="sthref2200"></a>The <a href="glossary.htm#CHDHIGHH"><span class="xrefglossterm">transportable tablespace</span></a> feature of Oracle Database enables a user to transport a set of tablespaces from one database to another. Transporting a tablespace into a database is like creating a tablespace with loaded data. Using this feature is often an advantage for the following reasons:</p>
<ul>
<li>
<p>It is faster than using the Data Pump Export or SQL*Loader utilities because it involves only copying data files and integrating metadata</p>
</li>
<li>
<p>You can use it to move index data, hence avoiding the necessity of rebuilding indexes</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMIN011" href="../../server.112/e25494/tspaces.htm#ADMIN011"><span class="italic">Oracle Database Administrator's Guide</span></a> for detailed information about using the transportable tablespace feature</div>
<p>Like normal tablespaces, transportable tablespaces are recoverable. However, even though you can recover normal tablespaces without a backup, you must have a consistent version of the transported data files to recover a transported tablespace.</p>
<p class="subhead2"><a id="BRADV518"></a>To recover a transportable tablespace, use the following procedure:</p>
<ol>
<li>
<p>If the database is open, then take the transported tablespace offline. For example, if you want to recover the <code dir="ltr">users</code> tablespace, then issue the following statement:</p>
<pre dir="ltr">
ALTER TABLESPACE users OFFLINE IMMEDIATE;
</pre></li>
<li>
<p>Restore a backup of the transported data files with an operating system utility. The backup can be the initial version of the transported data files or any backup taken after the tablespace is transported. For example, enter:</p>
<pre dir="ltr">
% cp /backup/users.dbf $ORACLE_HOME/oradata/trgt/users01.dbf
</pre></li>
<li>
<p>Recover the tablespace as usual. For example, enter:</p>
<pre dir="ltr">
RECOVER TABLESPACE users
</pre></li>
</ol>
<p>You may see the error <code dir="ltr">ORA-01244</code> when recovering through a transportable tablespace operation just as when recovering through a <code dir="ltr">CREATE</code> <code dir="ltr">TABLESPACE</code> operation. In this case, rename the unnamed files to the correct locations using the procedure in <a href="#CHDCGGDI">"Recovering Through an Added Data File with a Backup Control File"</a>.</p>
</div>
<!-- class="sect1" -->
<a id="CACFFJFB"></a>
<div id="BRADV229" class="sect1">
<h2 class="sect1">Recovering After the Loss of Online Redo Log Files</h2>
<p><a id="sthref2201"></a><a id="sthref2202"></a><a id="sthref2203"></a>If a media failure has affected the online redo logs of a database, then the appropriate recovery procedure depends on the following considerations:</p>
<ul>
<li>
<p>The configuration of the online redo log: mirrored or non-mirrored</p>
</li>
<li>
<p>The type of media failure: temporary or permanent</p>
</li>
<li>
<p>The types of online redo log files affected by the media failure: current, active, unarchived, or inactive</p>
</li>
</ul>
<p><a href="#g1010854">Table 30-3</a> displays <code dir="ltr">V$LOG</code> status information that can be crucial in a recovery situation involving online redo logs.</p>
<div id="BRADV519" class="tblhruleformal">
<p class="titleintable"><a id="sthref2204"></a><a id="g1010854"></a>Table 30-3 STATUS Column of V$LOG</p>
<table class="cellalignment1945" title="STATUS Column of V$LOG " summary="This table explains possible values for V$LOG.STATUS and their meaing." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t12">Status</th>
<th class="cellalignment1941" id="r1c2-t12">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t12" headers="r1c1-t12">
<p><code dir="ltr">UNUSED</code></p>
</td>
<td class="cellalignment1942" headers="r2c1-t12 r1c2-t12">
<p>The online redo log has never been written to.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t12" headers="r1c1-t12">
<p><code dir="ltr">CURRENT</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t12 r1c2-t12">
<p>The online redo log is active, that is, needed for instance recovery, and it is the log to which the database is currently writing. The redo log can be open or closed.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t12" headers="r1c1-t12">
<p><code dir="ltr">ACTIVE</code></p>
</td>
<td class="cellalignment1942" headers="r4c1-t12 r1c2-t12">
<p>The online redo log is active, that is, needed for instance recovery, but is not the log to which the database is currently writing. It may be in use for block recovery, and may or may not be archived.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r5c1-t12" headers="r1c1-t12">
<p><code dir="ltr">CLEARING</code></p>
</td>
<td class="cellalignment1942" headers="r5c1-t12 r1c2-t12">
<p>The log is being re-created as an empty log after an <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">CLEAR</code> <code dir="ltr">LOGFILE</code> statement. After the log is cleared, then the status changes to <code dir="ltr">UNUSED</code>.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r6c1-t12" headers="r1c1-t12">
<p><code dir="ltr">CLEARING_CURRENT</code></p>
</td>
<td class="cellalignment1942" headers="r6c1-t12 r1c2-t12">
<p>The current log is being cleared of a closed thread. The log can stay in this status if there is some failure in the switch such as an I/O error writing the new log header.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r7c1-t12" headers="r1c1-t12">
<p><code dir="ltr">INACTIVE</code></p>
</td>
<td class="cellalignment1942" headers="r7c1-t12 r1c2-t12">
<p>The log is no longer needed for instance recovery. It may be in use for media recovery, and may or may not be archived.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<div id="BRADV90048" class="sect2"><a id="sthref2205"></a>
<h3 class="sect2">Recovering After Losing a Member of a Multiplexed Online Redo Log Group</h3>
<p>You can recover after losing a member of a multiplexed online redo log group. The database continues to function as usual during the following conditions:</p>
<p>If the online redo log of a database is multiplexed, and if at least one member of each online redo log group is not affected by the media failure, then the database continues functioning as usual, but error messages are written to the log writer trace file and the <code dir="ltr">alert_</code><code dir="ltr"><span class="codeinlineitalic">SID</span></code><code dir="ltr">.log</code> of the database.</p>
<p>You can resolve the problem of a missing member of a multiplexed online redo log group by taking one of the following actions:</p>
<ul>
<li>
<p>If the hardware problem is temporary, then correct it. The log writer process accesses the previously unavailable online redo log files as if the problem never existed.</p>
</li>
<li>
<p>If the hardware problem is permanent, then drop the damaged member and add a new member by using the following procedure.<span class="bold"><a id="sthref2206"></a></span></p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The newly added member provides no redundancy until the log group is reused.</div>
</li>
</ul>
<ol>
<li>
<p>Locate the file name of the damaged member in <a id="sthref2207"></a><code dir="ltr">V$LOGFILE</code>. The status is <code dir="ltr">INVALID</code> if the file is inaccessible:<a id="sthref2208"></a><a id="sthref2209"></a><a id="sthref2210"></a><a id="sthref2211"></a><a id="sthref2212"></a><a id="sthref2213"></a><a id="sthref2214"></a></p>
<pre dir="ltr">
SELECT GROUP#, STATUS, MEMBER 
FROM V$LOGFILE
WHERE STATUS='INVALID';

GROUP#    STATUS       MEMBER
-------   -----------  ---------------------
0002      INVALID      /disk1/oradata/trgt/redo02.log
</pre></li>
<li>
<p>Drop the damaged member. For example, to drop member <code dir="ltr">redo02.log</code> from group <code dir="ltr">2</code>, issue the following statement:</p>
<pre dir="ltr">
ALTER DATABASE DROP LOGFILE MEMBER '/disk1/oradata/trgt/redo02.log';
</pre></li>
<li>
<p>Add a new member to the group. For example, to add <code dir="ltr">redo02.log</code> to group <code dir="ltr">2</code>, issue the following statement:</p>
<pre dir="ltr">
ALTER DATABASE ADD LOGFILE MEMBER '/disk1/oradata/trgt/redo02b.log' 
  TO GROUP 2;
</pre>
<p>If the file that you want to add exists, then it must be the same size as the other group members, and you must specify the <code dir="ltr">REUSE</code> option. For example:</p>
<pre dir="ltr">
ALTER DATABASE ADD LOGFILE MEMBER '/disk1/oradata/trgt/redo02b.log'
  REUSE TO GROUP 2;
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="i1006437"></a>
<div id="BRADV90049" class="sect2">
<h3 class="sect2">Recovering After Losing All Members of an Online Redo Log Group</h3>
<p><a id="sthref2215"></a><a id="sthref2216"></a><a id="sthref2217"></a><a id="sthref2218"></a>If a media failure damages all members of an online redo log group, then different scenarios can occur depending on the type of online redo log group affected by the failure and the archiving mode of the database.</p>
<p>If the damaged online redo log group is current and active, then it is needed for crash recovery; otherwise, it is not. <a href="#CACFJDBG">Table 30-4</a> outlines the various recovery scenarios.</p>
<div id="BRADV520" class="tblruleformal">
<p class="titleintable"><a id="sthref2219"></a><a id="CACFJDBG"></a>Table 30-4 Recovering After the Loss of an Online Redo Log Group</p>
<table class="cellalignment1945" title="Recovering After the Loss of an Online Redo Log Group" summary="This table describes scenarios and responses for the loss of all members of an online log group." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t14">If the Group Is...</th>
<th class="cellalignment1941" id="r1c2-t14">Then...</th>
<th class="cellalignment1941" id="r1c3-t14">And You Should...</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t14" headers="r1c1-t14">
<p>Inactive</p>
</td>
<td class="cellalignment1942" headers="r2c1-t14 r1c2-t14">
<p>It is not needed for crash recovery</p>
</td>
<td class="cellalignment1942" headers="r2c1-t14 r1c3-t14">
<p>Clear the archived or unarchived group.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t14" headers="r1c1-t14">
<p>Active</p>
</td>
<td class="cellalignment1942" headers="r3c1-t14 r1c2-t14">
<p>It is needed for crash recovery</p>
</td>
<td class="cellalignment1942" headers="r3c1-t14 r1c3-t14">
<p>Attempt to issue a checkpoint and clear the log; if impossible, then you must either use Flashback Database or restore a backup and perform incomplete recovery up to the most recent available redo log.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t14" headers="r1c1-t14">
<p>Current</p>
</td>
<td class="cellalignment1942" headers="r4c1-t14 r1c2-t14">
<p>It is the redo log that the database is currently writing to</p>
</td>
<td class="cellalignment1942" headers="r4c1-t14 r1c3-t14">
<p>Attempt to clear the log; if impossible, then you must either use Flashback Database or restore a backup and perform incomplete recovery up to the most recent available redo log.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" -->
<p class="subhead2"><a id="BRADV605"></a>To determine whether the damaged group is active or inactive.</p>
<ol>
<li>
<p>Locate the file name of the lost redo log in <a id="sthref2220"></a><code dir="ltr">V$LOGFILE</code> and then look for the group number corresponding to it.<a id="sthref2221"></a><a id="sthref2222"></a><a id="sthref2223"></a><a id="sthref2224"></a><a id="sthref2225"></a><a id="sthref2226"></a><a id="sthref2227"></a> For example, enter:</p>
<pre dir="ltr">
SELECT GROUP#, STATUS, MEMBER FROM V$LOGFILE;

GROUP#    STATUS       MEMBER
-------   -----------  ---------------------
0001                    /oracle/dbs/log1a.f
0001                    /oracle/dbs/log1b.f
0002      INVALID       /oracle/dbs/log2a.f
0002      INVALID       /oracle/dbs/log2b.f
0003                    /oracle/dbs/log3a.f
0003                    /oracle/dbs/log3b.f
</pre></li>
<li>
<p>Determine which groups are active.</p>
<p>For example, execute the following SQL query (sample output included):</p>
<pre dir="ltr">
SELECT GROUP#, MEMBERS, STATUS, ARCHIVED 
FROM V$LOG;

GROUP#  MEMBERS           STATUS     ARCHIVED
------  -------           ---------  -----------
 0001   2                 INACTIVE   YES
 0002   2                 ACTIVE     NO
 0003   2                 CURRENT    NO
</pre></li>
<li>
<p>Perform one of the following actions:</p>
<ul>
<li>
<p>If the affected group is inactive, then follow the procedure in <a href="#CACEDJAE">"Losing an Inactive Online Redo Log Group"</a>.</p>
</li>
<li>
<p>If the affected group is active (as in the preceding example), then follow the procedure in <a href="#i1006564">"Losing an Active Online Redo Log Group"</a>.</p>
</li>
</ul>
</li>
</ol>
<a id="CACEDJAE"></a>
<div id="BRADV90050" class="sect3">
<h4 class="sect3">Losing an Inactive Online Redo Log Group</h4>
<p><a id="sthref2228"></a><a id="sthref2229"></a><a id="sthref2230"></a>If all members of an online redo log group with <code dir="ltr">INACTIVE</code> status are damaged, then the procedure depends on whether you can fix the media problem that damaged the inactive redo log group. If the failure is temporary, then fix the problem. The log writer can reuse the redo log group when required. If the failure is permanent, then the damaged inactive online redo log group eventually halts normal database operation. Reinitialize the damaged group manually by issuing the <code dir="ltr">ALTER DATABASE CLEAR LOGFILE</code> statement as described in this section.</p>
<div id="BRADV90051" class="sect4"><a id="sthref2231"></a>
<h5 class="sect4">Clearing Inactive, Archived Redo</h5>
<p>You can clear an inactive redo log group when the database is open or closed. The procedure depends on whether the damaged group has been archived.</p>
<p class="subhead2"><a id="BRADV521"></a><a id="sthref2232"></a>To clear an inactive, online redo log group that has been archived:</p>
<ol>
<li>
<p>If the database is shut down, then start a new instance and mount the database:</p>
<pre dir="ltr">
STARTUP MOUNT
</pre></li>
<li>
<p>Reinitialize the damaged log group. For example, to clear redo log group <code dir="ltr">2</code>, issue the following statement:</p>
<pre dir="ltr">
ALTER DATABASE CLEAR LOGFILE GROUP 2;
</pre></li>
</ol>
</div>
<!-- class="sect4" -->
<div id="BRADV90052" class="sect4"><a id="sthref2233"></a>
<h5 class="sect4">Clearing Inactive, Unarchived Redo</h5>
<p>Clearing a not-yet-archived redo log allows it to be reused without archiving it. This action makes backups unusable if they were started before the last change in the log, unless the file was taken offline before the first change in the log. Hence, if you need the cleared log file for recovery of a backup, then you cannot recover that backup. Clearing a not-yet-archived-redo-log, prevents complete recovery from backups due to the missing log.</p>
<p class="subhead2"><a id="BRADV522"></a><a id="sthref2234"></a>To clear an inactive, online redo log group that has not been archived:</p>
<ol>
<li>
<p>If the database is shut down, then start a new instance and mount the database:</p>
<pre dir="ltr">
SQL&gt; STARTUP MOUNT
</pre></li>
<li>
<p>Clear the log using the <code dir="ltr">UNARCHIVED</code> keyword.</p>
<p>For example, to clear log group <code dir="ltr">2</code>, issue the following SQL statement:</p>
<pre dir="ltr">
SQL&gt; ALTER DATABASE CLEAR UNARCHIVED LOGFILE GROUP 2;
</pre>
<p>If there is an offline data file that requires the cleared log to bring it online, then the keywords <code dir="ltr">UNRECOVERABLE</code> <code dir="ltr">DATAFILE</code> are required. The data file must be dropped because the redo logs necessary to bring the data file online are being cleared, and there is no copy of it. For example, enter:</p>
<pre dir="ltr">
SQL&gt; ALTER DATABASE CLEAR UNARCHIVED LOGFILE GROUP 2 UNRECOVERABLE DATAFILE;
</pre></li>
<li>
<p>Immediately back up all data files in the database with an operating system utility, so that you have a backup you can use for complete recovery without relying on the cleared log group. For example, enter:</p>
<pre dir="ltr">
% cp /disk1/oracle/dbs/*.dbf /disk2/backup
</pre></li>
<li>
<p>Back up the database's control file with the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> statement. For example, enter:</p>
<pre dir="ltr">
SQL&gt; ALTER DATABASE BACKUP CONTROLFILE TO '/oracle/dbs/cf_backup.f';
</pre></li>
</ol>
</div>
<!-- class="sect4" -->
<div id="BRADV90053" class="sect4"><a id="sthref2235"></a>
<h5 class="sect4">Failure of CLEAR LOGFILE Operation</h5>
<p><a id="sthref2236"></a><a id="sthref2237"></a><a id="sthref2238"></a>The <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">CLEAR</code> <code dir="ltr">LOGFILE</code> statement can fail with an I/O error due to media failure when it is not possible to:</p>
<ul>
<li>
<p>Relocate the redo log file onto alternative media by re-creating it under the currently configured redo log file name</p>
</li>
<li>
<p>Reuse the currently configured log file name to re-create the redo log file because the name itself is invalid or unusable (for example, due to media failure)</p>
</li>
</ul>
<p>In these cases, the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">CLEAR</code> <code dir="ltr">LOGFILE</code> statement (before receiving the I/O error) would have successfully informed the control file that the log was being cleared and did not require archiving. The I/O error occurred at the step in which the <code dir="ltr">CLEAR</code> <code dir="ltr">LOGFILE</code> statement attempted to create the new redo log file and write zeros to it. This fact is reflected in <code dir="ltr">V$LOG.CLEARING_CURRENT</code>.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="i1006564"></a>
<div id="BRADV90054" class="sect3">
<h4 class="sect3">Losing an Active Online Redo Log Group</h4>
<p>If the database is still running and the lost active redo log is <span class="italic">not</span> the current log, then issue the <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">CHECKPOINT</code> statement. If the operation is successful, then the active redo log becomes inactive, and you can follow the procedure in <a href="#CACEDJAE">"Losing an Inactive Online Redo Log Group"</a>. If the operation is unsuccessful, or if your database has halted, then perform one of procedures in this section, depending on the archiving mode.</p>
<p>The current log is the one <code dir="ltr">LGWR</code> is currently writing to. If a <code dir="ltr">LGWR</code> I/O operation fails, then LGWR terminates and the instance fails. In this case, you must restore a backup, perform incomplete recovery, and open the database with the <code dir="ltr">RESETLOGS</code> option.</p>
<div id="BRADV90055" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref2239"></a>
<h5 class="sect4">Recovering from the Loss of Active Logs in NOARCHIVELOG Mode</h5>
<p>In this scenario, the database archiving mode is <code dir="ltr">NOARCHIVELOG</code>.</p>
<p class="subhead2"><a id="BRADV523"></a>To recover from the loss of an active online log group in NOARCHIVELOG mode:</p>
<ol>
<li>
<p><a id="sthref2240"></a><a id="sthref2241"></a>If the media failure is temporary, then correct the problem so that the database can reuse the group when required.</p>
</li>
<li>
<p>Restore the database from a consistent, whole database backup (data files and control files). For example, enter:</p>
<pre dir="ltr">
% cp /disk2/backup/*.dbf $ORACLE_HOME/oradata/trgt/
</pre></li>
<li>
<p>Mount the database:</p>
<pre dir="ltr">
STARTUP MOUNT
</pre></li>
<li>
<p>Because online redo logs are not backed up, you cannot restore them with the data files and control files. To allow the database to reset the online redo logs, you must first mimic incomplete recovery:</p>
<pre dir="ltr">
RECOVER DATABASE UNTIL CANCEL
CANCEL
</pre></li>
<li>
<p>Open the database using the <code dir="ltr">RESETLOGS</code> option:</p>
<pre dir="ltr">
ALTER DATABASE OPEN RESETLOGS;
</pre></li>
<li>
<p>Shut down the database consistently. For example, enter:</p>
<pre dir="ltr">
SHUTDOWN IMMEDIATE
</pre></li>
<li>
<p>Make a whole database backup.</p>
</li>
</ol>
<p><a id="sthref2242"></a><a id="sthref2243"></a>If the media failure is temporary, then correct the problem so that the database can reuse the group when required. If the media failure is not temporary, then use the following procedure.</p>
</div>
<!-- class="sect4" -->
<div id="BRADV90056" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref2244"></a>
<h5 class="sect4">Recovering from Loss of Active Logs in ARCHIVELOG Mode</h5>
<p>In this scenario, the database archiving mode is <code dir="ltr">ARCHIVELOG</code>.</p>
<p class="subhead2"><a id="BRADV524"></a>To recover from loss of an active online redo log group in ARCHIVELOG mode:</p>
<ol>
<li>
<p>Begin incomplete media recovery, recovering up through the log before the damaged log.</p>
</li>
<li>
<p>Ensure that the current name of the lost redo log can be used for a newly created file. If not, then rename the members of the damaged online redo log group to a new location. For example, enter:</p>
<pre dir="ltr">
ALTER DATABASE RENAME FILE "/disk1/oradata/trgt/redo01.log" TO "/tmp/redo01.log";
ALTER DATABASE RENAME FILE "/disk1/oradata/trgt/redo02.log" TO "/tmp/redo02.log";
</pre></li>
<li>
<p>Open the database using the <code dir="ltr">RESETLOGS</code> option:</p>
<pre dir="ltr">
ALTER DATABASE OPEN RESETLOGS;
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
All updates executed from the end point of the incomplete recovery to the present must be re-executed.</div>
</li>
</ol>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<div id="BRADV90057" class="sect3"><a id="sthref2245"></a>
<h4 class="sect3">Loss of Multiple Redo Log Groups</h4>
<p><a id="sthref2246"></a>If you have lost multiple groups of the online redo log, then use the recovery method for the most difficult log to recover. The order of difficulty, from most difficult to least difficult, is as follows:</p>
<ol>
<li>
<p>The current online redo log</p>
</li>
<li>
<p>An active online redo log</p>
</li>
<li>
<p>An unarchived online redo log</p>
</li>
<li>
<p>An inactive online redo log</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1008043"></a>
<div id="BRADV99985" class="sect1">
<h2 class="sect1">Recovering from a Dropped Table Without Using Flashback Features</h2>
<p><a id="sthref2247"></a><a id="sthref2248"></a>One common error is the accidental dropping of a table from your database. In general, the fastest and simplest solution is to use the Flashback Drop feature to reverse the dropping of the table. If you cannot use Flashback Table (for example, because Flashback Drop is disabled or the table was dropped with the <code dir="ltr">PURGE</code> option), then you can perform the procedure in this section.</p>
<p>In this scenario, assume that you do not have the Flashback Database functionality enabled, so the <code dir="ltr">FLASHBACK</code> <code dir="ltr">DATABASE</code> command is not an option. However, you do have physical backups of the database. If possible, keep the database that experienced the user error online and available for use.</p>
<div class="infobox-note">
<p class="notep1"><span class="bold">Note</span>:</p>
Grant powerful privileges only to appropriate users to minimize user errors that require recovery.</div>
<p class="subhead2"><a id="BRADV525"></a><a id="sthref2249"></a><a id="sthref2250"></a>To recover a table that has been accidentally dropped:</p>
<ol>
<li>
<p>Back up all data files of the existing database in case an error is made during the remaining steps of this procedure.</p>
</li>
<li>
<p>Restore a partial backup of the database to an alternative location. At minimum, restore the following:</p>
<ul>
<li>
<p><code dir="ltr">SYSTEM</code> and <code dir="ltr">SYSAUX</code> tablespaces</p>
</li>
<li>
<p>Tablespaces containing undo or rollback segments</p>
</li>
<li>
<p>Self-contained tablespaces that contain the data to be retrieved</p>
</li>
</ul>
</li>
<li>
<p>Perform incomplete recovery of this backup using a restored backup control file, to the point just before the table was dropped.</p>
</li>
<li>
<p>Export the lost data from the temporary, restored version of the database using Data Pump Export. In this case, export the accidentally dropped table.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
System audit options are exported.</div>
</li>
<li>
<p>Use the Data Pump Import utility to import the data back into the production database.</p>
</li>
<li>
<p>Delete the files of the temporary copy of the database to conserve space.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SUTIL100" href="../../server.112/e22490/dp_overview.htm#SUTIL100"><span class="italic">Oracle Database Utilities</span></a> for more information about Oracle Data Pump</div>
</div>
<!-- class="sect1" -->
<a id="CACFJHED"></a>
<div id="BRADV233" class="sect1">
<h2 class="sect1">Dropping a Database with SQL*Plus</h2>
<p>You may must remove a database, that is, the database files that form the database, from the operating system. For example, this scenario can occur when you create a test database and then no longer have a use for it. The SQL statement <code dir="ltr">DROP</code> <code dir="ltr">DATABASE</code> can perform this function.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmmaint.htm#i1009167">"Dropping a Database"</a> to learn how to use the equivalent RMAN command <code dir="ltr">DROP</code> <code dir="ltr">DATABASE</code></div>
<p class="subhead2"><a id="BRADV606"></a>To drop a database with SQL*Plus:</p>
<ol>
<li>
<p>After connecting to the database with administrator privileges, ensure that the database is either mounted or open in restricted mode with no users connected.</p>
<p>For example, enter the following command:</p>
<pre dir="ltr">
SQL&gt; STARTUP RESTRICT FORCE MOUNT
</pre></li>
<li>
<p>Remove the data files and control files from the operating system. If the database used a server parameter file (spfile), then the spfile is also deleted.</p>
<p>For example, enter the following command:</p>
<pre dir="ltr">
SQL&gt; DROP DATABASE; # deletes all database files, both ASM and non-ASM
</pre>
<p>If the database is on raw disk, then the command does not delete the actual raw disk special files.</p>
</li>
<li>
<p>Use an operating system utility to delete all backups and archived logs associated with the database.</p>
<p>For example, on Linux and Unix enter the following command:</p>
<pre dir="ltr">
% rm /backup/* /disk1/oradata/trgt/arch/*
</pre></li>
</ol>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1933">
<tr>
<td class="cellalignment1942">
<table class="cellalignment1938">
<tr>
<td class="cellalignment1937"><a href="osrecvry.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1937"><a href="glossary.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1944">
<table class="cellalignment1936">
<tr>
<td class="cellalignment1937"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1937"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1937"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1937"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1937"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1937"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
