<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Making User-Managed Database Backups</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1054" />
<meta name="description" content="A guide to backup and recovery of Oracle databases, including RMAN backup and recovery, RMAN data transfer, Oracle Flashback Technology, and user-managed backup and recovery" />
<meta name="dcterms.created" content="2015-05-13T14:1:12Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Backup and Recovery User's Guide" />
<meta name="dcterms.identifier" content="E10642-08" />
<meta name="dcterms.isVersionOf" content="BRADV" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="part_umb.htm" title="Previous" type="text/html" />
<link rel="Next" href="osrecvry.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10642.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">43/47</span> <!-- End Header -->
<div id="BRADV016" class="chapter"><a id="CEGJIHJF"></a>
<h1 class="chapter"><span class="secnum">28</span> Making User-Managed Database Backups</h1>
<p><a id="sthref1876"></a><a id="sthref1877"></a>This chapter describes methods of backing up an Oracle database in a user-managed backup and recovery strategy, that is, a strategy that does not depend on using Recovery Manager (RMAN).</p>
<p>This chapter contains the following topics:</p>
<ul>
<li>
<p><a href="#i1006140">Querying V$ Views to Obtain Backup Information</a></p>
</li>
<li>
<p><a href="#i1008982">Making User-Managed Backups of the Whole Database</a></p>
</li>
<li>
<p><a href="#CHDHJJAG">Making User-Managed Backups of Tablespaces and Data Files</a></p>
</li>
<li>
<p><a href="#i1006536">Making User-Managed Backups of the Control File</a></p>
</li>
<li>
<p><a href="#i1006637">Making User-Managed Backups of Archived Redo Logs</a></p>
</li>
<li>
<p><a href="#i1006658">Making User-Managed Backups in SUSPEND Mode</a></p>
</li>
<li>
<p><a href="#i1006742">Making User-Managed Backups to Raw Devices</a></p>
</li>
<li>
<p><a href="#CHDFFHGC">Making Backups with the Volume Shadow Copy Service (VSS)</a></p>
</li>
<li>
<p><a href="#i1006936">Verifying User-Managed Data File Backups</a></p>
</li>
</ul>
<a id="i1006140"></a>
<div id="BRADV198" class="sect1">
<h2 class="sect1">Querying V$ Views to Obtain Backup Information</h2>
<p><a id="sthref1878"></a><a id="sthref1879"></a><a id="sthref1880"></a><a id="sthref1881"></a><a id="sthref1882"></a><a id="sthref1883"></a>Before making a backup, you must identify all the files in your database and decide what to back up. You can use V$ views to obtain this information.</p>
<a id="i1006155"></a>
<div id="BRADV89998" class="sect2">
<h3 class="sect2">Listing Database Files Before a Backup</h3>
<p>Use the <code dir="ltr">V$DATAFILE</code> and <code dir="ltr">V$CONTROLFILE</code> views to identify the data files and control files for your database. This same procedure works whether you named these files manually or allowed Oracle Managed Files to name them.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
Never back up online redo log files.</div>
<p class="subhead2"><a id="BRADV485"></a>To list data files and control files:</p>
<ol>
<li>
<p>Start SQL*Plus and query <code dir="ltr">V$DATAFILE</code> to obtain a list of data files. For example, enter:</p>
<pre dir="ltr">
SELECT NAME FROM V$DATAFILE;
</pre>
<p>You can also join the <a id="sthref1884"></a><a id="sthref1885"></a><code dir="ltr">V$TABLESPACE</code> and <code dir="ltr">V$DATAFILE</code> views to obtain a listing of data files along with their associated tablespaces:</p>
<pre dir="ltr">
SELECT   t.NAME "Tablespace", f.NAME "Datafile"
FROM     V$TABLESPACE t, V$DATAFILE f
WHERE    t.TS# = f.TS#
ORDER BY t.NAME;
</pre></li>
<li>
<p><a id="sthref1886"></a>Obtain the file names of the current control files by querying the <code dir="ltr">V$CONTROLFILE</code> view. For example, issue the following query:</p>
<pre dir="ltr">
SELECT NAME FROM V$CONTROLFILE;
</pre>
<p>You must back up only one copy of a <a id="sthref1887"></a><a id="sthref1888"></a>multiplexed control file.</p>
</li>
<li>
<p><a id="sthref1889"></a><a id="sthref1890"></a><a id="sthref1891"></a>If you plan to perform control file backup with the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">BACKUP</code> <code dir="ltr">CONTROLFILE</code> <code dir="ltr">TO</code> <code dir="ltr">'</code><code dir="ltr"><span class="codeinlineitalic">filename</span></code><code dir="ltr">'</code> statement, then save a list of all data files and online redo log files with the control file backup. Because the current database structure may not match the database structure at the time a given control file backup was created, saving a list of files recorded in the backup control file can aid the recovery procedure.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="i1006182"></a>
<div id="BRADV89999" class="sect2">
<h3 class="sect2">Determining Data File Status for Online Tablespace Backups</h3>
<p><a id="sthref1892"></a><a id="sthref1893"></a><a id="sthref1894"></a>To check whether a data file is part of a current online tablespace backup, query the <a id="sthref1895"></a><code dir="ltr">V$BACKUP</code> view.</p>
<p>This view is useful only for user-managed online tablespace backups, because neither RMAN backups nor offline tablespace backups require the data files of a tablespace to be in <a href="glossary.htm#CBACFBBJ"><span class="xrefglossterm">backup mode</span></a>. Some user-managed backup procedures require you to place the tablespace in backup mode to protect against the possibility of a fractured block. However, updates to the database create more than the usual amount of redo in backup mode.</p>
<p>The <code dir="ltr">V$BACKUP</code> view is most useful when the database is open. It is also useful immediately after an instance failure because it shows the backup status of the files at the time of the failure. Use this information to determine whether you have left any tablespaces in backup mode.</p>
<p><code dir="ltr">V$BACKUP</code> is not useful if the control file currently in use is a restored backup or a new control file created after the media failure occurred. A restored or re-created control file does not contain the information that the database needs to populate <code dir="ltr">V$BACKUP</code> accurately. Also, if you have restored a backup of a file, this file's <code dir="ltr">STATUS</code> in <code dir="ltr">V$BACKUP</code> reflects the backup status of the older version of the file, not the most current version. Thus, this view can contain misleading data about restored files.</p>
<p>For example, the following query displays which data files are currently included in a tablespace that has been placed in backup mode:</p>
<pre dir="ltr">
SELECT t.name AS "TB_NAME", d.file# as "DF#", d.name AS "DF_NAME", b.status
FROM   V$DATAFILE d, V$TABLESPACE t, V$BACKUP b
WHERE  d.TS#=t.TS#
AND    b.FILE#=d.FILE#
AND    b.STATUS='ACTIVE';
</pre>
<p>The following sample output shows that the <code dir="ltr">tools</code> and <code dir="ltr">users</code> tablespaces currently have <code dir="ltr">ACTIVE</code> status:</p>
<pre dir="ltr">
TB_NAME                 DF#        DF_NAME                           STATUS
----------------------  ---------- --------------------------------  ------
TOOLS                   7          /oracle/oradata/trgt/tools01.dbf  ACTIVE
USERS                   8          /oracle/oradata/trgt/users01.dbf  ACTIVE
</pre>
<p>In the <code dir="ltr">STATUS</code> column, <code dir="ltr">NOT</code> <code dir="ltr">ACTIVE</code> indicates that the file is not currently in backup mode (that is, you have not executed the <code dir="ltr">ALTER</code> <code dir="ltr">TABLESPACE</code> <code dir="ltr">...</code> <code dir="ltr">BEGIN</code> <code dir="ltr">BACKUP</code> or <code dir="ltr">ALTER DATABASE BEGIN BACKUP</code> statement), whereas <code dir="ltr">ACTIVE</code> indicates that the file is currently in backup mode.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1008982"></a>
<div id="BRADV199" class="sect1">
<h2 class="sect1">Making User-Managed Backups of the Whole Database</h2>
<p>You can make a whole database backup of all files in a database after the database has been shut down with the <code dir="ltr">NORMAL</code>, <code dir="ltr">IMMEDIATE</code>, or <code dir="ltr">TRANSACTIONAL</code> options. <a id="sthref1896"></a><a id="sthref1897"></a><a id="sthref1898"></a><a id="sthref1899"></a>A whole database backup taken while the database is open or after an instance failure or <code dir="ltr">SHUTDOWN</code> <code dir="ltr">ABORT</code> command is inconsistent. In such cases, the files are inconsistent with the <a href="glossary.htm#i432521"><span class="xrefglossterm">database checkpoint</span></a> SCN.</p>
<p>You<a id="sthref1900"></a><a id="sthref1901"></a> can make a whole database backup if a database is operating in either <code dir="ltr">ARCHIVELOG</code> or <code dir="ltr">NOARCHIVELOG</code> mode. If you run the database in <code dir="ltr">NOARCHIVELOG</code> mode, however, then the backup must be consistent; that is, you must shut down the database cleanly before the backup.</p>
<p><a id="sthref1902"></a><a id="sthref1903"></a>The set of backup files that results from a consistent whole database backup is consistent because all files are checkpointed to the same SCN. You can restore the consistent database backup without further recovery. After restoring the backup files, you can perform additional recovery steps to recover the database to a more current time if the database is operated in <code dir="ltr">ARCHIVELOG</code> mode. Also, you can take inconsistent whole database backups if your database is in <code dir="ltr">ARCHIVELOG</code> mode.</p>
<p>Control files play a crucial role in database restore and recovery. For databases running in <code dir="ltr">ARCHIVELOG</code> mode, Oracle recommends that you back up control files with the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">BACKUP</code> <code dir="ltr">CONTROLFILE</code> <code dir="ltr">TO</code> <code dir="ltr">'</code><code dir="ltr"><span class="codeinlineitalic">filename</span></code><code dir="ltr">'</code> statement.</p>
<div class="infoboxnotealso">
<p class="notep1"><span class="bold">See Also</span>:</p>
<a href="#i1006536">"Making User-Managed Backups of the Control File"</a> for more information about backing up control files</div>
<p class="subhead2"><a id="BRADV618"></a>Making Consistent Whole Database Backups</p>
<p><a id="sthref1904"></a><a id="sthref1905"></a><a id="sthref1906"></a><a id="sthref1907"></a>This section describes how to back up the database with an operating system utility.</p>
<p class="subhead2"><a id="BRADV486"></a>To make a consistent whole database backup:</p>
<a id="i1006229"></a>
<ol>
<li>
<p>If the database is open, then use SQL*Plus to shut down the database with the <code dir="ltr">NORMAL</code>, <code dir="ltr">IMMEDIATE</code>, or <code dir="ltr">TRANSACTIONAL</code> options.</p>
</li>
<li>
<p>Use an operating system utility to make backups of all data files and all control files specified by the <code dir="ltr">CONTROL_FILES</code> parameter of the initialization parameter file. Also, back up the initialization parameter file and other Oracle product initialization files. To find these files, do a search for <code dir="ltr">*.ora</code> starting in your Oracle home directory and recursively search all of its subdirectories.</p>
<p>For example, you can back up the data files, control files, and archived logs to <code dir="ltr">/disk2/backup</code> as follows:</p>
<pre dir="ltr">
% cp $ORACLE_HOME/oradata/trgt/*.dbf /disk2/backup
% cp $ORACLE_HOME/oradata/trgt/arch/* /disk2/backup/arch
 
</pre></li>
<li>
<p>Restart the database with the <code dir="ltr">STARTUP</code> command in SQL*Plus.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMIN004" href="../../server.112/e25494/start.htm#ADMIN004"><span class="italic">Oracle Database Administrator's Guide</span></a> for more information about starting up and shutting down a database</div>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CHDHJJAG"></a>
<div id="BRADV90001" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Making User-Managed Backups of Tablespaces and Data Files</h2>
<p>The technique for making user-managed backups of tablespaces and data files depends on whether the files are offline or online.</p>
<a id="CEGDFFCF"></a>
<div id="BRADV20033" class="sect2">
<h3 class="sect2">Making User-Managed Backups of Offline Tablespaces and Data Files</h3>
<p><a id="sthref1908"></a><a id="sthref1909"></a><a id="sthref1910"></a><a id="sthref1911"></a><a id="sthref1912"></a><a id="sthref1913"></a><a id="sthref1914"></a>Note the following guidelines when backing up offline tablespaces:</p>
<ul>
<li>
<p>You cannot take offline the <code dir="ltr">SYSTEM</code> tablespace or a tablespace with active undo segments. The following technique cannot be used for such tablespaces.</p>
</li>
<li>
<p>Assume that a table is in tablespace <code dir="ltr">Primary</code> and its index is in tablespace <code dir="ltr">Index</code>. Taking tablespace <code dir="ltr">Index</code> offline while leaving tablespace <code dir="ltr">Primary</code> online can cause errors when data manipulation language (DML) is issued against the indexed tables located in <code dir="ltr">Primary</code>. The problem appears only when the access method chosen by the optimizer must access the indexes in the <code dir="ltr">Index</code> tablespace.</p>
</li>
</ul>
<p class="subhead2"><a id="BRADV487"></a>To back up offline tablespaces:</p>
<ol>
<li>
<p><a id="sthref1915"></a><a id="sthref1916"></a>Before beginning a backup of a tablespace, identify the tablespace's data files by querying the <code dir="ltr">DBA_DATA_FILES</code> view. For example, assume that you want to back up the <code dir="ltr">users</code> tablespace. Enter the following statement in SQL*Plus:</p>
<pre dir="ltr">
SELECT TABLESPACE_NAME, FILE_NAME
  FROM SYS.DBA_DATA_FILES
  WHERE TABLESPACE_NAME = 'USERS';
 
TABLESPACE_NAME                   FILE_NAME
-------------------------------   --------------------------------
USERS                             /oracle/oradata/trgt/users01.dbf
</pre>
<p>In this example, <code dir="ltr">/oracle/oradata/trgt/users01.dbf</code> is a fully specified file name corresponding to the data file in the <code dir="ltr">users</code> tablespace.</p>
</li>
<li>
<p>Take the tablespace offline using normal priority if possible, because it guarantees that you can subsequently bring the tablespace online without having to recover it. For example:</p>
<pre dir="ltr">
SQL&gt; ALTER TABLESPACE users OFFLINE NORMAL;
</pre></li>
<li>
<p>Back up the offline data files. For example:</p>
<pre dir="ltr">
% cp /oracle/oradata/trgt/users01.dbf /d2/users01_'date "+%m_%d_%y"'.dbf
</pre></li>
<li>
<p>Bring the tablespace online. For example:</p>
<pre dir="ltr">
ALTER TABLESPACE users ONLINE;
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you took the tablespace offline using temporary or immediate priority, then you cannot bring the tablespace online unless you perform tablespace recovery.</div>
</li>
<li>
<p>Archive the unarchived redo logs so that the redo required to recover the tablespace backup is archived. For example, enter:</p>
<pre dir="ltr">
ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="i1006287"></a>
<div id="BRADV201" class="sect2">
<h3 class="sect2">Making User-Managed Backups of Online Tablespaces and Data Files</h3>
<p><a id="i1006289"></a>You can back up all or only specific data files of an online tablespace while the database is open. The procedure differs depending on whether the online tablespace is read/write or read-only.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You should not back up temporary tablespaces.</div>
<a id="i1006313"></a>
<div id="BRADV90002" class="sect3">
<h4 class="sect3">Making User-Managed Backups of Online Read/Write Tablespaces</h4>
<p>You must put a read/write tablespace in backup mode to make user-managed data file backups when the tablespace is online and the database is open. <a id="sthref1917"></a><a id="sthref1918"></a>The <code dir="ltr">ALTER</code> <code dir="ltr">TABLESPACE</code> <code dir="ltr">...</code> <code dir="ltr">BEGIN</code> <code dir="ltr">BACKUP</code> statement places a tablespace in backup mode. In backup mode, the database copies whole changed data blocks into the redo stream. After you take the tablespace out of backup mode with the <code dir="ltr">ALTER</code> <code dir="ltr">TABLESPACE</code> <code dir="ltr">...</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> or <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> statement, the database advances the <a href="glossary.htm#CHDGHFDF"><span class="xrefglossterm">data file checkpoint</span></a> SCN to the current <a href="glossary.htm#i432521"><span class="xrefglossterm">database checkpoint</span></a> SCN.</p>
<p>When restoring a data file backed up in this way, the database asks for the appropriate set of redo log files to apply if recovery is needed. The redo logs contain all changes required to recover the data files and make them consistent.</p>
<p class="subhead2"><a id="BRADV488"></a>To back up online read/write tablespaces in an open database:</p>
<ol>
<li>
<p><a id="sthref1919"></a><a id="sthref1920"></a><a id="sthref1921"></a>Before beginning a backup of a tablespace, use the <code dir="ltr">DBA_DATA_FILES</code> data dictionary view to identify all of the data files in the tablespace. For example, assume that you want to back up the <code dir="ltr">users</code> tablespace. Enter the following:</p>
<pre dir="ltr">
SELECT TABLESPACE_NAME, FILE_NAME
FROM   SYS.DBA_DATA_FILES
WHERE  TABLESPACE_NAME = 'USERS';
 
TABLESPACE_NAME                   FILE_NAME
-------------------------------   --------------------
USERS                             /oracle/oradata/trgt/users01.dbf
USERS                             /oracle/oradata/trgt/users02.dbf
</pre></li>
<li>
<p>Mark the beginning of the online tablespace backup. For example, the following statement marks the start of an online backup for the tablespace <code dir="ltr">users</code>:</p>
<pre dir="ltr">
SQL&gt; ALTER TABLESPACE users BEGIN BACKUP;
</pre>
<div class="infoboxnotewarn">
<p class="notep1">Caution:</p>
<a id="sthref1922"></a><a id="sthref1923"></a>If you do not use <code dir="ltr">BEGIN</code> <code dir="ltr">BACKUP</code> to mark the beginning of an online tablespace backup and wait for this statement to complete before starting your copies of online tablespaces, then the data file copies produced are not usable for subsequent recovery operations. Attempting to recover such a backup is risky and can return errors that result in inconsistent data. For example, the attempted recovery operation can issue a <a href="glossary.htm#CHDHHHFE"><span class="xrefglossterm">fuzzy file</span></a> warning, and can lead to an inconsistent database that you cannot open.</div>
</li>
<li>
<p>Back up the online data files of the online tablespace with operating system commands. For example, Linux and UNIX users might enter:</p>
<pre dir="ltr">
% cp /oracle/oradata/trgt/users01.dbf /d2/users01_'date "+%m_%d_%y"'.dbf
% cp /oracle/oradata/trgt/users02.dbf /d2/users02_'date "+%m_%d_%y"'.dbf
</pre></li>
<li>
<p>After backing up the data files of the online tablespace, run the SQL statement <code dir="ltr">ALTER</code> <code dir="ltr">TABLESPACE</code> with the <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> option. For example, the following statement ends the online backup of the tablespace <code dir="ltr">users</code>:</p>
<pre dir="ltr">
SQL&gt; ALTER TABLESPACE users END BACKUP;
</pre></li>
<li>
<p>Archive the unarchived redo logs so that the redo required to recover the tablespace backup is archived. For example, enter:</p>
<pre dir="ltr">
SQL&gt; ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre>
<div class="infoboxnotewarn">
<p class="notep1">Caution:</p>
<a id="sthref1924"></a>If you fail to take the tablespace out of backup mode, then Oracle Database continues to write copies of data blocks in this tablespace to the online redo logs, causing performance problems. Also, you receive an <code dir="ltr">ORA-01149</code> error if you try to shut down the database with the tablespaces still in backup mode.</div>
</li>
</ol>
</div>
<!-- class="sect3" -->
<div id="BRADV90003" class="sect3"><a id="sthref1925"></a>
<h4 class="sect3">Making Multiple User-Managed Backups of Online Read/Write Tablespaces<a id="sthref1926"></a><a id="sthref1927"></a><a id="sthref1928"></a><a id="sthref1929"></a></h4>
<p>When backing up several online tablespaces, you can back them up either serially or in parallel. Use either of the following procedures depending on your needs.</p>
<div id="BRADV90004" class="sect4"><a id="sthref1930"></a>
<h5 class="sect4">Backing Up Online Tablespaces in Parallel</h5>
<p>You can simultaneously create data file copies of multiple tablespaces requiring backups in backup mode. Note, however, that by putting all tablespaces in online mode at once, you can generate large amounts of redo logs if there is heavy update activity on the affected tablespaces. This is because the redo must contain a copy of each changed data block in each changed data file. Be sure to consider the size of the likely redo before using the procedure outlined here.</p>
<p class="subhead2"><a id="BRADV489"></a>To back up online tablespaces in parallel:</p>
<ol>
<li>
<p>Prepare the online tablespaces for backup by issuing all necessary <code dir="ltr">ALTER</code> <code dir="ltr">TABLESPACE</code> statements at once. For example, put tablespaces <code dir="ltr">users</code>, <code dir="ltr">tools</code>, and <code dir="ltr">indx</code> in backup mode as follows:</p>
<pre dir="ltr">
SQL&gt; ALTER TABLESPACE users BEGIN BACKUP;
SQL&gt; ALTER TABLESPACE tools BEGIN BACKUP;
SQL&gt; ALTER TABLESPACE indx BEGIN BACKUP;
</pre>
<p>If you are backing up all tablespaces, you might want to use this command:</p>
<pre dir="ltr">
SQL&gt; ALTER DATABASE BEGIN BACKUP;
</pre></li>
<li>
<p>Back up all files of the online tablespaces. For example, a Linux or UNIX user might back up data files with the <code dir="ltr">*.dbf</code> suffix as follows:</p>
<pre dir="ltr">
% cp $ORACLE_HOME/oradata/trgt/*.dbf /disk2/backup/
</pre></li>
<li>
<p>Take the tablespaces out of backup mode as in the following example:</p>
<pre dir="ltr">
SQL&gt; ALTER TABLESPACE users END BACKUP;
SQL&gt; ALTER TABLESPACE tools END BACKUP;
SQL&gt; ALTER TABLESPACE indx END BACKUP;
</pre>
<p>Again, if you are handling all data files at once you can use the <code dir="ltr">ALTER DATABASE</code> command instead of <code dir="ltr">ALTER TABLESPACE</code>:</p>
<pre dir="ltr">
SQL&gt; ALTER DATABASE END BACKUP;
</pre></li>
<li>
<p>Archive the online redo logs so that the redo required to recover the tablespace backups is available for later media recovery. For example, enter:</p>
<pre dir="ltr">
SQL&gt; ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre></li>
</ol>
</div>
<!-- class="sect4" -->
<div id="BRADV90005" class="sect4"><a id="sthref1931"></a>
<h5 class="sect4">Backing Up Online Tablespaces Serially</h5>
<p>You can place all tablespaces requiring online backups in backup mode one at a time. <a id="sthref1932"></a><a id="sthref1933"></a>Oracle recommends the serial backup option because it minimizes the time between <code dir="ltr">ALTER</code> <code dir="ltr">TABLESPACE</code> <code dir="ltr">...</code> <code dir="ltr">BEGIN/END</code> <code dir="ltr">BACKUP</code> statements. During online backups, more redo information is generated for the tablespace because whole data blocks are copied into the redo log.</p>
<p class="subhead2"><a id="BRADV490"></a>To back up online tablespaces serially:</p>
<ol>
<li>
<p>Prepare a tablespace for online backup. For example, to put tablespace <code dir="ltr">users</code> in backup mode enter the following:</p>
<pre dir="ltr">
SQL&gt; ALTER TABLESPACE users BEGIN BACKUP;
</pre>
<p>In this case you probably do not want to use <code dir="ltr">ALTER DATABASE BEGIN BACKUP</code> to put all tablespaces in backup mode simultaneously, because of the additional volume of redo log information generated for tablespaces in online mode.</p>
<pre dir="ltr">
</pre></li>
<li>
<p>Back up the data files in the tablespace. For example, enter:</p>
<pre dir="ltr">
% cp /oracle/oradata/trgt/users01.dbf /d2/users01_'date "+%m_%d_%y"'.dbf
</pre></li>
<li>
<p>Take the tablespace out of backup mode. For example, enter:</p>
<pre dir="ltr">
SQL&gt; ALTER TABLESPACE users END BACKUP;
</pre></li>
<li>
<p>Repeat this procedure for each remaining tablespace.</p>
</li>
<li>
<p>Archive the unarchived redo logs so that the redo required to recover the tablespace backups is archived. For example, enter:</p>
<pre dir="ltr">
SQL&gt; ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre></li>
</ol>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="i1006393"></a>
<div id="BRADV90006" class="sect3">
<h4 class="sect3">Ending a Backup After an Instance Failure or SHUTDOWN ABORT</h4>
<p><a id="sthref1934"></a><a id="sthref1935"></a><a id="sthref1936"></a><a id="sthref1937"></a>The following situations can cause a tablespace backup to fail and be incomplete:</p>
<ul>
<li>
<p>The backup completed, but you did not run the <code dir="ltr">ALTER</code> <code dir="ltr">TABLESPACE</code> <code dir="ltr">...</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> statement.</p>
</li>
<li>
<p>An instance failure or <code dir="ltr">SHUTDOWN</code> <code dir="ltr">ABORT</code> interrupted the backup.</p>
</li>
</ul>
<p>Whenever recovery from a failure is required, if a data file is in backup mode when an attempt is made to open it, then the database does not open the data file until either a recovery command is issued, or the data file is taken out of backup mode.</p>
<p>For example, the database may display a message such as the following at startup:</p>
<pre dir="ltr">
ORA-01113: file 12 needs media recovery
ORA-01110: data file 12: '/oracle/dbs/tbs_41.f'
</pre>
<p>If the database indicates that the data files for multiple tablespaces require media recovery because you forgot to end the online backups for these tablespaces, then so long as the database is mounted, running the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> statement takes all the data files out of backup mode simultaneously.</p>
<p>In high availability situations, and in situations when no database administrator (DBA) is monitoring the database, the requirement for user intervention is intolerable. Hence, you can write a failure recovery script that does the following:</p>
<ol>
<li>
<p>Mounts the database</p>
</li>
<li>
<p>Runs the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> statement</p>
</li>
<li>
<p>Runs <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">OPEN</code>, allowing the system to come up automatically</p>
</li>
</ol>
<p>An automated crash recovery script containing <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> is especially useful in the following situations:</p>
<ul>
<li>
<p>All nodes in an Oracle Real Application Clusters (Oracle RAC) configuration fail.</p>
</li>
<li>
<p>One node fails in a <a id="sthref1938"></a><span class="glossaryterm">cold failover cluster</span> (that is, a cluster that is <span class="italic">not</span> an Oracle RAC configuration in which the secondary node must mount and recover the database when the first node fails).</p>
</li>
</ul>
<p>Alternatively, you can take the following manual measures after the system fails with tablespaces in backup mode:</p>
<ul>
<li>
<p>Recover the database and avoid issuing <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> statements altogether.</p>
</li>
<li>
<p>Mount the database, then run the <code dir="ltr">ALTER</code> <code dir="ltr">TABLESPACE</code> <code dir="ltr">...</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> statement for each tablespace still in backup mode.</p>
</li>
</ul>
<a id="i1006431"></a>
<div id="BRADV90007" class="sect4">
<h5 class="sect4">Ending Backup Mode with the ALTER DATABASE END BACKUP Statement</h5>
<p><a id="sthref1939"></a><a id="sthref1940"></a><a id="sthref1941"></a><a id="sthref1942"></a>You can run the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> statement when you have multiple tablespaces still in backup mode. The primary purpose of this command is to allow a crash recovery script to restart a failed system without DBA intervention. You can also perform the following procedure manually.</p>
<p class="subhead2"><a id="BRADV491"></a>To take tablespaces out of backup mode simultaneously:</p>
<ol>
<li>
<p>Mount but do not open the database. For example, enter:</p>
<pre dir="ltr">
SQL&gt; STARTUP MOUNT
</pre></li>
<li>
<p>If you are performing this procedure manually (that is, not as part of a failure recovery script), query the <code dir="ltr">V$BACKUP</code> view to list the data files of the tablespaces that were being backed up before the database was restarted:</p>
<pre dir="ltr">
SQL&gt;  SELECT * FROM V$BACKUP WHERE STATUS = 'ACTIVE';
FILE#      STATUS             CHANGE#    TIME     
---------- ------------------ ---------- ---------
        12 ACTIVE                  20863 25-NOV-02
        13 ACTIVE                  20863 25-NOV-02
        20 ACTIVE                  20863 25-NOV-02
 3 rows selected.
</pre></li>
<li>
<p>Issue the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> statement to take all data files currently in backup mode out of backup mode. For example, enter:</p>
<pre dir="ltr">
SQL&gt; ALTER DATABASE END BACKUP;
</pre>
<p>You can use this statement only when the database is mounted but not open. If the database is open, then use <code dir="ltr">ALTER</code> <code dir="ltr">TABLESPACE</code> <code dir="ltr">...</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> or <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">DATAFILE</code> <code dir="ltr">...</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> for each affected tablespace or data file.</p>
<div class="infoboxnotewarn">
<p class="notep1">Caution:</p>
Do not use <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> if you have restored any of the affected files from a backup.</div>
</li>
</ol>
</div>
<!-- class="sect4" -->
<a id="i1006457"></a>
<div id="BRADV90008" class="sect4">
<h5 class="sect4">Ending Backup Mode with the SQL*Plus RECOVER Command</h5>
<p>The <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> statement is not the only way to respond to a failed online backup; you can also run the SQL*Plus <code dir="ltr">RECOVER</code> command. This method is useful when you are not sure whether someone has restored a backup, because if someone has indeed restored a backup, then the <code dir="ltr">RECOVER</code> command brings the backup up-to-date. Only run the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> or <code dir="ltr">ALTER</code> <code dir="ltr">TABLESPACE</code> <code dir="ltr">...</code> <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> statement if you are sure that the files are current.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code dir="ltr">RECOVER</code> command method is slow because the database must scan redo generated from the beginning of the online backup.</div>
<p class="subhead2"><a id="BRADV492"></a>To take tablespaces out of backup mode with the RECOVER command:</p>
<ol>
<li>
<p>Mount the database. For example, enter:</p>
<pre dir="ltr">
SQL&gt; STARTUP MOUNT
</pre></li>
<li>
<p>Recover the database as usual. For example, enter:</p>
<pre dir="ltr">
SQL&gt; RECOVER DATABASE
</pre></li>
<li>
<p>Use the <code dir="ltr">V$BACKUP</code> view to confirm that there are no active data files:</p>
<pre dir="ltr">
SQL&gt;  SELECT * FROM V$BACKUP WHERE STATUS = 'ACTIVE';
FILE#      STATUS             CHANGE#    TIME     
---------- ------------------ ---------- ---------
0 rows selected.
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="osrecvry.htm#BABBBBBB">Chapter 29, "Performing User-Managed Database Flashback and Recovery"</a> for information about recovering a database</div>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="i1006485"></a>
<div id="BRADV90009" class="sect3">
<h4 class="sect3">Making User-Managed Backups of Read-Only Tablespaces</h4>
<p><a id="sthref1943"></a><a id="sthref1944"></a><a id="sthref1945"></a>When backing up an online read-only tablespace, you can simply back up the online data files. You do not have to place the tablespace in backup mode because the database is not permitting changes to the data files.</p>
<p>If the set of read-only tablespaces is self-contained, then in addition to backing up the tablespaces with operating system commands, you can also export the tablespace metadata with the transportable tablespace functionality. If a media error or a user error occurs (such as accidentally dropping a table in the read-only tablespace), you can transport the tablespace back into the database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMIN11394" href="../../server.112/e25494/tspaces.htm#ADMIN11394"><span class="italic">Oracle Database Administrator's Guide</span></a> to learn how to transport tablespaces</div>
<p class="subhead2"><a id="BRADV493"></a>To back up online read-only tablespaces in an open database:</p>
<ol>
<li>
<p><a id="sthref1946"></a><a id="sthref1947"></a><a id="sthref1948"></a>Query the <code dir="ltr">DBA_TABLESPACES</code> view to determine which tablespaces are read-only. For example, run this query:</p>
<pre dir="ltr">
SELECT TABLESPACE_NAME, STATUS 
FROM DBA_TABLESPACES
WHERE STATUS = 'READ ONLY';
</pre></li>
<li>
<p>Before beginning a backup of a read-only tablespace, identify all of the tablespace's data files by querying the <code dir="ltr">DBA_DATA_FILES</code> data dictionary view. For example, assume that you want to back up the <code dir="ltr">history</code> tablespace:</p>
<pre dir="ltr">
SELECT TABLESPACE_NAME, FILE_NAME
FROM SYS.DBA_DATA_FILES
WHERE TABLESPACE_NAME = 'HISTORY';
 
TABLESPACE_NAME                   FILE_NAME
-------------------------------   --------------------
HISTORY                           /oracle/oradata/trgt/history01.dbf
HISTORY                           /oracle/oradata/trgt/history02.dbf
</pre></li>
<li>
<p>Back up the online data files of the read-only tablespace with operating system commands. You do not have to take the tablespace offline or put the tablespace in backup mode because users are automatically prevented from making changes to the read-only tablespace. For example:</p>
<pre dir="ltr">
% cp $ORACLE_HOME/oradata/trgt/history*.dbf  /disk2/backup/
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
When restoring a backup of a read-only tablespace, take the tablespace offline, restore the data files, then bring the tablespace online. A backup of a read-only tablespace is still usable if the read-only tablespace is made read/write after the backup, but the restored backup requires recovery.</div>
</li>
<li>
<p>Optionally, export the metadata in the read-only tablespace. By using the transportable tablespace feature, you can quickly restore the data files and import the metadata in case of media failure or user error. For example, export the metadata for tablespace <code dir="ltr">history</code> as follows:</p>
<pre dir="ltr">
% expdp DIRECTORY=dpump_dir1 DUMPFILE=hs.dmp TRANSPORT_TABLESPACES=history 
  LOGFILE=tts.log
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN002" href="../../server.112/e40402/statviews_part.htm#REFRN002"><span class="italic">Oracle Database Reference</span></a> for more information about the <code dir="ltr">DBA_DATA_FILES</code> and <code dir="ltr">DBA_TABLESPACES</code> views</div>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006536"></a>
<div id="BRADV202" class="sect1">
<h2 class="sect1">Making User-Managed Backups of the Control File</h2>
<p>B<a id="sthref1949"></a><a id="sthref1950"></a><a id="sthref1951"></a><a id="sthref1952"></a><a id="sthref1953"></a>ack up the control file of a database after making a structural modification to a database operating in <code dir="ltr">ARCHIVELOG</code> mode. To back up a database's control file, you must have the <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> system privilege.</p>
<div id="BRADV90010" class="sect2"><a id="sthref1954"></a>
<h3 class="sect2">Backing Up the Control File to a Binary File</h3>
<p><a id="sthref1955"></a><a id="sthref1956"></a>The primary method for backing up the control file is to use a SQL statement to generate a binary file. A binary backup is preferable to a trace file backup because it contains additional information such as the archived log history, offline range for read-only and offline tablespaces, and backup sets and copies (if you use RMAN). If <code dir="ltr">COMPATIBLE</code> is 10.2 or higher, binary control file backups include temp file entries.</p>
<p class="subhead2"><a id="BRADV494"></a>To back up the control file after a structural change:</p>
<ol>
<li>
<p>Make the desired change to the database. For example, you may create a tablespace:</p>
<pre dir="ltr">
CREATE TABLESPACE tbs_1 DATAFILE 'file_1.f' SIZE 10M;
</pre></li>
<li>
<p>Back up the database's control file, specifying a file name for the output binary file. The following example backs up a control file to <code dir="ltr">/disk1/backup/cf.bak</code>:</p>
<pre dir="ltr">
ALTER DATABASE BACKUP CONTROLFILE TO '/disk1/backup/cf.bak' REUSE;
</pre>
<p>Specify <code dir="ltr">REUSE</code> to make the new control file overwrite one that currently exists.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="g1020041"></a>
<div id="BRADV90011" class="sect2">
<h3 class="sect2">Backing Up the Control File to a Trace File</h3>
<p>You can back up the control file to a text file that contains a <code dir="ltr">CREATE CONTROLFILE</code> statement. You can edit the trace file to create a script that creates a new control file based on the control file that was current when you created the trace file.</p>
<p>If you specify neither the <code dir="ltr">RESETLOGS</code> nor <code dir="ltr">NORESETLOGS</code> option in the SQL statement, then the resulting trace file contains versions of the control file for both <code dir="ltr">RESETLOGS</code> and <code dir="ltr">NORESETLOGS</code> options. Temp file entries are included in the output using <code dir="ltr">ALTER TABLESPACE ... ADD TEMPFILE</code> statements.</p>
<p>To avoid recovering offline normal or read-only tablespaces, edit them out of the <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> statement. When you open the database with the re-created control file, the database marks these omitted files as <code dir="ltr">MISSING</code>. You can run an <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">RENAME</code> <code dir="ltr">FILE</code> statement to rename them to their original file names.</p>
<p>The trace file containing the <code dir="ltr">CREATE CONTROLFILE</code> statement is stored in a subdirectory determined by the <code dir="ltr">DIAGNOSTIC_DEST</code> initialization parameter. You can look in the database alert log for the name and location of the trace file to which the <code dir="ltr">CREATE CONTROLFILE</code> statement was written. See <a class="olink ADMIN11267" href="../../server.112/e25494/diag.htm#ADMIN11267"><span class="italic">Oracle Database Administrator's Guide</span></a> to learn how to locate the alert log.</p>
<p class="subhead2"><a id="BRADV495"></a>To back up the control file to a trace file:</p>
<ol>
<li>
<p>Mount or open the database.</p>
</li>
<li>
<p>Execute the following SQL statement:</p>
<pre dir="ltr">
ALTER DATABASE BACKUP CONTROLFILE TO TRACE;
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="osadvsce.htm#i1006277">"Recovery of Read-Only Files with a Re-Created Control File"</a> for special issues relating to read-only, offline normal, and temporary files included in <code dir="ltr">CREATE</code> <code dir="ltr">CONTROLFILE</code> statements</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006637"></a>
<div id="BRADV20333" class="sect1">
<h2 class="sect1">Making User-Managed Backups of Archived Redo Logs</h2>
<p>To save disk space in your primary archiving location, you may want to back up archived logs to tape or to an alternative disk location. If you archive to multiple locations, then only back up one copy of each log sequence number.</p>
<p class="subhead2"><a id="BRADV496"></a>To back up archived redo logs:</p>
<ol>
<li>
<p><a id="sthref1957"></a>To determine which archived redo log files the database has generated, query <code dir="ltr">V$ARCHIVED_LOG</code>. For example, run the following query:</p>
<pre dir="ltr">
SELECT THREAD#,SEQUENCE#,NAME 
FROM V$ARCHIVED_LOG;
</pre></li>
<li>
<p>Back up one copy of each log sequence number by using an operating system utility. This example backs up all logs in the primary archiving location to a disk devoted to log backups:</p>
<pre dir="ltr">
% cp $ORACLE_HOME/oracle/trgt/arch/* /disk2/backup/arch
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN002" href="../../server.112/e40402/statviews_part.htm#REFRN002"><span class="italic">Oracle Database Reference</span></a> for more information about the data dictionary views</div>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="i1006658"></a>
<div id="BRADV204" class="sect1">
<h2 class="sect1">Making User-Managed Backups in SUSPEND Mode</h2>
<p>This section contains the following topics:</p>
<ul>
<li>
<p><a href="#i1006669">About the Suspend/Resume Feature</a></p>
</li>
<li>
<p><a href="#CEGJECEG">Making Backups in a Suspended Database</a></p>
</li>
</ul>
<a id="i1006669"></a>
<div id="BRADV90012" class="sect2">
<h3 class="sect2">About the Suspend/Resume Feature</h3>
<p><a id="sthref1958"></a><a id="sthref1959"></a><a id="sthref1960"></a><a id="sthref1961"></a><a id="sthref1962"></a><a id="sthref1963"></a>Some third-party tools allow you to mirror a set of disks or logical devices, that is, maintain an exact duplicate of the primary data in another location, and then <span class="italic">split the mirror</span>. Splitting the mirror involves separating the copies so that you can use them independently.</p>
<p>With the <code dir="ltr">SUSPEND</code>/<code dir="ltr">RESUME</code> functionality, you can suspend I/O to the database, then split the mirror and make a backup of the split mirror. By using this feature, which complements the backup mode functionality, you can suspend database I/Os so that no new I/O can be performed. You can then access the suspended database to make backups without I/O interference.</p>
<p>You do not need to use <code dir="ltr">SUSPEND</code>/<code dir="ltr">RESUME</code> to make split mirror backups, unless your system requires the database cache to be free of <span class="italic">dirty buffers</span> before a volume can be split. Some RAID devices benefit from suspending writes while the split operation is occurring; your RAID vendor can advise you on whether your system would benefit from this feature.</p>
<p>The <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">SUSPEND</code> statement suspends the database by halting I/Os to data file headers, data files, and control files. When the database is suspended, all preexisting I/O operations can complete; however, any new database I/O access attempts are queued.</p>
<p>The <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">SUSPEND</code> and <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">RESUME</code> statements operate on the database and not just the instance. If the <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">SUSPEND</code> statement is entered on one system in an Oracle RAC configuration, then the internal locking mechanisms propagate the halt request across instances, thereby suspending I/O operations for all active instances in a given cluster.</p>
</div>
<!-- class="sect2" -->
<a id="CEGJECEG"></a>
<div id="BRADV90013" class="sect2">
<h3 class="sect2">Making Backups in a Suspended Database</h3>
<p>After a successful database suspension, you can back up the database to disk or break the mirrors. Because suspending a database does not guarantee immediate termination of I/O, Oracle recommends that you precede the <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">SUSPEND</code> statement with a <code dir="ltr">BEGIN</code> <code dir="ltr">BACKUP</code> statement so that the tablespaces are placed in backup mode.</p>
<p>You must use conventional user-managed backup methods to back up split mirrors. RMAN cannot make database backups or copies because these operations require reading the data file headers. After the database backup is finished or the mirrors are resilvered, then you can resume normal database operations using the <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">RESUME</code> statement.</p>
<p>Backing up a suspended database without splitting mirrors can cause an extended database outage because the database is inaccessible during this time. If backups are taken by splitting mirrors, however, then the outage is nominal. The outage time depends on the size of cache to flush, the number of data files, and the time required to break the mirror.</p>
<p>Note the following restrictions for the <code dir="ltr">SUSPEND/RESUME</code> feature:</p>
<ul>
<li>
<p>In an Oracle RAC configuration, you should not start a new instance while the original nodes are suspended.</p>
</li>
<li>
<p>No checkpoint is initiated by the <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">SUSPEND</code> or <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">RESUME</code> statements.</p>
</li>
<li>
<p>You cannot issue <code dir="ltr">SHUTDOWN</code> with <code dir="ltr">IMMEDIATE</code>, <code dir="ltr">NORMAL</code>, or <code dir="ltr">TRANSACTIONAL</code> options while the database is suspended.</p>
</li>
<li>
<p>Issuing <code dir="ltr">SHUTDOWN</code> <code dir="ltr">ABORT</code> on a database that is suspended reactivates the database. This prevents media recovery or failure recovery from getting into a unresponsive state.</p>
</li>
</ul>
<p class="subhead2"><a id="BRADV497"></a>To make a split mirror backup in SUSPEND mode:</p>
<ol>
<li>
<p>Place the database tablespaces in backup mode. For example, to place tablespace <code dir="ltr">users</code> in backup mode, enter:</p>
<pre dir="ltr">
ALTER TABLESPACE users BEGIN BACKUP;
</pre>
<p>If you are backing up all of the tablespaces for your database, you can instead use:</p>
<pre dir="ltr">
ALTER DATABASE BEGIN BACKUP;
</pre>
<div class="infoboxnotewarn">
<p class="notep1">Caution:</p>
Do not use the <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">SUSPEND</code> statement as a substitute for placing a tablespace in backup mode.</div>
</li>
<li>
<p><a id="sthref1964"></a><a id="sthref1965"></a>If your mirror system has problems with splitting a mirror while disk writes are occurring, then suspend the database. For example, issue the following statement:</p>
<pre dir="ltr">
ALTER SYSTEM SUSPEND;
</pre></li>
<li>
<p><a id="sthref1966"></a><a id="sthref1967"></a>Verify that the database is suspended by querying the <code dir="ltr">V$INSTANCE</code> view. For example:</p>
<pre dir="ltr">
SELECT DATABASE_STATUS FROM V$INSTANCE;

DATABASE_STATUS 
----------------- 
SUSPENDED 
</pre></li>
<li>
<p>Split the mirrors at the operating system or hardware level.</p>
</li>
<li>
<p><a id="sthref1968"></a><a id="sthref1969"></a>End the database suspension. For example, issue the following statement:</p>
<pre dir="ltr">
ALTER SYSTEM RESUME;
</pre></li>
<li>
<p>Establish that the database is active by querying the <code dir="ltr">V$INSTANCE</code> view. For example, enter:</p>
<pre dir="ltr">
SELECT DATABASE_STATUS FROM V$INSTANCE;

DATABASE_STATUS 
----------------- 
ACTIVE 
</pre></li>
<li>
<p>Take the specified tablespaces out of backup mode. For example, enter the following statement to take tablespace <code dir="ltr">users</code> out of backup mode:</p>
<pre dir="ltr">
ALTER TABLESPACE users END BACKUP;
</pre></li>
<li>
<p>Copy the control file and archive the online redo logs as usual for a backup.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmbckad.htm#i1006219">"Making Split Mirror Backups with RMAN"</a></p>
</li>
<li>
<p><a class="olink ADMIN11165" href="../../server.112/e25494/start.htm#ADMIN11165"><span class="italic">Oracle Database Administrator's Guide</span></a> for more information about the <code dir="ltr">SUSPEND</code>/<code dir="ltr">RESUME</code> feature</p>
</li>
<li>
<p><a class="olink SQLRF00902" href="../../server.112/e41084/statements_2014.htm#SQLRF00902"><span class="italic">Oracle Database SQL Language Reference</span></a> for the <a class="olink SQLRF00902" href="../../server.112/e41084/statements_2014.htm#SQLRF00902"><code dir="ltr">ALTER SYSTEM</code></a> <code dir="ltr">SUSPEND</code> syntax</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006742"></a>
<div id="BRADV205" class="sect1">
<h2 class="sect1">Making User-Managed Backups to Raw Devices</h2>
<p><a id="sthref1970"></a>A <a href="glossary.htm#CHDHBJAG"><span class="xrefglossterm">raw device</span></a> is a disk or partition that does not have a file system. A raw device can contain only a single file. Backing up files on raw devices poses operating system specific issues. The following sections discuss some of these issues on UNIX, Linux, and Windows.</p>
<div id="BRADV90014" class="sect2"><a id="sthref1971"></a>
<h3 class="sect2">Backing Up to Raw Devices on Linux and UNIX</h3>
<p><a id="sthref1972"></a>The <code dir="ltr">dd</code> command on Linux and UNIX is the most common backup utility for backing up to or from raw devices. See your operating system-specific documentation for complete details about this utility.</p>
<p>Using <code dir="ltr">dd</code> effectively requires that you specify the correct options, based on your database. <a href="#CHDFJAAE">Table 28-1</a> lists details about your database that affect the options you use for <code dir="ltr">dd</code>.</p>
<div id="BRADV498" class="tblhruleformal">
<p class="titleintable"><a id="sthref1973"></a><a id="CHDFJAAE"></a>Table 28-1 Aspects of the Database Important for dd Usage</p>
<table class="cellalignment1945" title="Aspects of the Database Important for dd Usage" summary="Effect of dd on different types of data" dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t19">Data</th>
<th class="cellalignment1941" id="r1c2-t19">Explanation</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t19" headers="r1c1-t19">
<p>Block size</p>
</td>
<td class="cellalignment1942" headers="r2c1-t19 r1c2-t19">
<p>You can specify the size of the buffer that <code dir="ltr">dd</code> uses to copy data. For example, you can specify that <code dir="ltr">dd</code> should copy data in units of 8 KB or 64 KB. The block size for <code dir="ltr">dd</code> need not correspond to either the Oracle block size or the operating system block size: it is the size of the buffer used by <code dir="ltr">dd</code> when making the copy.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t19" headers="r1c1-t19">
<p>Raw offset</p>
</td>
<td class="cellalignment1942" headers="r3c1-t19 r1c2-t19">
<p>On some systems, the beginning of the file on the raw device is reserved for use by the operating system. This storage space is called the <span class="glossaryterm">raw offset</span>. Oracle should not back up or restore these bytes.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t19" headers="r1c1-t19">
<p>Size of Oracle Database block <code dir="ltr">0</code></p>
</td>
<td class="cellalignment1942" headers="r4c1-t19 r1c2-t19">
<p>At the beginning of every Oracle database file, the operating system-specific code places an Oracle block called <span class="glossaryterm">block 0</span>. The generic Oracle code does not recognize this block, but the block is included in the size of the file on the operating system. Typically, this block is the same size as the other Oracle blocks in the file.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<p>The information in <a href="#CHDFJAAE">Table 28-1</a> enables you to set the <code dir="ltr">dd</code> options specified in <a href="#g1012027">Table 28-2</a>.</p>
<div id="BRADV499" class="tblruleformal">
<p class="titleintable"><a id="sthref1974"></a><a id="g1012027"></a>Table 28-2 Options for dd Command</p>
<table class="cellalignment1945" title="Options for dd Command" summary="This table describes options to the dd command." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t20">This Option...</th>
<th class="cellalignment1941" id="r1c2-t20">Specifies...</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t20" headers="r1c1-t20">
<p><code dir="ltr">if</code></p>
</td>
<td class="cellalignment1942" headers="r2c1-t20 r1c2-t20">
<p>The name of the input file, that is, the file that you are reading</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t20" headers="r1c1-t20">
<p><code dir="ltr">of</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t20 r1c2-t20">
<p>The name of the output file, that is, the file to which you are writing</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t20" headers="r1c1-t20">
<p><code dir="ltr">bs</code></p>
</td>
<td class="cellalignment1942" headers="r4c1-t20 r1c2-t20">
<p>The buffer size used by <code dir="ltr">dd</code> to copy data</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r5c1-t20" headers="r1c1-t20">
<p><code dir="ltr">skip</code></p>
</td>
<td class="cellalignment1942" headers="r5c1-t20 r1c2-t20">
<p>The number of <code dir="ltr">dd</code> buffers to skip on the input raw device if a raw offset exists. For example, if you are backing up a file on a raw device with a 64 KB raw offset, and the <code dir="ltr">dd</code> buffer size is 8 KB, then you can specify <code dir="ltr">skip=8</code> so that the copy starts at offset 64 KB.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r6c1-t20" headers="r1c1-t20">
<p><code dir="ltr">seek</code></p>
</td>
<td class="cellalignment1942" headers="r6c1-t20 r1c2-t20">
<p>The number of <code dir="ltr">dd</code> buffers to skip on the output raw device if a raw offset exists. For example, if you are backing up a file onto a raw device with a 64 KB raw offset, and the <code dir="ltr">dd</code> buffer size is 8 KB, then you can specify <code dir="ltr">skip=8</code> so that the copy starts at offset 64 KB.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r7c1-t20" headers="r1c1-t20">
<p><code dir="ltr">count</code></p>
</td>
<td class="cellalignment1942" headers="r7c1-t20 r1c2-t20">
<p>The number of blocks on the input raw device for <code dir="ltr">dd</code> to copy. It is best to specify the exact number of blocks to copy when copying from a raw device to a file system; otherwise extra space at the end of the raw volume that is not used by the Oracle data file is copied to the file system.</p>
<p>Remember to include block <code dir="ltr">0</code> in the total size of the input file. For example, if the <code dir="ltr">dd</code> block size is 8 KB, and you are backing up a 30720 KB data file, then you can set <code dir="ltr">count=3841</code>. This value for <code dir="ltr">count</code> actually backs up 30728 KB: the extra 8 KB are for Oracle block <code dir="ltr">0</code>.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" -->
<p>Because a raw device can be the input or output device for a backup, you have four possible scenarios for the backup. The possible options for <code dir="ltr">dd</code> depend on which scenario you choose, as illustrated in <a href="#g1012052">Table 28-3</a>.</p>
<div id="BRADV500" class="tblruleformal">
<p class="titleintable"><a id="sthref1975"></a><a id="g1012052"></a>Table 28-3 Scenarios Involving dd Backups</p>
<table class="cellalignment1945" title="Scenarios Involving dd Backups" summary="This table lists the options needed for the dd command based on the source and destination types for a backup." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t21">Backing Up from ...</th>
<th class="cellalignment1941" id="r1c2-t21">Backing Up to ...</th>
<th class="cellalignment1941" id="r1c3-t21">Options Specified for dd Command</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t21" headers="r1c1-t21">
<p>Raw device</p>
</td>
<td class="cellalignment1942" headers="r2c1-t21 r1c2-t21">
<p>Raw device</p>
</td>
<td class="cellalignment1942" headers="r2c1-t21 r1c3-t21">
<p><code dir="ltr">if,</code> <code dir="ltr">of,</code> <code dir="ltr">bs,</code> <code dir="ltr">skip</code>, <code dir="ltr">seek</code>, <code dir="ltr">count</code></p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t21" headers="r1c1-t21">
<p>Raw device</p>
</td>
<td class="cellalignment1942" headers="r3c1-t21 r1c2-t21">
<p>File system</p>
</td>
<td class="cellalignment1942" headers="r3c1-t21 r1c3-t21">
<p><code dir="ltr">if,</code> <code dir="ltr">of,</code> <code dir="ltr">bs,</code> <code dir="ltr">skip</code>, <code dir="ltr">count</code></p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t21" headers="r1c1-t21">
<p>File system</p>
</td>
<td class="cellalignment1942" headers="r4c1-t21 r1c2-t21">
<p>Raw device</p>
</td>
<td class="cellalignment1942" headers="r4c1-t21 r1c3-t21">
<p><code dir="ltr">if,</code> <code dir="ltr">of,</code> <code dir="ltr">bs,</code> <code dir="ltr">seek</code></p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r5c1-t21" headers="r1c1-t21">
<p>File system</p>
</td>
<td class="cellalignment1942" headers="r5c1-t21 r1c2-t21">
<p>File system</p>
</td>
<td class="cellalignment1942" headers="r5c1-t21 r1c3-t21">
<p><code dir="ltr">if,</code> <code dir="ltr">of,</code> <code dir="ltr">bs</code></p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" -->
<div id="BRADV90015" class="sect3"><a id="sthref1976"></a>
<h4 class="sect3">Backing Up with the dd Utility on Linux and UNIX: Examples</h4>
<p>For these examples of <code dir="ltr">dd</code> utility usage, assume the following:</p>
<ul>
<li>
<p>You are backing up a 30720 KB data file.</p>
</li>
<li>
<p>The beginning of the data file has a block 0 of 8 KB.</p>
</li>
<li>
<p>The raw offset is 64 KB.</p>
</li>
<li>
<p>You set the <code dir="ltr">dd</code> block size to 8 KB when a raw device is involved in the copy.</p>
</li>
</ul>
<p>In the following example, you back up from one raw device to another raw device:</p>
<pre dir="ltr">
% dd if=/dev/rsd1b of=/dev/rsd2b bs=8k skip=8 seek=8 count=3841
</pre>
<p>In the following example, you back up from a raw device to a file system:</p>
<pre dir="ltr">
% dd if=/dev/rsd1b of=/backup/df1.dbf bs=8k skip=8 count=3841
</pre>
<p>In the following example, you back up from a file system to a raw device:</p>
<pre dir="ltr">
% dd if=/backup/df1.dbf of=/dev/rsd2b bs=8k seek=8
</pre>
<p>In the following example, you back up from a file system to a file system, and set the block size to a high value to boost I/O performance:</p>
<pre dir="ltr">
% dd if=/oracle/dbs/df1.dbf of=/backup/df1.dbf bs=1024k
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<div id="BRADV90016" class="sect2"><a id="sthref1977"></a>
<h3 class="sect2">Backing Up to Raw Devices on Windows</h3>
<p><a id="sthref1978"></a>Like Linux and UNIX, Windows supports raw disk partitions in which the database can store data files, online logs, and control files. Each raw partition is assigned either a drive letter or physical drive number and does not contain a file system. As in Linux and UNIX, each raw partition on Windows is mapped to a single file.</p>
<p>Windows differs from Linux and UNIX in the naming convention for Oracle files. On Windows, raw data file names are formatted as follows:</p>
<pre dir="ltr">
\\.\<span class="italic">drive_letter</span>:
\\.\PHYSICALDRIVE<span class="italic">drive_number</span>
</pre>
<p>For example, the following are possible raw file names:</p>
<pre dir="ltr">
\\.\G:
\\.\PHYSICALDRIVE3
</pre>
<p>The procedure for making user-managed backups of raw data files is basically the same as for copying files on a Windows file system, except that you should use the Oracle <code dir="ltr">OCOPY</code> utility rather than the Windows-supplied <code dir="ltr">copy.exe</code> or <code dir="ltr">ntbackup.exe</code> utilities. <code dir="ltr">OCOPY</code> supports 64-bit file I/O, physical raw drives, and raw files. The <code dir="ltr">OCOPY</code> utility cannot back up directly to tape.</p>
<p>To display online documentation for <code dir="ltr">OCOPY</code>, enter <code dir="ltr">OCOPY</code> by itself at the Windows prompt. Sample output follows:</p>
<pre dir="ltr">
Usage of OCOPY:
     ocopy from_file [to_file [a | size_1 [size_n]]]
     ocopy -b from_file to_drive
     ocopy -r from_drive to_dir
</pre>
<p>Note the important <code dir="ltr">OCOPY</code> options described in <a href="#CEGIEACH">Table 28-4</a>.</p>
<div id="BRADV501" class="tblruleformal">
<p class="titleintable"><a id="sthref1979"></a><a id="CEGIEACH"></a>Table 28-4 OCOPY Options</p>
<table class="cellalignment1945" title="OCOPY Options" summary="This table lists important options to the ocopy command." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t22">Option</th>
<th class="cellalignment1941" id="r1c2-t22">Action</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t22" headers="r1c1-t22">
<p><code dir="ltr">b</code></p>
</td>
<td class="cellalignment1942" headers="r2c1-t22 r1c2-t22">
<p>Splits the input file into multiple output files. This option is useful for backing up to devices that are smaller than the input file.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t22" headers="r1c1-t22">
<p><code dir="ltr">r</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t22 r1c2-t22">
<p>Combines multiple input files and writes to a single output file. This option is useful for restoring backups created with the <code dir="ltr">-b</code> option.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" -->
<div id="BRADV90017" class="sect3"><a id="sthref1980"></a>
<h4 class="sect3">Backing Up with OCOPY: Example</h4>
<p>In this example, assume the following:</p>
<ul>
<li>
<p>Data file <code dir="ltr">12</code> is mounted on the <code dir="ltr">\\.\G:</code> raw partition.</p>
</li>
<li>
<p>The <code dir="ltr">C:</code> drive mounts a file system.</p>
</li>
<li>
<p>The database is open.</p>
</li>
</ul>
<p>To back up the data file on the raw partition \\.\<code dir="ltr">G:</code> to a local file system, you can run the following command at the prompt after placing data file <code dir="ltr">12</code> in backup mode:</p>
<pre dir="ltr">
OCOPY "\\.G:" C:\backup\datafile12.bak
</pre></div>
<!-- class="sect3" -->
<div id="BRADV90018" class="sect3"><a id="sthref1981"></a>
<h4 class="sect3">Specifying the -b and -r Options for OCOPY: Example</h4>
<p>In this example, assume the following:</p>
<ul>
<li>
<p><code dir="ltr">\\.\G:</code> is a raw partition containing data file <code dir="ltr">7</code></p>
</li>
<li>
<p>The <code dir="ltr">E:</code> drive is a removable disk drive.</p>
</li>
<li>
<p>The database is open.</p>
</li>
</ul>
<p>To back up the data file onto drive <code dir="ltr">E:</code>, you can execute the following command at the Windows prompt after placing data file <code dir="ltr">7</code> in backup mode:</p>
<pre dir="ltr">
# first argument is filename, second argument is drive
OCOPY -b "\\.\G:" E:\
</pre>
<p>When drive <code dir="ltr">E:</code> fills up, you can use another disk. In this way, you can divide the backup of data file <code dir="ltr">7</code> into multiple files.</p>
<p>Similarly, to restore the backup, take the tablespace containing data file <code dir="ltr">7</code> offline and run this command:</p>
<pre dir="ltr">
# first argument is drive, second argument is directory
OCOPY -r E:\ "\\.\G:"
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDFFHGC"></a>
<div id="BRADV90019" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Making Backups with the Volume Shadow Copy Service (VSS)</h2>
<p><a href="glossary.htm#CHDEJEIH"><span class="xrefglossterm">Volume Shadow Copy Service (VSS)</span></a> is a set of Windows APIs that enable applications to create consistent snapshots called <span class="glossaryterm">shadow copies</span>. The <a href="glossary.htm#CHDGEECJ"><span class="xrefglossterm">Oracle VSS writer</span></a> runs as a service on Windows systems and is integrated with VSS-enabled applications. You can use these applications to create snapshots of database files managed by the Oracle instance. For example, you can make shadow copies of an Oracle database while it is open read/write.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink NTQRF" href="../../win.112/e10845/toc.htm"><span class="italic">Oracle Database Platform Guide for Microsoft Windows</span></a> to learn how to back up and recover the database with VSS-enabled applications</div>
</div>
<!-- class="sect1" -->
<a id="i1006936"></a>
<div id="BRADV206" class="sect1">
<h2 class="sect1">Verifying User-Managed Data File Backups</h2>
<p><a id="sthref1982"></a><a id="sthref1983"></a><a id="sthref1984"></a><a id="sthref1985"></a>You should periodically verify your backups to ensure that they are usable for recovery.</p>
<a id="i1006948"></a>
<div id="BRADV90020" class="sect2">
<h3 class="sect2">Testing the Restoration of Data File Backups</h3>
<p>The best way to test the usability of data file backups is to restore them to a separate host and attempt to open the database, performing media recovery if necessary. This option requires that you have a separate host available for the restore procedure.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="osrecvry.htm#i1011065">"Performing Complete Database Recovery"</a> to learn how to recover files with SQL*Plus</div>
</div>
<!-- class="sect2" -->
<a id="CEGIHAEF"></a>
<div id="BRADV90021" class="sect2">
<h3 class="sect2">Running the DBVERIFY Utility</h3>
<p>The DBVERIFY program is an external command-line utility that performs a physical data structure integrity check on an offline data file. Use DBVERIFY to ensure that a user-managed backup of a data file is valid before it is restored or as a diagnostic aid when you have encountered data corruption problems.</p>
<p>The name and location of DBVERIFY is dependent on your operating system. For example, to perform an integrity check on data file <code dir="ltr">users01.dbf</code> on Linux or UNIX, run the <code dir="ltr">dbv</code> command as follows:</p>
<pre dir="ltr">
% dbv file=users01.dbf
</pre>
<p>Sample <code dir="ltr">dbv</code> output follows:</p>
<pre dir="ltr">
DBVERIFY - Verification starting : FILE = users01.dbf


DBVERIFY - Verification complete

Total Pages Examined         : 250
Total Pages Processed (Data) : 1
Total Pages Failing   (Data) : 0
Total Pages Processed (Index): 0
Total Pages Failing   (Index): 0
Total Pages Processed (Other): 2
Total Pages Processed (Seg)  : 0
Total Pages Failing   (Seg)  : 0
Total Pages Empty            : 247
Total Pages Marked Corrupt   : 0
Total Pages Influx           : 0
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SUTIL013" href="../../server.112/e22490/dbverify.htm#SUTIL013"><span class="italic">Oracle Database Utilities</span></a> to learn about DBVERIFY</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1933">
<tr>
<td class="cellalignment1942">
<table class="cellalignment1938">
<tr>
<td class="cellalignment1937"><a href="part_umb.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1937"><a href="osrecvry.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1944">
<table class="cellalignment1936">
<tr>
<td class="cellalignment1937"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1937"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1937"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1937"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1937"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1937"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
