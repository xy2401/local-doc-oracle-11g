<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Backing Up the Database: Advanced Topics</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1054" />
<meta name="description" content="A guide to backup and recovery of Oracle databases, including RMAN backup and recovery, RMAN data transfer, Oracle Flashback Technology, and user-managed backup and recovery" />
<meta name="dcterms.created" content="2015-05-13T14:1:11Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Backup and Recovery User's Guide" />
<meta name="dcterms.identifier" content="E10642-08" />
<meta name="dcterms.isVersionOf" content="BRADV" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="rcmbckba.htm" title="Previous" type="text/html" />
<link rel="Next" href="part_mai.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10642.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">20/47</span> <!-- End Header -->
<div id="BRADV007" class="chapter"><a id="CEGHFJCF"></a>
<h1 class="chapter"><span class="secnum">10</span> Backing Up the Database: Advanced Topics</h1>
<p>This chapter explains advanced RMAN backup procedures. This chapter contains the following topics:</p>
<ul>
<li>
<p><a href="#CHDJCAAG">Limiting the Size of RMAN Backup Sets</a></p>
</li>
<li>
<p><a href="#i1006854">Using Backup Optimization to Skip Files</a></p>
</li>
<li>
<p><a href="#CHDIEIFE">Skipping Offline, Read-Only, and Inaccessible Files</a></p>
</li>
<li>
<p><a href="#i1006180">Duplexing Backup Sets</a></p>
</li>
<li>
<p><a href="#i1006219">Making Split Mirror Backups with RMAN</a></p>
</li>
<li>
<p><a href="#CEGEJABH">Encrypting RMAN Backups</a></p>
</li>
<li>
<p><a href="#i1009271">Restarting RMAN Backups</a></p>
</li>
<li>
<p><a href="#CHDEBGAA">Managing Backup Windows</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmbckba.htm#g1050005">Chapter 9, "Backing Up the Database"</a> for basic backup procedures</div>
<a id="CHDJCAAG"></a>
<div id="BRADV89540" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Limiting the Size of RMAN Backup Sets</h2>
<p><a id="sthref941"></a>As explained in <a href="rcmconfa.htm#i1015840">"Configuring the Maximum Size of Backup Sets"</a>, you can use the <code dir="ltr">CONFIGURE</code> command to create persistent settings that govern backup set size. This control is helpful when backing up very large files. If you do not have a backup set size persistently configured, then you can also use <a id="sthref942"></a>the<a id="sthref943"></a> <code dir="ltr">BACKUP</code> <code dir="ltr">... MAXSETSIZE</code> command to limit the size of backup sets.</p>
<p>You can use the <code dir="ltr">CONFIGURE</code> command, but not the <code dir="ltr">BACKUP</code> command, to set a limit for the size of individual backup pieces. This control is especially useful when you use a media manager that has restrictions on the sizes of files, or when you must back up very large files. See <a href="rcmconfa.htm#CEGGJJBD">"Configuring the Maximum Size of Backup Pieces"</a> for more information.</p>
<a id="CEGCEGBC"></a>
<div id="BRADV89541" class="sect2">
<h3 class="sect2">About Backup Set Size</h3>
<p>The <code dir="ltr">MAXSETSIZE</code> parameter of the <code dir="ltr">BACKUP</code> command specifies a maximum size for a backup set in units of bytes (default), kilobytes, megabytes, or gigabytes. Thus, to limit a backup set to 305 MB, specify <code dir="ltr">MAXSETSIZE 305M</code>. RMAN attempts to limit all backup sets to this size.</p>
<p>You can use <code dir="ltr">BACKUP ... MAXSETSIZE</code> to limit the size of backup sets so that the database is divided among multiple backup sets. If the backup fails partway through, then you can use the restartable backup feature to back up only those files that were not backed up during the previous attempt. See <a href="#i1009271">"Restarting RMAN Backups"</a> to learn how to restart RMAN backups.</p>
<p>In some cases the <code dir="ltr">MAXSETSIZE</code> value may be too small to contain the largest file that you are backing up. When determining whether <code dir="ltr">MAXSETSIZE</code> is too small, RMAN uses the size of the original data file rather than the file size after compression. RMAN displays an error stack such as the following:</p>
<pre dir="ltr">
RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-03002: failure of backup command at 11/03/06 14:40:33
RMAN-06182: archive log larger than MAXSETSIZE: thread 1 seq 1
            /oracle/oradata/trgt/arch/archive1_1.dbf
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code dir="ltr">CONFIGURE MAXSETSIZE</code> command</div>
</div>
<!-- class="sect2" -->
<a id="CHDHABHI"></a>
<div id="BRADV89542" class="sect2">
<h3 class="sect2">Limiting the Size of Backup Sets with BACKUP ... MAXSETSIZE</h3>
<p>Backup piece size is an issue in those situations where it exceeds the maximum file size of the file system or media management software. Use the <code dir="ltr">MAXSETSIZE</code> parameter of the <code dir="ltr">CONFIGURE</code> <code dir="ltr">CHANNEL</code> or <code dir="ltr">ALLOCATE</code> <code dir="ltr">CHANNEL</code> command to limit the size of backup pieces.</p>
<p class="subhead2"><a id="BRADV256"></a>To limit the size of backup sets:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>Execute the <code dir="ltr">BACKUP</code> command with the <code dir="ltr">MAXSETSIZE</code> parameter.</p>
<p>The following example backs up archived logs to tape, limiting the size of each backup set to 100 MB:</p>
<pre dir="ltr">
BACKUP DEVICE TYPE sbt
  MAXSETSIZE 100M
  ARCHIVELOG ALL;
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CHDBAHAD"></a>
<div id="BRADV89543" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Dividing the Backup of a Large Data File into Sections</h3>
<p><a id="sthref944"></a>If <a id="sthref945"></a>you specify the <code dir="ltr">SECTION SIZE</code> parameter on the <code dir="ltr">BACKUP</code> command, then RMAN creates a backup set in which each backup piece contains the blocks from one file section. A <a href="glossary.htm#CHDHHBFC"><span class="xrefglossterm">file section</span></a> is a contiguous range of blocks in a file. This type of backup is called a <a href="glossary.htm#BGBCJCBC"><span class="xrefglossterm">multisection backup</span></a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You cannot specify <code dir="ltr">SECTION SIZE</code> with <code dir="ltr">MAXPIECESIZE</code>.</div>
<p>The purpose of multisection backups is to enable RMAN channels to back up a single large file in parallel. RMAN divides the work among multiple channels, with each channel backing up one file section in a file. Backing up a file in separate sections can improve the performance of backups of large datafiles.</p>
<p>If a multisection backup completes successfully, then none of the backup sets generated during the backup contain a partial data file. If a multisection backup is unsuccessful, then it is possible for the RMAN metadata to contain a record for a partial backup set. RMAN does not consider partial backups for restore and recovery. You must use the <code dir="ltr">DELETE</code> command to delete the partial backup set.</p>
<p>If you specify a section size that is larger than the size of the file, then RMAN does not use multisection backup for the file. If you specify a small section size that would produce more than 256 sections, then RMAN increases the section size to a value that results in exactly 256 sections.</p>
<p class="subhead2"><a id="BRADV257"></a>To make a multisection backup:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>If necessary, configure channel parallelism so that RMAN can make the backup parallel.</p>
</li>
<li>
<p><a id="sthref946"></a>Execute <code dir="ltr">BACKUP</code> with the <code dir="ltr">SECTION SIZE</code> parameter.</p>
<p>For example, suppose that the <code dir="ltr">users</code> tablespace contains a single data file of 900 MB. Also assume that three SBT channels are configured, with the parallelism setting for the SBT device set to 3. You can break up the data file in this tablespace into file sections as shown in the following example:</p>
<pre dir="ltr">
BACKUP
  SECTION SIZE 300M
  TABLESPACE users; 
</pre>
<p>In this example, each of the three SBT channels backs up a 300 MB file section of the <code dir="ltr">users</code> data file.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmvalid.htm#CHDDJJAI">"Make Parallel the Validation of a Data File"</a> to learn how to validate sections of a large data file</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006854"></a>
<div id="BRADV89546" class="sect1">
<h2 class="sect1">Using Backup Optimization to Skip Files</h2>
<p><a id="sthref947"></a>As explained in <a href="rcmconfb.htm#i1015217">"Backup Optimization and the CONFIGURE command"</a>, you run the <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><code dir="ltr">CONFIGURE BACKUP OPTIMIZATION</code></a> command to enable <a href="glossary.htm#CHDBBJCB"><span class="xrefglossterm">backup optimization</span></a>. When certain criteria are met, RMAN skips backups of files that are identical to files that are already backed up.</p>
<p>For the following scenarios, assume that you configure backup optimization and a retention policy as shown in the following example.</p>
<div id="BRADV258" class="example">
<p class="titleinexample"><a id="CHDFIEBH"></a>Example 10-1 Configuring Backup Optimization</p>
<pre dir="ltr">
CONFIGURE DEFAULT DEVICE TYPE TO sbt;
CONFIGURE BACKUP OPTIMIZATION ON;
CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 4 DAYS;
</pre></div>
<!-- class="example" -->
<p>With RMAN configured as shown in <a href="#CHDFIEBH">Example 10-1</a>, you run the following command every night to back up the database to tape:</p>
<pre dir="ltr">
BACKUP DATABASE;
</pre>
<p>Because backup optimization is configured, RMAN skips backups of offline and read-only data files only if the most recent backups were made on or after the earliest point in the recovery window. RMAN does not skip backups when the most recent backups are older than the window. For example, optimization ensures you do not end up with a new backup of a read-only data file every night, so long as one backup set containing this file exists within the recovery window.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmconfb.htm#CHDBHGIH">"Backup Optimization for SBT Backups with Recovery Window Retention Policy"</a> for a scenario involving backup optimization and recovery windows</p>
</li>
<li>
<p><a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for a detailed description of criteria used by <code dir="ltr">CONFIGURE BACKUP OPTIMIZATION</code> to determine whether a file is identical and can potentially be skipped</p>
</li>
</ul>
</div>
<a id="CHDDEDJB"></a>
<div id="BRADV89548" class="sect2">
<h3 class="sect2">Optimizing a Daily Archived Log Backup to a Single Tape: Scenario</h3>
<p>Assume that you want to back up all the archived logs every night, but you do not want to have multiple copies of each log sequence number. With RMAN configured as shown in <a href="#CHDFIEBH">Example 10-1</a>, you run the following command in a script nightly at 1 a.m.:</p>
<pre dir="ltr">
BACKUP DEVICE TYPE sbt 
  ARCHIVELOG ALL;
</pre>
<p>RMAN skips all logs except those produced in the last 24 hours. In this way, you keep only one copy of each archived log on tape.</p>
</div>
<!-- class="sect2" -->
<a id="CHDCAEBD"></a>
<div id="BRADV89549" class="sect2">
<h3 class="sect2">Optimizing a Daily Archived Log Backup to Multiple Media Families: Scenario</h3>
<p>In Oracle Secure Backup, a <span class="glossaryterm">media family</span> is a named group of volumes with a set of shared, user-defined attributes. In this scenario, you back up logs that are not on tape to one media family, then back up the same logs to a second media family. Finally, you delete old logs.</p>
<p>With RMAN configured as shown in <a href="#CHDIACHH">Example 10-2</a>, run the following script at the same time every night to back up the logs generated during the previous day to two separate media families.</p>
<div id="BRADV259" class="example">
<p class="titleinexample"><a id="CHDIACHH"></a>Example 10-2 Backing Up Archived Redo Logs to Multiple Media Families</p>
<pre dir="ltr">
# The following command backs up just the logs that are not on tape. The 
# first copies are saved to the tapes from the media family "log_family1".
RUN
{
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt
    PARMS 'ENV=(OB_MEDIA_FAMILY=log_family1)';
  BACKUP ARCHIVELOG ALL;
}
# Make one more copy of the archived logs and save them to tapes from a 
# different media family
RUN
{
  ALLOCATE CHANNEL c2 DEVICE TYPE sbt 
    PARMS 'ENV=(OB_MEDIA_FAMILY=log_family2)';
  BACKUP ARCHIVELOG
    NOT BACKED UP 2 TIMES;
}
</pre></div>
<!-- class="example" -->
<p>If your goal is to delete logs from disk that have been backed up two times to SBT, then the simplest way to achieve the goal is with an <a href="glossary.htm#CHDGCGHA"><span class="xrefglossterm">archived redo log deletion policy</span></a>. The following one-time configuration specifies that archived redo logs are eligible for deletion from disk if two archived log backups exist on tape:</p>
<pre dir="ltr">
CONFIGURE ARCHIVELOG DELETION POLICY 
  TO BACKED UP 2 TIMES TO DEVICE TYPE sbt;
</pre>
<p>After running the script in <a href="#CHDIACHH">Example 10-2</a>, you can delete unneeded logs by executing <code dir="ltr">DELETE ARCHIVELOG ALL</code>.</p>
</div>
<!-- class="sect2" -->
<a id="i1006905"></a>
<div id="BRADV89550" class="sect2">
<h3 class="sect2">Creating a Weekly Secondary Backup of Archived Logs: Example</h3>
<p>Assume a more sophisticated scenario in which your goal is to back up the archived logs to tape every day. You are worried about tape failure, however, so you want to ensure that you have more than one copy of each log sequence number on an separate tape before you perform your weekly deletion of logs from disk. This scenario assumes that the database is not using a fast recovery area.</p>
<p>First, perform a one-time configuration as follows:</p>
<pre dir="ltr">
CONFIGURE BACKUP OPTIMIZATION ON;
CONFIGURE DEVICE TYPE sbt PARALLELISM 1;
CONFIGURE default DEVICE TYPE TO sbt;
CONFIGURE CHANNEL DEVICE TYPE sbt PARMS 'ENV=(OB_MEDIA_FAMILY=first_copy);
</pre>
<p>Because you have optimization enabled, you can run the following command every evening to back up all archived logs to the <code dir="ltr">first_copy</code> media family that have not been backed up:</p>
<pre dir="ltr">
BACKUP ARCHIVELOG ALL TAG first_copy;
</pre>
<p>Every Friday evening you create an additional backup of all archived logs in a different media family. At the end of the backup, you want to delete all archived logs that have at least two copies on tape. So you run the following script:</p>
<pre dir="ltr">
RUN
{
  # manually allocate a channel, to specify that the backup run by this
  # channel should go to both media families "first_copy" and "second_copy"
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt
      PARMS 'ENV=(OB_MEDIA_FAMILY=second_copy)';
  ALLOCATE CHANNEL c2 DEVICE TYPE sbt
      PARMS 'ENV=(OB_MEDIA_FAMILY=first_copy)';
  BACKUP 
    CHANNEL c1 
    ARCHIVELOG 
    UNTIL TIME 'SYSDATE' 
    NOT BACKED UP 2 TIMES # back up only logs without 2 backups on tape
    TAG SECOND_COPY; 
  BACKUP 
    CHANNEL c2 
    ARCHIVELOG 
    UNTIL TIME 'SYSDATE' 
    NOT BACKED UP 2 TIMES # back up only logs without 2 backups on tape
    TAG FIRST_COPY;
}

# now delete from disk all logs that have been backed up to tape at least twice
DELETE 
  ARCHIVELOG ALL
  BACKED UP 2 TIMES TO DEVICE TYPE sbt;
</pre>
<p>The following table explains the effects of the daily and weekly backup scripts.</p>
<div id="BRADV260" class="tblruleformalwide">
<p class="titleintable"><a id="sthref948"></a><a id="h0037105"></a>Table 10-1 Effects of Daily and Weekly Scripts</p>
<table class="cellalignment1945" title="Effects of Daily and Weekly Scripts" summary="This table describes daily backup activity under the strategy described in this section." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t7">Script</th>
<th class="cellalignment1941" id="r1c2-t7">Tape Contents After Script</th>
<th class="cellalignment1941" id="r1c3-t7">Disk Contents After Script</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t7" headers="r1c1-t7">
<p>Daily</p>
</td>
<td class="cellalignment1942" headers="r2c1-t7 r1c2-t7">
<p>Archived logs that have not yet been backed up are now in media family <code dir="ltr">first_copy</code>.</p>
</td>
<td class="cellalignment1942" headers="r2c1-t7 r1c3-t7">
<p>All archived logs created since the last <code dir="ltr">DELETE</code> command are still on disk.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t7" headers="r1c1-t7">
<p>Weekly</p>
</td>
<td class="cellalignment1942" headers="r3c1-t7 r1c2-t7">
<p>Archived logs that have fewer than two backups on tape are now in media families <code dir="ltr">first_copy</code> and <code dir="ltr">second_copy</code>.</p>
</td>
<td class="cellalignment1942" headers="r3c1-t7 r1c3-t7">
<p>All archived logs that have been backed up at least twice to tape are deleted.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformalwide" -->
<p>After the weekly backup, you can send the tape from the media family <code dir="ltr">second_copy</code> to offsite storage. You should use this tape backup only if the primary tape from pool <code dir="ltr">first_copy</code> is damaged. Because the secondary tape is offsite, you do not want RMAN to use it for recovery, so you can mark the backup as unavailable:</p>
<pre dir="ltr">
CHANGE BACKUP OF ARCHIVELOG TAG SECOND_COPY UNAVAILABLE;
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmmaint.htm#h1016888">Chapter 12, "Maintaining RMAN Backups and Repository&nbsp;Records"</a> to learn how to change the status of and delete backups</p>
</li>
<li>
<p><a class="olink RCMRF110" href="../../backup.112/e10643/rcmsynta009.htm#RCMRF110"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code dir="ltr">CHANGE</code> and <code dir="ltr">DELETE</code> commands</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDIEIFE"></a>
<div id="BRADV89569" class="sect1">
<h2 class="sect1">Skipping Offline, Read-Only, and Inaccessible Files</h2>
<p><a id="sthref949"></a><a id="sthref950"></a>By default, the <code dir="ltr">BACKUP</code> command terminates when it cannot access a data file. You can specify parameters to prevent termination, as listed in <a href="#CHDBBJBF">Table 10-2</a>.</p>
<div id="BRADV261" class="tblruleformal">
<p class="titleintable"><a id="sthref951"></a><a id="CHDBBJBF"></a>Table 10-2 BACKUP ... SKIP Options</p>
<table class="cellalignment1945" title="BACKUP ... SKIP Options" summary="Descriptions of SKIP INACCESSIBLE, SKIP OFFLINE, and SKIP READONLY" dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t9">If you specify . . .</th>
<th class="cellalignment1941" id="r1c2-t9">Then RMAN skips . . .</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t9" headers="r1c1-t9">
<p><code dir="ltr">SKIP</code> <code dir="ltr">INACCESSIBLE</code></p>
</td>
<td class="cellalignment1942" headers="r2c1-t9 r1c2-t9">
<p>Data files that RMAN cannot read.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t9" headers="r1c1-t9">
<p><code dir="ltr">SKIP</code> <code dir="ltr">OFFLINE</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t9 r1c2-t9">
<p>Offline data files. Some offline data files can still be read because they exist on disk. Others have been deleted or moved and so cannot be read, making them inaccessible.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t9" headers="r1c1-t9">
<p><code dir="ltr">SKIP</code> <code dir="ltr">READONLY</code></p>
</td>
<td class="cellalignment1942" headers="r4c1-t9 r1c2-t9">
<p>Datafiles in read-only tablespaces.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" -->
<p>The following example uses an automatic channel to back up the database, and skips all datafiles that might cause the backup job to terminate.</p>
<div id="BRADV262" class="example">
<p class="titleinexample"><a id="sthref952"></a>Example 10-3 Skipping Files During an RMAN Backup</p>
<pre dir="ltr">
BACKUP DATABASE
  SKIP INACCESSIBLE
  SKIP READONLY
  SKIP OFFLINE;
</pre></div>
<!-- class="example" --></div>
<!-- class="sect1" -->
<a id="i1006180"></a>
<div id="BRADV145" class="sect1">
<h2 class="sect1">Duplexing Backup Sets</h2>
<p><a id="sthref953"></a><a id="sthref954"></a><a id="sthref955"></a>RMAN can make up to four copies of a backup set simultaneously, each an exact duplicate of the others. A copy of a <a href="glossary.htm#CHDFAIIJ"><span class="xrefglossterm">duplexed backup set</span></a> is a copy of each backup piece in the backup set, with each copy getting a unique copy number (for example, <code dir="ltr">0tcm8u2s_1_1</code> and <code dir="ltr">0tcm8u2s_1_2</code>). It is not possible to duplex backup sets to the <a href="glossary.htm#i999320"><span class="xrefglossterm">fast recovery area</span></a>.</p>
<p>You can use <a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><code dir="ltr">BACKUP</code></a> <code dir="ltr">...</code> <code dir="ltr">COPIES</code> or <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><code dir="ltr">CONFIGURE</code></a> <code dir="ltr">...</code> <code dir="ltr">BACKUP</code> <code dir="ltr">COPIES</code> to duplex backup sets. RMAN can duplex backups to either disk or tape, but cannot duplex backups to tape and disk simultaneously. For <code dir="ltr">DISK</code> channels, specify multiple values in the <code dir="ltr">FORMAT</code> option to direct the multiple copies to different physical disks. For <a href="glossary.htm#CHDCCBFI"><span class="xrefglossterm">SBT</span></a> channels, if you use a media manager that supports Version 2 of the SBT API, then the media manager automatically writes each copy to a separate medium (for example, a separate tape). When backing up to tape, ensure that the number of copies does not exceed the number of available tape devices.</p>
<p>Duplexing applies only to backup sets, not image copies. It is an error to specify the <code dir="ltr">BACKUP... COPIES</code> when creating image copy backups, and the <code dir="ltr">CONFIGURE... BACKUP COPIES</code> setting is ignored for image copy backups.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmcncpt.htm#i1025065">"Multiple Copies of RMAN Backups"</a> for a conceptual overview of RMAN backup copies</div>
<div id="BRADV89570" class="sect2"><a id="sthref956"></a>
<h3 class="sect2">Duplexing Backup Sets with CONFIGURE BACKUP COPIES</h3>
<p>As explained in <a href="rcmconfa.htm#i1007486">"Configuring Backup Duplexing"</a>, the <code dir="ltr">CONFIGURE</code> <code dir="ltr">...</code> <code dir="ltr">BACKUP</code> <code dir="ltr">COPIES</code> command specifies the number of identical backup sets to create on the specified device type. This setting applies to all backup sets except control file autobackups (because the autobackup of a control file always produces one copy) and backup sets when backed up with the <code dir="ltr">BACKUP BACKUPSET</code> command.</p>
<p class="subhead2"><a id="BRADV263"></a>To duplex a backup with CONFIGURE ... BACKUP COPIES: <a id="sthref957"></a><a id="sthref958"></a><a id="sthref959"></a></p>
<ol>
<li>
<p>Configure the number of copies on the desired device type for datafiles and archived redo logs on the desired device types.</p>
<p>By default, <code dir="ltr">CONFIGURE</code> <code dir="ltr">...</code> <code dir="ltr">BACKUP</code> <code dir="ltr">COPIES</code> is set to <code dir="ltr">1</code> for each device type. The following example configures duplexing for datafiles and archived logs on tape and also duplexing for datafiles (but not archived redo logs) on disk:</p>
<pre dir="ltr">
CONFIGURE DEVICE TYPE sbt PARALLELISM 1;
CONFIGURE DEFAULT DEVICE TYPE TO sbt;
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT '/disk1/%U', '/disk2/%U';
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE sbt TO 2;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE sbt TO 2;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 2;
</pre></li>
<li>
<p>Execute the <code dir="ltr">BACKUP</code> command.</p>
<p>The following command backs up the database and archived logs to tape, making two copies of each data file and archived log:</p>
<pre dir="ltr">
BACKUP AS BACKUPSET DATABASE PLUS ARCHIVELOG;
</pre>
<p>Because of the configured formats for the disk channel, the following command backs up the database to disk, placing one copy of the backup sets produced in the <code dir="ltr">/disk1</code> directory and the other in the <code dir="ltr">/disk2</code> directory:</p>
<pre dir="ltr">
BACKUP DEVICE TYPE DISK AS BACKUPSET DATABASE;
</pre>
<p>If the <code dir="ltr">FORMAT</code> clause were not configured on <code dir="ltr">CONFIGURE CHANNNEL</code>, then you specify <code dir="ltr">FORMAT</code> on the <code dir="ltr">BACKUP</code> command itself. For example, you issue the following command:</p>
<pre dir="ltr">
BACKUP AS BACKUPSET DATABASE 
  FORMAT '/disk1/%U', 
         '/disk2/%U';
</pre></li>
<li>
<p>Issue a <a class="olink RCMRF132" href="../../backup.112/e10643/rcmsynta027.htm#RCMRF132"><code dir="ltr">LIST</code></a> <code dir="ltr">BACKUP</code> command to see a listing of backup sets and pieces.</p>
<p>For example, enter the following command:</p>
<pre dir="ltr">
LIST BACKUP SUMMARY;
</pre>
<p>The <code dir="ltr">#Copies</code> column shows the number of backup sets, which may have been produced by duplexing or by multiple backup commands.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmconfa.htm#i1007486">"Configuring Backup Duplexing"</a> to learn about the <code dir="ltr">CONFIGURE BACKUP COPIES</code> command, and <a href="rcmconfb.htm#i1016757">"Configuring the Environment for RMAN Backups"</a> to learn about basic backup configuration options</div>
</div>
<!-- class="sect2" -->
<div id="BRADV89571" class="sect2"><a id="sthref960"></a>
<h3 class="sect2">Duplexing Backup Sets with BACKUP ... COPIES</h3>
<p><a id="sthref961"></a>The <code dir="ltr">COPIES</code> option of the <code dir="ltr">BACKUP</code> command overrides every other <code dir="ltr">COPIES</code> or <code dir="ltr">DUPLEX</code> setting to control duplexing of backup sets.</p>
<p class="subhead2"><a id="BRADV264"></a>To duplex a backup with BACKUP ... COPIES:<a id="sthref962"></a><a id="sthref963"></a><a id="sthref964"></a></p>
<ol>
<li>
<p>Specify the number of identical copies with the <code dir="ltr">COPIES</code> option of the <code dir="ltr">BACKUP</code> command. For example, run the following to make three copies of each backup set in the default <code dir="ltr">DISK</code> location:</p>
<pre dir="ltr">
BACKUP AS BACKUPSET DEVICE TYPE DISK 
  COPIES 3 
  INCREMENTAL LEVEL 0 
  DATABASE;
</pre>
<p>Because you specified <code dir="ltr">COPIES</code> in the <code dir="ltr">BACKUP</code> command, RMAN makes three backup sets of each data file regardless of the <code dir="ltr">CONFIGURE</code> <code dir="ltr">DATAFILE</code> <code dir="ltr">COPIES</code> setting.</p>
</li>
<li>
<p>Issue a <code dir="ltr">LIST</code> <code dir="ltr">BACKUP</code> command to see a listing of backup sets and pieces (the <code dir="ltr">#Copies</code> column shows the number of copies, which may have been produced through duplexing or through multiple invocations of the <code dir="ltr">BACKUP</code> command). For example, enter:</p>
<pre dir="ltr">
LIST BACKUP SUMMARY;
</pre></li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006219"></a>
<div id="BRADV146" class="sect1">
<h2 class="sect1">Making Split Mirror Backups with RMAN</h2>
<p><a id="sthref965"></a><a id="sthref966"></a><a id="sthref967"></a><a id="sthref968"></a>Many sites keep a backup of the database stored on disk in case a <a href="glossary.htm#i432912"><span class="xrefglossterm">media failure</span></a> occurs on the primary database or an incorrect user action requires <a href="glossary.htm#i433615"><span class="xrefglossterm">point-in-time recovery</span></a>. A data file backup on disk simplifies the restore step of recovery, making recovery much quicker and more reliable.</p>
<div class="infobox-note">
<p class="notep1"><span class="bold">Caution</span>:</p>
Never make backups, split mirror or otherwise, of online redo logs. Restoring online redo log backups can create two archived logs with the same sequence number but different contents. Also, it is best to use the <a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><code dir="ltr">BACKUP</code></a> <code dir="ltr">CONTROLFILE</code> command rather than a split mirror to make control file backups.</div>
<p>One way of creating a data file backup on disk is to use disk <a href="glossary.htm#i432964"><span class="xrefglossterm">mirroring</span></a>. For example, the operating system can maintain three identical copies of each file in the database. In this configuration, you can split off a mirrored copy of the database to use as a backup.</p>
<p>RMAN does not automate the splitting of mirrors, but can make use of split mirrors in backup and recovery. For example, RMAN can treat a split mirror of a data file as a data file copy, and can also back up this copy to disk or tape. The procedure in this section explains how to make a <a href="glossary.htm#CHDFCAHJ"><span class="xrefglossterm">split mirror backup</span></a> with the <code dir="ltr">ALTER SYSTEM SUSPEND</code>/<code dir="ltr">RESUME</code> functionality.</p>
<p>Some mirroring technology does not require Oracle Database to suspend all I/O before a mirror can be separated and used as a backup. Refer to your storage manager, volume manager, or file system documentation for information about whether you must suspend I/O from the database instance.</p>
<p class="subhead2"><a id="BRADV265"></a>To make a split mirror backup of a tablespace by using SUSPEND/RESUME:</p>
<ol>
<li>
<p>Start RMAN and then place the tablespaces to back up into backup mode with the <a class="olink SQLRF01002" href="../../server.112/e41084/statements_3002.htm#SQLRF01002"><code dir="ltr">ALTER TABLESPACE ... BEGIN BACKUP</code></a> statement. (To place all tablespaces in backup mode, you can the <a class="olink SQLRF00802" href="../../server.112/e41084/statements_1004.htm#SQLRF00802"><code dir="ltr">ALTER DATABASE BEGIN BACKUP</code></a> instead.)</p>
<p>For example, to place tablespace <code dir="ltr">users</code> in backup mode, you connect RMAN to a target database and run the following <code dir="ltr">SQL</code> command:</p>
<pre dir="ltr">
SQL 'ALTER TABLESPACE users BEGIN BACKUP'; 
</pre></li>
<li>
<p>Suspend I/O if your mirroring software or hardware requires it. For example, enter the following command in RMAN:</p>
<pre dir="ltr">
SQL 'ALTER SYSTEM SUSPEND';
</pre></li>
<li>
<p>Split the mirrors for the underlying datafiles contained in these tablespaces.</p>
</li>
<li>
<p>Take the database out of the suspended state. For example, enter the following command in RMAN:</p>
<pre dir="ltr">
SQL 'ALTER SYSTEM RESUME';
</pre></li>
<li>
<p>Take the tablespaces out of backup mode. For example, enter:</p>
<pre dir="ltr">
SQL 'ALTER TABLESPACE users END BACKUP';
</pre>
<p>You can also use <code dir="ltr">ALTER DATABASE END BACKUP</code> to take all tablespaces out of backup mode.</p>
</li>
<li>
<p>Catalog the user-managed mirror copies as data file copies with the <a class="olink RCMRF109" href="../../backup.112/e10643/rcmsynta008.htm#RCMRF109"><code dir="ltr">CATALOG</code></a> command. For example, enter:</p>
<pre dir="ltr">
CATALOG DATAFILECOPY '/dk2/oradata/trgt/users01.dbf'; # catalog split mirror
</pre></li>
<li>
<p>Back up the data file copies. For example, run the <code dir="ltr">BACKUP</code> <code dir="ltr">DATAFILECOPY</code> command at the prompt:</p>
<pre dir="ltr">
BACKUP DATAFILECOPY '/dk2/oradata/trgt/users01.dbf';
</pre></li>
<li>
<p>When you are ready to <a href="glossary.htm#BGBIBFIJ"><span class="xrefglossterm">resilver a split mirror</span></a>, first use the <a class="olink RCMRF110" href="../../backup.112/e10643/rcmsynta009.htm#RCMRF110"><code dir="ltr">CHANGE</code></a> <code dir="ltr">...</code> <code dir="ltr">UNCATALOG</code> command to uncatalog the data file copies you cataloged in Step 6. For example, enter:</p>
<pre dir="ltr">
CHANGE DATAFILECOPY '/dk2/oradata/trgt/users01.dbf' UNCATALOG;
</pre></li>
<li>
<p>Resilver the split mirror for the affected datafiles.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="osbackup.htm#i1006658">"Making User-Managed Backups in SUSPEND Mode"</a></p>
</li>
<li>
<p><a class="olink ADMIN004" href="../../server.112/e25494/start.htm#ADMIN004"><span class="italic">Oracle Database Administrator's Guide</span></a> for more information about the <code dir="ltr">SUSPEND</code>/<code dir="ltr">RESUME</code> feature</p>
</li>
<li>
<p><a class="olink SQLRF009" href="../../server.112/e41084/statements_2.htm#SQLRF009"><span class="italic">Oracle Database SQL Language Reference</span></a> for the <a class="olink SQLRF00902" href="../../server.112/e41084/statements_2014.htm#SQLRF00902"><code dir="ltr">ALTER SYSTEM</code></a> <code dir="ltr">SUSPEND</code> syntax</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CEGEJABH"></a>
<div id="BRADV72450" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Encrypting RMAN Backups</h2>
<p><a id="sthref969"></a><a id="sthref970"></a>As explained in <a href="rcmconfa.htm#CHDEDDBE">"Configuring Backup Encryption"</a>, you can protect RMAN backup sets with <a href="glossary.htm#CHDJDIEJ"><span class="xrefglossterm">backup encryption</span></a>. Encrypted backups cannot be read if they are obtained by unauthorized users. The RMAN backup encryption feature requires the Enterprise Edition of the database.</p>
<div id="BRADV89573" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref971"></a>
<h3 class="sect2">About RMAN Backup Encryption Settings</h3>
<p>Backup encryption is performed based on the encryption settings specified with the following commands:</p>
<ul>
<li>
<p><code dir="ltr">CONFIGURE</code> <code dir="ltr">ENCRYPTION</code></p>
<p>You can use this command to persistently configure transparent encryption. You cannot persistently configure dual mode or password mode encryption.</p>
</li>
<li>
<p><code dir="ltr">SET</code> <code dir="ltr">ENCRYPTION</code></p>
<p>You can use this command to configure dual mode or password mode encryption at the <a href="glossary.htm#CHDHHCJB"><span class="xrefglossterm">RMAN session</span></a> level.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Wallet-based encryption is more secure than password-based encryption because no passwords are involved. You should use password-based encryption only when absolutely necessary because your backups must be transportable.</div>
<p>The database uses a new encryption key for every encrypted backup. The backup encryption key is then encrypted with either the password, the database master key, or both, depending on the chosen encryption mode. Individual backup encryption keys or passwords are never stored in clear text.</p>
<p>A single restore operation can process backups encrypted in different modes. For each backup piece that it restores, RMAN checks whether it is encrypted. Transparently encrypted backups need no intervention if the Oracle wallet is open and available.</p>
<p>If password encryption is detected, then RMAN searches for a matching key in the list of passwords entered in the <code dir="ltr">SET DECRYPTION</code> command. If RMAN finds a usable key, then the restore operation proceeds. Otherwise, RMAN searches for a key in the Oracle wallet. If RMAN finds a usable key, then the restore operation proceeds; otherwise, RMAN signals an error that the backup piece cannot be decrypted.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If RMAN restores a set of backups created with different passwords, then all required passwords must be included with <code dir="ltr">SET</code> <code dir="ltr">DECRYPTION</code>.</div>
<p>RMAN encryption is a CPU-intensive operation and can affect backup performance. The actual amount of CPU utilization during encryption depends on whether both input and output devices for disk and SBT produce and consume data faster than the CPU can encrypt it. Here are a few guidelines for managing and trying to maximize CPU performance:</p>
<ul>
<li>
<p>Because encrypted backups consume more CPU resources than unencrypted backups, you can improve performance of encrypted backups to disk by using more RMAN channels. A general rule is to use the same number of channels as the number of CPU cores in your system. For example, use two channels for a dual-core processor.</p>
</li>
<li>
<p>If both the disk subsystem and SBT-subsystem are fast, you can expect very high CPU utilization. You may want to consider slowing the rate of the backup by setting the RMAN <code dir="ltr">READRATE</code> parameter. For example, you can set an upper limit for block reads so that RMAN does not consume excessive disk bandwidth and thereby degrade online performance.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmcomre.htm#CHDJBEHG">"Performing Complete Database Recovery"</a> to learn how to restore password-encrypted backups</p>
</li>
<li>
<p><a href="rcmreprt.htm#CHDIFGAE">"Determining the Encryption Status of Backup Pieces"</a></p>
</li>
<li>
<p><a class="olink RCMRF153" href="../../backup.112/e10643/rcmsynta2014.htm#RCMRF153"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code dir="ltr">ENCRYPTION</code> and <code dir="ltr">DECRYPTION</code> options of the <code dir="ltr">SET</code> command</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<div id="BRADV89574" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref972"></a>
<h3 class="sect2">Making Transparent-Mode Encrypted Backups</h3>
<p><a id="sthref973"></a><a id="sthref974"></a>If you have configured transparent encryption with the <code dir="ltr">CONFIGURE</code> command as explained in <a href="rcmconfa.htm#CHDEDGHA">"Configuring RMAN Backup Encryption Modes"</a>, then no additional commands are required to make encrypted backups. Make RMAN backups as normal.</p>
</div>
<!-- class="sect2" -->
<div id="BRADV89575" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref975"></a>
<h3 class="sect2">Making Password-Mode Encrypted Backups</h3>
<p><a id="sthref976"></a><a id="sthref977"></a>You can set an encryption password in an RMAN session by executing the <a class="olink RCMRF153" href="../../backup.112/e10643/rcmsynta2014.htm#RCMRF153"><code dir="ltr">SET ENCRYPTION BY PASSWORD</code></a> command. If transparent encryption is configured, then specify the <code dir="ltr">ONLY</code> keyword to indicate that the backups should be protected with a password and not with the configured transparent encryption.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Create a password that is secure. See <a class="olink DBSEG33223" href="../../network.112/e36292/authentication.htm#DBSEG33223"><span class="italic">Oracle Database Security Guide</span></a> for more information.</div>
<p class="subhead2"><a id="BRADV266"></a>To make password-mode encrypted backups:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>Execute the <code dir="ltr">SET ENCRYPTION ON IDENTIFIED BY</code> <code dir="ltr"><span class="codeinlineitalic">password</span></code> <code dir="ltr">ONLY</code> command.</p>
<p>The following example sets the encryption password for all tablespaces (where <span class="italic">password</span> is a placeholder for the actual password that you enter) in the backup and specifies <code dir="ltr">ONLY</code> to indicate that the encryption is password-only:</p>
<pre dir="ltr">
SET ENCRYPTION IDENTIFIED BY <span class="italic">password</span> ONLY ON FOR ALL TABLESPACES;
</pre></li>
<li>
<p>Back up the database.</p>
<p>For example, enter the following command:</p>
<pre dir="ltr">
BACKUP DATABASE PLUS ARCHIVELOG;
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<div id="BRADV89576" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref978"></a>
<h3 class="sect2">Making Dual-Mode Encrypted Backups</h3>
<p><a id="sthref979"></a><a id="sthref980"></a>Use the <a class="olink RCMRF153" href="../../backup.112/e10643/rcmsynta2014.htm#RCMRF153"><code dir="ltr">SET ENCRYPTION BY PASSWORD</code></a> command at the RMAN prompt to make password-protected backups. If transparent encryption is configured, then <span class="italic">omit</span> the <code dir="ltr">ONLY</code> keyword to indicate that the backups should be protected with a password and also with the configured transparent encryption.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Create a password that is secure. See <a class="olink DBSEG33223" href="../../network.112/e36292/authentication.htm#DBSEG33223"><span class="italic">Oracle Database Security Guide</span></a> for more information.</div>
<p class="subhead2"><a id="BRADV267"></a>To make dual-mode encrypted backups:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>Execute the <code dir="ltr">SET ENCRYPTION BY PASSWORD</code> command, making sure to omit the <code dir="ltr">ONLY</code> keyword.</p>
<p>The following example sets the encryption password for all tablespaces (where <span class="italic">password</span> is a placeholder for the actual password that you enter) in the backup and omits <code dir="ltr">ONLY</code> to indicate dual-mode encryption:</p>
<pre dir="ltr">
SET ENCRYPTION IDENTIFIED BY <span class="italic">password</span> ON FOR ALL TABLESPACES;
</pre></li>
<li>
<p>Back up the database.</p>
<p>For example, enter the following command:</p>
<pre dir="ltr">
BACKUP DATABASE PLUS ARCHIVELOG;
</pre></li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1009271"></a>
<div id="BRADV148" class="sect1">
<h2 class="sect1">Restarting RMAN Backups</h2>
<p>With the <a href="glossary.htm#CHDGJGGI"><span class="xrefglossterm">restartable backup</span></a> feature, RMAN backs up only those files that were not backed up after a specified date.</p>
<a id="i1008543"></a>
<div id="BRADV114" class="sect2">
<h3 class="sect2">About Restartable Backups</h3>
<p><a id="sthref981"></a><a id="sthref982"></a>The minimum unit of restartability is a data file. However, if a backup set contains one backup piece, and if this piece contains blocks from multiple data files, then the unit of restartability is the backup piece. The unit of restartability for image copies is a data file.</p>
<p>The benefit of restartable backups is that if the backup generates multiple backup sets, then the backup sets that completed successfully do not have to be rerun. However, if the entire database is written into one backup set, and if the backup fails halfway through, then the entire backup has to be restarted.</p>
<p>Any <a id="sthref983"></a><a id="sthref984"></a><a id="sthref985"></a>I/O errors that RMAN encounters when reading files or writing to the backup pieces or image copies cause RMAN to terminate the backup job in progress. For example, if RMAN tries to back up a data file but the data file is not on disk, then RMAN terminates the backup. If multiple channels are being used or redundant copies of backups are being created, however, then RMAN may be able to continue the backup without user intervention.</p>
<p>RMAN can back up only those files that have not been backed up since a specified date. Use this feature after a backup fails to back up the parts of the database missed by the failed backup.</p>
<p>You can restart a backup by specifying the <code dir="ltr">SINCE TIME</code> clause on the <a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><code dir="ltr">BACKUP</code></a> command. If the <code dir="ltr">SINCE</code> <code dir="ltr">TIME</code> is later than the completion time, then RMAN backs up the file. If you use <code dir="ltr">BACKUP DATABASE NOT BACKED UP</code> without the <code dir="ltr">SINCE</code> <code dir="ltr">TIME</code> parameter, then RMAN only backs up files that have never been backed up.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">BACKUP ... NOT BACKED UP</code> syntax</div>
</div>
<!-- class="sect2" -->
<a id="i1006344"></a>
<div id="BRADV89577" class="sect2">
<h3 class="sect2">Restarting a Backup After It Partially Completes</h3>
<p>Use the <code dir="ltr">SINCE</code> <code dir="ltr">TIME</code> parameter of the <code dir="ltr">BACKUP</code> command to specify a date after which a new backup is required. If the <code dir="ltr">SINCE</code> <code dir="ltr">TIME</code> is later than the completion time, then RMAN backs up the file. If you use <code dir="ltr">BACKUP DATABASE NOT BACKED UP</code> without the <code dir="ltr">SINCE</code> <code dir="ltr">TIME</code> parameter, then RMAN only backs up files that have never been backed up.</p>
<p class="subhead2"><a id="BRADV268"></a>To only back up files that were not backed up after a specified date:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>Execute the <code dir="ltr">BACKUP ... NOT BACKED UP SINCE TIME</code> command.</p>
<p>Specify a valid date in the <code dir="ltr">SINCE</code> <code dir="ltr">TIME</code> parameter. The following example uses the default configured channel to back up all database files and archived redo logs that have not been backed up in the last two weeks:</p>
<pre dir="ltr">
BACKUP 
  NOT BACKED UP SINCE TIME 'SYSDATE-14'
  DATABASE PLUS ARCHIVELOG;
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for an example of how to use the <code dir="ltr">BACKUP</code> command to restart a backup that did not complete</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDEBGAA"></a>
<div id="BRADV301" class="sect1">
<h2 class="sect1">Managing Backup Windows</h2>
<p>This section explains how to use backup windows to set limits for the time span in which a backup job can complete.</p>
<div id="BRADV89578" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref986"></a>
<h3 class="sect2">About Backup Windows</h3>
<p><a id="sthref987"></a>A <a href="glossary.htm#CHDBHIBF"><span class="xrefglossterm">backup window</span></a> is a period of time during which a backup must complete. For example, you may want to restrict your database backups to a window of time when user activity on your system is low, such as between 2:00 a.m. and 6:00 a.m.</p>
<p>RMAN backs up the least recently backed up files first. By default, RMAN backs up the files at the maximum possible speed. Specifying a window does not mean that RMAN backs up data faster than normal to ensure that the backup completes before the window ends.</p>
<p>By default, if the backup is not complete within the <code dir="ltr">DURATION</code> time, then RMAN interrupts the backup and reports an error. If the <code dir="ltr">BACKUP</code> command is in a <a class="olink RCMRF151" href="../../backup.112/e10643/rcmsynta2012.htm#RCMRF151"><code dir="ltr">RUN</code></a> command, then the <code dir="ltr">RUN</code> command terminates. Any completed backup sets are retained and can be used in restore operations, even if the entire backup is not complete. Thus, if you retry a job that was interrupted when the available duration expired, each successive attempt covers more of the files needing backup. Any incomplete backup sets are discarded.</p>
</div>
<!-- class="sect2" -->
<div id="BRADV89579" class="sect2"><a id="sthref988"></a>
<h3 class="sect2">Specifying a Backup Duration</h3>
<p>Use the <code dir="ltr">DURATION</code> parameter of the <a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><code dir="ltr">BACKUP</code></a> command to specify how long a given backup job is allowed to run.</p>
<p class="subhead2"><a id="BRADV269"></a>To specify a backup duration:</p>
<ol>
<li>
<p><a id="sthref989"></a><a id="sthref990"></a>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>Execute the <code dir="ltr">BACKUP DURATION</code> command.</p>
<p>For example, run the following command at 2:00 a.m. to specify that the backup should run until 6:00 a.m.:</p>
<pre dir="ltr">
BACKUP 
  DURATION 4:00 
  TABLESPACE users;
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for the syntax of the <code dir="ltr">BACKUP</code> command</div>
</div>
<!-- class="sect2" -->
<div id="BRADV89580" class="sect2"><a id="sthref991"></a>
<h3 class="sect2">Permitting Partial Backups in a Backup Window</h3>
<p>When you specify <code dir="ltr">PARTIAL</code>, RMAN does not report an error when a backup is interrupted because of the end of the backup window. Instead, RMAN displays a message showing which files are not backed up. If the <code dir="ltr">BACKUP</code> command is part of a <code dir="ltr">RUN</code> block, then the remaining commands in the <code dir="ltr">RUN</code> block continue to execute.</p>
<p>If you specify <code dir="ltr">FILESPERSET 1</code>, then RMAN puts each file into its own backup set. When a backup is interrupted at the end of the backup window, only the backup of the file currently being backed up is lost. All backup sets completed during the window are saved, minimizing the lost work caused by the end of the backup window.</p>
<p class="subhead2"><a id="BRADV270"></a>To prevent RMAN from issuing an error when a backup partially completes:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>Execute the <a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><code dir="ltr">BACKUP DURATION</code></a> command with the <code dir="ltr">PARTIAL</code> option.</p>
<p>For example, you run the following command at 2:00 a.m. to specify that the backup should run until 6:00 a.m. and that each data file should be in a separate backup set:</p>
<pre dir="ltr">
BACKUP 
  DURATION 4:00 PARTIAL 
  TABLESPACE users 
  FILESPERSET 1;
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<div id="BRADV89581" class="sect2"><a id="sthref992"></a>
<h3 class="sect2">Minimizing Backup Load and Duration</h3>
<p>When using <code dir="ltr">DURATION</code> you can run the backup with the maximum possible performance, or run as slowly as possible while still finishing within the allotted time, to minimize the performance impact of backup tasks. To maximize performance, use the <code dir="ltr">MINIMIZE TIME</code> option with <code dir="ltr">DURATION</code>, as shown in <a href="#CIHIHEHB">Example 10-4</a>.</p>
<div id="BRADV271" class="example">
<p class="titleinexample"><a id="CIHIHEHB"></a>Example 10-4 Using MINIMIZE TIME with BACKUP DURATION</p>
<pre dir="ltr">
BACKUP 
  DURATION 4:00 PARTIAL 
  MINIMIZE TIME 
  DATABASE 
  FILESPERSET 1;
</pre></div>
<!-- class="example" -->
<p>To extend the backup to use the full time available, use the <code dir="ltr">MINIMIZE LOAD</code> option, as in <a href="#CHDBGBHG">Example 10-5</a>.</p>
<div id="BRADV272" class="example">
<p class="titleinexample"><a id="CHDBGBHG"></a>Example 10-5 Using MINIMIZE LOAD with BACKUP DURATION</p>
<pre dir="ltr">
BACKUP 
  DURATION 4:00 PARTIAL 
  MINIMIZE LOAD 
  DATABASE 
  FILESPERSET 1;
</pre></div>
<!-- class="example" -->
<p>In <a href="#CHDBGBHG">Example 10-5</a>, RMAN monitors the progress of the running backup, and periodically estimates how long the backup takes to complete at its present rate. If RMAN estimates that the backup will finish before the end of the backup window, then it slows down the rate of backup so that the full available duration is used. This reduces the overhead on the database associated with the backup.</p>
<p>Note these issues when using <code dir="ltr">DURATION</code> and <code dir="ltr">MINIMIZE LOAD</code> with a tape backup:</p>
<ul>
<li>
<p>Efficient backup to tape requires tape streaming. If you use <code dir="ltr">MINIMIZE LOAD</code>, then RMAN may reduce the rate of backup to the point where tape streaming is not optimal.</p>
</li>
<li>
<p>RMAN holds the tape resource for the entire duration of the backup window. This prevents the use of the tape resource for any other purpose during the backup window.</p>
</li>
</ul>
<p>Because of these concerns, it is not recommended that you use <code dir="ltr">MINIMIZE LOAD</code> when backing up to tape.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmtunin.htm#i1006228">"Media Manager Component of the Write Phase for SBT"</a> for more details on efficient tape handling</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1933">
<tr>
<td class="cellalignment1942">
<table class="cellalignment1938">
<tr>
<td class="cellalignment1937"><a href="rcmbckba.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1937"><a href="part_mai.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1944">
<table class="cellalignment1936">
<tr>
<td class="cellalignment1937"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1937"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1937"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1937"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1937"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1937"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
