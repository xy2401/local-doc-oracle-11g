<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>RMAN Backup Concepts</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1054" />
<meta name="description" content="A guide to backup and recovery of Oracle databases, including RMAN backup and recovery, RMAN data transfer, Oracle Flashback Technology, and user-managed backup and recovery" />
<meta name="dcterms.created" content="2015-05-13T14:1:10Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Backup and Recovery User's Guide" />
<meta name="dcterms.identifier" content="E10642-08" />
<meta name="dcterms.isVersionOf" content="BRADV" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="part_bak.htm" title="Previous" type="text/html" />
<link rel="Next" href="rcmbckba.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10642.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">18/47</span> <!-- End Header -->
<div id="BRADV002" class="chapter"><a id="BGBFHAGF"></a> <a id="i1006083"></a>
<h1 class="chapter"><span class="secnum">8</span> RMAN Backup Concepts</h1>
<p>This chapter describes the general concepts that you must understand to make any type of RMAN backup. This chapter contains the following topics:</p>
<ul>
<li>
<p><a href="#BABIHBBE">Consistent and Inconsistent RMAN Backups</a></p>
</li>
<li>
<p><a href="#i1008641">Online Backups and Backup Mode</a></p>
</li>
<li>
<p><a href="#i1013399">Backup Sets</a></p>
</li>
<li>
<p><a href="#i1006661">Image Copies</a></p>
</li>
<li>
<p><a href="#i1025065">Multiple Copies of RMAN Backups</a></p>
</li>
<li>
<p><a href="#i1016424">Control File and Server Parameter File Autobackups</a></p>
</li>
<li>
<p><a href="#i1007616">Incremental Backups</a></p>
</li>
<li>
<p><a href="#i1008093">Backup Retention Policies</a></p>
</li>
</ul>
<a id="BABIHBBE"></a>
<div id="BRADV89477" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Consistent and Inconsistent RMAN Backups</h2>
<p><a id="sthref590"></a><a id="sthref591"></a><a id="sthref592"></a>The RMAN command for making backups is <a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><code dir="ltr">BACKUP</code></a>. The RMAN <code dir="ltr">BACKUP</code> command supports backing up the following types of files:</p>
<ul>
<li>
<p>Datafiles and control files</p>
</li>
<li>
<p>Server parameter file</p>
</li>
<li>
<p>Archived redo logs</p>
</li>
<li>
<p>RMAN backups</p>
</li>
</ul>
<p>Although the database depends on other types of files, such as network configuration files, password files, and the contents of the Oracle home, you cannot back up these files with RMAN. Likewise, some features of Oracle Database, such as external tables, may depend upon files other than the datafiles, control files, and redo log. RMAN cannot back up these files. Use some non-RMAN backup solution for any files not in the preceding list.</p>
<p>When you execute the <code dir="ltr">BACKUP</code> command in RMAN, the output is always either one or more backup sets or one or more image copies. A <a id="sthref593"></a><a href="glossary.htm#i432144"><span class="xrefglossterm">backup set</span></a> is an RMAN-specific proprietary format, whereas an <a id="sthref594"></a><a href="glossary.htm#i432704"><span class="xrefglossterm">image copy</span></a> is a bit-for-bit copy of a file. By default, RMAN creates backup sets.</p>
<div id="BRADV99964" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref595"></a>
<h3 class="sect2">Consistent Backups</h3>
<p><a id="sthref596"></a><a id="sthref597"></a><a id="sthref598"></a><a id="sthref599"></a>You can use the <a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><code dir="ltr">BACKUP</code></a> command to make consistent and inconsistent backups of the database. A <a id="sthref600"></a><a href="glossary.htm#i432345"><span class="xrefglossterm">consistent backup</span></a> occurs when the database is in a consistent state. A database is in a consistent state after being shut down with the <a class="olink RCMRF155" href="../../backup.112/e10643/rcmsynta2016.htm#RCMRF155"><code dir="ltr">SHUTDOWN</code></a> <code dir="ltr">NORMAL</code>, <code dir="ltr">SHUTDOWN IMMEDIATE</code>, or <code dir="ltr">SHUTDOWN TRANSACTIONAL</code> commands. A consistent shutdown guarantees that all redo has been applied to the datafiles. If you mount the database and make a backup at this point, then you can restore the database backup later and open it without performing media recovery.</p>
</div>
<!-- class="sect2" -->
<div id="BRADV99965" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref601"></a>
<h3 class="sect2">Inconsistent Backups</h3>
<p>Any database backup that is not consistent is an <a id="sthref602"></a><a href="glossary.htm#i432767"><span class="xrefglossterm">inconsistent backup</span></a>. A backup made when the database is open is inconsistent, as is a backup made after an instance failure or <code dir="ltr">SHUTDOWN ABORT</code> command. When a database is restored from an inconsistent backup, Oracle Database must perform media recovery before the database can be opened, applying any pending changes from the redo logs.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
RMAN does not permit you to make inconsistent backups when the database is in <code dir="ltr">NOARCHIVELOG</code> mode. If you employ user-managed backup techniques for a <code dir="ltr">NOARCHIVELOG</code> database, then you must not make inconsistent backups of this database.</div>
<p>If the database runs in <code dir="ltr">ARCHIVELOG</code> mode, and you back up the archived redo logs and datafiles, inconsistent backups can be the foundation for a sound backup and recovery strategy. Inconsistent backups offer superior availability because you do not have to shut down the database to make backups that fully protect the database.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1008641"></a>
<div id="BRADV89479" class="sect1">
<h2 class="sect1">Online Backups and Backup Mode<a id="sthref603"></a><a id="sthref604"></a></h2>
<p>When performing a <a id="sthref605"></a><a href="glossary.htm#i433687"><span class="xrefglossterm">user-managed backup</span></a> of an online tablespace or database, an operating system utility can back up a data file at the same time that the database writer (DBWR) is updating the file. It is possible for the utility to read a block in a half-updated state, so that the block that is copied to the backup media is updated in its first half, while the second half contains older data. This type of <a href="glossary.htm#CHDFJGFF"><span class="xrefglossterm">logical corruption</span></a> is known as a <a id="sthref606"></a><a href="glossary.htm#CHDBFCBF"><span class="xrefglossterm">fractured block</span></a>, that is, a block that is not consistent with an SCN. If this backup must be restored later, and if the block requires recovery, then recovery fails because the block is not usable.</p>
<p>When performing a user-managed online backup, you must place your datafiles into <a id="sthref607"></a><a href="glossary.htm#i432099"><span class="xrefglossterm">backup mode</span></a> with the <a class="olink SQLRF00802" href="../../server.112/e41084/statements_1004.htm#SQLRF00802"><code dir="ltr">ALTER DATABASE</code></a> or <a class="olink SQLRF01002" href="../../server.112/e41084/statements_3002.htm#SQLRF01002"><code dir="ltr">ALTER TABLESPACE</code></a> statement with the <code dir="ltr">BEGIN BACKUP</code> clause. When a tablespace is in backup mode, the database writes the before image for an entire block to the redo stream before modifying a block. The database also records changes to the block in the online redo log. Backup mode also freezes the <a href="glossary.htm#CHDGHFDF"><span class="xrefglossterm">data file checkpoint</span></a> until the file is removed from backup mode. Oracle Database performs this safeguard because it cannot guarantee that a third-party backup tool copies the file header before copying the data blocks.</p>
<p>Unlike user-managed tools, RMAN does not require extra logging or backup mode because it knows the format of data blocks. RMAN is guaranteed not to back up fractured blocks. During an RMAN backup, a database server session reads each data block and checks whether it is fractured by comparing the block header and footer. If a block is fractured, then the session rereads the block. If the same fracture is found, then the block is considered permanently corrupt. Also, RMAN does not need to freeze the data file header checkpoint because it knows the order in which the blocks are read, which enables it to capture a known good checkpoint for the file.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="osbackup.htm#i1006287">"Making User-Managed Backups of Online Tablespaces and Data Files"</a> to learn how to back up online tablespaces when not using RMAN</div>
</div>
<!-- class="sect1" -->
<a id="i1013399"></a>
<div id="BRADV106" class="sect1">
<h2 class="sect1">Backup Sets</h2>
<p><a id="sthref608"></a><a id="sthref609"></a>When you execute the <a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><code dir="ltr">BACKUP</code></a> command in RMAN, you create one or more backup sets or image copies. By default, RMAN creates <a id="sthref610"></a>backup sets regardless of whether the destination is disk or a media manager.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Data file backup sets are typically smaller than data file image copies and take less time to write.</div>
<p>This section contains the following topics:</p>
<ul>
<li>
<p><a href="#BABDJDHH">Backup Sets and Backup Pieces</a></p>
</li>
<li>
<p><a href="#BABIDCCI">Block Compression for Backup Sets</a></p>
</li>
<li>
<p><a href="#CIHFEBFI">Binary Compression for Backup Sets</a></p>
</li>
<li>
<p><a href="#CIHBAHBG">Backup Undo</a></p>
</li>
<li>
<p><a href="#BABBICIF">Encryption for Backup Sets</a></p>
</li>
<li>
<p><a href="#BABJBCBA">Filenames for Backup Pieces</a></p>
</li>
<li>
<p><a href="#i1016352">Number and Size of Backup Pieces</a></p>
</li>
<li>
<p><a href="#i1007529">Number and Size of Backup Sets</a></p>
</li>
<li>
<p><a href="#i1015964">Multiplexed Backup Sets</a></p>
</li>
<li>
<p><a href="#i1006727">Proxy Copies</a></p>
</li>
</ul>
<a id="BABDJDHH"></a>
<div id="BRADV89480" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Backup Sets and Backup Pieces</h3>
<p>RMAN can store backup data in a logical structure called a <a href="glossary.htm#i432144"><span class="xrefglossterm">backup set</span></a>, which is the smallest unit of an RMAN backup. A backup set contains the data from one or more datafiles, archived redo logs, control files, or server parameter file. Backup sets, which are only created and accessed through RMAN, are the only form in which RMAN can write backups to media managers such as tape drives and tape libraries.</p>
<p>A backup set contains one or more binary files in an RMAN-specific format. Each of these files is known as a <a id="sthref611"></a><a href="glossary.htm#i432114"><span class="xrefglossterm">backup piece</span></a>. A backup set can contain multiple datafiles. For example, you can back up 10 datafiles into a single backup set consisting of a single backup piece. In this case, RMAN creates one backup piece as output. The backup set contains only this backup piece.</p>
<p><a id="sthref612"></a><a id="sthref613"></a>If you specify the <code dir="ltr">SECTION SIZE</code> parameter on the <code dir="ltr">BACKUP</code> command, then RMAN produces a <a id="sthref614"></a><a id="sthref615"></a><a href="glossary.htm#BGBCJCBC"><span class="xrefglossterm">multisection backup</span></a>. This is a backup of a single large file, produced by multiple channels in parallel, each of which produces one backup piece. Each backup piece contains one <a href="glossary.htm#CHDHHBFC"><span class="xrefglossterm">file section</span></a> of the file being backed up.</p>
<p>For non-multisection backups, RMAN only records backup sets in the repository that complete successfully. There is no such thing as a partial backup set. This differs from an unsuccessful multisection backup, where it is possible for RMAN metadata to contain a record for a partial backup set. In the latter case, you must use the <code dir="ltr">DELETE</code> command to delete the partial backup set.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
RMAN never considers partial backups as candidates for restore and recovery.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmbckba.htm#g1050005">Chapter 9, "Backing Up the Database"</a></div>
</div>
<!-- class="sect2" -->
<a id="BABIDCCI"></a>
<div id="BRADV89481" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Block Compression for Backup Sets</h3>
<p>RMAN uses two types of block compression when creating backup sets:</p>
<ul>
<li>
<p>Unused Block Compression (Supports disk backup and Oracle Secure Backup tape backup)</p>
</li>
<li>
<p>Null Block Compression (Supports all backups)</p>
</li>
</ul>
<p>Although it is referred to as block compression, it might be helpful to think of block compression as <span class="italic">block skipping</span>. Rather than compressing the data in the blocks, RMAN completely eliminates the blocks from the backup. RMAN reads blocks from a data file and writes them to a backup set. If unused block compression is enabled, RMAN reads only those blocks of the data file in an extent that currently belongs to a database segment. Unused block compression can only be employed when backing up tablespaces whose space is locally managed. When not employing unused block compression, RMAN reads every block of the data file. Before RMAN writes a block to the backup set, it applies the null block test, and if the block has never been used, it does not write that block to the backup set.</p>
<div id="BRADV193" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref616"></a>
<h4 class="sect3">Unused Block Compression</h4>
<p>During <a href="glossary.htm#i432341"><span class="xrefglossterm">unused block compression</span></a>, RMAN does not check each block. Instead, RMAN reads the bitmaps that indicate what blocks are currently allocated and then only reads the blocks that are currently allocated.</p>
<p>Unused block compression is turned on automatically when all of the following five conditions are true:</p>
<ul>
<li>
<p>The <code dir="ltr">COMPATIBLE</code> initialization parameter is set to 10.2 or higher.</p>
</li>
<li>
<p>There are currently no guaranteed restore points defined for the database.</p>
</li>
<li>
<p>The data file is locally managed.</p>
</li>
<li>
<p>The data file is being backed up to a backup set as part of a full backup or a level 0 incremental backup.</p>
</li>
<li>
<p>The backup set is created on disk, or Oracle Secure Backup is the media manager.</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<div id="BRADV192" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref617"></a>
<h4 class="sect3">Null Block Compression</h4>
<p>During null block compression, RMAN checks every block to see if it has ever contained data. Blocks that have never contained data are not backed up. Blocks that have contained data, either currently or in the past, are backed up.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CIHFEBFI"></a>
<div id="BRADV194" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Binary Compression for Backup Sets</h3>
<p>RMAN supports <a href="glossary.htm#CHDEEEDG"><span class="xrefglossterm">binary compression</span></a> of backup sets. Binary compression is only enabled when you specify <code dir="ltr">AS COMPRESSED BACKUPSET</code> in the <code dir="ltr">BACKUP</code> command, or one-time with the <code dir="ltr">CONFIGURE DEVICE TYPE &lt;DISK | SBT&gt; BACKUP TYPE TO COMPRESSED BACKUPSET</code> command.You have two binary compression options:</p>
<ul>
<li>
<p>You can use the <code dir="ltr">BASIC</code> compression algorithm, which does not require the Advanced Compression Option. This setting offers a compression ratio comparable to <code dir="ltr">MEDIUM</code>, at the expense of additional CPU consumption.</p>
</li>
<li>
<p>If you have enabled the Oracle Database 11<span class="italic">g</span> Release 2 Advanced Compression Option, you can choose from the compression levels outlined in <a href="rcmconfa.htm#BGBJHFBI">"Advanced Compression Option"</a>.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmconfa.htm#CHDEHCEB">"Configuring Compression Options"</a></p>
</li>
<li>
<p><a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about <code dir="ltr">BACKUP AS BACKUPSET</code> and <code dir="ltr">CONFIGURE COMPRESSION ALGORITHM</code></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CIHBAHBG"></a>
<div id="BRADV195" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Backup Undo</h3>
<p><a id="sthref618"></a>In <a href="glossary.htm#CHDDCIAB"><span class="xrefglossterm">backup undo optimization</span></a>, RMAN excludes undo not needed for recovery of a backup, that is, for transactions that have been committed. Backup undo optimization works for level 0 and full disk backups and Oracle Secure Backup (OSB) tape backups. Unlike <a href="glossary.htm#CHDBBJCB"><span class="xrefglossterm">backup optimization</span></a>, backup undo optimization is not configurable.</p>
</div>
<!-- class="sect2" -->
<a id="BABBICIF"></a>
<div id="BRADV89482" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Encryption for Backup Sets</h3>
<p>RMAN supports <a id="sthref619"></a><a href="glossary.htm#CHDJDIEJ"><span class="xrefglossterm">backup encryption</span></a> for backup sets. You can use wallet-based transparent encryption, password-based encryption, or both. You can use the <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><code dir="ltr">CONFIGURE ENCRYPTION</code></a> command to configure persistent transparent encryption. Use the <a class="olink RCMRF153" href="../../backup.112/e10643/rcmsynta2014.htm#RCMRF153"><code dir="ltr">SET ENCRYPTION</code></a> command at the <a href="glossary.htm#CHDHHCJB"><span class="xrefglossterm">RMAN session</span></a> level to specify password-based encryption.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Wallet-based encryption is more secure than password-based encryption because no passwords are involved. You should use password-based encryption only when it is absolutely necessary because your backups must be transportable.</div>
<p>To create encrypted backups on disk with RMAN, the database must use the <a id="sthref620"></a>Advanced Security Option. For encrypted RMAN backups directly to tape, the <a href="glossary.htm#CHDDFGEB"><span class="xrefglossterm">Oracle Secure Backup</span></a> <a href="glossary.htm#CHDCCBFI"><span class="xrefglossterm">SBT</span></a> is the only supported interface.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmconfa.htm#CHDEDDBE">"Configuring Backup Encryption"</a></p>
</li>
<li>
<p><a href="rcmbckad.htm#CEGEJABH">"Encrypting RMAN Backups"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABJBCBA"></a>
<div id="BRADV89483" class="sect2">
<h3 class="sect2">Filenames for Backup Pieces</h3>
<p><a id="sthref621"></a><a id="sthref622"></a><a id="sthref623"></a>You can either let RMAN determine a unique name for <a id="sthref624"></a>backup pieces or use the <a class="olink RCMRF195" href="../../backup.112/e10643/rcmsubcl010.htm#RCMRF195"><code dir="ltr">FORMAT</code></a> clause to specify a name. If you do not specify the <code dir="ltr">FORMAT</code> parameter, then RMAN automatically generates a unique file name with the <code dir="ltr">%U</code> <a id="sthref625"></a>substitution variable in the default backup location.</p>
<p>An example of RMAN generating an SBT backup piece name by <code dir="ltr">%U</code> is:</p>
<pre dir="ltr">
2i1nk47_1_1
</pre>
<p>An example of a non- Oracle Managed File (OMF) backup piece on disk is:</p>
<pre dir="ltr">
/backups/TEST/2i1nk47_1_1
</pre>
<p>The <code dir="ltr">FORMAT</code> clause supports substitution variables other than <code dir="ltr">%U</code> for generating unique file names. For example, you can use <code dir="ltr">%d</code> to generate the name of the database, <code dir="ltr">%I</code> for the DBID, <code dir="ltr">%t</code> for the time stamp, and so on.</p>
<p>You can specify up to four <code dir="ltr">FORMAT</code> parameters. If you specify multiple <code dir="ltr">FORMAT</code> parameters, then RMAN uses the multiple <code dir="ltr">FORMAT</code> parameters only when you specify multiple copies. You can create multiple copies by using the <code dir="ltr">BACKUP ...</code> <code dir="ltr">COPIES</code>, <a class="olink RCMRF153" href="../../backup.112/e10643/rcmsynta2014.htm#RCMRF153"><code dir="ltr">SET BACKUP COPIES</code></a>, or <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><code dir="ltr">CONFIGURE ... BACKUP COPIES</code></a> commands.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you use a media manager, then check your vendor documentation for restrictions on <code dir="ltr">FORMAT</code>, such as the size of the name, the naming conventions, and so on.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmbckba.htm#CEGBCICH">"Specifying a Format for RMAN Backups"</a></p>
</li>
<li>
<p><a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for descriptions of the <code dir="ltr">FORMAT</code> clause and the substitution variables</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i1016352"></a>
<div id="BRADV89484" class="sect2">
<h3 class="sect2">Number and Size of Backup Pieces<a id="sthref626"></a><a id="sthref627"></a></h3>
<p>By default a backup set contains one backup piece. To restrict the size of each backup piece, specify the <code dir="ltr">MAXPIECESIZE</code> option of the <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><code dir="ltr">CONFIGURE CHANNEL</code></a> or <a class="olink RCMRF102" href="../../backup.112/e10643/rcmsynta004.htm#RCMRF102"><code dir="ltr">ALLOCATE CHANNEL</code></a> commands. This option limits backup piece size to the specified number of bytes. If the total size of the backup set is greater than the specified backup piece size, then RMAN creates multiple physical pieces to hold the backup set contents.</p>
<p>You can use this option for media managers that cannot manage a backup piece that spans multiple tapes. For example, if a tape can hold 10 GB, but the backup set being created must hold 80 GB of data, then you must instruct RMAN to create backup pieces of 10 GB, small enough to fit on the tapes used with the media manager. In this case, the backup set media consists of eight tapes. Media managers supporting SBT 2.0 can return a value to RMAN indicating the largest supported backup piece size, which RMAN uses in planning backup activities.</p>
<p>If you specify the <code dir="ltr">SECTION SIZE</code> parameter on the <code dir="ltr">BACKUP</code> command, then RMAN can create a <a id="sthref628"></a><a href="glossary.htm#BGBCJCBC"><span class="xrefglossterm">multisection backup</span></a>. In this case, a single backup set can contain multiple backup pieces, each containing a <a id="sthref629"></a><a href="glossary.htm#CHDHHBFC"><span class="xrefglossterm">file section</span></a>. The purpose of multisection backups is to enable multiple channels to back up a large file in parallel.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmconfa.htm#CEGGJJBD">"Configuring the Maximum Size of Backup Pieces"</a></p>
</li>
<li>
<p><a class="olink RCMRF102" href="../../backup.112/e10643/rcmsynta004.htm#RCMRF102"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">ALLOCATE</code> <code dir="ltr">CHANNEL</code> syntax</p>
</li>
<li>
<p><a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">CONFIGURE</code> syntax</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i1007529"></a>
<div id="BRADV89485" class="sect2">
<h3 class="sect2">Number and Size of Backup Sets</h3>
<p><a id="sthref630"></a><a id="sthref631"></a><a id="sthref632"></a>You use the <a class="olink RCMRF204" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=RCMRF204"><code dir="ltr"><span class="codeinlineitalic">backupSpec</span></code></a> clause of the <code dir="ltr">BACKUP</code> command to specify the objects to be backed up. Each <code dir="ltr"><span class="codeinlineitalic">backupSpec</span></code> clause produces at least one backup set.</p>
<p>The total number and size of backup sets depends mostly on an internal RMAN algorithm. However, you can influence RMAN behavior with the <code dir="ltr">MAXSETSIZE</code> parameter in the <code dir="ltr">CONFIGURE</code> or <code dir="ltr">BACKUP</code> command. By limiting the size of the backup set, the parameter indirectly limits the number of files in the set and can possibly force RMAN to create additional backup sets. Also, you can specify <code dir="ltr">BACKUP ... FILESPERSET</code> to specify the maximum number of files in each backup set.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmbckad.htm#CEGCEGBC">"About Backup Set Size"</a></p>
</li>
<li>
<p><a href="rcmtunin.htm#CACJCBDB">Chapter 22, "Tuning RMAN Performance"</a> to learn about RMAN buffer management</p>
</li>
<li>
<p><a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn the syntax for the <code dir="ltr"><span class="codeinlineitalic">backupSpec</span></code> clause</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i1015964"></a>
<div id="BRADV89486" class="sect2">
<h3 class="sect2">Multiplexed Backup Sets</h3>
<p><a id="sthref633"></a><a id="sthref634"></a>When creating backup sets, RMAN can simultaneously read multiple files from disk and then write their blocks into the same backup set. For example, RMAN can read from two datafiles simultaneously, and then combine the blocks from these datafiles into a single backup piece. The combination of blocks from multiple files is called backup <a href="glossary.htm#i999499"><span class="xrefglossterm">multiplexing</span></a>. Image copies, by contrast, are never multiplexed.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If RMAN creates a <a id="sthref635"></a><a href="glossary.htm#BGBCJCBC"><span class="xrefglossterm">multisection backup</span></a> of a data file, then the data file is not multiplexed with any other data file or <a id="sthref636"></a><a href="glossary.htm#CHDHHBFC"><span class="xrefglossterm">file section</span></a>.</div>
<p>As <a href="#i1018026">Figure 8-1</a> illustrates, RMAN can back up three datafiles into a backup set that contains only one backup piece. This backup piece contains the intermingled data blocks of the three input datafiles.</p>
<div id="BRADV196" class="figure">
<p class="titleinfigure"><a id="i1018026"></a>Figure 8-1 Data File Multiplexing</p>
<img width="496" height="316" src="img/bradv022.gif" alt="Description of Figure 8-1 follows" /><br />
<a id="sthref637" href="img_text/bradv022.htm">Description of "Figure 8-1 Data File Multiplexing"</a><br />
<br /></div>
<!-- class="figure" -->
<p>RMAN multiplexing is determined by several factors. For example, <a id="sthref638"></a><a id="sthref639"></a>the <code dir="ltr">FILESPERSET</code> parameter of the <code dir="ltr">BACKUP</code> command determines how many datafiles to put in each backup set. The <code dir="ltr">MAXOPENFILES</code> parameter of <code dir="ltr">ALLOCATE CHANNEL</code> or <code dir="ltr">CONFIGURE CHANNEL</code> defines how many datafiles RMAN can read from simultaneously. The basic multiplexing algorithm is as follows:</p>
<ul>
<li>
<p>Number of files in each backup set</p>
<p>This number is the minimum of the <code dir="ltr">FILESPERSET</code> setting and the number of files read by each channel. The <code dir="ltr">FILESPERSET</code> default is 64.</p>
</li>
<li>
<p>The <a href="glossary.htm#CHDFBDDG"><span class="xrefglossterm">level of multiplexing</span></a></p>
<p>This is the number of input files simultaneously read and then written into the same backup piece. The level of multiplexing is the minimum of <code dir="ltr">MAXOPENFILES</code> and the number of files in each backup set. The <code dir="ltr">MAXOPENFILES</code> default is 8.</p>
</li>
</ul>
<p>Suppose that you back up 12 datafiles with one channel when <code dir="ltr">FILEPERSET</code> is set to 4. The level of multiplexing is the lesser of this number and 8. Thus, the channel simultaneously writes blocks from 4 datafiles into each backup piece.</p>
<p>Now suppose that you back up 50 datafiles with one channel. The number of files in each backup set is 50. The level of multiplexing is the lesser of this number and 8. Thus, the channel simultaneously writes blocks from 8 datafiles into each backup piece.</p>
<p>RMAN multiplexing of backup sets is different from <a id="sthref640"></a><a href="glossary.htm#CHDCCBJI"><span class="xrefglossterm">media manager multiplexing</span></a>. One type of media manager multiplexing occurs when the media manager writes the concurrent output from multiple RMAN channels to a single sequential device. Another type occurs when a backup mixes database files and non-database files on the same tape.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
Oracle recommends that you never use media manager multiplexing for RMAN backups.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmtunin.htm#BABDCIHI">"Allocation of Input Disk Buffers"</a> to learn how multiplexing affects allocation of disk buffers during backups</p>
</li>
<li>
<p><a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">BACKUP</code> syntax</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i1006727"></a>
<div id="BRADV89487" class="sect2">
<h3 class="sect2">Proxy Copies</h3>
<p>During a <a id="sthref641"></a><a href="glossary.htm#i433233"><span class="xrefglossterm">proxy copy</span></a>, RMAN turns over control of the data transfer to a media manager that supports this feature. Proxy copy can only be used with media managers that support it and cannot be used with channels of type <code dir="ltr">DISK</code>. The <code dir="ltr">PROXY</code> option of<a id="sthref642"></a><a id="sthref643"></a> the <code dir="ltr">BACKUP</code> command specifies that a backup should be a proxy copy.</p>
<p>For each file that you attempt to back up with the <a id="sthref644"></a><a id="sthref645"></a><a id="sthref646"></a><a id="sthref647"></a><code dir="ltr">BACKUP</code> <code dir="ltr">PROXY</code> command, RMAN queries the media manager to determine whether it can perform a proxy copy. If the media manager cannot proxy copy the file, then RMAN backs up the file as if the <code dir="ltr">PROXY</code> option had not been used. (Use the <a id="sthref648"></a><a id="sthref649"></a><a id="sthref650"></a><code dir="ltr">PROXY</code> <code dir="ltr">ONLY</code> option to force RMAN to fail if a proxy copy cannot be performed.)</p>
<p>Control files are never backed up with proxy copy. If the <code dir="ltr">PROXY</code> option is specified on an operation backing up a control file, then it is silently ignored for the purposes of backing up the control file.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink REFRN" href="../../server.112/e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a> for more information about the views <code dir="ltr"><a id="sthref651"></a>V$PROXY_DATAFILE</code> and <code dir="ltr"><a id="sthref652"></a>V$PROXY_ARCHIVEDLOG</code></p>
</li>
<li>
<p><a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for the <code dir="ltr">BACKUP</code> command and the <code dir="ltr">PROXY</code> option</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006661"></a>
<div id="BRADV89488" class="sect1">
<h2 class="sect1">Image Copies<a id="sthref653"></a></h2>
<p><a id="sthref654"></a><a id="sthref655"></a><a id="sthref656"></a><a id="sthref657"></a>An <a id="sthref658"></a><a href="glossary.htm#i432704"><span class="xrefglossterm">image copy</span></a> is an exact copy of a single data file, archived redo log file, or control file. Image copies are not stored in an RMAN-specific format. They are identical to the results of copying a file with operating system commands. RMAN can use image copies during RMAN restore and recover operations, and you can also use image copies with non-RMAN restore and recovery techniques.</p>
<a id="i1016861"></a>
<div id="BRADV89489" class="sect2">
<h3 class="sect2">RMAN-Created Image Copies</h3>
<p>To create image copies and have them recorded in the RMAN repository, you run the <a id="sthref659"></a><a id="sthref660"></a><a id="sthref661"></a>RMAN <code dir="ltr">BACKUP</code> <code dir="ltr">AS</code> <code dir="ltr">COPY</code> command. Alternatively, you can configure the default backup type for disk as image copies. A database server session is used to create the copy. The server session also performs actions such as validating the blocks in the file and recording the image copy in the RMAN repository.</p>
<p><a id="sthref662"></a>As with backup pieces, <a class="olink RCMRF195" href="../../backup.112/e10643/rcmsubcl010.htm#RCMRF195"><code dir="ltr">FORMAT</code></a> variables are used to specify the names of image copies. The default format <code dir="ltr">%U</code>, which was explained in <a href="#BABJBCBA">"Filenames for Backup Pieces"</a>, is defined differently for image copies. The following example shows the name for data file <code dir="ltr">2</code> generated by <code dir="ltr">%U</code>:</p>
<pre dir="ltr">
/d1/oracle/work/orcva/RDBMS/datafile/o1_mf_sysaux_2qylngm3_.dbf
</pre>
<p>When creating image copies, you can also name the output copies with the <code dir="ltr"><a id="sthref663"></a>DB_FILE_NAME_CONVERT</code> parameter of the<a id="sthref664"></a><a id="sthref665"></a> <code dir="ltr">BACKUP</code> command. This parameter works identically to the <a class="olink REFRN10038" href="../../server.112/e40402/initparams057.htm#REFRN10038"><code dir="ltr">DB_FILE_NAME_CONVERT</code></a> initialization parameter. Pairs of file name prefixes are provided to change the names of the output files. If a file is not converted by any of the pairs, then RMAN uses the <code dir="ltr">FORMAT</code> specification: if no <code dir="ltr">FORMAT</code> is specified, then RMAN uses the default format <code dir="ltr">%U</code>.</p>
<p><a href="#CHDFBHHA">Example 8-1</a> copies the datafiles whose file name is prefixed with <code dir="ltr">/maindisk/oradata/users</code> so that they are prefixed with <code dir="ltr">/backups/users_ts</code>.</p>
<div id="BRADV197" class="example">
<p class="titleinexample"><a id="CHDFBHHA"></a>Example 8-1 Specifying Filenames with DB_FILE_NAME_CONVERT</p>
<pre dir="ltr">
BACKUP AS COPY 
  DB_FILE_NAME_CONVERT ('/maindisk/oradata/users',
                        '/backups/users_ts')
  TABLESPACE users;
</pre></div>
<!-- class="example" -->
<p>If you run a <code dir="ltr">RESTORE</code> command, then by default RMAN restores a data file or control file to its original location by copying an image copy backup to that location. Image copies are chosen over backup sets because of the extra overhead of reading through an entire backup set in search of files to be restored.</p>
<p>If you must restore and recover a current data file, and if you have an image copy available on disk, then you do not need to have RMAN copy the image copy back to its old location. Instead, you can use the image copy in place as a replacement for the data file to be restored. <a href="rcmcomre.htm#CHDGEBBG">"Performing Complete Recovery After Switching to a Copy"</a> explains how to perform this task.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmconfb.htm#i1019139">"Configuring the Default Type for Backups: Backup Sets or Copies"</a> to learn how to make either backup sets or image copies the default type of RMAN backups</p>
</li>
<li>
<p><a href="rcmbckba.htm#CEGHECDA">"Specifying Backup Set or Copy for an RMAN Backup to Disk"</a></p>
</li>
<li>
<p><a class="olink RCMRF195" href="../../backup.112/e10643/rcmsubcl010.htm#RCMRF195"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the meaning of <code dir="ltr">%U</code> for image copies</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i1006681"></a>
<div id="BRADV89490" class="sect2">
<h3 class="sect2">User-Managed Image Copies</h3>
<p><a id="sthref666"></a>RMAN can use image copies created by mechanisms outside of RMAN, such as native operating system file copy commands or third-party utilities that leave image copies of files on disk. This type of copy is known as a <a href="glossary.htm#i433687"><span class="xrefglossterm">user-managed backup</span></a> or <a href="glossary.htm#i998607"><span class="xrefglossterm">operating system backup</span></a>.</p>
<p>You can use the <a class="olink RCMRF109" href="../../backup.112/e10643/rcmsynta008.htm#RCMRF109"><code dir="ltr">CATALOG</code></a> command to inspect an existing image copy and enter its metadata into the RMAN repository. However, the <code dir="ltr">CATALOG</code> command does not do the following:</p>
<ul>
<li>
<p>Read all blocks in the data file copy to ensure there are no corruptions</p>
</li>
<li>
<p>Guarantee that the image copy was correctly made in <a id="sthref667"></a><a href="glossary.htm#i432099"><span class="xrefglossterm">backup mode</span></a></p>
</li>
</ul>
<p>After you catalog these files, you can use them with the <a class="olink RCMRF149" href="../../backup.112/e10643/rcmsynta2008.htm#RCMRF149"><code dir="ltr">RESTORE</code></a> or <a class="olink RCMRF159" href="../../backup.112/e10643/rcmsynta2020.htm#RCMRF159"><code dir="ltr">SWITCH</code></a> commands just as you can for RMAN-generated image copies.</p>
<p><a id="sthref668"></a>Some sites store their datafiles on mirrored disk volumes, which permit the creation of image copies by <a href="glossary.htm#CBABAEAH"><span class="xrefglossterm">breaking a mirror</span></a>. After you have broken the mirror, you can notify RMAN of the existence of a new user-managed copy, thus making it eligible for a backup. You must notify RMAN when the copy is no longer available by using the <a class="olink RCMRF110" href="../../backup.112/e10643/rcmsynta009.htm#RCMRF110"><code dir="ltr">CHANGE</code></a> <code dir="ltr">...</code> <code dir="ltr">UNCATALOG</code> command.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="osbackup.htm#CEGJIHJF">Chapter 28, "Making User-Managed Database Backups"</a></p>
</li>
<li>
<p><a href="rcmmaint.htm#i1007717">"Adding Backup Records to the RMAN Repository"</a> to learn how to catalog data file and archived log image copies</p>
</li>
<li>
<p><a href="rcmbckad.htm#i1006219">"Making Split Mirror Backups with RMAN"</a></p>
</li>
<li>
<p><a class="olink RCMRF110" href="../../backup.112/e10643/rcmsynta009.htm#RCMRF110"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">CHANGE</code> syntax</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1025065"></a>
<div id="BRADV107" class="sect1">
<h2 class="sect1">Multiple Copies of RMAN Backups</h2>
<p>In RMAN, you can make multiple, identical copies of backups in the following ways:</p>
<ul>
<li>
<p><a id="sthref669"></a><a id="sthref670"></a>Duplex backups with the <code dir="ltr">BACKUP</code> <code dir="ltr">... COPIES</code> command, in which case RMAN creates multiple copies of each backup set</p>
</li>
<li>
<p>Back up your files as backup sets or image copies, and then back up the backup sets or image copies with the <a id="sthref671"></a><a id="sthref672"></a><a id="sthref673"></a>RMAN <code dir="ltr">BACKUP</code> <code dir="ltr">BACKUPSET</code> or <code dir="ltr">BACKUP</code> <code dir="ltr">COPY OF</code> commands</p>
</li>
</ul>
<div id="BRADV89491" class="sect2"><a id="sthref674"></a>
<h3 class="sect2">Duplexed Backup Sets</h3>
<p><a id="sthref675"></a><a id="sthref676"></a>When backing up datafiles, archived redo log files, server parameter files, and control files into backup pieces, RMAN can create a <a href="glossary.htm#CHDFAIIJ"><span class="xrefglossterm">duplexed backup set</span></a>, producing up to four identical copies of each backup piece in the backup set on different backup destinations with one <code dir="ltr">BACKUP</code> command. Duplexing is not supported for backup operations that produce image copies.</p>
<p>You can use the <code dir="ltr">COPIES</code> parameter in the <code dir="ltr">CONFIGURE</code>, <code dir="ltr">SET</code>, or<a id="sthref677"></a><a id="sthref678"></a> <code dir="ltr">BACKUP</code> commands to specify duplexing of backup sets when using the <code dir="ltr">BACKUP</code> command. RMAN can duplex backups to either disk or tape, but cannot duplex backups to tape and disk simultaneously. When backing up to tape, ensure that the number of copies does not exceed the number of available tape devices.</p>
<p><a id="sthref679"></a><a id="sthref680"></a>The <code dir="ltr">FORMAT</code> parameter of the <code dir="ltr">BACKUP</code> command specifies the destinations for duplexed backups. The following example creates three copies of the backup of data file <code dir="ltr">7</code>:</p>
<pre dir="ltr">
BACKUP DEVICE TYPE DISK COPIES 3 DATAFILE 7 
  FORMAT '/disk1/%U','?/oradata/%U','?/%U';
</pre>
<p>RMAN places the first copy of each backup piece in <code dir="ltr">/disk1</code>, the second in <code dir="ltr">?/oradata</code>, and the third in the Oracle home. RMAN does not produce three backup sets, each with a different unique backup set key. Rather, RMAN produces one backup set with a unique key, and generates three identical copies of each backup piece in the set.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmconfa.htm#i1007486">"Configuring Backup Duplexing"</a></p>
</li>
<li>
<p><a href="rcmbckad.htm#i1006180">"Duplexing Backup Sets"</a></p>
</li>
<li>
<p><a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">CONFIGURE</code> syntax</p>
</li>
<li>
<p><a class="olink RCMRF153" href="../../backup.112/e10643/rcmsynta2014.htm#RCMRF153"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">SET</code> syntax</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<div id="BRADV89492" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref681"></a>
<h3 class="sect2">Backups of Backups</h3>
<p>You can use the <code dir="ltr">BACKUP</code> command to back up existing backup sets and image copies.</p>
<a id="i1007184"></a>
<div id="BRADV89493" class="sect3">
<h4 class="sect3">Backups of Backup Sets</h4>
<p><a id="sthref682"></a><a id="sthref683"></a><a id="sthref684"></a><a id="sthref685"></a>The RMAN <code dir="ltr">BACKUP</code> <code dir="ltr">BACKUPSET</code> command backs up backup sets that were created on disk. <a id="sthref686"></a><a id="sthref687"></a><a id="sthref688"></a><a id="sthref689"></a>The command is a useful way to spread backups among multiple media.</p>
<p>If RMAN discovers that one copy of a backup set is corrupted or missing, then it searches for other copies of the same backup set. This behavior is similar to the behavior of RMAN when backing up archived redo logs that exist in multiple archiving destinations.</p>
<p><a href="#CHDHGCFI">Example 8-2</a> shows how you might run the <code dir="ltr">BACKUP</code> command weekly as part of the production backup schedule. In this way, you ensure that all your backups exist on both disk and tape.</p>
<div id="BRADV607" class="example">
<p class="titleinexample"><a id="CHDHGCFI"></a>Example 8-2 Backing Up Backup Sets to Tape</p>
<pre dir="ltr">
BACKUP DEVICE TYPE DISK AS BACKUPSET 
  DATABASE PLUS ARCHIVELOG; 
BACKUP 
  DEVICE TYPE sbt 
  BACKUPSET ALL; # copies backup sets on disk to tape
</pre></div>
<!-- class="example" -->
<div class="infobox-note">
<p class="notep1">Note:</p>
Backups to <code dir="ltr">sbt</code> that use automatic channels require that you first run the <code dir="ltr">CONFIGURE</code> <code dir="ltr">DEVICE</code> <code dir="ltr">TYPE</code> <code dir="ltr">sbt</code> command.</div>
<p>You can also use <code dir="ltr">BACKUP</code> <code dir="ltr">BACKUPSET</code> to manage backup space allocation. <a href="#CHDFIGIE">Example 8-3</a> backs up backup sets that were created more than a week ago from disk to tape, and then deletes them from disk.</p>
<div id="BRADV203" class="example">
<p class="titleinexample"><a id="CHDFIGIE"></a>Example 8-3 Managing Space Allocation</p>
<pre dir="ltr">
BACKUP 
  DEVICE TYPE sbt 
  BACKUPSET COMPLETED BEFORE 'SYSDATE-7' 
  DELETE INPUT;
</pre></div>
<!-- class="example" -->
<p><code dir="ltr">DELETE</code> <code dir="ltr">INPUT</code> here is equivalent to <code dir="ltr">DELETE</code> <code dir="ltr">ALL</code> <code dir="ltr">INPUT</code>: RMAN deletes all existing copies of the backup set. If you duplexed a backup to four locations, then RMAN deletes all four copies of the pieces in the backup set.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmbckba.htm#CHDFCCCF">"Backing Up RMAN Backups"</a></div>
</div>
<!-- class="sect3" -->
<div id="BRADV89494" class="sect3"><a id="sthref690"></a>
<h4 class="sect3">Backups of Image Copies</h4>
<p><a id="sthref691"></a><a id="sthref692"></a>You can use the <code dir="ltr">BACKUP COPY OF</code> command to back up existing image copies of database files either as backup sets or as image copies. When using this command, an image copy of every data file specified in the command must exist. If there are multiple copies of a data file, then the latest one is used. If you specify a tablespace or the whole database, then RMAN issues an error if there are datafiles in the database or tablespace for which there are no image copy backups.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1016424"></a>
<div id="BRADV111" class="sect1">
<h2 class="sect1">Control File and Server Parameter File Autobackups<a id="sthref693"></a><a id="sthref694"></a><a id="sthref695"></a></h2>
<p><a id="sthref696"></a><a id="sthref697"></a><a id="sthref698"></a><a id="sthref699"></a><a id="sthref700"></a>Having recent backups of your control file and server parameter file is extremely valuable in many recovery situations. To ensure that you have backups of these files, the database supports control file and server parameter file autobackups. The autobackup occurs independently of any backup of the current control file explicitly requested as part of your <code dir="ltr">BACKUP</code> command.</p>
<p>With a <a href="glossary.htm#i432379"><span class="xrefglossterm">control file autobackup</span></a>, RMAN can recover the database even if the current control file, recovery catalog, and server parameter file are inaccessible. Because the path used to store the autobackup follows a well-known format, RMAN can search for and restore the server parameter file from that autobackup. After you have started the instance with the restored server parameter file, RMAN can restore the control file from the autobackup. After you mount the control file, use the RMAN repository in the mounted control file to restore the datafiles.</p>
<div id="BRADV89495" class="sect2"><a id="sthref701"></a>
<h3 class="sect2">When RMAN Performs Control File Autobackups</h3>
<p><a id="sthref702"></a>If <code dir="ltr">CONFIGURE CONTROLFILE AUTOBACKUP</code> is <code dir="ltr">ON</code>, then RMAN automatically backs up the control file and the current server parameter file (if used to start up the database) at the end of a successful <code dir="ltr">BACKUP</code> command. If the database runs in <code dir="ltr">ARCHIVELOG</code> level, RMAN makes control file autobackups when a structural change to the database affects the contents of the control file.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Beginning with Oracle Database Release 11<span class="italic">g</span> Release 2, RMAN takes only one control file autobackup when multiple structural changes contained in a script (for example, adding tablespaces, altering the state of a tablespace or data file, adding a new online redo log, renaming a file, and so on) have been applied.</div>
</div>
<!-- class="sect2" -->
<div id="BRADV89496" class="sect2"><a id="sthref703"></a>
<h3 class="sect2">How RMAN Performs Control File Autobackups</h3>
<p>The first channel allocated during the backup job creates the autobackup and places it into its own backup set. For autobackups after database structural changes, the server process associated with the structural change makes the backup.</p>
<p>If a server parameter file is in use by the database, then RMAN backs it up in the same backup set as the control file autobackup. After the autobackup completes, the database writes a message containing the complete path of the backup piece and the device type to the alert log located in the <a id="sthref704"></a><a href="glossary.htm#CHDDAHBD"><span class="xrefglossterm">Automatic Diagnostic Repository (ADR)</span></a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Control file autobackups are never duplexed.</div>
<p><a id="sthref705"></a>The control file autobackup file name has a default format of <code dir="ltr">%F</code> for all device types, so that RMAN can determine the file location and restore it without a repository. You can specify a different format with the <code dir="ltr">CONFIGURE</code> <code dir="ltr">CONTROLFILE</code> <code dir="ltr">AUTOBACKUP</code> <code dir="ltr">FORMAT</code> command, but all autobackup formats must include the <code dir="ltr">%F</code> variable. If you do not use the default format, then during disaster recovery you must specify the format that was used to generate the autobackups. Otherwise, RMAN cannot restore the autobackup.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmconfb.htm#i1017907">"Configuring Control File and Server Parameter File Autobackups"</a></p>
</li>
<li>
<p><a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">CONFIGURE</code> syntax</p>
</li>
<li>
<p><a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">BACKUP</code> syntax</p>
</li>
<li>
<p><a class="olink RCMRF195" href="../../backup.112/e10643/rcmsubcl010.htm#RCMRF195"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the substitution variable <code dir="ltr">%F</code></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1007616"></a>
<div id="BRADV109" class="sect1">
<h2 class="sect1">Incremental Backups</h2>
<p>By default, RMAN makes <a id="sthref706"></a>full backups. A <a href="glossary.htm#i432658"><span class="xrefglossterm">full backup</span></a> of a data file includes every allocated block in the file being backed up. A full backup of a data file can be an image copy, in which case every data block is backed up. It can also be stored in a backup set, in which case data file blocks not in use may be skipped.</p>
<p>A full backup is the default type of RMAN backup. A full backup has no effect on subsequent incremental backups and is not considered a part of an <a href="glossary.htm#i432786"><span class="xrefglossterm">incremental backup</span></a> strategy. Image copies are always full backups because they include every data block in a data file. A backup set is by default a full backup because it can potentially include every data block in a data file, although <a href="glossary.htm#i432341"><span class="xrefglossterm">unused block compression</span></a> means that blocks never used are excluded and, in some cases, currently unused blocks are excluded (see <a href="#BABIDCCI">"Block Compression for Backup Sets"</a>).</p>
<p>In contrast to a full backup, an incremental backup copies only those data blocks that have changed since a previous backup. You can use RMAN to create incremental backups of datafiles, tablespaces, or the whole database. A full backup cannot be part of an incremental backup strategy; that is, it cannot be the parent for a subsequent incremental backup.</p>
<div id="BRADV89499" class="sect2"><a id="sthref707"></a>
<h3 class="sect2">Multilevel Incremental Backups</h3>
<p>RMAN can create multilevel incremental backups. Each incremental level is denoted by a value of 0 or 1. <a id="sthref708"></a><a id="sthref709"></a>A <a id="sthref710"></a><a href="glossary.htm#CHDCBDHA"><span class="xrefglossterm">level 0 incremental backup</span></a>, which is the base for subsequent incremental backups, copies all blocks containing data. You can create a level 0 database backup as backup sets or image copies.</p>
<p>The only difference between a level 0 incremental backup and a full backup is that a full backup is never included in an incremental strategy. Thus, an incremental level 0 backup is a full backup that happens to be the parent of incremental backups whose level is greater than 0.</p>
<p>A level 1 incremental backup can be either of the following types:</p>
<ul>
<li>
<p>A <a id="sthref711"></a><a href="glossary.htm#i432588"><span class="xrefglossterm">differential incremental backup</span></a>, which backs up all blocks changed after the most recent incremental backup at level 1 or 0</p>
</li>
<li>
<p>A <a id="sthref712"></a><a href="glossary.htm#i432455"><span class="xrefglossterm">cumulative incremental backup</span></a>, which backs up all blocks changed after the most recent incremental backup at level 0</p>
</li>
</ul>
<p>Incremental backups are differential by default.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Cumulative backups are preferable to differential backups when recovery time is more important than disk space, because fewer incremental backups must be applied during recovery.</div>
<p>The size of the backup file depends solely upon the number of blocks modified, the incremental backup level, and the type of incremental backup (differential or cumulative).</p>
<div id="BRADV89500" class="sect3"><a id="sthref713"></a>
<h4 class="sect3">Differential Incremental Backups</h4>
<p><a id="sthref714"></a><a id="sthref715"></a><a id="sthref716"></a><a id="sthref717"></a>In a differential <a id="sthref718"></a>level 1 backup, RMAN backs up all blocks that have changed since the most recent incremental backup at level 1 (cumulative or differential) or level 0. For example, in a differential level 1 backup, RMAN determines which level 1 backup occurred most recently and backs up all blocks modified after that backup. If no level 1 is available, then RMAN copies all blocks changed since the base level 0 backup.</p>
<p>If no level 0 backup is available in either the current or parent <a href="glossary.htm#i432741"><span class="xrefglossterm">incarnation</span></a>, then the behavior varies with the compatibility mode setting. If compatibility is &gt;=10.0.0, RMAN copies all blocks that have been changed since the file was created. Otherwise, RMAN generates a level 0 backup.</p>
<div id="BRADV207" class="figure">
<p class="titleinfigure"><a id="BABFJCBH"></a>Figure 8-2 Differential Incremental Backups</p>
<img width="600" height="339" src="img/bradv017.gif" alt="Description of Figure 8-2 follows" /><br />
<a id="sthref719" href="img_text/bradv017.htm">Description of "Figure 8-2 Differential Incremental Backups"</a><br />
<br /></div>
<!-- class="figure" -->
<p>In the example shown in <a href="#BABFJCBH">Figure 8-2</a>, the following activity occurs each week:</p>
<ul>
<li>
<p>Sunday</p>
<p>An incremental level 0 backup backs up <span class="italic">all</span> blocks that have ever been in use in this database.</p>
</li>
<li>
<p>Monday through Saturday</p>
<p>On each day from Monday through Saturday, a differential incremental level 1 backup backs up all blocks that have changed since the most recent incremental backup at level 1 or 0. The Monday backup copies blocks changed since Sunday level 0 backup, the Tuesday backup copies blocks changed since the Monday level 1 backup, and so forth.</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<div id="BRADV89501" class="sect3"><a id="sthref720"></a>
<h4 class="sect3">Cumulative Incremental Backups</h4>
<p><a id="sthref721"></a><a id="sthref722"></a><a id="sthref723"></a>In a cumulative <a id="sthref724"></a>level 1 backup, RMAN backs up all blocks used since the most recent level 0 incremental backup in either the current or parent incarnation. Cumulative incremental backups reduce the work needed for a restore operation by ensuring that you only need one incremental backup from any particular level. Cumulative backups require more space and time than differential backups because they duplicate the work done by previous backups at the same level.</p>
<p>In the example shown in <a href="#BABHEJFE">Figure 8-3</a>, the following occurs each week:</p>
<ul>
<li>
<p>Sunday</p>
<p>An incremental level 0 backup backs up <span class="italic">all</span> blocks that have ever been in use in this database.</p>
</li>
<li>
<p>Monday - Saturday</p>
<p>A cumulative incremental level 1 backup copies all blocks changed since the most recent level 0 backup. Because the most recent level 0 backup was created on Sunday, the level 1 backup on each day Monday through Saturday backs up all blocks changed since the Sunday backup.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmbckba.htm#i1034163">"Making and Updating Incremental Backups"</a></div>
<div id="BRADV208" class="figure">
<p class="titleinfigure"><a id="BABHEJFE"></a>Figure 8-3 Cumulative Incremental Backups</p>
<img width="600" height="352" src="img/bradv018.gif" alt="Description of Figure 8-3 follows" /><br />
<a id="sthref725" href="img_text/bradv018.htm">Description of "Figure 8-3 Cumulative Incremental Backups"</a><br />
<br /></div>
<!-- class="figure" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<div id="BRADV90078" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref726"></a>
<h3 class="sect2">Block Change Tracking</h3>
<p>The <a id="sthref727"></a><a href="glossary.htm#CHDIFJHF"><span class="xrefglossterm">block change tracking</span></a> feature for incremental backups improves incremental backup performance by recording changed blocks in each data file in a <a href="glossary.htm#CHDBFBFB"><span class="xrefglossterm">block change tracking file</span></a>. This file is a small binary file stored in the <a href="glossary.htm#CHDEJGJH"><span class="xrefglossterm">database area</span></a>. RMAN tracks changed blocks as redo is generated.</p>
<p>If block change tracking is enabled, then RMAN uses the change tracking file to identify changed blocks for incremental backups, thus avoiding the need to scan every block in the data file. RMAN only uses block change tracking when the incremental level is greater than 0, because a <a id="sthref728"></a><a href="glossary.htm#CHDCBDHA"><span class="xrefglossterm">level 0 incremental backup</span></a> includes all blocks.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmbckba.htm#i1032148">"Using Block Change Tracking to Improve Incremental Backup Performance"</a></div>
</div>
<!-- class="sect2" -->
<div id="BRADV89498" class="sect2"><a id="sthref729"></a>
<h3 class="sect2">Incremental Backup Algorithm</h3>
<p>The following concepts are essential for understanding the algorithm that RMAN uses to make incremental backups:</p>
<ul>
<li>
<p>Checkpoint SCN</p>
<p>Every data file has a <a href="glossary.htm#CHDGHFDF"><span class="xrefglossterm">data file checkpoint</span></a> SCN, which you can view in <code dir="ltr">V$DATAFILE.CHECKPOINT_CHANGE#</code>. All changes with an SCN <span class="italic">lower</span> than this SCN are guaranteed to be in the file. When a level 0 incremental backup is restored, the restored data file contains the checkpoint SCN that it had when the level 0 was created. When a level 1 incremental backup is applied to a file, the checkpoint SCN of the file is advanced to the checkpoint SCN that the file had when the incremental level 1 backup was created.</p>
</li>
<li>
<p>Incremental start SCN</p>
<p>This SCN applies only to level 1 incremental backups. All blocks whose SCN is greater than or equal to the incremental start SCN are included in the backup. Blocks whose SCN is lower than the incremental start SCN are not included in the backup. The incremental start SCN is most often the checkpoint SCN of the parent of the level 1 backup.</p>
</li>
<li>
<p>Block SCN</p>
<p>Every data block in a data file records the SCN at which the most recent change was made to the block.</p>
</li>
</ul>
<p>When RMAN makes a level 1 incremental backup of a file, RMAN reads the file, examines the SCN of every block, and backs up blocks whose SCN is greater than or equal to the incremental start SCN for this backup. If the backup is differential, then the incremental start SCN is the checkpoint SCN of the most recent level 1 backup. If the backup is cumulative, then the incremental start SCN is the checkpoint SCN of the most recent level 0 backup.</p>
<p>When block change tracking is enabled, RMAN uses bitmaps to avoid reading blocks that have not changed during the range from incremental start SCN to checkpoint SCN. RMAN still examines every block that is read and uses the SCN in the block to decide which blocks to include in the backup.</p>
<p>One consequence of the incremental backup algorithm is that RMAN applies all blocks containing changed data during recovery, even if the change is to an object created with the <code dir="ltr">NOLOGGING</code> option. Thus, if you restore a backup made before <code dir="ltr">NOLOGGING</code> changes were made, then incremental backups are the only way to recover these changes.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink CNCPT" href="../../server.112/e40540/toc.htm"><span class="italic">Oracle Database Concepts</span></a> for more information about <code dir="ltr">NOLOGGING</code> mode</div>
</div>
<!-- class="sect2" -->
<div id="BRADV89497" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref730"></a>
<h3 class="sect2">Recovery with Incremental Backups</h3>
<p>During <a id="sthref731"></a><a href="glossary.htm#i432935"><span class="xrefglossterm">media recovery</span></a>, RMAN examines the restored files to determine whether it can recover them with an incremental backup. If it has a choice, then RMAN always chooses incremental backups over archived redo logs because applying changes at a block level is faster than applying redo.</p>
<p>RMAN does not need to restore a base incremental backup of a data file to apply incremental backups to the data file during recovery. For example, you can restore data file image copies and recover them with incremental backups.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmrvcon.htm#BABDFIDH">"Selection of Incremental Backups and Archived Redo Logs"</a></div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1008093"></a>
<div id="BRADV99966" class="sect1">
<h2 class="sect1">Backup Retention Policies</h2>
<p><a id="i1008117"></a><a id="sthref732"></a>You can use the<a id="sthref733"></a> <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><code dir="ltr">CONFIGURE RETENTION POLICY</code></a> command to create a persistent and automatic <a href="glossary.htm#i432137"><span class="xrefglossterm">backup retention policy</span></a>. When a backup retention policy is in effect, RMAN considers a backup of datafiles or control files as an <a id="sthref734"></a><a href="glossary.htm#CHDIAGEJ"><span class="xrefglossterm">obsolete backup</span></a>, that is, no longer needed for recovery, according to criteria specified in the <code dir="ltr">CONFIGURE</code> command. You can use the <a class="olink RCMRF147" href="../../backup.112/e10643/rcmsynta2006.htm#RCMRF147"><code dir="ltr">REPORT OBSOLETE</code></a> command to view obsolete files and the <a class="olink RCMRF121" href="../../backup.112/e10643/rcmsynta016.htm#RCMRF121"><code dir="ltr">DELETE OBSOLETE</code></a> command to delete them.</p>
<p>As you produce backups over time, older backups become obsolete as they are no longer needed to satisfy the retention policy. RMAN can identify the obsolete files for you, but it does not automatically delete them. You must use the <code dir="ltr">DELETE</code> <code dir="ltr">OBSOLETE</code> command to delete files that are no longer needed to satisfy the retention policy.</p>
<p>If a fast recovery area is configured, then the database automatically deletes files that are either obsolete or backed up to tape when more recovery area space is needed for new files. The disk quota rules are distinct from the retention policy rules, but the database never deletes files in violation of the retention policy to satisfy the disk quota. Refer to <a href="rcmmaint.htm#i1009006">"Responding to a Full Fast Recovery Area"</a>.</p>
<p><a id="sthref735"></a>A backup is obsolete when <code dir="ltr">REPORT</code> <code dir="ltr">OBSOLETE</code> or <code dir="ltr">DELETE</code> <code dir="ltr">OBSOLETE</code> determines, based on the user-defined retention policy, that it is not needed for recovery. A backup is considered an <a id="sthref736"></a><a href="glossary.htm#CHDGICAB"><span class="xrefglossterm">expired backup</span></a> only when RMAN performs a crosscheck and cannot find the file. In short, <span class="italic">obsolete</span> means a file is not needed, whereas <span class="italic">expired</span> means it is not found.</p>
<p>A backup retention policy applies only to full or level 0 data file and control file backups. For data file copies and proxy copies, if RMAN determines that the copy or proxy copy is not needed, then the copy or proxy copy can be deleted. For data file backup sets, RMAN cannot delete the backup set until all data file backups within the backup set are obsolete.</p>
<p>The retention policy is not responsible for deleting or rendering obsolete archived redo logs and incremental level 1 backups. Rather, these files become obsolete when no full backups exist that need them. Besides affecting full or level 0 data file and control file backups, the retention policy affects archived redo logs and level 1 incremental backups. First, RMAN decides which data file and control file backups are obsolete. Then, RMAN considers as obsolete all archived logs and incremental level 1 backups that are not needed to recover the oldest data file or control file backup that must be retained.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
RMAN cannot implement an automatic retention policy if backups are deleted by non-RMAN techniques, for example, through the media manager's tape retention policy. The media manager should never expire a tape until all RMAN backups on that tape have been removed from the media manager's catalog.</div>
<p><a id="sthref737"></a><a id="sthref738"></a>There are two mutually exclusive options for implementing a retention policy: <a href="glossary.htm#CHDJDEAE"><span class="xrefglossterm">redundancy</span></a> and <a href="glossary.htm#i433328"><span class="xrefglossterm">recovery window</span></a>.</p>
<a id="i1008141"></a>
<div id="BRADV89502" class="sect2">
<h3 class="sect2">Recovery Window</h3>
<p><a id="sthref739"></a><a id="sthref740"></a>A recovery window is a period of time that begins with the current time and extends backward in time to the <a id="sthref741"></a><span class="glossaryterm">point of recoverability</span>. The point of recoverability is the earliest time for a hypothetical point-in-time recovery, that is, the earliest point to which you can recover following a media failure. For example, if you implement a recovery window of 1 week, then RMAN retains full backups and required incremental backups and archived logs so that the database can be recovered up to 7 days in the past. You implement this retention policy as follows:</p>
<pre dir="ltr">
CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 7 DAYS;
</pre>
<p>This command ensures that for each data file, one backup that is older than the point of recoverability is retained. For example, if the recovery window is <code dir="ltr">7</code>, then there must always exist one backup of each data file that satisfies the following condition:</p>
<pre dir="ltr">
SYSDATE - BACKUP CHECKPOINT TIME &gt;= 7
</pre>
<p>All backups older than the most recent backup that satisfied this condition are obsolete.</p>
<p>Assume the retention policy illustrated in <a href="#i1018027">Figure 8-4</a>. The retention policy has the following aspects:</p>
<ul>
<li>
<p>The recovery window is 7 days.</p>
</li>
<li>
<p>Database backups are scheduled every two weeks on these days:</p>
<ul>
<li>
<p>January 1</p>
</li>
<li>
<p>January 15</p>
</li>
<li>
<p>January 29</p>
</li>
<li>
<p>February 12</p>
</li>
</ul>
</li>
<li>
<p>The database runs in <code dir="ltr">ARCHIVELOG</code> mode, and archived logs are saved on disk only as long as needed for the retention policy.</p>
</li>
</ul>
<div id="BRADV209" class="figure">
<p class="titleinfigure"><a id="i1018027"></a>Figure 8-4 Recovery Window, Part 1</p>
<img width="504" height="327" src="img/bradv004.gif" alt="Description of Figure 8-4 follows" /><br />
<a id="sthref742" href="img_text/bradv004.htm">Description of "Figure 8-4 Recovery Window, Part 1"</a><br />
<br /></div>
<!-- class="figure" -->
<p>As illustrated in <a href="#i1018027">Figure 8-4</a>, the current time is January 23 and the point of recoverability is January 16. Hence, the January 14 backup is needed for recovery, and so are the archived logs from log sequence 500 through 850. The logs before 500 and the January 1 backup are obsolete because they are not needed for recovery to a point within the window.</p>
<p>Assume the same scenario a week later, as depicted in <a href="#i1018028">Figure 8-5</a>.</p>
<div id="BRADV608" class="figure">
<p class="titleinfigure"><a id="i1018028"></a>Figure 8-5 Recovery Window, Part 2</p>
<img width="600" height="314" src="img/bradv002.gif" alt="Description of Figure 8-5 follows" /><br />
<a id="sthref743" href="img_text/bradv002.htm">Description of "Figure 8-5 Recovery Window, Part 2"</a><br />
<br /></div>
<!-- class="figure" -->
<p>In this scenario, the current time is January 30 and the point of recoverability is January 23. Note how the January 14 backup is <span class="italic">not</span> obsolete even though a more recent backup (January 28) exists in the recovery window. This situation occurs because restoring the January 28 backup does not enable you to recover to the earliest time in the window, January 23. To ensure recoverability to any point in the window, you must save the January 14 backup and all archived logs from sequence 500 to 1150.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmconfb.htm#CHDBFCCB">"Configuring a Recovery Window-Based Retention Policy"</a></div>
</div>
<!-- class="sect2" -->
<a id="i1010869"></a>
<div id="BRADV89503" class="sect2">
<h3 class="sect2">Backup Redundancy</h3>
<p><a id="sthref744"></a>In some cases using a recovery window can complicate disk space planning because the number of backups that must be retained is not constant and depends on the backup schedule. In contrast, a redundancy-based retention policy specifies how many backups of each data file must be retained. For example, you can configure a redundancy of 2 as follows:</p>
<pre dir="ltr">
CONFIGURE RETENTION POLICY TO REDUNDANCY 2;
</pre>
<p>The default retention policy is configured to <code dir="ltr">REDUNDANCY</code> <code dir="ltr">1</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmconfb.htm#i1019345">"Configuring a Redundancy-Based Retention Policy"</a></div>
</div>
<!-- class="sect2" -->
<a id="i1008222"></a>
<div id="BRADV89504" class="sect2">
<h3 class="sect2">Batch Deletes of Obsolete Backups</h3>
<p><a id="sthref745"></a><a id="sthref746"></a><a id="sthref747"></a>You can run <a id="sthref748"></a>the <a id="sthref749"></a><code dir="ltr">REPORT</code> <code dir="ltr">OBSOLETE</code> command to determine which backups are currently obsolete according to the retention policy. A companion command, <code dir="ltr">DELETE</code> <code dir="ltr">OBSOLETE</code>, deletes all files that are obsolete according to the retention policy. You can run <a id="sthref750"></a><code dir="ltr">DELETE</code> <code dir="ltr">OBSOLETE</code> periodically to minimize space wasted by storing obsolete backups. For example, you can <a id="sthref751"></a>run <code dir="ltr">DELETE</code> <code dir="ltr">OBSOLETE</code> in a weekly script.</p>
<p>You can also override the configured retention policy by specifying the <code dir="ltr">REDUNDANCY</code> or <code dir="ltr">RECOVERY</code> <code dir="ltr">WINDOW</code> options on the <code dir="ltr">REPORT</code> or <code dir="ltr">DELETE</code> commands. Using <code dir="ltr">DELETE OBSOLETE</code> with a recovery window shorter than the configured recovery window effectively reduces the window of recoverability. For example, if the configured window is 14 days, but you execute <code dir="ltr">DELETE OBSOLETE RECOVERY WINDOW OF 7 DAYS</code>, then you no longer have the ability to recover to a time between 7 and 14 days ago.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmreprt.htm#CHDDBJHC">Chapter 11, "Reporting on RMAN Operations"</a>to learn how to generate reports and delete backups</p>
</li>
<li>
<p><a class="olink RCMRF121" href="../../backup.112/e10643/rcmsynta016.htm#RCMRF121"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">DELETE</code> syntax</p>
</li>
<li>
<p><a class="olink RCMRF147" href="../../backup.112/e10643/rcmsynta2006.htm#RCMRF147"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">REPORT</code> syntax</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i1009968"></a>
<div id="BRADV89505" class="sect2">
<h3 class="sect2">Backup Retention Policy and Fast Recovery Area Deletion Rules</h3>
<p>The RMAN status <code dir="ltr">OBSOLETE</code> is always determined in reference to a retention policy. For example, if a database backup is considered <code dir="ltr">OBSOLETE</code> in the RMAN repository, it is because it is either not needed for recovery to a point within the recovery window, or it is redundant.</p>
<p>If you configure a <a id="sthref752"></a><a href="glossary.htm#i999320"><span class="xrefglossterm">fast recovery area</span></a>, then the database uses an internal algorithm to select files in the fast recovery area that are no longer needed to meet the configured retention policy. These backups have status <code dir="ltr">OBSOLETE</code> and are eligible for deletion to satisfy the <a href="glossary.htm#i998969"><span class="xrefglossterm">disk quota</span></a> rules. The retention policy is never violated when determining which files to delete from the fast recovery area to satisfy the disk quota rules.</p>
<p>There is one important difference between the fast recovery area rules for <code dir="ltr">OBSOLETE</code> status and the disk quota rules for deletion eligibility. Assume that archived logs 1000 through 2000, which are on disk, are needed for the current recovery window and so are not obsolete. If you back up these logs to tape, then the retention policy considers the disk logs as required, that is, not obsolete. Nevertheless, the fast recovery area disk quota algorithm considers the logs on disk as eligible for deletion because they have been backed up to tape. The logs on disk do not have <code dir="ltr">OBSOLETE</code> status in the repository, but they are eligible for deletion by the fast recovery area.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1933">
<tr>
<td class="cellalignment1942">
<table class="cellalignment1938">
<tr>
<td class="cellalignment1937"><a href="part_bak.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1937"><a href="rcmbckba.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1944">
<table class="cellalignment1936">
<tr>
<td class="cellalignment1937"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1937"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1937"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1937"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1937"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1937"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
