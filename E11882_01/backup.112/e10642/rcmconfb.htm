<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Configuring the RMAN Environment</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1054" />
<meta name="description" content="A guide to backup and recovery of Oracle databases, including RMAN backup and recovery, RMAN data transfer, Oracle Flashback Technology, and user-managed backup and recovery" />
<meta name="dcterms.created" content="2015-05-13T14:1:10Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Backup and Recovery User's Guide" />
<meta name="dcterms.identifier" content="E10642-08" />
<meta name="dcterms.isVersionOf" content="BRADV" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="rcmcnctg.htm" title="Previous" type="text/html" />
<link rel="Next" href="rcmconfa.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10642.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">14/47</span> <!-- End Header -->
<div id="BRADV8002" class="chapter"><a id="g1026663"></a> <a id="i1014902"></a>
<h1 class="chapter"><span class="secnum">5</span> Configuring the RMAN Environment</h1>
<p>This chapter explains the most basic tasks involved in configuring RMAN. This chapter contains the following topics:</p>
<ul>
<li>
<p><a href="#i1016757">Configuring the Environment for RMAN Backups</a></p>
</li>
<li>
<p><a href="#i1006526">Configuring RMAN to Make Backups to a Media Manager</a></p>
</li>
<li>
<p><a href="#i1019160">Configuring the Fast Recovery Area</a></p>
</li>
<li>
<p><a href="#i1019318">Configuring the Backup Retention Policy</a></p>
</li>
<li>
<p><a href="#i1015217">Backup Optimization and the CONFIGURE command</a></p>
</li>
<li>
<p><a href="#CHDCFHBG">Configuring an Archived Redo Log Deletion Policy</a></p>
</li>
<li>
<p><a href="#CHDECDAG">Configuring RMAN in a Data Guard Environment</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmconfa.htm#CEGCJFEH">Chapter 6, "Configuring the RMAN Environment: Advanced Topics"</a> to learn about configuration options not covered in this chapter, including backup compression and encryption</p>
</li>
<li>
<p>Appendix C in the <a class="olink RCMRF90489" href="../../backup.112/e10643/web_services.htm#RCMRF90489"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for information about configuring RMAN for the Oracle Secure Backup (OSB) Cloud Module.</p>
</li>
</ul>
</div>
<a id="i1016757"></a>
<div id="BRADV99961" class="sect1">
<h2 class="sect1">Configuring the Environment for RMAN Backups</h2>
<p><a id="sthref307"></a>For most parameters required for backups, RMAN provides sensible defaults that enable you to perform basic backup and recovery. When implementing an RMAN-based backup strategy, you can use RMAN more effectively if you understand the most common configurations.</p>
<p>To simplify ongoing use of RMAN, you can set some persistent configuration settings for each target database. These settings control many aspects of RMAN behavior. For example, you can configure the backup retention policy, default destinations for backups, default backup device type, and so on. You can use the <a class="olink RCMRF154" href="../../backup.112/e10643/rcmsynta2015.htm#RCMRF154"><code dir="ltr">SHOW</code></a> and <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><code dir="ltr">CONFIGURE</code></a> commands to view and change RMAN configurations.</p>
<p>This section explains what an RMAN configuration is and how you can use the <code dir="ltr">CONFIGURE</code> command to change RMAN default behavior for your backup and recovery environment. This section also introduces the major settings available to you and their more common values.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you plan to back up to tape, refer to <a href="#i1006526">"Configuring RMAN to Make Backups to a Media Manager"</a>.</div>
<p>This section includes the following topics:</p>
<ul>
<li>
<p><a href="#i1019739">Showing and Clearing Persistent RMAN Configurations</a></p>
</li>
<li>
<p><a href="#i1017851">Configuring the Default Device for Backups: Disk or SBT</a></p>
</li>
<li>
<p><a href="#i1019139">Configuring the Default Type for Backups: Backup Sets or Copies</a></p>
</li>
<li>
<p><a href="#i1017890">Configuring Channels</a></p>
</li>
<li>
<p><a href="#i1017907">Configuring Control File and Server Parameter File Autobackups</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">CONFIGURE</code> syntax</div>
<a id="i1019739"></a>
<div id="BRADV8124" class="sect2">
<h3 class="sect2">Showing and Clearing Persistent RMAN Configurations</h3>
<p>You can use <a id="sthref308"></a><a id="sthref309"></a>the <code dir="ltr">SHOW</code> command to display the current value of RMAN configured settings for the target database. You can also view whether these commands are currently set to their default values.</p>
<p class="subhead2"><a id="BRADV566"></a>To view or change your CONFIGURE command settings:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and a recovery catalog (if used).</p>
</li>
<li>
<p>Run the RMAN <code dir="ltr">SHOW</code> command.</p>
<p>For example, run <code dir="ltr">SHOW ALL</code> as shown in <a href="#CHDDHFCD">Example 5-1</a> (sample output included). The output includes both parameters that you have changed and those that are set to the default. The configuration is displayed as the series of RMAN commands required to re-create the configuration. You can save the output in a text file and use this command file to re-create the configuration on the same or a different database.</p>
<div id="BRADV567" class="example">
<p class="titleinexample"><a id="CHDDHFCD"></a>Example 5-1 SHOW ALL Command</p>
<pre dir="ltr">
SHOW ALL;

RMAN configuration parameters for database with db_unique_name PROD1 are:
CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 3 DAYS;
CONFIGURE BACKUP OPTIMIZATION ON;
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE SBT_TAPE TO '%F'; # default
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%F'; # default
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 2 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS 'ENV=(OB_DEVICE=tape1)';
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/disk1/oracle/dbs/snapcf_ev.f'; # default
</pre></div>
<!-- class="example" -->
<p>You can also use the <code dir="ltr">SHOW</code> command with the name of a particular configuration. For example, you can view the retention policy and default device type as follows:</p>
<pre dir="ltr">
SHOW RETENTION POLICY;
SHOW DEFAULT DEVICE TYPE;
</pre></li>
<li>
<p>Optionally, use the <code dir="ltr">CONFIGURE ... CLEAR</code> command to return any configuration to its default value, as shown in the following examples:</p>
<pre dir="ltr">
CONFIGURE BACKUP OPTIMIZATION CLEAR;
CONFIGURE RETENTION POLICY CLEAR;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK CLEAR;
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF154" href="../../backup.112/e10643/rcmsynta2015.htm#RCMRF154"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">SHOW</code> syntax</div>
</div>
<!-- class="sect2" -->
<a id="i1017851"></a>
<div id="BRADV89399" class="sect2">
<h3 class="sect2">Configuring the Default Device for Backups: Disk or SBT</h3>
<p><a id="sthref310"></a><a id="sthref311"></a>Backups for which no destination device type is specified are directed to the configured default device. RMAN is preconfigured to use disk as the default device type. No additional configuration is necessary.</p>
<p>You may need to change the default device type from disk to tape, or change it back from tape to disk. <a href="#CHDIDJIC">Table 5-1</a> shows the commands that configure the default device.</p>
<div id="BRADV162" class="tblruleformal">
<p class="titleintable"><a id="sthref312"></a><a id="CHDIDJIC"></a>Table 5-1 Commands to Configure the Default Device Type</p>
<table class="cellalignment1945" title="Commands to Configure the Default Device Type" summary="Lists commands to specify the default device type." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t6">Command</th>
<th class="cellalignment1941" id="r1c2-t6">Explanation</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t6" headers="r1c1-t6">
<p><code dir="ltr">CONFIGURE DEFAULT DEVICE TYPE TO DISK</code></p>
</td>
<td class="cellalignment1942" headers="r2c1-t6 r1c2-t6">
<p>Specifies that backups should go to disk by default.</p>
<p>If a recovery area is enabled, then the backup location defaults to the <a href="glossary.htm#i999320"><span class="xrefglossterm">fast recovery area</span></a>. Otherwise, the backup location defaults to an operating system-specific directory on disk.</p>
<p>When backing up to disk, the logical block size of the database file must be an even multiple of the physical block size of the destination device. For example, a device of type DISK with a block size of 2 kilobytes can only be used as a destination for backups of database files with logical block sizes of 2 KB, 4 KB, 6 KB, and so on. Most disk drives have physical block sizes of 512 bytes, so this limitation rarely affects backup to disk drives. Nevertheless, you can encounter this limitation when backing up to a writable DVD or a device that has a larger physical block size.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t6" headers="r1c1-t6">
<p><code dir="ltr">CONFIGURE DEFAULT DEVICE TYPE TO sbt</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t6 r1c2-t6">
<p>Specifies that backups should go to tape by default.</p>
<p><a href="#i1006526">"Configuring RMAN to Make Backups to a Media Manager"</a> explains how to set up RMAN for use with a media manager. After RMAN can communicate with the media manager, you can configure RMAN to make backups to tape and specify <a href="glossary.htm#CHDCCBFI"><span class="xrefglossterm">SBT</span></a> as the default device type.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" -->
<p><a id="sthref313"></a><a id="sthref314"></a>You can always override the default device by using the <code dir="ltr">DEVICE</code> <code dir="ltr">TYPE</code> clause of the <a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><code dir="ltr">BACKUP</code></a> command, as shown in the following examples:</p>
<pre dir="ltr">
BACKUP DEVICE TYPE sbt DATABASE;
BACKUP DEVICE TYPE DISK DATABASE;
</pre>
<p class="subhead2"><a id="BRADV163"></a>To change the configured default device type:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and a recovery catalog (if used).</p>
</li>
<li>
<p>Run the <code dir="ltr">SHOW ALL</code> command to show the currently configured default device.</p>
</li>
<li>
<p>Run the <code dir="ltr">CONFIGURE DEFAULT DEVICE TYPE</code> command, specifying either <code dir="ltr">TO DISK</code> or <code dir="ltr">TO sbt</code>.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for more details on using the <code dir="ltr">BACKUP</code> command with the <code dir="ltr">DEVICE</code> <code dir="ltr">TYPE</code> clause</div>
</div>
<!-- class="sect2" -->
<a id="i1019139"></a>
<div id="BRADV89400" class="sect2">
<h3 class="sect2">Configuring the Default Type for Backups: Backup Sets or Copies</h3>
<p><a id="sthref315"></a><a id="sthref316"></a>The <a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><code dir="ltr">BACKUP</code></a> command can create either backup sets or image copies. For disk, you can configure RMAN to create either backup sets or image copies as its default backup type with the <code dir="ltr">CONFIGURE DEVICE TYPE DISK BACKUP TYPE TO</code> command. The default backup type for disk is an uncompressed <a id="sthref317"></a><a href="glossary.htm#i432144"><span class="xrefglossterm">backup set</span></a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Because RMAN can write an <a href="glossary.htm#i432704"><span class="xrefglossterm">image copy</span></a> only to disk, the backup type for tape can only be a backup set.</div>
<p>RMAN can create backup sets using <a id="sthref318"></a><a id="sthref319"></a><a href="glossary.htm#CHDEEEDG"><span class="xrefglossterm">binary compression</span></a>. You can configure RMAN to use compressed backup sets by default on a device type by specifying the <code dir="ltr">COMPRESSED</code> option in the <code dir="ltr">BACKUP TYPE TO ... BACKUPSET</code> clause. To disable compression, use the <code dir="ltr">CONFIGURE DEVICE TYPE</code> command with arguments specifying your other desired settings, but omit the <code dir="ltr">COMPRESSED</code> keyword.</p>
<p class="subhead2"><a id="BRADV164"></a>To configure the default type of backup:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and a recovery catalog (if used).</p>
</li>
<li>
<p>Configure backup sets or image copies as the default backup type.</p>
<p>The following examples configure the backup type for disk backups to copies and backup sets:</p>
<pre dir="ltr">
CONFIGURE DEVICE TYPE DISK BACKUP TYPE TO COPY; # image copies
CONFIGURE DEVICE TYPE DISK BACKUP TYPE TO BACKUPSET; # uncompressed
</pre>
<p>The following examples configure compression for backup sets:</p>
<pre dir="ltr">
CONFIGURE DEVICE TYPE DISK BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE sbt BACKUP TYPE TO COMPRESSED BACKUPSET;
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmcncpt.htm#i1013399">Backup Sets</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#i1034440">Making Compressed Backups</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="i1017890"></a>
<div id="BRADV89402" class="sect2">
<h3 class="sect2">Configuring Channels</h3>
<p>As explained in <a href="rcmarchi.htm#i1012864">"RMAN Channels"</a>, an RMAN <a id="sthref320"></a><a href="glossary.htm#i432240"><span class="xrefglossterm">channel</span></a> is a connection to a database server session. RMAN uses channels to perform most tasks.</p>
<div id="BRADV89403" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref321"></a>
<h4 class="sect3">About Channel Configuration</h4>
<p><a id="sthref322"></a><a id="sthref323"></a><a id="sthref324"></a><a id="sthref325"></a>Use the <code dir="ltr">CONFIGURE</code> <code dir="ltr">CHANNEL</code> command to configure options for disk or <a href="glossary.htm#CHDCCBFI"><span class="xrefglossterm">SBT</span></a> channels. <code dir="ltr">CONFIGURE</code> <code dir="ltr">CHANNEL</code> takes the same options used to specify one-time options with the <a class="olink RCMRF102" href="../../backup.112/e10643/rcmsynta004.htm#RCMRF102"><code dir="ltr">ALLOCATE CHANNEL</code></a> command. You can configure <a id="sthref326"></a><a id="sthref327"></a>generic channel settings for a device type, that is, a template that is used for any channels created based on configured settings for that device.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
This section explains configuration of disk channels. To learn how to configure channels for tape, see <a href="#i1006801">"Configuring SBT Channels for Use with a Media Manager"</a>.</div>
<p>If you use <code dir="ltr">CONFIGURE</code> <code dir="ltr">CHANNEL</code> to specify generic channel settings for a device, any previous settings are discarded, even if the settings are not in conflict. For example, after the second <code dir="ltr">CONFIGURE</code> <code dir="ltr">CHANNEL</code> command, which specifies only the <a class="olink RCMRF195" href="../../backup.112/e10643/rcmsubcl010.htm#RCMRF195"><code dir="ltr">FORMAT</code></a> for configured disk channels, the <code dir="ltr">MAXPIECESIZE</code> for the disk channel is returned to its default value:</p>
<pre dir="ltr">
CONFIGURE CHANNEL DEVICE TYPE DISK MAXPIECESIZE 2G;
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT /tmp/%U;
</pre></div>
<!-- class="sect3" -->
<a id="CHDCBAHE"></a>
<div id="BRADV89404" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Configuring Channels for Disk</h4>
<p>By default, RMAN allocates one disk channel for all operations. You may want to specify different options for this channel, for example, a new default location for backups. <a href="#CHDDEHCC">Example 5-2</a> configures RMAN to write disk backups to the <code dir="ltr">/disk1</code> directory and specifies a nondefault format for the relative file name.</p>
<div id="BRADV165" class="example">
<p class="titleinexample"><a id="CHDDEHCC"></a>Example 5-2 Configuring a Nondefault Backup Location</p>
<pre dir="ltr">
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT '/disk1/ora_df%t_s%s_s%p';
</pre></div>
<!-- class="example" -->
<p>In <a href="#CHDDEHCC">Example 5-2</a>, RMAN automatically replaces the format specifier <code dir="ltr">%t</code> with a four byte time stamp, <code dir="ltr">%s</code> with the backup set number, and <code dir="ltr">%p</code> with the backup piece number.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
When you configure an explicit format for disk channels, RMAN does not create backups by default in the <a href="glossary.htm#i999320"><span class="xrefglossterm">fast recovery area</span></a>. In this case, you lose the disk space management capabilities of the fast recovery area.</div>
<p>You can also specify an ASM disk location, as shown in <a href="#BGBDHBEF">Example 5-3</a>:</p>
<div id="BRADV602" class="example">
<p class="titleinexample"><a id="BGBDHBEF"></a>Example 5-3 Configuring an ASM Disk Location</p>
<pre dir="ltr">
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT '+dgroup1';
</pre></div>
<!-- class="example" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmbckba.htm#i1020015">"Backing Up Database Files with RMAN"</a> to learn how to make backups</div>
</div>
<!-- class="sect3" -->
<a id="i1015006"></a>
<div id="BRADV89405" class="sect3">
<h4 class="sect3">Configuring Parallel Channels for Disk and SBT Devices</h4>
<p><a id="sthref328"></a>The number of channels available for a device type when you run a command determines whether RMAN reads or writes in parallel. As a rule, the number of channels used in executing a command should match the number of devices accessed. Thus, for tape backups, allocate one channel for each tape drive. For disk backups, allocate one channel for each physical disk, unless you can optimize the backup for your disk subsystem architecture with multiple channels. Failing to allocate the right number of channels adversely affects RMAN performance during I/O operations.</p>
<p>You can configure <a href="glossary.htm#i433182"><span class="xrefglossterm">channel parallelism</span></a> settings, <a href="glossary.htm#CHDEEEDG"><span class="xrefglossterm">binary compression</span></a> for backup sets, and other options for an <a href="glossary.htm#CHDCCBFI"><span class="xrefglossterm">SBT</span></a> device with <code dir="ltr">CONFIGURE</code> <code dir="ltr">DEVICE</code> <code dir="ltr">TYPE</code> <code dir="ltr">sbt</code>. You set the configuration for the device type independently of the channel configuration.</p>
<p><a href="#CHDGCAFE">Example 5-4</a> changes the SBT device (sample output included) so that RMAN can back up to a media manager using two tape drives in parallel. Each configured SBT channel backs up approximately half the total data.</p>
<div id="BRADV166" class="example">
<p class="titleinexample"><a id="CHDGCAFE"></a>Example 5-4 Configuring Parallelism for an SBT Device</p>
<pre dir="ltr">
RMAN&gt; CONFIGURE DEVICE TYPE sbt PARALLELISM 2;

old RMAN configuration parameters:
CONFIGURE DEVICE TYPE 'SBT_TAPE' BACKUP TYPE TO COMPRESSED BACKUPSET PARALLELISM 1;
new RMAN configuration parameters:
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 2 BACKUP TYPE TO COMPRESSED BACKUPSET;
new RMAN configuration parameters are successfully stored
</pre></div>
<!-- class="example" -->
<p><a href="#CHDEGICJ">Example 5-5</a> changes the default backup type for the SBT device to an uncompressed backup set (sample output included).</p>
<div id="BRADV568" class="example">
<p class="titleinexample"><a id="CHDEGICJ"></a>Example 5-5 Configuring the Backup Type for an SBT Device</p>
<pre dir="ltr">
RMAN&gt; CONFIGURE DEVICE TYPE sbt BACKUP TYPE TO BACKUPSET;
 
old RMAN configuration parameters:
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 2 BACKUP TYPE TO COMPRESSED BACKUPSET;
new RMAN configuration parameters:
CONFIGURE DEVICE TYPE 'SBT_TAPE' BACKUP TYPE TO BACKUPSET PARALLELISM 2;
new RMAN configuration parameters are successfully stored
</pre></div>
<!-- class="example" -->
<p>The <code dir="ltr">CONFIGURE DEVICE TYPE</code> commands used in this example only affect parallelism and backup type and do not affect the values of settings not specified. In <a href="#CHDGCAFE">Example 5-4</a>, the default backup type of compressed backup set was not changed by changing the parallelism setting. In <a href="#CHDEGICJ">Example 5-5</a>, the ability to use multiple tape drives in parallel was not affected by changing the default backup type.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmbckba.htm#i1006582">"Specifying Multiple Formats for Disk Backups"</a> to learn how to make disk backups in parallel</p>
</li>
<li>
<p><a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for reference material on the <code dir="ltr">CHANNEL</code> parameter of <a id="sthref329"></a><a id="sthref330"></a>the <code dir="ltr">BACKUP</code> command</p>
</li>
<li>
<p><a class="olink RACAD" href="../../rac.112/e41960/toc.htm"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for information about taking advantage of parallel operations in an Oracle Real Application Clusters (Oracle RAC) configuration</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<div id="BRADV89406" class="sect3"><a id="sthref331"></a>
<h4 class="sect3">Manually Overriding Configured Channels</h4>
<p>If you manually allocate a channel during a job, then RMAN disregards any configured channel settings. For example, assume that the default device type is SBT, and you execute the following command:</p>
<pre dir="ltr">
RUN 
{
  ALLOCATE CHANNEL c1 DEVICE TYPE DISK;
  BACKUP TABLESPACE users;
}
</pre>
<p>In this case, RMAN uses only the disk channel that you manually allocated within the <a class="olink RCMRF151" href="../../backup.112/e10643/rcmsynta2012.htm#RCMRF151"><code dir="ltr">RUN</code></a> command, overriding any defaults set by using <code dir="ltr">CONFIGURE</code> <code dir="ltr">DEVICE</code> <code dir="ltr">TYPE</code>, <code dir="ltr">CONFIGURE</code> <code dir="ltr">DEFAULT</code> <code dir="ltr">DEVICE</code>, or <code dir="ltr">CONFIGURE</code> <code dir="ltr">CHANNEL</code> settings.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmarchi.htm#i1012864">"RMAN Channels"</a> to learn about configured and allocated channels</p>
</li>
<li>
<p><a class="olink RCMRF102" href="../../backup.112/e10643/rcmsynta004.htm#RCMRF102"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">ALLOCATE CHANNEL</code> syntax</p>
</li>
<li>
<p><a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">CONFIGURE</code> syntax</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1017907"></a>
<div id="BRADV89407" class="sect2">
<h3 class="sect2">Configuring Control File and Server Parameter File Autobackups</h3>
<p>As explained in <a href="rcmcncpt.htm#i1016424">"Control File and Server Parameter File Autobackups"</a>, you can configure RMAN to automatically back up the control file and server parameter file. The autobackup occurs whenever a backup record is added.<a id="sthref332"></a><a id="sthref333"></a><a id="sthref334"></a><a id="sthref335"></a><a id="sthref336"></a><a id="sthref337"></a> If the database runs in <code dir="ltr">ARCHIVELOG</code> mode, then an autobackup is also taken whenever the database structure metadata in the control file changes. A <a href="glossary.htm#i432379"><span class="xrefglossterm">control file autobackup</span></a> enables RMAN to recover the database even if the current control file, recovery catalog, and server parameter file are lost.</p>
<p>Because the file name for the autobackup follows a well-known format, RMAN can search for it without access to a repository and then restore the server parameter file. After you have started the instance with the restored server parameter file, RMAN can restore the control file from an autobackup. After you mount the control file, the RMAN repository is available, and RMAN can restore the data files and find the archived redo logs.</p>
<p><a id="i1019065"></a>You can enable the autobackup feature by running the following command:</p>
<pre dir="ltr">
CONFIGURE CONTROLFILE AUTOBACKUP ON;
</pre>
<p>You can disable the feature by running the following command:</p>
<pre dir="ltr">
CONFIGURE CONTROLFILE AUTOBACKUP OFF;
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">CONFIGURE</code> syntax</div>
<a id="i1015702"></a>
<div id="BRADV8101" class="sect3">
<h4 class="sect3">Configuring the Control File Autobackup Format</h4>
<p><a id="sthref338"></a><a id="sthref339"></a><a id="sthref340"></a><a id="sthref341"></a><a id="sthref342"></a><a id="sthref343"></a>By default, the format of the autobackup file for all configured devices is the substitution variable <code dir="ltr">%F</code> in the <a class="olink RCMRF195" href="../../backup.112/e10643/rcmsubcl010.htm#RCMRF195"><code dir="ltr">FORMAT</code></a> clause. This variable format translates into <code dir="ltr"><span class="codeinlineitalic">c-IIIIIIIIII-YYYYMMDD-QQ</span></code>, with the placeholders defined as follows:</p>
<ul>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">IIIIIIIIII</span></code> stands for the DBID.</p>
</li>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">YYYYMMDD</span></code> is a time stamp of the day the backup is generated.</p>
</li>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">QQ</span></code> is the hexadecimal sequence that starts with <code dir="ltr">00</code> and has a maximum of <code dir="ltr">FF</code>.</p>
</li>
</ul>
<p>You can change the default format by using the following command, where <code dir="ltr"><span class="codeinlineitalic">deviceSpecifier</span></code> is any valid device type, and '<code dir="ltr"><span class="codeinlineitalic">string</span></code>' must contain the substitution variable <code dir="ltr">%F</code> (and no other substitution variables) and is a valid handle for the specified device:</p>
<pre dir="ltr">
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT 
  FOR DEVICE TYPE <span class="italic">deviceSpecifier</span> TO '<span class="italic">string</span>';
</pre>
<p>For example, you can run the following command to specify a nondefault file name for the control file autobackup. In the file name, <code dir="ltr">?</code> stands for <code dir="ltr">ORACLE_HOME</code>.</p>
<pre dir="ltr">
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT 
  FOR DEVICE TYPE DISK TO '?/oradata/cf_%F';
</pre>
<p>The following example configures the autobackup to write to an Automatic Storage Management disk group:</p>
<pre dir="ltr">
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT 
  FOR DEVICE TYPE DISK TO '+dgroup1/%F';
</pre>
<div class="infoboxnotealso">
<p class="notep1">Note:</p>
The valid formats for control file autobackups are: <code dir="ltr">%D</code>, <code dir="ltr">%I</code>, <code dir="ltr">%M</code>, <code dir="ltr">%Y</code>, <code dir="ltr">%F</code>, <code dir="ltr">%T</code>, <code dir="ltr">%d</code>, and <code dir="ltr">%n</code>. If you use formats other than these, you may not be able to restore the control file autobackup.</div>
<p>To clear control file autobackup formats for a device, use the following commands:</p>
<pre dir="ltr">
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK CLEAR;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE sbt CLEAR;
</pre>
<p>If you have set up a <a id="sthref344"></a><a href="glossary.htm#i999320"><span class="xrefglossterm">fast recovery area</span></a> for the database, then you can direct control file autobackups to the fast recovery area by clearing the control file autobackup format for disk.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
All files in the fast recovery area are maintained by Oracle Database and associated file names are maintained in the Oracle Managed Files (OMF) format.</div>
</div>
<!-- class="sect3" -->
<div id="BRADV89408" class="sect3"><a id="sthref345"></a>
<h4 class="sect3">Overriding the Configured Control File Autobackup Format</h4>
<p>The <a class="olink RCMRF153" href="../../backup.112/e10643/rcmsynta2014.htm#RCMRF153"><code dir="ltr">SET</code></a> <code dir="ltr">CONTROLFILE</code> <code dir="ltr">AUTOBACKUP</code> <code dir="ltr">FORMAT</code> command, which you can specify either within a <a class="olink RCMRF151" href="../../backup.112/e10643/rcmsynta2012.htm#RCMRF151"><code dir="ltr">RUN</code></a> command or at the RMAN prompt, overrides the configured autobackup format in the current session only. The order of precedence is:</p>
<ol>
<li>
<p><code dir="ltr">SET CONTROLFILE AUTOBACKUP FORMAT</code> (within a <code dir="ltr">RUN</code> block<code dir="ltr">)</code></p>
</li>
<li>
<p><code dir="ltr">SET CONTROLFILE AUTOBACKUP FORMAT</code> (at <code dir="ltr">RMAN</code> prompt)</p>
</li>
<li>
<p><code dir="ltr">CONFIGURE CONTROLFILE AUTOBACKUP FORMAT</code></p>
</li>
</ol>
<p>The following example shows how the two forms of <code dir="ltr">SET</code> <code dir="ltr">CONTROLFILE</code> <code dir="ltr">AUTOBACKUP</code> <code dir="ltr">FORMAT</code> interact:</p>
<pre dir="ltr">
SET CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO 'controlfile_%F';
BACKUP AS COPY DATABASE;
RUN
{ 
  SET CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/tmp/%F.bck'; 
  BACKUP AS BACKUPSET 
    DEVICE TYPE DISK 
    DATABASE;
}
</pre>
<p>The first <code dir="ltr">SET CONTROLFILE AUTOBACKUP FORMAT</code> controls the name of the control file autobackup until the RMAN client exits, overriding any configured control file autobackup format. The <code dir="ltr">SET CONTROFILE AUTOBACKUP FORMAT</code> in the <code dir="ltr">RUN</code> block overrides the <code dir="ltr">SET CONTROLFILE AUTOBACKUP FORMAT</code> outside the <code dir="ltr">RUN</code> block for the duration of the <code dir="ltr">RUN</code> block.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006526"></a>
<div id="BRADV132" class="sect1">
<h2 class="sect1">Configuring RMAN to Make Backups to a Media Manager</h2>
<p>On most platforms, to back up to and restore from sequential media such as tape you must integrate a <a id="sthref346"></a><a href="glossary.htm#i432922"><span class="xrefglossterm">media manager</span></a> with your Oracle database. You can use <a id="sthref347"></a><a href="glossary.htm#CHDDFGEB"><span class="xrefglossterm">Oracle Secure Backup</span></a>, which supports both database and file system backups to tape, as your media manager. See <a class="olink OBADM" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=OBADM"><span class="italic">Oracle Secure Backup Administrator's Guide</span></a> to learn how to set up RMAN for use specifically with Oracle Secure Backup.</p>
<p>If you do not use Oracle Secure Backup, then you can use a third-party media manager. This section describes the generic steps for configuring RMAN for use with a third-party media manager. The actual steps depend on the media management product that you install and the platform on which you run the database. If you opt to use RMAN with a media manager other than Oracle Secure Backup, then you must obtain all product-specific information from the vendor.</p>
<p>Read the following sections in order when configuring the media manager:</p>
<ol>
<li>
<p><a href="#i1006563">Prerequisites for Using a Media Manager with RMAN</a></p>
</li>
<li>
<p><a href="#i1012741">Determining the Location of the Media Management Library</a></p>
</li>
<li>
<p><a href="#CHDJGJCI">Configuring Media Management Software for RMAN Backups</a></p>
</li>
<li>
<p><a href="#i1006636">Testing Whether the Media Manager Library Is Integrated Correctly</a></p>
</li>
<li>
<p><a href="#i1006801">Configuring SBT Channels for Use with a Media Manager</a></p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmarchi.htm#CHDJBBEC">"Media Management"</a> for an overview of media management software and its implications for RMAN</div>
</li>
</ol>
<a id="i1006563"></a>
<div id="BRADV89409" class="sect2">
<h3 class="sect2">Prerequisites for Using a Media Manager with RMAN</h3>
<p><a id="sthref348"></a><a id="sthref349"></a>Before you can begin using RMAN with a third-party media manager, you must install the media manager and ensure that RMAN can communicate with it. Refer to the media management vendor's software documentation for instructions.</p>
<p><a id="sthref350"></a><a id="sthref351"></a>In general, you should begin by installing and configuring the media management software on the target host or production network. Ensure that you can make non-RMAN backups of operating system files on the target database host. This step makes later troubleshooting much easier by confirming that the basic integration of the media manager with the target host has been successful. Refer to your media management documentation to learn how to back up files to the media manager without using RMAN.</p>
<p>Then, obtain and install the third-party media management module for integration with the database server. This module contains the <a href="glossary.htm#CHDJBACI"><span class="xrefglossterm">media management library</span></a> that the Oracle database loads and uses when accessing the media manager. It is generally a third-party product that must be purchased separately. Contact your media management vendor for details.</p>
</div>
<!-- class="sect2" -->
<a id="i1012741"></a>
<div id="BRADV89410" class="sect2">
<h3 class="sect2">Determining the Location of the Media Management Library</h3>
<p><a id="sthref352"></a><a id="sthref353"></a><a id="sthref354"></a>Before attempting to use RMAN with a media manager, determine the location of the media management library. When allocating or configuring a <a href="glossary.htm#i432240"><span class="xrefglossterm">channel</span></a> for RMAN to use to communicate with a media manager, you must specify the <code dir="ltr">SBT_LIBRARY</code> parameter in an <code dir="ltr">ALLOCATE CHANNEL</code> or <code dir="ltr">CONFIGURE CHANNEL</code> command. The <code dir="ltr">SBT_LIBRARY</code> parameter specifies the path to the library.</p>
<p>The following example shows the channel syntax, where <span class="italic">pathname</span> is the absolute file name of the library:</p>
<pre dir="ltr">
CONFIGURE CHANNEL DEVICE TYPE sbt
  PARMS 'SBT_LIBRARY=<span class="italic">pathname</span>';
</pre>
<p>When RMAN allocates channels to communicate with a media manager, it attempts to load the library indicated by the <code dir="ltr">SBT_LIBRARY</code> parameter.</p>
<p>If you do not provide a value for the <code dir="ltr">SBT_LIBRARY</code> parameter in an allocated or preconfigured channel, then RMAN looks in a platform-specific and secured default location.</p>
<p>On Linux and UNIX, the SBT library is loaded from:</p>
<pre dir="ltr">
/opt/oracle/extapi/[32,64]/{SBT}/{VENDOR}/{VERSION}/libobk.so
</pre>
<p>The SBT library file name extension name varies according to platform:</p>
<ul>
<li>
<p><code dir="ltr">.so</code>, <code dir="ltr">.sl</code> on HP-UX,</p>
</li>
<li>
<p><code dir="ltr">.a</code> on AIX,</p>
</li>
</ul>
<p>On Windows, the SBT library is loaded from:</p>
<pre dir="ltr">
%SYSTEM_DRIVE%\oracle\extapi\[32,64]\{SBT}\{VENDOR}\{VERSION}\orasbt.dll
</pre>
<p>If RMAN cannot use the secured default location or if you are using Oracle Database 11<span class="italic">g</span> or earlier, RMAN loads the SBT library from the location designated by the environment variables <code dir="ltr">PATH</code> or <code dir="ltr">LIBPATH</code>.</p>
<p>In some cases, your organization may have security or regulatory compliance requirements that prohibit the use of environment variables <code dir="ltr">PATH</code> or <code dir="ltr">LIBPATH</code> to designate a library directory. To disable this behavior, set the <code dir="ltr">PARMS</code> string to SBT_SECURE=1.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The default media management library file is <span class="italic">not</span> part of the standard database installation. It is present only if you install third-party media management software.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
Your operating system-specific database documentation and the documentation supplied by your media vendor for instructions on how to achieve media manager integration on your platform</div>
</div>
<!-- class="sect2" -->
<a id="CHDJGJCI"></a>
<div id="BRADV89411" class="sect2">
<h3 class="sect2">Configuring Media Management Software for RMAN Backups</h3>
<p><a id="sthref355"></a><a id="sthref356"></a>After installing the media management software, perform whatever configuration that your vendor requires so that the software can accept RMAN backups. Depending on the type of media management software that you installed, you may have to define media pools, configure users and classes, and so on.</p>
<p>Consult your media management vendor documentation for the appropriate RMAN settings. The <code dir="ltr">PARMS</code> parameter sends instructions to the media manager. If <code dir="ltr">PARMS</code> values are needed for the <a class="olink RCMRF102" href="../../backup.112/e10643/rcmsynta004.htm#RCMRF102"><code dir="ltr">ALLOCATE CHANNEL</code></a> or the <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><code dir="ltr">CONFIGURE CHANNEL</code></a> command, or if a <a class="olink RCMRF195" href="../../backup.112/e10643/rcmsubcl010.htm#RCMRF195"><code dir="ltr">FORMAT</code></a> string is recommended for <a id="sthref357"></a><a id="sthref358"></a>the <a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><code dir="ltr">BACKUP</code></a> or <code dir="ltr">CONFIGURE</code> command, then refer to the vendor documentation for this information.</p>
<p><a href="#CHDCDBHB">Example 5-6</a> shows a <code dir="ltr">PARMS</code> setting for Oracle Secure Backup. This <code dir="ltr">PARMS</code> settings instructs the media manager to back up to a family of tapes called <code dir="ltr">datafile_mf</code>. The <code dir="ltr">PARMS</code> settings are always vendor-specific.</p>
<div id="BRADV569" class="example">
<p class="titleinexample"><a id="CHDCDBHB"></a>Example 5-6 PARMS Setting for Oracle Secure Backup</p>
<pre dir="ltr">
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE'
  PARMS 'ENV=(OB_MEDIA_FAMILY=datafile_mf)';
</pre></div>
<!-- class="example" -->
<div class="infoboxnotealso">
<p class="notep1"><span class="bold">See Also</span>:</p>
<ul>
<li>
<p><a class="olink RCMRF102" href="../../backup.112/e10643/rcmsynta004.htm#RCMRF102"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">ALLOCATE</code> <code dir="ltr">CHANNEL</code> syntax</p>
</li>
<li>
<p><a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for channel control options</p>
</li>
<li>
<p><a class="olink OBREF8000" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=OBREF8000"><span class="italic">Oracle Secure Backup Reference</span></a> for RMAN-specific parameter settings for Oracle Secure Backup</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i1006636"></a>
<div id="BRADV89412" class="sect2">
<h3 class="sect2">Testing Whether the Media Manager Library Is Integrated Correctly</h3>
<p><a id="sthref359"></a><a id="sthref360"></a><a id="sthref361"></a><a id="sthref362"></a><a id="sthref363"></a><a id="sthref364"></a>After you have confirmed that the database server can load the media management library, test to ensure that RMAN can back up to the media manager.</p>
<a id="i1006693"></a>
<div id="BRADV89413" class="sect3">
<h4 class="sect3">Testing ALLOCATE CHANNEL on the Media Manager</h4>
<p>The following steps use the <code dir="ltr">ALLOCATE CHANNEL</code> command to perform a basic test of RMAN communication with the media manager.</p>
<p class="subhead2"><a id="BRADV169"></a>To test channel allocation on the media manager:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and a recovery catalog (if used).</p>
</li>
<li>
<p>Run the <code dir="ltr">ALLOCATE</code> <code dir="ltr">CHANNEL</code> command with the <code dir="ltr">PARMS</code> required by your media management software.</p>
<p>The following <code dir="ltr">RUN</code> command shows sample vendor-specific <code dir="ltr">PARMS</code> settings:</p>
<pre dir="ltr">
RUN
{
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt
    PARMS 'SBT_LIBRARY=/mydir/lib/libobk.so,
    ENV=(OB_DEVICE=drive1,OB_MEDIA_FAMILY=datafile_mf)';
}
</pre></li>
<li>
<p>Examine the RMAN output.</p>
<p>If you do not receive an error message, then the database successfully loaded the media management library. If you receive the <code dir="ltr">ORA-27211</code> error, the media management library could not be loaded:</p>
<pre dir="ltr">
RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-03009: failure of allocate command on c1 channel at 11/30/2007 13:57:18
ORA-19554: error allocating device, device type: SBT_TAPE, device name: 
ORA-27211: Failed to load Media Management Library
Additional information: 25
</pre>
<p>In this case, check the media management installation to ensure that the library is correctly installed, and recheck the value for the <code dir="ltr">SBT_LIBRARY</code> parameter as described in <a href="#i1012741">"Determining the Location of the Media Management Library"</a>.</p>
<p>If the database cannot locate a media management library in the location specified by the <code dir="ltr">SBT_LIBRARY</code> parameter or the default location, then RMAN issues an <code dir="ltr">ORA-27211</code> error and exits.</p>
</li>
</ol>
<p>Whenever channel allocation fails, the database writes a trace file to the <code dir="ltr">trace</code> subdirectory in the <a id="sthref365"></a><a href="glossary.htm#CHDDAHBD"><span class="xrefglossterm">Automatic Diagnostic Repository (ADR)</span></a> home directory. The following shows sample output:</p>
<pre dir="ltr">
SKGFQ OSD: Error in function sbtinit on line 2278
SKGFQ OSD: Look for SBT Trace messages in file /oracle/rdbms/log/sbtio.log
SBT Initialize failed for /oracle/lib/libobk.so
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMIN005" href="../../server.112/e25494/monitoring.htm#ADMIN005"><span class="italic">Oracle Database Administrator's Guide</span></a> to learn how to use the Automatic Diagnostic Repository to monitor database operations</div>
</div>
<!-- class="sect3" -->
<a id="i1006735"></a>
<div id="BRADV89414" class="sect3">
<h4 class="sect3">Testing Backup and Restore Operations on the Media Manager</h4>
<p><a id="sthref366"></a><a id="sthref367"></a><a id="sthref368"></a>After testing a channel allocation on the media manager, create and restore a test backup. For example, you can use the command in <a href="#CHDDDJGD">Example 5-7</a> (substituting the channel settings required by your media management vendor) to test whether a backup can be created on the media manager. If your database does not use a server parameter file, then back up the current control file instead.</p>
<div id="BRADV570" class="example">
<p class="titleinexample"><a id="CHDDDJGD"></a>Example 5-7 Backing Up the Server Parameter File to Tape</p>
<pre dir="ltr">
RUN
{
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt
    PARMS 'SBT_LIBRARY=/mydir/lib/libobk.so,
    ENV=(OB_DEVICE=drive1,OB_MEDIA_FAMILY=datafile_mf)';
  BACKUP SPFILE;
  # If your database does not use a server parameter file, use:
  # BACKUP CURRENT CONTROLFILE;
}
</pre></div>
<!-- class="example" -->
<p>If the backup succeeds, then attempt to restore the server parameter file as an initialization parameter file. <a href="#CHDDDCBE">Example 5-8</a> restores the backup created in <a href="#CHDDDJGD">Example 5-7</a> to a temporary directory.</p>
<div id="BRADV171" class="example">
<p class="titleinexample"><a id="CHDDDCBE"></a>Example 5-8 Restoring the Server Parameter File from Tape</p>
<pre dir="ltr">
RUN
{
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt
    PARMS 'SBT_LIBRARY=/mydir/lib/libobk.so,
    ENV=(OB_DEVICE=drive1,OB_MEDIA_FAMILY=datafile_mf)';
  RESTORE SPFILE TO PFILE '/tmp/test_restore.f';
  # If your database does not use a server parameter file, use:
  # RESTORE CURRENT CONTROLFILE TO '/tmp/test_restore.f';
}
</pre></div>
<!-- class="example" -->
<p>If the backup and restore operations succeed, then you are ready to use the media manager with RMAN. Possible failures include the following cases:</p>
<ul>
<li>
<p>The backup hangs.</p>
<p>A hanging backup usually indicates that the media manager is waiting to mount a tape. Check if there are any media manager jobs in tape mount request mode and fix the problem. Ensure that the steps in <a href="#i1006526">"Configuring RMAN to Make Backups to a Media Manager"</a> are correctly done.</p>
</li>
<li>
<p>The backup fails with <code dir="ltr">ORA-27211: Failed to load Media Management Library</code>.</p>
<p>This error indicates that the media management software is not correctly configured. Ensure that the steps in <a href="#i1006526">"Configuring RMAN to Make Backups to a Media Manager"</a> are correctly done. Also, ensure that you have the <code dir="ltr">PARMS</code> and <code dir="ltr">FORMAT</code> strings required by your media management software.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmtroub.htm#i1006546">"Testing the Media Management API"</a> and <a href="rcmtroub.htm#BGBFHJAH">Chapter 23, "Troubleshooting RMAN Operations"</a></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1006801"></a>
<div id="BRADV89415" class="sect2">
<h3 class="sect2">Configuring SBT Channels for Use with a Media Manager</h3>
<p>This section describes how to configure channels for use with a media manager. For an overview of configured channels and how they are used, refer to the section <a href="rcmconfa.htm#i1006906">"Configuring Advanced Channel Options"</a>.</p>
<div id="BRADV89416" class="sect3"><a id="sthref369"></a>
<h4 class="sect3">About Media Manager Backup Piece Names</h4>
<p><a id="sthref370"></a><a id="sthref371"></a>A <a href="glossary.htm#i432114"><span class="xrefglossterm">backup piece</span></a> name is determined by the <a class="olink RCMRF195" href="../../backup.112/e10643/rcmsubcl010.htm#RCMRF195"><code dir="ltr">FORMAT</code></a> string specified in <a id="sthref372"></a><a id="sthref373"></a>the <code dir="ltr">BACKUP</code> command, <code dir="ltr">CONFIGURE</code> <code dir="ltr">CHANNEL</code> command, or <code dir="ltr">ALLOCATE</code> <code dir="ltr">CHANNEL</code> command. The media manager considers the backup piece name as the name of the backup file, so every backup piece must have a unique name in the <a href="glossary.htm#CHDIEBEA"><span class="xrefglossterm">media management catalog</span></a>.</p>
<p>You can use the <a id="sthref374"></a>substitution variables in a <code dir="ltr">FORMAT</code> parameter to generate unique backup piece names. For example, <code dir="ltr">%d</code> specifies the name of the database, whereas <code dir="ltr">%t</code> specifies the backup time stamp. For most purposes, you can use <code dir="ltr">%U</code>, in which case RMAN automatically generates a unique file name. The backup piece name <code dir="ltr">12i1nk47_1_1</code> is an example. If you do not specify the <code dir="ltr">FORMAT</code> parameter, then RMAN automatically generates a unique file name with the <code dir="ltr">%U</code> substitution variable.</p>
<p>Your media manager may impose restrictions on file names and sizes. In this case, you may need more control over the naming of backup pieces so that they obey media manager restrictions. For example, some media managers only support a 14-character backup piece name, and some require special <code dir="ltr">FORMAT</code> strings. The unique names generated by the <code dir="ltr">%U</code> substitution variable do not exceed 14 characters.</p>
<p>Some <a id="sthref375"></a>media managers may have limits on the maximum size of files that they can back up or restore. You must ensure that RMAN does not produce backup sets larger than those limits. To limit backup piece sizes, use the parameter <a id="sthref376"></a><code dir="ltr">MAXPIECESIZE</code>, which you can set in the <code dir="ltr">CONFIGURE</code> <code dir="ltr">CHANNEL</code> and <code dir="ltr">ALLOCATE</code> <code dir="ltr">CHANNEL</code> commands.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink RCMRF104" href="../../backup.112/e10643/rcmsubcl001.htm#RCMRF104"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> and <a href="rcmcncpt.htm#i1016352">"Number and Size of Backup Pieces"</a> to learn how to set <code dir="ltr">MAXPIECESIZE</code></p>
</li>
<li>
<p><a class="olink RCMRF195" href="../../backup.112/e10643/rcmsubcl010.htm#RCMRF195"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for the complete list of variables allowable in format strings with the <code dir="ltr">BACKUP</code> command</p>
</li>
<li>
<p>Your media management documentation to determine the string character limit for the media manager</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CHDHGDHH"></a>
<div id="BRADV89417" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Configuring Automatic SBT Channels</h4>
<p>The easiest technique for backing up to a media manager is to configure automatic <a id="sthref377"></a><a href="glossary.htm#CHDCCBFI"><span class="xrefglossterm">SBT</span></a> channels. As explained in <a href="#i1017851">"Configuring the Default Device for Backups: Disk or SBT"</a>, you can use a tape device as your default backup destination.</p>
<p class="subhead2"><a id="BRADV571"></a>To configure channels for use with a media manager:</p>
<ol>
<li>
<p>Configure a generic SBT channel.</p>
<p>In the configuration, enter all parameters that you tested <a href="#i1006735">"Testing Backup and Restore Operations on the Media Manager"</a>. The following example configures vendor-specific channel parameters and sets the default device:</p>
<pre dir="ltr">
CONFIGURE CHANNEL DEVICE TYPE sbt 
  PARMS 'ENV=(OB_RESOURCE_WAIT_TIME=1minute,OB_DEVICE=tape1)';
</pre></li>
<li>
<p>Configure the default device type to SBT, as shown in the following command:</p>
<pre dir="ltr">
CONFIGURE DEFAULT DEVICE TYPE TO sbt;
</pre>
<p>If you use multiple tape devices, then you must specify the channel parallelism as described in <a href="#i1015006">"Configuring Parallel Channels for Disk and SBT Devices"</a>. The following configuration enables you to back up to two tape drives in parallel:</p>
<pre dir="ltr">
CONFIGURE DEVICE TYPE sbt PARALLELISM 2;
</pre>
<p>Optionally, check your channel configuration by running the following command:</p>
<pre dir="ltr">
SHOW CHANNEL FOR DEVICE TYPE sbt;
</pre></li>
<li>
<p>Make a test backup to tape.</p>
<p>The following command backs up the server parameter file to tape:</p>
<pre dir="ltr">
BACKUP SPFILE;
</pre></li>
<li>
<p>List your backups to ensure that the test backup went to the media manager:</p>
<pre dir="ltr">
LIST BACKUP OF SPFILE;
</pre></li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1019160"></a>
<div id="BRADV8183" class="sect1">
<h2 class="sect1">Configuring the Fast Recovery Area</h2>
<p>As explained in <a href="rcmarchi.htm#CHDGFGAA">"Fast Recovery Area"</a>, the <a id="sthref378"></a><a href="glossary.htm#i999320"><span class="xrefglossterm">fast recovery area</span></a> feature enables you to set up a disk area where the database can create and manage a variety of files related to backup and recovery. Use of the fast recovery area is strongly recommended. Consider configuring a fast recovery area as a first step in implementing a <a id="sthref379"></a>backup strategy.</p>
<p>This section outlines the functions of the fast recovery area, identifies the files stored there, explains the rules for file management, and introduces the most important configuration options. This section contains the following topics:</p>
<ul>
<li>
<p><a href="#CHDIBECI">Overview of the Fast Recovery Area</a></p>
</li>
<li>
<p><a href="#i1019244">Enabling the Fast Recovery Area</a></p>
</li>
<li>
<p><a href="#BGBBJHEA">Disabling the Fast Recovery Area</a></p>
</li>
<li>
<p><a href="#CHDBJJAA">Configuring Locations for Control Files and Redo Logs</a></p>
</li>
<li>
<p><a href="#CEGJFJEH">Configuring RMAN File Creation in the Fast Recovery Area</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmmaint.htm#i1009331">"Maintaining the Fast Recovery Area"</a></div>
<a id="CHDIBECI"></a>
<div id="BRADV89418" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Overview of the Fast Recovery Area</h3>
<p>The <a id="sthref380"></a>fast recovery area can contain control files, online redo logs, archived redo logs, flashback logs, and RMAN backups. Files in the recovery area are <span class="italic">permanent</span> or t<span class="italic">ransient.</span> Permanent files are active files used by the database instance. All files that are not permanent are transient. In general, Oracle Database eventually deletes transient files after they become obsolete under the <a id="sthref381"></a><a href="glossary.htm#i432137"><span class="xrefglossterm">backup retention policy</span></a> or have been backed up to tape.</p>
<p>The fast recovery area is an Oracle Database managed space that can be used to hold RMAN disk backups, control file autobackups and archived redo log files. The files placed in this location are maintained by Oracle Database and the generated file names are maintained in Oracle Managed Files (OMF) format.</p>
<p><a href="#CHDIJCHG">Table 5-2</a> describes the files in the recovery area, the classification of each file as permanent or temporary, and how database availability is affected.</p>
<div id="BRADV173" class="tblruleformalwide">
<p class="titleintable"><a id="sthref382"></a><a id="CHDIJCHG"></a>Table 5-2 Files in the Fast Recovery Area</p>
<table class="cellalignment1945" title="Files in the Fast Recovery Area" summary="Describes the files in the flash recovery area, the classification of each file as permanent or temporary, and how database availability is affected if the flash recovery area is inaccessible." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t26">Files</th>
<th class="cellalignment1941" id="r1c2-t26">Type</th>
<th class="cellalignment1941" id="r1c3-t26">Database Behavior When Fast Recovery Area Is Inaccessible</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t26" headers="r1c1-t26">
<p><a id="sthref383"></a><a id="sthref384"></a>Multiplexed copies of the current control file</p>
</td>
<td class="cellalignment1942" headers="r2c1-t26 r1c2-t26">
<p>Permanent</p>
</td>
<td class="cellalignment1942" headers="r2c1-t26 r1c3-t26">
<p>The instance fails if the database cannot write to a multiplexed copy of the control file stored in the fast recovery area. Failure occurs even if accessible multiplexed copies are located outside the recovery area.</p>
<p><span class="bold">See Also:</span> <a href="#CHDCFJDC">"Configuring Control File Locations"</a> to learn how to configure control files in the recovery area</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t26" headers="r1c1-t26">
<p>Online redo log files</p>
</td>
<td class="cellalignment1942" headers="r3c1-t26 r1c2-t26">
<p>Permanent</p>
</td>
<td class="cellalignment1942" headers="r3c1-t26 r1c3-t26">
<p>Instance availability is not affected if a mirrored copy of the online redo log exists in an accessible location outside the fast recovery area. Otherwise, the instance fails.</p>
<p><span class="bold">See Also:</span> <a href="#CHDJEHIE">"Configuring Online Redo Log Locations"</a> to learn how to configure online redo logs in the recovery area</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t26" headers="r1c1-t26">
<p>Archived redo log files</p>
</td>
<td class="cellalignment1942" headers="r4c1-t26 r1c2-t26">
<p>Transient</p>
</td>
<td class="cellalignment1942" headers="r4c1-t26 r1c3-t26">
<p>Instance availability is not affected if the log is archived to an accessible location outside the fast recovery area. Otherwise, the database eventually halts because it cannot archive the online redo logs.</p>
<p><span class="bold">See Also:</span> <a href="#CHDEHHDH">"Configuring Archived Redo Log Locations"</a> to learn how to configure archived redo logs in the recovery area</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r5c1-t26" headers="r1c1-t26">
<p>Foreign archived redo log files</p>
</td>
<td class="cellalignment1942" headers="r5c1-t26 r1c2-t26">
<p>Transient</p>
</td>
<td class="cellalignment1942" headers="r5c1-t26 r1c3-t26">
<p>Instance availability is not affected.</p>
<p><span class="bold">Note:</span> Foreign archived redo logs are received by a logical standby database for a LogMiner session. Unlike a normal archived log, a <a href="glossary.htm#CHDJCIFH"><span class="xrefglossterm">foreign archived redo log</span></a> is associated with a different DBID. For this reason, it cannot be backed up or restored on a logical standby database.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r6c1-t26" headers="r1c1-t26">
<p>Image copies of data files and control files</p>
</td>
<td class="cellalignment1942" headers="r6c1-t26 r1c2-t26">
<p>Transient</p>
</td>
<td class="cellalignment1942" headers="r6c1-t26 r1c3-t26">
<p>Instance availability is not affected.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r7c1-t26" headers="r1c1-t26">
<p>Backup pieces</p>
</td>
<td class="cellalignment1942" headers="r7c1-t26 r1c2-t26">
<p>Transient</p>
</td>
<td class="cellalignment1942" headers="r7c1-t26 r1c3-t26">
<p>Instance availability is not affected.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r8c1-t26" headers="r1c1-t26">
<p>Flashback logs</p>
</td>
<td class="cellalignment1942" headers="r8c1-t26 r1c2-t26">
<p>Transient</p>
</td>
<td class="cellalignment1942" headers="r8c1-t26 r1c3-t26">
<p>Instance availability is not affected if guaranteed restore points are not defined. In this case, the database automatically disables Flashback Database, writes a message to the alert log, and continues with database processing. If guaranteed restore points are configured, the instance fails because of interdependencies on the flashback logs.</p>
<p>The <a href="glossary.htm#CHDHJFEH"><span class="xrefglossterm">Oracle Flashback Database</span></a> feature, which provides a convenient alternative to <a href="glossary.htm#i999787"><span class="xrefglossterm">database point-in-time recovery (DBPITR)</span></a>, generates <a href="glossary.htm#CHDFHAAE"><span class="xrefglossterm">flashback logs</span></a>. These logs are transient files and must be stored in the fast recovery area. Unlike other transient files, flashback logs cannot be backed up to other media. If the fast recovery area has insufficient space to store flashback logs and meet other backup retention requirements, then the recovery area may delete flashback logs.</p>
<p><span class="bold">See Also:</span> <a href="flashdb.htm#CFHHEEII">"Enabling Flashback Database"</a> to learn how to enable flashback logging</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformalwide" -->
<p>If you are on a Windows platform, then you can use the <a id="sthref385"></a><a href="glossary.htm#CHDEJEIH"><span class="xrefglossterm">Volume Shadow Copy Service (VSS)</span></a> with the <a id="sthref386"></a><a href="glossary.htm#CHDGEECJ"><span class="xrefglossterm">Oracle VSS writer</span></a>. In this case, the fast recovery area automates management of files that are backed up in a VSS snapshot and deletes them as needed.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmflash.htm#g1016666">Chapter 18, "Performing Flashback and Database Point-in-Time Recovery"</a></p>
</li>
<li>
<p><a class="olink NTQRF" href="../../win.112/e10845/toc.htm"><span class="italic">Oracle Database Platform Guide for Microsoft Windows</span></a> to learn about making backups in a VSS environment</p>
</li>
</ul>
</div>
<div id="BRADV89419" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref387"></a>
<h4 class="sect3">Oracle Managed Files and Automatic Storage Management</h4>
<p>The <a id="sthref388"></a><a id="sthref389"></a>fast recovery area can be used with <a href="glossary.htm#CHDIGFCB"><span class="xrefglossterm">Oracle Managed Files (OMF)</span></a> and <a href="glossary.htm#CHDBDJIJ"><span class="xrefglossterm">Automatic Storage Management (ASM)</span></a>. Because the fast recovery area is built on top of OMF, so it can be stored anywhere that Oracle Managed Files can. You can also use the recovery area with ASM.</p>
<p>Even if you choose not to set up the fast recovery area in ASM storage, you can still use Oracle Managed Files to manage your backup files in an ASM disk group. However, you lose a major benefit of the fast recovery area: the automatic deletion of files no longer needed to meet your recoverability goals as space is needed for more recent backups. Nevertheless, the other automatic features of OMF still function.</p>
<p>When your store backups, using OMF on top of ASM without using a fast recovery area is supported but discouraged. It is awkward to directly manipulate files under ASM.</p>
</div>
<!-- class="sect3" -->
<a id="CHDJDBIG"></a>
<div id="BRADV89420" class="sect3">
<h4 class="sect3">How Oracle Manages Disk Space in the Fast Recovery Area</h4>
<p><a id="sthref390"></a>Space in the fast recovery area is balanced among backups and archived logs that must be kept according to the retention policy, and other files that may be subject to deletion. Oracle Database does not delete eligible files from the fast recovery area until the space must be reclaimed for some other purpose. Files recently moved to tape are often still available on disk for use in recovery. The recovery area can thus serve as a cache for tape. When the fast recovery area is full, Oracle Database automatically deletes eligible files to reclaim space in the recovery area as needed.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmmaint.htm#CHDHHAJF">"Deletion Rules for the Fast Recovery Area"</a> and <a href="rcmmaint.htm#i1009006">"Responding to a Full Fast Recovery Area"</a></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1019244"></a>
<div id="BRADV89425" class="sect2">
<h3 class="sect2">Enabling the Fast Recovery Area</h3>
<p><a id="sthref391"></a>You enable the fast recovery area by setting two initialization parameters. These parameters enable the fast recovery area without having to shut down and restart the database instance.</p>
<p>You set the size of the fast recovery area with the parameter <code dir="ltr">DB_RECOVERY_FILE_DEST_SIZE</code> first, and then you set the physical location of the flash recovery files with the parameter <code dir="ltr">DB_RECOVERY_FILE_DEST</code>.</p>
<p><a href="#CHDDJJHE">Table 5-3</a> discusses both the mandatory and optional parameters for enabling the fast recovery area.</p>
<p>In an Oracle Real Application Clusters (Oracle RAC) database, all instances must have the same values for these initialization parameters. The location must be on a cluster file system, ASM, or a shared directory.</p>
<div id="BRADV572" class="tblruleformalwide">
<p class="titleintable"><a id="sthref392"></a><a id="CHDDJJHE"></a>Table 5-3 Initialization Parameters for the Fast Recovery Area</p>
<table class="cellalignment1945" title="Initialization Parameters for the Fast Recovery Area" summary="This table describes the DB_RECOVERY_FILE_DEST_SIZE and DB_RECOVERY_FILE_DEST parameters." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t29">Initialization Parameter</th>
<th class="cellalignment1941" id="r1c2-t29">Required</th>
<th class="cellalignment1941" id="r1c3-t29">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t29" headers="r1c1-t29">
<p><a class="olink REFRN10235" href="../../server.112/e40402/initparams066.htm#REFRN10235"><code dir="ltr">DB_RECOVERY_FILE_DEST_SIZE</code></a></p>
</td>
<td class="cellalignment1942" headers="r2c1-t29 r1c2-t29">
<p>Yes</p>
</td>
<td class="cellalignment1942" headers="r2c1-t29 r1c3-t29">
<p>Specifies the <a href="glossary.htm#i998969"><span class="xrefglossterm">disk quota</span></a>, which is maximum storage in bytes of data to be used by the recovery area for this database. You must set this parameter <span class="italic">before</span> <code dir="ltr"><a id="sthref393"></a>DB_RECOVERY_FILE_DEST</code>.</p>
<p>The <code dir="ltr"><a id="sthref394"></a>DB_RECOVERY_FILE_DEST_SIZE</code> setting does not include the following kinds of disk overhead:</p>
<ul>
<li>
<p>Block 0 or the operating system block header of each Oracle Database file is not included.</p>
<p>Allow an extra 10% for this data when computing the actual disk usage required for the fast recovery area.</p>
</li>
<li>
<p><code dir="ltr">DB_RECOVERY_FILE_DEST_SIZE</code> does not indicate the real size occupied on disk when the underlying file system is mirrored, compressed, or affected by overhead not known to Oracle Database.</p>
<p>For example, if the recovery area is on a two-way mirrored ASM disk group, each file of <span class="italic">x</span> bytes occupies 2<span class="italic">x</span> bytes on the ASM disk group. In this case, set <code dir="ltr">DB_RECOVERY_FILE_DEST_SIZE</code> to no more than half the size of the disks for the ASM disk group. Likewise, when using a three-way mirrored ASM disk group, <code dir="ltr">DB_RECOVERY_FILE_DEST_SIZE</code> must be no greater than one third the size of the disks in the disk group, and so on.</p>
</li>
</ul>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t29" headers="r1c1-t29">
<p><a class="olink REFRN10234" href="../../server.112/e40402/initparams065.htm#REFRN10234"><code dir="ltr">DB_RECOVERY_FILE_DEST</code></a></p>
</td>
<td class="cellalignment1942" headers="r3c1-t29 r1c2-t29">
<p>Yes</p>
</td>
<td class="cellalignment1942" headers="r3c1-t29 r1c3-t29">
<p>Specifies the recovery area location, which can be a file system directory or ASM disk group, but not a raw disk. The location must be large enough for the disk quota.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t29" headers="r1c1-t29">
<p><a class="olink REFRN10233" href="../../server.112/e40402/initparams061.htm#REFRN10233"></a><a id="sthref395"></a>DB_FLASHBACK_RETENTION_TARGET</p>
</td>
<td class="cellalignment1942" headers="r4c1-t29 r1c2-t29">
<p>No</p>
</td>
<td class="cellalignment1942" headers="r4c1-t29 r1c3-t29">
<p>Specifies the upper limit (in minutes) on how far back in time the database may be flashed back. This parameter is required only for Flashback Database.</p>
<p>This parameter indirectly determines how much flashback log data is kept in the recovery area. The size of flashback logs generated by the database can vary considerably depending on the database workload. If more blocks are affected by database updates during a given interval, then more disk space is used by the flashback log data generated for that interval.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformalwide" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF00902" href="../../server.112/e41084/statements_2014.htm#SQLRF00902"><span class="italic">Oracle Database SQL Language Reference</span></a> for <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> syntax, and <a class="olink ADMIN002" href="../../server.112/e25494/create.htm#ADMIN002"><span class="italic">Oracle Database Administrator's Guide</span></a> for details on setting and changing database initialization parameters</div>
<a id="i1019211"></a>
<div id="BRADV89422" class="sect3">
<h4 class="sect3">Considerations When Setting the Size of the Fast Recovery Area</h4>
<p><a id="sthref396"></a>The larger the fast recovery area is, the more useful it becomes. Ideally, the fast recovery area should be large enough to contain the files listed in <a href="#CHDIJCHG">Table 5-2</a>. The recovery area should be able to contain a copy of all data files in the database and the incremental backups used by your chosen backup strategy.</p>
<p>If providing this much space is impractical, then it is best to create an area large enough to keep a backup of the most important tablespaces and all the archived logs not yet on tape. At an absolute minimum, the fast recovery area must be large enough to contain the archived redo logs not yet on tape. If the recovery area has insufficient space to store new flashback logs and meet other backup retention requirements, then to make room, the recovery area may delete older flashback logs.</p>
<p>Formulas for estimating a useful fast recovery area size depend on whether:</p>
<ul>
<li>
<p>Your database has a small or large number of data blocks that change frequently</p>
</li>
<li>
<p>You store backups only on disk, or on disk and tape</p>
</li>
<li>
<p>You use a redundancy-based <a href="glossary.htm#i432137"><span class="xrefglossterm">backup retention policy</span></a>, or a recovery window-based retention policy</p>
</li>
<li>
<p>You plan to use Flashback Database or a <a id="sthref397"></a><a href="glossary.htm#CHDIBIJF"><span class="xrefglossterm">guaranteed restore point</span></a> as alternatives to <a href="glossary.htm#i433615"><span class="xrefglossterm">point-in-time recovery</span></a> in response to logical errors</p>
</li>
</ul>
<p>If you plan to enable flashback logging, then the volume of flashback log generation is approximately the same order of magnitude as redo log generation. For example, if you intend to set <a id="sthref398"></a><code dir="ltr">DB_FLASHBACK_RETENTION_TARGET</code> to 24 hours, and if the database generates 20 gigabytes of redo in a day, then a general rule of thumb is to allow 20 GB to 30 GB of disk space for the flashback logs. The same rule applies to guaranteed restore points when flashback logging is enabled. For example, if the database generates 20 GB of redo every day, and if the guaranteed restore point is kept for a day, then plan to allocate 20 to 30 GB.</p>
<p>Suppose that you want to determine the size of a fast recovery area when the backup retention policy is set to <code dir="ltr">REDUNDANCY 1</code> and you intend to follow Oracle's suggested strategy of using an <a href="glossary.htm#CHDIGHBJ"><span class="xrefglossterm">incrementally updated backup</span></a>. In this example, you use the following formula to estimate the disk quota, where <span class="italic">n</span> is the interval in days between incremental updates and <span class="italic">y</span> is the delay in applying the foreign archived redo logs on a logical standby database:</p>
<pre dir="ltr">
Disk Quota =
Size of a copy of database +
Size of an incremental backup +
Size of (n+1) days of archived redo logs +
Size of (y+1) days of foreign archived redo logs (for logical standby) +
Size of control file +
Size of an online redo log member * number of log groups +
Size of flashback logs (based on DB_FLASHBACK_RETENTION_TARGET value)
</pre></div>
<!-- class="sect3" -->
<div id="BRADV90060" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref399"></a>
<h4 class="sect3">Considerations When Setting the Location of the Fast Recovery Area</h4>
<p><a id="sthref400"></a>Place the fast recovery area on a separate disk from the <a href="glossary.htm#CHDEJGJH"><span class="xrefglossterm">database area</span></a>, where the database maintains active database files such as data files, control files, and online redo logs. Keeping the fast recovery area on the same disk as the database area exposes you to loss of both your live database files and backups if a media failure occurs.</p>
<p>Oracle recommends that <code dir="ltr">DB_RECOVERY_FILE_DEST</code> be set to a different value from <code dir="ltr">DB_CREATE_FILE_DEST</code> or any of the <code dir="ltr">DB_CREATE_ONLINE_LOG_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> initialization parameters. The database writes a warning to the alert log if <code dir="ltr">DB_RECOVERY_FILE_DEST</code> equals these parameters.</p>
<p>Multiple databases can have the same value for <code dir="ltr">DB_RECOVERY_FILE_DEST</code>, but one of the following must be true:</p>
<ul>
<li>
<p>No two databases for which the <a class="olink REFRN10242" href="../../server.112/e40402/initparams070.htm#REFRN10242"><code dir="ltr">DB_UNIQUE_NAME</code></a> initialization parameters are specified have the same value for <code dir="ltr">DB_UNIQUE_NAME</code>.</p>
</li>
<li>
<p>For those databases where no <code dir="ltr">DB_UNIQUE_NAME</code> is provided, no two databases have the same value for <a class="olink REFRN10041" href="../../server.112/e40402/initparams064.htm#REFRN10041"><code dir="ltr">DB_NAME</code></a>.</p>
</li>
</ul>
<p>When databases share a single recovery area in this way, the location should be large enough to hold the files for all databases. Add the values for <code dir="ltr">DB_RECOVERY_FILE_DEST_SIZE</code> for the databases, then allow for overhead such as mirroring or compression.</p>
</div>
<!-- class="sect3" -->
<a id="BABJJCHF"></a>
<div id="BRADV89424" class="sect3">
<h4 class="sect3">Setting the Fast Recovery Area Location and Initial Size</h4>
<p><a href="#CHDDJJHE">Table 5-3</a> lists the initialization parameters that you must set to enable the fast recovery area. This section explains how to specify a location for the recovery area and set its initial size.</p>
<p class="subhead2"><a id="BRADV573"></a>To determine the optimum size for the fast recovery area:</p>
<ol>
<li id="CHDJBFCA">
<p>If you plan to use flashback logging or guaranteed restore points, then <a id="sthref401"></a>query <code dir="ltr">V$ARCHIVED_LOG</code> to determine how much redo the database generates in the time to which you intend to set <code dir="ltr"><a id="sthref402"></a>DB_FLASHBACK_RETENTION_TARGET</code>.</p>
</li>
<li>
<p>Set the recovery area size.</p>
<p>If you plan to use flashback logging or guaranteed restore points, then ensure that the size value obtained from Step <a href="#CHDJBFCA">1</a> is incorporated into the setting. Set the <code dir="ltr">DB_RECOVERY_FILE_DEST_SIZE</code> initialization parameter by any of the following means:</p>
<ul>
<li>
<p>Shut down the database and set the <code dir="ltr">DB_RECOVERY_FILE_DEST_SIZE</code> parameter in the initialization parameter file of the database, as shown in the following example:</p>
<pre dir="ltr">
DB_RECOVERY_FILE_DEST_SIZE = 10G
</pre></li>
<li>
<p>Specify the parameter with the SQL statement <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">SET</code> when the database is open, as shown in the following examples:</p>
<pre dir="ltr">
ALTER SYSTEM SET 
  DB_RECOVERY_FILE_DEST_SIZE = 10G 
  SCOPE=BOTH SID='*';
</pre></li>
<li>
<p>Use the Database Configuration Assistant to set the size.</p>
</li>
</ul>
</li>
<li>
<p>Set the recovery area location.</p>
<p>Set the initialization parameters by any of the following means:</p>
<ul>
<li>
<p>Set <code dir="ltr">DB_RECOVERY_FILE_DEST</code> in the initialization parameter file of the database, as shown in the following example:</p>
<pre dir="ltr">
DB_RECOVERY_FILE_DEST = '/u01/oradata/rcv_area'
</pre></li>
<li>
<p>Specify <code dir="ltr">DB_RECOVERY_FILE_DEST</code> with the SQL statement <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">SET</code> when the database is open, as shown in the following example:</p>
<pre dir="ltr">
ALTER SYSTEM SET
  DB_RECOVERY_FILE_DEST = '+disk1' 
  SCOPE=BOTH SID='*';
</pre></li>
<li>
<p>Use the Database Configuration Assistant to set the location.</p>
</li>
</ul>
<p>If you do <span class="italic">not</span> plan to use flashback logging, then open the database (if it is closed) and do not complete the rest of the steps in this procedure.</p>
</li>
<li>
<p>If flashback logging is enabled, then run the database under a normal workload for the time period specified by <code dir="ltr">DB_FLASHBACK_RETENTION_TARGET</code>.</p>
<p>In this way, the database can generate a representative sample of flashback logs.</p>
</li>
<li>
<p><a id="sthref403"></a>Query <a id="sthref404"></a>the <a class="olink REFRN30300" href="../../server.112/e40402/dynviews_1144.htm#REFRN30300"><code dir="ltr">V$FLASHBACK_DATABASE_LOG</code></a> view as follows:</p>
<pre dir="ltr">
SELECT ESTIMATED_FLASHBACK_SIZE 
FROM   V$FLASHBACK_DATABASE_LOG;
</pre>
<p>The result is an estimate of the disk space needed to meet the current flashback retention target, based on the database workload since Flashback Database was enabled.</p>
</li>
<li>
<p>If necessary, adjust the flashback log space requirement based on the actual size of flashback logs generated during the time period specified by <code dir="ltr">DB_FLASHBACK_RETENTION_TARGET</code>.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmmaint.htm#BABCAGIB">"Managing Space for Flashback Logs in the Fast Recovery Area"</a></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BGBBJHEA"></a>
<div id="BRADV528" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Disabling the Fast Recovery Area</h3>
<p>If you have enabled Flashback Database or use the fast recovery area for archive logs, then take the appropriate steps from those that follow below. Otherwise, skip to Step 3:</p>
<ol>
<li>
<p>If Flashback Database is enabled, then disable it before you disable the fast recovery area.</p>
<pre dir="ltr">
ALTER DATABASE FLASHBACK OFF;
</pre></li>
<li>
<p>If you are using the fast recovery area for archive logs, then set the initialization parameter <code dir="ltr">LOG_ARCHIVE_DEST_</code><span class="italic">n</span> to use a non-fast recovery area location.</p>
<p>For example, to change the fast recovery area for <code dir="ltr">LOG_ARCHIVE_DEST_1</code> to a non-fast recovery area location, use the command <code dir="ltr">ALTER SYSTEM SET</code>:</p>
<pre dir="ltr">
LOG_ARCHIVE_DEST_1='LOCATION=USE_DB_RECOVERY_FILE_DEST'
</pre>
<pre dir="ltr">
ALTER SYSTEM SET LOG_ARCHIVE_DEST_1='LOCATION=/ORACLE/DBS/';
</pre></li>
<li>
<p>Disable the fast recovery area initialization parameter.</p>
<pre dir="ltr">
ALTER SYSTEM SET DB_RECOVERY_FILE_DEST=''; 
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CHDBJJAA"></a>
<div id="BRADV89428" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Configuring Locations for Control Files and Redo Logs</h3>
<p>As explained in <a href="#CHDIBECI">"Overview of the Fast Recovery Area"</a>, the only permanent files are <a id="sthref405"></a><a id="sthref406"></a>multiplexed copies of the current <a id="sthref407"></a>control file and <a id="sthref408"></a>online redo logs. This section explains how to set locations for these files and the archived logs.</p>
<a id="CHDJEHIE"></a>
<div id="BRADV89429" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Configuring Online Redo Log Locations</h4>
<p>The initialization parameters that determine where online redo log files are created are <code dir="ltr">DB_CREATE_ONLINE_LOG_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code>, <code dir="ltr"><a id="sthref409"></a>DB_RECOVERY_FILE_DEST</code>, and <code dir="ltr"><a id="sthref410"></a>DB_CREATE_FILE_DEST</code>. Details of the effect of combinations of these parameters on online redo log creation can be found in <a class="olink SQLRF01204" href="../../server.112/e41084/statements_5004.htm#SQLRF01204"><span class="italic">Oracle Database SQL Language Reference</span></a> in the description of the <code dir="ltr">LOGFILE</code> clause of the <code dir="ltr">CREATE</code> <code dir="ltr">DATABASE</code> statement.</p>
<p>The following SQL statements can create online redo logs in the fast recovery area:</p>
<ul>
<li>
<p><a class="olink SQLRF01204" href="../../server.112/e41084/statements_5004.htm#SQLRF01204"><code dir="ltr">CREATE DATABASE</code></a></p>
</li>
<li>
<p><a class="olink SQLRF00802" href="../../server.112/e41084/statements_1004.htm#SQLRF00802"><code dir="ltr">ALTER DATABASE ADD LOGFILE</code></a></p>
</li>
<li>
<p><a class="olink SQLRF00802" href="../../server.112/e41084/statements_1004.htm#SQLRF00802"><code dir="ltr">ALTER DATABASE ADD STANDBY LOGFILE</code></a></p>
</li>
<li>
<p><a class="olink SQLRF00802" href="../../server.112/e41084/statements_1004.htm#SQLRF00802"><code dir="ltr">ALTER DATABASE OPEN RESETLOGS</code></a></p>
</li>
</ul>
<p>The default size of an online log created in the fast recovery area is 100 megabytes. The log member file names are automatically generated by the database.</p>
</div>
<!-- class="sect3" -->
<a id="CHDCFJDC"></a>
<div id="BRADV89430" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Configuring Control File Locations</h4>
<p>The initialization parameters <code dir="ltr"><a id="sthref411"></a>CONTROL_FILES</code>, <code dir="ltr">DB_CREATE_ONLINE_LOG_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code>, <code dir="ltr">DB_RECOVERY_FILE_DEST</code>, and <code dir="ltr">DB_CREATE_FILE_DEST</code> all interact to determine the location where the database control files are created. For a full description of how these parameters interact, see the "Semantics" section of the description of <code dir="ltr">CREATE CONTROLFILE</code> in <a class="olink SQLRF01203" href="../../server.112/e41084/statements_5003.htm#SQLRF01203"><span class="italic">Oracle Database SQL Language Reference.</span></a></p>
<p>If the database creates an Oracle managed control file, and if the database uses a server parameter file, then the database sets the <code dir="ltr">CONTROL_FILES</code> initialization parameter in the server parameter file. If the database uses a client-side initialization parameter file, then you must set the <code dir="ltr">CONTROL_FILES</code> initialization parameter manually in the initialization parameter file.</p>
</div>
<!-- class="sect3" -->
<a id="CHDEHHDH"></a>
<div id="BRADV89431" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Configuring Archived Redo Log Locations</h4>
<p>Oracle recommends that you the use fast recovery area as an archiving location because the archived logs are automatically managed by the database. The generated file names for the archived logs in the fast recovery area are for Oracle Managed files and are not determined by the parameter <code dir="ltr">LOG_ARCHIVE_FORMAT</code>. Whatever archiving scheme you choose, it is always advisable to create multiple copies of archived redo logs.</p>
<p>You have the following basic options for archiving redo logs, listed from most to least recommended:</p>
<ol>
<li>
<p>Enable archiving to the fast recovery area <span class="italic">only</span> and use disk mirroring to create the redundancy needed to protect the archived redo logs.</p>
<p>If <code dir="ltr">DB_RECOVERY_FILE_DEST</code> is specified and <a id="sthref412"></a>no <code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> is specified, then <code dir="ltr">LOG_ARCHIVE_DEST_10</code> is implicitly set to the recovery area. You can override this behavior by setting <code dir="ltr">LOG_ARCHIVE_DEST_10</code> to an empty string.</p>
</li>
<li>
<p>Enable archiving to the fast recovery area and set other <code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> initialization parameter to locations outside the fast recovery area.</p>
<p>If a fast recovery area is configured, then you can add the fast recovery area as an archiving destination by setting any <code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> parameter to <code dir="ltr">LOCATION=USE_DB_RECOVERY_FILE_DEST</code>.</p>
</li>
<li>
<p>Set <code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> initialization parameters to archive <span class="italic">only</span> to non-fast recovery area locations.</p>
</li>
</ol>
<p>If you use the fast recovery area, then you cannot use the <code dir="ltr">LOG_ARCHIVE_DEST</code> and <code dir="ltr">LOG_ARCHIVE_DUPLEX_DEST</code> initialization parameters. Using either of these parameters prevents you from starting the instance. Instead, set the <code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> parameters. After your database is using <code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code>, you can configure a recovery area.</p>
<p>Note also that if you enable archiving but do not set any value for <code dir="ltr">LOG_ARCHIVE_DEST</code>, <code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code>, or <code dir="ltr">DB_RECOVERY_FILE_DEST</code>, then the redo logs are archived to a default location that is platform-specific. For example, on Solaris the default is <code dir="ltr">?/dbs</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN10086" href="../../server.112/e40402/initparams125.htm#REFRN10086"><span class="italic">Oracle Database Reference</span></a> for details on the semantics of the <code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> parameters</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CEGJFJEH"></a>
<div id="BRADV89432" class="sect2">
<h3 class="sect2">Configuring RMAN File Creation in the Fast Recovery Area</h3>
<p><a id="sthref413"></a>This section describes RMAN commands or implicit actions (such as control file autobackups) that can create files in the fast recovery area, and explains how to control whether a command creates files there or in another destination. The commands are:</p>
<ul>
<li>
<p><a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><code dir="ltr">BACKUP</code></a></p>
<p><a id="sthref414"></a><a id="sthref415"></a><a id="sthref416"></a>If you do not specify the <a class="olink RCMRF195" href="../../backup.112/e10643/rcmsubcl010.htm#RCMRF195"><code dir="ltr">FORMAT</code></a> clause for disk backups, then RMAN creates backup pieces and image copies in the fast recovery area, with names in Oracle Managed Files name format. If a fast recovery area is enabled, and if you <span class="italic">do</span> specify <code dir="ltr">FORMAT</code> on <code dir="ltr">BACKUP</code> or a channel, then RMAN creates the backup in a platform-specific location rather than in the recovery area.</p>
</li>
<li>
<p>Control File Autobackup</p>
<p>RMAN can create control file autobackups in the fast recovery area. Use the RMAN command <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><code dir="ltr">CONFIGURE</code></a> <code dir="ltr">CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK CLEAR</code> to clear any configured format option for the control file autobackup location on disk. RMAN creates control file autobackups in the fast recovery area when no other destination is configured.</p>
</li>
<li>
<p><a class="olink RCMRF149" href="../../backup.112/e10643/rcmsynta2008.htm#RCMRF149"><code dir="ltr">RESTORE</code></a> <code dir="ltr">ARCHIVELOG</code></p>
<p>Explicitly or implicitly set a <code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> parameter to <code dir="ltr">LOCATION=USE_DB_RECOVERY_FILE_DEST</code>. If you do not specify <a class="olink RCMRF153" href="../../backup.112/e10643/rcmsynta2014.htm#RCMRF153"><code dir="ltr">SET</code></a> <code dir="ltr">ARCHIVELOG DESTINATION</code> to override this behavior, then RMAN restores archived redo log files to the fast recovery area.</p>
</li>
<li>
<p><a class="olink RCMRF140" href="../../backup.112/e10643/rcmsynta2001.htm#RCMRF140"><code dir="ltr">RECOVER</code></a> <code dir="ltr">DATABASE</code> or <code dir="ltr">RECOVER TABLESPACE</code>, <code dir="ltr">RECOVER ... BLOCK</code>, and <a class="olink RCMRF194" href="../../backup.112/e10643/rcmsynta023.htm#RCMRF194"><code dir="ltr">FLASHBACK DATABASE</code></a></p>
<p>These commands restore archived redo log files from backup for use during media recovery, as required by the command. RMAN restores any redo log files needed during these operations to the fast recovery area and deletes them after they are applied during media recovery.</p>
<p>To direct the restored archived logs to the fast recovery area, set a <code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> parameter to <code dir="ltr">LOCATION = USE_DB_RECOVERY_FILE_DEST</code>. Verify that you are not using <code dir="ltr">SET ARCHIVELOG DESTINATION</code> to direct restored logs to some other destination.</p>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1019318"></a>
<div id="BRADV8400" class="sect1">
<h2 class="sect1">Configuring the Backup Retention Policy</h2>
<p><a id="sthref417"></a>As explained in <a href="rcmcncpt.htm#i1008093">"Backup Retention Policies"</a>, the <a href="glossary.htm#i432137"><span class="xrefglossterm">backup retention policy</span></a> specifies which backups must be retained to meet your data recovery requirements. This policy can be based on a <a id="sthref418"></a><a href="glossary.htm#i433328"><span class="xrefglossterm">recovery window</span></a> or <a href="glossary.htm#CHDJDEAE"><span class="xrefglossterm">redundancy</span></a>. <a id="sthref419"></a><a id="sthref420"></a>Use the <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><code dir="ltr">CONFIGURE RETENTION POLICY</code></a> command to specify the retention policy.<a id="sthref421"></a><a id="sthref422"></a><a id="sthref423"></a></p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">CONFIGURE</code> syntax</div>
<a id="i1019345"></a>
<div id="BRADV89436" class="sect2">
<h3 class="sect2">Configuring a Redundancy-Based Retention Policy</h3>
<p><a id="sthref424"></a>The <code dir="ltr">REDUNDANCY</code> parameter of the <code dir="ltr">CONFIGURE</code> <code dir="ltr">RETENTION</code> <code dir="ltr">POLICY</code> command specifies how many full or level 0 backups of each data file and control file that RMAN should keep. If the number of full or level 0 backups for a specific data file or control file exceeds the <code dir="ltr">REDUNDANCY</code> setting, then RMAN considers the extra backups as obsolete. The default retention policy is <code dir="ltr">REDUNDANCY 1</code>.</p>
<p>As you produce more backups, RMAN keeps track of which ones to retain and which are obsolete. RMAN retains all archived logs and incremental backups that are needed to recover the nonobsolete backups.</p>
<p>Assume that you make a full backup of data file 7 on Monday, Tuesday, Wednesday, and Thursday. You now have four full backups of this data file. If <code dir="ltr">REDUNDANCY</code> is <code dir="ltr">2</code>, then the Monday and Tuesday backups are obsolete. If you make another backup on Friday, then the Wednesday backup of data file 7 becomes obsolete.</p>
<p>Assume a different case in which <code dir="ltr">REDUNDANCY</code> is <code dir="ltr">1</code>. You run a level 0 database backup at noon on Monday, a level 1 cumulative backup at noon on Tuesday and Wednesday, and a level 0 backup at noon on Thursday. Immediately after each daily backup you run the command <code dir="ltr">DELETE OBSOLETE</code>. The Wednesday <code dir="ltr">DELETE</code> command does not remove the Tuesday level 1 backup because this backup is not redundant: the Tuesday level 1 backup could be used to recover the Monday level 0 backup to a time between noon on Tuesday and noon on Wednesday. However, the <code dir="ltr">DELETE</code> command on Thursday removes the previous level 0 and level 1 backups.</p>
<p>Run the <code dir="ltr">CONFIGURE</code> <code dir="ltr">RETENTION</code> <code dir="ltr">POLICY</code> command at the RMAN prompt, as in the following example:</p>
<pre dir="ltr">
CONFIGURE RETENTION POLICY TO REDUNDANCY 3;
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmmaint.htm#i1006294">"Deleting Obsolete RMAN Backups Based on Retention Policies"</a></div>
</div>
<!-- class="sect2" -->
<a id="CHDBFCCB"></a>
<div id="BRADV89437" class="sect2">
<h3 class="sect2">Configuring a Recovery Window-Based Retention Policy</h3>
<p><a id="sthref425"></a><a id="sthref426"></a>The <a id="sthref427"></a><code dir="ltr">RECOVERY</code> <code dir="ltr">WINDOW</code> parameter of the <code dir="ltr">CONFIGURE</code> command specifies the number of days between the current time and the earliest point of recoverability. RMAN does not consider any full or <a href="glossary.htm#CHDCBDHA"><span class="xrefglossterm">level 0 incremental backup</span></a> as obsolete if it falls within the recovery window. Additionally, RMAN retains all archived logs and level 1 incremental backups that are needed to recover to a random point within the window.</p>
<p>Run the <code dir="ltr">CONFIGURE</code> <code dir="ltr">RETENTION</code> <code dir="ltr">POLICY</code> command at the RMAN prompt. This example ensures that you can recover the database to any point within the last week:</p>
<pre dir="ltr">
CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 7 DAYS;
</pre>
<p>RMAN does not automatically delete backups rendered obsolete by the recovery window. Instead, RMAN shows them as <code dir="ltr">OBSOLETE</code> in the <code dir="ltr">REPORT</code> <code dir="ltr">OBSOLETE</code> output and in <code dir="ltr">the OBSOLETE</code> column <a id="sthref428"></a>of <code dir="ltr">V$BACKUP_FILES</code>. RMAN deletes obsolete files if you run the <code dir="ltr">DELETE</code> <code dir="ltr">OBSOLETE</code> command.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmmaint.htm#i1006294">"Deleting Obsolete RMAN Backups Based on Retention Policies"</a></div>
</div>
<!-- class="sect2" -->
<a id="i1019353"></a>
<div id="BRADV89438" class="sect2">
<h3 class="sect2">Disabling the Retention Policy</h3>
<p><a id="sthref429"></a>When you disable the retention policy, RMAN does not consider any backup as obsolete. To disable the retention policy, run this command:</p>
<pre dir="ltr">
CONFIGURE RETENTION POLICY TO NONE;
</pre>
<p>Configuring the retention policy to <code dir="ltr">NONE</code> is different from clearing it. Clearing it returns it to its default setting of <code dir="ltr">REDUNDANCY 1</code>, whereas <code dir="ltr">NONE</code> disables it.</p>
<p>If you disable the retention policy and run <a class="olink RCMRF147" href="../../backup.112/e10643/rcmsynta2006.htm#RCMRF147"><code dir="ltr">REPORT OBSOLETE</code></a> or <a class="olink RCMRF121" href="../../backup.112/e10643/rcmsynta016.htm#RCMRF121"><code dir="ltr">DELETE OBSOLETE</code></a> commands without passing a retention policy option to the command, then RMAN issues an error because no retention policy exists to determine which backups are obsolete.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
If you are using a fast recovery area, then you should not run your database with the retention policy disabled. If files are never considered obsolete, then a file can only be deleted from the fast recovery area if it has been backed up to some other disk location or to a tertiary storage device such as tape. This action is likely to use all of the space in your recovery area, which interferes with the normal operation of your database. See <a href="#CHDJDBIG">"How Oracle Manages Disk Space in the Fast Recovery Area"</a></div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1015217"></a>
<div id="BRADV138" class="sect1">
<h2 class="sect1">Backup Optimization and the CONFIGURE command</h2>
<p><a id="sthref430"></a><a id="sthref431"></a>Run the <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><code dir="ltr">CONFIGURE</code></a> command to enable and disable backup optimization. Backup optimization skips the backup of files in certain circumstances if the identical file or an identical version of the file has been backed up.</p>
<a id="i1013400"></a>
<div id="BRADV113" class="sect2">
<h3 class="sect2">Overview of Backup Optimization</h3>
<p><a id="sthref432"></a><a id="sthref433"></a><a id="sthref434"></a>If you enable <a href="glossary.htm#CHDBBJCB"><span class="xrefglossterm">backup optimization</span></a>, then <a id="sthref435"></a><a id="sthref436"></a>the <a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><code dir="ltr">BACKUP</code></a> command skips backing up files when the identical file has already been backed up to the specified device type. <a href="#CHDFJABD">Table 5-4</a> describes criteria that RMAN uses to determine whether a file is identical to a file that it backed up.</p>
<div id="BRADV574" class="tblruleformal">
<p class="titleintable"><a id="sthref437"></a><a id="CHDFJABD"></a>Table 5-4 Criteria to Determine an Identical File</p>
<table class="cellalignment1945" title="Criteria to Determine an Identical File" summary="This table is described in the preceding text." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t37">Type of File</th>
<th class="cellalignment1941" id="r1c2-t37">Criteria to Determine an Identical File</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t37" headers="r1c1-t37">
<p>Data file</p>
</td>
<td class="cellalignment1942" headers="r2c1-t37 r1c2-t37">
<p>The data file must have the same <a href="glossary.htm#i432583"><span class="xrefglossterm">DBID</span></a>, <a href="glossary.htm#i432263"><span class="xrefglossterm">checkpoint</span></a> SCN, creation SCN, and <code dir="ltr">RESETLOGS</code> SCN and time as a data file in a backup. The data file must be offline-normal, read-only, or closed normally.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t37" headers="r1c1-t37">
<p>Archived log</p>
</td>
<td class="cellalignment1942" headers="r3c1-t37 r1c2-t37">
<p>Same DBID, thread, sequence number, and <code dir="ltr">RESETLOGS</code> SCN and time</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t37" headers="r1c1-t37">
<p>Backup set</p>
</td>
<td class="cellalignment1942" headers="r4c1-t37 r1c2-t37">
<p>Same DBID, backup set record ID, and stamp</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" -->
<p>If RMAN determines that a file is identical and it has been backed up, then it is a candidate to be skipped. RMAN must do further checking to determine whether to skip the file, however, because both the retention policy and the backup duplexing feature are factors in the algorithm that determines whether RMAN has sufficient backups on the specified device type.</p>
<p><a id="sthref438"></a><a id="sthref439"></a>RMAN uses backup optimization when the following conditions are true:</p>
<ul>
<li>
<p>The <code dir="ltr">CONFIGURE</code> <code dir="ltr">BACKUP</code> <code dir="ltr">OPTIMIZATION</code> <code dir="ltr">ON</code> command has been run to enable backup optimization.</p>
</li>
<li>
<p>You run <code dir="ltr">BACKUP</code> <code dir="ltr">DATABASE</code>, <code dir="ltr">BACKUP</code> <code dir="ltr">ARCHIVELOG</code> with <code dir="ltr">ALL</code> or <code dir="ltr">LIKE</code> options, or <code dir="ltr">BACKUP</code> <code dir="ltr">BACKUPSET</code> <code dir="ltr">ALL</code>, <code dir="ltr">BACKUP RECOVERY AREA</code>, <code dir="ltr">BACKUP RECOVERY FILES</code>, or <code dir="ltr">BACKUP DATAFILECOPY</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">Note:</p>
When <code dir="ltr">TO DESTINATION</code> is used with <code dir="ltr">BACKUP RECOVERY AREA</code> or <code dir="ltr">BACKUP RECOVERY FILES</code>, RMAN only skips backups of files that have identical backups in the <code dir="ltr">TO DESTINATION</code> location that you provide.</div>
</li>
<li>
<p>Only one type of channel is allocated, do not mix disk and <a href="glossary.htm#CHDCCBFI"><span class="xrefglossterm">SBT</span></a> channels in the same backup command.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
In <a id="sthref440"></a><a href="glossary.htm#CHDDCIAB"><span class="xrefglossterm">backup undo optimization</span></a>, RMAN excludes undo changes (that are not needed for recovery of a backup) for transactions that have been committed. You can enable and disable backup optimization, but backup undo optimization is built-in behavior.</div>
<p><a id="sthref441"></a><a id="sthref442"></a>For example, assume that you have configured backup optimization. These commands back up to tape the database, all archived logs, and all backup sets:</p>
<pre dir="ltr">
<a id="CHDIDBHD"></a>
BACKUP DEVICE TYPE sbt DATABASE PLUS ARCHIVELOG;
BACKUP DEVICE TYPE sbt BACKUPSET ALL;
</pre>
<p>If none of the backed-up files has changed since the last backup, then RMAN does not back up the files again. RMAN also does not signal an error if it skips all files specified in the command because the files have already been backed up.</p>
<p>You can override optimization at any time by specifying the <code dir="ltr">FORCE</code> option on the <code dir="ltr">BACKUP</code> command. For example, you can run:</p>
<pre dir="ltr">
BACKUP DATABASE FORCE;
BACKUP ARCHIVELOG ALL FORCE;
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
The <code dir="ltr">CONFIGURE</code> entry in <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for a complete description of the backup optimization rules</div>
</div>
<!-- class="sect2" -->
<div id="BRADV89462" class="sect2"><a id="sthref443"></a>
<h3 class="sect2">Effect of Retention Policies on Backup Optimization for SBT Backups</h3>
<p><a id="sthref444"></a><a id="sthref445"></a>Backup optimization is not always applied when backing up to <a href="glossary.htm#CHDCCBFI"><span class="xrefglossterm">SBT</span></a> devices. The exceptions to normal backup optimization behavior for recovery window-based and redundancy-based retention policies are described in the following sections.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Use caution when enabling backup optimization if you use a media manager with its own internal expiration policy. Run the <a class="olink RCMRF119" href="../../backup.112/e10643/rcmsynta015.htm#RCMRF119"><code dir="ltr">CROSSCHECK</code></a> command periodically to synchronize the RMAN repository with the media manager. Otherwise, RMAN may skip backups due to optimization without recognizing that the media manager has discarded backups stored on tape.</div>
<a id="CHDBHGIH"></a>
<div id="BRADV89463" class="sect3">
<h4 class="sect3">Backup Optimization for SBT Backups with Recovery Window Retention Policy</h4>
<p>Suppose that backup optimization is enabled, and a recovery window <a href="glossary.htm#i432137"><span class="xrefglossterm">backup retention policy</span></a> is in effect. In this case, when performing SBT backups RMAN always backs up data files whose most recent backup is older than the <a href="glossary.htm#i433328"><span class="xrefglossterm">recovery window</span></a>. For example, assume the following scenario:</p>
<ul>
<li>
<p>Today is February 21.</p>
</li>
<li>
<p>The recovery window is 7 days.</p>
</li>
<li>
<p>The most recent backup of tablespace <code dir="ltr">tools</code> to tape is January 3.</p>
</li>
<li>
<p>Tablespace <code dir="ltr">tools</code> is read-only.</p>
</li>
</ul>
<p>On February 21, when you issue a command to back up tablespace <code dir="ltr">tools</code> to tape, RMAN backs it up even though it did not change after the January 3 backup (because it is read-only). RMAN makes the backup because no backup of the tablespace exists within the 7-day recovery window.</p>
<p>This behavior enables the media manager to expire old tapes. Otherwise, the media manager would be forced to keep the January 3 backup of tablespace <code dir="ltr">tools</code> indefinitely. By making a more recent backup of tablespace <code dir="ltr">tools</code> on February 21, RMAN enables the media manager to expire the tape containing the January 3 backup.</p>
</div>
<!-- class="sect3" -->
<div id="BRADV89464" class="sect3"><a id="sthref446"></a>
<h4 class="sect3">Backup Optimization for SBT Backups With Redundancy Retention Policy</h4>
<p><a id="sthref447"></a>Assume that you configure a retention policy for redundancy. In this case, RMAN only skips backups of offline or read-only data files to SBT when there are <code dir="ltr"><span class="codeinlineitalic">r</span></code> + 1 backups of the files, where <code dir="ltr"><span class="codeinlineitalic">r</span></code> is set in <code dir="ltr">CONFIGURE</code> <code dir="ltr">RETENTION</code> <code dir="ltr">POLICY</code> <code dir="ltr">TO</code> <code dir="ltr">REDUNDANCY</code> <code dir="ltr"><span class="codeinlineitalic">r</span></code>.</p>
<p>For example, assume that you enable backup optimization and set the following retention policy:</p>
<pre dir="ltr">
CONFIGURE DEFAULT DEVICE TYPE TO sbt;
CONFIGURE BACKUP OPTIMIZATION ON;
CONFIGURE RETENTION POLICY TO REDUNDANCY 2;
</pre>
<p>With these settings, RMAN only skips backups when three identical files are already backed up. Also assume that you have never backed up the <code dir="ltr">users</code> tablespace, which is read/write, and that you perform the actions described in <a href="#g1028781">Table 5-5</a> over the course of the week.</p>
<div id="BRADV575" class="tblruleformalwide">
<p class="titleintable"><a id="sthref448"></a><a id="g1028781"></a>Table 5-5 Effect of Redundancy Setting on Backup Optimization</p>
<table class="cellalignment1945" title="Effect of Redundancy Setting on Backup Optimization" summary="This table is described in the preceding text." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t42">Day</th>
<th class="cellalignment1941" id="r1c2-t42">Action</th>
<th class="cellalignment1941" id="r1c3-t42">Result</th>
<th class="cellalignment1941" id="r1c4-t42">Redundant Backup</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t42" headers="r1c1-t42">
<p>Monday</p>
</td>
<td class="cellalignment1942" headers="r2c1-t42 r1c2-t42">
<p>Take <code dir="ltr">users</code> offline normal.</p>
</td>
<td class="cellalignment1942" headers="r2c1-t42 r1c3-t42">&nbsp;</td>
<td class="cellalignment1942" headers="r2c1-t42 r1c4-t42">&nbsp;</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t42" headers="r1c1-t42">
<p>Tuesday</p>
</td>
<td class="cellalignment1942" headers="r3c1-t42 r1c2-t42">
<p><code dir="ltr">BACKUP</code> <code dir="ltr">DATABASE</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t42 r1c3-t42">
<p>The <code dir="ltr">users</code> tablespace is backed up.</p>
</td>
<td class="cellalignment1942" headers="r3c1-t42 r1c4-t42">&nbsp;</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t42" headers="r1c1-t42">
<p>Wednesday</p>
</td>
<td class="cellalignment1942" headers="r4c1-t42 r1c2-t42">
<p><code dir="ltr">BACKUP</code> <code dir="ltr">DATABASE</code></p>
</td>
<td class="cellalignment1942" headers="r4c1-t42 r1c3-t42">
<p>The <code dir="ltr">users</code> tablespace is backed up.</p>
</td>
<td class="cellalignment1942" headers="r4c1-t42 r1c4-t42">&nbsp;</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r5c1-t42" headers="r1c1-t42">
<p>Thursday</p>
</td>
<td class="cellalignment1942" headers="r5c1-t42 r1c2-t42">
<p><code dir="ltr">BACKUP</code> <code dir="ltr">DATABASE</code></p>
</td>
<td class="cellalignment1942" headers="r5c1-t42 r1c3-t42">
<p>The <code dir="ltr">users</code> tablespace is backed up.</p>
</td>
<td class="cellalignment1942" headers="r5c1-t42 r1c4-t42">
<p>Tuesday backup</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r6c1-t42" headers="r1c1-t42">
<p>Friday</p>
</td>
<td class="cellalignment1942" headers="r6c1-t42 r1c2-t42">
<p><code dir="ltr">BACKUP</code> <code dir="ltr">DATABASE</code></p>
</td>
<td class="cellalignment1942" headers="r6c1-t42 r1c3-t42">
<p>The <code dir="ltr">users</code> tablespace is <span class="italic">not</span> backed up.</p>
</td>
<td class="cellalignment1942" headers="r6c1-t42 r1c4-t42">
<p>Tuesday backup</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r7c1-t42" headers="r1c1-t42">
<p>Saturday</p>
</td>
<td class="cellalignment1942" headers="r7c1-t42 r1c2-t42">
<p><code dir="ltr">BACKUP</code> <code dir="ltr">DATABASE</code></p>
</td>
<td class="cellalignment1942" headers="r7c1-t42 r1c3-t42">
<p>The <code dir="ltr">users</code> tablespace is <span class="italic">not</span> backed up.</p>
</td>
<td class="cellalignment1942" headers="r7c1-t42 r1c4-t42">
<p>Tuesday backup</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r8c1-t42" headers="r1c1-t42">
<p>Sunday</p>
</td>
<td class="cellalignment1942" headers="r8c1-t42 r1c2-t42">
<p><code dir="ltr">DELETE</code> <code dir="ltr">OBSOLETE</code></p>
</td>
<td class="cellalignment1942" headers="r8c1-t42 r1c3-t42">
<p>The Tuesday backup is deleted.</p>
</td>
<td class="cellalignment1942" headers="r8c1-t42 r1c4-t42">&nbsp;</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r9c1-t42" headers="r1c1-t42">
<p>Monday</p>
</td>
<td class="cellalignment1942" headers="r9c1-t42 r1c2-t42">
<p><code dir="ltr">BACKUP</code> <code dir="ltr">DATABASE</code></p>
</td>
<td class="cellalignment1942" headers="r9c1-t42 r1c3-t42">
<p>The <code dir="ltr">users</code> tablespace is backed up.</p>
</td>
<td class="cellalignment1942" headers="r9c1-t42 r1c4-t42">
<p>Wednesday backup</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformalwide" -->
<p>The backups on Tuesday, Wednesday, and Thursday back up the offline <code dir="ltr">users</code> tablespace to satisfy the condition that three backups must exist (one more than redundancy setting). The Friday and Saturday backups do not back up the <code dir="ltr">users</code> tablespace because of backup optimization. The Tuesday backup of <code dir="ltr">users</code> is obsolete beginning on Thursday.</p>
<p>On Sunday, you delete all obsolete backups, which removes the Tuesday backup of <code dir="ltr">users</code>. The Tuesday backup is obsolete because of the retention policy setting. The whole database backup on Monday then backs up the <code dir="ltr">users</code> tablespace to satisfy the condition that three backups must exist (one more than redundancy setting). In this way, you can recycle your tapes over time.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#i1015217">"Backup Optimization and the CONFIGURE command"</a></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<div id="BRADV89465" class="sect2"><a id="sthref449"></a>
<h3 class="sect2">Configuring Backup Optimization</h3>
<p><a id="sthref450"></a><a id="sthref451"></a><a id="sthref452"></a>By default, backup optimization is configured to <code dir="ltr">OFF</code>. You can use the <a class="olink RCMRF154" href="../../backup.112/e10643/rcmsynta2015.htm#RCMRF154"><code dir="ltr">SHOW BACKUP OPTIMIZATION</code></a> command to view the current settings of backup optimization.</p>
<p class="subhead2"><a id="BRADV178"></a>To configure backup optimization:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and a recovery catalog (if used).</p>
</li>
<li>
<p>Run the <code dir="ltr">SHOW</code> <code dir="ltr">BACKUP</code> <code dir="ltr">OPTIMIZATION</code> command to determine whether optimization is currently enabled.</p>
<p>For example, enter the following command:</p>
<pre dir="ltr">
SHOW BACKUP OPTIMIZATION;
</pre>
<p>Sample output for <code dir="ltr">SHOW</code> <code dir="ltr">BACKUP</code> <code dir="ltr">OPTIMIZATION</code> follows:</p>
<pre dir="ltr">
RMAN configuration parameters for database with db_unique_name PROD1 are:
CONFIGURE BACKUP OPTIMIZATION OFF;
</pre></li>
<li>
<p>Enable backup optimization by running the following command:</p>
<pre dir="ltr">
CONFIGURE BACKUP OPTIMIZATION ON;
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmbckad.htm#i1006854">"Using Backup Optimization to Skip Files"</a> for examples of how to optimize RMAN backups</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDCFHBG"></a>
<div id="BRADV89439" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Configuring an Archived Redo Log Deletion Policy</h2>
<p>You can use RMAN to create a persistent configuration that governs when archived redo logs are eligible for deletion from disk.</p>
<a id="CHDIFFEI"></a>
<div id="BRADV89440" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Archived Redo Log Deletion Policies</h3>
<p><a id="sthref453"></a><a id="sthref454"></a>You can use the <code dir="ltr">CONFIGURE ARCHIVELOG DELETION POLICY</code> command to specify when archived redo logs are eligible for deletion. This deletion policy applies to all archiving destinations, including the <a href="glossary.htm#i999320"><span class="xrefglossterm">fast recovery area</span></a>.</p>
<p>Archived redo logs can be deleted automatically by the database or by user-initiated RMAN commands. Only logs in the fast recovery area can be deleted automatically by the database. For archived redo log files in the fast recovery area, the database retains them as long as possible and automatically deletes eligible logs when additional disk space is required. You can manually delete eligible logs from any location, whether inside or outside the fast recovery area, when you issue <a class="olink RCMRF107" href="../../backup.112/e10643/rcmsynta007.htm#RCMRF107"><code dir="ltr">BACKUP</code></a> <code dir="ltr">... DELETE INPUT</code> or <code dir="ltr">DELETE ARCHIVELOG</code> commands.</p>
<div id="BRADV99962" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref455"></a>
<h4 class="sect3">When the Archived Redo Log Deletion Policy Is Disabled</h4>
<p>By default, there is no <a href="glossary.htm#CHDGCGHA"><span class="xrefglossterm">archived redo log deletion policy</span></a> and this is why the archive redo log policy is set to the <code dir="ltr">NONE</code> clause. In this particular case, the fast recovery area considers archived redo log files in the recovery area as eligible for deletion if they have been backed up at least once to disk or SBT or the logs are obsolete according to the backup retention policy. The backup retention policy considers logs obsolete only if the logs are not needed by a guaranteed restore point and the logs are not needed by Oracle Flashback Database. Archived redo logs are needed by Flashback Database if the logs were created later than <code dir="ltr">SYSDATE-'DB_FLASHBACK_RETENTION_TARGET'</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p>The <code dir="ltr">CONFIGURE ARCHIVELOG DELETION POLICY</code> entry in <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for detailed information about policy options</p>
</li>
<li>
<p><a class="olink SBYDB" href="../../server.112/e41134/toc.htm"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to configure an archived log deletion policy in a Data Guard environment</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<div id="BRADV99963" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref456"></a>
<h4 class="sect3">When the Archived Redo Log Deletion Policy Is Enabled</h4>
<p>You can use the <code dir="ltr">CONFIGURE ARCHIVELOG DELETION POLICY BACKED UP</code> <code dir="ltr"><span class="codeinlineitalic">integer</span></code> <code dir="ltr">TIMES TO DEVICE TYPE</code> command to enable an archived log deletion policy. This configuration specifies that archived logs are eligible for deletion only when the specified number of archived log backups exist on the specified device type.</p>
<p>If the deletion policy is configured with the <code dir="ltr">BACKED UP</code> <code dir="ltr"><span class="codeinlineitalic">integer</span></code> <code dir="ltr">TIMES</code> clause, then a <code dir="ltr">BACKUP ARCHIVELOG</code> command copies the logs unless <code dir="ltr"><span class="codeinlineitalic">integer</span></code> backups already exist on the specified device type. If <code dir="ltr"><span class="codeinlineitalic">integer</span></code> backups of the logs exist, then the <code dir="ltr">BACKUP ARCHIVELOG</code> command skips the logs. In this way, the archived log deletion policy functions as a default <code dir="ltr">NOT BACKED UP</code> <code dir="ltr"><span class="codeinlineitalic">integer</span></code> <code dir="ltr">TIMES</code> clause on the <code dir="ltr">BACKUP ARCHIVELOG</code> command. You can override the deletion policy by specifying the <code dir="ltr">FORCE</code> option on the <code dir="ltr">BACKUP</code> command.</p>
<p>The archived log deletion policy also has options specific to a <a id="sthref457"></a>Data Guard environment. For example, if you specify the <code dir="ltr">APPLIED ON STANDBY</code> clause, then RMAN can delete logs after they have been applied at all mandatory remote destinations. If you specify <code dir="ltr">SHIPPED TO STANDBY</code>, then RMAN can delete logs when they have been transferred to all mandatory standby destinations.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p>The <code dir="ltr">CONFIGURE ARCHIVELOG DELETION POLICY</code> entry in <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for detailed information about policy options</p>
</li>
<li>
<p><a class="olink SBYDB04700" href="../../server.112/e41134/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to configure an archived log deletion policy in a Data Guard environment</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<div id="BRADV89441" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref458"></a>
<h3 class="sect2">Enabling an Archived Redo Log Deletion Policy</h3>
<p><a id="sthref459"></a><a id="sthref460"></a>This section explains how to configure an archived redo log deletion policy. By default the policy is set to <code dir="ltr">NONE</code>.</p>
<p class="subhead2"><a id="BRADV576"></a>To enable an archived redo log deletion policy:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and a recovery catalog (if used).</p>
</li>
<li>
<p>Run the <code dir="ltr">CONFIGURE ARCHIVELOG DELETION POLICY</code> command with the desired options.</p>
<p>The following example specifies that archived redo logs are eligible to be deleted from the fast recovery area and all local archiving destinations when logs have been backed up at least twice to tape:</p>
<pre dir="ltr">
<a id="CHDEEGFJ"></a>
CONFIGURE ARCHIVELOG DELETION POLICY
  TO BACKED UP 2 TIMES TO SBT;
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmbckba.htm#CHDGEBEG">"Deleting Archived Redo Logs After Backups"</a></p>
</li>
<li>
<p><a class="olink SBYDB" href="../../server.112/e41134/toc.htm"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to manage archived redo logs in a Data Guard environment</p>
</li>
<li>
<p><a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for a complete explanation of the <code dir="ltr">CONFIGURE ARCHIVELOG DELETION POLICY</code> command and the conditions under which archived logs are eligible for deletion</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDECDAG"></a>
<div id="BRADV89455" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Configuring RMAN in a Data Guard Environment</h2>
<p><a id="sthref461"></a>If you use RMAN in a Data Guard environment, then you can use the <code dir="ltr">CONFIGURE</code> command to register and configure settings for the physical databases in this environment. RMAN uses the <a id="sthref462"></a><code dir="ltr">DB_UNIQUE_NAME</code> initialization parameter to distinguish one database from another. Thus, it is critical that you maintain the uniqueness of the <code dir="ltr">DB_UNIQUE_NAME</code> in the Data Guard environment.</p>
<p>RMAN must be connected to a recovery catalog when you create or alter a configuration for a database in the Data Guard environment. If you use the <code dir="ltr">SET DBID</code> command to set the DBID in the <a href="glossary.htm#CHDHHCJB"><span class="xrefglossterm">RMAN session</span></a>, then you can configure a standby database even when RMAN is not connected as <code dir="ltr">TARGET</code> to a database in the Data Guard environment. You can even create a configuration for a standby database that has not yet been created.</p>
<p>You can use the following forms of the <code dir="ltr">CONFIGURE</code> command:</p>
<ul>
<li>
<p><code dir="ltr">CONFIGURE DB_UNIQUE_NAME</code> <a id="sthref463"></a><a id="sthref464"></a>defines a connection to a <a href="glossary.htm#CHDEJBIJ"><span class="xrefglossterm">physical standby database</span></a> and implicitly registers the new database.</p>
<p>New standby databases are also automatically registered when RMAN connects as <code dir="ltr">TARGET</code> to a standby database for the first time.</p>
</li>
<li>
<p><code dir="ltr">CONFIGURE FOR DB_UNIQUE_NAME</code> configures settings for a database in the Data Guard environment.</p>
<p>For example, you can configure channels, default devices, and so on for a specified database or for all databases in the environment. You can use <code dir="ltr">SHOW ALL FOR DB_UNIQUE_NAME</code> to show the configuration for a specific standby database or <code dir="ltr">SHOW ALL FOR DB_UNIQUE_NAME ALL</code> to show configurations for all known databases.</p>
</li>
</ul>
<p>A Data Guard environment involves many considerations that are only relevant for Data Guard. For example, you can configure an <a href="glossary.htm#CHDGCGHA"><span class="xrefglossterm">archived redo log deletion policy</span></a> based on whether archived logs are transferred to or applied on a standby database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SBYDB04700" href="../../server.112/e41134/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to configure the RMAN environment for use with a standby database</p>
</li>
<li>
<p><a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for a complete explanation of the <code dir="ltr">CONFIGURE ARCHIVELOG DELETION POLICY</code> command and the conditions under which archived logs are eligible for deletion</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1933">
<tr>
<td class="cellalignment1942">
<table class="cellalignment1938">
<tr>
<td class="cellalignment1937"><a href="rcmcnctg.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1937"><a href="rcmconfa.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1944">
<table class="cellalignment1936">
<tr>
<td class="cellalignment1937"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1937"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1937"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1937"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1937"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1937"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
