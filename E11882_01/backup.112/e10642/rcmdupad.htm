<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Duplicating a Database: Advanced Topics</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1054" />
<meta name="description" content="A guide to backup and recovery of Oracle databases, including RMAN backup and recovery, RMAN data transfer, Oracle Flashback Technology, and user-managed backup and recovery" />
<meta name="dcterms.created" content="2015-05-13T14:1:12Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Backup and Recovery User's Guide" />
<meta name="dcterms.identifier" content="E10642-08" />
<meta name="dcterms.isVersionOf" content="BRADV" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="rcmdupdb.htm" title="Previous" type="text/html" />
<link rel="Next" href="rcmttbsb.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10642.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">39/47</span> <!-- End Header -->
<div id="BRADV441" class="chapter"><a id="CIHBEDII"></a>
<h1 class="chapter"><span class="secnum">25</span> Duplicating a Database: Advanced Topics</h1>
<p>This chapter explains advanced forms of database duplication that are not covered in <a href="rcmdupdb.htm#BGBHBIFE">Chapter 24, "Duplicating a Database."</a></p>
<p>This chapter contains the following topics:</p>
<ul>
<li>
<p><a href="#CIHIJAEH">Specifying Alternative Names for Duplicate Database Files</a></p>
</li>
<li>
<p><a href="#BGBJEGCC">Making Disk Backups Accessible Without Shared Disk</a></p>
</li>
<li>
<p><a href="#CIHEGGGC">Duplicating a Database When No Server Parameter File Exists</a></p>
</li>
<li>
<p><a href="#BGBCBBCH">Starting the Auxiliary Instance When No Server Parameter File Exists</a></p>
</li>
<li>
<p><a href="#CHDEJHBD">Duplicating a Subset of the Source Database Tablespaces</a></p>
</li>
</ul>
<a id="CIHIJAEH"></a>
<div id="BRADV442" class="sect1">
<h2 class="sect1">Specifying Alternative Names for Duplicate Database Files</h2>
<p><a href="rcmdupdb.htm#CHDGFABD">"Step 2: Choosing a Strategy for Naming Duplicate Files"</a> explains the recommended strategy of using the same names for the duplicate and source database files. In all other cases, you must choose an alternative naming strategy for the duplicate files. The strategy that you use depends on whether the source and duplicate databases use Oracle Managed Files (OMF) or Oracle Automatic Storage Management (ASM).</p>
<p>If the source data files use OMF, then you cannot rename them using <code dir="ltr">DB_FILE_NAME_CONVERT</code>. <a href="rcmtspit.htm#CIHCHDIB">"Using Non-ASM Storage"</a> discusses the details and options of OMF-managed data files.</p>
<div id="BRADV443" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1833"></a>
<h3 class="sect2">Specifying Non-OMF or Non-ASM Alternative Names for Duplicate Database Files</h3>
<p>This section explains how to specify names for the duplicate files when the following condition is true:</p>
<p>The source and auxiliary hosts either use different directory structures or use the same structure but you want to name the duplicate files differently.</p>
<p><a href="#CIHJJJAJ">Table 25-1</a> summarizes the formats available for naming each type of file.</p>
<a id="CIHEADDE"></a>
<div id="BRADV89956" class="sect3">
<h4 class="sect3">Using SET NEWNAME to Name File System Data Files and Temp Files</h4>
<p>As shown in <a href="#CIHJJJAJ">Table 25-1</a>, one way to name duplicate data files is to use the<a id="sthref1834"></a> <code dir="ltr">SET NEWNAME</code> command before executing the <code dir="ltr">DUPLICATE</code> command. RMAN supports the following commands, listed in order of precedence:</p>
<ol>
<li>
<p><code dir="ltr">SET NEWNAME FOR DATAFILE</code> and <code dir="ltr">SET NEWNAME FOR TEMPFILE</code></p>
</li>
<li>
<p><code dir="ltr">SET NEWNAME FOR TABLESPACE</code></p>
</li>
<li>
<p><code dir="ltr">SET NEWNAME FOR DATABASE</code></p>
</li>
</ol>
<p>The order of precedence means that <code dir="ltr">SET NEWNAME FOR TABLESPACE</code> specifies names for files not already named by <code dir="ltr">SET NEWNAME FOR DATAFILE</code> and <code dir="ltr">SET NEWNAME FOR TEMPFILE,</code> whereas <code dir="ltr">SET NEWNAME FOR DATABASE</code> specifies names for files not already named by <code dir="ltr">SET NEWNAME FOR TABLESPACE</code>, <code dir="ltr">SET NEWNAME FOR DATAFILE</code>, or <code dir="ltr">SET NEWNAME FOR TEMPFILE</code>.</p>
<p>When using <code dir="ltr">SET NEWNAME FOR DATAFILE</code>, you can specify a full path as a literal, as in <code dir="ltr">/oradata1/system01.dbf</code>. When using <code dir="ltr">SET</code> with <code dir="ltr">FOR DATABASE</code> or <code dir="ltr">FOR TABLESPACE</code>, however, you must use at least one of the first three substitution variables summarized in <a href="#CIHJJJAJ">Table 25-1</a> (<code dir="ltr">%I</code> and <code dir="ltr">%N</code> are optional).</p>
<div id="BRADV444" class="tblformal">
<p class="titleintable"><a id="sthref1835"></a><a id="CIHJJJAJ"></a>Table 25-1 Substitution Variables for SET NEWNAME</p>
<table class="cellalignment1940" title="Substitution Variables for SET NEWNAME" summary="A list of the substitution varibales for SET NEWNAME." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t2">Variable</th>
<th class="cellalignment1941" id="r1c2-t2">Summary</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t2" headers="r1c1-t2">
<p><a id="sthref1836"></a><code dir="ltr">%b</code></p>
</td>
<td class="cellalignment1942" headers="r2c1-t2 r1c2-t2">
<p>Specifies the file name stripped of directory paths. For example, if a data file is named <code dir="ltr">/oradata/prod/financial.dbf</code>, then <code dir="ltr">%b</code> results in <code dir="ltr">financial.dbf</code>.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t2" headers="r1c1-t2">
<p><a id="sthref1837"></a><code dir="ltr">%f</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t2 r1c2-t2">
<p>Specifies the absolute file number of the data file for which the new name is generated. For example, if data file <code dir="ltr">2</code> is duplicated, then <code dir="ltr">%f</code> generates the value <code dir="ltr">2</code>.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t2" headers="r1c1-t2">
<p><a id="sthref1838"></a><code dir="ltr">%I</code></p>
</td>
<td class="cellalignment1942" headers="r4c1-t2 r1c2-t2">
<p>Specifies the DBID</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r5c1-t2" headers="r1c1-t2">
<p><a id="sthref1839"></a><code dir="ltr">%N</code></p>
</td>
<td class="cellalignment1942" headers="r5c1-t2 r1c2-t2">
<p>Specifies the tablespace name</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r6c1-t2" headers="r1c1-t2">
<p><a id="sthref1840"></a><code dir="ltr">%U</code></p>
</td>
<td class="cellalignment1942" headers="r6c1-t2 r1c2-t2">
<p>Specifies the following format: <code dir="ltr">data-D-%d_id-%I_TS-%N_FNO-%f</code></p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p><span class="bold">To use SET NEWNAME to specify new file names:</span></p>
<ol>
<li>
<p>Follow Steps 1 through 4 in <a href="rcmdupdb.htm#BGBGCJAG">"Basic Steps of Database Duplication"</a>.</p>
</li>
<li>
<p>Within a <code dir="ltr">RUN</code> command, issue the <code dir="ltr">SET NEWNAME</code> command before issuing <code dir="ltr">DUPLICATE</code>.</p>
<p><a href="#CIHCGGEH">Example 25-1</a> illustrates a script that specifies new names for data files <code dir="ltr">1</code> through <code dir="ltr">5</code> and temp file <code dir="ltr">1</code>. The script does not set a new name for data file <code dir="ltr">6</code> because it is in the <code dir="ltr">TOOLS</code> tablespace, which is excluded from the duplicate database.</p>
<div id="BRADV445" class="example">
<p class="titleinexample"><a id="CIHCGGEH"></a>Example 25-1 Duplicating with SET NEWNAME FOR DATAFILE</p>
<pre dir="ltr">
RUN
{
  SET NEWNAME FOR DATAFILE 1 TO '/oradata1/system01.dbf'; 
  SET NEWNAME FOR DATAFILE 2 TO '/oradata2/sysaux01.dbf';
  SET NEWNAME FOR DATAFILE 3 TO '/oradata3/undotbs01.dbf';
  SET NEWNAME FOR DATAFILE 4 TO '/oradata4/users01.dbf'; 
  SET NEWNAME FOR DATAFILE 5 TO '/oradata5/users02.dbf';
  SET NEWNAME FOR TEMPFILE 1 TO '/oradatat/temp01.dbf'; 
  DUPLICATE TARGET DATABASE TO dupdb
    SKIP TABLESPACE tools
    LOGFILE
      GROUP 1 ('/duplogs/redo01a.log', 
               '/duplogs/redo01b.log') SIZE 4M REUSE, 
      GROUP 2 ('/duplogs/redo02a.log', 
               '/duplogs/redo02b.log') SIZE 4M REUSE;
}
</pre></div>
<!-- class="example" -->
<p><a href="#CIHBCJGH">Example 25-2</a> is a variation of <a href="#CIHCGGEH">Example 25-1</a> and uses one <code dir="ltr">SET NEWNAME</code> command to name all data files in the tablespace <code dir="ltr">users</code>. Once the example completes, the file names for tablespace <code dir="ltr">users</code> are set to: <code dir="ltr">/oradata4/users01.dbf</code> and <code dir="ltr">/oradata5/users02.dbf</code>.</p>
<div id="BRADV446" class="example">
<p class="titleinexample"><a id="CIHBCJGH"></a>Example 25-2 Duplicating with SET NEWNAME FOR DATAFILE and FOR TABLESPACE</p>
<pre dir="ltr">
RUN
{
  SET NEWNAME FOR TABLESPACE users TO '/oradata%f/%b';
  SET NEWNAME FOR DATAFILE 1 TO '/oradata1/system01.dbf'; 
  SET NEWNAME FOR DATAFILE 2 TO '/oradata2/sysaux01.dbf';
  SET NEWNAME FOR DATAFILE 3 TO '/oradata3/undotbs01.dbf'; 
  SET NEWNAME FOR TEMPFILE 1 TO '/oradatat/temp01.dbf'; 
  DUPLICATE TARGET DATABASE TO dupdb
    SKIP TABLESPACE tools
    LOGFILE
      GROUP 1 ('/duplogs/redo01a.log', 
               '/duplogs/redo01b.log') SIZE 4M REUSE, 
      GROUP 2 ('/duplogs/redo02a.log', 
               '/duplogs/redo02b.log') SIZE 4M REUSE;
}
</pre></div>
<!-- class="example" -->
<p><a href="#CIHFIJJH">Example 25-3</a> is a variation of <a href="#CIHCGGEH">Example 25-1</a> and uses a single <code dir="ltr">SET</code> command to name all data files in the database.</p>
<div id="BRADV447" class="example">
<p class="titleinexample"><a id="CIHFIJJH"></a>Example 25-3 Duplicating with SET NEWNAME FOR DATABASE</p>
<pre dir="ltr">
RUN
{
  SET NEWNAME FOR DATABASE TO '/oradata/%U'; 
  DUPLICATE TARGET DATABASE TO dupdb
    SKIP TABLESPACE tools
    LOGFILE
      GROUP 1 ('/duplogs/redo01a.log', 
               '/duplogs/redo01b.log') SIZE 4M REUSE, 
      GROUP 2 ('/duplogs/redo02a.log', 
               '/duplogs/redo02b.log') SIZE 4M REUSE;
}
</pre></div>
<!-- class="example" --></li>
</ol>
<p>Assume the following:</p>
<ul>
<li>
<p><code dir="ltr">DBID</code> is <code dir="ltr">87650928</code></p>
</li>
<li>
<p>Database name is <code dir="ltr">PROD</code></p>
</li>
</ul>
<p><a href="#CIHHIEGD">Table 25-2</a> shows the results from <a href="#CIHFIJJH">Example 25-3</a>.</p>
<div id="BRADV541" class="tblformalwidekeymax">
<p class="titleintable"><a id="sthref1841"></a><a id="CIHHIEGD"></a>Table 25-2 Results from <a href="#CIHFIJJH">Example 25-3</a> SET NEWNAME DATABASE Command</p>
<table class="cellalignment1945" title="Results from Example 25-3 SET NEWNAME DATABASE Command" summary="Before and After results from SET NEWNAME DATABASE" dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t3">Before SET NEWNAME DATABASE</th>
<th class="cellalignment1941" id="r1c2-t3">Tablespace Name</th>
<th class="cellalignment1941" id="r1c3-t3">Data File File Number</th>
<th class="cellalignment1941" id="r1c4-t3">After SET NEWNAME DATABASE TO '/oradata/%U';</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t3" headers="r1c1-t3">
<p><code dir="ltr">.../system01.dbf</code></p>
</td>
<td class="cellalignment1942" headers="r2c1-t3 r1c2-t3">
<p><code dir="ltr">SYSTEM</code></p>
</td>
<td class="cellalignment1942" headers="r2c1-t3 r1c3-t3">
<p>1</p>
</td>
<td class="cellalignment1942" headers="r2c1-t3 r1c4-t3">
<p><code dir="ltr">/oradata/data-D-PROD_id-87650928_TS-SYSTEM_FNO-1</code></p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t3" headers="r1c1-t3">
<p><code dir="ltr">.../sysaux01.dbf</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t3 r1c2-t3">
<p><code dir="ltr">SYSAUX</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t3 r1c3-t3">
<p>2</p>
</td>
<td class="cellalignment1942" headers="r3c1-t3 r1c4-t3">
<p><code dir="ltr">/oradata/data-D-PROD_id-87650928_TS-SYSAUX_FNO-2</code></p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t3" headers="r1c1-t3">
<p><code dir="ltr">.../undotbs01.dbf</code></p>
</td>
<td class="cellalignment1942" headers="r4c1-t3 r1c2-t3">
<p><code dir="ltr">UNDOTS</code></p>
</td>
<td class="cellalignment1942" headers="r4c1-t3 r1c3-t3">
<p>3</p>
</td>
<td class="cellalignment1942" headers="r4c1-t3 r1c4-t3">
<p><code dir="ltr">/oradata/data-D-PROD_id-87650928_TS-UNDOTS_FNO-3</code></p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r5c1-t3" headers="r1c1-t3">
<p><code dir="ltr">.../users01.dbf</code></p>
</td>
<td class="cellalignment1942" headers="r5c1-t3 r1c2-t3">
<p><code dir="ltr">USERS</code></p>
</td>
<td class="cellalignment1942" headers="r5c1-t3 r1c3-t3">
<p>4</p>
</td>
<td class="cellalignment1942" headers="r5c1-t3 r1c4-t3">
<p><code dir="ltr">/oradata/data-D-PROD_id-87650928_TS-USERS_FNO-4</code></p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r6c1-t3" headers="r1c1-t3">
<p><code dir="ltr">.../users02.dbf</code></p>
</td>
<td class="cellalignment1942" headers="r6c1-t3 r1c2-t3">
<p><code dir="ltr">USERS</code></p>
</td>
<td class="cellalignment1942" headers="r6c1-t3 r1c3-t3">
<p>5</p>
</td>
<td class="cellalignment1942" headers="r6c1-t3 r1c4-t3">
<p><code dir="ltr">/oradata/data-D-PROD_id-87650928_TS-USERS_FNO-5</code></p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r7c1-t3" headers="r1c1-t3">
<p><code dir="ltr">.../temp01.dbf</code></p>
</td>
<td class="cellalignment1942" headers="r7c1-t3 r1c2-t3">
<p><code dir="ltr">TEMP</code></p>
</td>
<td class="cellalignment1942" headers="r7c1-t3 r1c3-t3">
<p>1</p>
</td>
<td class="cellalignment1942" headers="r7c1-t3 r1c4-t3">
<p><code dir="ltr">/oradata/data-D-PROD_id-87650928_TS-TEMP_FNO-1</code></p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformalwidekeymax" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF153" href="../../backup.112/e10643/rcmsynta2014.htm#RCMRF153"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for details on substitution variables usable in <code dir="ltr">SET</code> <code dir="ltr">NEWNAME</code></div>
</div>
<!-- class="sect3" -->
<a id="CIHBEGGE"></a>
<div id="BRADV89958" class="sect3">
<h4 class="sect3">Using CONFIGURE AUXNAME to Name File System Data Files and OMF/ASM Target Data Files</h4>
<p>The <code dir="ltr">CONFIGURE AUXNAME</code> command is an alternative to the <code dir="ltr">SET NEWNAME</code> command. The difference is that after you configure the auxiliary name the first time, additional <code dir="ltr">DUPLICATE</code> commands reuse the configured settings. In contrast, you must reissue the <code dir="ltr">SET NEWNAME</code> command every time you execute the <code dir="ltr">DUPLICATE</code> command.</p>
<p><span class="bold">To use CONFIGURE AUXNAME to specify names for duplicate data files:</span></p>
<ol>
<li>
<p>Issue a <code dir="ltr">CONFIGURE AUXNAME</code> command for each file that you want to name in the duplicate database.</p>
<p>For example, enter the following commands at the RMAN prompt to specify names for data files <code dir="ltr">1</code> through <code dir="ltr">5</code>:</p>
<pre dir="ltr">
  CONFIGURE AUXNAME FOR DATAFILE 1 TO '/oradata1/system01.dbf'; 
  CONFIGURE AUXNAME FOR DATAFILE 2 TO '/oradata2/sysaux01.dbf';
  CONFIGURE AUXNAME FOR DATAFILE 3 TO '/oradata3/undotbs01.dbf';
  CONFIGURE AUXNAME FOR DATAFILE 4 TO '/oradata4/users01.dbf'; 
  CONFIGURE AUXNAME FOR DATAFILE 5 TO '/oradata5/users02.dbf';
</pre></li>
<li>
<p>Issue a <code dir="ltr">DUPLICATE</code> command.</p>
<p>For example, enter the following command at the RMAN prompt:</p>
<pre dir="ltr">
SET NEWNAME FOR TEMPFILE 1 TO '/oradatat/temp01.dbf'; 
DUPLICATE TARGET DATABASE
  TO dupdb
  SKIP TABLESPACE tools
  LOGFILE
    GROUP 1 ('/duplogs/redo01a.log',
             '/duplogs/redo01b.log') SIZE 4M REUSE,
    GROUP 2 ('/duplogs/redo02a.log',
             '/duplogs/redo02b.log') SIZE 4M REUSE;
</pre>
<p>RMAN uses the <code dir="ltr">CONFIGURE AUXNAME</code> settings to name data files <code dir="ltr">1</code> through <code dir="ltr">5</code>.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for details on using <code dir="ltr">CONFIGURE</code> <code dir="ltr">AUXNAME</code></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BGBEHADD"></a>
<div id="BRADV448" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Specifying OMF or ASM Alternative Names for Duplicate Database Files</h3>
<p>The following sections discuss requirements for creating a duplicate database when some or all files of the duplicate database use OMF or ASM.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink OSTMG036" href="../../server.112/e18951/asmcon.htm#OSTMG036"><span class="italic">Oracle Database Storage Administrator's Guide</span></a> for an introduction to ASM and OMF</div>
<a id="BGBDCDGJ"></a>
<div id="BRADV89943" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Settings and Restrictions for OMF Initialization Parameters</h4>
<p>When creating a duplicate database that uses Oracle Managed Files, you must set initialization parameters in the auxiliary instance. If you use the <code dir="ltr">SPFILE</code> clause of <code dir="ltr">DUPLICATE</code> to name the files, then you can set initialization parameters in the <code dir="ltr">SPFILE</code> clause. <a href="#CIHBHAAE">Table 25-3</a> describes the relevant parameters and recommended settings and <a href="#CIHIFDBE">Table 25-4</a> lists the restrictions and initialization parameters that should not be set.</p>
<div class="infoboxnotealso">
<p class="notep1">See:</p>
<a class="olink REFRN" href="../../server.112/e40402/toc.htm"><span class="italic">Oracle Database Reference</span> f</a>or more information about these parameters.</div>
<div id="BRADV449" class="tblruleformalwidemax">
<p class="titleintable"><a id="sthref1842"></a><a id="CIHBHAAE"></a>Table 25-3 Initialization Parameters for Oracle Managed Files</p>
<table class="cellalignment1945" title="Initialization Parameters for Oracle Managed Files" summary="Relevant initialization parameters for Oracle Managed Files" dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t8">Initialization Parameter</th>
<th class="cellalignment1941" id="r1c2-t8">Purpose</th>
<th class="cellalignment1941" id="r1c3-t8">Recommendation</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t8" headers="r1c1-t8">
<p><a class="olink REFRN10034" href="../../server.112/e40402/initparams053.htm#REFRN10034"><code dir="ltr">DB_CREATE_FILE_DEST</code></a></p>
</td>
<td class="cellalignment1942" headers="r2c1-t8 r1c2-t8">
<p>Specifies the default location for Oracle managed data files. This location is also the default location for Oracle managed control files and online logs if none of the <code dir="ltr">DB_CREATE_ONLINE_LOG_DEST</code> initialization parameters are specified.</p>
</td>
<td class="cellalignment1942" headers="r2c1-t8 r1c3-t8">
<p>Set this parameter to the location for the Oracle Managed Files. Any database files for which no other location is specified are created in <code dir="ltr">DB_CREATE_FILE_DEST</code> by <code dir="ltr">DUPLICATE</code>. You can override the default for specific files using <code dir="ltr">SET NEWNAME</code>, as described in <a href="#CIHCDAED">"Using SET NEWNAME to Create OMF or ASM Files"</a>.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t8" headers="r1c1-t8">
<p><a class="olink REFRN10035" href="../../server.112/e40402/initparams054.htm#REFRN10035"><code dir="ltr">DB_CREATE_ONLINE_LOG_DEST_</code><span class="italic">n</span></a></p>
</td>
<td class="cellalignment1942" headers="r3c1-t8 r1c2-t8">
<p>Specifies the default location for Oracle managed control files and online redo logs. If multiple parameters are set, then one control file and one online redo log is created in each location.</p>
</td>
<td class="cellalignment1942" headers="r3c1-t8 r1c3-t8">
<p>Set these parameters (<code dir="ltr">_1</code>, <code dir="ltr">_2</code>, and so on) only if you want to multiplex the control files and online redo log files in multiple locations.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t8" headers="r1c1-t8">
<p><a class="olink REFRN10234" href="../../server.112/e40402/initparams065.htm#REFRN10234"><code dir="ltr">DB_RECOVERY_FILE_DEST</code></a></p>
</td>
<td class="cellalignment1942" headers="r4c1-t8 r1c2-t8">
<p>Specifies the default location for the fast recovery area. The fast recovery area contains multiplexed copies of current control files and online redo log files.</p>
</td>
<td class="cellalignment1942" headers="r4c1-t8 r1c3-t8">
<p>Set this parameter if you want a multiplexed copy of the control file and online redo log file in the recovery area.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformalwidemax" -->
<div id="BRADV544" class="tblruleformalwidemax">
<p class="titleintable"><a id="sthref1843"></a><a id="CIHIFDBE"></a>Table 25-4 Initialization Parameter Restrictions for Oracle Managed Files</p>
<table class="cellalignment1945" title="Initialization Parameter Restrictions for Oracle Managed Files" summary="List of Initialization Parameter Restrictions for Oracle Managed Files" dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t9">Initialization Parameter</th>
<th class="cellalignment1941" id="r1c2-t9">Purpose</th>
<th class="cellalignment1941" id="r1c3-t9">Restriction</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t9" headers="r1c1-t9">
<p><a class="olink REFRN10021" href="../../server.112/e40402/initparams037.htm#REFRN10021"><code dir="ltr">CONTROL_FILES</code></a></p>
</td>
<td class="cellalignment1942" headers="r2c1-t9 r1c2-t9">
<p>Specifies one or more names of control files, separated by commas.</p>
</td>
<td class="cellalignment1942" headers="r2c1-t9 r1c3-t9">
<p>Do not set this parameter if you want the duplicate database control files in an OMF format. Oracle recommends that you use a server parameter file at the duplicate database when using control files in an OMF format.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t9" headers="r1c1-t9">
<p><a class="olink REFRN10038" href="../../server.112/e40402/initparams057.htm#REFRN10038"><code dir="ltr">DB_FILE_NAME_CONVERT</code></a></p>
</td>
<td class="cellalignment1942" headers="r3c1-t9 r1c2-t9">
<p>Converts the file name of a new data file on the primary database to a file name on the duplicate database.</p>
</td>
<td class="cellalignment1942" headers="r3c1-t9 r1c3-t9">
<p>Do not set this parameter. Omitting this parameter enables the database to generate valid Oracle managed file names for the duplicate data files.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t9" headers="r1c1-t9">
<p><a class="olink REFRN10098" href="../../server.112/e40402/initparams137.htm#REFRN10098"><code dir="ltr">LOG_FILE_NAME_CONVERT</code></a></p>
</td>
<td class="cellalignment1942" headers="r4c1-t9 r1c2-t9">
<p>Converts the file name of a new log file on the primary database to the file name of a log file on the standby database.</p>
</td>
<td class="cellalignment1942" headers="r4c1-t9 r1c3-t9">
<p>Do not set this parameter. Omitting this parameter allows the database to generate valid Oracle managed online redo log file names.</p>
<p>To direct duplicate database online redo log files to Oracle managed storage, you can use the <code dir="ltr">DB_CREATE_FILE_DEST</code>, <code dir="ltr">DB_RECOVERY_FILE_DEST</code>, or <code dir="ltr">DB_CREATE_ONLINE_LOG_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> initialization parameters to identify an Oracle managed location for the online logs.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformalwidemax" --></div>
<!-- class="sect3" -->
<a id="i1009370"></a>
<div id="BRADV89944" class="sect3">
<h4 class="sect3">Setting Initialization Parameters for ASM</h4>
<p>The procedure for creating a duplicate database to an ASM location is similar to the procedure described in <a href="#BGBDCDGJ">"Settings and Restrictions for OMF Initialization Parameters"</a>. The difference is that you must identify the initialization parameters that control the location where files are created and set these parameters to an ASM disk group. For example, set <code dir="ltr">DB_CREATE_FILE_DEST</code>, <code dir="ltr">DB_CREATE_ONLINE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code>, and <code dir="ltr">CONTROL_FILES</code> to <code dir="ltr">+DISK1</code>.</p>
<a id="CHDHAADF"></a>
<div id="BRADV89945" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4">Duplicating a Database from a File System to ASM: Example</h5>
<p>In this example, you use active database duplication. If the source database uses a server parameter file (or a backup is available), then you can create a temporary initialization parameter file on the destination host and set only the <code dir="ltr">DB_NAME</code> parameter.</p>
<p>Assume that the source database <code dir="ltr">prod</code> is on <code dir="ltr">host1</code> and stores its data files in a non-ASM file system. The control files for <code dir="ltr">prod</code> are located in <code dir="ltr">/oracle/oradata/prod/</code>. You want to duplicate the source database to database <code dir="ltr">dupdb</code> on remote host <code dir="ltr">host2</code>. You want to store the duplicate database files in ASM disk group <code dir="ltr">+DISK1</code>.</p>
<p>After connecting RMAN to the target, duplicate, and recovery catalog databases, run the RMAN script shown in <a href="#CHDJJAAG">Example 25-4</a> to duplicate the database.</p>
<div id="BRADV450" class="example">
<p class="titleinexample"><a id="CHDJJAAG"></a>Example 25-4 Duplicating from a File System to ASM (Active)</p>
<pre dir="ltr">
DUPLICATE TARGET DATABASE TO dupdb
  FROM ACTIVE DATABASE
  SPFILE 
    PARAMETER_VALUE_CONVERT '/oracle/oradata/prod/', '+DISK1'
    SET DB_CREATE_FILE_DEST +DISK1;
</pre></div>
<!-- class="example" -->
<p>When the <code dir="ltr">DUPLICATE</code> command completes, the duplicate database is created, with data files, online redo log files, and control files in ASM disk group <code dir="ltr">+DISK1</code>.</p>
</div>
<!-- class="sect4" -->
<a id="CHDFJJBB"></a>
<div id="BRADV89946" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4">Duplicating a Database from ASM to ASM: Example</h5>
<p>In this example, you use active database duplication. If the source database uses a server parameter file (or a backup is available), then you can create a temporary initialization parameter file on the destination host and set only the <code dir="ltr">DB_NAME</code> parameter.</p>
<p>Assume that the source database <code dir="ltr">prod</code> is on <code dir="ltr">host1</code> and stores its data files in ASM disk group <code dir="ltr">+DISK1</code>. You want to duplicate the target to database <code dir="ltr">dupdb</code> on remote host <code dir="ltr">host2</code>. You want to store the data files for <code dir="ltr">dupdb</code> in ASM. Specifically, you want to store the data files and control files in disk group <code dir="ltr">+DISK2</code>.</p>
<p>In the <code dir="ltr">DUPLICATE</code> command, set <code dir="ltr">PARAMETER_VALUE_CONVERT</code> to convert all directory locations from <code dir="ltr">+DISK1</code> to <code dir="ltr">+DISK2</code>. The new file names in <code dir="ltr">+DISK2</code> are generated by ASM and do not match the original file names in disk group <code dir="ltr">+DISK1</code>.</p>
<p>After connecting to the target, duplicate, and catalog databases, run the RMAN script shown in <a href="#CHDBIBBJ">Example 25-5</a> to duplicate the database.</p>
<div id="BRADV451" class="example">
<p class="titleinexample"><a id="CHDBIBBJ"></a>Example 25-5 Duplicating from ASM to ASM (Active)</p>
<pre dir="ltr">
DUPLICATE TARGET DATABASE
  TO dupdb
  FROM ACTIVE DATABASE
  SPFILE PARAMETER_VALUE_CONVERT '+DISK1','+DISK2'
     SET DB_RECOVERY_FILE_DEST_SIZE='750G';
</pre></div>
<!-- class="example" -->
<p>When the <code dir="ltr">DUPLICATE</code> command completes, the duplicate database is created, with data files, online redo logs, and control files in the larger ASM disk group <code dir="ltr">+DISK2</code>.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="CIHCDAED"></a>
<div id="BRADV89957" class="sect3">
<h4 class="sect3">Using SET NEWNAME to Create OMF or ASM Files</h4>
<p>To name Oracle managed data files, you can use the same <code dir="ltr">SET NEWNAME</code> commands described in <a href="#CIHEADDE">"Using SET NEWNAME to Name File System Data Files and Temp Files"</a>, but with <code dir="ltr">TO NEW</code> instead of <code dir="ltr">TO '</code><code dir="ltr"><span class="codeinlineitalic">filename</span></code><code dir="ltr">'</code>. RMAN creates the specified data files or temp files with Oracle Managed File names in the location specified by <code dir="ltr">DB_CREATE_FILE_DEST</code>.</p>
<p><span class="bold">To use SET NEWNAME to specify names for Oracle Managed Files:</span></p>
<ol>
<li>
<p>Set the <code dir="ltr">DB_CREATE_FILE_DEST</code> initialization parameter at the auxiliary instance to the desired location</p>
</li>
<li>
<p>Enclose the <code dir="ltr">DUPLICATE</code> command in a <code dir="ltr">RUN</code> block and use <code dir="ltr">SET NEWNAME</code> with the <code dir="ltr">TO NEW</code> option for Oracle Managed Files.</p>
<p><a href="#CIHGEJHH">Example 25-6</a> illustrates a script that specifies literal names for data files <code dir="ltr">1</code> to <code dir="ltr">5</code>. The only Oracle Managed Files in the source database are the data files in the <code dir="ltr">users</code> tablespace. Therefore, <code dir="ltr">TO NEW</code> is specified in the <code dir="ltr">SET NEWNAME</code> command for these files.</p>
<div id="BRADV452" class="example">
<p class="titleinexample"><a id="CIHGEJHH"></a>Example 25-6 Duplicating with SET NEWNAME FOR DATAFILE and FOR TABLESPACE</p>
<pre dir="ltr">
RUN
{
  SET NEWNAME FOR TABLESPACE users TO NEW;
  SET NEWNAME FOR DATAFILE 3 TO NEW;
  SET NEWNAME FOR DATAFILE 1 TO '/oradata1/system01.dbf'; 
  SET NEWNAME FOR DATAFILE 2 TO '/oradata2/sysaux01.dbf';
  SET NEWNAME FOR TEMPFILE 1 TO '/oradatat/temp01';  
  DUPLICATE TARGET DATABASE TO dupdb
    SKIP TABLESPACE tools
    LOGFILE
      GROUP 1 ('/duplogs/redo01a.log', 
               '/duplogs/redo01b.log') SIZE 4M REUSE, 
      GROUP 2 ('/duplogs/redo02a.log', 
               '/duplogs/redo02b.log') SIZE 4M REUSE;
}
</pre></div>
<!-- class="example" -->
<p>As shown in <a href="#CIHIAFDB">Example 25-7</a>, you can also use <code dir="ltr">SET</code> <code dir="ltr">NEWNAME</code> to direct individual data files, temp files, or tablespaces to a specified ASM disk group.</p>
<div id="BRADV453" class="example">
<p class="titleinexample"><a id="CIHIAFDB"></a>Example 25-7 Using SET NEWNAME to Create Files in an ASM Disk Group</p>
<pre dir="ltr">
RUN
{
   SET NEWNAME FOR DATAFILE 1 TO "+DGROUP1";
   SET NEWNAME FOR DATAFILE 2 TO "+DGROUP2";
   .
   .
   .
   DUPLICATE TARGET DATABASE 
     TO dupdb
     FROM ACTIVE DATABASE
     SPFILE SET DB_CREATE_FILE_DEST +DGROUP3;
}
</pre></div>
<!-- class="example" --></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF153" href="../../backup.112/e10643/rcmsynta2014.htm#RCMRF153"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for details on using <code dir="ltr">SET</code> <code dir="ltr">NEWNAME</code></div>
</div>
<!-- class="sect3" -->
<a id="CIHEGJBI"></a>
<div id="BRADV614" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Using DB_FILE_NAME_CONVERT to Generate Names for Non-OMF or ASM Data Files</h4>
<p>Another technique to generate names besides using <code dir="ltr">SET NEWNAME</code> or <code dir="ltr">CONFIGURE AUXNAME</code> commands is to use <code dir="ltr">DB_FILE_NAME_CONVERT</code> to transform target file names. For example, you can change the target file name from <code dir="ltr">/oracle/</code> to <code dir="ltr">/dup/oracle/</code>. <code dir="ltr">DB_FILE_NAME_CONVERT</code> enables you to specify multiple conversion file name pairs. It can also be used to produce names for data files and temp files.</p>
<p>You can specify <code dir="ltr">DB_FILE_NAME_CONVERT</code> in the <code dir="ltr">DUPLICATE</code> command or you can set it in the initialization parameter of the auxiliary instance.</p>
<div id="BRADV615" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref1844"></a>
<h5 class="sect4">Restrictions of DB_FILE_NAME_CONVERT:</h5>
<p>You cannot use the <code dir="ltr">DB_FILE_NAME_CONVERT</code> clause of the <code dir="ltr">DUPLICATE</code> command to control generation of new names for files at the duplicate instance that are in the Oracle Managed Files (OMF) format at the source database instance. See <a class="olink RCMRF" href="../e10643/toc.htm"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for details on this restriction.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="CIHFDDDH"></a>
<div id="BRADV616" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Using LOG_FILE_NAME_CONVERT to Generate Names for Non-OMF or ASM Log Files</h4>
<p>If the <code dir="ltr">LOG_FILE</code> clause has been omitted and none of the Oracle Managed Files initialization parameters <code dir="ltr">DB_CREATE_FILE_DEST</code>, <code dir="ltr">DB_CREATE_ONLINE_DEST_n</code>, or <code dir="ltr">DB_RECOVERY_FILE_DEST</code> are specified, then <code dir="ltr">LOG_FILE_NAME_CONVERT</code> can transforms target file names. This works in much the same way as the <code dir="ltr">DB_FILE_NAME_CONVERT</code> and can transform target file names from <code dir="ltr">log_*</code> to <code dir="ltr">duplog_*</code>. You can specify multiple conversion file name pairs with this parameter.</p>
<p>When you specify <code dir="ltr">LOG_FILE_NAME_CONVERT</code>, RMAN uses the <code dir="ltr">REUSE</code> parameter when creating the online redo logs. If an online redo log file already exists at the named location and is of the correct size, then it is reused for the duplicate.</p>
<div id="BRADV617" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref1845"></a>
<h5 class="sect4">Restrictions of LOG_FILE_NAME_CONVERT:</h5>
<ul>
<li>
<p>Do not specify <code dir="ltr">LOG_FILE_NAME_CONVERT</code> if you set Oracle Managed Files initialization parameters.</p>
</li>
<li>
<p><code dir="ltr">LOG_FILE_NAME_CONVERT</code> cannot be specified as a <code dir="ltr">DUPLICATE</code> clause, it can only be specified in the initialization parameter of the auxiliary instance.</p>
</li>
<li>
<p>You cannot use the <code dir="ltr">LOG_FILE_NAME_CONVERT</code> initialization parameter to control generation of new names for files at the duplicate instance that are in the Oracle Managed Files (OMF) format at the source database instance.</p>
</li>
</ul>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BGBJEGCC"></a>
<div id="BRADV99994" class="sect1">
<h2 class="sect1">Making Disk Backups Accessible Without Shared Disk</h2>
<p><a href="rcmdupdb.htm#CHDCCDDD">"Step 3: Making Backups Accessible to the Duplicate Instance"</a> recommends using the shared disk technique to make backups available to the auxiliary instance. When NFS or shared disk is not an option, then the path that stores the backups must exist on <span class="italic">both</span> the source and destination hosts unless the <code dir="ltr">BACKUP LOCATION</code> option is used for the DUPLICATE command without a target or recovery catalog connection.</p>
<p>Assume that you maintain two hosts, <code dir="ltr">srchost</code> and <code dir="ltr">dsthost</code>. The database on <code dir="ltr">srchost</code> is <code dir="ltr">srcdb</code>. The RMAN backups of <code dir="ltr">srcdb</code> reside in <code dir="ltr">/dsk1/bkp</code> on host <code dir="ltr">srchost</code>. The directory <code dir="ltr">/dsk1/bkp</code> is already in use on the destination host, so you intend to store backups in <code dir="ltr">/dsk2/dup</code> on the destination host.</p>
<p><span class="bold">To transfer the backups from the source host to the destination host:</span></p>
<ol>
<li>
<p>Create a new directory in the source host that has the same name as the directory on the destination host that will contain the backups.</p>
<p>For example, if you intend to store the RMAN backups in <code dir="ltr">/dsk2/dup</code> on the destination host, then create <code dir="ltr">/dsk2/dup</code> on the source host.</p>
</li>
<li>
<p>On the source host, copy the backups to the directory created in the previous step, and then catalog the backups. You can use either of the following approaches:</p>
<ul>
<li>
<p>Connect RMAN to the source database as <code dir="ltr">TARGET</code> and use the <code dir="ltr">BACKUP</code> command to back up the backups, as explained in <a href="rcmbckba.htm#CHDFCCCF">"Backing Up RMAN Backups"</a>. For example, use the <code dir="ltr">BACKUP COPY OF DATABASE</code> command to copy the backups in <code dir="ltr">/dsk1/bkp</code> on the source host to <code dir="ltr">/dsk2/dup</code> on the source host. In this case, RMAN automatically catalogs the backups in the new location.</p>
</li>
<li>
<p>Use an operating system utility to copy the backups in <code dir="ltr">/dsk1/bkp</code> on the source host to <code dir="ltr">/dsk2/dup</code> on the source host. Afterward, connect RMAN to the source database as <code dir="ltr">TARGET</code> and use the <code dir="ltr">CATALOG</code> command to update the source control file with the location of the manually transferred backups.</p>
</li>
</ul>
</li>
<li>
<p>Manually transfer the backups in the new directory on the source host to the identically named directory on the destination host.</p>
<p>For example, use FTP to transfer the backups in <code dir="ltr">/dsk2/dup</code> on the source host to <code dir="ltr">/dsk2/dup</code> on the destination host.</p>
</li>
</ol>
<p>The auxiliary channel can search for backups in <code dir="ltr">/dsk2/dup</code> on the destination host and restore them.</p>
</div>
<!-- class="sect1" -->
<a id="CIHEGGGC"></a>
<div id="BRADV454" class="sect1">
<h2 class="sect1">Duplicating a Database When No Server Parameter File Exists</h2>
<p>The procedure in <a href="rcmdupdb.htm#i1006474">"Step 5: Creating an Initialization Parameter File and Starting the Auxiliary Instance"</a> assumes that you use the <code dir="ltr">SPFILE</code> clause of the <code dir="ltr">DUPLICATE</code> command. If the source database does <span class="italic">not</span> use a server parameter file, then you must set all necessary parameters for the auxiliary instance in a text-based initialization parameter file.</p>
<p><a href="#CHDCAAIA">Table 25-5</a> describes a subset of the possible initialization parameters. See <a class="olink REFRN" href="../../server.112/e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a> provides more information about these parameters. See <a href="#CIHJJJAJ">Table 25-1</a> to learn about options for naming duplicate files.</p>
<div id="BRADV455" class="tblruleformalwidemax">
<p class="titleintable"><a id="sthref1846"></a><a id="CHDCAAIA"></a>Table 25-5 Auxiliary Instance Initialization Parameters</p>
<table class="cellalignment1945" title="Auxiliary Instance Initialization Parameters" summary="Describes the DB_NAME and CONTROL_FILES parameters." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t11">Initialization Parameter</th>
<th class="cellalignment1941" id="r1c2-t11">Value</th>
<th class="cellalignment1941" id="r1c3-t11">Status</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t11" headers="r1c1-t11">
<p><a class="olink REFRN10041" href="../../server.112/e40402/initparams064.htm#REFRN10041"><code dir="ltr">DB_NAME</code></a></p>
</td>
<td class="cellalignment1942" headers="r2c1-t11 r1c2-t11">
<p>The same name used in the <code dir="ltr">DUPLICATE</code> command. If you are using <code dir="ltr">DUPLICATE</code> to create a standby database, then the name must be the same as the primary database.</p>
<p>The <code dir="ltr">DB_NAME</code> setting for the duplicate database must be unique among databases in its Oracle home.</p>
</td>
<td class="cellalignment1942" headers="r2c1-t11 r1c3-t11">
<p>Required</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t11" headers="r1c1-t11">
<p><a class="olink REFRN10021" href="../../server.112/e40402/initparams037.htm#REFRN10021"><code dir="ltr">CONTROL_FILES</code></a></p>
</td>
<td class="cellalignment1942" headers="r3c1-t11 r1c2-t11">
<p>Control file locations</p>
</td>
<td class="cellalignment1942" headers="r3c1-t11 r1c3-t11">
<p>Required</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t11" headers="r1c1-t11">
<p><a class="olink REFRN10031" href="../../server.112/e40402/initparams050.htm#REFRN10031"><code dir="ltr">DB_BLOCK_SIZE</code></a></p>
</td>
<td class="cellalignment1942" headers="r4c1-t11 r1c2-t11">
<p>The block size for the duplicate database. This block size must match the block size of the source database. If the source database parameter file contains a value for the <code dir="ltr">DB_BLOCK_SIZE</code> initialization parameter, then you must specify the same value for the auxiliary instance. If no <code dir="ltr">DB_BLOCK_SIZE</code> is specified in the source database initialization parameter file, however, then do not specify <code dir="ltr">DB_BLOCK_SIZE</code> in the auxiliary instance.</p>
</td>
<td class="cellalignment1942" headers="r4c1-t11 r1c3-t11">
<p>Required if this initialization parameter is set in the source database</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r5c1-t11" headers="r1c1-t11">
<p><a class="olink REFRN10038" href="../../server.112/e40402/initparams057.htm#REFRN10038"><code dir="ltr">DB_FILE_NAME_CONVERT</code></a></p>
</td>
<td class="cellalignment1942" headers="r5c1-t11 r1c2-t11">
<p>Pairs of strings for converting the names of data files and temp files. You can also specify <code dir="ltr">DB_FILE_NAME_CONVERT</code> on the <code dir="ltr">DUPLICATE</code> command itself. See <a href="#CIHEGJBI">"Using DB_FILE_NAME_CONVERT to Generate Names for Non-OMF or ASM Data Files"</a>.</p>
</td>
<td class="cellalignment1942" headers="r5c1-t11 r1c3-t11">
<p>Optional</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r6c1-t11" headers="r1c1-t11">
<p><a class="olink REFRN10098" href="../../server.112/e40402/initparams137.htm#REFRN10098"><code dir="ltr">LOG_FILE_NAME_CONVERT</code></a></p>
</td>
<td class="cellalignment1942" headers="r6c1-t11 r1c2-t11">
<p>Pairs of strings for naming online redo log files. See <a href="#CIHFDDDH">"Using LOG_FILE_NAME_CONVERT to Generate Names for Non-OMF or ASM Log Files"</a>.</p>
</td>
<td class="cellalignment1942" headers="r6c1-t11 r1c3-t11">
<p>Optional</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r7c1-t11" headers="r1c1-t11">
<p><a class="olink REFRN10034" href="../../server.112/e40402/initparams053.htm#REFRN10034"><code dir="ltr">DB_CREATE_FILE_DEST</code></a></p>
</td>
<td class="cellalignment1942" headers="r7c1-t11 r1c2-t11">
<p>Location for Oracle managed data files.</p>
</td>
<td class="cellalignment1942" headers="r7c1-t11 r1c3-t11">
<p>Optional</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r8c1-t11" headers="r1c1-t11">
<p><a class="olink REFRN10035" href="../../server.112/e40402/initparams054.htm#REFRN10035"><code dir="ltr">DB_CREATE_ONLINE_LOG_DEST</code>_<code dir="ltr"><span class="codeinlineitalic">n</span></code></a></p>
</td>
<td class="cellalignment1942" headers="r8c1-t11 r1c2-t11">
<p>Location for Oracle managed online redo log files</p>
</td>
<td class="cellalignment1942" headers="r8c1-t11 r1c3-t11">
<p>Optional</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r9c1-t11" headers="r1c1-t11">
<p><a class="olink REFRN10234" href="../../server.112/e40402/initparams065.htm#REFRN10234"><code dir="ltr">DB_RECOVERY_FILE_DEST</code></a></p>
</td>
<td class="cellalignment1942" headers="r9c1-t11 r1c2-t11">
<p>Location for fast recovery area</p>
</td>
<td class="cellalignment1942" headers="r9c1-t11 r1c3-t11">
<p>Optional</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r10c1-t11" headers="r1c1-t11">
<p>Oracle Real Application Cluster (Oracle RAC) parameters:</p>
<ul>
<li>
<p><span class="italic">&lt;INSTANCESIDn&gt;</span>.<code dir="ltr">INSTANCE_NAME</code></p>
</li>
<li>
<p><span class="italic">&lt;INSTANCESIDn&gt;</span>.<code dir="ltr">INSTANCE_NUMBER</code></p>
</li>
<li>
<p><span class="italic">&lt;INSTANCESIDn&gt;</span>.<code dir="ltr">THREAD</code></p>
</li>
<li>
<p><span class="italic">&lt;INSTANCESIDn</span>&gt;.<code dir="ltr">UNDO_TABLESPACE</code></p>
</li>
<li>
<p><span class="italic">&lt;INSTANCESIDn</span>&gt;.<code dir="ltr">LOCAL_LISTENER</code></p>
</li>
</ul>
</td>
<td class="cellalignment1942" headers="r10c1-t11 r1c2-t11">
<p>Set these parameters for each instance of the Oracle RAC database.</p>
</td>
<td class="cellalignment1942" headers="r10c1-t11 r1c3-t11">
<p>Required for Oracle RAC configuration</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformalwidemax" -->
<p><span class="bold">To create an initialization parameter file when not planning to use the SPFILE clause:</span></p>
<ol>
<li>
<p>Use an operating system utility to make a copy of the initialization parameter file of the source database in the operating system-specific default location.</p>
</li>
<li>
<p>In the copied initialization parameter file, manually change <code dir="ltr">DB_NAME</code> to the name of the duplicate database. If you are using <code dir="ltr">DUPLICATE</code> to create a standby database, then the name must be the same as the primary database.</p>
</li>
<li>
<p>If necessary, change other initialization parameters, including the parameters that allow you to connect as <code dir="ltr">SYSDBA</code> through Oracle Net, as needed. You must verify that all paths are accessible on the host where the database is being duplicated.</p>
<p><a href="#CHDCDFIJ">Example 25-8</a> shows a sample initialization parameter file.</p>
<div id="BRADV456" class="example">
<p class="titleinexample"><a id="CHDCDFIJ"></a>Example 25-8 Sample Initialization Parameter File for the Auxiliary Instance</p>
<pre dir="ltr">
DB_NAME=dupdb
CONTROL_FILES=(/dup/oracle/oradata/prod/control01.ctl,
               /dup/oracle/oradata/prod/control02.ctl)
DB_FILE_NAME_CONVERT=(/oracle/oradata/prod/,/dup/oracle/oradata/prod/)
LOG_FILE_NAME_CONVERT=(/oracle/oradata/prod/redo,/dup/oracle/oradata/prod/redo)
</pre></div>
<!-- class="example" --></li>
</ol>
</div>
<!-- class="sect1" -->
<a id="BGBCBBCH"></a>
<div id="BRADV457" class="sect1">
<h2 class="sect1">Starting the Auxiliary Instance When No Server Parameter File Exists</h2>
<p><a href="rcmdupdb.htm#i1006474">"Step 5: Creating an Initialization Parameter File and Starting the Auxiliary Instance"</a> assumes that the source database instance uses a server parameter file. This scenario assumes that the source database does not currently use a server parameter file or RMAN cannot restore a backup server parameter file. In this case, you must start the auxiliary instance with a text-based initialization parameter file.</p>
<p><span class="bold">To start the auxiliary instance in preparation for database duplication:</span></p>
<ol>
<li>
<p>Copy the text-based initialization parameter file to the default location on the host containing the SQL*Plus client.</p>
</li>
<li>
<p>Start SQL*Plus and connect to the auxiliary instance with <code dir="ltr">SYSOPER</code> privileges.</p>
</li>
<li>
<p>Start the auxiliary instance in <code dir="ltr">NOMOUNT</code> mode, using the text-based initialization parameter file:</p>
<pre dir="ltr">
SQL&gt; STARTUP NOMOUNT
</pre></li>
<li>
<p>Copy the text-based initialization parameter file for the auxiliary instance to the same host as the RMAN client used to perform the duplication. You must specify the location of this text-based initialization parameter file in the <code dir="ltr">PFILE</code> clause of the <code dir="ltr">DUPLICATE</code> command.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CHDEJHBD"></a>
<div id="BRADV89951" class="sect1">
<h2 class="sect1">Duplicating a Subset of the Source Database Tablespaces</h2>
<p>It is not always necessary to duplicate all tablespaces of a database. For example, you may plan to generate reports that require only a subset of tablespaces from your source database.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
When excluding tablespaces in backup-based duplication <span class="italic">without</span> a target connection or <span class="italic">without</span> a target and a recovery catalog connection, RMAN has special prerequisites. See the Prerequisites section of the <code dir="ltr">DUPLICATE</code> entry in <a class="olink RCMRF126" href="../../backup.112/e10643/rcmsynta020.htm#RCMRF126"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for details.</div>
<p><a id="sthref1847"></a><a href="#CIHCHJFC">Table 25-6</a> explains <code dir="ltr">DUPLICATE</code> command options for specifying subsets of tablespaces for the duplicate database.</p>
<div id="BRADV458" class="tblruleformal">
<p class="titleintable"><a id="sthref1848"></a><a id="CIHCHJFC"></a>Table 25-6 Options to Specify Subsets of Tablespaces for the Duplicate Database</p>
<table class="cellalignment1945" title="Options to Specify Subsets of Tablespaces for the Duplicate Database" summary="A list of the options to exclude tablespaces from the duplicate database" dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t13">DUPLICATE Options</th>
<th class="cellalignment1941" id="r1c2-t13">Explanation</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t13" headers="r1c1-t13">
<p><code dir="ltr">SKIP READONLY</code></p>
</td>
<td class="cellalignment1942" headers="r2c1-t13 r1c2-t13">
<p>Excludes the data files of read-only tablespaces from the duplicate database</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t13" headers="r1c1-t13">
<p><code dir="ltr">SKIP TABLESPACE</code> <code dir="ltr"><span class="codeinlineitalic">'tablespace_name ', ...</span></code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t13 r1c2-t13">
<p>Excludes the specified tablespaces from the duplicate database. You cannot exclude the <code dir="ltr">SYSTEM</code> and <code dir="ltr">SYSAUX</code> tablespaces, tablespaces with <code dir="ltr">SYS</code> objects, undo tablespaces, tablespaces with undo segments, tablespaces with materialized views, or tablespaces in such a way that the duplicated tablespaces are not self-contained.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t13" headers="r1c1-t13">
<p><code dir="ltr">TABLESPACE</code> <code dir="ltr"><span class="codeinlineitalic">'tablespace_name ', ...</span></code></p>
</td>
<td class="cellalignment1942" headers="r4c1-t13 r1c2-t13">
<p>Automatically includes the <code dir="ltr">SYSTEM</code>, <code dir="ltr">SYSAUX</code>, and undo tablespaces. The included tablespaces must be self-contained and the resulting skipped tablespaces must not contain <code dir="ltr">SYS</code> objects or materialized views.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" -->
<p class="subhead2"><a id="BRADV459"></a>To specify a subset of tablespaces for a duplicate database:</p>
<ol>
<li>
<p>Ensure that you have completed Steps 1 through 4 in <a href="rcmdupdb.htm#BGBGCJAG">"Basic Steps of Database Duplication"</a>.</p>
</li>
<li>
<p>Run the <code dir="ltr">DUPLICATE</code> command with one or more of the options in <a href="#CIHCHJFC">Table 25-6</a>.</p>
</li>
</ol>
<p>Other factors that influence what tablespaces are copied include the <code dir="ltr">OFFLINE NORMAL</code> option. When tablespaces are taken offline with the <code dir="ltr">OFFLINE NORMAL</code> option before duplication, RMAN does not duplicate the associated data files, and issues <code dir="ltr">DROP TABLESPACE</code> statement for these tablespaces on the duplicate database. Therefore, you do not have to specify options to exclude these tablespaces.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
RMAN does duplicate tablespaces that are taken offline with any other option besides <code dir="ltr">NORMAL</code> (unless they are named in a <code dir="ltr">SKIP TABLESPACE</code> option). Only <code dir="ltr">OFFLINE NORMAL</code> tablespaces are skipped automatically. As with online tablespaces, RMAN requires a valid backup for these tablespaces when you use backup-based duplication.</div>
<a id="BGBCHEJB"></a>
<div id="BRADV89952" class="sect2">
<h3 class="sect2">Excluding Specified Tablespaces</h3>
<p><a href="#CIHCBHHJ">Example 25-9</a> shows how to skip read-only tablespaces.</p>
<div id="BRADV460" class="example">
<p class="titleinexample"><a id="CIHCBHHJ"></a>Example 25-9 Excluding Read-Only Tablespaces</p>
<pre dir="ltr">
DUPLICATE TARGET DATABASE TO dupdb
  FROM ACTIVE DATABASE
  SKIP READONLY
  NOFILENAMECHECK;
</pre></div>
<!-- class="example" -->
<p><a href="#CIHGHJAF">Example 25-10</a> shows how to skip a tablespace named <code dir="ltr">tools</code>.</p>
<div id="BRADV461" class="example">
<p class="titleinexample"><a id="CIHGHJAF"></a>Example 25-10 Excluding Specified Tablespaces</p>
<pre dir="ltr">
DUPLICATE TARGET DATABASE 
  TO dupdb
  FROM ACTIVE DATABASE
  SKIP TABLESPACE tools
  NOFILENAMECHECK;
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<a id="BGBHFHED"></a>
<div id="BRADV89954" class="sect2">
<h3 class="sect2">Including Specified Tablespaces</h3>
<p><a id="sthref1849"></a>You can use the <code dir="ltr">TABLESPACE</code> option to specify which tablespaces to include in the specified database. Unlike the <code dir="ltr">SKIP TABLESPACE</code> option, which specifies which tablespaces to exclude from the duplicate database, this option specifies which tablespaces to include and then skips the remaining tablespaces. The duplicated subset of tablespaces must be self-contained. The resulting set of skipped tablespaces must not have undo segments or materialized views.</p>
<p><a href="#BGBCJJFE">Example 25-11</a> is a variation of <a href="rcmdupdb.htm#BGBEEAEH">Example 24-1</a> except with the <code dir="ltr">users</code> tablespace included, which is assumed to be self-contained, and all other tablespaces excluded, except for <code dir="ltr">SYSTEM</code> and <code dir="ltr">SYSAUX</code> tablespaces and tablespaces with undo segments.</p>
<div id="BRADV462" class="example">
<p class="titleinexample"><a id="BGBCJJFE"></a>Example 25-11 Including Specified Tablespaces</p>
<pre dir="ltr">
DUPLICATE TARGET DATABASE 
  TO dupdb
  FROM ACTIVE DATABASE
  TABLESPACE users
  NOFILENAMECHECK;
</pre></div>
<!-- class="example" -->
<p>Assume that you perform backup-based duplication with a target connection, but no recovery catalog connection. Assume that you want to specify a subset of tablespaces for duplication. If the target database is not open in this scenario, then RMAN has no way to obtain the names of the tablespaces with undo segments. Thus, you must specify the <code dir="ltr">UNDO TABLESPACE</code> option for these tablespaces as shown in <a href="#BGBJGECI">Example 25-12</a>.</p>
<div id="BRADV463" class="example">
<p class="titleinexample"><a id="BGBJGECI"></a>Example 25-12 Including Specified Tablespaces</p>
<pre dir="ltr">
DUPLICATE TARGET DATABASE TO dupdb
  TABLESPACE users
  UNDO TABLESPACE undotbs
  NOFILENAMECHECK;
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1933">
<tr>
<td class="cellalignment1942">
<table class="cellalignment1938">
<tr>
<td class="cellalignment1937"><a href="rcmdupdb.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1937"><a href="rcmttbsb.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1944">
<table class="cellalignment1936">
<tr>
<td class="cellalignment1937"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1937"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1937"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1937"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1937"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1937"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
