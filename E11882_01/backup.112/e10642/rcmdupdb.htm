<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Duplicating a Database</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1054" />
<meta name="description" content="A guide to backup and recovery of Oracle databases, including RMAN backup and recovery, RMAN data transfer, Oracle Flashback Technology, and user-managed backup and recovery" />
<meta name="dcterms.created" content="2015-05-13T14:1:12Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Backup and Recovery User's Guide" />
<meta name="dcterms.identifier" content="E10642-08" />
<meta name="dcterms.isVersionOf" content="BRADV" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="part_tra.htm" title="Previous" type="text/html" />
<link rel="Next" href="rcmdupad.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10642.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">38/47</span> <!-- End Header -->
<div id="BRADV010" class="chapter"><a id="BGBHBIFE"></a> <a id="i1008564"></a>
<h1 class="chapter"><span class="secnum">24</span> Duplicating a Database</h1>
<p>This chapter describes how to use <a id="sthref1792"></a><a id="sthref1793"></a>the <code dir="ltr">DUPLICATE</code> command to create an independently functioning database copy.</p>
<p>This chapter contains the following topics:</p>
<ul>
<li>
<p><a href="#CHDJJBCF">Overview of RMAN Database Duplication</a></p>
</li>
<li>
<p><a href="#BGBFDJHB">Preparing to Duplicate a Database</a></p>
</li>
<li>
<p><a href="#CHDJHHCC">Placing the Source Database in the Proper State</a></p>
</li>
<li>
<p><a href="#CHDCAIAB">Starting RMAN and Connecting to Databases</a></p>
</li>
<li>
<p><a href="#CHDBFGHF">Configuring RMAN Channels for Use in Duplication</a></p>
</li>
<li>
<p><a href="#i1006629">Duplicating a Database</a></p>
</li>
<li>
<p><a href="#BGBEFJHH">Restarting DUPLICATE After a Failure</a></p>
</li>
</ul>
<a id="CHDJJBCF"></a>
<div id="BRADV89927" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Overview of RMAN Database Duplication</h2>
<p>Database <span class="bold">duplication</span> is the use of the <code dir="ltr">DUPLICATE</code> command to copy all or a subset of the data in a source database. The <a href="glossary.htm#CHDCJHEF"><span class="xrefglossterm">duplicate database</span></a> (the copied database) functions entirely independently from the <a href="glossary.htm#CHDJHAEF"><span class="xrefglossterm">source database</span></a> (the database being copied).</p>
<div id="BRADV89928" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1794"></a>
<h3 class="sect2">Purpose of Database Duplication</h3>
<p>A duplicate database is useful for a variety of purposes, most of which involve testing. You can perform the following tasks in a duplicate database:</p>
<ul>
<li>
<p>Test backup and recovery procedures</p>
</li>
<li>
<p>Test an upgrade to a new release of Oracle Database</p>
</li>
<li>
<p>Test the effect of applications on database performance</p>
</li>
<li>
<p>Create a standby database</p>
</li>
<li>
<p>Generate reports</p>
</li>
</ul>
<p>For example, you can duplicate the production database on <code dir="ltr">host1</code> to <code dir="ltr">host2</code>, and then use the duplicate database on <code dir="ltr">host2</code> to practice restoring and recovering this database while the production database on <code dir="ltr">host1</code> operates as usual.</p>
<p>If you copy a database with operating system utilities instead of the <code dir="ltr">DUPLICATE</code> command, then the <a href="glossary.htm#BGBHDHCI"><span class="xrefglossterm">DBID</span></a> of the copied database remains the same as the original database. To register the copy database in the same recovery catalog with the original, you must change the DBID with the <a id="sthref1795"></a>DBNEWID utility (see <a class="olink SUTIL" href="../../server.112/e22490/toc.htm"><span class="italic">Oracle Database Utilities</span></a>). In contrast, the <code dir="ltr">DUPLICATE</code> command automatically assigns the duplicate database a different DBID so that it can be registered in the same recovery catalog as the source database.</p>
<p><a id="sthref1796"></a>The <code dir="ltr">DUPLICATE</code> command can create a fully functional copy of your database or a <a href="glossary.htm#i433531"><span class="xrefglossterm">physical standby database</span></a>, which serves a very different purpose. A standby database is a copy of the primary database that you update continually with archived log files from the primary database. If the primary database is inaccessible, then you can fail over to the standby database, which becomes the new primary database. A database copy, however, cannot be used in this way: it is not intended for failover scenarios and does <span class="italic">not</span> support the various standby recovery and failover options.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SBYDB01500" href="../../server.112/e41134/rcmbackp.htm#SBYDB01500"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to create a standby database with the <code dir="ltr">DUPLICATE</code> command</div>
</div>
<!-- class="sect2" -->
<div id="BRADV89929" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1797"></a>
<h3 class="sect2">Basic Concepts of Database Duplication</h3>
<p>The <a href="glossary.htm#CHDDIABD"><span class="xrefglossterm">source host</span></a> is the computer that hosts the source database. The <span class="bold">source database instance</span> is the instance associated with the source database.</p>
<p>The <a href="glossary.htm#CHDBCDEE"><span class="xrefglossterm">destination host</span></a> is the computer that hosts the duplicate database. The source host and destination host can be the same or different computers. The database instance associated with the duplicate database is called the <a href="glossary.htm#CHDGIGEB"><span class="xrefglossterm">auxiliary instance</span></a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Performing simultaneous database duplication operations using the same source database is not supported.</div>
<div id="BRADV416" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1798"></a>
<h4 class="sect3">Techniques for Duplicating a Database</h4>
<p>RMAN supports two basic types of duplication: active database duplication and backup-based duplication. RMAN can perform backup-based duplication with or without either of the following connections:</p>
<ul>
<li>
<p>Target</p>
</li>
<li>
<p>Recovery catalog</p>
</li>
</ul>
<p>A connection to both is required for active database duplication.</p>
<p><a href="#BGBBFIAD">Figure 24-1</a> shows the decision tree for the two duplication techniques.</p>
<div id="BRADV531" class="figure">
<p class="titleinfigure"><a id="BGBBFIAD"></a>Figure 24-1 Duplication Techniques</p>
<img width="498" height="185" src="img/bradv044.gif" alt="Description of Figure 24-1 follows" /><br />
<a id="sthref1799" href="img_text/bradv044.htm">Description of "Figure 24-1 Duplication Techniques"</a><br />
<br /></div>
<!-- class="figure" -->
<div id="BRADV418" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref1800"></a>
<h5 class="sect4">Active Database Duplication</h5>
<p><a id="sthref1801"></a><a id="sthref1802"></a>In <a id="sthref1803"></a><a href="glossary.htm#CHDJIFJB"><span class="xrefglossterm">active database duplication</span></a>, RMAN connects as <code dir="ltr">TARGET</code> to the source database instance and as <code dir="ltr">AUXILIARY</code> to the auxiliary instance. RMAN copies the live source database over the network to the auxiliary instance, thereby creating the duplicate database. No backups of the source database are required. <a href="#BGBHBEJH">Figure 24-2</a> illustrates active database duplication.</p>
<div id="BRADV419" class="figure">
<p class="titleinfigure"><a id="BGBHBEJH"></a>Figure 24-2 Active Database Duplication</p>
<img width="474" height="357" src="img/bradv045.gif" alt="Description of Figure 24-2 follows" /><br />
<a id="sthref1804" href="img_text/bradv045.htm">Description of "Figure 24-2 Active Database Duplication"</a><br />
<br /></div>
<!-- class="figure" --></div>
<!-- class="sect4" -->
<div id="BRADV420" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref1805"></a>
<h5 class="sect4">Backup-Based Duplication</h5>
<p>In<a id="sthref1806"></a> <a href="glossary.htm#CHDCHHJF"><span class="xrefglossterm">backup-based duplication</span></a>, RMAN creates the duplicate database by using pre-existing RMAN backups and copies. This technique of duplication uses one of the following mutually exclusive subtechniques:</p>
<ul>
<li>
<p><a id="sthref1807"></a>Duplication without a target database connection, RMAN obtains metadata about backups from a recovery catalog.</p>
</li>
<li>
<p><a id="sthref1808"></a>Duplication without a target database connection and without a recovery catalog. RMAN obtains metadata about where backups and copies reside from <code dir="ltr">BACKUP LOCATION</code>.</p>
</li>
<li>
<p><a id="sthref1809"></a>Duplication with a target database connection. RMAN obtains metadata about backups from the target database control file or from the recovery catalog.</p>
</li>
</ul>
<p><a href="#BGBIFBJI">Figure 24-3</a> illustrates backup-based duplication <span class="italic">without</span> a target connection. RMAN connects to a recovery catalog database instance and the auxiliary instance. The destination host must have access to the RMAN backups required to create the duplicate database.</p>
<div id="BRADV421" class="figure">
<p class="titleinfigure"><a id="BGBIFBJI"></a>Figure 24-3 Backup-Based Duplication Without a Target Connection</p>
<img width="476" height="308" src="img/bradv046.gif" alt="Description of Figure 24-3 follows" /><br />
<a id="sthref1810" href="img_text/bradv046.htm">Description of "Figure 24-3 Backup-Based Duplication Without a Target Connection"</a><br />
<br /></div>
<!-- class="figure" -->
<p><a href="#BGBIADHG">Figure 24-4</a> illustrates backup-based duplication <span class="italic">without</span> connections to the target or to the recovery catalog database instance. RMAN connects to the auxiliary instance of the duplicate database on the destination host. A disk backup location containing all the backups or copies for duplication must be available to the destination host.</p>
<div id="BRADV532" class="figure">
<p class="titleinfigure"><a id="BGBIADHG"></a>Figure 24-4 Backup-Based Duplication Without a Target Connection or Recovery Catalog Connection</p>
<img width="420" height="269" src="img/bradv048.gif" alt="Description of Figure 24-4 follows" /><br />
<a id="sthref1811" href="img_text/bradv048.htm">Description of "Figure 24-4 Backup-Based Duplication Without a Target Connection or Recovery Catalog Connection"</a><br />
<br /></div>
<!-- class="figure" -->
<p><a href="#BGBFFBFC">Figure 24-5</a> illustrates backup-based duplication <span class="italic">with</span> a target connection. RMAN connects to the source database instance and the auxiliary instance. Optionally, RMAN can connect to a recovery catalog database (not shown in the figure). The destination host must have access to the RMAN backups required to create the duplicate database.</p>
<div id="BRADV422" class="figure">
<p class="titleinfigure"><a id="BGBFFBFC"></a>Figure 24-5 Backup-Based Duplication with a Target Connection</p>
<img width="476" height="311" src="img/bradv047.gif" alt="Description of Figure 24-5 follows" /><br />
<a id="sthref1812" href="img_text/bradv047.htm">Description of "Figure 24-5 Backup-Based Duplication with a Target Connection"</a><br />
<br /></div>
<!-- class="figure" --></div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<div id="BRADV423" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1813"></a>
<h4 class="sect3">Contents of a Duplicate Database</h4>
<p>A duplicate database can include the same contents as the source database or only a subset of the tablespaces in the source database. For example, you can use the <code dir="ltr">TABLESPACE</code> option to duplicate only specified tablespaces, or the <code dir="ltr">SKIP READONLY</code> option to exclude read-only tablespaces from the duplicate database.</p>
</div>
<!-- class="sect3" -->
<div id="BRADV424" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1814"></a>
<h4 class="sect3">How RMAN Duplicates a Database</h4>
<p>For backup-based duplication, <a id="sthref1815"></a>the <a id="sthref1816"></a>principal work of the duplication is performed by <a id="sthref1817"></a><a id="sthref1818"></a>the <a href="glossary.htm#CHDDHGFC"><span class="xrefglossterm">auxiliary channel</span></a>s. These channels correspond to a server session on the auxiliary instance on the destination host. For active database duplication the primary work is performed by target channels.</p>
<p>RMAN must perform database point-in-time recovery, even when no explicit point in time is provided for duplication. Point-in-time recovery is required because the online redo log files in the source database are not backed up and cannot be applied to the duplicate database. The farthest point of recovery of the duplicate database is the most recent redo log file archived by the source database.</p>
<p>As part of the duplicating operation, RMAN automates the following steps:</p>
<ol>
<li>
<p>Creates a default server parameter file for the auxiliary instance if the following conditions are true:</p>
<ul>
<li>
<p>Duplication does not involve a standby database.</p>
</li>
<li>
<p>Server parameter files are not being duplicated.</p>
</li>
<li>
<p>The auxiliary instance was not started with a server parameter file.</p>
</li>
</ul>
</li>
<li>
<p>Restores from backup or copies from active database the latest control file that satisfies the <code dir="ltr">UNTIL</code> clause requirements.</p>
</li>
<li>
<p>Mounts the restored or copied backup control file from the active database.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If the control file in the source database contains disabled threads, then these threads will also be disabled in the duplicate database.</div>
</li>
<li>
<p>Uses the RMAN repository to select the backups for restoring the data files to the auxiliary instance. This step applies to backup-based duplication.</p>
</li>
<li>
<p>Restores and copies the duplicate data files and recovers them with incremental backups and archived redo log files to a noncurrent point in time.</p>
</li>
<li>
<p>Shuts down and restarts the database instance in <code dir="ltr">NOMOUNT</code> mode.</p>
</li>
<li>
<p>Creates a new control file, which then creates and stores the new DBID in the data files.</p>
</li>
<li>
<p>Opens the duplicate database with the <code dir="ltr">RESETLOGS</code> option and creates the online redo log for the new database.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
The <code dir="ltr">DUPLICATE</code> entry in <a class="olink RCMRF126" href="../../backup.112/e10643/rcmsynta020.htm#RCMRF126"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for a complete list of which files are copied to the duplicate database</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BGBGCJAG"></a>
<div id="BRADV89930" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Basic Steps of Database Duplication</h3>
<p>This section describes the basic steps of database duplication. Follow the link in each step for further instructions.</p>
<p class="subhead2"><a id="BRADV425"></a>To duplicate a database:</p>
<ol>
<li>
<p>Prepare for database duplication.</p>
<p>See <a href="#BGBFDJHB">"Preparing to Duplicate a Database"</a>.</p>
</li>
<li>
<p>Start RMAN and connect to the necessary database instances.</p>
<p>See <a href="#CHDCAIAB">"Starting RMAN and Connecting to Databases"</a>.</p>
</li>
<li>
<p>Place the source database in the proper state (if necessary).</p>
<p>See <a href="#CHDJHHCC">"Placing the Source Database in the Proper State"</a>.</p>
</li>
<li>
<p>Configure RMAN channels (if necessary).</p>
<p>See <a href="#CHDBFGHF">"Configuring RMAN Channels for Use in Duplication"</a>.</p>
</li>
<li>
<p>Perform the duplication.</p>
<p>See <a href="#i1006629">"Duplicating a Database"</a>.</p>
</li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BGBFDJHB"></a>
<div id="BRADV426" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Preparing to Duplicate a Database</h2>
<p>Before duplicating the database, you must decide how to perform the duplication and then prepare the database environment, including the auxiliary database instance.</p>
<p><span class="bold">To prepare for duplication:</span></p>
<ol>
<li>
<p>Choose a duplication technique.</p>
<p>See <a href="#BGBDIJJH">"Step 1: Choosing a Duplication Technique"</a>.</p>
<p>While duplicating an Oracle Real Application Clusters (Oracle RAC) database, set the <code dir="ltr">CLUSTER_DATABASE</code> initialization parameter on the auxiliary database to <code dir="ltr">FALSE</code>. This parameter can be reset to <code dir="ltr">TRUE</code> after the duplication completes.</p>
</li>
<li>
<p>Choose a strategy for naming the duplicate database files.</p>
<p>See <a href="#CHDGFABD">"Step 2: Choosing a Strategy for Naming Duplicate Files"</a>.</p>
</li>
<li>
<p>For a backup-based strategy, make the backups accessible to the auxiliary instance; otherwise, skip this step.</p>
<p>See <a href="#CHDCCDDD">"Step 3: Making Backups Accessible to the Duplicate Instance"</a>.</p>
</li>
<li>
<p>Prepare remote access to databases.</p>
<p>See <a href="#BGBICEDD">"Step 4: Preparing Remote Access to Databases"</a>.</p>
</li>
<li>
<p>Prepare the auxiliary instance.</p>
<p>See <a href="#i1006474">"Step 5: Creating an Initialization Parameter File and Starting the Auxiliary Instance"</a>.</p>
</li>
</ol>
<a id="BGBDIJJH"></a>
<div id="BRADV427" class="sect2">
<h3 class="sect2">Step 1: Choosing a Duplication Technique</h3>
<p>Your business requirements and the database environment determine which duplication technique is best for your situation. Consider the following questions:</p>
<ul>
<li>
<p>Are you familiar with the prerequisites for each duplication technique?</p>
<p>Review the "Prerequisites" section of the <code dir="ltr">DUPLICATE</code> command entry in <a class="olink RCMRF126" href="../../backup.112/e10643/rcmsynta020.htm#RCMRF126"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for a complete list. Some prerequisites are common to all duplication techniques, such as the following:</p>
<ul>
<li>
<p>The source and duplicate databases must be on the same platform. The <code dir="ltr">DUPLICATE</code> command considers 32-bit and 64-bit versions of the same operating system as belonging to the same platform.</p>
</li>
<li>
<p>The <code dir="ltr">DUPLICATE</code> command requires at least one auxiliary channel to perform the work of the duplication on the auxiliary instance.</p>
</li>
</ul>
<p>Other prerequisites are specific and depend on the duplication technique. For example, active duplication requires that the source and auxiliary instances use the same password as the source database, whereas backup-based duplication without connections to the target database and recovery catalog requires only that all backups and database copies reside in a single location.</p>
</li>
<li>
<p>Do backups of the source database already exist?</p>
<p>The principal advantage of active database duplication is that it does not require source database backups. Active duplication copies mounted or online database files over a network to the auxiliary instance. One disadvantage of this technique is the negative performance effect on the network. Another disadvantage is that the source database is running processes required to transfer the files to the auxiliary host, thereby affecting the source database and production workload.</p>
<p>If the source database backups already exist, and if the effect on the network is unacceptable, then backup-based duplication may be a better option. You can copy backups to temporary storage and transfer them manually to the destination host. If duplication is made with a connection to the target or the recovery catalog, then the backup files on the destination host must have the same file specification as they had on the source host. Otherwise, this is not a requirement.</p>
</li>
<li>
<p>Is a recovery catalog available?</p>
<p>If a recovery catalog exists, then you can perform backup-based duplication without connecting RMAN as <code dir="ltr">TARGET</code> to the source database. This technique is advantageous where network connections from the auxiliary host to the source database are restricted or prone to intermittent disruptions. In duplication without a <code dir="ltr">TARGET</code> connection, the source database is unaffected by the duplication.</p>
</li>
<li>
<p>How much disk space is available on the destination host?</p>
<p>The disk space on the destination host can be an issue when you perform duplication using disk backups. For example, if the source database is 1 terabyte (TB), and if you duplicate the database from disk backups <span class="italic">without</span> using shared disk or network file system (NFS), then you must have at least 2 terabytes (TB) of space available on the destination host. In some environments, manual transfer of backups is necessary because NFS performance is a bottleneck.</p>
</li>
<li>
<p>Are the source and destination hosts connected by a LAN or a WAN?</p>
<p>Performance of active database duplication is probably slower on a wide area network (WAN) than a local area network (LAN). If the performance degradation on a WAN is unacceptable, then backup-based duplication may be the only viable option.</p>
</li>
<li>
<p>When do you plan to duplicate the database?</p>
<p>If you must duplicate the database during a period of high user activity, then the loss of network throughput caused by active duplication may be a problem, making backup-based duplication a better choice. Also, in active database duplication the RMAN channels required for copying files to the auxiliary host can affect performance.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CHDGFABD"></a>
<div id="BRADV298" class="sect2">
<h3 class="sect2">Step 2: Choosing a Strategy for Naming Duplicate Files</h3>
<p><a id="sthref1819"></a>When duplicating a database, RMAN generates names for the duplicate control files, data files, temp files, and online redo log files. Therefore, you must decide on a naming strategy for these files.</p>
<p>Oracle recommends the simplest duplication strategy, which is to configure the duplicate database to use the same names as the source database. Using the same names means that your environment meets the following requirements:</p>
<ul>
<li>
<p>If the source database uses ASM disk groups, then the duplicate database must use ASM disk groups with the same names.</p>
</li>
<li>
<p>If the source database files are Oracle Managed Files, then the auxiliary instance must set <code dir="ltr">DB_FILE_CREATE_DEST</code> to the same <span class="italic">directory</span> location as the source database. Although the directories are the same on the source and destination hosts, Oracle Database chooses the relative names for the duplicate files.</p>
</li>
<li>
<p>If this is an Oracle RAC environment, then you must use the same <code dir="ltr">ORACLE_SID</code> for both the source and destination hosts.</p>
</li>
<li>
<p>If the names of the database files in the source database contain a path, then this path name must be the same in the duplicate database.</p>
</li>
</ul>
<p>When you configure your environment as suggested, <span class="italic">no additional configuration is required to name the duplicate files</span>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmdupad.htm#CIHIJAEH">"Specifying Alternative Names for Duplicate Database Files"</a> for an explanation of the more complex strategy of using different names for the duplicate files</div>
</div>
<!-- class="sect2" -->
<a id="CHDCCDDD"></a>
<div id="BRADV89931" class="sect2">
<h3 class="sect2">Step 3: Making Backups Accessible to the Duplicate Instance</h3>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you are performing active database duplication, then skip this section and proceed to <a href="#BGBICEDD">"Step 4: Preparing Remote Access to Databases"</a>.</div>
<p>When duplicating with a target and recovery catalog or just a target connection, RMAN uses metadata in the RMAN repository to locate backups and archived redo log files needed for duplication. If RMAN is connected to a recovery catalog, then RMAN obtains the backup metadata from the catalog. If RMAN is not connected to a catalog, as may be the case when performing backup-based duplication <span class="italic">with</span> a target connection, then RMAN obtains metadata from the control file.</p>
<p>Unless you are duplicating without a connection to the target and to the recovery catalog, the names of the backups must be available with the same names recorded in the RMAN repository. Ensure that auxiliary channels on the destination host can access all data file backups and archived redo log files (required to restore and recover the duplicate database to the desired point in time). If not, duplication fails. The archived redo log files can be available either as image copies or backup sets.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The database backup need not have been generated with <code dir="ltr">BACKUP DATABASE</code>. You can mix full and incremental backups of individual data files, but a full backup of every data file is required.</div>
<div id="BRADV99992" class="sect3"><a id="sthref1820"></a>
<h4 class="sect3">Making SBT Backups Accessible to the Auxiliary Instance</h4>
<p>The steps in this task are specific to your media manager configuration.</p>
<p><span class="bold">To make SBT backups accessible to the auxiliary instance:</span></p>
<ol>
<li>
<p>If necessary, install media management software on the destination host.</p>
</li>
<li>
<p>Make the tapes with the backups accessible to the destination host. Typically, you do one of the following:</p>
<ul>
<li>
<p>Physically move the tapes to a drive attached to the remote host.</p>
</li>
<li>
<p>Use a network-accessible tape server.</p>
</li>
</ul>
</li>
<li>
<p>If necessary, inform the remote media management software about the existence of the tapes.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<div id="BRADV99993" class="sect3"><a id="sthref1821"></a>
<h4 class="sect3">Making Disk Backups Accessible to the Auxiliary Instance</h4>
<p>When you make disk backups accessible to the auxiliary instance, your strategy depends on whether or not you duplicate the database while connected to the target or recovery catalog. If you do not connect to the target or recovery catalog, then you must designate a <code dir="ltr">BACKUP LOCATION</code> for the duplication.</p>
<p>When you use a <code dir="ltr">BACKUP LOCATION</code>, the backups and copies can reside in a shared location or can be moved to the <code dir="ltr">BACKUP LOCATION</code> on the destination host. In the latter case, you do not need to preserve the name or the original path of the backup or copy. The location specified by the <code dir="ltr">BACKUP LOCATION</code> option must contain sufficient backup sets, image copies, and archived logs to restore all of the files being duplicated, and recover them to the desired point in time.</p>
<p>It is not required that all of the backups be from the same point in time, or that they all be backup sets, or all image copies. Data file backups can be supplied as either image copies or backup sets. Archived logs can be supplied either in their normal format or as backup sets of archived logs.</p>
<p>When you use backups from different points in time, the backup location must contain archived logs covering the time from the start of the oldest backup until the desired recovery point.</p>
<p>If the backup location contains backup files from multiple databases, then the <code dir="ltr">DATABASE</code> clause must specify the name of the database that is to be duplicated. If the backup location contains backup files from multiple databases having the same name, then the <code dir="ltr">DATABASE</code> clause must specify both the name and <code dir="ltr">DBID</code> of the database that is to be duplicated.</p>
<p>The source database's Fast Recovery Area is particularly well suited for use as a backup location because it almost always contains all of the files needed for the duplication. To use a Fast Recovery Area as a backup location, you can either remotely access it from the destination system, or copy its contents to the destination system.</p>
<p>When you are not using a <code dir="ltr">BACKUP LOCATION</code>, your strategy depends on the following mutually exclusive scenarios:</p>
<ul>
<li>
<p>Identical file systems for source and destination hosts</p>
<p>This scenario is the simplest and Oracle recommends it. For example, assume that the backups of the source database are stored in <code dir="ltr">/dsk1/bkp</code>. In this case, you can make disk backups accessible to the destination host in either of these ways:</p>
<ul>
<li>
<p>Manually transfer backups from the source host to an identical path in the destination host. For example, if the backups are in <code dir="ltr">/dsk1/bkp</code> on the source host, then use FTP to transfer them to <code dir="ltr">/dsk1/bkp</code> on the destination host.</p>
</li>
<li>
<p>Use NFS or shared disks and ensure that the same path is accessible in the destination host. For example, assuming the source host can access <code dir="ltr">/dsk1/bkp</code>, use NFS to mount <code dir="ltr">/dsk1/bkp</code> on the destination host and use <code dir="ltr">/dsk1/bkp</code> as the mount point name.</p>
</li>
</ul>
</li>
<li>
<p>Different file systems for source and destination hosts</p>
<p>In this case you <span class="italic">cannot</span> use the same directory name on the destination host as you use on the source host. You have the following options:</p>
<ul>
<li>
<p>You can use shared disk to make backups available. This section explains the shared disk technique.</p>
</li>
<li>
<p>You cannot use shared disk to make backups available. <a href="rcmdupad.htm#BGBJEGCC">"Making Disk Backups Accessible Without Shared Disk"</a> explains this technique.</p>
</li>
</ul>
</li>
</ul>
<p>Assume that you have two hosts, <code dir="ltr">srchost</code> and <code dir="ltr">dsthost</code>, and access to NFS or shared disk. The database on <code dir="ltr">srchost</code> is called <code dir="ltr">srcdb</code>. The backups of <code dir="ltr">srcdb</code> reside in <code dir="ltr">/dsk1/bkp</code> on host <code dir="ltr">srchost</code>. The directory <code dir="ltr">/dsk1/bkp</code> is already in use on the destination host, but the directory <code dir="ltr">/dsk2/dup</code> is not in use in either host.</p>
<p><span class="bold">To transfer the backups from the source host to the destination host:</span></p>
<ol>
<li>
<p>Create a backup storage directory in either the source or destination host.</p>
<p>For this example, create backup directory <code dir="ltr">/dsk2/dup</code> on the destination host.</p>
</li>
<li>
<p>Mount the directory created in the previous step on the other host, ensuring that the directory and the mount point names are the same.</p>
<p>For example, if you created <code dir="ltr">/dsk2/dup</code> on the destination host, then use NFS to mount this directory as <code dir="ltr">/dsk2/dup</code> on the source host.</p>
</li>
<li>
<p>Make the backups available in the new location on the destination host. You can use either of the following techniques:</p>
<ul>
<li>
<p>Connect RMAN to the source database as <code dir="ltr">TARGET</code> and use the <code dir="ltr">BACKUP</code> command to back up the backups, as explained in <a href="rcmbckba.htm#CHDFCCCF">"Backing Up RMAN Backups"</a>. For example, use the <code dir="ltr">BACKUP COPY OF DATABASE</code> command to copy the backups in <code dir="ltr">/dsk1/bkp</code> on the source host to <code dir="ltr">/dsk2/dup</code> on the source host. In this case, RMAN automatically catalogs the backups in the new location.</p>
</li>
<li>
<p>Use an operating system utility to transfer the backups to the new location. For example, use FTP to transfer the backups from <code dir="ltr">/dsk1/bkp</code> on the source host to <code dir="ltr">/dsk2/dup</code> on the destination host, or use the <code dir="ltr">cp</code> command to copy the backups from <code dir="ltr">/dsk1/bkp</code> on the source host to <code dir="ltr">/dsk2/dup</code> on the source host. Afterward, connect RMAN to the source database as <code dir="ltr">TARGET</code> and use the <code dir="ltr">CATALOG</code> command to update the RMAN repository with the location of the manually transferred backups.</p>
</li>
</ul>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BGBICEDD"></a>
<div id="BRADV533" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Step 4: Preparing Remote Access to Databases</h3>
<p>When a database must be accessed from another host, you must set up a password file and Oracle Net connectivity. Be aware of the potential security consequences of this type of setup.</p>
<div id="BRADV534" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1822"></a>
<h4 class="sect3">Establishing Connectivity in Required Cases</h4>
<p class="subhead2"><a id="BRADV535"></a>To create a password file manually:</p>
<p>Follow the instructions in <a class="olink ADMIN10241" href="../../server.112/e25494/dba.htm#ADMIN10241"><span class="italic">Oracle Database Administrator's Guide</span></a> to create a password file.</p>
<p>The types of file names allowed for password files and the location of the password file are both platform specific and operating system-specific.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SBYDB01500" href="../../server.112/e41134/rcmbackp.htm#SBYDB01500"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to create a password file manually</p>
</li>
<li>
<p><a class="olink ASOAG" href="../../network.112/e40393/toc.htm"><span class="italic">Oracle Database Advanced Security Administrator's Guide</span></a></p>
</li>
</ul>
</div>
<p class="subhead2"><a id="BRADV536"></a>To establish Oracle Net connectivity and set up a static listener:</p>
<p>Follow the instructions in <a class="olink NETAG006" href="../../network.112/e41945/gettingstart.htm#NETAG006"><span class="italic">Oracle Database Net Services Administrator's Guide</span></a> to configure a client for connection to a database and add static service information for the listener.</p>
</div>
<!-- class="sect3" -->
<div id="BRADV537" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1823"></a>
<h4 class="sect3">Creating a Password File for the Auxiliary Instance</h4>
<p>You have the following options for creating a <a href="glossary.htm#CHDECHBA"><span class="xrefglossterm">password file</span></a> for the auxiliary instance on the destination host:</p>
<ul>
<li>
<p>Create the password file manually.</p>
<p>There are additional requirements for the case of <code dir="ltr">DUPLICATE ... FROM ACTIVE DATABASE</code>. You must use the <code dir="ltr">SYS</code> user ID, and the password must match the password of the source database. You may want to create the password file with a single password so that you can start the auxiliary instance and enable the source database to connect to it.</p>
</li>
<li>
<p>Specify the <code dir="ltr">PASSWORD FILE</code> option on the <code dir="ltr">DUPLICATE... FROM ACTIVE</code> DATABASE command.</p>
<p>In this case, RMAN copies the source database password file to the destination host and overwrites any existing password file for the auxiliary instance. This technique is useful if the source database password file has multiple passwords that you want to make available on the duplicate database.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMIN" href="../../server.112/e25494/toc.htm"><span class="italic">Oracle Database Administrator's Guide</span></a></div>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you create a standby database with the <code dir="ltr">FROM ACTIVE DATABASE</code> option, then RMAN always copies the password file to the standby host.</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1006474"></a>
<div id="BRADV167" class="sect2">
<h3 class="sect2">Step 5: Creating an Initialization Parameter File and Starting the Auxiliary Instance</h3>
<p>The location and content of the initialization parameter file depend on your choice in <a href="#CHDGFABD">"Step 2: Choosing a Strategy for Naming Duplicate Files"</a>. This section makes the following assumptions:</p>
<ul>
<li>
<p>You choose the recommended technique of using the same naming strategy for the source and destination hosts. Thus for Oracle RAC environments, you use the same <code dir="ltr">ORACLE_SID</code> for source and destination hosts.</p>
</li>
<li>
<p>You create a text-based initialization parameter file for the auxiliary instance. See <a href="rcmdupad.htm#CHDCAAIA">Table 25-5, "Auxiliary Instance Initialization Parameters"</a>.</p>
</li>
<li>
<p>The initialization parameter file is located in the operating system-specific default location of the host on which SQL*Plus runs.</p>
<p>For example, on Linux and UNIX the default initialization parameter file name is <code dir="ltr"><span class="codeinlineitalic">ORACLE_HOME</span></code><code dir="ltr">/dbs/init</code><code dir="ltr"><span class="codeinlineitalic">ORACLE_SID</span></code><code dir="ltr">.ora</code> and on Windows the file name is <code dir="ltr"><span class="codeinlineitalic">ORACLE_HOME</span></code><code dir="ltr">\database\init</code><code dir="ltr"><span class="codeinlineitalic">ORACLE_SID</span></code><code dir="ltr">.ora</code>.</p>
</li>
<li>
<p>You plan to specify the <code dir="ltr">SPFILE</code> clause on the <code dir="ltr">DUPLICATE</code> command.</p>
<p>The <code dir="ltr">DUPLICATE ... SPFILE</code> technique is easiest because during duplication RMAN automatically copies the server parameter file from the source database to the auxiliary instance or restores it from backup. If a server parameter file exists on the auxiliary instance, then RMAN overwrites it.</p>
</li>
</ul>
<p>If you cannot meet the preceding requirements, then see <a href="rcmdupad.htm#CIHEGGGC">"Duplicating a Database When No Server Parameter File Exists"</a>.</p>
<p><span class="bold">To create an initialization parameter file and start the auxiliary instance:</span></p>
<ol>
<li>
<p>Using a text editor, create an empty file for use as a text-based initialization parameter file.</p>
</li>
<li>
<p>Copy the initialization parameter file to the operating system-specific default location on the host where SQL*Plus runs.</p>
</li>
<li>
<p>In the parameter file, set <code dir="ltr">DB_NAME</code> to an arbitrary value.</p>
<p><code dir="ltr">DB_NAME</code> is the only required initialization parameter. The following example shows a sample <code dir="ltr">DB_NAME</code> setting:</p>
<pre dir="ltr">
DB_NAME=somevalue
</pre></li>
<li>
<p>If necessary, set other initialization parameters like those needed for Oracle RAC, and for connecting by using a user ID that has <code dir="ltr">SYSDBA</code> privileges through Oracle Net.</p>
</li>
<li>
<p>Start SQL*Plus and connect to the auxiliary instance with SYSDBA privileges. Start the auxiliary instance in <code dir="ltr">NOMOUNT</code> mode (no <code dir="ltr">PFILE</code> parameter on the <code dir="ltr">STARTUP</code> command is necessary if the file is in the default location):</p>
<pre dir="ltr">
SQL&gt; STARTUP NOMOUNT
</pre></li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
Ensure that the auxiliary instance is started with a text-based initialization parameter file and <span class="italic">not</span> a server parameter file. Do not create a control file or try to mount or open the auxiliary instance.</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDJHHCC"></a>
<div id="BRADV430" class="sect1">
<h2 class="sect1">Placing the Source Database in the Proper State</h2>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you are performing backup-based duplication without a target connection, then skip to <a href="#CHDBFGHF">"Configuring RMAN Channels for Use in Duplication"</a>.</div>
<p>If RMAN is connected to the source database as <code dir="ltr">TARGET</code>, then the source database must be in the proper state for the duplication.</p>
<p><span class="bold">To ensure that the source database is in the proper state:</span></p>
<ol>
<li>
<p>If the source database instance is not mounted or open, then mount or open it.</p>
</li>
<li>
<p>If you are performing active database duplication, then ensure that the following additional requirements are met:</p>
<ul>
<li>
<p>If the source database is open, then archiving must be enabled.</p>
</li>
<li>
<p>If the source database is not open, then the database does not require instance recovery.</p>
</li>
</ul>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CHDCAIAB"></a>
<div id="BRADV299" class="sect1">
<h2 class="sect1">Starting RMAN and Connecting to Databases</h2>
<p>In this task, you must start the RMAN client and connect to the database instances required by the duplication technique chosen in <a href="#BGBDIJJH">"Step 1: Choosing a Duplication Technique"</a>. The RMAN client can be located on any host so long as it can connect to the necessary databases over the network.</p>
<p><span class="bold">To start RMAN and connect to the target and auxiliary instances:</span></p>
<ol>
<li>
<p>Start the RMAN client on any host that can connect to the necessary database instances.</p>
</li>
<li>
<p>At the RMAN prompt, run <code dir="ltr">CONNECT</code> commands for the database instances required for your duplication technique:</p>
<ul>
<li>
<p>For active database duplication, you must connect to the source database as <code dir="ltr">TARGET</code> and to the auxiliary instance as <code dir="ltr">AUXILIARY</code>. You must use the same <code dir="ltr">SYSDBA</code> password for both instances and must supply the net service name to connect to the <code dir="ltr">AUXILIARY</code> instance. A recovery catalog connection is optional.</p>
</li>
<li>
<p>For backup-based duplication <span class="italic">without</span> a target connection, you must connect to the auxiliary instance as <code dir="ltr">AUXILIARY</code> and the recovery catalog as <code dir="ltr">CATALOG</code>.</p>
</li>
<li>
<p>For backup-based duplication <span class="italic">with</span> a target connection, you must connect to the source database as <code dir="ltr">TARGET</code> and auxiliary instance as <code dir="ltr">AUXILIARY</code>. A recovery catalog is optional.</p>
</li>
<li>
<p>For backup-based duplication without target and recovery catalog connections, you must connect to the auxiliary instance as <code dir="ltr">AUXILIARY</code>.</p>
</li>
</ul>
<p>In the following example of active database duplication, a connection is established to three database instances, all using net service names:</p>
<pre dir="ltr">
RMAN&gt; CONNECT TARGET SYS/sysdba@prod;    # source database
connected to target database: PROD (DBID=39525561)

RMAN&gt; CONNECT AUXILIARY SYS/sysdba@dupdb; # duplicate database instance
connected to auxiliary database: DUPDB (not mounted)

RMAN&gt; CONNECT CATALOG rman/rman@catdb;    # recovery catalog database
connected to recovery catalog database
</pre></li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CHDBFGHF"></a>
<div id="BRADV89938" class="sect1">
<h2 class="sect1">Configuring RMAN Channels for Use in Duplication</h2>
<p>The channel on the auxiliary instance, not the source database instance, restores RMAN backups in backup-based duplication. The channel configuration depends on your duplication technique.</p>
<div id="BRADV431" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1824"></a>
<h3 class="sect2">Configuring Channels for Active Database Duplication</h3>
<p>In active database duplication, you do not have to change your source database channel configuration or configure <code dir="ltr">AUXILIARY</code> channels. However, you may want to increase the parallelism setting of your source database disk channels so that RMAN copies files over the network in parallel.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for information about the <code dir="ltr">CONFIGURE</code> command</div>
</div>
<!-- class="sect2" -->
<div id="BRADV432" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1825"></a>
<h3 class="sect2">Configuring Channels for Backup-Based Duplication</h3>
<p>RMAN can use the same channel configurations on the <span class="italic">source</span> database for duplication on the destination host. RMAN can use these configurations even if the source database channels do not specify the <code dir="ltr">AUXILIARY</code> option.</p>
<p>Note the following additional considerations:</p>
<ul>
<li>
<p>The channel type (<code dir="ltr">DISK</code> or <code dir="ltr">sbt</code>) of the auxiliary channel must match the backup media. In general, the more channels you allocate for disk backups, the faster the duplication. You cannot increase the speed of duplication after the disks reach their maximum read/write rate. For tape backups, limit the number of channels to the number of devices available.</p>
</li>
<li>
<p>If the auxiliary channels need special parameters (for example, to point to a different media manager), then you can configure an automatic channel with the <code dir="ltr">AUXILIARY</code> option of the <code dir="ltr">CONFIGURE</code> command.</p>
</li>
<li>
<p>When you perform duplication without a target connection and without a recovery catalog, only disk channels can be used. If no user-allocated channels are used, then only one channel initially restores the control file. After the control file is mounted, the number of allocated channels depends on the configuration in the restored control file.</p>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006629"></a>
<div id="BRADV168" class="sect1">
<h2 class="sect1">Duplicating a Database</h2>
<p>This section describes the most basic procedure to duplicate a database. This section makes the following assumptions:</p>
<ul>
<li>
<p>You are duplicating the database to a remote host. The duplicate database files use the same names as the source database files.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
When running the <code dir="ltr">DUPLICATE</code> command in this configuration, you must specify the <code dir="ltr">NOFILENAMECHECK</code> option on the <code dir="ltr">DUPLICATE</code> command. If you duplicate a database on the same host as the source database, then verify that <code dir="ltr">NOFILENAMECHECK</code> is <span class="italic">not</span> specified.</div>
</li>
<li>
<p>You are duplicating the entire database. For other scenarios, see <a href="rcmdupad.htm#CHDEJHBD">"Duplicating a Subset of the Source Database Tablespaces"</a>.</p>
</li>
</ul>
<p class="subhead2"><a id="BRADV433"></a>To duplicate a database to a remote host with the same directory structure:</p>
<ol>
<li>
<p>Ensure that you have completed Steps 1 through 4 in <a href="#BGBGCJAG">"Basic Steps of Database Duplication"</a>.</p>
</li>
<li>
<p>Run the <code dir="ltr">DUPLICATE</code> command.</p>
</li>
</ol>
<p><a href="#BGBEEAEH">Example 24-1</a> illustrates how to perform active duplication when the <code dir="ltr">SPFILE</code> clause is specified. <code dir="ltr">DUPLICATE</code> requires the <code dir="ltr">NOFILENAMECHECK</code> option because the source database files have the same names as the duplicate database files.</p>
<p>The <code dir="ltr">PASSWORD FILE</code> option specifies that RMAN should copy the password file to the destination host. RMAN automatically copies the server parameter file to the destination host, starts the auxiliary instance with the server parameter file, copies all necessary database files and archived redo logs over the network to the destination host, and recovers the database. Finally, RMAN opens the database with the <code dir="ltr">RESETLOGS</code> option to create the online redo log.</p>
<div id="BRADV434" class="example">
<p class="titleinexample"><a id="BGBEEAEH"></a>Example 24-1 Duplicating to a Host with the Same Directory Structure (Active)</p>
<pre dir="ltr">
DUPLICATE TARGET DATABASE TO dupdb
  FROM ACTIVE DATABASE
  PASSWORD FILE
  SPFILE
  NOFILENAMECHECK;
</pre></div>
<!-- class="example" -->
<a id="BGBFCFGA"></a>
<div id="BRADV435" class="sect2">
<h3 class="sect2">Backup-Based Duplication Without a Target Connection: Example</h3>
<p>In this variation of <a href="#BGBEEAEH">Example 24-1</a>, RMAN does not use a <code dir="ltr">TARGET</code> connection to the source database. <a href="#BGBHJDEJ">Example 24-2</a> creates a duplicate of the source database <code dir="ltr">prod</code> as it appeared in 2007 in a previous database incarnation. RMAN is not connected to the source database but must be connected to a recovery catalog because no <code dir="ltr">BACKUP LOCATION</code> is provided.</p>
<div id="BRADV436" class="example">
<p class="titleinexample"><a id="BGBHJDEJ"></a>Example 24-2 Duplicating a Database to a Past Point in Time (Backup-Based)</p>
<pre dir="ltr">
DUPLICATE DATABASE prod DBID 8675309 TO dupdb
  UNTIL TIME "TO_DATE('11/01/2007', 'MM/DD/YYYY')"
  SPFILE
  NOFILENAMECHECK;
</pre></div>
<!-- class="example" -->
<p>Note the following characteristics of <a href="#BGBHJDEJ">Example 24-2</a>:</p>
<ul>
<li>
<p>The <code dir="ltr">FROM ACTIVE DATABASE</code> clause is not specified. By not specifying this clause, you instruct RMAN to perform backup-based duplication.</p>
</li>
<li>
<p>The <code dir="ltr">DBID</code> is specified because the source database name <code dir="ltr">prod</code> is not unique in the recovery catalog.</p>
</li>
<li>
<p><code dir="ltr">NOFILENAMECHECK</code> check is specified because it is necessary when the duplicate database files use the same names as the source database files.</p>
</li>
</ul>
<p>Assume a variation in which you want to restore an <a href="glossary.htm#CHDEAHIB"><span class="xrefglossterm">archival backup</span></a>, which is all-inclusive in the sense that every file needed to restore and recover the database is included. The recommended technique for restoring an archival backup for testing is to create a temporary instance and use the <code dir="ltr">DUPLICATE</code> command. In this way, you avoid interfering with the source database.</p>
<p>In the <code dir="ltr">DUPLICATE</code> command you must specify the restore point that was created with the archival backup. You can only specify <code dir="ltr">TO RESTORE POINT</code> if RMAN is connected to a catalog, or to the source database when the restore point exists in the control file. <a href="#BGBEDEEB">Example 24-3</a> specifies restore point <code dir="ltr">TESTDB103107</code>.</p>
<div id="BRADV437" class="example">
<p class="titleinexample"><a id="BGBEDEEB"></a>Example 24-3 Using an Archival Backup for Backup-Based Duplication</p>
<pre dir="ltr">
DUPLICATE DATABASE prod DBID 8675309 TO dupdb
  TO RESTORE POINT TESTDB103107
  SPFILE
  NOFILENAMECHECK;
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<div id="BRADV438" class="sect2"><a id="sthref1826"></a>
<h3 class="sect2">Backup-Based Duplication with a Target Connection: Example</h3>
<p>Assume a backup-based variation of <a href="#BGBEEAEH">Example 24-1</a> in which RMAN is connected as <code dir="ltr">TARGET</code> to the source database. <a href="#BGBGDBDJ">Example 24-4</a> recovers the duplicate database to 1 week ago to view the data in the source database as it appeared then.</p>
<div id="BRADV439" class="example">
<p class="titleinexample"><a id="BGBGDBDJ"></a>Example 24-4 Duplicating a Database to a Past Point in Time (Backup-Based)</p>
<pre dir="ltr">
DUPLICATE TARGET DATABASE TO dupdb
  SPFILE
  NOFILENAMECHECK
  UNTIL TIME 'SYSDATE-7';
</pre></div>
<!-- class="example" -->
<p>Note the following characteristics of <a href="#BGBGDBDJ">Example 24-4</a>:</p>
<ul>
<li>
<p>The <code dir="ltr">FROM ACTIVE DATABASE</code> clause is <span class="italic">not</span> specified. By not specifying this clause, you instruct RMAN to perform backup-based duplication.</p>
</li>
<li>
<p>The <code dir="ltr">NOFILENAMECHECK</code> option is specified because it is necessary when the duplicate database files use the same names as the source database files.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<div id="BRADV538" class="sect2"><a id="sthref1827"></a>
<h3 class="sect2">Backup-Based Duplication Without a Target and a Recovery Catalog Connection: Example</h3>
<p>In the variation of <a href="#BGBEEAEH">Example 24-1</a>, shown in <a href="#BGBIHBCJ">Example 24-5</a>, RMAN does not use a <code dir="ltr">TARGET</code> connection to the source database or a <code dir="ltr">CATALOG</code> connection to a recovery catalog. All backup and copies necessary for duplication until November 11 of 2007 at 2:00 PM, including a control file backup or copy, have been placed under <code dir="ltr">/prod_backups</code>.</p>
<div id="BRADV539" class="example">
<p class="titleinexample"><a id="BGBIHBCJ"></a>Example 24-5 Duplicating a Database Without a Target and Recovery Catalog Connection (Backup-Based)</p>
<pre dir="ltr">
DUPLICATE DATABASE TO dupdb
  UNTIL TIME "TO_DATE('11/01/2007 14:00:00', 'MM/DD/YYYY HH24:MI:SS')"
  SPFILE
  BACKUP LOCATION '/prod_backups'
  NOFILENAMECHECK;
</pre></div>
<!-- class="example" -->
<p>Note the following characteristics of <a href="#BGBIHBCJ">Example 24-5</a>:</p>
<ul>
<li>
<p>The database name is not specified. By not specifying a database name with the <code dir="ltr">DATABASE</code> keyword, <code dir="ltr">DUPLICATE</code> obtains the database name and <code dir="ltr">DBID</code> from the backups. An error is displayed if backups for more than one database were found in the <code dir="ltr">BACKUP LOCATION</code>.</p>
</li>
<li>
<p>Use of the <code dir="ltr">BACKUP LOCATION</code> clause identifies the type of duplication as backup-based with neither a target connection nor recovery catalog.</p>
</li>
<li>
<p>The <code dir="ltr">UNTIL TIME</code> option is specified. It is the only <code dir="ltr">UNTIL</code> subclause permitted with the <code dir="ltr">BACKUP LOCATION</code> clause.</p>
</li>
<li>
<p>The <code dir="ltr">NOFILENAMECHECK</code> option check is specified because it is necessary when the duplicate database files use the same names as the source database files.</p>
</li>
</ul>
<div id="BRADV540" class="example">
<p class="titleinexample"><a id="BGBDFEII"></a>Example 24-6 Duplicating a Database to a Past Point in Time (Backup-Based)</p>
<pre dir="ltr">
DUPLICATE TARGET DATABASE TO dupdb
  SPFILE
  NOFILENAMECHECK
  UNTIL TIME 'SYSDATE-7';
</pre></div>
<!-- class="example" -->
<p>Note the following characteristics of <a href="#BGBDFEII">Example 24-6</a>:</p>
<ul>
<li>
<p>The <code dir="ltr">FROM ACTIVE DATABASE</code> clause is <span class="italic">not</span> specified. Omitting this clause instructs RMAN to perform backup-based duplication.</p>
</li>
<li>
<p>The <code dir="ltr">NOFILENAMECHECK</code> option check is specified because it is necessary when the duplicate database files use the same names as the source database files.</p>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BGBEFJHH"></a>
<div id="BRADV440" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Restarting <a id="sthref1828"></a><a id="sthref1829"></a><a id="sthref1830"></a><a id="sthref1831"></a>DUPLICATE After a Failure</h2>
<p>RMAN automatically optimizes a <code dir="ltr">DUPLICATE</code> command that is a repeat of a previously failed <code dir="ltr">DUPLICATE</code> command. The repeat <code dir="ltr">DUPLICATE</code> command notices which data files were successfully copied earlier and does not copy them again. This applies to all forms of duplication, whether they are backup-based (with or without a target connection) or active database duplication. The automatic optimization of the <code dir="ltr">DUPLICATE</code> command can be especially useful when a failure occurs during the duplication of very large databases.</p>
<p class="subhead2"><a id="sthref1832"></a>To restart a DUPLICATE operation:</p>
<ol>
<li>
<p>Exit RMAN.</p>
</li>
<li>
<p>Start SQL*Plus and connect to the auxiliary instance with <code dir="ltr">SYSDBA</code> or <code dir="ltr">SYSBACKUP</code> privilege. Start the auxiliary instance in <code dir="ltr">NOMOUNT</code> mode with the same <code dir="ltr">SPFILE</code> or <code dir="ltr">PFILE</code> specification that you used initially. If you omitted this specification initially, then omit it again here.</p>
<p>This example starts the auxiliary instance using the parameters in <code dir="ltr">/home/my_pfile.ora</code>:</p>
<pre dir="ltr">
STARTUP FORCE PFILE=/home/my_pfile.ora
</pre></li>
<li>
<p>Exit SQL*Plus and start RMAN.</p>
</li>
<li>
<p>Connect to the same databases as initially.</p>
</li>
<li>
<p>Repeat the <code dir="ltr">DUPLICATE</code> command.</p>
</li>
</ol>
<p>The second <code dir="ltr">DUPLICATE</code> operation:</p>
<ul>
<li>
<p>Locates the data files that were successfully duplicated by the initial <code dir="ltr">DUPLICATE</code> command.</p>
</li>
<li>
<p>Displays a message similar to the following for each data file that it does not need to duplicate again:</p>
<pre dir="ltr">
RMAN-05560: Using previous duplicated file /oradata/new/data01.f for datafile 1 with checkpoint SCN of 1654665
</pre></li>
<li>
<p>Restores only the missing or incomplete data files, thereby avoiding recopying and restoring all the data files.</p>
</li>
</ul>
<p>If you do not want RMAN to automatically recover from a failed <code dir="ltr">DUPLICATE</code> operation, specify the keyword <code dir="ltr">NORESUME</code> to disable the functionality. Using the keyword <code dir="ltr">NORESUME</code> in the first invocation of <code dir="ltr">DUPLICATE</code> prevents a subsequent <code dir="ltr">DUPLICATE</code> command for the new database from using this automatic optimization.</p>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1933">
<tr>
<td class="cellalignment1942">
<table class="cellalignment1938">
<tr>
<td class="cellalignment1937"><a href="part_tra.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1937"><a href="rcmdupad.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1944">
<table class="cellalignment1936">
<tr>
<td class="cellalignment1937"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1937"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1937"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1937"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1937"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1937"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
