<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Maintaining RMAN Backups and Repository&nbsp;Records</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1054" />
<meta name="description" content="A guide to backup and recovery of Oracle databases, including RMAN backup and recovery, RMAN data transfer, Oracle Flashback Technology, and user-managed backup and recovery" />
<meta name="dcterms.created" content="2015-05-13T14:1:11Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Backup and Recovery User's Guide" />
<meta name="dcterms.identifier" content="E10642-08" />
<meta name="dcterms.isVersionOf" content="BRADV" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="rcmreprt.htm" title="Previous" type="text/html" />
<link rel="Next" href="rcmcatdb.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10642.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">23/47</span> <!-- End Header -->
<div id="BRADV8007" class="chapter"><a id="h1016888"></a> <a id="j1006083"></a>
<h1 class="chapter"><span class="secnum">12</span> Maintaining RMAN Backups and Repository&nbsp;Records</h1>
<p><a id="sthref1068"></a><a id="sthref1069"></a><a id="sthref1070"></a><a id="sthref1071"></a>This chapter describes how to manage the RMAN repository records and RMAN backups and copies. This chapter also explains maintenance tasks related to the fast recovery area. This chapter contains the following topics:</p>
<ul>
<li>
<p><a href="#CHDIFBDA">Overview of RMAN Backup and Repository Maintenance</a></p>
</li>
<li>
<p><a href="#i1007281">Maintaining the Control File Repository</a></p>
</li>
<li>
<p><a href="#i1009331">Maintaining the Fast Recovery Area</a></p>
</li>
<li>
<p><a href="#CHDJJBHA">Updating the RMAN Repository</a></p>
</li>
<li>
<p><a href="#i1006215">Deleting RMAN Backups and Archived Redo Logs</a></p>
</li>
<li>
<p><a href="#i1009167">Dropping a Database</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1"><span class="bold">See Also</span>:</p>
<a href="rcmcatdb.htm#CIHBGHEA">Chapter 13, "Managing a Recovery Catalog"</a> for RMAN maintenance issues that are specific to a <a href="glossary.htm#i433280"><span class="xrefglossterm">recovery catalog</span></a></div>
<a id="CHDIFBDA"></a>
<div id="BRADV89607" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Overview of RMAN Backup and Repository Maintenance</h2>
<p>This section explains the purpose and basic concepts of RMAN repository maintenance.</p>
<div id="BRADV89608" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1072"></a>
<h3 class="sect2">Purpose of Backup and Repository Maintenance</h3>
<p><a id="sthref1073"></a>The recommended maintenance strategy is to configure a <a href="glossary.htm#i999320"><span class="xrefglossterm">fast recovery area</span></a>, a <a href="glossary.htm#i432137"><span class="xrefglossterm">backup retention policy</span></a>, and an <a href="glossary.htm#CHDGCGHA"><span class="xrefglossterm">archived redo log deletion policy</span></a>. In this case, the database automatically maintains and deletes backups and archived redo logs as needed. However, manual maintenance of database backups and archived redo logs is sometimes necessary.</p>
<p>Managing RMAN backups involves the following related tasks:</p>
<ul>
<li>
<p>Managing the database backups that are stored on disk or tape</p>
</li>
<li>
<p>Managing the records of those backups in the RMAN repository</p>
</li>
</ul>
<p>An important part of RMAN maintenance is deleting backups that are no longer needed. If you configure a fast recovery area, then the database automatically deletes unneeded files in this area automatically; even so, you may want to delete backups and copies from tape. You may even need to delete an entire database. You can use an RMAN command to perform these tasks.</p>
<p>The fast recovery area may require occasional maintenance. For example, the fast recovery area may become full, in which case you can add space to it. Alternatively, you may want to change the location of the recovery area.</p>
<p>It is possible for the <a href="glossary.htm#CHDIJAIC"><span class="xrefglossterm">RMAN repository</span></a> to fail to reflect the true state of files on disk or tape. For example, a user may delete a backup from disk with an operating system utility. In this case, the RMAN repository shows that the file exists when it does not. In a similar situation, a tape containing RMAN backups may be corrupted. You can use <a href="glossary.htm#CHDJGAGC"><span class="xrefglossterm">RMAN maintenance commands</span></a> to update the repository with accurate information.</p>
</div>
<!-- class="sect2" -->
<a id="CHDFFJFJ"></a>
<div id="BRADV990" class="sect2">
<h3 class="sect2">Basic Concepts of Backup and Repository Maintenance</h3>
<p><a id="sthref1074"></a>The RMAN maintenance commands are summarized as follows:</p>
<ul>
<li>
<p>The <a class="olink RCMRF109" href="../../backup.112/e10643/rcmsynta008.htm#RCMRF109"><code dir="ltr">CATALOG</code></a> command enables you to add records about RMAN and user-managed backups that are currently not recorded in the RMAN repository, or to remove records for backups that are recorded.</p>
</li>
<li>
<p>The <a class="olink RCMRF110" href="../../backup.112/e10643/rcmsynta009.htm#RCMRF110"><code dir="ltr">CHANGE</code></a> command enables you to update the status of records in the RMAN repository.</p>
</li>
<li>
<p>The <a class="olink RCMRF119" href="../../backup.112/e10643/rcmsynta015.htm#RCMRF119"><code dir="ltr">CROSSCHECK</code></a> command enables you to synchronize the logical backup records with the physical reality of files in backup storage.</p>
</li>
<li>
<p>The <a class="olink RCMRF121" href="../../backup.112/e10643/rcmsynta016.htm#RCMRF121"><code dir="ltr">DELETE</code></a> command enables you to delete backups from the operating system.</p>
</li>
</ul>
<div id="BRADV90061" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1075"></a>
<h4 class="sect3">Maintenance Commands and RMAN Repository Metadata</h4>
<p>RMAN always stores its metadata in the control file of each target database on which it performs operations. If you register a target database in the recovery catalog, then RMAN stores the metadata for this target database in the recovery catalog. All of the RMAN maintenance commands work with or without a recovery catalog.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmcatdb.htm#CHDDGDHF">"Maintaining a Recovery Catalog"</a></div>
</div>
<!-- class="sect3" -->
<a id="CHDJEHFD"></a>
<div id="BRADV90062" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Maintenance Commands in a Data Guard Environment</h4>
<p><a id="sthref1076"></a>The database in a Data Guard environment that creates a backup or copy is associated with the file. For example, if RMAN is connected to target database <code dir="ltr">standby1</code> and backs it up, then this backup is associated with <code dir="ltr">standby1</code>.</p>
<p>If backups are accessible to RMAN according to the criteria specified in <a href="rcmarchi.htm#CHDHJFAB">"RMAN File Management in a Data Guard Environment"</a>, you can use RMAN maintenance commands such as <code dir="ltr">CHANGE</code>, <code dir="ltr">DELETE</code>, and <code dir="ltr">CROSSCHECK</code> for backups when connected to any primary or standby database.</p>
<div id="BRADV99968" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref1077"></a>
<h5 class="sect4">Crosschecks in a Data Guard Environment</h5>
<p>For a crosscheck, <a id="sthref1078"></a>RMAN can only update the status of a file from <code dir="ltr">AVAILABLE</code> to <code dir="ltr">EXPIRED</code> when connected to the database associated with the file. Thus, if RMAN crosschecks a file and does not find it, and if the file is associated with a database to which it is not connected as <code dir="ltr">TARGET</code>, then RMAN prompts you to perform the crosscheck when connected to the target database associated with the file. RMAN performs a crosscheck when you run the <code dir="ltr">CROSSCHECK</code> or <code dir="ltr">CHANGE ... AVAILABLE</code> command.</p>
</div>
<!-- class="sect4" -->
<div id="BRADV99969" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref1079"></a>
<h5 class="sect4">Deletion in a Data Guard Environment</h5>
<p>RMAN can delete files when connected to any database. If RMAN is not connected as <code dir="ltr">TARGET</code> to the database associated with a file, and if RMAN cannot delete a file successfully, then RMAN prompts you to connect as <code dir="ltr">TARGET</code> to the database associated with the file. You must then use <code dir="ltr">DELETE ... FORCE</code> to delete the file metadata.</p>
</div>
<!-- class="sect4" -->
<div id="BRADV99970" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref1080"></a>
<h5 class="sect4">Updates to RMAN Metadata in a Data Guard Environment</h5>
<p>If a maintenance command changes RMAN metadata only, then you can connect RMAN as <code dir="ltr">TARGET</code> to any database in the Data Guard environment. Commands that change only metadata include:</p>
<ul>
<li>
<p><code dir="ltr">CHANGE ... UNAVAILABLE</code> or <code dir="ltr">CHANGE ... UNCATALOG</code></p>
</li>
<li>
<p><code dir="ltr">CHANGE ... KEEP</code> or <code dir="ltr">CHANGE ... NOKEEP</code></p>
</li>
<li>
<p><code dir="ltr">CHANGE ... RESET DB_UNIQUE_NAME</code></p>
</li>
</ul>
<p>By default, the <code dir="ltr">CHANGE</code> command only operates on files that are accessible according to the rules specified in <a href="rcmarchi.htm#CHDHGHBC">"Accessibility of Backups in a Data Guard Environment"</a>. However, you can change the status of files associated with a database other than the target database by using the <code dir="ltr">FOR DB_UNIQUE_NAME</code> option.</p>
</div>
<!-- class="sect4" -->
<div id="BRADV99971" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref1081"></a>
<h5 class="sect4">Files Not Associated with a Database</h5>
<p>In some cases the <code dir="ltr">DB_UNIQUE_NAME</code> may not be known for a specific file. For example, the value of <code dir="ltr">DB_UNIQUE_NAME</code> is <code dir="ltr">null</code> when the database name is not known to the recovery catalog, as for Oracle9<span class="italic">i</span> databases that are registered in a recovery catalog. Also, rows can have a <code dir="ltr">DB_UNIQUE_NAME</code> of <code dir="ltr">null</code> because a database has been upgraded to the current version, but the recovery catalog schema has not reconciled the <code dir="ltr">DB_UNIQUE_NAME</code> values for all files. By default, RMAN associates files whose <code dir="ltr">SITE_KEY</code> is <code dir="ltr">null</code> with the database to which RMAN is connected as <code dir="ltr">TARGET</code>. A backup remains associated with a database unless you explicitly use the <code dir="ltr">CHANGE ... RESET DB_UNIQUE_NAME</code> to associate the backup with a different database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SBYDB04700" href="../../server.112/e41134/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to use RMAN to back up and restore files in a Data Guard environment</p>
</li>
<li>
<p><a class="olink RCMRF" href="../e10643/toc.htm"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for descriptions of the RMAN maintenance commands</p>
</li>
</ul>
</div>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1007281"></a>
<div id="BRADV8602" class="sect1">
<h2 class="sect1">Maintaining the Control File Repository</h2>
<p>RMAN is designed to work without a recovery catalog. If you choose not to use a recovery catalog, however, then the control file of each target database is the exclusive repository for RMAN metadata. You should know how information is stored in the control file and ensure that your backup and recovery strategy protects the control file.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMIN006" href="../../server.112/e25494/control.htm#ADMIN006"><span class="italic">Oracle Database Administrator's Guide</span></a> for an overview of the control file and more details about managing control files</div>
<a id="i1006651"></a>
<div id="BRADV89609" class="sect2">
<h3 class="sect2">About Control File Records</h3>
<p><a id="sthref1082"></a><a id="sthref1083"></a>The control file contains two types of records: <a href="glossary.htm#i432290"><span class="xrefglossterm">circular reuse records</span></a> and <a href="glossary.htm#i433030"><span class="xrefglossterm">noncircular reuse records</span></a>.</p>
<p>Circular reuse records contain noncritical information that is eligible to be overwritten if needed. These records contain information that is continually generated by the database. When all available record slots are full, the database either expands the control file to make room for a new record or overwrites the oldest record. The <code dir="ltr">CONTROL_FILE_RECORD_KEEP_TIME</code> initialization parameter specifies the minimum age in days of a record before it can be reused.</p>
<p>Noncircular reuse records contain critical information that does not change often and cannot be overwritten. Some examples of information in noncircular reuse records include datafiles, online redo log files, and redo threads.</p>
<p>As you make backups of a target database, the database records these backups in the control file. To prevent the control file from growing too large because of the addition of new records, records can be reused if they are older than a threshold that you specify. <a id="sthref1084"></a>The <code dir="ltr">CONTROL_FILE_RECORD_KEEP_TIME</code> initialization parameter determines the minimum age in days of a record before it can be overwritten:</p>
<pre dir="ltr">
CONTROL_FILE_RECORD_KEEP_TIME = <span class="italic">integer</span>
</pre>
<p>For example, if the parameter value is <code dir="ltr">14</code>, then any record of age 14 days or older is a candidate for reuse. Information in an overwritten record is lost. The oldest record available for reuse is used first.</p>
<p>When the database must add new RMAN repository records to the control file, but no record is older than the threshold, the database attempts to expand the size of the control file. If the underlying operating system prevents the expansion of the control file (due to a disk full condition, for instance), then the database overwrites the oldest record in the control file.</p>
<p>The database records the overwrite in the alert log located in the <a id="sthref1085"></a><a href="glossary.htm#CHDDAHBD"><span class="xrefglossterm">Automatic Diagnostic Repository (ADR)</span></a>. For each record that it overwrites, the database records an entry in the alert log similar to the following:</p>
<pre dir="ltr">
kccwnc: following control file record written over:  
RECID #72 Recno 72 Record timestamp  
07/28/06 22:15:21  
Thread=1 Seq#=3460  
Backup set key: stamp=372031415, count=17  
Low scn: 0x0000.3af33f36  
07/27/06 21:00:08  
Next scn: 0x0000.3af3871b  
07/27/06 23:23:54
Resetlogs scn and time  
scn: 0x0000.00000001
</pre>
<div id="BRADV89610" class="sect3"><a id="sthref1086"></a>
<h4 class="sect3">Fast Recovery Area and Control File Records</h4>
<p>When a control file record containing information about a file created in the fast recovery area is about to be reused, the database attempts to delete the file from the fast recovery area when the file is eligible for deletion. Otherwise, the database expands the size of the control file section containing the record for this file. The database logs the expansion in the alert log with a message like this example, where <code dir="ltr"><span class="codeinlineitalic">nnnn</span></code> is the number of the control file record type:</p>
<pre dir="ltr">
kccwnc: trying to expand control file section <span class="italic">nnnn</span> for Oracle Managed Files
</pre>
<p>If the control file is at the maximum size supported under the host operating system, then the database cannot expand the control file. In such a situation, this warning appears in the alert log:</p>
<pre dir="ltr">
WARNING: Oracle Managed File filename is unknown to control file. This is the result of limitation in control file size that could not keep all recovery area files. 
</pre>
<p>The preceding message means that the control file cannot hold a record of all fast recovery area files needed to satisfy the configured retention policy. The next section explains how to respond to this situation.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN10020" href="../../server.112/e40402/initparams036.htm#REFRN10020"><span class="italic">Oracle Database Reference</span></a> for information about the <code dir="ltr">CONTROL_FILE_RECORD_KEEP_TIME</code> initialization parameter</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1007330"></a>
<div id="BRADV8206" class="sect2">
<h3 class="sect2">Preventing the Loss of Control File Records</h3>
<p>The best way to prevent the loss of RMAN metadata because of overwritten control file records is to use a recovery catalog. If you cannot use a recovery catalog, then you can take the following measures:</p>
<ul>
<li>
<p>Set <a id="sthref1087"></a>the <code dir="ltr">CONTROL_FILE_RECORD_KEEP_TIME</code> value to slightly longer than the oldest file that you must keep. For example, if you back up the whole database once a week, then you must keep every backup for at least 7 days. Set <code dir="ltr">CONTROL_FILE_RECORD_KEEP_TIME</code> to a value such as <code dir="ltr">10</code> or <code dir="ltr">14</code>. The default value of <code dir="ltr">CONTROL_FILE_RECORD_KEEP_TIME</code> is 7 days.</p>
<div class="infoboxnotewarn">
<p class="notep1">Caution:</p>
Regardless of whether you use a recovery catalog, never use RMAN when <code dir="ltr">CONTROL_FILE_RECORD_KEEP_TIME</code> is set to 0. If you do, then you may lose backup records.</div>
</li>
<li>
<p>Store the control file in a file system rather than on a <a href="glossary.htm#CHDHBJAG"><span class="xrefglossterm">raw device</span></a> so that it can expand.</p>
</li>
<li>
<p><a id="sthref1088"></a>Monitor the alert log to ensure that Oracle Database is not overwriting control file records. The alert log is located in the <a href="glossary.htm#CHDDAHBD"><span class="xrefglossterm">Automatic Diagnostic Repository (ADR)</span></a>.</p>
</li>
</ul>
<p>If you use a fast recovery area, then follow these guidelines to avoid a situation in which the control file cannot hold a record of all fast recovery area files needed to satisfy the backup retention policy:</p>
<ul>
<li>
<p>If the block size of the control file is not at its maximum, then use a larger block size, preferably 32 kilobytes.</p>
<p>To achieve this aim, you must set the <code dir="ltr">SYSTEM</code> tablespace block size to be greater than or equal to the control file block size, and re-create the control file after changing <code dir="ltr">DB_BLOCK_SIZE</code>. The files in the fast recovery area are recataloged, but the records for files on tape are lost.</p>
</li>
<li>
<p>Make the files in the fast recovery area eligible for deletion by backing them up to tertiary storage such as tape.</p>
<p>For example, you can use <code dir="ltr">BACKUP RECOVERY AREA</code> to specifically back up files in the fast recovery area to a media manager.</p>
</li>
<li>
<p>If the backup retention policy is keeping backups and archived logs longer than your business requirements, then you can make more files in the fast recovery area eligible for deletion by changing the retention policy to a shorter recovery window or lower degree of redundancy.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="i1008693"></a>
<div id="BRADV89611" class="sect2">
<h3 class="sect2">Protecting the Control File</h3>
<p>If you are not using a recovery catalog to store RMAN metadata, then it is doubly important that you protect each target database control file. <a id="sthref1089"></a>You can use the following strategy to protect the control file.</p>
<p class="subhead2"><a id="BRADV284"></a>To protect the control file:</p>
<ol>
<li>
<p>Create <a id="sthref1090"></a>redundant copies of <a id="sthref1091"></a>control files through <a href="glossary.htm#i999499"><span class="xrefglossterm">multiplexing</span></a> or operating system <a href="glossary.htm#i432964"><span class="xrefglossterm">mirroring</span></a>.</p>
<p>In this way, the database can survive the loss of a subset of the control files without requiring you to restore a control file from backup. Oracle recommends that you use a minimum of two <a id="sthref1092"></a><a id="sthref1093"></a>multiplexed or mirrored control files on separate disks.</p>
</li>
<li>
<p>Configure the <a id="sthref1094"></a><a href="glossary.htm#i432379"><span class="xrefglossterm">control file autobackup</span></a> feature.</p>
<p>In this case, RMAN automatically backs up the control file when you run certain RMAN commands. If a control file autobackup is available, RMAN can restore the server parameter and backup control file, and mount the database. After the control file is mounted, you can restore the remainder of the database.</p>
</li>
<li>
<p>Keep a record of the database DBID.</p>
<p>If you lose the control files, then you can use the DBID to recover the database.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmbckba.htm#i1009642">"Backing Up Control Files with RMAN"</a> to learn about manual and automatic control file backups</p>
</li>
<li>
<p><a href="rcmcncpt.htm#i1016424">"Control File and Server Parameter File Autobackups"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1009331"></a>
<div id="BRADV89612" class="sect1">
<h2 class="sect1">Maintaining the Fast Recovery Area</h2>
<p><a id="sthref1095"></a>Although the fast recovery area is largely self-managing, some situations may require database administration intervention.</p>
<a id="CHDHHAJF"></a>
<div id="BRADV89613" class="sect2">
<h3 class="sect2">Deletion Rules for the Fast Recovery Area</h3>
<p><a href="rcmconfb.htm#CHDIBECI">"Overview of the Fast Recovery Area"</a> explains the contents of the fast recovery area and the difference between permanent and transient files. Review this section before proceeding. The following rules govern when files become eligible for deletion from the recovery area:</p>
<ul>
<li>
<p>Permanent files are never eligible for deletion.</p>
</li>
<li>
<p>Files that are obsolete under the retention policy are eligible for deletion.</p>
<p><a href="rcmconfb.htm#i1019318">"Configuring the Backup Retention Policy"</a> explains how to configure the retention policy.</p>
</li>
<li>
<p>Transient files that have been copied to tape are eligible for deletion.</p>
</li>
<li>
<p>Archived redo logs are not eligible for deletion until all the consumers of the logs have satisfied their requirements.</p>
<p><a href="rcmconfb.htm#CHDCFHBG">"Configuring an Archived Redo Log Deletion Policy"</a> explains how to configure an <a href="glossary.htm#CHDGCGHA"><span class="xrefglossterm">archived redo log deletion policy</span></a> that determines when logs are eligible to be deleted. Consumers of logs can include RMAN, standby databases, Oracle Streams databases, and the Flashback Database feature. See <a class="olink SBYDB04700" href="../../server.112/e41134/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn about archived redo log management in a Data Guard environment.</p>
</li>
<li>
<p>Foreign archived logs that have been mined by a LogMiner session on a logical standby database are eligible for deletion. Because it is generated from a different database than the current database, a <a href="glossary.htm#CHDJCIFH"><span class="xrefglossterm">foreign archived redo log</span></a> has a different DBID than the current archived redo logs.</p>
</li>
</ul>
<p>The safe and reliable way to control deletion of from the fast recovery area is to configure your retention policy () and archived log deletion policy (see <a href="rcmconfb.htm#CHDCFHBG">"Configuring an Archived Redo Log Deletion Policy"</a>). To increase the likelihood that files moved to tape are retained on disk, increase the fast recovery area quota.</p>
</div>
<!-- class="sect2" -->
<a id="BABFCJAC"></a>
<div id="BRADV89614" class="sect2">
<h3 class="sect2">Monitoring Fast Recovery Area Space Usage</h3>
<p><a id="sthref1096"></a><a id="sthref1097"></a><a id="sthref1098"></a><a id="sthref1099"></a><a id="sthref1100"></a><a id="sthref1101"></a>You can use <a id="sthref1102"></a><a id="sthref1103"></a>the <code dir="ltr">V$RECOVERY_FILE_DEST</code> <a id="sthref1104"></a>and <code dir="ltr">V$RECOVERY_AREA_USAGE</code> views to determine whether you have allocated enough space for your fast recovery area. Query the <code dir="ltr">V$RECOVERY_FILE_DEST</code> view to discover the current location, disk quota, space in use, space reclaimable by deleting files, and total number of files in the fast recovery area. For example, enter the query shown in <a href="#CHDJIBFG">Example 12-1</a> (sample output included). The space columns specify the amount in bytes.</p>
<div id="BRADV285" class="example">
<p class="titleinexample"><a id="CHDJIBFG"></a>Example 12-1 Fast Recovery Area Space Consumption</p>
<pre dir="ltr">
SELECT * FROM V$RECOVERY_FILE_DEST;

NAME            SPACE_LIMIT SPACE_USED SPACE_RECLAIMABLE NUMBER_OF_FILES
--------------  ----------- ---------- ----------------- ---------------
/mydisk/rcva     5368709120 109240320             256000              28
</pre></div>
<!-- class="example" -->
<p>Query the <code dir="ltr">V$RECOVERY_AREA_USAGE</code> view to discover the percentage of the total disk quota used by different types of files. Also, you can determine how much space for each type of file can be reclaimed by deleting files that are obsolete, redundant, or backed up to tape. For example, enter the following query (sample output included):</p>
<pre dir="ltr">
SELECT * FROM   V$RECOVERY_AREA_USAGE;

FILE_TYPE    PERCENT_SPACE_USED PERCENT_SPACE_RECLAIMABLE NUMBER_OF_FILES
------------ ------------------ ------------------------- ---------------
CONTROLFILE                   0                         0               0
ONLINELOG                     2                         0              22
ARCHIVELOG                 4.05                      2.01              31
BACKUPPIECE                3.94                      3.86               8
IMAGECOPY                 15.64                     10.43              66
FLASHBACKLOG                .08                         0               1
</pre>
<p>When guaranteed restore points are defined on your database, you should monitor the amount of space used in your fast recovery area for files required to meet the guarantee. Use the query for viewing guaranteed restore points in <a href="flashdb.htm#CFHGBFEI">"Listing Restore Points"</a> and see the <code dir="ltr">STORAGE_SIZE</code> column to determine the space required for files related to each guaranteed restore point.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<span class="italic">Oracle Database Reference</span> for more details on the <a class="olink REFRN30304" href="../../server.112/e40402/dynviews_2125.htm#REFRN30304"><code dir="ltr">V$RECOVERY_FILE_DEST</code></a> and <a class="olink REFRN30377" href="../../server.112/e40402/dynviews_2124.htm#REFRN30377"><code dir="ltr">V$RECOVERY_AREA_USAGE</code></a> views</div>
</div>
<!-- class="sect2" -->
<a id="BABCAGIB"></a>
<div id="BRADV89615" class="sect2">
<h3 class="sect2">Managing Space for Flashback Logs in the Fast Recovery Area</h3>
<p><a id="sthref1105"></a><a href="flashdb.htm#CFHJJHEC">"Logging for Flashback Database with Guaranteed Restore Points Defined"</a> <a id="sthref1106"></a>explains the rules for flashback log deletion. You cannot manage the flashback logs in the fast recovery area directly other than by setting the flashback retention target or using guaranteed restore points. Nevertheless, you can manage fast recovery area space as a whole to maximize the space available for retention of flashback logs. In this way you increase the likelihood of achieving the flashback target.</p>
<p>To make space for flashback logs, back up the other contents of your fast recovery area to tape with commands such as <code dir="ltr">BACKUP</code> <code dir="ltr">RECOVERY</code> <code dir="ltr">AREA</code>, <code dir="ltr">BACKUP</code> <code dir="ltr">BACKUPSET</code>, and so on. Oracle Database automatically removes obsolete files from the fast recovery area. If offloading backups to tape still does not create enough space to satisfy the backup retention policy and flashback retention target, then allocate more space in the fast recovery area.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You cannot back up flashback logs. Thus, the <code dir="ltr">BACKUP</code> <code dir="ltr">RECOVERY</code> <code dir="ltr">AREA</code> operation does not include the flashback logs when backing up the fast recovery area contents to tape.</div>
</div>
<!-- class="sect2" -->
<a id="i1009006"></a>
<div id="BRADV89616" class="sect2">
<h3 class="sect2">Responding to a Full Fast Recovery Area</h3>
<p>If the RMAN retention policy requires keeping a set of backups larger than the fast recovery area disk quota, or if the retention policy is set to <code dir="ltr">NONE</code>, then the fast recovery area can fill completely with no reclaimable space.</p>
<p>The database issues a warning alert when reclaimable space is less than 15% and a critical alert when reclaimable space is less than 3%. To warn the DBA of this condition, an entry is added to the alert log and to the <code dir="ltr">DBA_OUTSTANDING_ALERTS</code> table (used by Enterprise Manager). Nevertheless, the database continues to consume space in the fast recovery area until there is no reclaimable space left.</p>
<p>When the recovery area is completely full, the error displayed is as follows, where <span class="italic">nnnnn</span> is the number of bytes required and <span class="italic">mmmmm</span> is the disk quota:</p>
<pre dir="ltr">
ORA-19809: limit exceeded for recovery files
ORA-19804: cannot reclaim <span class="italic">nnnnn</span> bytes disk space from <span class="italic">mmmmm</span> limit
</pre>
<p>You have several choices for how to resolve a full fast recovery area when no files are eligible for deletion:</p>
<ul>
<li>
<p>Make more disk space available and increase <code dir="ltr">DB_RECOVERY_FILE_DEST_SIZE</code> to reflect the additional space.</p>
</li>
<li>
<p>Move backups from the fast recovery area to tertiary storage such as tape.</p>
<p>One convenient way to back up all of your recovery area files to tape at once is the <code dir="ltr">BACKUP</code> <code dir="ltr">RECOVERY</code> <code dir="ltr">AREA</code> command. After you transfer backups from the recovery area to tape, you can delete files from the fast recovery area (see <a href="#i1006215">"Deleting RMAN Backups and Archived Redo Logs"</a>). Flashback logs cannot be backed up outside the recovery area and are not backed up by <code dir="ltr">BACKUP</code> <code dir="ltr">RECOVERY</code> <code dir="ltr">AREA</code>.</p>
</li>
<li>
<p>Run <code dir="ltr">DELETE</code> for any files that have been removed with an operating system utility.</p>
<p>If you use host operating system commands to delete files, then the database is not aware of the resulting free space. You can run the RMAN <code dir="ltr">CROSSCHECK</code> command to have RMAN recheck the contents of the fast recovery area and identify expired files, and then use the <code dir="ltr">DELETE EXPIRED</code> command to delete every <a href="glossary.htm#CHDGICAB"><span class="xrefglossterm">expired backup</span></a> from the RMAN repository.</p>
</li>
<li>
<p>Ensure that your guaranteed restore points are necessary. If not, delete them as described in <a href="flashdb.htm#CFHFIHAA">"Dropping Restore Points"</a>.</p>
<p>Flashback logs that are not needed for a guaranteed restore point are deleted automatically to gain space for other files in the fast recovery area. A guaranteed restore point forces the retention of flashback logs required to perform Flashback Database to the restore point SCN.</p>
</li>
<li>
<p>Review your backup retention policy and, if using Data Guard, your archived redo log deletion policy.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rcmbckba.htm#g1050005">Chapter 9, "Backing Up the Database"</a> to decide on a retention policy, and <a class="olink SBYDB04700" href="../../server.112/e41134/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for more information about archived log deletion policy with Data Guard</div>
</div>
<!-- class="sect2" -->
<a id="i1009489"></a>
<div id="BRADV89618" class="sect2">
<h3 class="sect2">Changing the Fast Recovery Area to a New Location</h3>
<p><a id="sthref1107"></a>If you must move the fast recovery area of your database to a new location, then follow this procedure:</p>
<ol>
<li>
<p>Start a SQL*Plus on the target database and change the <code dir="ltr">DB_RECOVERY_FILE_DEST</code> initialization parameter. For example, enter the following command to set the destination to the ASM disk group <code dir="ltr">disk1</code>:</p>
<pre dir="ltr">
ALTER SYSTEM SET DB_RECOVERY_FILE_DEST='+disk1' SCOPE=BOTH SID='*';
</pre>
<p>After you change this parameter, all new fast recovery area files are created in the new location.</p>
</li>
<li>
<p>Either leave or move the permanent files, flashback logs, and transient files in the old flash recovery location.</p>
<p>If you leave the existing files in the flash recovery, then the database deletes the transient files from the old fast recovery area as they become eligible for deletion.</p>
<p>If you must move the old files to the new fast recovery area, then see the <span class="italic">Oracle Database Storage Administrator's Guide</span>. The procedure for moving database files into and out of an ASM disk group with RMAN works when moving files into and out of a fast recovery area.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<div id="BRADV89619" class="sect2"><a id="sthref1108"></a>
<h3 class="sect2">Disabling the Fast Recovery Area</h3>
<p><a id="sthref1109"></a>Before disabling the fast recovery area, you must first drop all guaranteed restore points and then turn off Flashback Database. Once these prerequisites have been met, you can disable the fast recovery area by setting the <code dir="ltr">DB_RECOVERY_FILE_DEST</code> initialization parameter to a null string. For example, use the following SQL statement to change the parameter on a running database:</p>
<pre dir="ltr">
ALTER SYSTEM SET DB_RECOVERY_FILE_DEST='' SCOPE=BOTH SID='*';
</pre>
<p>The database no longer provides the space management features of the fast recovery area for the files stored in the old <code dir="ltr">DB_RECOVERY_FILE_DEST</code> location. The files are still known to the RMAN repository, however, and available for backup and restore activities.</p>
</div>
<!-- class="sect2" -->
<div id="BRADV89620" class="sect2"><a id="sthref1110"></a>
<h3 class="sect2">Responding to an Instance Crash During File Creation</h3>
<p>As a rule, the fast recovery area is self-maintaining. When an instance crashes during the creation of a file in the fast recovery area, however, the database may leave the file in the fast recovery area. When this situation occurs, the alert log contains the following error, where <code dir="ltr"><span class="codeinlineitalic">location</span></code> is the location of the fast recovery area:</p>
<pre dir="ltr">
ORA-19816: WARNING: Files may exist in <span class="italic">location</span> that are not known to database.
</pre>
<p>In such a situation, use the RMAN command <code dir="ltr">CATALOG RECOVERY AREA</code> to recatalog any such files. If the file header of the file in question is corrupted, then delete the file manually with an operating system utility.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDJJBHA"></a>
<div id="BRADV89623" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Updating the RMAN Repository</h2>
<p>This section explains how to ensure that the RMAN repository accurately reflects the reality of the RMAN-related files stored on disk and tape. Several situations can cause a discrepancy between the repository and the files that it records, including tape or disk failures and user-managed copies or deletions of RMAN-related files.</p>
<p>This section contains the following topics:</p>
<ul>
<li>
<p><a href="#i1007384">Crosschecking the RMAN Repository</a></p>
</li>
<li>
<p><a href="#i1006345">Changing the Repository Status of Backups and Copies</a></p>
</li>
<li>
<p><a href="#i1007717">Adding Backup Records to the RMAN Repository</a></p>
</li>
<li>
<p><a href="#i1007225">Removing Records from the RMAN Repository</a></p>
</li>
</ul>
<a id="i1007384"></a>
<div id="BRADV8171" class="sect2">
<h3 class="sect2">Crosschecking the RMAN Repository</h3>
<p><a id="sthref1111"></a><a id="sthref1112"></a><a id="sthref1113"></a>To ensure that data about backups in the recovery catalog or control file is synchronized with corresponding data on disk or in the media management catalog, perform a <a href="glossary.htm#i432441"><span class="xrefglossterm">crosscheck</span></a><a id="sthref1114"></a>. <a id="sthref1115"></a><a id="sthref1116"></a><a id="sthref1117"></a><a id="sthref1118"></a>The <a id="sthref1119"></a><a id="sthref1120"></a><code dir="ltr">CROSSCHECK</code> command operates only on files that are currently recorded in the RMAN repository.</p>
<p>If you use a fast recovery area, backup retention policy, and archived redo log deletion policy, then you should not need to perform crosschecks very often. If you delete files by means other than RMAN, then you should perform a crosscheck periodically to ensure that the repository data stays current.</p>
<a id="i1006149"></a>
<div id="BRADV89624" class="sect3">
<h4 class="sect3">About RMAN Crosschecks</h4>
<p><a id="sthref1121"></a><a id="sthref1122"></a><a id="sthref1123"></a>Crosschecks update outdated RMAN repository information about backups whose repository records do not match their physical status. For example, if a user removes archived logs from disk with an operating system command, the repository still indicates that the logs are on disk, when in fact they are not.</p>
<p><a href="#i1010226">Figure 12-1</a> illustrates a crosscheck of a media manager. RMAN queries the RMAN repository for the names and locations of the four backup sets to be checked. RMAN sends this information to the target database server, which queries the media management software about the backups. The media management software then checks its media catalog and reports back to the server that backup set <code dir="ltr">3</code> is missing. RMAN updates the status of backup set <code dir="ltr">3</code> to <code dir="ltr">EXPIRED</code> in the repository. The record for backup set <code dir="ltr">3</code> is deleted once you <a id="sthref1124"></a><a id="sthref1125"></a>run <code dir="ltr">DELETE</code> <code dir="ltr">EXPIRED</code>.</p>
<div id="BRADV287" class="figure">
<p class="titleinfigure"><a id="i1010226"></a>Figure 12-1 Crosschecking a Media Manager</p>
<img width="496" height="208" src="img/bradv031.gif" alt="Description of Figure 12-1 follows" /><br />
<a id="sthref1126" href="img_text/bradv031.htm">Description of "Figure 12-1 Crosschecking a Media Manager"</a><br />
<br /></div>
<!-- class="figure" -->
<p>Crosschecks are useful because they can do the following:</p>
<ul>
<li>
<p><a id="sthref1127"></a><a id="sthref1128"></a><a id="sthref1129"></a><a id="sthref1130"></a>Update outdated information about backups that disappeared from disk or tape or became corrupted</p>
</li>
<li>
<p>Update the repository if you delete archived redo logs or other files with operating system commands</p>
</li>
</ul>
<p><a id="sthref1131"></a>Use the crosscheck feature to check the status of a backup on disk or tape. If the backup is on disk, then <code dir="ltr">CROSSCHECK</code> checks whether the header of the file is valid. If a backup is on tape, then the command checks that the backups exist in the media management software catalog.</p>
<p>Backup pieces and image copies can have the status <code dir="ltr">AVAILABLE</code>, <code dir="ltr">EXPIRED</code>, or <code dir="ltr">UNAVAILABLE</code>. You can view the status of backups by running the RMAN <code dir="ltr">LIST</code> command or by <a id="sthref1132"></a>querying <code dir="ltr">V$BACKUP_FILES</code> or recovery catalog views such as <code dir="ltr">RC_DATAFILE_COPY</code> or <code dir="ltr">RC_ARCHIVED_LOG</code>. A crosscheck updates the RMAN repository so that all of these techniques provide accurate information. RMAN updates each backup in the RMAN repository to status <code dir="ltr">EXPIRED</code> if the backup is no longer available. If a new crosscheck determines that an <a id="sthref1133"></a><a href="glossary.htm#CHDGICAB"><span class="xrefglossterm">expired backup</span></a> is available again, then RMAN updates its status to <code dir="ltr">AVAILABLE</code>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code dir="ltr">CROSSCHECK</code> command does <span class="italic">not</span> delete operating system files or remove repository records. You must use the <code dir="ltr">DELETE</code> command for these operations.</div>
<p>You can issue the <code dir="ltr">DELETE</code> <code dir="ltr">EXPIRED</code> command to delete all expired backups. RMAN removes the record for the expired file from the repository. If for some reason the file still exists on the media, then RMAN issues warnings and lists the mismatched objects that cannot be deleted.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink RCMRF119" href="../../backup.112/e10643/rcmsynta015.htm#RCMRF119"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">CROSSCHECK</code> syntax and a description of the possible status values</p>
</li>
<li>
<p><a class="olink RCMRF121" href="../../backup.112/e10643/rcmsynta016.htm#RCMRF121"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">DELETE</code> syntax</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="BABIGHBE"></a>
<div id="BRADV89625" class="sect3">
<h4 class="sect3">Crosschecking All Backups and Copies</h4>
<p>After connecting to the target database and recovery catalog (if you use one), run <code dir="ltr">CROSSCHECK</code> commands as needed to verify the status and availability of backups known to RMAN.</p>
<p>You can configure or manually allocate multiple channels before issuing <code dir="ltr">CROSSCHECK</code> or <code dir="ltr">DELETE</code> commands. RMAN searches for each backup on all channels that have the same device type as the channel used to create the backup. The multichannel feature is primarily intended for use when crosschecking or deleting backups on both disk and tape within a single command. For example, assume that you have an <a href="glossary.htm#CHDCCBFI"><span class="xrefglossterm">SBT</span></a> channel configured as follows:</p>
<pre dir="ltr">
CONFIGURE DEVICE TYPE sbt PARALLELISM 1;
CONFIGURE DEFAULT DEVICE TYPE sbt;
</pre>
<p>In this case you can run the following commands to crosscheck both disk and SBT:</p>
<pre dir="ltr">
CROSSCHECK BACKUP;
CROSSCHECK COPY;
</pre>
<p>RMAN uses both the SBT channel and the preconfigured disk channel to perform the crosscheck. Sample output follows:</p>
<pre dir="ltr">
allocated channel: ORA_SBT_TAPE_1
channel ORA_SBT_TAPE_1: sid=12 devtype=SBT_TAPE
channel ORA_SBT_TAPE_1: WARNING: Oracle Test Disk API
using channel ORA_DISK_1
crosschecked backup piece: found to be 'AVAILABLE'
backup piece handle=/oracle/dbs/16c5esv4_1_1 recid=36 stamp=408384484
crosschecked backup piece: found to be 'AVAILABLE'
backup piece handle=/oracle/dbs/c-674966176-20000915-01 recid=37 stamp=408384496
crosschecked backup piece: found to be 'AVAILABLE'
backup piece handle=12c5erb2_1_1 recid=32 stamp=408382820
     .
     .
     .
</pre>
<p>If you do not have an automatic SBT channel configured, then you can manually allocate maintenance channels on disk and tape.</p>
<pre dir="ltr">
  ALLOCATE CHANNEL FOR MAINTENANCE DEVICE TYPE sbt;
  CROSSCHECK BACKUP;
  CROSSCHECK COPY;
</pre>
<p>You do not have to manually allocate a disk channel because RMAN uses the preconfigured disk channel.</p>
</div>
<!-- class="sect3" -->
<a id="i1006178"></a>
<div id="BRADV89626" class="sect3">
<h4 class="sect3">Crosschecking Specific Backup Sets and Copies</h4>
<p>You can use the <code dir="ltr">LIST</code> command to report your backups and then use the <code dir="ltr">CROSSCHECK</code> command to check that specific backups described in the <code dir="ltr">LIST</code> output still exist. The <code dir="ltr">DELETE</code> <code dir="ltr">EXPIRED</code> command deletes repository records for backups that fail the crosscheck.</p>
<p class="subhead2"><a id="BRADV288"></a>To crosscheck specified backups:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>Run a <code dir="ltr">LIST</code> command to identify the backups to be checked.</p>
<p>For example, run the following command:</p>
<pre dir="ltr">
LIST BACKUP;  # lists all backup sets, proxy copies, and image copies
</pre></li>
<li>
<p>Crosscheck the desired backups or copies.</p>
<p>The following sample commands illustrate different types of crosschecks:</p>
<pre dir="ltr">
CROSSCHECK BACKUP;  # checks backup sets, proxy copies, and image copies
CROSSCHECK COPY OF DATABASE;
CROSSCHECK BACKUPSET 1338, 1339, 1340;
CROSSCHECK BACKUPPIECE TAG 'nightly_backup';
CROSSCHECK BACKUP OF ARCHIVELOG ALL SPFILE;
CROSSCHECK BACKUP OF DATAFILE "?/oradata/trgt/system01.dbf"
  COMPLETED AFTER 'SYSDATE-14';
CROSSCHECK CONTROLFILECOPY '/tmp/control01.ctl';
CROSSCHECK DATAFILECOPY 113, 114, 115;
CROSSCHECK PROXY 789;
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF119" href="../../backup.112/e10643/rcmsynta015.htm#RCMRF119"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for more details on using <code dir="ltr">CROSSCHECK</code> to check backups of specific files</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1006345"></a>
<div id="BRADV8173" class="sect2">
<h3 class="sect2">Changing the Repository Status of Backups and Copies</h3>
<p>This section explains how to change the repository records for backups and copies. You can change the status of a backup if it becomes temporarily available or unavailable. For example, if a mounted disk undergoes maintenance, then you can update the records for backups on the disk to status <code dir="ltr">UNAVAILABLE</code>.</p>
<a id="i1007729"></a>
<div id="BRADV89627" class="sect3">
<h4 class="sect3">Updating a Backup to Status AVAILABLE or UNAVAILABLE</h4>
<p><a id="sthref1134"></a><a id="sthref1135"></a>Run <a id="sthref1136"></a>the <code dir="ltr">CHANGE</code> <code dir="ltr">...</code> <code dir="ltr">UNAVAILABLE</code> command when a backup cannot be found or has migrated offsite. RMAN does not use files with status <code dir="ltr">UNAVAILABLE</code> in <code dir="ltr">RESTORE</code> or <code dir="ltr">RECOVER</code> commands. If the file is later found or returns to the main site, then you can update its status again by issuing <a id="sthref1137"></a><a id="sthref1138"></a><code dir="ltr">CHANGE</code> <code dir="ltr">...</code> <code dir="ltr">AVAILABLE</code>. The files in the fast recovery area cannot be marked as <code dir="ltr">UNAVAILABLE</code>.</p>
<p class="subhead2"><a id="BRADV289"></a>To update the status of a file in the repository to UNAVAILABLE or AVAILABLE:</p>
<ol>
<li>
<p>Issue a <code dir="ltr">LIST</code> command to determine the availability status of RMAN backups. For example, issue the following command to list all backups:</p>
<pre dir="ltr">
LIST BACKUP;
</pre></li>
<li>
<p>Run <code dir="ltr">CHANGE</code> with the <code dir="ltr">UNAVAILABLE</code> or <code dir="ltr">AVAILABLE</code> keyword to update its status in the RMAN repository.</p>
<p>The following examples illustrate forms of the <code dir="ltr">CHANGE</code> command:</p>
<pre dir="ltr">
CHANGE DATAFILECOPY '/tmp/control01.ctl' UNAVAILABLE;
CHANGE COPY OF ARCHIVELOG SEQUENCE BETWEEN 1000 AND 1012 UNAVAILABLE;
CHANGE BACKUPSET 12 UNAVAILABLE;
CHANGE BACKUP OF SPFILE TAG "TAG20020208T154556" UNAVAILABLE;
CHANGE DATAFILECOPY '/tmp/system01.dbf' AVAILABLE;
CHANGE BACKUPSET 12 AVAILABLE;
CHANGE BACKUP OF SPFILE TAG "TAG20020208T154556" AVAILABLE;
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF110" href="../../backup.112/e10643/rcmsynta009.htm#RCMRF110"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">CHANGE</code> command syntax</div>
</div>
<!-- class="sect3" -->
<a id="i1007684"></a>
<div id="BRADV99973" class="sect3">
<h4 class="sect3">Changing the Status of an Archival Backup</h4>
<p><a id="sthref1139"></a><a id="sthref1140"></a><a id="sthref1141"></a>As <a id="sthref1142"></a>explained in <a href="rcmbckba.htm#CHDHAFHJ">"Making Database Backups for Long-Term Storage"</a>, you can designate backups as exempt from the retention policy. This technique is useful for archiving backups to comply with business requirements. An <a href="glossary.htm#CHDEAHIB"><span class="xrefglossterm">archival backup</span></a> is still a fully valid backup, however, and can be restored just as any other RMAN backup.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code dir="ltr">KEEP</code> <code dir="ltr">FOREVER</code> clause requires the use of a recovery catalog, because the control file cannot contain an infinitely large set of RMAN repository data.</div>
<p>You can use the <code dir="ltr">CHANGE</code> command to alter the <code dir="ltr">KEEP</code> status of an existing backup. For example, you may decide that you no longer want to keep a long-term backup. The same options available for <code dir="ltr">BACKUP</code> <code dir="ltr">...</code> <code dir="ltr">KEEP</code> are available with <code dir="ltr">CHANGE</code> <code dir="ltr">...</code> <code dir="ltr">KEEP</code>.</p>
<p>You cannot set <code dir="ltr">KEEP</code> attributes for backup sets or files stored in the <a href="glossary.htm#i999320"><span class="xrefglossterm">fast recovery area</span></a>.</p>
<p class="subhead2"><a id="BRADV290"></a>To alter the KEEP status of an archival backup:</p>
<ol>
<li>
<p>Issue a <code dir="ltr">LIST</code> command to list the backups. For example, issue the following command to list all backups:</p>
<pre dir="ltr">
LIST BACKUP;
</pre></li>
<li>
<p>Issue a <code dir="ltr">CHANGE</code> <code dir="ltr">...</code> <code dir="ltr">KEEP</code> command to define a different retention period for this backup, or a <code dir="ltr">CHANGE</code> <code dir="ltr">...</code> <code dir="ltr">NOKEEP</code> command to let the retention policy apply to this file.</p>
<p>This example allows a backup set to be subject to the backup retention policy:</p>
<pre dir="ltr">
CHANGE BACKUPSET 231 NOKEEP;
</pre>
<p>This example makes a data file copy exempt from the retention policy for 180 days:</p>
<pre dir="ltr">
CHANGE DATAFILECOPY '/tmp/system01.dbf' KEEP UNTIL TIME 'SYSDATE+180';
</pre></li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1007717"></a>
<div id="BRADV8174" class="sect2">
<h3 class="sect2">Adding Backup Records to the RMAN Repository<a id="sthref1143"></a></h3>
<p><a id="sthref1144"></a><a id="sthref1145"></a><a id="sthref1146"></a><a id="sthref1147"></a><a id="sthref1148"></a>You can use <a id="sthref1149"></a><a id="sthref1150"></a>the <code dir="ltr">CATALOG</code> command to make RMAN aware of the existence of archived logs not recorded in the repository or copies of database files that are created through means other than RMAN. This section contains the following topics:</p>
<ul>
<li>
<p><a href="#i1006429">About Cataloging Operations</a></p>
</li>
<li>
<p><a href="#i1006466">Cataloging User-Managed Data File Copies</a></p>
</li>
<li>
<p><a href="#i1006488">Cataloging Backup Pieces</a></p>
</li>
<li>
<p><a href="#i1007978">Cataloging All Files in a Disk Location</a></p>
</li>
</ul>
<a id="i1006429"></a>
<div id="BRADV89628" class="sect3">
<h4 class="sect3">About Cataloging Operations</h4>
<p>The target database control file keeps records of all archived redo logs generated by the target database and all RMAN backups. The purpose of the <code dir="ltr">CATALOG</code> command is to add metadata to the repository when it does not have a record of files for RMAN.</p>
<p>Run the RMAN <code dir="ltr">CATALOG</code> command when:</p>
<ul>
<li>
<p>You use an operating system utility to make copies of datafiles, archived logs, or backup pieces. In this case, the repository has no record of them.</p>
</li>
<li>
<p>You perform recovery with a backup control file and you change the archiving destination or format during recovery. In this situation, the repository does not have information about archived logs needed for recovery, and you must catalog these logs.</p>
</li>
<li>
<p>You want to catalog data file copy as a level 0 backup, thus enabling you to perform an incremental backup later by using the data file copy as the base of an incremental backup strategy.</p>
</li>
<li>
<p>You want to catalog user-managed copies of Oracle7 database files created before you migrated to a higher release, or of Oracle8 and higher database files created before you started to use RMAN. These data file copies enable you to recover the database if it fails after migration but before you have a chance to take a backup of the migrated database.</p>
</li>
</ul>
<p>Whenever you make a user-managed copy, for example, by using the UNIX <code dir="ltr">cp</code> command to copy a data file, be sure to catalog it. When making user-managed copies, you can use the <code dir="ltr">ALTER</code> <code dir="ltr">TABLESPACE</code> <code dir="ltr">...</code> <code dir="ltr">BEGIN</code>/<code dir="ltr">END</code> <code dir="ltr">BACKUP</code> statement to make data file copies off an online tablespace. Although RMAN does not create such data file copies, you can use the <code dir="ltr">CATALOG</code> command to add them to the recovery catalog so that RMAN is aware of them.</p>
<p>For a user-managed copy to be cataloged, it must be:</p>
<ul>
<li>
<p>Accessible on disk</p>
</li>
<li>
<p>A complete image copy of a single file</p>
</li>
<li>
<p>Either a data file copy, control file copy, archived redo log copy, or backup piece copy</p>
</li>
</ul>
<p>For example, if you store datafiles on mirrored disk drives, then you can create a user-managed copy by breaking the mirror. In this scenario, use the <code dir="ltr">CATALOG</code> command to notify RMAN of the existence of the user-managed copy after breaking the mirror. Before reforming the mirror, run a<a id="sthref1151"></a><a id="sthref1152"></a><a id="sthref1153"></a> <code dir="ltr">CHANGE</code> <code dir="ltr">...</code> <code dir="ltr">UNCATALOG</code> command to notify RMAN that the file copy no longer exists.</p>
</div>
<!-- class="sect3" -->
<a id="i1006466"></a>
<div id="BRADV89629" class="sect3">
<h4 class="sect3">Cataloging User-Managed Data File Copies</h4>
<p>Use the <code dir="ltr">CATALOG</code> command to propagate information about user-managed copies to the RMAN repository. After the files are cataloged, you can run the <code dir="ltr">LIST</code> command or <a id="sthref1154"></a>query <code dir="ltr">V$BACKUP_FILES</code> view to confirm the information is contained in the RMAN repository.</p>
<p class="subhead2"><a id="BRADV291"></a>To create and catalog a user-managed copy of a data file:</p>
<ol>
<li>
<p>Make a data file copy with an operating system utility. <code dir="ltr">ALTER</code> <code dir="ltr">TABLESPACE</code> <code dir="ltr">BEGIN</code>/<code dir="ltr">END</code> <code dir="ltr">BACKUP</code> is necessary if the database is open and the data files are online while the backup is in progress. This example backs up an online data file, using the SQL*Plus <code dir="ltr">HOST</code> command to issue an operating system command.</p>
<pre dir="ltr">
SQL&gt; ALTER TABLESPACE users BEGIN BACKUP;
SQL&gt; host cp $ORACLE_HOME/oradata/trgt/users01.dbf /tmp/users01.dbf;
SQL&gt; ALTER TABLESPACE users END BACKUP;
</pre></li>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>Run the <code dir="ltr">CATALOG</code> command.</p>
<p>For example, enter the following command to catalog a user-managed data file copy:</p>
<pre dir="ltr">
CATALOG DATAFILECOPY '/tmp/users01.dbf';
</pre>
<p>If you try to catalog a data file copy from a database other than the connected target database, then RMAN issues an error such as the following:</p>
<pre dir="ltr">
RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-03009: failure of catalog command on default channel at 08/29/2007 14:44:34
ORA-19563: datafile copy header validation failed for file /tmp/tools01.dbf
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF109" href="../../backup.112/e10643/rcmsynta008.htm#RCMRF109"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">CATALOG</code> command syntax</div>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="i1006488"></a>
<div id="BRADV8204" class="sect3">
<h4 class="sect3">Cataloging Backup Pieces</h4>
<p>You can catalog backup pieces on disk. This technique is useful if you use an operating system utility to copy backup pieces from one location to another on the same host, or from one host to another. You can even catalog a backup piece from a prior <a href="glossary.htm#i432741"><span class="xrefglossterm">incarnation</span></a> of the database. RMAN can determine whether that backup piece can be used during a subsequent restore and recovery operation.</p>
<p class="subhead2"><a id="BRADV292"></a>To catalog a backup piece:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>Catalog the file names of the backup pieces.</p>
<p>For example, enter the following command:</p>
<pre dir="ltr">
CATALOG BACKUPPIECE '/disk2/09dtq55d_1_2', '/disk2/0bdtqdou_1_1';
</pre></li>
<li>
<p>Optionally, run a <code dir="ltr">LIST</code> command or query <code dir="ltr">V$</code> views to verify your changes.</p>
<p>Views <a id="sthref1155"></a><a id="sthref1156"></a><a id="sthref1157"></a><a id="sthref1158"></a><a id="sthref1159"></a>include <code dir="ltr">V$BACKUP_PIECE</code>, <code dir="ltr">V$BACKUP_SET</code>, <code dir="ltr">V$BACKUP_DATAFILE</code>, <code dir="ltr">V$BACKUP_REDOLOG</code>, and <code dir="ltr">V$BACKUP_SPFILE</code>. The following query shows the names of backup pieces:</p>
<pre dir="ltr">
SELECT HANDLE 
FROM   V$BACKUP_PIECE;
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF109" href="../../backup.112/e10643/rcmsynta008.htm#RCMRF109"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">CATALOG</code> <code dir="ltr">BACKUPPIECE</code> restrictions</div>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="i1007978"></a>
<div id="BRADV8203" class="sect3">
<h4 class="sect3">Cataloging All Files in a Disk Location</h4>
<p>If you use Automatic Storage Management (ASM), an Oracle Managed Files framework, or the fast recovery area, then you may want to recatalog files that are known to the disk management system but are no longer listed in the RMAN repository. This situation can occur when the intended mechanism for tracking file names fails due to media failure, software bug, or user error.</p>
<p>The <code dir="ltr">CATALOG START WITH</code> command enables you to search through all files in an ASM disk group, Oracle Managed Files location, or traditional file system directory and investigate those that are not recorded in the RMAN repository. If the command can catalog a file, then it does so. If it cannot catalog the file, then it makes its best guess about the contents of the skipped file.</p>
<p>The <code dir="ltr">CATALOG RECOVERY AREA</code> command enables you to catalog all files in the recovery area. Typically, you would not need to run this command manually because RMAN automatically runs it when it is needed, for example, when you restore or create a control file. You can run this command when files are copied into the fast recovery area by operating system utilities.</p>
<p class="subhead2"><a id="BRADV293"></a>To catalog all files in a disk location:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>Run the <code dir="ltr">CATALOG</code> command, specifying the disk location whose files you want to catalog.</p>
<p>For example, enter the following commands:</p>
<pre dir="ltr">
CATALOG START WITH '+disk'; # catalog all files from an ASM disk group
CATALOG START WITH '/fs1/datafiles/'; # catalog all files in directory
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
Wildcard characters are not legal in the <code dir="ltr">START WITH</code> clause.</div>
<p>You can use the <code dir="ltr">CATALOG RECOVERY AREA</code> command to catalog all files in the recovery area. During this operation, any files in the recovery area not listed in the RMAN repository are added. For example:</p>
<pre dir="ltr">
CATALOG RECOVERY AREA;
</pre></li>
<li>
<p>Run a <code dir="ltr">LIST</code> command to verify that the files were cataloged.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1007225"></a>
<div id="BRADV8175" class="sect2">
<h3 class="sect2">Removing Records from the RMAN Repository</h3>
<p>This section explains how to remove records for files from the RMAN repository.</p>
<a id="i1006537"></a>
<div id="BRADV89630" class="sect3">
<h4 class="sect3">About Uncataloging Operations</h4>
<p><a id="sthref1160"></a><a id="sthref1161"></a><a id="sthref1162"></a>Run the <code dir="ltr">CHANGE</code> <code dir="ltr">...</code> <code dir="ltr">UNCATALOG</code> command to perform the following actions on RMAN repository records:</p>
<ul>
<li>
<p>Update a backup record in the control file repository to status <code dir="ltr">DELETED</code></p>
</li>
<li>
<p>Delete a specific backup record from the recovery catalog (if you use one)</p>
</li>
</ul>
<p>RMAN does not change the specified physical files: it only alters the repository records for these files.</p>
<p>You can use this command when you have deleted a backup through a means other than RMAN. For example, if you delete archived redo logs with an operating system utility, then remove the record for this log from the repository by issuing a <code dir="ltr">CHANGE</code> <code dir="ltr">ARCHIVELOG</code> <code dir="ltr">...</code> <code dir="ltr">UNCATALOG</code> command.</p>
</div>
<!-- class="sect3" -->
<a id="i1006545"></a>
<div id="BRADV89631" class="sect3">
<h4 class="sect3">Removing Records for Files Deleted with Operating System Utilities</h4>
<p>In some circumstances, users may have removed backups or archived redo logs with operating system utilities. Unless you run <code dir="ltr">CROSSCHECK</code>, RMAN does not know about the deletion. You can use the <code dir="ltr">CHANGE ... UNCATALOG</code> command to update the RMAN repository for the absent files.</p>
<p class="subhead2"><a id="BRADV294"></a><a id="sthref1163"></a>To remove the catalog record for a backup or archived redo log:</p>
<ol>
<li>
<p>Run a <code dir="ltr">CHANGE</code> <code dir="ltr">...</code> <code dir="ltr">UNCATALOG</code> command for the backups that you deleted from the operating system with operating system commands. This example deletes repository references to disk copies of the control file and data file <code dir="ltr">1</code>:</p>
<pre dir="ltr">
CHANGE CONTROLFILECOPY '/tmp/control01.ctl' UNCATALOG;
CHANGE DATAFILECOPY '/tmp/system01.dbf' UNCATALOG;
</pre></li>
<li>
<p>Optionally, view the relevant recovery catalog view, for example, <code dir="ltr">RC_DATAFILE_COPY</code> or <code dir="ltr">RC_CONTROLFILE_COPY</code>, to confirm that a given record was removed. This query confirms that the record of copy <code dir="ltr">4833</code> was removed:</p>
<pre dir="ltr">
SELECT CDF_KEY, STATUS 
FROM RC_DATAFILE_COPY 
WHERE CDF_KEY = 4833;

CDF_KEY    STATUS
---------- ------
<a id="i1008563"></a>0 rows selected.
</pre></li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006215"></a>
<div id="BRADV8172" class="sect1">
<h2 class="sect1">Deleting RMAN Backups and Archived Redo Logs</h2>
<p><a id="sthref1164"></a><a id="sthref1165"></a><a id="sthref1166"></a>You can use the <a id="sthref1167"></a><a id="sthref1168"></a>RMAN <code dir="ltr">DELETE</code> command to delete archived redo logs and RMAN backups. For backups on disk, deleting backups physically removes the backup file from disk. For backups on <a href="glossary.htm#CHDCCBFI"><span class="xrefglossterm">SBT</span></a> devices, the RMAN <code dir="ltr">DELETE</code> command instructs the media manager to delete the backup pieces or proxy copies on tape. In either case, RMAN updates the RMAN repository to reflect the deletion.</p>
<div id="BRADV89632" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1169"></a>
<h3 class="sect2">Overview of RMAN Deletion</h3>
<p>Every RMAN backup produces a corresponding record in the <a href="glossary.htm#CHDIJAIC"><span class="xrefglossterm">RMAN repository</span></a>. This record is stored in the control file. If a recovery catalog is used, then the record can also be found in the recovery catalog after the recovery catalog is resynchronized from the control file. For example, if you generate a full database backup set, then you can view the record for this backup set <a id="sthref1170"></a>in <code dir="ltr">V$BACKUP_SET</code>. If you use a recovery catalog, then you can also access the record in <a id="sthref1171"></a>the <code dir="ltr">RC_BACKUP_SET</code> catalog view.</p>
<p>The <code dir="ltr">V$</code> control file views and recovery catalog views differ in the way that they store information, and this affects how RMAN handles repository records. The recovery catalog RMAN repository is stored in actual database tables, while the control file version of the repository is stored in an internal structure in the control file.</p>
<p>When you use an RMAN command to delete a backup or archived redo log file, RMAN does the following:</p>
<ul>
<li>
<p>Removes the physical file from the operating system (if the file is still present)</p>
</li>
<li>
<p>Updates the file records in the control file to status <code dir="ltr">DELETED</code></p>
</li>
<li>
<p>Removes the file records from the recovery catalog tables (if RMAN is connected to a recovery catalog)</p>
</li>
</ul>
<p>Because of the way that control file data is stored, RMAN cannot remove the record from the control file, only update it to <code dir="ltr">DELETED</code> status. Because the recovery catalog tables are ordinary database tables, however, RMAN deletes rows from them in the same way that rows are deleted from any table.</p>
<div id="BRADV90079" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1172"></a>
<h4 class="sect3">RMAN Deletion Commands</h4>
<p><a href="#CHDDBBIJ">Table 12-1</a> describes the RMAN commands that can delete backups.<a id="sthref1173"></a><a id="sthref1174"></a></p>
<div id="BRADV295" class="tblruleformalwide">
<p class="titleintable"><a id="sthref1175"></a><a id="CHDDBBIJ"></a>Table 12-1 RMAN Deletion Commands</p>
<table class="cellalignment1945" title="RMAN Deletion Commands" summary="This table is described in the preceding text." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t20">Command</th>
<th class="cellalignment1941" id="r1c2-t20">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t20" headers="r1c1-t20">
<p><code dir="ltr">DELETE</code></p>
</td>
<td class="cellalignment1942" headers="r2c1-t20 r1c2-t20">
<p>To delete backups, update the control file records to status <code dir="ltr">DELETED</code>, and remove their records from the recovery catalog (if a recovery catalog is used).</p>
<p>You can specify that <code dir="ltr">DELETE</code> should remove backups that are <code dir="ltr">EXPIRED</code> or <code dir="ltr">OBSOLETE</code>. If you run <code dir="ltr">DELETE</code> <code dir="ltr">EXPIRED</code> on a backup that exists, then RMAN issues a warning and does not delete the backup. If you use the <code dir="ltr">DELETE</code> command with the optional <code dir="ltr">FORCE</code> keyword, then RMAN deletes the specified backups, but ignores any I/O errors, including those that occur when a backup is missing from disk or tape. It then updates the RMAN repository to reflect the fact that the backup is deleted, regardless of whether RMAN was able to delete the file or whether the file was missing.</p>
<p>RMAN uses all configured channels to perform the deletion. If you use <code dir="ltr">DELETE</code> for files on devices that are not configured for automatic channels, then you must first use <code dir="ltr">ALLOCATE CHANNEL FOR MAINTENANCE</code> command. For example, if you made a backup with the SBT channel, but only a disk channel is configured, then you must manually allocate an SBT channel for <code dir="ltr">DELETE</code>. An automatic or manually allocated maintenance channel is required when you use <code dir="ltr">DELETE</code> command on a disk-only file.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t20" headers="r1c1-t20">
<p><code dir="ltr">BACKUP</code> <code dir="ltr">...</code> <code dir="ltr">DELETE</code> <code dir="ltr">[ALL]</code> <code dir="ltr">INPUT</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t20 r1c2-t20">
<p><a id="sthref1176"></a>To back up archived logs, data file copies, or backup sets, then delete the input files from the operating system after the successful completion of the backup. RMAN also deletes and updates repository records for the deleted input files.</p>
<p>If you specify <code dir="ltr">DELETE</code> <code dir="ltr">INPUT</code> (without <code dir="ltr">ALL</code>), then RMAN deletes only the specific files that it backs up. If you specify <code dir="ltr">ALL INPUT</code>, then RMAN deletes all copies of the files recorded in the RMAN repository.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t20" headers="r1c1-t20">
<p><code dir="ltr">CHANGE</code> <code dir="ltr">...</code> <code dir="ltr">UNCATALOG</code></p>
</td>
<td class="cellalignment1942" headers="r4c1-t20 r1c2-t20">
<p>To delete recovery catalog records for specified backups and change their control file records to status <code dir="ltr">DELETED</code>. The <code dir="ltr">CHANGE</code> <code dir="ltr">...</code> <code dir="ltr">UNCATALOG</code> command only changes the RMAN repository record of backups, and does not actually delete backups.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformalwide" -->
<p>The RMAN repository record for an object can sometimes fail to reflect the physical status of the object. For example, you back up an archived redo log to disk and then use an operating system utility to delete it. If you run <code dir="ltr">DELETE</code> without first running <code dir="ltr">CROSSCHECK</code>, then the repository erroneously lists the log as <code dir="ltr">AVAILABLE</code>. See <a class="olink RCMRF121" href="../../backup.112/e10643/rcmsynta016.htm#RCMRF121"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for a description of <code dir="ltr">DELETE</code> behavior when mismatches occur between the RMAN repository and physical media.</p>
<p>If you run RMAN interactively, then RMAN asks for confirmation before deleting any files. You can suppress these confirmations by using the <code dir="ltr">NOPROMPT</code> keyword with any form of the <code dir="ltr">BACKUP</code> command:</p>
<pre dir="ltr">
DELETE NOPROMPT ARCHIVELOG ALL;
</pre></div>
<!-- class="sect3" -->
<div id="BRADV90080" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1177"></a>
<h4 class="sect3">Deletion of Archived Redo Logs</h4>
<p>As explained in <a href="#CHDFFJFJ">"Basic Concepts of Backup and Repository Maintenance"</a>, the recommended maintenance strategy is to configure a fast recovery area, a backup retention policy, and an <a href="glossary.htm#CHDGCGHA"><span class="xrefglossterm">archived redo log deletion policy</span></a>. By default, the archived redo logs deletion policy is configured to <code dir="ltr">NONE</code>. In this case, the fast recovery area considers the logs eligible for deletion if they have been backed up at least once to disk or tape or the logs are obsolete according to the backup retention policy.</p>
<p>Archived redo logs can be deleted automatically by the database or by any of the user-initiated RMAN commands listed in <a href="#CHDDBBIJ">Table 12-1</a>. For logs in the recovery area, the database retains them as long as possible and automatically deletes eligible logs when disk space is required. You can delete eligible logs from any location, inside or outside the recovery area, with <code dir="ltr">BACKUP ... DELETE INPUT</code> or <code dir="ltr">DELETE ARCHIVELOG</code>. Both of these commands obey the archive redo log deletion policy when the policy is any setting other than <code dir="ltr">NONE</code>. You can override the archived redo log deletion policy settings by using the <code dir="ltr">FORCE</code> option in the <code dir="ltr">DELETE</code> command.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmconfb.htm#CHDCFHBG">"Configuring an Archived Redo Log Deletion Policy"</a></p>
</li>
<li>
<p>The <code dir="ltr">CONFIGURE ARCHIVELOG DELETION POLICY</code> entry in <a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for detailed information about policy options</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1007589"></a>
<div id="BRADV89633" class="sect2">
<h3 class="sect2">Deleting All Backups and Copies</h3>
<p>In some circumstances, you may need to delete all backup sets, proxy copies, and image copies associated with a database. For example, you no longer need a database and want to remove all related files from the system. An image copy is a file generated with <code dir="ltr">BACKUP AS COPY</code> command, a log archived by the database, or a file cataloged with the <code dir="ltr">CATALOG</code> command.</p>
<p class="subhead2"><a id="BRADV296"></a>To delete all backups and copies:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>If necessary, allocate maintenance channels for the devices containing the backups to be deleted.</p>
<p>As explained in <a href="#CHDDBBIJ">Table 12-1</a>, RMAN uses all configured channels to perform the deletion. If channels are configured, then you do not need to manually allocate maintenance channels.</p>
</li>
<li>
<p>Crosscheck the backups and copies to ensure that the logical records are synchronized with the physical media.</p>
<pre dir="ltr">
CROSSCHECK BACKUP;
CROSSCHECK COPY;
</pre></li>
<li>
<p>Delete the backups and copies.</p>
<p>For example, enter the following commands and then enter <code dir="ltr">YES</code> when prompted:</p>
<pre dir="ltr">
DELETE BACKUP;
DELETE COPY;
</pre>
<p>If disk and tape channels are configured, then RMAN uses both the configured SBT channel and the preconfigured disk channel when deleting. RMAN prompts you for confirmation before deleting any files.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="i1006259"></a>
<div id="BRADV89634" class="sect2">
<h3 class="sect2">Deleting Specified Backups and Copies</h3>
<p><a id="i1006262"></a><a id="sthref1178"></a><a id="sthref1179"></a><a id="sthref1180"></a>You can use both the <code dir="ltr">DELETE</code> and <code dir="ltr">BACKUP ... DELETE</code> commands to delete specific backups and copies. The <code dir="ltr">BACKUP ... DELETE</code> command backs up the files first, typically to tape, and then deletes the input files afterward.</p>
<p>The <code dir="ltr">DELETE</code> command supports a wide range of options to identify objects to delete. For complete information about these options, see <a class="olink RCMRF121" href="../../backup.112/e10643/rcmsynta016.htm#RCMRF121"><span class="italic">Oracle Database Backup and Recovery Reference</span></a>. When deleting archived redo logs, RMAN uses the configured settings to determine whether a log can be deleted (see <a href="rcmconfb.htm#CHDCFHBG">"Configuring an Archived Redo Log Deletion Policy"</a>).</p>
<p class="subhead2"><a id="BRADV297"></a>To delete specified backups and copies:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>If necessary, allocate maintenance channels for the devices containing the backups to be deleted.</p>
<p>As explained in <a href="#CHDDBBIJ">Table 12-1</a>, RMAN uses all configured channels to perform the deletion. If channels are configured, then you do not need to manually allocate maintenance channels.</p>
</li>
<li>
<p>Delete the specified backups and copies.</p>
<p>The following examples show many of the common ways to specify backups and archived logs to delete with the <code dir="ltr">DELETE</code> command:</p>
<ul>
<li>
<p>Deleting backups using primary keys from <code dir="ltr">LIST</code> output:</p>
<pre dir="ltr">
DELETE BACKUPPIECE 101;
</pre></li>
<li>
<p>Deleting backups by file name on disk:</p>
<pre dir="ltr">
DELETE CONTROLFILECOPY '/tmp/control01.ctl';
</pre></li>
<li>
<p>Deleting archived redo logs:</p>
<pre dir="ltr">
DELETE NOPROMPT ARCHIVELOG UNTIL SEQUENCE 300;
</pre></li>
<li>
<p>Deleting backups based on tags:</p>
<pre dir="ltr">
DELETE BACKUP TAG 'before_upgrade';
</pre></li>
<li>
<p>Delete backups based on the objects backed up and the media or disk location where the backup is stored:</p>
<pre dir="ltr">
DELETE BACKUP OF TABLESPACE users DEVICE TYPE sbt; # delete only from tape
DELETE COPY OF CONTROLFILE LIKE '/tmp/%';
</pre></li>
<li>
<p>Delete backups and archived redo logs from disk based on whether they are backed up on tape:</p>
<pre dir="ltr">
DELETE ARCHIVELOG ALL 
   BACKED UP 3 TIMES TO sbt;
</pre></li>
</ul>
</li>
</ol>
<div id="BRADV89636" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1181"></a>
<h4 class="sect3">Deleting Specified Files with BACKUP ... DELETE</h4>
<p>You can use <code dir="ltr">BACKUP ... DELETE</code> to back up archived redo logs, data file copies, or backup sets and then delete the input files after successfully backing them up. Specifying the <code dir="ltr">DELETE INPUT</code> option is equivalent to issuing the <code dir="ltr">DELETE</code> command for the input files. As explained in <a href="rcmconfb.htm#CHDCFHBG">"Configuring an Archived Redo Log Deletion Policy"</a>, RMAN uses the configured settings to determine whether an archived redo log can be deleted.The <code dir="ltr">ALL</code> option in the <code dir="ltr">DELETE ALL INPUT</code> clause applies only to archived redo logs. If you run <code dir="ltr">BACKUP ... DELETE ALL INPUT</code>, then the command deletes all copies of corresponding archived redo logs or data file copies that match the selection criteria in the <code dir="ltr">BACKUP</code> command.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1008500"></a>
<div id="BRADV89637" class="sect2">
<h3 class="sect2">Deleting Expired RMAN Backups and Copies</h3>
<p><a id="sthref1182"></a><a id="sthref1183"></a><a id="sthref1184"></a><a id="sthref1185"></a>If you run <code dir="ltr">CROSSCHECK</code>, and if RMAN cannot locate the files, then it updates their records in the RMAN repository to <code dir="ltr">EXPIRED</code> status. You can then use the <code dir="ltr">DELETE</code> <code dir="ltr">EXPIRED</code> command to remove records of expired backups and copies from the RMAN repository.</p>
<p>The <code dir="ltr">DELETE EXPIRED</code> command issues warnings if any files marked as <code dir="ltr">EXPIRED</code> actually exist. In rare cases, the repository can mark a file as <code dir="ltr">EXPIRED</code> even though it exists. For example, a directory containing a file is corrupted at the time of the crosscheck, but is later repaired, or the media manager was not configured properly and reported some backups as not existing when they really existed.</p>
<p class="subhead2"><a id="BRADV300"></a>To delete expired repository records:</p>
<ol>
<li>
<p>If you have not performed a crosscheck recently, then issue a <code dir="ltr">CROSSCHECK</code> command. For example, issue:</p>
<pre dir="ltr">
CROSSCHECK BACKUP;
</pre></li>
<li>
<p>Delete the expired backups. For example, issue:</p>
<pre dir="ltr">
DELETE EXPIRED BACKUP;
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="i1006294"></a>
<div id="BRADV89639" class="sect2">
<h3 class="sect2">Deleting Obsolete RMAN Backups Based on Retention Policies</h3>
<p><a id="sthref1186"></a><a id="sthref1187"></a>The <a id="sthref1188"></a>RMAN <code dir="ltr">DELETE</code> command supports an <code dir="ltr">OBSOLETE</code> option, which deletes backups that are no longer needed to satisfy specified recoverability requirements. You can delete files that are obsolete according to the configured default retention policy, or another retention policy that you specify as an option to the <code dir="ltr">DELETE</code> <code dir="ltr">OBSOLETE</code> command. As with other forms of the <code dir="ltr">DELETE</code> command, the files deleted are removed from backup media, deleted from the recovery catalog, and marked as <code dir="ltr">DELETED</code> in the control file.</p>
<p>If you specify the <code dir="ltr">DELETE</code> <code dir="ltr">OBSOLETE</code> command with no arguments, then RMAN deletes all obsolete backups defined by the configured retention policy. For example:</p>
<pre dir="ltr">
DELETE OBSOLETE;
</pre>
<div id="BRADV89640" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1189"></a>
<h4 class="sect3">DELETE OBSOLETE Behavior When KEEP UNTIL TIME Expires</h4>
<p>If the <code dir="ltr">KEEP</code> <code dir="ltr">UNTIL TIME</code> period has not expired for an <a href="glossary.htm#CHDEAHIB"><span class="xrefglossterm">archival backup</span></a>, RMAN does not consider the backup as obsolete. As soon as the <code dir="ltr">KEEP UNTIL</code> period expires, however, the backup is immediately considered to be obsolete, regardless of any configured <a href="glossary.htm#i432137"><span class="xrefglossterm">backup retention policy</span></a>. Thus, <code dir="ltr">DELETE OBSOLETE</code> deletes any backup created with <code dir="ltr">BACKUP ... KEEP UNTIL TIME</code> if the <code dir="ltr">KEEP</code> time has expired.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF131" href="../../backup.112/e10643/rcmsubcl011.htm#RCMRF131"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr"><span class="codeinlineitalic">keepOption</span></code> syntax</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1009167"></a>
<div id="BRADV89641" class="sect1">
<h2 class="sect1">Dropping a Database</h2>
<p><a id="sthref1190"></a>To remove a database from the operating system, you can use <a id="sthref1191"></a><a id="sthref1192"></a>the <code dir="ltr">DROP</code> <code dir="ltr">DATABASE</code> command in RMAN. RMAN removes the server parameter file (if one is used for the database), all datafiles, online redo logs, and control files belonging to the target database.</p>
<p><code dir="ltr">DROP</code> <code dir="ltr">DATABASE</code> requires that RMAN be connected to the target database, and that the target database be mounted. The command does not require connection to the recovery catalog. If RMAN is connected to the recovery catalog, and if you specify the option <code dir="ltr">INCLUDE</code> <code dir="ltr">COPIES</code> <code dir="ltr">AND</code> <code dir="ltr">BACKUPS</code>, then RMAN also unregisters the database.</p>
<p class="subhead2"><a id="BRADV612"></a>To delete a database:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>Catalog all backups that are associated with the database. For example, the following commands catalog files in the fast recovery area, and then in a secondary archiving destination:</p>
<pre dir="ltr">
CATALOG START WITH '+disk1';    # all files from recovery area on ASM disk
CATALOG START WITH '/arch_dest2';  # all files from second archiving location
</pre></li>
<li>
<p>Delete all backups and copies associated with the database. For example:</p>
<pre dir="ltr">
DELETE BACKUPSET; # deletes all backups
DELETE COPY; # deletes all image copies (including archived logs)
</pre></li>
<li>
<p>Remove the database from the operating system.</p>
<p>The following command deletes the database and automatically unregisters it from the recovery catalog (if used). RMAN prompts for confirmation.</p>
<pre dir="ltr">
DROP DATABASE;
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="osadvsce.htm#CACFJHED">"Dropping a Database with SQL*Plus"</a> to learn how to use the SQL <code dir="ltr">DROP</code> <code dir="ltr">DATABASE</code> statement</p>
</li>
<li>
<p><a class="olink RCMRF190" href="../../backup.112/e10643/rcmsynta019.htm#RCMRF190"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for the RMAN <code dir="ltr">DROP DATABASE</code> command syntax</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1933">
<tr>
<td class="cellalignment1942">
<table class="cellalignment1938">
<tr>
<td class="cellalignment1937"><a href="rcmreprt.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1937"><a href="rcmcatdb.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1944">
<table class="cellalignment1936">
<tr>
<td class="cellalignment1937"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1937"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1937"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1937"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1937"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1937"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
