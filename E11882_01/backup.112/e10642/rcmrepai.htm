<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Diagnosing and Repairing Failures with Data Recovery Advisor</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1054" />
<meta name="description" content="A guide to backup and recovery of Oracle databases, including RMAN backup and recovery, RMAN data transfer, Oracle Flashback Technology, and user-managed backup and recovery" />
<meta name="dcterms.created" content="2015-05-13T14:1:11Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Backup and Recovery User's Guide" />
<meta name="dcterms.identifier" content="E10642-08" />
<meta name="dcterms.isVersionOf" content="BRADV" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="rcmrvcon.htm" title="Previous" type="text/html" />
<link rel="Next" href="rcmvalid.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10642.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">27/47</span> <!-- End Header -->
<div id="BRADV246" class="chapter"><a id="CHDCDHFD"></a>
<h1 class="chapter"><span class="secnum">15</span> Diagnosing and Repairing Failures with Data Recovery Advisor</h1>
<p>This chapter explains how to use the Data Recovery Advisor tool in RMAN to diagnose and repair database failures. This chapter contains the following topics:</p>
<ul>
<li>
<p><a href="#CHDDBECC">Overview of Data Recovery Advisor</a></p>
</li>
<li>
<p><a href="#CHDGCAIB">Listing Failures</a></p>
</li>
<li>
<p><a href="#CHDDJIJC">Checking for Block Corruptions by Validating the Database</a></p>
</li>
<li>
<p><a href="#CHDHADBD">Determining Repair Options</a></p>
</li>
<li>
<p><a href="#CHDGGBIH">Repairing Failures</a></p>
</li>
<li>
<p><a href="#CHDFEFID">Changing Failure Status and Priority</a></p>
</li>
</ul>
<a id="CHDDBECC"></a>
<div id="BRADV89714" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Overview of Data Recovery Advisor</h2>
<p>This section explains the purpose and basic concepts of the <a href="glossary.htm#CHDBDJFH"><span class="xrefglossterm">Data Recovery Advisor</span></a>.</p>
<div id="BRADV89715" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1380"></a>
<h3 class="sect2">Purpose of Data Recovery Advisor</h3>
<p><a id="sthref1381"></a>Data Recovery Advisor is an Oracle Database tool that automatically diagnoses data failures, determines and presents appropriate repair options, and executes repairs at the user's request. In this context, a data failure is a corruption or loss of persistent data on disk. By providing a centralized tool for automated data repair, Data Recovery Advisor improves the manageability and reliability of an Oracle database and thus helps reduce the <a id="sthref1382"></a><a href="glossary.htm#CHDEDCFG"><span class="xrefglossterm">MTTR</span></a>.</p>
<p>Diagnosing a data failure and devising an optimal strategy for repair requires a high degree of training and experience. Data Recovery Advisor provides the following advantages over traditional repair techniques:</p>
<ul>
<li>
<p>Data Recovery Advisor can potentially detect, analyze, and repair data failures <span class="italic">before</span> a database process discovers the corruption and signals an error. Early warnings help limit damage caused by corruption.</p>
</li>
<li>
<p>Manually assessing symptoms of data failures and correlating them into a problem statement can be complex, error-prone, and time-consuming. Data Recovery Advisor automatically diagnoses failures, assesses their impact, and reports these findings to the user.</p>
</li>
<li>
<p>Traditionally, users must manually determine repair options along with the repair impact. If multiple failures are present, then users must determine the right sequence of repair execution and try to consolidate repairs. In contrast, Data Recovery Advisor automatically determines the best repair options and runs checks to make sure that these options are feasible in your environment.</p>
</li>
<li>
<p>Execution of a data repair can be complex and error-prone. If you choose an automated repair option, then Data Recovery Advisor executes the repair and verifies its success.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<div id="BRADV89716" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1383"></a>
<h3 class="sect2">Basic Concepts of Data Recovery Advisor</h3>
<p>This section explains the concepts that you must familiarize yourself with before using Data Recovery Advisor.</p>
<div id="BRADV89717" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1384"></a>
<h4 class="sect3">User Interfaces to Data Recovery Advisor</h4>
<p><a id="sthref1385"></a>Data Recovery Advisor has both a command-line and GUI interface. The GUI interface is available in Oracle Enterprise Manager Database Control and Grid Control. You can click <span class="bold">Perform Recovery</span> in the Availability tab of the Database Home page to navigate to the page shown in <a href="#CHDDFDAE">Figure 15-1</a>.</p>
<div id="BRADV327" class="figure">
<p class="titleinfigure"><a id="CHDDFDAE"></a>Figure 15-1 Data Recovery Advisor</p>
<img width="750" height="386" src="img/perform_reco_11gr1.gif" alt="Description of Figure 15-1 follows" /><br />
<a id="sthref1386" href="img_text/perform_reco_11gr1.htm">Description of "Figure 15-1 Data Recovery Advisor"</a><br />
<br /></div>
<!-- class="figure" -->
<p>In the RMAN command-line interface, the Data Recovery Advisor commands are <code dir="ltr">LIST FAILURE</code>, <code dir="ltr">ADVISE FAILURE</code>, <code dir="ltr">REPAIR FAILURE</code>, and <code dir="ltr">CHANGE FAILURE</code>.</p>
<p>A <a id="sthref1387"></a><a id="sthref1388"></a><a href="glossary.htm#CHDGFDFC"><span class="xrefglossterm">failure</span></a> is detected either automatically by the database or through a manual check such as the <code dir="ltr">VALIDATE</code> command. You can use the <code dir="ltr">LIST FAILURE</code> command to view problem statements for failures and the effect of these failures on database operations. Each failure is uniquely identified by a failure number. In the same RMAN session, you can then use the <code dir="ltr">ADVISE FAILURE</code> command to view repair options, which typically include both automated and manual options.</p>
<p>After executing <code dir="ltr">ADVISE FAILURE</code>, you can either repair failures manually or run the <code dir="ltr">REPAIR FAILURE</code> command to repair the failures automatically. A <a id="sthref1389"></a><a id="sthref1390"></a><a href="glossary.htm#CHDEIABJ"><span class="xrefglossterm">repair</span></a> is an action that fixes one or more failures. Examples of repairs include <a href="glossary.htm#i432160"><span class="xrefglossterm">block media recovery</span></a>, <a href="glossary.htm#i432577"><span class="xrefglossterm">data file media recovery</span></a>, and <a href="glossary.htm#CHDHJFEH"><span class="xrefglossterm">Oracle Flashback Database</span></a>. When you choose an automated <a href="glossary.htm#CHDGCGGF"><span class="xrefglossterm">repair option</span></a>, Data Recovery Advisor verifies the repair success and closes the relevant repaired failures.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMQS093" href="../../server.112/e10897/backrest.htm#ADMQS093"><span class="italic">Oracle Database 2 Day DBA</span></a> to learn how to perform backup and recovery with Enterprise Manager</div>
</div>
<!-- class="sect3" -->
<a id="CHDCCCGD"></a>
<div id="BRADV89718" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Data Integrity Checks</h4>
<p>A checker is a diagnostic operation or procedure registered with the Health Monitor to assess the health of the database or its components. The health assessment is known as a <a id="sthref1391"></a><a id="sthref1392"></a><a href="glossary.htm#CHDEIFED"><span class="xrefglossterm">data integrity check</span></a> and can be invoked reactively or proactively.</p>
<p>Failures are normally detected reactively. A database operation involving corrupted data results in an error, which automatically invokes a data integrity check that searches the database for failures related to the error. If failures are diagnosed, then they are recorded in the <a id="sthref1393"></a><a href="glossary.htm#CHDDAHBD"><span class="xrefglossterm">Automatic Diagnostic Repository (ADR)</span></a>, which is a directory structure stored outside of the database. You can use Data Recovery Advisor to generate repair advice and repair failures only after failures have been detected by the database and stored in ADR.</p>
<p>You can also invoke a data integrity check proactively. You can execute the check through the Health Monitor, which detects and stores failures in the same way as when the checks are invoked reactively. You can also check for block corruption with<a id="sthref1394"></a><a id="sthref1395"></a><a id="sthref1396"></a> the <code dir="ltr">VALIDATE</code> and <code dir="ltr">BACKUP VALIDATE</code> commands, as explained in <a href="#CHDDJIJC">"Checking for Block Corruptions by Validating the Database"</a>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMIN11269" href="../../server.112/e25494/diag.htm#ADMIN11269"><span class="italic">Oracle Database Administrator's Guide</span></a> to learn how to use the <a id="sthref1397"></a>Health Monitor</div>
</div>
<!-- class="sect3" -->
<div id="BRADV89719" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1398"></a>
<h4 class="sect3">Failures</h4>
<p>A<a id="sthref1399"></a><a id="sthref1400"></a> <a href="glossary.htm#CHDGFDFC"><span class="xrefglossterm">failure</span></a> is a persistent data corruption that is detected by a data integrity check. A failure can manifest itself as observable symptoms such as error messages and alerts, but a failure is different from a symptom because it represents a diagnosed <a href="glossary.htm#CHDFCAFB"><span class="xrefglossterm">problem</span></a>. After a problem is diagnosed by the database as a failure, you can obtain information about the failure and potentially repair it with Data Recovery Advisor.</p>
<p>Because failure information is not stored in the database itself, the database does not need to be open or mounted for you to access it. You can view failures when the database is started in <code dir="ltr">NOMOUNT</code> mode. Thus, the availability of the control file and <a href="glossary.htm#i433280"><span class="xrefglossterm">recovery catalog</span></a> does not affect the ability to view detected failures, although it may affect the feasibility of some repairs.</p>
<p>Data Recovery Advisor can diagnose failures such as the following:</p>
<ul>
<li>
<p>Components such as datafiles and control files that are not accessible because they do not exist, do not have the correct access permissions, have been taken offline, and so on</p>
</li>
<li>
<p>Physical corruptions such as block checksum failures and invalid block header field values</p>
</li>
<li>
<p>Inconsistencies such as a data file that is older than other database files</p>
</li>
<li>
<p>I/O failures such as hardware errors, operating system driver failures, and exceeding operating system resource limits (for example, the number of open files)</p>
</li>
</ul>
<p>The Data Recovery Advisor may detect or handle some logical corruptions. In general, corruptions of this type require help from Oracle Support Services.</p>
<div id="BRADV89720" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref1401"></a>
<h5 class="sect4">Failure Status</h5>
<p>Every failure has a <a href="glossary.htm#CHDDIEID"><span class="xrefglossterm">failure status</span></a>: <code dir="ltr">OPEN</code> or <code dir="ltr">CLOSED</code>. The status of a failure is <code dir="ltr">OPEN</code> until the appropriate repair action is invoked. The status changes to <code dir="ltr">CLOSED</code> after the failure is repaired.</p>
<p>Every time you execute <code dir="ltr">LIST</code> <code dir="ltr">FAILURE</code>, Data Recovery Advisor revalidates all open failures and closes failures that no longer exist. Thus, if you fixed some failures as part of a separate procedure, or if the failures were transient problems that disappeared by themselves, running <code dir="ltr">LIST FAILURE</code> automatically closes them.</p>
<p>You can use <code dir="ltr">CHANGE FAILURE</code> to change the status of an open failure to <code dir="ltr">CLOSED</code> if you have fixed it manually. However, it makes sense to use <code dir="ltr">CHANGE FAILURE ... CLOSED</code> only if for some reason the failure was not closed automatically. If a failure still exists when you use <code dir="ltr">CHANGE</code> to close it manually, then Data Recover Advisor re-creates it with a different failure ID when the appropriate data integrity check is executed.</p>
</div>
<!-- class="sect4" -->
<div id="BRADV89721" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref1402"></a>
<h5 class="sect4">Failure Priority</h5>
<p>Every failure has <a id="sthref1403"></a><a id="sthref1404"></a>a <a href="glossary.htm#CHDICHDJ"><span class="xrefglossterm">failure priority</span></a>: <code dir="ltr">CRITICAL</code>, <code dir="ltr">HIGH</code>, or <code dir="ltr">LOW</code>. Data Recovery Advisor only assigns <code dir="ltr">CRITICAL</code> or <code dir="ltr">HIGH</code> priority to diagnosed failures.</p>
<p>Failures with <code dir="ltr">CRITICAL</code> priority require immediate attention because they make the whole database unavailable. For example, a disk containing a current control file may fail. Failures with <code dir="ltr">HIGH</code> priority make a database partly unavailable or unrecoverable and usually have to be repaired quickly. Examples include block corruptions and missing archived redo logs.</p>
<p>If a failure was assigned a <code dir="ltr">HIGH</code> priority, but the failure has little impact on database availability and recoverability, then you can downgrade the priority to <code dir="ltr">LOW</code>. A <code dir="ltr">LOW</code> priority indicates that a failure can be ignored until more important failures are fixed.</p>
<p>By default <code dir="ltr">LIST FAILURE</code> displays only failures with <code dir="ltr">CRITICAL</code> and <code dir="ltr">HIGH</code> priority. You can use the <code dir="ltr">CHANGE</code> command to change the status for <code dir="ltr">LOW</code> and <code dir="ltr">HIGH</code> failures, but you cannot change the status of <code dir="ltr">CRITICAL</code> failures. The main reason for changing a priority to <code dir="ltr">LOW</code> is to reduce the <code dir="ltr">LIST FAILURE</code> output. If a failure cannot be revalidated at this time (for example, because of another failure), then <code dir="ltr">LIST FAILURE</code> shows the failure as open.</p>
</div>
<!-- class="sect4" -->
<a id="CHDCIEDB"></a>
<div id="BRADV99975" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4">Failure Grouping</h5>
<p>For clarity, Data Recovery Advisor groups related failures together. For example, if 20 different blocks in a file are corrupted, then these failures are grouped under a single parent failure. <a id="sthref1405"></a><a id="sthref1406"></a>By default, Data Recovery Advisor lists information about the group of failures, although you can specify the <code dir="ltr">DETAIL</code> option to list information about the individual subfailures.</p>
<p>A subfailure has the same format as a failure. You can get advice on a subfailure and repair it separately or in combination with any other failure.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="CHDFFCGC"></a>
<div id="BRADV89722" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Manual Actions and Automatic Repair Options</h4>
<p><a id="sthref1407"></a><a id="sthref1408"></a>The <code dir="ltr">ADVISE FAILURE</code> command can present both manual and automatic repair options. <a id="sthref1409"></a><a id="sthref1410"></a>Data Recovery Advisor categorizes manual actions as either mandatory or optional.</p>
<p>In some cases, the only possible actions are manual. Suppose that no backups exist for a lost control file. In this case, the manual action is to execute the <code dir="ltr">CREATE CONTROLFILE</code> statement. Data Recovery Advisor presents this manual action as mandatory because no automatic repair is available. In contrast, suppose that RMAN backups exist for a missing data file. In this case, the <code dir="ltr">REPAIR FAILURE</code> command can perform the repair automatically by restoring and recovering the data file. An optional manual action would be to restore the data file if it was unintentionally renamed or moved. Data Recovery Advisor suggests optional manual actions if they might prevent a more extreme form of repair such as data file restore and recovery.</p>
<p>In contrast to manual actions, automated repairs can be performed by Data Recovery Advisor. The <code dir="ltr">ADVISE FAILURE</code> command presents an option ID for each automated repair option and summarizes the action.</p>
<p>Data Recovery Advisor performs <a id="sthref1411"></a><a id="sthref1412"></a>feasibility checks before recommending an automated repair. For example, Data Recovery Advisor checks that all backups and archived redo logs needed for media recovery are present and consistent. Data Recovery Advisor may need specific backups and archived redo logs. If the files needed for recovery are not available, then recovery is not possible.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
For performance reasons, Data Recovery Advisor does not exhaustively check every byte in every file. Thus, a feasible repair may still fail because of a corrupted backup or archived redo log file.</div>
<div id="BRADV99976" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref1413"></a>
<h5 class="sect4">Consolidated Repairs</h5>
<p>When possible, Data Recovery Advisor consolidates repairs to fix multiple failures into a single repair. <a id="sthref1414"></a><a id="sthref1415"></a>A consolidated repair may contain multiple steps.</p>
<p>Sometimes a consolidated repair is not possible, as when one failure prevents the creation of repairs for other failures. For example, the feasibility of a data file repair cannot be determined when the control file is missing. In such cases, Data Recovery Advisor generates a repair option for failures that can be repaired and prints a message stating that some selected failures cannot be repaired at this time. After executing the proposed repair, you can repeat the <code dir="ltr">LIST</code>, <code dir="ltr">ADVISE</code>, and <code dir="ltr">REPAIR</code> sequence to repair remaining failures.</p>
</div>
<!-- class="sect4" -->
<div id="BRADV89723" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref1416"></a>
<h5 class="sect4">Repair Scripts</h5>
<p>Whenever Data Recovery Advisor generates an automated repair option, it creates a script that explains which commands RMAN intends to use to repair the failure. Data Recovery Advisor prints the location of this script, which is a text file residing on the operating system. <a href="#CHDHJBFE">Example 15-1</a> shows a sample repair script, which shows how Data Recovery Advisor plans to repair the loss of data file <code dir="ltr">27</code>.</p>
<div id="BRADV328" class="example">
<p class="titleinexample"><a id="CHDHJBFE"></a>Example 15-1 Sample Repair Script</p>
<pre dir="ltr">
# restore and recover data file
sql 'alter database datafile 27 offline';
restore datafile 27;
recover datafile 27;
sql 'alter database datafile 27 online';
</pre></div>
<!-- class="example" -->
<p>If you do not want Data Recovery Advisor to automatically repair the failure, then you can copy the script, edit it, and execute it manually.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<div id="BRADV89724" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1417"></a>
<h4 class="sect3">Supported Database Configurations</h4>
<p><a id="sthref1418"></a>In the current release, Data Recovery Advisor only supports single-instance databases. Oracle Real Application Clusters (Oracle RAC) databases are not supported.</p>
<p>If a data failure occurs that brings down all Oracle RAC instances, then you can mount the database in single-instance mode and use Data Recovery Advisor to detect and repair control file, <code dir="ltr">SYSTEM</code> data file, and data dictionary failures. You can also invoke data recovery checks proactively to test other database components for data failures. This approach does not detect data failures that are local to other cluster instances, for example, an inaccessible data file.</p>
<p>In a Data Guard environment, Data Recovery Advisor cannot do the following:</p>
<ul>
<li>
<p>Use files transferred from a <a href="glossary.htm#CHDEJBIJ"><span class="xrefglossterm">physical standby database</span></a> to repair failures on a primary database</p>
</li>
<li>
<p>Diagnose and repair failures on a standby database</p>
</li>
</ul>
<p>However, if the primary database is unavailable, then Data Recovery Advisor may recommend a failover to a standby database. After the failover you can repair the old primary database. If you are using Enterprise Manager Grid Control in a Data Guard configuration, then you can initiate a failover through the Data Recovery Advisor recommendations page.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SBYDB04700" href="../../server.112/e41134/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to use RMAN in a Data Guard configuration</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<div id="BRADV89725" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1419"></a>
<h3 class="sect2">Basic Steps of Diagnosing and Repairing Failures</h3>
<p>The Data Recovery Advisor workflow begins when you either suspect or discover a failure. You can discover failures in many ways, including error messages, alerts, trace files, and failed data integrity checks. As explained in <a href="#CHDCCCGD">"Data Integrity Checks"</a>, the database can automatically diagnose failures when errors occur.</p>
<p>The basic process for responding to failures is to start an RMAN session and perform all of the following steps in the same session:</p>
<ol>
<li>
<p>List failures by running the <code dir="ltr">LIST FAILURE</code> command.</p>
<p>This task is explained in <a href="#CHDGCAIB">"Listing Failures"</a>.</p>
</li>
<li>
<p>If you suspect that failures exist that have not been automatically diagnosed by the database, then run <code dir="ltr">VALIDATE DATABASE</code> to check for corrupt blocks and missing files.</p>
<p>If <code dir="ltr">VALIDATE</code> detects a problem, then RMAN triggers execution of a failure assessment. If a failure is detected, then RMAN logs it into the Automated Diagnostic Repository, where is can be accessed by Data Recovery Advisor.</p>
<p>This task is explained in <a href="#CHDDJIJC">"Checking for Block Corruptions by Validating the Database"</a>.</p>
</li>
<li>
<p>Determine repair options by running the <code dir="ltr">ADVISE FAILURE</code> command.</p>
<p>This task is explained in <a href="#CHDHADBD">"Determining Repair Options"</a>.</p>
</li>
<li>
<p>Choose a repair option. You can repair the failures manually or run the <code dir="ltr">REPAIR FAILURE</code> command to fix them automatically.</p>
<p>This task is explained in <a href="#CHDGGBIH">"Repairing Failures"</a>.</p>
</li>
<li>
<p>Return to the first step to confirm that all failures were repaired or determine which failures remain.</p>
</li>
</ol>
<p>Performing the steps for diagnosing and repairing failures in an order that is different from the one listed in this section may result in errors.</p>
<p>If appropriate, you can use <code dir="ltr">CHANGE FAILURE</code> command at any time in the Data Recovery Advisor workflow to change the priority of a failure from <code dir="ltr">LOW</code> to <code dir="ltr">HIGH</code> or <code dir="ltr">HIGH</code> to <code dir="ltr">LOW</code>, or close a failure that has been fixed manually. This task is explained in <a href="#CHDFEFID">"Changing Failure Status and Priority"</a>.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDGCAIB"></a>
<div id="BRADV89726" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Listing Failures</h2>
<p>If you suspect or know that one or more database failures have occurred, then <a id="sthref1420"></a><a id="sthref1421"></a>use <code dir="ltr">LIST FAILURE</code> to obtain information about them. You can list all or a subset of failures and restrict output in various ways. Failures are uniquely identified by failure numbers. These numbers are not consecutive, so gaps between failure numbers have no significance.</p>
<p>The <code dir="ltr">LIST FAILURE</code> command does not execute data integrity checks to diagnose new failures; rather, it lists the results of previously executed assessments. Thus, repeatedly executing <code dir="ltr">LIST FAILURE</code> reveals new failures only if the database automatically diagnosed them in response to errors that occurred in between command executions. However, executing <code dir="ltr">LIST FAILURE</code> causes Data Recovery Advisor to revalidate all existing failures. If a user fixed failures manually, or if transient failures disappeared, then Data Recovery Advisor removes these failures from the <code dir="ltr">LIST FAILURE</code> output. If a failure cannot be revalidated at this moment (for example, because of another failure), <code dir="ltr">LIST FAILURE</code> shows the failure as open.</p>
<a id="CHDBAEAJ"></a>
<div id="BRADV89727" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Listing All Failures</h3>
<p>The easiest way to determine problems that your database is encountering is to use the <code dir="ltr">LIST FAILURE</code> command.</p>
<p class="subhead2"><a id="BRADV329"></a>To list all failures:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database. The target database instance must be started.</p>
</li>
<li>
<p>Execute the <code dir="ltr">LIST FAILURE</code> command.</p>
<p>The following example reports all failures known to Data Recovery Advisor (the output has been reformatted to fit on the page).</p>
<pre dir="ltr">
<a id="CHDFCAGD"></a>
RMAN&gt; LIST FAILURE;

List of Database Failures
=========================
 
Failure ID Priority Status    Time Detected Summary
---------- -------- --------- ------------- -------
142        HIGH     OPEN      23-APR-07     One or more non-system datafiles are missing
101        HIGH     OPEN      23-APR-07     Datafile 1: '/disk1/oradata/prod/system01.dbf' contains one or more corrupt blocks
</pre>
<p>In this example, RMAN reports two different failures: a group of missing data files and a data file with corrupt blocks. The output indicates the unique identifier for each failure (142 and 101), the priority, status, and detection time.</p>
</li>
<li>
<p>Optionally, execute <code dir="ltr">LIST FAILURE ... DETAIL</code> to list failures individually.</p>
<p>As explained in <a href="#CHDCIEDB">"Failure Grouping"</a>, Data Recovery Advisor consolidates failures when possible. Specify the <code dir="ltr">DETAIL</code> option to list failures individually. For example, if multiple block corruptions exist in a file, then specifying the <code dir="ltr">DETAIL</code> option would list each of the block corruptions. The following example lists detailed information about failure 101.</p>
<pre dir="ltr">
RMAN&gt; LIST FAILURE 101 DETAIL;

List of Database Failures
=========================
 
Failure ID Priority Status    Time Detected Summary
---------- -------- --------- ------------- -------
101        HIGH     OPEN      23-APR-07     Datafile 1: '/disk1/oradata/prod/system01.dbf' contains one or more corrupt blocks
  List of child failures for parent failure ID 101
  Failure ID Priority Status    Time Detected Summary
  ---------- -------- --------- ------------- -------
  104        HIGH     OPEN      23-APR-07     Block 56416 in datafile 1: '/disk1/oradata/prod/system01.dbf' is media corrupt
    Impact: Object BLKTEST owned by SYS might be unavailable
</pre></li>
<li>
<p>Proceed to <a href="#CHDHADBD">"Determining Repair Options"</a> to determine how to repair the failures displayed by the <code dir="ltr">LIST FAILURE</code> command.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<div id="BRADV89728" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1422"></a>
<h3 class="sect2">Listing a Subset of Failures</h3>
<p>Besides providing more verbose output, <code dir="ltr">LIST FAILURE</code> also enables you to restrict output. For example, you can execute <code dir="ltr">LIST FAILURE</code> with the <code dir="ltr">CRITICAL</code>, <code dir="ltr">HIGH</code>, <code dir="ltr">LOW</code>, or <code dir="ltr">CLOSED</code> options to list only failures with a particular status or priority. You can also exclude specified failures from the output by specifying <code dir="ltr">EXCLUDE FAILURE</code>.</p>
<p class="subhead2"><a id="BRADV330"></a>To list a subset of failures:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database. The target database instance must be started.</p>
</li>
<li>
<p>Execute <code dir="ltr">LIST FAILURE</code> with the desired options.</p>
<p>The following examples illustrate some <code dir="ltr">LIST FAILURE</code> commands:</p>
<pre dir="ltr">
LIST FAILURE LOW;
LIST FAILURE CLOSED;
LIST FAILURE EXCLUDE FAILURE 234234;
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF132" href="../../backup.112/e10643/rcmsynta027.htm#RCMRF132"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code dir="ltr">LIST FAILURE</code> command</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDDJIJC"></a>
<div id="BRADV89729" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Checking for Block Corruptions by Validating the Database</h2>
<p><a id="sthref1423"></a>As explained in <a href="#CHDCCCGD">"Data Integrity Checks"</a>, the database invokes data integrity checks reactively when a user transaction is trying to access corrupted data. In some cases, latent failures can go undetected. For example, when a <a id="sthref1424"></a>data block corruption error occurs, the database reactively execute a data integrity check that validates the block on which the error occurred and other blocks in its immediate vicinity. However, blocks outside of the vicinity may be corrupted. Also, corrupted blocks that are never read by the database are never detected by a reactive data integrity check.</p>
<p><a id="sthref1425"></a><a id="sthref1426"></a>One effective way to execute a data integrity check proactively is to run <a id="sthref1427"></a><a id="sthref1428"></a><a id="sthref1429"></a>the <code dir="ltr">VALIDATE</code> or <code dir="ltr">BACKUP VALIDATE</code> commands in RMAN. These commands can check datafiles and control files for physical and logical corruption. If RMAN discovers block corruptions, then it logs them into the Automatic Diagnostic Repository and creates one or more failures. You can then use Data Recovery Advisor to list information about the failures and repair them.</p>
<p class="subhead2"><a id="BRADV331"></a>To validate the database:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database. The target database must be mounted.</p>
</li>
<li>
<p>Validate the desired database files.</p>
<p>The following example uses <code dir="ltr">VALIDATE DATABASE</code> to check for physical and logical corruption in the whole database (partial sample output included). Because <a href="#CHDGCAIB">"Listing Failures"</a> indicates that some data files are missing, the <code dir="ltr">SKIP INACCESSIBLE</code> clause is specified. The output shows that the <code dir="ltr">system01.dbf</code> database file has one newly corrupt block (Blocks Failing) and no blocks previously marked corrupt by the database (Marked Corrupt).</p>
<pre dir="ltr">
RMAN&gt; VALIDATE CHECK LOGICAL SKIP INACCESSIBLE DATABASE;
 
Starting validate at 23-APR-07
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=103 device type=DISK
could not access datafile 28
skipping inaccessible file 28
RMAN-06060: WARNING: skipping datafile compromises tablespace USERS recoverability
RMAN-06060: WARNING: skipping datafile compromises tablespace USERS recoverability
channel ORA_DISK_1: starting validation of datafile
channel ORA_DISK_1: specifying datafile(s) for validation
input datafile file number=00001 name=/disk1/oradata/prod/system01.dbf
input datafile file number=00002 name=/disk1/oradata/prod/sysaux01.dbf
input datafile file number=00022 name=/disk1/oradata/prod/undotbs01.dbf
input datafile file number=00023 name=/disk1/oradata/prod/cwmlite01.dbf
input datafile file number=00024 name=/disk1/oradata/prod/drsys01.dbf
input datafile file number=00025 name=/disk1/oradata/prod/example01.dbf
input datafile file number=00026 name=/disk1/oradata/prod/indx01.dbf
input datafile file number=00027 name=/disk1/oradata/prod/tools01.dbf
channel ORA_DISK_1: validation complete, elapsed time: 00:00:25
List of Datafiles
=================
File Status Marked Corrupt Empty Blocks Blocks Examined High SCN
---- ------ -------------- ------------ --------------- ----------
1    FAILED 0              3536         57600           637711
  File Name: /disk1/oradata/prod/system01.dbf
  Block Type Blocks Failing Blocks Processed
  ---------- -------------- ----------------
  Data       1              41876
  Index      0              7721
  Other      0              4467
.
.
. 
File Status Marked Corrupt Empty Blocks Blocks Examined High SCN
---- ------ -------------- ------------ --------------- ----------
27   OK     0              1272         1280            400914
  File Name: /disk1/oradata/prod/tools01.dbf
  Block Type Blocks Failing Blocks Processed
  ---------- -------------- ----------------
  Data       0              0
  Index      0              0
  Other      0              8

validate found one or more corrupt blocks
See trace file /disk1/oracle/log/diag/rdbms/prod/prod/trace/prod_ora_2596.trc
 for details
channel ORA_DISK_1: starting validation of datafile
channel ORA_DISK_1: specifying datafile(s) for validation
including current control file for validation
including current SPFILE in backup set
channel ORA_DISK_1: validation complete, elapsed time: 00:00:01
List of Control File and SPFILE
===============================
File Type    Status Blocks Failing Blocks Examined
------------ ------ -------------- ---------------
SPFILE       OK     0              2
Control File OK     0              512
Finished validate at 23-APR-07
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmvalid.htm#CHDBFAIF">Chapter 16, "Validating Database Files and Backups"</a></p>
</li>
<li>
<p><a class="olink RCMRF162" href="../../backup.112/e10643/rcmsynta2024.htm#RCMRF162"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code dir="ltr">VALIDATE</code> command</p>
</li>
<li>
<p><a class="olink ADMIN11007" href="../../server.112/e25494/diag.htm#ADMIN11007"><span class="italic">Oracle Database Administrator's Guide</span></a> to learn about how Oracle Database manages diagnostic data</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CHDHADBD"></a>
<div id="BRADV89730" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Determining Repair Options</h2>
<p>Use <a id="sthref1430"></a><a id="sthref1431"></a>the <code dir="ltr">ADVISE FAILURE</code> command to display <a id="sthref1432"></a><a id="sthref1433"></a>repair options after running <code dir="ltr">LIST FAILURE</code> in an RMAN session. This command prints a summary of the failures and implicitly closes all open failures that are repaired.</p>
<p>Where appropriate, the <code dir="ltr">ADVISE FAILURE</code> command presents a list of manual and automated repair options. Manual options, which are categorized as either mandatory or optional, appear first. In some cases, an optional manual fix can avoid more extreme actions such as restoring and recovering datafiles. As a rule, use the repair technique that has the least effect on the database and the least possibility for error.</p>
<div id="BRADV89731" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1434"></a>
<h3 class="sect2">Determining Repair Options for All Failures</h3>
<p>If one or more failures exist, then you should typically use <code dir="ltr">LIST FAILURE</code> to show information about the failures and then use <code dir="ltr">ADVISE FAILURE</code> in the same RMAN session to obtain a report of your repair options.</p>
<p class="subhead2"><a id="BRADV332"></a>To determine repair options for all failures:</p>
<ol>
<li>
<p>List failures as described in <a href="#CHDBAEAJ">"Listing All Failures"</a>.</p>
</li>
<li>
<p>In the same RMAN session, execute <code dir="ltr">ADVISE FAILURE</code>.</p>
<p>The following example requests repair options for all failures known to Data Recovery Advisor and includes sample output (reformatted to fit the page).</p>
<pre dir="ltr">
<a id="CHDGAEGD"></a>
RMAN&gt; ADVISE FAILURE;
 
List of Database Failures
=========================
 
Failure ID Priority Status    Time Detected Summary
---------- -------- --------- ------------- -------
142        HIGH     OPEN      23-APR-07     One or more non-system datafiles 
                                            are missing
101        HIGH     OPEN      23-APR-07     Datafile 1: '/disk1/oradata/prod/system01.dbf' contains one or more corrupt blocks
 
analyzing automatic repair options; this may take some time
using channel ORA_DISK_1
analyzing automatic repair options complete
 
Mandatory Manual Actions
========================
no manual actions available
 
Optional Manual Actions
=======================
1. If file /disk1/oradata/prod/users01.dbf was unintentionally renamed or moved, restore it
 
Automated Repair Options
========================
Option Repair Description
------ ------------------
1      Restore and recover datafile 28; Perform block media recovery of 
       block 56416 in file 1
  Strategy: The repair includes complete media recovery with no data loss
  Repair script: /disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_660500184.hm
</pre>
<p>In the preceding example, <code dir="ltr">ADVISE FAILURE</code> reports two failures: a missing data file and a data file with corrupt blocks. The command does not list mandatory manual actions, but it suggests making sure that the missing data file was not accidentally renamed or removed. The automated repair option involves <a href="glossary.htm#i432160"><span class="xrefglossterm">block media recovery</span></a> and restoring and recovering the missing data file. <code dir="ltr">ADVISE FAILURE</code> lists the location of the repair script.</p>
<p>The following variation of the same example shows the output when the RMAN backups or archived redo logs needed for the automated repair are not available. The command <code dir="ltr">ADVISE FAILURE</code> now shows mandatory manual actions.</p>
<pre dir="ltr">
RMAN&gt; ADVISE FAILURE;
 
List of Database Failures
=========================
 
Failure ID Priority Status    Time Detected Summary
---------- -------- --------- ------------- -------
142        HIGH     OPEN      23-APR-07     One or more non-system datafiles 
                                            are missing
101        HIGH     OPEN      23-APR-07     Datafile 1: '/disk1/oradata/prod/system01.dbf' contains one or more corrupt blocks
 
analyzing automatic repair options; this may take some time
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=103 device type=DISK
analyzing automatic repair options complete
 
Mandatory Manual Actions
========================
1. If file /disk1/oradata/prod/users01.dbf was unintentionally renamed or moved, restore it
2. Contact Oracle Support Services if the preceding recommendations cannot be used, or if they do not fix the failures selected for repair
 
Optional Manual Actions
=======================
no manual actions available
 
Automated Repair Options
========================
Option Repair Description
------ ------------------
1      Perform block media recovery of block 56416 in file 1
  Strategy: The repair includes complete media recovery with no data loss
  Repair script: /disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_1863891774.hm
</pre></li>
<li>
<p>Proceed to <a href="#CHDGGBIH">"Repairing Failures"</a> to determine how to repair the failures shown in the <code dir="ltr">LIST FAILURE</code> output.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<div id="BRADV89732" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1435"></a>
<h3 class="sect2">Determining Repair Options for a Subset of Failures</h3>
<p>You can also request repair options for specific failures. You can specify failures by status (<code dir="ltr">CRITICAL</code>, <code dir="ltr">HIGH</code>, or <code dir="ltr">LOW</code>) or by failure number. You can also use <code dir="ltr">EXCLUDE FAILURE</code> to exclude one or more failures from the report.</p>
<p class="subhead2"><a id="BRADV333"></a>To determine repair options for a subset of failures:</p>
<ol>
<li>
<p>List failures as described in <a href="#CHDBAEAJ">"Listing All Failures"</a>.</p>
</li>
<li>
<p>In the same RMAN session, execute <code dir="ltr">ADVISE FAILURE</code> with the desired options.</p>
<p>The following example requests repair options for failure 101 only.</p>
<pre dir="ltr">
RMAN&gt; ADVISE FAILURE 101;
 
List of Database Failures
=========================
 
Failure ID Priority Status    Time Detected Summary
---------- -------- --------- ------------- -------
101        HIGH     OPEN      23-APR-07     Datafile 1: '/disk1/oradata/prod/system01.dbf' contains one or more corrupt blocks
 
analyzing automatic repair options; this may take some time
using channel ORA_DISK_1
analyzing automatic repair options complete
 
Mandatory Manual Actions
========================
no manual actions available
 
Optional Manual Actions
=======================
no manual actions available
 
Automated Repair Options
========================
Option Repair Description
------ ------------------
1      Perform block media recovery of block 56416 in file 1
  Strategy: The repair includes complete media recovery with no data loss
  Repair script: /disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_708819503.hm
</pre></li>
<li>
<p>Proceed to <a href="#CHDGGBIH">"Repairing Failures"</a> to determine how to repair the failures displayed by the <code dir="ltr">LIST FAILURE</code> command.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF166" href="../../backup.112/e10643/rcmsynta003.htm#RCMRF166"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code dir="ltr">ADVISE FAILURE</code> command</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDGGBIH"></a>
<div id="BRADV89733" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Repairing Failures</h2>
<p>This section explains how to use Data Recovery Advisor to repair failures automatically.</p>
<div id="BRADV89734" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1436"></a>
<h3 class="sect2">About Repairing Failures</h3>
<p>If <code dir="ltr">ADVISE FAILURE</code> suggests manual repairs, then try these first. If manual repairs are not possible, or if they do not repair all failures, then you can <a id="sthref1437"></a><a id="sthref1438"></a>use <code dir="ltr">REPAIR FAILURE</code> to automatically fix failures suggested in the most recent <code dir="ltr">ADVISE FAILURE</code> command in your current RMAN session.</p>
<p><a id="sthref1439"></a>By default, <code dir="ltr">REPAIR FAILURE</code> prompts for confirmation before it begins executing. You can suppress the confirmation prompt by specifying the <code dir="ltr">NOPROMPT</code> option. After it starts executing, the command indicates the current phase of repair. Depending on the circumstances, RMAN may prompt for a response. After executing a repair, RMAN reevaluates all existing failures on the chance that they may have been fixed during this repair.</p>
<p>Before performing a repair, it is typically advisable to preview it by specifying the <code dir="ltr">PREVIEW</code> option. RMAN does not make any repairs and generates a script with all repair actions and comments. If you do not specify a particular repair option, then RMAN uses the first repair option of the most recent <code dir="ltr">ADVISE FAILURE</code> command in the current session. By default the repair script is displayed to standard output. You can use <a id="sthref1440"></a><a id="sthref1441"></a>the <code dir="ltr">SPOOL</code> command to write the script to an editable file.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink RCMRF199" href="../../backup.112/e10643/rcmsynta2004.htm#RCMRF199"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code dir="ltr">REPAIR FAILURE</code> command</p>
</li>
<li>
<p><a class="olink RCMRF156" href="../../backup.112/e10643/rcmsynta2017.htm#RCMRF156"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code dir="ltr">SPOOL</code> command</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<div id="BRADV89735" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1442"></a>
<h3 class="sect2">Repairing a Failure</h3>
<p>By default the script is displayed to standard output. You can use the <code dir="ltr">SPOOL</code> command to write the script to an editable file.</p>
<p class="subhead2"><a id="BRADV334"></a>To repair a failure:</p>
<ol>
<li>
<p>List failures as described in <a href="#CHDBAEAJ">"Listing All Failures"</a>.</p>
</li>
<li>
<p>Display repair options as described in <a href="#CHDHADBD">"Determining Repair Options"</a>.</p>
</li>
<li>
<p>Optionally, execute <code dir="ltr">REPAIR FAILURE PREVIEW</code>.</p>
<p>The following example previews the first repair options displayed by the previous <code dir="ltr">ADVISE FAILURE</code> command in the RMAN session.</p>
<pre dir="ltr">
RMAN&gt; REPAIR FAILURE PREVIEW;
 
Strategy: The repair includes complete media recovery with no data loss
Repair script: /disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_475549922.hm
contents of repair script:
   # restore and recover data file
   sql 'alter database datafile 28 offline';
   restore datafile 28;
   recover datafile 28;
   sql 'alter database datafile 28 online';
   # block media recovery
   recover datafile 1 block 56416;
</pre></li>
<li>
<p>Execute <code dir="ltr">REPAIR FAILURE</code>.</p>
<p>The following repair restores and recovers one data file and performs block media recovery on one corrupt block. RMAN prompts for confirmation that it should perform the repair. The user-entered text is in bold.</p>
<pre dir="ltr">
RMAN&gt; REPAIR FAILURE;
 
Strategy: The repair includes complete media recovery with no data loss
Repair script: /disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_475549922.hm
contents of repair script:
   # restore and recover data file
   sql 'alter database datafile 28 offline';
   restore datafile 28;
   recover datafile 28;
   sql 'alter database datafile 28 online';
   # block media recovery
   recover datafile 1 block 56416;
 
Do you really want to execute the above repair (enter YES or NO)? <span class="bold">YES</span>
executing repair script
 
sql statement: alter database datafile 28 offline
 
Starting restore at 23-APR-07
using channel ORA_DISK_1
 
channel ORA_DISK_1: starting datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
channel ORA_DISK_1: restoring datafile 00028 to /disk1/oradata/prod/users01.dbf
channel ORA_DISK_1: reading from backup piece /disk2/PROD/backupset/2007_04_18/o1_mf_nnndf_TAG20070418T182042_32fjzd3z_.bkp
channel ORA_DISK_1: piece handle=/disk2/PROD/backupset/2007_04_18/o1_mf_nnndf_TAG20070418T182042_32fjzd3z_.bkp tag=TAG20070418T182042
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:03
Finished restore at 23-APR-07
 
Starting recover at 23-APR-07
using channel ORA_DISK_1
 
starting media recovery
media recovery complete, elapsed time: 00:00:01
 
Finished recover at 23-APR-07
 
sql statement: alter database datafile 28 online
 
Starting recover at 23-APR-07
using channel ORA_DISK_1
searching flashback logs for block images until SCN 429690
finished flashback log search, restored 1 blocks
 
starting media recovery
media recovery complete, elapsed time: 00:00:03
 
Finished recover at 23-APR-07
repair failure complete
</pre></li>
<li>
<p>Optionally, execute <code dir="ltr">LIST FAILURE</code> to confirm</p>
</li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDFEFID"></a>
<div id="BRADV89736" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Changing Failure Status and Priority</h2>
<p>In some situations, you may want to use <a id="sthref1443"></a><a id="sthref1444"></a>the <code dir="ltr">CHANGE FAILURE</code> command to alter the status or priority of a failure. For example, if a block corruption has <code dir="ltr">HIGH</code> priority, you may want to change it to <code dir="ltr">LOW</code> temporarily if the block is in a little-used tablespace.</p>
<p><a id="sthref1445"></a><a id="sthref1446"></a>If you repair a failure by a means other than the <code dir="ltr">REPAIR FAILURE</code> command, then Data Recovery Advisor closes it implicitly the next time you execute <code dir="ltr">LIST FAILURE</code>. For this reason, you do not normally need to execute the <code dir="ltr">CHANGE FAILURE ... CLOSED</code> command. You should need to use this command only if the automatic failure revalidation fails, but you believe the failure no longer exists. If you use <code dir="ltr">CHANGE FAILURE</code> to close a failure that still exists, then Data Recovery Advisor re-creates it with a different failure ID when the appropriate data integrity check is executed.</p>
<p>Typically, you specify the failures by failure number. You can also change failures in bulk by specifying <code dir="ltr">ALL</code>, <code dir="ltr">CRITICAL</code>, <code dir="ltr">HIGH</code>, or <code dir="ltr">LOW</code>. You can change a failure to <code dir="ltr">CLOSED</code> or to <code dir="ltr">PRIORITY HIGH</code> or <code dir="ltr">PRIORITY LOW</code>.</p>
<p class="subhead2"><a id="BRADV335"></a>To change the status or priority of a failure:</p>
<ol>
<li>
<p>List failures as described in <a href="#CHDBAEAJ">"Listing All Failures"</a>.</p>
<p>The following example lists one failure involving corrupt <a id="sthref1447"></a>data blocks.</p>
<pre dir="ltr">
RMAN&gt; LIST FAILURE;
 
List of Database Failures
=========================
 
Failure ID Priority Status    Time Detected Summary
---------- -------- --------- ------------- -------
142        HIGH     OPEN      23-APR-07     One or more non-system datafiles 
                                            are missing
101        HIGH     OPEN      23-APR-07     Datafile 25: '/disk1/oradata/prod/example01.dbf' contains one or more corrupt blocks
 
</pre></li>
<li>
<p>Execute <code dir="ltr">CHANGE FAILURE</code> with the desired options.</p>
<p>The following example changes the priority of a block corruption failure from <code dir="ltr">HIGH</code> to <code dir="ltr">LOW</code>.</p>
<pre dir="ltr">
<a id="CHDEAADE"></a>
RMAN&gt; CHANGE FAILURE 101 PRIORITY LOW;
 
List of Database Failures
=========================
 
Failure ID Priority Status    Time Detected Summary
---------- -------- --------- ------------- -------
101        HIGH     OPEN      23-APR-07     Datafile 25: '/disk1/oradata/prod/example01.dbf' contains one or more corrupt blocks
 
Do you really want to change the above failures (enter YES or NO)? <span class="bold">YES</span>
changed 1 failures to LOW priority
</pre></li>
<li>
<p>Optionally, execute <code dir="ltr">LIST FAILURE ALL</code> to view the change.</p>
<p>If you execute <code dir="ltr">LIST FAILURE</code> without <code dir="ltr">ALL</code>, then the command lists failures with <code dir="ltr">LOW</code> priority only if no <code dir="ltr">CRITICAL</code> or <code dir="ltr">HIGH</code> priority failures exist.</p>
<pre dir="ltr">
RMAN&gt; LIST FAILURE ALL;
 
List of Database Failures
=========================
 
Failure ID Priority Status    Time Detected Summary
---------- -------- --------- ------------- -------
142        HIGH     OPEN      23-APR-07     One or more non-system datafiles 
                                            are missing
101        LOW      OPEN      23-APR-07     Datafile 25: '/disk1/oradata/prod/example01.dbf' contains one or more corrupt blocks
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF110" href="../../backup.112/e10643/rcmsynta009.htm#RCMRF110"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code dir="ltr">CHANGE</code> command</div>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1933">
<tr>
<td class="cellalignment1942">
<table class="cellalignment1938">
<tr>
<td class="cellalignment1937"><a href="rcmrvcon.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1937"><a href="rcmvalid.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1944">
<table class="cellalignment1936">
<tr>
<td class="cellalignment1937"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1937"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1937"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1937"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1937"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1937"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
