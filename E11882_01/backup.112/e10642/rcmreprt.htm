<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Reporting on RMAN Operations</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1054" />
<meta name="description" content="A guide to backup and recovery of Oracle databases, including RMAN backup and recovery, RMAN data transfer, Oracle Flashback Technology, and user-managed backup and recovery" />
<meta name="dcterms.created" content="2015-05-13T14:1:11Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Backup and Recovery User's Guide" />
<meta name="dcterms.identifier" content="E10642-08" />
<meta name="dcterms.isVersionOf" content="BRADV" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="part_mai.htm" title="Previous" type="text/html" />
<link rel="Next" href="rcmmaint.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10642.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">22/47</span> <!-- End Header -->
<div id="BRADV8004" class="chapter"><a id="CHDDBJHC"></a>
<h1 class="chapter"><span class="secnum">11</span> Reporting on RMAN Operations</h1>
<p><a id="sthref994"></a><a id="sthref995"></a><a id="sthref996"></a>This chapter describes how to report on RMAN operations. This chapter contains the following topics:</p>
<ul>
<li>
<p><a href="#CHDFDIJJ">Overview of RMAN Reporting</a></p>
</li>
<li>
<p><a href="#CHDIDAEC">Listing Backups and Recovery-Related Objects</a></p>
</li>
<li>
<p><a href="#i1008987">Reporting on Backups and Database Schema</a></p>
</li>
<li>
<p><a href="#CHDBIGHG">Using V$ Views to Query Backup Metadata</a></p>
</li>
<li>
<p><a href="#CHDIJDEF">Querying Recovery Catalog Views</a></p>
</li>
</ul>
<a id="CHDFDIJJ"></a>
<div id="BRADV8135" class="sect1">
<h2 class="sect1">Overview of RMAN Reporting</h2>
<p>This section explains the purpose and basic concepts of RMAN reporting.</p>
<div id="BRADV89582" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref997"></a>
<h3 class="sect2">Purpose of RMAN Reporting</h3>
<p>As part of your backup and recovery strategy, you should periodically run reports that indicate what you have backed up. You should determine which datafiles need backups or which files have not been backed up recently. Also, you can preview which backups RMAN would need to restore if a problem were to occur.</p>
<p>Another important aspect of backup and recovery is monitoring space usage. If you back up to disk, then it is possible for the disk to fill, which can create performance problems or even cause the database to halt. You can use RMAN to determine whether a backup is an <a href="glossary.htm#CHDIAGEJ"><span class="xrefglossterm">obsolete backup</span></a> and can therefore be deleted.</p>
<p>You may also need to obtain historical information about RMAN jobs. For example, you may want to know how many backup jobs have been issued, the status of each backup job (for example, whether it failed or completed), when a job started and finished, and what type of backup was performed.</p>
</div>
<!-- class="sect2" -->
<div id="BRADV89583" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref998"></a>
<h3 class="sect2">Basic Concepts of RMAN Reporting</h3>
<p>RMAN always stores its <a href="glossary.htm#CHDIJAIC"><span class="xrefglossterm">RMAN repository</span></a> of metadata in the control file of each target database on which it performs operations. For example, suppose that you use RMAN to back up the <code dir="ltr">prod1</code> and <code dir="ltr">prod2</code> databases. RMAN stores the metadata for backups of <code dir="ltr">prod1</code> in the control file of <code dir="ltr">prod1</code>, and the metadata for backups of <code dir="ltr">prod2</code> in the control file of <code dir="ltr">prod2</code>.</p>
<p>Optionally, you can use RMAN with a <a href="glossary.htm#i433280"><span class="xrefglossterm">recovery catalog</span></a>. In this case, RMAN maintains an additional repository of metadata in a set of tables in a separate <a href="glossary.htm#i433287"><span class="xrefglossterm">recovery catalog database</span></a>. For example, you could create a recovery catalog in <code dir="ltr">prod3</code>. You can register multiple target databases in this recovery catalog. For example, if you register <code dir="ltr">prod1</code> and <code dir="ltr">prod2</code> in the recovery catalog stored in <code dir="ltr">prod3</code>, then RMAN stores metadata about its backups of <code dir="ltr">prod1</code> and <code dir="ltr">prod2</code> in the <a href="glossary.htm#CHDCCBAG"><span class="xrefglossterm">recovery catalog schema</span></a>.</p>
<p>You can access metadata from the RMAN repository in several different ways:</p>
<ul>
<li>
<p><a id="sthref999"></a><a id="sthref1000"></a><a id="sthref1001"></a><a id="sthref1002"></a><a id="sthref1003"></a>The RMAN <code dir="ltr">LIST</code> and <code dir="ltr">REPORT</code> commands provide extensive information about available backups and how they can be used to restore and recover your database.</p>
<p>The <code dir="ltr">LIST</code> command is described in <a href="#CHDIDAEC">"Listing Backups and Recovery-Related Objects"</a> and <code dir="ltr">REPORT</code> is described in <a href="#i1008987">"Reporting on Backups and Database Schema"</a>.</p>
</li>
<li>
<p>When the database is open, several <code dir="ltr">V$</code> views provide direct access to RMAN repository records in the control file of each target database.</p>
<p>Some <code dir="ltr">V$</code> views such <a id="sthref1004"></a><a id="sthref1005"></a><a id="sthref1006"></a>as <code dir="ltr">V$DATAFILE_HEADER</code>, <code dir="ltr">V$PROCESS</code>, and <code dir="ltr">V$SESSION</code> contain information not found in the recovery catalog views. The <code dir="ltr">V$</code> views are documented in <a class="olink REFRN" href="../../server.112/e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a>.</p>
</li>
<li>
<p><a id="sthref1007"></a>If your database is registered in a recovery catalog, then <code dir="ltr">RC_</code> views provide direct access to the RMAN repository data stored in the recovery catalog.</p>
<p>The <code dir="ltr">RC_</code> views mostly correspond to the <code dir="ltr">V$</code> views. The <code dir="ltr">RC_</code> views are documented in <a class="olink RCMRF003" href="../../backup.112/e10643/rcviews.htm#RCMRF003"><span class="italic">Oracle Database Backup and Recovery Reference</span></a>.</p>
</li>
<li>
<p><a id="sthref1008"></a><a id="sthref1009"></a><a id="sthref1010"></a><a id="sthref1011"></a>The <code dir="ltr">RESTORE</code> <code dir="ltr">... PREVIEW</code> and <code dir="ltr">RESTORE ... VALIDATE HEADER</code> commands list the backups that RMAN can restore to the specified time.</p>
<p><code dir="ltr">RESTORE ... PREVIEW</code> queries the metadata but does not read the backup files. The <code dir="ltr">RESTORE ... VALIDATE HEADER</code> command performs the same work, but in addition to listing the files needed for restore and recovery operations, the command validates the backup file headers to determine whether the files on disk or in the media management catalog correspond to the metadata in the RMAN repository. These commands are documented in <a href="rcmcomre.htm#CFADHADH">"Previewing Backups Used in Restore Operations"</a>.</p>
</li>
</ul>
<p>As explained in <a href="rcmmaint.htm#h1016888">Chapter 12, "Maintaining RMAN Backups and Repository&nbsp;Records,"</a> the RMAN repository can sometimes fail to reflect the reality on disk and tape. For example, a user may delete a backup with an operating system utility, so that the RMAN repository incorrectly reports the backup as available.</p>
<p>You can use commands such as <code dir="ltr">CHANGE</code>, <code dir="ltr">CROSSCHECK</code>, and <code dir="ltr">DELETE</code> to update the RMAN repository to reflect the actual state of available backups. Otherwise, the output of the commands and views may be misleading, which means that RMAN may not be able to find the backups to restore and recover your database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmmaint.htm#i1007384">"Crosschecking the RMAN Repository"</a> to learn how to keep the RMAN repository current</p>
</li>
<li>
<p><a class="olink RCMRF132" href="../../backup.112/e10643/rcmsynta027.htm#RCMRF132"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">LIST</code> syntax</p>
</li>
<li>
<p><a class="olink RCMRF147" href="../../backup.112/e10643/rcmsynta2006.htm#RCMRF147"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">REPORT</code> syntax</p>
</li>
<li>
<p><a class="olink RCMRF149" href="../../backup.112/e10643/rcmsynta2008.htm#RCMRF149"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">RESTORE</code> syntax</p>
</li>
</ul>
</div>
<a id="CHDFBDHA"></a>
<div id="BRADV89584" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Reporting in a Data Guard Environment</h4>
<p><a id="sthref1012"></a>As explained in <a href="rcmarchi.htm#CHDHJFAB">"RMAN File Management in a Data Guard Environment"</a>, every backup is associated with the primary or standby database that created it. For example, if you backed up the database with <a id="sthref1013"></a>the <code dir="ltr">DB_UNIQUE_NAME</code> of <code dir="ltr">standby1</code>, then the <code dir="ltr">standby1</code> database is associated with this backup.</p>
<p>In a Data Guard environment, you can use the <code dir="ltr">LIST</code>, <code dir="ltr">REPORT</code>, and <code dir="ltr">SHOW</code> commands just as you can when not using Data Guard. You can run these commands with the <code dir="ltr">FOR DB_UNIQUE_NAME</code> clause to show the backups associated with a specified database. For example, the following command lists archived redo logs associated only with <code dir="ltr">sfstandby</code>:</p>
<pre dir="ltr">
LIST ARCHIVELOG ALL FOR DB_UNIQUE_NAME sfstandby;
</pre>
<p>If you use the <code dir="ltr">LIST</code>, <code dir="ltr">REPORT</code>, and <code dir="ltr">SHOW</code> commands in a Data Guard environment <span class="italic">without</span> specifying the <code dir="ltr">FOR DB_UNIQUE_NAME</code> clause, then RMAN shows the files that are accessible to the target database. <a href="rcmarchi.htm#CHDFAIBH">"Association of Backups in a Data Guard Environment"</a> explains when backups are considered accessible to RMAN.</p>
<p>In a Data Guard environment, you must use RMAN with a recovery catalog. RMAN stores the metadata for all backup and recovery files in the Data Guard environment in the recovery catalog. When running the RMAN reporting commands, you can either connect RMAN as <code dir="ltr">TARGET</code> to a mounted or open database, or identify the database with the <code dir="ltr">SET DBID</code> command.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SBYDB04700" href="../../server.112/e41134/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to report on RMAN operations in a Data Guard environment</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDIDAEC"></a>
<div id="BRADV8136" class="sect1">
<h2 class="sect1">Listing Backups and Recovery-Related Objects</h2>
<p>The <a id="sthref1014"></a><a id="sthref1015"></a><a id="sthref1016"></a><a id="sthref1017"></a><code dir="ltr">LIST</code> command uses the information in the RMAN repository to provide lists of backups and other objects relating to backup and recovery. This section contains the following topics:</p>
<ul>
<li>
<p><a href="#i1008720">About the LIST Command</a></p>
</li>
<li>
<p><a href="#i1008733">Listing All Backups and Copies</a></p>
</li>
<li>
<p><a href="#i1035423">Listing Selected Backups and Copies</a></p>
</li>
<li>
<p><a href="#i1035635">Listing Database Incarnations</a></p>
</li>
</ul>
<a id="i1008720"></a>
<div id="BRADV89585" class="sect2">
<h3 class="sect2">About the LIST Command</h3>
<p><a id="sthref1018"></a><a id="sthref1019"></a>The primary purpose of the <code dir="ltr">LIST</code> command is to list backup and copies. For example, you can list:</p>
<ul>
<li>
<p>Backups and proxy copies of a database, tablespace, data file, archived redo log, or control file</p>
</li>
<li>
<p>Backups that have expired</p>
</li>
<li>
<p>Backups restricted by time, path name, device type, tag, or recoverability</p>
</li>
<li>
<p>Archived redo log files and disk copies</p>
</li>
</ul>
<p>Besides backups and copies, RMAN can list other types of data. <a href="#CIHCGEIG">Table 11-1</a> summarizes several useful objects that you can list.</p>
<div id="BRADV274" class="tblruleformalwide">
<p class="titleintable"><a id="sthref1020"></a><a id="CIHCGEIG"></a>Table 11-1 LIST Objects</p>
<table class="cellalignment1945" title="LIST Objects" summary="LIST options" dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t4">Contents of List</th>
<th class="cellalignment1941" id="r1c2-t4">Command</th>
<th class="cellalignment1941" id="r1c3-t4">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t4" headers="r1c1-t4">
<p>Backup sets and proxy copies</p>
</td>
<td class="cellalignment1942" headers="r2c1-t4 r1c2-t4">
<p><code dir="ltr">LIST BACKUP</code></p>
</td>
<td class="cellalignment1942" headers="r2c1-t4 r1c3-t4">
<p>You can list all backup sets, copies, and proxy copies of a database, tablespace, data file, archived redo log, control file, or server parameter file.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t4" headers="r1c1-t4">
<p>Image copies</p>
</td>
<td class="cellalignment1942" headers="r3c1-t4 r1c2-t4">
<p><code dir="ltr">LIST COPY</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t4 r1c3-t4">
<p>You can list data file copies and archived redo log files. By default, <code dir="ltr">LIST COPY</code> displays copies of all database files and archived redo logs. Both usable and unusable image copies are included in the output, even those that cannot be restored or are expired or unavailable.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t4" headers="r1c1-t4">
<p>Archived redo log files</p>
</td>
<td class="cellalignment1942" headers="r4c1-t4 r1c2-t4">
<p><code dir="ltr">LIST ARCHIVELOG</code></p>
</td>
<td class="cellalignment1942" headers="r4c1-t4 r1c3-t4">
<p>You can list archive redo log files. You can list all archive log redo log files or specify individual archive log files through SCN, time, or sequence number ranges. If you specify a range you can further restrict the list returned by specifying an incarnation number.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r5c1-t4" headers="r1c1-t4">
<p>Database incarnations</p>
</td>
<td class="cellalignment1942" headers="r5c1-t4 r1c2-t4">
<p><code dir="ltr">LIST INCARNATION</code></p>
</td>
<td class="cellalignment1942" headers="r5c1-t4 r1c3-t4">
<p>You can list all incarnations of a database. A new database <a href="glossary.htm#i432741"><span class="xrefglossterm">incarnation</span></a> is created when you open with the <code dir="ltr">RESETLOGS</code> option.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r6c1-t4" headers="r1c1-t4">
<p>Databases in a Data Guard environment</p>
</td>
<td class="cellalignment1942" headers="r6c1-t4 r1c2-t4">
<p><code dir="ltr">LIST DB_UNIQUE_NAME</code></p>
</td>
<td class="cellalignment1942" headers="r6c1-t4 r1c3-t4">
<p>A database in a Data Guard environment is distinguished by its <code dir="ltr">DB_UNIQUE_NAME</code> initialization parameter setting. You can list all databases that have the same DBID.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r7c1-t4" headers="r1c1-t4">
<p>Backups and copies for a primary or standby database in a Data Guard environment</p>
</td>
<td class="cellalignment1942" headers="r7c1-t4 r1c2-t4">
<p><code dir="ltr">LIST ... FOR DB_UNIQUE_NAME</code></p>
</td>
<td class="cellalignment1942" headers="r7c1-t4 r1c3-t4">
<p>You can list all backups and copies for a specified database in a Data Guard environment or for all databases in the environment.</p>
<p>RMAN restricts the output to files or objects associated exclusively with the database with the specified <code dir="ltr">DB_UNIQUE_NAME</code>. For example, you can use <code dir="ltr">LIST</code> with <code dir="ltr">FOR DB_UNIQUE_NAME</code> to display the list of archived redo log files associated with a particular standby or primary database. Objects that are not owned by any database (<code dir="ltr">SITE_KEY</code> column in the recovery catalog view is null) are not listed.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r8c1-t4" headers="r1c1-t4">
<p>Restore points</p>
</td>
<td class="cellalignment1942" headers="r8c1-t4 r1c2-t4">
<p><code dir="ltr">LIST RESTORE POINT</code></p>
</td>
<td class="cellalignment1942" headers="r8c1-t4 r1c3-t4">
<p>You can list restore points known to the RMAN repository.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r9c1-t4" headers="r1c1-t4">
<p>Names of stored scripts</p>
</td>
<td class="cellalignment1942" headers="r9c1-t4 r1c2-t4">
<p><code dir="ltr">LIST SCRIPT NAMES</code></p>
</td>
<td class="cellalignment1942" headers="r9c1-t4 r1c3-t4">
<p>You can list the names of recovery catalog scripts created with the <code dir="ltr">CREATE SCRIPT</code> or <code dir="ltr">REPLACE SCRIPT</code> command. A recovery catalog is required.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r10c1-t4" headers="r1c1-t4">
<p>Failures for use with <a id="sthref1021"></a><a href="glossary.htm#CHDBDJFH"><span class="xrefglossterm">Data Recovery Advisor</span></a></p>
</td>
<td class="cellalignment1942" headers="r10c1-t4 r1c2-t4">
<p><code dir="ltr">LIST FAILURE</code></p>
</td>
<td class="cellalignment1942" headers="r10c1-t4 r1c3-t4">
<p>A <a href="glossary.htm#CHDGFDFC"><span class="xrefglossterm">failure</span></a> is a persistent data corruption mapped to a <a href="glossary.htm#CHDGCGGF"><span class="xrefglossterm">repair option</span></a>. <a href="rcmrepai.htm#CHDCDHFD">Chapter 15, "Diagnosing and Repairing Failures with Data Recovery Advisor"</a> explains how to use <code dir="ltr">LIST FAILURE</code> with the <code dir="ltr">ADVISE</code> and <code dir="ltr">REPAIR</code> commands.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformalwide" -->
<p>The <code dir="ltr">LIST</code> command supports several options that control how output is displayed. <a href="#CIHJDIAB">Table 11-2</a> summarizes the most common <code dir="ltr">LIST</code> options.</p>
<div id="BRADV275" class="tblruleformalwide">
<p class="titleintable"><a id="sthref1022"></a><a id="CIHJDIAB"></a>Table 11-2 Most Common LIST Options</p>
<table class="cellalignment1945" title="Most Common LIST Options" summary="LIST options" dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t5">LIST Option</th>
<th class="cellalignment1941" id="r1c2-t5">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t5" headers="r1c1-t5">
<p><code dir="ltr">LIST EXPIRED</code></p>
</td>
<td class="cellalignment1942" headers="r2c1-t5 r1c2-t5">
<p>Lists backups or copies that are recorded in the RMAN repository but that were not present at the expected location on disk or tape during the most recent <a href="glossary.htm#i432441"><span class="xrefglossterm">crosscheck</span></a>. Such backups may have been deleted outside of RMAN.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t5" headers="r1c1-t5">
<p><code dir="ltr">LIST ... BY FILE</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t5 r1c2-t5">
<p>Lists backups of each data file, archived redo log file, control file, and server parameter file. Each row describes a backup of a file.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t5" headers="r1c1-t5">
<p><code dir="ltr">LIST ... SUMMARY</code></p>
</td>
<td class="cellalignment1942" headers="r4c1-t5 r1c2-t5">
<p>Provides a one-line summary of each backup.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformalwide" -->
<p>The <code dir="ltr">LIST</code> objects and options are not exhausted by the contents of the preceding tables. For example, you can list backups restricted by time, path name, device type, tag, or recoverability.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF132" href="../../backup.112/e10643/rcmsynta027.htm#RCMRF132"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for a complete description of the <code dir="ltr">LIST</code> command</div>
</div>
<!-- class="sect2" -->
<a id="i1008733"></a>
<div id="BRADV89586" class="sect2">
<h3 class="sect2">Listing All Backups and Copies</h3>
<p>Specify the desired objects with the <code dir="ltr"><span class="codeinlineitalic">listObjList</span></code> or <code dir="ltr"><span class="codeinlineitalic">recordSpec</span></code> clause (refer to <a class="olink RCMRF132" href="../../backup.112/e10643/rcmsynta027.htm#RCMRF132"><span class="italic">Oracle Database Backup and Recovery Reference</span></a>). If you do not specify an object, then RMAN displays copies of all database files and archived redo log files.</p>
<p>By default, RMAN serially lists each backup or proxy copy and then identifies the files included in the backup. You can also list backups by file.</p>
<p>By default, RMAN lists in verbose mode, which means that it provides extensive, multiline information. You can also list backups in a summary mode if the verbose mode generates too much output.</p>
<p class="subhead2"><a id="BRADV276"></a>To list backups and copies:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>To view a summary report of all backups and copies, execute the <code dir="ltr">LIST</code> command with the <code dir="ltr">SUMMARY</code> option.</p>
<p>The following command prints a summary of all RMAN backups:</p>
<pre dir="ltr">
LIST BACKUP SUMMARY;
</pre>
<p>Sample output follows:</p>
<pre dir="ltr">
List of Backups
===============
Key     TY LV S Device Type Completion Time #Pieces #Copies Compressed Tag
------- -- -- - ----------- --------------- ------- ------- ---------- ---
1       B  A  A SBT_TAPE    21-OCT-07       1       1       NO         TAG20071021T094505
2       B  F  A SBT_TAPE    21-OCT-07       1       1       NO         TAG20071021T094513
3       B  A  A SBT_TAPE    21-OCT-07       1       1       NO         TAG20071021T094624
4       B  F  A SBT_TAPE    21-OCT-07       1       1       NO         TAG20071021T094639
5       B  F  A DISK        04-NOV-07       1       1       YES        TAG20071104T195949
</pre></li>
<li>
<p>To view verbose output for backups and copies, execute the <code dir="ltr">LIST</code> command without the <code dir="ltr">SUMMARY</code> option.</p>
<p>The following commands list RMAN backups and copies with the default verbose output:</p>
<pre dir="ltr">
LIST BACKUP;
LIST COPY;
</pre>
<p>Sample output for <code dir="ltr">LIST BACKUP</code> and <code dir="ltr">LIST COPY</code> follows:</p>
<pre dir="ltr">
List of Backup Sets
===================

BS Key  Size       Device Type Elapsed Time Completion Time
------- ---------- ----------- ------------ ---------------
7       136M       DISK        00:00:20     04-NOV-06      
        BP Key: 7   Status: AVAILABLE  Compressed: NO  Tag: TAG20071104T200759
        Piece Name: /d2/RDBMS/backupset/2007_11_04/o1_mf_annnn_TAG20071104T200759_ztjxx3k8_.bkp

  List of Archived Logs in backup set 7
  Thrd Seq     Low SCN    Low Time  Next SCN   Next Time
  ---- ------- ---------- --------- ---------- ---------
  1    1       173832     21-OCT-06 174750     21-OCT-06
  1    2       174750     21-OCT-06 174755     21-OCT-06
  1    3       174755     21-OCT-06 174758     21-OCT-06

BS Key  Type LV Size       Device Type Elapsed Time Completion Time
------- ---- -- ---------- ----------- ------------ ---------------
8       Full    2M         DISK        00:00:01     04-NOV-06      
        BP Key: 8   Status: AVAILABLE  Compressed: NO  Tag: TAG20071104T200829
        Piece Name: /disk1/oracle/dbs/c-774627068-20071104-01
  Controlfile Included: Ckp SCN: 631510       Ckp time: 04-NOV-06
  SPFILE Included: Modification time: 21-OCT-06
</pre>
<pre dir="ltr">
List of Datafile Copies
=======================
 
Key     File S Completion Time Ckp SCN    Ckp Time
------- ---- - --------------- ---------- ---------------
1       7    A 11-OCT-06       360072     11-OCT-06
        Name: /work/orcva/RDBMS/datafile/o1_mf_tbs_2_2lv7bf82_.dbf
        Tag: DF7COPY
 
2       8    A 11-OCT-06       360244     11-OCT-06
        Name: /work/orcva/RDBMS/datafile/o1_mf_tbs_2_2lv7qmcj_.dbf
        Tag: TAG20071011T184835
 
List of Control File Copies
===========================
 
Key     S Completion Time Ckp SCN    Ckp Time
------- - --------------- ---------- ---------------
3       A 11-OCT-06       360380     11-OCT-06
        Name: /d2/RDBMS/controlfile/o1_mf_TAG20071011T185335_2lv80zqd_.ctl
        Tag: TAG20071011T185335
 
List of Archived Log Copies for database with db_unique_name RDBMS
=====================================================================
 
Key     Thrd Seq     S Low Time
------- ---- ------- - ---------
1       1    1       A 11-OCT-06
        Name: /work/arc_dest/arcr_1_1_603561743.arc
 
2       1    2       A 11-OCT-06
        Name: /work/arc_dest/arcr_1_2_603561743.arc
 
3       1    3       A 11-OCT-06
        Name: /work/arc_dest/arcr_1_3_603561743.arc
</pre></li>
<li>
<p>To list backups by file, execute <code dir="ltr">LIST</code> with the <code dir="ltr">BY</code> <code dir="ltr">FILE</code> option, specifying the desired objects to list and options. For example, you can enter:</p>
<pre dir="ltr">
LIST BACKUP BY FILE;
</pre>
<p>Sample output follows:</p>
<pre dir="ltr">
List of Datafile Backups
========================

File Key     TY LV S Ckp SCN    Ckp Time  #Pieces #Copies Compressed Tag
---- ------- -  -- - ---------- --------- ------- ------- ---------- ---
1    5       B  F  A 631092     04-NOV-06 1       1       YES        TAG20071104T195949
     2       B  F  A 175337     21-OCT-06 1       1       NO         TAG20071021T094513
2    5       B  F  A 631092     04-NOV-06 1       1       YES        TAG20071104T195949
     2       B  F  A 175337     21-OCT-06 1       1       NO         TAG20071021T094513

<span class="italic">... some rows omitted</span>

List of Archived Log Backups
============================

Thrd Seq     Low SCN    Low Time  BS Key  S #Pieces #Copies Compressed Tag
---- ------- ---------- --------- ------- - ------- ------- ---------- ---
1    1       173832     21-OCT-06 7       A 1       1       NO         TAG20071104T200759
                                  1       A 1       1       NO         TAG20071021T094505
1    2       174750     21-OCT-06 7       A 1       1       NO         TAG20071104T200759
                                  1       A 1       1       NO         TAG20071021T094505
<span class="italic">... some rows omitted</span>
1    38      575472     03-NOV-06 7       A 1       1       NO         TAG20071104T200759
1    39      617944     04-NOV-06 7       A 1       1       NO         TAG20071104T200759


List of Controlfile Backups
===========================
CF Ckp SCN Ckp Time  BS Key  S #Pieces #Copies Compressed Tag
---------- --------- ------- - ------- ------- ---------- ---
631510     04-NOV-06 8       A 1       1       NO         TAG20071104T200829
631205     04-NOV-06 6       A 1       1       NO         TAG20071104T200432

List of SPFILE Backups
======================
Modification Time BS Key  S #Pieces #Copies Compressed Tag
----------------- ------- - ------- ------- ---------- ---
21-OCT-06         8       A 1       1       NO         TAG20071104T200829
21-OCT-06         6       A 1       1       NO         TAG20071104T200432
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF132" href="../../backup.112/e10643/rcmsynta027.htm#RCMRF132"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for an explanation of the various column headings in the <code dir="ltr">LIST</code> output</div>
</div>
<!-- class="sect2" -->
<a id="i1035423"></a>
<div id="BRADV89589" class="sect2">
<h3 class="sect2">Listing Selected Backups and Copies</h3>
<p>You can specify several different conditions to narrow your <code dir="ltr">LIST</code> output.</p>
<p class="subhead2"><a id="BRADV277"></a>To list selected backups and copies:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>Run <code dir="ltr">LIST</code> <code dir="ltr">COPY</code> or <code dir="ltr">LIST</code> <code dir="ltr">BACKUP</code> with the <code dir="ltr"><span class="codeinlineitalic">listObjList</span></code> or <code dir="ltr"><span class="codeinlineitalic">recordSpec</span></code> clause. For example, enter any of the following commands:</p>
<pre dir="ltr">
# lists backups of all files in database
LIST BACKUP OF DATABASE; 
# lists copy of specified datafile    
LIST COPY OF DATAFILE 'ora_home/oradata/trgt/system01.dbf'; 
# lists specified backup set
LIST BACKUPSET 213; 
# lists datafile copy
LIST DATAFILECOPY '/tmp/tools01.dbf';
</pre>
<pre dir="ltr">
</pre>
<p>You can also restrict the search by specifying the <code dir="ltr"><span class="codeinlineitalic">maintQualifier</span></code> or <code dir="ltr">RECOVERABLE</code> clause. For example, enter any of the following commands:</p>
<pre dir="ltr">
# specify a backup set by tag
LIST BACKUPSET TAG 'weekly_full_db_backup';
# specify a backup or copy by device type
LIST COPY OF DATAFILE 'ora_home/oradata/trgt/system01.dbf' DEVICE TYPE sbt;
# specify a backup by directory or path
LIST BACKUP LIKE '/tmp/%';
# specify a backup or copy by a range of completion dates
LIST COPY OF DATAFILE 2 COMPLETED BETWEEN '10-DEC-2002' AND '17-DEC-2002';
# specify logs backed up at least twice to tape
LIST ARCHIVELOG ALL BACKED UP 2 TIMES TO DEVICE TYPE sbt;
</pre>
<pre dir="ltr">
</pre></li>
<li>
<p>Examine the output.</p>
<p>The output depends upon the options that you pass to the <code dir="ltr">LIST</code> command. For example, the following lists copies of data file <code dir="ltr">1</code> contained in backup sets.</p>
<pre dir="ltr">
RMAN&gt; LIST BACKUP OF DATAFILE 1;

List of Backup Sets
===================

BS Key  Type LV Size       Device Type Elapsed Time Completion Time
------- ---- -- ---------- ----------- ------------ ---------------
2       Full    230M       SBT_TAPE    00:00:49     21-OCT-06
        BP Key: 2   Status: AVAILABLE  Compressed: NO  Tag: TAG20071021T094513
        Handle: 02f4eatc_1_1   Media: /smrdir
  List of Datafiles in backup set 2
  File LV Type Ckp SCN    Ckp Time  Name
  ---- -- ---- ---------- --------- ----
  1       Full 175337     21-OCT-06 /oracle/dbs/tbs_01.f

BS Key  Type LV Size       Device Type Elapsed Time Completion Time
------- ---- -- ---------- ----------- ------------ ---------------
5       Full    233M       DISK        00:04:30     04-NOV-06
        BP Key: 5   Status: AVAILABLE  Compressed: NO  Tag: TAG20071104T195949
        Piece Name: /disk1/2007_11_04/o1_mf_nnndf_TAG20071104T195949_ztjxfvgz_.bkp
  List of Datafiles in backup set 5
  File LV Type Ckp SCN    Ckp Time  Name
  ---- -- ---- ---------- --------- ----
  1       Full 631092     04-NOV-06 /oracle/dbs/tbs_01.f
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink RCMRF133" href="../../backup.112/e10643/rcmsubcl012.htm#RCMRF133"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr"><span class="codeinlineitalic">listObjList</span></code> and <code dir="ltr"><span class="codeinlineitalic">recordSpec</span></code> syntax</p>
</li>
<li>
<p><a class="olink RCMRF132" href="../../backup.112/e10643/rcmsynta027.htm#RCMRF132"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for an explanation of the columns in the <code dir="ltr">LIST</code> output</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i1035635"></a>
<div id="BRADV89591" class="sect2">
<h3 class="sect2">Listing Database Incarnations</h3>
<p>Each time an <code dir="ltr">OPEN</code> <code dir="ltr">RESETLOGS</code> operation is performed on a database, this operation creates a <a id="sthref1023"></a><a id="sthref1024"></a>new <a href="glossary.htm#i432741"><span class="xrefglossterm">incarnation</span></a> of the database. Database incarnations and their effect on database recovery are explained in <a href="rcmrvcon.htm#BGBBAJII">"Database Incarnations"</a>.</p>
<p>When performing incremental backups, RMAN can use a backup from a previous incarnation or the current incarnation as a basis for subsequent incremental backups. When performing restore and recovery operations, RMAN can use backups from a previous incarnation just as it would use backups from the current incarnation, if all archived logs are available.</p>
<p><span class="bold">To list database incarnations:</span></p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p><a id="sthref1025"></a>Run the <code dir="ltr">LIST</code> <code dir="ltr">INCARNATION</code> command, as shown in the following example:</p>
<pre dir="ltr">
LIST INCARNATION;
</pre>
<p>If you are using a recovery catalog, and if you register multiple target databases in the same catalog, then you can distinguish them by using the <code dir="ltr">OF</code> <code dir="ltr">DATABASE</code> option:</p>
<pre dir="ltr">
LIST INCARNATION OF DATABASE prod3;
</pre>
<p>See <a class="olink RCMRF132" href="../../backup.112/e10643/rcmsynta027.htm#RCMRF132"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for an explanation of the various column headings in the <code dir="ltr">LIST</code> output). Sample output follows:</p>
<pre dir="ltr">
RMAN&gt; LIST INCARNATION OF DATABASE trgt;

List of Database Incarnations
DB Key  Inc Key DB Name  DB ID            STATUS  Reset SCN  Reset Time
------- ------- -------- ---------------- ------  ---------- ----------
1       1       RDBMS    774627068        PARENT  1          21-OCT-06
2       2       RDBMS    774627068        CURRENT 173832     21-OCT-06
</pre>
<p>The preceding output indicates that a <code dir="ltr">RESETLOGS</code> operation was performed on database <code dir="ltr">trgt</code> at SCN 164378, resulting in a new incarnation. The incarnation is distinguished by incarnation key (represented in the <code dir="ltr">Inc Key</code> column).</p>
</li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1008987"></a>
<div id="BRADV8137" class="sect1">
<h2 class="sect1">Reporting on Backups and Database Schema</h2>
<p>The RMAN <code dir="ltr">REPORT</code> command analyzes the available backups and your database. This section contains the following topics:</p>
<ul>
<li>
<p><a href="#CEGBDAAH">About Reports of RMAN Backups</a></p>
</li>
<li>
<p><a href="#i1009033">Reporting on Files Needing a Backup Under a Retention Policy</a></p>
</li>
<li>
<p><a href="#CEGEBDBD">Reporting on Datafiles Affected by Unrecoverable Operations</a></p>
</li>
<li>
<p><a href="#i1009081">Reporting on Obsolete Backups</a></p>
</li>
<li>
<p><a href="#i1009146">Reporting on the Database Schema</a></p>
</li>
</ul>
<a id="CEGBDAAH"></a>
<div id="BRADV89593" class="sect2">
<h3 class="sect2">About Reports of RMAN Backups</h3>
<p>You can use the <code dir="ltr">REPORT</code> command to answer important questions, such as:</p>
<ul>
<li>
<p>Which files need a backup?</p>
</li>
<li>
<p>Which files have had unrecoverable operations performed on them?</p>
</li>
<li>
<p>Which backups are obsolete and can be deleted?</p>
</li>
<li>
<p>What was the physical schema of the target database or a database in the Data Guard environment at some previous time?</p>
</li>
<li>
<p>Which files have not been backed up recently?</p>
</li>
</ul>
<p><a id="sthref1026"></a><a id="sthref1027"></a><a id="sthref1028"></a><a id="sthref1029"></a><a id="sthref1030"></a><a id="sthref1031"></a>Reports enable you to confirm that your backup and recovery strategy is in fact meeting your requirements for database recoverability. The two major forms of <code dir="ltr">REPORT</code> used to determine whether your database is recoverable are:</p>
<ul>
<li>
<p><code dir="ltr">REPORT</code> <code dir="ltr">NEED</code> <code dir="ltr">BACKUP</code></p>
<p>Reports which database files must be backed up to meet a configured or specified retention policy</p>
</li>
<li>
<p><code dir="ltr">REPORT</code> <code dir="ltr">UNRECOVERABLE</code></p>
<p>Reports which database files require backup because they have been affected by some <code dir="ltr">NOLOGGING</code> operation such as a direct-path <code dir="ltr">INSERT</code></p>
</li>
</ul>
<p>The RMAN repository contains other information that you can access with the <code dir="ltr">REPORT</code> command. <a href="#CHDBIADB">Table 11-3</a> summarizes the <code dir="ltr">REPORT</code> options.</p>
<div id="BRADV278" class="tblformal">
<p class="titleintable"><a id="sthref1032"></a><a id="CHDBIADB"></a>Table 11-3 REPORT Options</p>
<table class="cellalignment1940" title="REPORT Options" summary="LIST options" dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t9">Contents of Report</th>
<th class="cellalignment1941" id="r1c2-t9">Command</th>
<th class="cellalignment1941" id="r1c3-t9">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t9" headers="r1c1-t9">
<p>Obsolete backups</p>
</td>
<td class="cellalignment1942" headers="r2c1-t9 r1c2-t9">
<p><code dir="ltr">REPORT OBSOLETE</code></p>
</td>
<td class="cellalignment1942" headers="r2c1-t9 r1c3-t9">
<p>Full backups, data file copies, and archived redo logs recorded in the RMAN repository that can be deleted because they are no longer needed</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t9" headers="r1c1-t9">
<p>Database schema</p>
</td>
<td class="cellalignment1942" headers="r3c1-t9 r1c2-t9">
<p><code dir="ltr">REPORT SCHEMA</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t9 r1c3-t9">
<p>The names of all datafiles (permanent and temporary) and tablespaces for the target database at the specified point in time. If you use RMAN in a Data Guard environment, then you can report the schema for a specified <code dir="ltr">DB_UNIQUE_NAME</code>.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF147" href="../../backup.112/e10643/rcmsynta2006.htm#RCMRF147"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for a description of the <code dir="ltr">REPORT</code> command</div>
</div>
<!-- class="sect2" -->
<a id="i1009033"></a>
<div id="BRADV89594" class="sect2">
<h3 class="sect2">Reporting on Files Needing a Backup Under a Retention Policy</h3>
<p><a id="sthref1033"></a><a id="sthref1034"></a><a id="sthref1035"></a><a id="sthref1036"></a><a id="sthref1037"></a><a id="sthref1038"></a>Use the <code dir="ltr">REPORT</code> <code dir="ltr">NEED</code> <code dir="ltr">BACKUP</code> command to determine which database files need backup under a specific retention policy.</p>
<p><a id="sthref1039"></a>With no arguments, <code dir="ltr">REPORT</code> <code dir="ltr">NEED</code> <code dir="ltr">BACKUP</code> reports which objects need backup under the currently configured retention policy. The output for a configured retention policy of <code dir="ltr">REDUNDANCY 1</code> is similar to this example:</p>
<pre dir="ltr">
RMAN&gt; REPORT NEED BACKUP;

RMAN retention policy will be applied to the command
RMAN retention policy is set to redundancy 1
Report of files with less than 1 redundant backups
File #bkps Name
---- ----- -----------------------------------------------------
2    0     /oracle/oradata/trgt/undotbs01.dbf
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you disable the retention policy using <code dir="ltr">CONFIGURE</code> <code dir="ltr">RETENTION</code> <code dir="ltr">POLICY</code> <code dir="ltr">TO</code> <code dir="ltr">NONE</code>, then <code dir="ltr">REPORT</code> <code dir="ltr">NEED</code> <code dir="ltr">BACKUP</code> returns an error message, because without a retention policy, RMAN cannot determine which files must be backed up.</div>
<div id="BRADV89595" class="sect3"><a id="sthref1040"></a>
<h4 class="sect3">Using RMAN REPORT NEED BACKUP with Different Retention Policies</h4>
<p>You can specify different criteria for <code dir="ltr">REPORT</code> <code dir="ltr">NEED</code> <code dir="ltr">BACKUP</code>, using one of the following forms of the command:</p>
<ul>
<li>
<p><code dir="ltr">REPORT</code> <code dir="ltr">NEED</code> <code dir="ltr">BACKUP</code> <code dir="ltr">RECOVERY</code> <code dir="ltr">WINDOW</code> <code dir="ltr">OF</code> <code dir="ltr"><span class="codeinlineitalic">n</span></code> <code dir="ltr">DAYS</code></p>
<p>Displays objects requiring backup to satisfy a recovery window-based retention policy</p>
</li>
<li>
<p><code dir="ltr">REPORT</code> <code dir="ltr">NEED</code> <code dir="ltr">BACKUP</code> <code dir="ltr">REDUNDANCY</code> <code dir="ltr"><span class="codeinlineitalic">n</span></code></p>
<p>Displays objects requiring backup to satisfy a redundancy-based retention policy</p>
</li>
<li>
<p><code dir="ltr">REPORT</code> <code dir="ltr">NEED</code> <code dir="ltr">BACKUP</code> <code dir="ltr">DAYS</code> <code dir="ltr"><span class="codeinlineitalic">n</span></code></p>
<p>Displays files that require more than <code dir="ltr"><span class="codeinlineitalic">n</span></code> days' worth of archived redo log files for recovery</p>
</li>
<li>
<p><code dir="ltr">REPORT</code> <code dir="ltr">NEED</code> <code dir="ltr">BACKUP</code> <code dir="ltr">INCREMENTAL</code> <code dir="ltr"><span class="codeinlineitalic">n</span></code></p>
<p>Displays files that require application of more than <code dir="ltr"><span class="codeinlineitalic">n</span></code> incremental backups for recovery</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<div id="BRADV89596" class="sect3"><a id="sthref1041"></a>
<h4 class="sect3">Using RMAN REPORT NEED BACKUP with Tablespaces and Datafiles</h4>
<p>The <code dir="ltr">REPORT</code> <code dir="ltr">NEED</code> <code dir="ltr">BACKUP</code> command can check the entire database, skip specified tablespaces, or check only specific tablespaces or datafiles against different retention policies, as shown in the following examples:</p>
<pre dir="ltr">
REPORT NEED BACKUP RECOVERY WINDOW OF 2 DAYS DATABASE SKIP TABLESPACE TBS_2;
REPORT NEED BACKUP REDUNDANCY 2 DATAFILE 1;
REPORT NEED BACKUP TABLESPACE TBS_3; # uses configured retention policy
REPORT NEED BACKUP INCREMENTAL 2; # checks entire database
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF147" href="../../backup.112/e10643/rcmsynta2006.htm#RCMRF147"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for all possible options for <code dir="ltr">REPORT</code> <code dir="ltr">NEED</code> <code dir="ltr">BACKUP</code> and an explanation of the various column headings in the output</div>
</div>
<!-- class="sect3" -->
<div id="BRADV89597" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1042"></a>
<h4 class="sect3">Using REPORT NEED BACKUP with Backups on Tape or Disk Only</h4>
<p>You can limit the backups tested by the <code dir="ltr">REPORT NEED BACKUP</code> command to disk-based or tape-based backups only, as shown in these examples:</p>
<pre dir="ltr">
REPORT NEED BACKUP RECOVERY WINDOW OF 2 DAYS DATABASE DEVICE TYPE sbt;
REPORT NEED BACKUP DEVICE TYPE DISK;
REPORT NEED BACKUP TABLESPACE TBS_3 DEVICE TYPE sbt; 
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CEGEBDBD"></a>
<div id="BRADV89598" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Reporting on Datafiles Affected by Unrecoverable Operations</h3>
<p>When a data file has been changed by an unrecoverable operation, such as a direct load insert, normal media recovery cannot be used to recover the file, because an unrecoverable operation does not generate redo. You must perform either a full or incremental backup of affected data files after such operations, to ensure that data blocks affected by the unrecoverable operation can be recovered using RMAN.</p>
<p class="subhead2"><a id="BRADV279"></a>To identify datafiles affected by an unrecoverable operation:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>Execute the <code dir="ltr">REPORT</code> <code dir="ltr">UNRECOVERABLE</code> command.</p>
<p>The following example includes sample output:</p>
<pre dir="ltr">
RMAN&gt; REPORT UNRECOVERABLE;

Report of files that need backup due to unrecoverable operations
File Type of Backup Required Name
---- ----------------------- -----------------------------------
1    full                    /oracle/oradata/trgt/system01.dbf
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="i1009081"></a>
<div id="BRADV89599" class="sect2">
<h3 class="sect2">Reporting on Obsolete Backups</h3>
<p><a id="sthref1043"></a><a id="sthref1044"></a><a id="sthref1045"></a>You can report backup sets, backup pieces, and data file copies that are obsolete that is, not needed to meet a specified retention policy by specifying the <code dir="ltr">OBSOLETE</code> keyword.</p>
<p class="subhead2"><a id="BRADV280"></a>To report obsolete backups:</p>
<ol>
<li>
<p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
</li>
<li>
<p>Execute the <code dir="ltr">CROSSCHECK</code> command to update the status of backups in the repository compared to their status on disk.</p>
<p>In the simplest case, you could crosscheck all backups on disk, tape or both, using any one of the following commands:</p>
<pre dir="ltr">
CROSSCHECK BACKUP DEVICE TYPE DISK;
CROSSCHECK BACKUP DEVICE TYPE sbt;
CROSSCHECK BACKUP; # crosschecks all backups on all devices 
</pre>
<p>See <a href="rcmmaint.htm#h1016888">Chapter 12, "Maintaining RMAN Backups and Repository&nbsp;Records"</a> for more details on how to update the RMAN repository record to contain the actual set of available backups.</p>
</li>
<li>
<p>Run <code dir="ltr">REPORT</code> <code dir="ltr">OBSOLETE</code> to identify which backups are obsolete because they are no longer needed for recovery.</p>
<p>If you do not specify any other options, then <code dir="ltr">REPORT</code> <code dir="ltr">OBSOLETE</code> displays the backups that are obsolete according to the current retention policy, as shown in the following example:</p>
<pre dir="ltr">
RMAN&gt; REPORT OBSOLETE;

Datafile Copy        44     08-FEB-06          /backup/ora_df549738566_s70_s1
Datafile Copy        45     08-FEB-06          /backup/ora_df549738567_s71_s1
Datafile Copy        46     08-FEB-06          /backup/ora_df549738568_s72_s1
Backup Set           26     08-FEB-06
  Backup Piece       26     08-FEB-06          /backup/ora_df549738682_s76_s1
.
.
.
</pre>
<p>You can also check which backups are obsolete under different recovery window-based or redundancy-based retention policies, by using <code dir="ltr">REPORT</code> <code dir="ltr">OBSOLETE</code> with <code dir="ltr">RECOVERY</code> <code dir="ltr">WINDOW</code> and <code dir="ltr">REDUNDANCY</code> options, as shown in these examples:</p>
<pre dir="ltr">
REPORT OBSOLETE RECOVERY WINDOW OF 3 DAYS;
REPORT OBSOLETE REDUNDANCY 1;
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="rcmconfb.htm#i1019318">"Configuring the Backup Retention Policy"</a> for a conceptual overview of RMAN backup retention policy</p>
</li>
<li>
<p><a href="rcmmaint.htm#i1008500">"Deleting Expired RMAN Backups and Copies"</a> for information about deleting RMAN backups and deleting records of RMAN backups from the RMAN repository</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i1009146"></a>
<div id="BRADV89600" class="sect2">
<h3 class="sect2">Reporting on the Database Schema</h3>
<p><a id="sthref1046"></a><a id="sthref1047"></a><a id="sthref1048"></a>The <code dir="ltr">REPORT</code> <code dir="ltr">SCHEMA</code> command lists and displays information about the database files, tablespaces, and so on. See <a class="olink RCMRF147" href="../../backup.112/e10643/rcmsynta2006.htm#RCMRF147"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for a description of the <code dir="ltr">REPORT SCHEMA</code> output.</p>
<p>If you do not specify <code dir="ltr">FOR DB_UNIQUE_NAME</code> with <code dir="ltr">REPORT SCHEMA</code>, then a recovery catalog connection is optional, but a target database connection is required. In a Data Guard environment, you can specify <code dir="ltr">REPORT SCHEMA FOR DB_UNIQUE_NAME</code> to report the schema for a database in the environment. In this case, an RMAN connection to a target database is not required. You can connect RMAN to the recovery catalog and set the DBID instead.</p>
<p class="subhead2"><a id="BRADV281"></a>To report on the database schema:</p>
<ol>
<li>
<p>Start RMAN and connect to the desired databases.</p>
</li>
<li>
<p>If you did not connect RMAN to a target database in the previous step, and you intend to specify the <code dir="ltr">FOR DB_UNIQUE_NAME</code> clause on <code dir="ltr">REPORT SCHEMA</code>, then set the database DBID. For example, enter the following command:</p>
<pre dir="ltr">
RMAN&gt; SET DBID 28014364;
</pre></li>
<li>
<p>Run the <code dir="ltr">REPORT</code> <code dir="ltr">SCHEMA</code> command as shown in the following example:</p>
<pre dir="ltr">
RMAN&gt; REPORT SCHEMA;
 
Report of database schema for database with db_unique_name DGRDBMS
 
List of Permanent Datafiles
===========================
File Size(MB) Tablespace           RB segs Datafile Name
---- -------- -------------------- ------- ------------------------
1    450      SYSTEM               YES     /disk1/oracle/dbs/t_db1.f
2    141      SYSAUX               NO      /disk1/oracle/dbs/t_ax1.f
3    50       UD1                  YES     /disk1/oracle/dbs/t_undo1.f
4    50       TBS_11               NO      /disk1/oracle/dbs/tbs_111.f
5    50       TBS_11               NO      /disk1/oracle/dbs/tbs_112.f
 
List of Temporary Files
=======================
File Size(MB) Tablespace           Maxsize(MB) Tempfile Name
---- -------- -------------------- ----------- --------------------
1    40       TEMP                 32767       /disk1/oracle/dbs/t_tmp1.f
</pre>
<p>If you use a recovery catalog, then you can use the <code dir="ltr"><span class="codeinlineitalic">atClause</span></code> to specify a past time, SCN, or log sequence number, as shown in these examples of the command:</p>
<pre dir="ltr">
RMAN&gt; REPORT SCHEMA AT TIME 'SYSDATE-14';     # schema 14 days ago
RMAN&gt; REPORT SCHEMA AT SCN 1000;              # schema at scn 1000
RMAN&gt; REPORT SCHEMA AT SEQUENCE 100 THREAD 1; # schema at sequence 100
RMAN&gt; REPORT SCHEMA FOR DB_UNIQUE_NAME standby1; # schema for database standby1
</pre></li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDBIGHG"></a>
<div id="BRADV90911" class="sect1">
<h2 class="sect1">Using V$ Views to Query Backup Metadata</h2>
<p>In some cases, V$ views supply information that is not available through use of the <code dir="ltr">LIST</code> and <code dir="ltr">REPORT</code> commands. This section describes cases in which V$ views are particularly useful.</p>
<a id="CHDDAHIC"></a>
<div id="BRADV99967" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Querying Details of Past and Current RMAN Jobs</h3>
<p>An <a href="glossary.htm#CHDDBGHC"><span class="xrefglossterm">RMAN job</span></a> is the set of commands executed within an <a href="glossary.htm#CHDHHCJB"><span class="xrefglossterm">RMAN session</span></a>. Thus, one RMAN job can contain multiple commands. For example, you may execute two separate <code dir="ltr">BACKUP</code> commands and a <code dir="ltr">RECOVER COPY</code> command in a single session. An <a href="glossary.htm#CHDHJAGB"><span class="xrefglossterm">RMAN backup job</span></a> is the set of <code dir="ltr">BACKUP</code> commands executed in one RMAN job. For example, a <code dir="ltr">BACKUP DATABASE</code> and <code dir="ltr">BACKUP ARCHIVELOG ALL</code> command executed in the same RMAN job constitute a single RMAN backup job.</p>
<p><a id="sthref1049"></a><a id="sthref1050"></a><a id="sthref1051"></a>The <a id="sthref1052"></a><a id="sthref1053"></a>views <code dir="ltr">V$RMAN_BACKUP_JOB_DETAILS</code> and <code dir="ltr">V$RMAN_BACKUP_SUBJOB_DETAILS</code> and their corresponding recovery catalog versions provide details of RMAN backup jobs. For example, the views show how long a backup took, how many backup jobs have been issued, the status of each backup job (for example, whether it failed or completed), when a job started and finished, and what type of backup was performed. The <code dir="ltr">SESSION_KEY</code> column is the unique key for the RMAN session in which the backup job occurred.</p>
<p>RMAN backups often write less than they read. Because of RMAN compression, the <code dir="ltr">OUTPUT_BYTES_PER_SEC</code> column cannot be used as the measurement of backup speed. The appropriate column to measure backup speed is <code dir="ltr">INPUT_BYTES_PER_SEC</code>. The ratio between read and written data is described in the <code dir="ltr">COMPRESSION_RATIO</code> column.</p>
<p class="subhead2"><a id="BRADV282"></a>To query details about past and current RMAN jobs:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database whose backup history you intend to query.</p>
</li>
<li>
<p>Query the <code dir="ltr">V$RMAN_BACKUP_JOB_DETAILS</code> view for information about the backup type, status, and start and end time.</p>
<p>The following query shows the backup job history ordered by session key, which is the primary key for the RMAN session:</p>
<pre dir="ltr">
COL STATUS FORMAT a9
COL hrs    FORMAT 999.99
SELECT SESSION_KEY, INPUT_TYPE, STATUS,
       TO_CHAR(START_TIME,'mm/dd/yy hh24:mi') start_time,
       TO_CHAR(END_TIME,'mm/dd/yy hh24:mi')   end_time,
       ELAPSED_SECONDS/3600                   hrs
FROM V$RMAN_BACKUP_JOB_DETAILS
ORDER BY SESSION_KEY;
</pre>
<p>The following sample output shows the backup job history:</p>
<pre dir="ltr">
SESSION_KEY INPUT_TYPE    STATUS    START_TIME     END_TIME           HRS
----------- ------------- --------- -------------- -------------- -------
          9 DATAFILE FULL COMPLETED 04/18/07 18:14 04/18/07 18:15     .02
         16 DB FULL       COMPLETED 04/18/07 18:20 04/18/07 18:22     .03
        113 ARCHIVELOG    COMPLETED 04/23/07 16:04 04/23/07 16:05     .01
</pre></li>
<li>
<p>Query the <code dir="ltr">V$RMAN_BACKUP_JOB_DETAILS</code> view for the rate of backup jobs in an RMAN session.</p>
<p>The following query shows the backup job speed ordered by session key, which is the primary key for the RMAN session. The columns <code dir="ltr">IN_SEC</code> and <code dir="ltr">OUT_SEC</code> display the data input and output per second.</p>
<pre dir="ltr">
COL in_sec FORMAT a10
COL out_sec FORMAT a10
COL TIME_TAKEN_DISPLAY FORMAT a10
SELECT SESSION_KEY, 
       OPTIMIZED, 
       COMPRESSION_RATIO, 
       INPUT_BYTES_PER_SEC_DISPLAY in_sec,
       OUTPUT_BYTES_PER_SEC_DISPLAY out_sec, 
       TIME_TAKEN_DISPLAY
FROM   V$RMAN_BACKUP_JOB_DETAILS
ORDER BY SESSION_KEY;
</pre>
<p>The following sample output shows the speed of the backup jobs:</p>
<pre dir="ltr">
SESSION_KEY OPT COMPRESSION_RATIO IN_SEC     OUT_SEC    TIME_TAKEN
----------- --- ----------------- ---------- ---------- ----------
          9 NO                  1     8.24M      8.24M  00:01:14
         16 NO         1.32732239     6.77M      5.10M  00:01:45
        113 NO                  1     2.99M      2.99M  00:00:44
</pre></li>
<li>
<p>Query the <code dir="ltr">V$RMAN_BACKUP_JOB_DETAILS</code> view for the size of the backups in an RMAN session.</p>
<p>If you run <code dir="ltr">BACKUP DATABASE</code>, then <code dir="ltr">V$RMAN_BACKUP_JOB_DETAILS.OUTPUT_BYTES</code> shows the total size of backup sets written by the backup job for the database that you are backing up. To view backup set sizes for all registered databases, query <code dir="ltr">V$RMAN_BACKUP_JOB_DETAILS</code>.</p>
<p>The following query shows the backup job size and throughput ordered by session key, which is the primary key for the RMAN session. The columns <code dir="ltr">IN_SIZE</code> and <code dir="ltr">OUT_SIZE</code> display the data input and output per second.</p>
<pre dir="ltr">
COL in_size  FORMAT a10
COL out_size FORMAT a10
SELECT SESSION_KEY, 
       INPUT_TYPE,
       COMPRESSION_RATIO, 
       INPUT_BYTES_DISPLAY in_size,
       OUTPUT_BYTES_DISPLAY out_size
FROM   V$RMAN_BACKUP_JOB_DETAILS
ORDER BY SESSION_KEY;
</pre>
<p>The following sample output shows the size of the backup jobs:</p>
<pre dir="ltr">
SESSION_KEY INPUT_TYPE    COMPRESSION_RATIO IN_SIZE    OUT_SIZE
----------- ------------- ----------------- ---------- ----------
         10 DATAFILE FULL                 1   602.50M    602.58M
         17 DB FULL              1.13736669   634.80M    558.13M
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN30391" href="../../server.112/e40402/dynviews_2142.htm#REFRN30391"><span class="italic">Oracle Database Reference</span></a> to learn about the <code dir="ltr">V$RMAN_BACKUP_JOB_DETAILS</code> view</div>
</div>
<!-- class="sect2" -->
<a id="CHDIFGAE"></a>
<div id="BRADV90912" class="sect2">
<h3 class="sect2">Determining the Encryption Status of Backup Pieces</h3>
<p>The <code dir="ltr">ENCRYPTED</code> column of the <code dir="ltr">V$BACKUP_PIECE</code> and <code dir="ltr">V$RMAN_BACKUP_PIECE</code> views indicates whether a backup piece is encrypted (<code dir="ltr">YES</code>) or unencrypted (<code dir="ltr">NO</code>). For example, you can run the following query in SQL*Plus to determine which backup pieces are encrypted:</p>
<pre dir="ltr">
COL BS_REC    FORMAT 99999
COL BP_REC    FORMAT 99999
COL MB        FORMAT 9999999
COL ENCRYPTED FORMAT A7
COL TAG       FORMAT A25

SELECT S.RECID AS "BS_REC", P.RECID AS "BP_REC", P.ENCRYPTED, 
       P.TAG, P.HANDLE AS "MEDIA_HANDLE"
FROM   V$BACKUP_PIECE P, V$BACKUP_SET S
WHERE  P.SET_STAMP = S.SET_STAMP
AND    P.SET_COUNT = S.SET_COUNT;
</pre>
<p>The following sample output shows that the backups are encrypted:</p>
<pre dir="ltr">
BS_REC BP_REC ENCRYPT TAG
------ ------ ------- -------------------------
MEDIA_HANDLE
--------------------------------------------------------------------------------
     1      1 YES     TAG20070711T140124
/disk1/c-39525561-20070711-00
 
     2      2 YES     TAG20070711T140128
/disk1/c-39525561-20070711-01
 
     3      3 YES     TAG20070711T140130
/disk1/c-39525561-20070711-02
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN30023" href="../../server.112/e40402/dynviews_1058.htm#REFRN30023"><span class="italic">Oracle Database Reference</span></a> to learn about the <code dir="ltr">V$BACKUP_PIECE</code> view</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDIJDEF"></a>
<div id="BRADV89601" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Querying Recovery Catalog Views</h2>
<p><a id="sthref1054"></a><a id="sthref1055"></a>The <code dir="ltr">LIST</code>, <code dir="ltr">REPORT</code>, and <code dir="ltr">SHOW</code> commands provide the easiest means of accessing the data in the control file and the recovery catalog. Nevertheless, you can sometimes also obtain useful information from the recovery catalog views, which reside in the recovery catalog schema and use the <code dir="ltr">RC_</code> prefix.</p>
<div id="BRADV89602" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1056"></a>
<h3 class="sect2">About Recovery Catalog Views</h3>
<p>RMAN obtains backup and recovery metadata from a target database control file and stores it in the tables of the recovery catalog. The recovery catalog views are derived from these tables. The recovery catalog views are not normalized or optimized for user queries.</p>
<p>In general, the recovery catalog views are not as user-friendly as the RMAN reporting commands. For example, when you start RMAN and connect to a target database, you obtain the information for this target database only when you issue <code dir="ltr">LIST</code>, <code dir="ltr">REPORT</code>, and <code dir="ltr">SHOW</code> commands. If you have 10 different target databases registered in the same recovery catalog, then any query of the catalog views shows the metadata for all incarnations of all 10 databases. You often must perform complex selects and joins among the views to extract usable information about a database <a href="glossary.htm#i432741"><span class="xrefglossterm">incarnation</span></a>.</p>
<p>Most of the catalog views have a corresponding <code dir="ltr">V$</code> view in the database. For example,<a id="sthref1057"></a> <code dir="ltr">RC_BACKUP_PIECE</code> corresponds <a id="sthref1058"></a>to <code dir="ltr">V$BACKUP_PIECE</code>. The primary difference between the recovery catalog view and corresponding <code dir="ltr">V$</code> view is that each recovery catalog view contains metadata about <span class="italic">all</span> the target databases registered in the recovery catalog. The <code dir="ltr">V$</code> view contains information only about itself.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF003" href="../../backup.112/e10643/rcviews.htm#RCMRF003"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for a description of recovery catalog views</div>
<div id="BRADV89603" class="sect3"><a id="sthref1059"></a>
<h4 class="sect3">Unique Identifiers for Registered Databases</h4>
<p>Most recovery catalog views contain the columns <code dir="ltr">DB_KEY</code> and <code dir="ltr">DBINC_KEY</code>. Each database registered in the recovery catalog can be uniquely identified by either the primary key, which is the <code dir="ltr">DB_KEY</code> column value, or the <code dir="ltr">DBID</code>, which is the 32-bit unique database identifier. Each incarnation of a database is uniquely identified by the <code dir="ltr">DBINC_KEY</code> column.</p>
<p>You can use <code dir="ltr">DB_KEY</code> and <code dir="ltr">DBINC_KEY</code> to retrieve the records of a specific incarnation of a target database. Then, you can perform joins with most of the other catalog views to isolate records belonging to this incarnation.</p>
<p>An important difference between catalog and <code dir="ltr">V$</code> views is that a different system of unique identifiers is used for backup and recovery files. For example, many <code dir="ltr">V$</code> views such <a id="sthref1060"></a>as <code dir="ltr">V$ARCHIVED_LOG</code> use the <code dir="ltr">RECID</code> and <code dir="ltr">STAMP</code> columns to form a concatenated primary key. The corresponding recovery catalog view uses a derived value as its primary keys and stores this value in a single column. For example, the primary key <a id="sthref1061"></a>in <code dir="ltr">RC_ARCHIVED_LOG</code> is the <code dir="ltr">AL_KEY</code> column. The <code dir="ltr">AL_KEY</code> column value is the primary key that RMAN displays in the <code dir="ltr">LIST</code> command output.</p>
</div>
<!-- class="sect3" -->
<div id="BRADV89604" class="sect3"><a id="sthref1062"></a>
<h4 class="sect3">Unique Identifiers in a Data Guard Environment</h4>
<p>Special considerations apply when querying the recovery catalog in a Data Guard environment. In a Data Guard environment, multiple databases share the same DBID. Several views contain a <code dir="ltr">DB_UNIQUE_NAME</code> column, which indicates the <code dir="ltr">DB_UNIQUE_NAME</code> of the database incarnation to which the record belongs. All databases in a Data Guard environment share the same DBID but have different <code dir="ltr">DB_UNIQUE_NAME</code> values.</p>
<p>The value of <code dir="ltr">DB_UNIQUE_NAME</code> is <code dir="ltr">null</code> when the database name is not known to the catalog, as for Oracle9<span class="italic">i</span> databases that are registered in a recovery catalog. Also, the column value is <code dir="ltr">null</code> when a database is upgraded to Oracle Database 11<span class="italic">g</span> but the recovery catalog schema has not reconciled the database names for all files.</p>
<p>In the recovery catalog views, the primary database and its associated standby databases share the same <code dir="ltr">DB_KEY</code>. However, every database in a Data Guard environment has a unique <code dir="ltr">RC_SITE.SITE_KEY</code> value. For example, a primary database <code dir="ltr">prod</code> and its standby database <code dir="ltr">standby1</code> might both have the <code dir="ltr">DB_KEY</code> value of 1, whereas the <code dir="ltr">SITE_KEY</code> of <code dir="ltr">prod</code> is 3 and the <code dir="ltr">SITE_KEY</code> of <code dir="ltr">standby1</code> is 30.</p>
<p>Some recovery catalog views do not have a <code dir="ltr">DB_UNIQUE_NAME</code> column, but include a <code dir="ltr">SITE_KEY</code> column. You can use the <code dir="ltr">SITE_KEY</code> column to join with <code dir="ltr">RC_SITE.SITE_KEY</code> to determine the <code dir="ltr">DB_UNIQUE_NAME</code> of the database associated with a file. As explained in <a href="rcmarchi.htm#CHDHJFAB">"RMAN File Management in a Data Guard Environment"</a>, every file in a Data Guard environment is associated with the primary or standby database that created it.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SBYDB04700" href="../../server.112/e41134/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to report on and manage files in a Data Guard environment</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<div id="BRADV89605" class="sect2"><a id="sthref1063"></a>
<h3 class="sect2">Querying Catalog Views for the Target DB_KEY or DBID Values</h3>
<p>The <code dir="ltr">DB_KEY</code> value, which is the primary key for a registered database, is used only in the recovery catalog. The easiest way is to obtain the <code dir="ltr">DB_KEY</code> is to use the DBID of the target database, which is displayed whenever you connect RMAN to a database as <code dir="ltr">TARGET</code>. The DBID distinguishes databases registered in the RMAN recovery catalog.</p>
<p>Assume that you want to obtain information about a database registered in the recovery catalog.</p>
<p class="subhead2"><a id="BRADV283"></a>To query the catalog for information about the current incarnation of a database:</p>
<ol>
<li>
<p>Determine the DBID for the database whose records you want to view.</p>
<p>You can obtain the DBID by looking at the output displayed when RMAN connects to the database, <a id="sthref1064"></a>querying <code dir="ltr">V$RMAN_OUTPUT</code>, or querying <a id="sthref1065"></a>a <code dir="ltr">V$DATABASE</code> view. The following example connects SQL*Plus to the desired database and queries the DBID:</p>
<pre dir="ltr">
SQL&gt; CONNECT / AS SYSDBA
SQL&gt; SELECT DBID 
  2  FROM   V$DATABASE;

DBID
---------
598368217
</pre></li>
<li>
<p>Start SQL*Plus and connect to the recovery catalog database as the owner of the recovery catalog.</p>
</li>
<li>
<p>Obtain the database key for the database whose DBID you obtained in Step 1.</p>
<p>To obtain the <code dir="ltr">DB_KEY</code> for a database run the following query, where <code dir="ltr"><span class="codeinlineitalic">dbid_of_target</span></code> is the DBID obtained in Step 1:</p>
<pre dir="ltr">
SELECT DB_KEY 
FROM   RC_DATABASE 
WHERE  DBID = <span class="italic">dbid_of_target</span>;
</pre></li>
<li>
<p>Query the records for the current incarnation of the database whose DBID you obtained in Step 1.</p>
<p>To obtain information about the current incarnation of a target database, specify the target database <code dir="ltr">DB_KEY</code> value and perform a join with the <code dir="ltr">RC_DATABASE_INCARNATION</code> view. Use a <code dir="ltr">WHERE</code> condition to specify that the <code dir="ltr">CURRENT_INCARNATION</code> column value is set to <code dir="ltr">YES</code>. For example, to obtain information about backup sets in the current incarnation of a target database with the <code dir="ltr">DB_KEY</code> value of <code dir="ltr">1</code>, query as follows:</p>
<pre dir="ltr">
SELECT BS_KEY, BACKUP_TYPE, COMPLETION_TIME
FROM   RC_DATABASE_INCARNATION i, RC_BACKUP_SET b
WHERE  i.DB_KEY = 1
AND    i.DB_KEY = b.DB_KEY
AND    i.CURRENT_INCARNATION = 'YES';
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink RCMRF174" href="../../backup.112/e10643/rcviews029.htm#RCMRF174"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for details about the <code dir="ltr">RC_DATABASE_INCARNATION</code> view</p>
</li>
<li>
<p><a href="rcmrvcon.htm#BGBBAJII">"Database Incarnations"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<div id="BRADV53532" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1066"></a>
<h3 class="sect2">Querying RC_BACKUP_FILES</h3>
<p>You can query the <a id="sthref1067"></a>view <code dir="ltr">RC_BACKUP_FILES</code> for information about all backups of any database registered in the recovery catalog. Before querying <code dir="ltr">RC_BACKUP_FILES</code>, however, you must call the <code dir="ltr">DBMS_RCVMAN.SETDATABASE</code> procedure. Specify the DBID of a database registered in the recovery catalog, as shown in the following example:</p>
<pre dir="ltr">
SQL&gt; CALL DBMS_RCVMAN.SETDATABASE(null,null,null,2283997583);
</pre>
<p>The fourth parameter must be the DBID of a database registered in the recovery catalog. The other parameters must all be <code dir="ltr">NULL</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink RCMRF1670" href="../../backup.112/e10643/rcviews014.htm#RCMRF1670"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for details about the <code dir="ltr">RC_BACKUP_FILES</code> view</p>
</li>
<li>
<p><a href="rcmcomre.htm#i1038112">"Determining the DBID of the Database"</a> for techniques for determining the DBID of a database</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1933">
<tr>
<td class="cellalignment1942">
<table class="cellalignment1938">
<tr>
<td class="cellalignment1937"><a href="part_mai.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1937"><a href="rcmmaint.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1944">
<table class="cellalignment1936">
<tr>
<td class="cellalignment1937"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1937"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1937"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1937"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1937"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1937"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
