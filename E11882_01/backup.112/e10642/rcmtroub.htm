<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Troubleshooting RMAN Operations</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1054" />
<meta name="description" content="A guide to backup and recovery of Oracle databases, including RMAN backup and recovery, RMAN data transfer, Oracle Flashback Technology, and user-managed backup and recovery" />
<meta name="dcterms.created" content="2015-05-13T14:1:12Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Backup and Recovery User's Guide" />
<meta name="dcterms.identifier" content="E10642-08" />
<meta name="dcterms.isVersionOf" content="BRADV" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="rcmtunin.htm" title="Previous" type="text/html" />
<link rel="Next" href="part_tra.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10642.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">36/47</span> <!-- End Header -->
<div id="BRADV012" class="chapter"><a id="BGBFHJAH"></a> <a id="i1006084"></a>
<h1 class="chapter"><span class="secnum">23</span> Troubleshooting RMAN Operations</h1>
<p>This chapter describes how to troubleshoot Recovery Manager. This chapter contains the following topics:</p>
<ul>
<li>
<p><a href="#i1010096">Interpreting RMAN Message Output</a></p>
</li>
<li>
<p><a href="#i1008552">Using V$ Views for RMAN Troubleshooting</a></p>
</li>
<li>
<p><a href="#i1006546">Testing the Media Management API</a></p>
</li>
<li>
<p><a href="#i1006620">Terminating an RMAN Command</a></p>
</li>
</ul>
<a id="i1010096"></a>
<div id="BRADV174" class="sect1">
<h2 class="sect1">Interpreting RMAN Message Output</h2>
<p>Re<a id="sthref1729"></a><a id="sthref1730"></a>covery Manager provides detailed error messages that can aid in troubleshooting problems. Also, Oracle Database and the third-party media vendors generate useful debugging output of their own. The following discussion explains how to identify and interpret the different errors that you may encounter.</p>
<a id="BGBFEGEC"></a>
<div id="BRADV89865" class="sect2">
<h3 class="sect2">Identifying Types of Message Output</h3>
<p>Output that is useful for troubleshooting failed or unresponsive RMAN jobs is located in several different places, as explained in <a href="#BGBBABDH">Table 23-1</a>.</p>
<div id="BRADV411" class="tblruleformalwidemax">
<p class="titleintable"><a id="sthref1731"></a><a id="BGBBABDH"></a>Table 23-1 Types of Message Output</p>
<table class="cellalignment1945" title="Types of Message Output" summary="This table lists places to look for different message output useful in troubleshooting RMAN backup problems." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t2"><span class="bold">Type of Output</span></th>
<th class="cellalignment1941" id="r1c2-t2">Produced By</th>
<th class="cellalignment1941" id="r1c3-t2">Location</th>
<th class="cellalignment1941" id="r1c4-t2">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t2" headers="r1c1-t2">
<p>RMAN messages</p>
</td>
<td class="cellalignment1942" headers="r2c1-t2 r1c2-t2">
<p>RMAN</p>
</td>
<td class="cellalignment1942" headers="r2c1-t2 r1c3-t2">
<p>Completed job information is <a id="sthref1732"></a>in <code dir="ltr">V$RMAN_STATUS</code> and <code dir="ltr">RC_RMAN_STATUS</code>. Current job information is in <code dir="ltr">V$RMAN_OUTPUT</code>.</p>
<p>When running RMAN from the command line, you can direct output to the following places:</p>
<ul>
<li>
<p>Standard output</p>
</li>
<li>
<p>A log file specified by <code dir="ltr">LOG</code> on the command line or the <code dir="ltr">SPOOL</code> <code dir="ltr">LOG</code> command</p>
</li>
<li>
<p>A file created by redirecting RMAN output (for example, in UNIX, using the'<code dir="ltr">&gt;</code>' operator)</p>
</li>
</ul>
</td>
<td class="cellalignment1942" headers="r2c1-t2 r1c4-t2">
<p>Contains actions relevant to the RMAN job and error messages generated by RMAN, the database server, and the media vendor. RMAN error messages have an <code dir="ltr">RMAN-</code> prefix. Normal action descriptions do not have a prefix.</p>
<p>You can execute the following PL/SQL to remove all entries from <code dir="ltr">V$RMAN_STATUS</code>:</p>
<pre dir="ltr">
SYS.DBMS_BACKUP_RESTORE.resetCfileSection(28);
</pre>
<p>The preceding function removes all job-related entries. No rows are visible until new backup jobs are shown in <code dir="ltr">V$RMAN_BACKUP_JOB_DETAILS</code>.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t2" headers="r1c1-t2">
<p><code dir="ltr"><a id="sthref1733"></a>alert_</code><span class="italic">SID</span><code dir="ltr">.log</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t2 r1c2-t2">
<p>Oracle Database</p>
</td>
<td class="cellalignment1942" headers="r3c1-t2 r1c3-t2">
<p>The <code dir="ltr">alert</code> subdirectory of the <a id="sthref1734"></a><a href="glossary.htm#CHDDDGDF"><span class="xrefglossterm">Automatic Diagnostic Repository (ADR)</span></a> home</p>
</td>
<td class="cellalignment1942" headers="r3c1-t2 r1c4-t2">
<p>Contains a chronological log of errors, initialization parameter settings, and administration operations. Records values for overwritten control file records.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t2" headers="r1c1-t2">
<p><a id="sthref1735"></a>Oracle trace file</p>
</td>
<td class="cellalignment1942" headers="r4c1-t2 r1c2-t2">
<p>Oracle Database</p>
</td>
<td class="cellalignment1942" headers="r4c1-t2 r1c3-t2">
<p>The <code dir="ltr">trace</code> subdirectory of the ADR home</p>
</td>
<td class="cellalignment1942" headers="r4c1-t2 r1c4-t2">
<p>Contains detailed output generated by Oracle Database processes. This file is created when an <code dir="ltr">ORA-600</code> or <code dir="ltr">ORA-3113</code> error message occurs, whenever RMAN cannot allocate a channel, and when the database fails to load the media management library.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r5c1-t2" headers="r1c1-t2">
<p><code dir="ltr"><a id="sthref1736"></a>sbtio.log</code></p>
</td>
<td class="cellalignment1942" headers="r5c1-t2 r1c2-t2">
<p>Third-party media management software</p>
</td>
<td class="cellalignment1942" headers="r5c1-t2 r1c3-t2">
<p>The <code dir="ltr">trace</code> subdirectory of the ADR home</p>
</td>
<td class="cellalignment1942" headers="r5c1-t2 r1c4-t2">
<p>Contains vendor-specific information written by the media management software. This log does not contain Oracle Database or RMAN errors.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r6c1-t2" headers="r1c1-t2">
<p>Media manager log file</p>
</td>
<td class="cellalignment1942" headers="r6c1-t2 r1c2-t2">
<p>Third-party media management software</p>
</td>
<td class="cellalignment1942" headers="r6c1-t2 r1c3-t2">
<p>The file names for any media manager logs other than <code dir="ltr">sbtio.log</code> are determined by the media management software.</p>
</td>
<td class="cellalignment1942" headers="r6c1-t2 r1c4-t2">
<p>Contains information about the functioning of the media management device</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformalwidemax" --></div>
<!-- class="sect2" -->
<a id="i1006209"></a>
<div id="BRADV89866" class="sect2">
<h3 class="sect2">Recognizing RMAN Error Message Stacks</h3>
<p>RMAN reports errors as they occur. If an error is not retrievable, that is, if RMAN cannot perform failover to another channel to complete a particular job step, then RMAN also reports a summary of the errors after all job sets complete. This feature is known as deferred error reporting.</p>
<p>One way to determine whether RMAN encountered an error is to examine its return code, as described in <a href="#i1006541">"Identifying RMAN Return Codes"</a>. A second way is to search the RMAN output for the string <code dir="ltr">RMAN-00569</code>, which is the message number for the error stack banner. All RMAN errors are preceded by this error message. If you do not see an <code dir="ltr">RMAN-00569</code> message in the output, then there are no errors. <a href="#BGBIHGBB">Example 23-1</a> shows a syntax error.</p>
<div id="BRADV412" class="example">
<p class="titleinexample"><a id="BGBIHGBB"></a>Example 23-1 RMAN Syntax Error</p>
<pre dir="ltr">
RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-00558: error encountered while parsing input commands
RMAN-01005: syntax error: found ")": expecting one of: "archivelog, backup, backupset, controlfilecopy, current, database, datafile, datafilecopy, (, plus, ;, tablespace"
RMAN-01007: at line 1 column 18 file: standard input
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<a id="i1006225"></a>
<div id="BRADV89867" class="sect2">
<h3 class="sect2">Identifying Error Codes</h3>
<p><a id="sthref1737"></a><a id="sthref1738"></a>Typically, you find the following types of error codes in RMAN message stacks:</p>
<ul>
<li>
<p>Errors prefixed with <code dir="ltr">RMAN-</code></p>
</li>
<li>
<p>Errors prefixed with <code dir="ltr">ORA-</code></p>
</li>
<li>
<p>Errors preceded by the line <code dir="ltr">Additional information:</code></p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ERRMG" href="../../server.112/e17766/toc.htm"><span class="italic">Oracle Database Error Messages</span></a> for explanations of <code dir="ltr">RMAN</code> and <code dir="ltr">ORA</code> error codes</div>
</li>
</ul>
<div id="BRADV89868" class="sect3"><a id="sthref1739"></a>
<h4 class="sect3">RMAN Error Message Numbers</h4>
<p><a id="sthref1740"></a><a id="sthref1741"></a><a href="#g1014492">Table 23-2</a> indicates the error ranges for common RMAN error messages, all of which are described in <a class="olink ERRMG" href="../../server.112/e17766/toc.htm"><span class="italic">Oracle Database Error Messages</span></a>.</p>
<div id="BRADV413" class="tblruleformal">
<p class="titleintable"><a id="sthref1742"></a><a id="g1014492"></a>Table 23-2 RMAN Error Message Ranges</p>
<table class="cellalignment1945" title="RMAN Error Message Ranges" summary="This table lists error number ranges associated with RMAN error messages and their likely causes." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t4">Error Range</th>
<th class="cellalignment1941" id="r1c2-t4">Cause</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t4" headers="r1c1-t4">
<p>0550-0999</p>
</td>
<td class="cellalignment1942" headers="r2c1-t4 r1c2-t4">
<p>Command-line interpreter</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t4" headers="r1c1-t4">
<p>1000-1999</p>
</td>
<td class="cellalignment1942" headers="r3c1-t4 r1c2-t4">
<p>Keyword analyzer</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t4" headers="r1c1-t4">
<p>2000-2999</p>
</td>
<td class="cellalignment1942" headers="r4c1-t4 r1c2-t4">
<p>Syntax analyzer</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r5c1-t4" headers="r1c1-t4">
<p>3000-3999</p>
</td>
<td class="cellalignment1942" headers="r5c1-t4 r1c2-t4">
<p>Main layer</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r6c1-t4" headers="r1c1-t4">
<p>4000-4999</p>
</td>
<td class="cellalignment1942" headers="r6c1-t4 r1c2-t4">
<p>Services layer</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r7c1-t4" headers="r1c1-t4">
<p>5000-5499</p>
</td>
<td class="cellalignment1942" headers="r7c1-t4 r1c2-t4">
<p>Compilation of <code dir="ltr">RESTORE</code> or <code dir="ltr">RECOVER</code> command</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r8c1-t4" headers="r1c1-t4">
<p>5500-5999</p>
</td>
<td class="cellalignment1942" headers="r8c1-t4 r1c2-t4">
<p>Compilation of <code dir="ltr">DUPLICATE</code> command</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r9c1-t4" headers="r1c1-t4">
<p>6000-6999</p>
</td>
<td class="cellalignment1942" headers="r9c1-t4 r1c2-t4">
<p>General compilation</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r10c1-t4" headers="r1c1-t4">
<p>7000-7999</p>
</td>
<td class="cellalignment1942" headers="r10c1-t4 r1c2-t4">
<p>General execution</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r11c1-t4" headers="r1c1-t4">
<p>8000-8999</p>
</td>
<td class="cellalignment1942" headers="r11c1-t4 r1c2-t4">
<p>PL/SQL programs</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r12c1-t4" headers="r1c1-t4">
<p>9000-9999</p>
</td>
<td class="cellalignment1942" headers="r12c1-t4 r1c2-t4">
<p>Low-level keyword analyzer</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r13c1-t4" headers="r1c1-t4">
<p>10000-10999</p>
</td>
<td class="cellalignment1942" headers="r13c1-t4 r1c2-t4">
<p>Server-side execution</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r14c1-t4" headers="r1c1-t4">
<p>11000-11999</p>
</td>
<td class="cellalignment1942" headers="r14c1-t4 r1c2-t4">
<p>Interphase errors between PL/SQL and RMAN</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r15c1-t4" headers="r1c1-t4">
<p>12000-12999</p>
</td>
<td class="cellalignment1942" headers="r15c1-t4 r1c2-t4">
<p>Recovery catalog packages</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" --></div>
<!-- class="sect3" -->
<div id="BRADV89869" class="sect3"><a id="sthref1743"></a>
<h4 class="sect3">ORA-19511: Media Manager Errors</h4>
<p><a id="sthref1744"></a><a id="sthref1745"></a>If a media manager error occurs, <code dir="ltr">ORA-19511</code> is signaled, and the media manager is expected to provide RMAN a descriptive error. RMAN displays the error passed back to it by the media manager. For example, you might see this:</p>
<pre dir="ltr">
ORA-19511: Error received from media manager layer, error text:
   sbtpvt_open_input: file .* does not exist or cannot be accessed, errno = 2
</pre>
<p>The message from the media manager should provide you with enough information to let you fix the root problem. If it does not, you should refer to the documentation for your media manager or contact your media management vendor support representative for further information. <code dir="ltr">ORA-19511</code> errors originate with the media manager, not with Oracle Database. The database just passes the message on from the media manager. The cause can be addressed only by the media management vendor.</p>
<p>If you are still using an <a href="glossary.htm#CHDCCBFI"><span class="xrefglossterm">SBT</span></a> 1.1-compliant media management layer, you may see some additional error message text. Output from an SBT 1.1-compliant media management layer is similar to the following:</p>
<pre dir="ltr">
ORA-19507: failed to retrieve sequential file, handle="c-140148591-20031014-06", parms=""
ORA-27007: failed to open file
Additional information: 7000
Additional information: 2
ORA-19511: Error received from media manager layer, error text:
   SBT error = 7000, errno = 0, sbtopen: backup file not found
</pre>
<p>The "Additional information" provided uses error codes specific to SBT 1.1. The values displayed correspond to the media manager message numbers and error text listed in <a href="#g1014541">Table 23-3</a>. RMAN again signals the error, as an ORA-19511 <code dir="ltr">Error received from media manager layer</code> error, and a general error message related to the error code returned from the media manager and including the SBT 1.1 error number is then displayed.</p>
<p>The SBT 1.1 error messages are listed here for your reference. <a href="#g1014541">Table 23-3</a> lists media manager message numbers and their corresponding error text. In the error codes, <code dir="ltr"><span class="codeinlineitalic">O/S</span></code> stands for <span class="italic">operating system</span>. The errors marked with an asterisk (*) are internal and should not typically be seen during normal operation.</p>
<div id="BRADV414" class="tblruleformal">
<p class="titleintable"><a id="sthref1746"></a><a id="g1014541"></a>Table 23-3 Media Manager Error Message Ranges</p>
<table class="cellalignment1945" title="Media Manager Error Message Ranges" summary="This table lists SBT 1.1 error message numbers and corresponding error text.." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t5">Cause</th>
<th class="cellalignment1941" id="r1c2-t5">No.</th>
<th class="cellalignment1941" id="r1c3-t5">Message</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t5" headers="r1c1-t5">
<p>sbtopen</p>
</td>
<td class="cellalignment1942" headers="r2c1-t5 r1c2-t5">
<p>7000</p>
<p>7001</p>
<p>7002*</p>
<p>7003</p>
<p>7004</p>
<p>7005</p>
<p>7006</p>
<p>7007</p>
<p>7008</p>
<p>7009</p>
<p>7010</p>
<p>7011</p>
<p>7012*</p>
</td>
<td class="cellalignment1942" headers="r2c1-t5 r1c3-t5">
<p>Backup file not found (only returned for read)</p>
<p>File exists (only returned for write)</p>
<p>Bad mode specified</p>
<p>Invalid block size specified</p>
<p>No tape device found</p>
<p>Device found, but busy; try again later</p>
<p>Tape volume not found</p>
<p>Tape volume is in-use</p>
<p>I/O Error</p>
<p>Can't connect with Media Manager</p>
<p>Permission denied</p>
<p>O/S error for example malloc, fork error</p>
<p>Invalid argument(s) to sbtopen</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t5" headers="r1c1-t5">
<p>sbtclose</p>
</td>
<td class="cellalignment1942" headers="r3c1-t5 r1c2-t5">
<p>7020*</p>
<p>7021*</p>
<p>7022</p>
<p>7023</p>
<p>7024*</p>
<p>7025</p>
</td>
<td class="cellalignment1942" headers="r3c1-t5 r1c3-t5">
<p>Invalid file handle or file not open</p>
<p>Invalid flags to sbtclose</p>
<p>I/O error</p>
<p>O/S error</p>
<p>Invalid argument(s) to sbtclose</p>
<p>Can't connect with Media Manager</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t5" headers="r1c1-t5">
<p>sbtwrite</p>
</td>
<td class="cellalignment1942" headers="r4c1-t5 r1c2-t5">
<p>7040*</p>
<p>7041</p>
<p>7042</p>
<p>7043</p>
<p>7044*</p>
</td>
<td class="cellalignment1942" headers="r4c1-t5 r1c3-t5">
<p>Invalid file handle or file not open</p>
<p>End of volume reached</p>
<p>I/O error</p>
<p>O/S error</p>
<p>Invalid argument(s) to sbtwrite</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r5c1-t5" headers="r1c1-t5">
<p>sbtread</p>
</td>
<td class="cellalignment1942" headers="r5c1-t5 r1c2-t5">
<p>7060*</p>
<p>7061</p>
<p>7062</p>
<p>7063</p>
<p>7064</p>
<p>7065*</p>
</td>
<td class="cellalignment1942" headers="r5c1-t5 r1c3-t5">
<p>Invalid file handle or file not open</p>
<p>EOF encountered</p>
<p>End of volume reached</p>
<p>I/O error</p>
<p>O/S error</p>
<p>Invalid argument(s) to sbtread</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r6c1-t5" headers="r1c1-t5">
<p>sbtremove</p>
</td>
<td class="cellalignment1942" headers="r6c1-t5 r1c2-t5">
<p>7080</p>
<p>7081</p>
<p>7082</p>
<p>7083</p>
<p>7084</p>
<p>7085</p>
<p>7086*</p>
</td>
<td class="cellalignment1942" headers="r6c1-t5 r1c3-t5">
<p>Backup file not found</p>
<p>Backup file in use</p>
<p>I/O Error</p>
<p>Can't connect with Media Manager</p>
<p>Permission denied</p>
<p>O/S error</p>
<p>Invalid argument(s) to sbtremove</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r7c1-t5" headers="r1c1-t5">
<p>sbtinfo</p>
</td>
<td class="cellalignment1942" headers="r7c1-t5 r1c2-t5">
<p>7090</p>
<p>7091</p>
<p>7092</p>
<p>7093</p>
<p>7094</p>
<p>7095*</p>
</td>
<td class="cellalignment1942" headers="r7c1-t5 r1c3-t5">
<p>Backup file not found</p>
<p>I/O Error</p>
<p>Can't connect with Media Manager</p>
<p>Permission denied</p>
<p>O/S error</p>
<p>Invalid argument(s) to sbtinfo</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r8c1-t5" headers="r1c1-t5">
<p>sbtinit</p>
</td>
<td class="cellalignment1942" headers="r8c1-t5 r1c2-t5">
<p>7110*</p>
<p>7111</p>
</td>
<td class="cellalignment1942" headers="r8c1-t5 r1c3-t5">
<p>Invalid argument(s) to sbtinit</p>
<p>O/S error</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1006468"></a>
<div id="BRADV89870" class="sect2">
<h3 class="sect2">Interpreting RMAN Error Stacks</h3>
<p><a id="sthref1747"></a><a id="sthref1748"></a><a id="sthref1749"></a>Sometimes <a id="sthref1750"></a>you may find it difficult to identify the useful messages in the RMAN error stack. Note the following tips and suggestions:</p>
<ul>
<li>
<p>Read the messages from the bottom up, because this is the order in which RMAN issues the messages. The last one or two errors displayed in the stack are often the most informative.</p>
</li>
<li>
<p>When you are using an SBT 1.1 media management layer and you are presented with SBT 1.1 style error messages containing the "<code dir="ltr">Additional information:</code>" numeric error codes, look for the <code dir="ltr">ORA-19511</code> message that follows for the text of error messages passed back to RMAN by the media manager. These should identify the real failure in the media management layer.</p>
</li>
<li>
<p>Look for the <code dir="ltr">RMAN-03002</code> or <code dir="ltr">RMAN-03009</code> message (<code dir="ltr">RMAN-03009</code> is the same as <code dir="ltr">RMAN-03002</code> but includes the channel ID), immediately following the error banner. These messages indicate which command failed. Syntax errors generate <code dir="ltr">RMAN-00558</code>.</p>
</li>
<li>
<p>Identify the basic type of error according to the error range chart in <a href="#g1014492">Table 23-2</a> and then refer to <a class="olink ERRMG" href="../../server.112/e17766/toc.htm"><span class="italic">Oracle Database Error Messages</span></a> for information about the most important messages.</p>
</li>
</ul>
<div id="BRADV89871" class="sect3"><a id="sthref1751"></a>
<h4 class="sect3">Interpreting RMAN Errors: Example</h4>
<p>You attempt a backup of tablespace <code dir="ltr">users</code> and receive the following message:</p>
<pre dir="ltr">
Starting backup at 29-AUG-02
using channel ORA_DISK_1
RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-03002: failure of backup command at 08/29/2002 15:14:03
RMAN-20202: tablespace not found in the recovery catalog
RMAN-06019: could not translate tablespace name "USESR"
</pre>
<p>The <code dir="ltr">RMAN-03002</code> error indicates that the <code dir="ltr">BACKUP</code> command failed. You read the last two messages in the stack first and immediately see the problem: no tablespace <code dir="ltr">usesr</code> appears in the recovery catalog because you mistyped the name.</p>
</div>
<!-- class="sect3" -->
<div id="BRADV89872" class="sect3"><a id="sthref1752"></a>
<h4 class="sect3">Interpreting Server Errors: Example</h4>
<p>Assume that you attempt to recover a tablespace and receive the following errors:</p>
<pre dir="ltr">
RMAN&gt; RECOVER TABLESPACE users;

Starting recover at 29-AUG-07
using channel ORA_DISK_1

starting media recovery
media recovery failed
RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-03002: failure of recover command at 08/29/2007 15:18:43
RMAN-11003: failure during parse/execution of SQL statement: alter database recover if needed tablespace USERS
ORA-00283: recovery session canceled due to errors
ORA-01124: cannot recover data file 8 - file is in use or recovery
ORA-01110: data file 8: '/oracle/oradata/trgt/users01.dbf'
</pre>
<p>As suggested, you start reading from the bottom up. The <code dir="ltr">ORA-01110</code> message explains there was a problem with the recovery of data file <code dir="ltr">users01.dbf</code>. The second error indicates that the database cannot recover the data file because it is in use or already being recovered. The remaining RMAN errors indicate that the recovery session was canceled due to the server errors. Hence, you conclude that because you were not already recovering this data file, the problem must be that the data file is online and you must take it offline and restore a backup.</p>
</div>
<!-- class="sect3" -->
<div id="BRADV89873" class="sect3"><a id="sthref1753"></a>
<h4 class="sect3">Interpreting SBT 2.0 Media Management Errors: Example</h4>
<p>Assume that you use a tape drive and see the following output during a backup job:</p>
<pre dir="ltr">
RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
ORA-19624: operation failed, retry possible
ORA-19507: failed to retrieve sequential file, handle="/tmp/mydir", parms=""
ORA-27029: skgfrtrv: sbtrestore returned error
ORA-19511: Error received from media manager layer, error text:
  sbtpvt_open_input:file /tmp/mydir does not exist or cannot be accessed, errno=2
</pre>
<p>The error text displayed following the <code dir="ltr">ORA-19511</code> error is generated by the media manager and describes the real source of the failure. See the media manager documentation to interpret this error.</p>
</div>
<!-- class="sect3" -->
<div id="BRADV89874" class="sect3"><a id="sthref1754"></a>
<h4 class="sect3">Interpreting SBT 1.1 Media Management Errors: Example</h4>
<p>Assume that you use a tape drive and see the following output during a backup job:</p>
<pre dir="ltr">
RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-03009: failure of backup command on c1 channel at 09/04/2007 13:18:19
ORA-19506: failed to create sequential file, name="07d36ecp_1_1", parms=""
ORA-27007: failed to open file
SVR4 Error: 2: No such file or directory
Additional information: 7005
Additional information: 1
ORA-19511: Error received from media manager layer, error text:
   SBT error = 7005, errno = 2, sbtopen: system error
</pre>
<p>The main information of interest returned by SBT 1.1 media managers is the error code in the "Additional information" line:</p>
<pre dir="ltr">
Additional information: 7005
</pre>
<p>Referring to <a href="#g1014541">Table 23-3</a>, you discover that error <code dir="ltr">7005</code> means that the media management device is busy. So, the media management software is not able to write to the device because it is in use or there is a problem with it.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code dir="ltr">sbtio.log</code> contains information written by the media management software, <span class="italic">not</span> Oracle Database. Thus, you must consult your media vendor documentation to interpret the error codes and messages. If no information is written to the <code dir="ltr">sbtio.log</code>, then contact your media manager support to ask whether they are writing error messages in some other location, or whether there are steps you must take to have the media manager errors appear in <code dir="ltr">sbtio.log</code>.</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1006541"></a>
<div id="BRADV89875" class="sect2">
<h3 class="sect2">Identifying RMAN Return Codes</h3>
<p><a id="sthref1755"></a><a id="sthref1756"></a>One way to determine whether RMAN encountered an error is to examine its return code or exit status. The RMAN client returns 0 to the shell from which it was invoked if no errors occurred, and a nonzero error value otherwise.</p>
<p>How you access this return code depends upon the environment from which you invoked the RMAN client. For example, if you run UNIX with the C shell, then, when RMAN completes, the return code is placed in a shell variable called <code dir="ltr">$status</code>. The method of returning exit status is a detail specific to the host operating system rather than the RMAN client.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1008552"></a>
<div id="BRADV177" class="sect1">
<h2 class="sect1">Using V$ Views for RMAN Troubleshooting</h2>
<p>When <code dir="ltr">LIST</code>, <code dir="ltr">REPORT</code>, and <code dir="ltr">SHOW</code> do not provide all the information that you need for RMAN operations, some V$ views can provide more details.</p>
<p><a id="sthref1757"></a><a id="sthref1758"></a><a id="sthref1759"></a><a id="sthref1760"></a>Sometimes it is useful to identify exactly what a server session performing a backup and recovery job is doing. The views described in <a href="#CHDCJGIE">Table 23-4</a> are useful for obtaining information about RMAN jobs.</p>
<div id="BRADV415" class="tblformal">
<p class="titleintable"><a id="sthref1761"></a><a id="CHDCJGIE"></a>Table 23-4 Useful V$ Views for Troubleshooting</p>
<table class="cellalignment1940" title="Useful V$ Views for Troubleshooting" summary="This table describes views that can assist in monitoring or obtaining information about RMAN jobs." dir="ltr">
<thead>
<tr class="cellalignment1934">
<th class="cellalignment1941" id="r1c1-t7">View</th>
<th class="cellalignment1941" id="r1c2-t7">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r2c1-t7" headers="r1c1-t7">
<p><code dir="ltr"><a id="sthref1762"></a>V$PROCESS</code></p>
</td>
<td class="cellalignment1942" headers="r2c1-t7 r1c2-t7">
<p>Identifies currently active processes</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r3c1-t7" headers="r1c1-t7">
<p><code dir="ltr"><a id="sthref1763"></a>V$SESSION</code></p>
</td>
<td class="cellalignment1942" headers="r3c1-t7 r1c2-t7">
<p>Identifies currently active sessions. Use this view to determine which database server sessions correspond to which RMAN allocated channels.</p>
</td>
</tr>
<tr class="cellalignment1934">
<td class="cellalignment1942" id="r4c1-t7" headers="r1c1-t7">
<p><code dir="ltr"><a id="sthref1764"></a>V$SESSION_WAIT</code></p>
</td>
<td class="cellalignment1942" headers="r4c1-t7 r1c2-t7">
<p>Lists the events or resources for which sessions are waiting</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p>You can use the preceding views to perform the following tasks:</p>
<ul>
<li>
<p><a href="#i1008347">Monitoring RMAN Interaction with the Media Manager</a></p>
</li>
<li>
<p><a href="#i1008121">Correlating Server Sessions with RMAN Channels</a></p>
</li>
</ul>
<a id="i1008347"></a>
<div id="BRADV89876" class="sect2">
<h3 class="sect2">Monitoring RMAN Interaction with the Media Manager</h3>
<p>You can use the event names in the dynamic performance event views to monitor RMAN calls to the media management API. The event names have one-to-one correspondence with SBT functions, as shown in the following examples:</p>
<pre dir="ltr">
Backup: MML v1 open backup piece
Backup: MML v1 read backup piece
Backup: MML v1 write backup piece
Backup: MML v1 query backup piece
Backup: MML v1 delete backup piece
Backup: MML v1 close backup piece
.
.
.
</pre>
<p><a id="sthref1765"></a>To obtain the complete list of SBT events, you can use the following query:</p>
<pre dir="ltr">
SELECT NAME 
FROM   V$EVENT_NAME 
WHERE  NAME LIKE '%MML%';
</pre>
<p>Before making a call to any of functions in the media management API, the server adds a row in <code dir="ltr">V$SESSION_WAIT</code>, with the <code dir="ltr">STATE</code> column including the string <code dir="ltr">WAITING</code>. <a id="sthref1766"></a>The <code dir="ltr">V$SESSION_WAIT.SECONDS_IN_WAIT</code> column shows the number of seconds that the server has been waiting for this call to return. After an SBT function is returned from the media manager, this row disappears.</p>
<p>A row in <code dir="ltr">V$SESSION_WAIT</code> corresponding to an SBT event name does not indicate a problem, because the server updates these rows at run time. The rows appear and disappear as calls are made and returned. However, if the <code dir="ltr">SECONDS_IN_WAIT</code> column is high, then the media manager may be suspended.</p>
<p>To monitor the SBT events, you can run the following SQL query:</p>
<pre dir="ltr">
COLUMN EVENT FORMAT a17
COLUMN SECONDS_IN_WAIT FORMAT 999
COLUMN STATE FORMAT a15
COLUMN CLIENT_INFO FORMAT a30

SELECT p.SPID, s.EVENT, s.SECONDS_IN_WAIT AS SEC_WAIT, 
       sw.STATE, s.CLIENT_INFO
FROM   V$SESSION_WAIT sw, V$SESSION s, V$PROCESS p
WHERE  sw.EVENT LIKE '%MML%'
AND    s.SID=sw.SID
AND    s.PADDR=p.ADDR;
</pre>
<p>Examine the SQL output to determine which SBT functions are waiting. For example, the following output indicates that RMAN has been waiting for the <code dir="ltr">sbtbackup</code> function to return for 10 minutes:</p>
<pre dir="ltr">
SPID EVENT             SEC_WAIT   STATE           CLIENT_INFO
---- ----------------- ---------- --------------- ------------------------------
8642 Backup: MML creat 600        WAITING         rman channel=ORA_SBT_TAPE_1
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code dir="ltr">V$SESSION_WAIT</code> view shows only database events, not media manager events.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN30229" href="../../server.112/e40402/dynviews_3024.htm#REFRN30229"><span class="italic">Oracle Database Reference</span></a> for descriptions of the <code dir="ltr">V$SESSION_WAIT</code> view.</div>
</div>
<!-- class="sect2" -->
<a id="i1008121"></a>
<div id="BRADV89877" class="sect2">
<h3 class="sect2">Correlating Server Sessions with RMAN Channels</h3>
<p><a id="i1008123"></a>To identify which server sessions correspond to which RMAN channels, you can <a id="sthref1767"></a><a id="sthref1768"></a>query <code dir="ltr">V$SESSION</code> and <code dir="ltr">V$PROCESS</code>. The <code dir="ltr">SPID</code> column of <code dir="ltr">V$PROCESS</code> identifies the operating system ID number for the process or thread. For example, on UNIX the <code dir="ltr">SPID</code> column shows the process ID, whereas on Windows the <code dir="ltr">SPID</code> column shows the thread ID. You have two basic methods for obtaining this information, depending on whether you have multiple RMAN sessions active concurrently.</p>
<div id="BRADV89878" class="sect3"><a id="sthref1769"></a>
<h4 class="sect3">Matching Server Sessions with Channels When One RMAN Session Is Active</h4>
<p>When only one RMAN session is active, the easiest method for determining the server session ID for an RMAN channel is to execute the following query on the target database while the RMAN job is executing:</p>
<pre dir="ltr">
COLUMN CLIENT_INFO FORMAT a30
COLUMN SID FORMAT 999
COLUMN SPID FORMAT 9999

SELECT s.SID, p.SPID, s.CLIENT_INFO
FROM   V$PROCESS p, V$SESSION s
WHERE  p.ADDR = s.PADDR
AND    CLIENT_INFO LIKE 'rman%';
</pre>
<p>The following shows sample output:</p>
<pre dir="ltr">
 SID SPID         CLIENT_INFO
---- ------------ ------------------------------
  14 8374         rman channel=ORA_SBT_TAPE_1
</pre>
<p>If you set an ID using the RMAN <code dir="ltr">SET COMMAND ID</code> command instead of using the system-generated default ID, then search for that value in the <code dir="ltr">CLIENT_INFO</code> column instead of <code dir="ltr">'rman%'</code>.</p>
</div>
<!-- class="sect3" -->
<div id="BRADV89879" class="sect3"><a id="sthref1770"></a>
<h4 class="sect3">Matching Server Sessions with Channels in Multiple RMAN Sessions</h4>
<p>If more than one RMAN session is active, then it is possible for the <code dir="ltr">V$SESSION.CLIENT_INFO</code> column to yield the same information for a channel in each session. For example:</p>
<pre dir="ltr">
 SID SPID         CLIENT_INFO
---- ------------ ------------------------------
  14 8374         rman channel=ORA_SBT_TAPE_1
   9 8642         rman channel=ORA_SBT_TAPE_1
</pre>
<p>In this case, you have the following methods for determining which channel corresponds to which <code dir="ltr">SID</code> value.</p>
<div id="BRADV89880" class="sect4"><a id="sthref1771"></a>
<h5 class="sect4">Obtaining the Channel ID from the RMAN Output</h5>
<p>In this method, you must first obtain the <code dir="ltr">sid</code> values from the RMAN output and then use these values in your SQL query.</p>
<p><span class="bold"><a id="sthref1772"></a>To correlate a process with a channel during a backup:</span></p>
<ol>
<li>
<p>In an active session, run the RMAN job as usual and examine the output to get the <code dir="ltr">sid</code> for the channel. For example, the output may show:</p>
<pre dir="ltr">
Starting backup at 21-AUG-01
allocated channel: ORA_SBT_TAPE_1
channel ORA_SBT_TAPE_1: sid=14 devtype=SBT_TAPE
</pre></li>
<li>
<p>Start a SQL*Plus session and then query the joined <code dir="ltr">V$SESSION</code> and <code dir="ltr">V$PROCESS</code> views <span class="italic">while the RMAN job is executing</span>. For example, enter:</p>
<pre dir="ltr">
COLUMN CLIENT_INFO FORMAT a30
COLUMN SID FORMAT 999
COLUMN SPID FORMAT 9999

SELECT s.SID, p.SPID, s.CLIENT_INFO
FROM   V$PROCESS p, V$SESSION s
WHERE  p.ADDR = s.PADDR
AND    CLIENT_INFO LIKE 'rman%'
/
</pre>
<p>Use the <code dir="ltr">sid</code> value obtained from the first step to determine which channel corresponds to which server session:</p>
<pre dir="ltr">
       SID SPID         CLIENT_INFO
---------- ------------ ------------------------------
        14 2036         rman channel=ORA_SBT_TAPE_1
        12 2066         rman channel=ORA_SBT_TAPE_1
</pre></li>
</ol>
</div>
<!-- class="sect4" -->
<div id="BRADV89881" class="sect4"><a id="sthref1773"></a>
<h5 class="sect4">Correlating Server Sessions with Channels by Using SET COMMAND ID</h5>
<p>In this method, you specify a command ID string in the RMAN backup script. You can then query <code dir="ltr">V$SESSION.CLIENT_INFO</code> for this string.</p>
<p><span class="bold"><a id="sthref1774"></a>To correlate a process with a channel during a backup:</span></p>
<ol>
<li>
<p>In each session, set the <code dir="ltr">COMMAND</code> <code dir="ltr">ID</code> to a different value <span class="italic">after</span> allocating the channels and then back up the desired object. For example, enter the following in session 1:</p>
<pre dir="ltr">
RUN 
{
  ALLOCATE CHANNEL c1 TYPE disk;
  SET COMMAND ID TO 'sess1';
  BACKUP DATABASE;
}
</pre>
<p>Set the command ID to a string such as <code dir="ltr">sess2</code> in the job running in session 2:</p>
<pre dir="ltr">
RUN 
{
  ALLOCATE CHANNEL c1 TYPE sbt;
  SET COMMAND ID TO 'sess2';
  BACKUP DATABASE;
}
</pre></li>
<li>
<p>Start a SQL*Plus session and then query the joined <code dir="ltr">V$SESSION</code> and <code dir="ltr">V$PROCESS</code> views <span class="italic">while the RMAN job is executing</span>. For example, enter:</p>
<pre dir="ltr">
SELECT SID, SPID, CLIENT_INFO 
FROM   V$PROCESS p, V$SESSION s 
WHERE  p.ADDR = s.PADDR 
AND    CLIENT_INFO LIKE '%id=sess%';
</pre>
<p>If you run the <code dir="ltr">SET</code> <code dir="ltr">COMMAND</code> <code dir="ltr">ID</code> command in the RMAN job, then the <code dir="ltr">CLIENT_INFO</code> column displays in the following format:</p>
<pre dir="ltr">
id=<span class="italic">command_id</span>,rman channel=<span class="italic">channel_id</span>
</pre>
<p>For example, the following shows sample output:</p>
<pre dir="ltr">
 SID SPID         CLIENT_INFO
---- ------------ ------------------------------
  11 8358         id=sess1
  15 8638         id=sess2
  14 8374         id=sess1,rman channel=c1
   9 8642         id=sess2,rman channel=c1
</pre>
<p>The rows that contain the string <code dir="ltr">rman channel</code> show the channel performing the backup. The remaining rows are for the connections to the target database.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF153" href="../../backup.112/e10643/rcmsynta2014.htm#RCMRF153"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code dir="ltr">SET</code> <code dir="ltr">COMMAND</code> <code dir="ltr">ID</code> syntax, and <a class="olink REFRN" href="../../server.112/e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a> for more information about <code dir="ltr">V$SESSION</code> and <code dir="ltr">V$PROCESS</code></div>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006546"></a>
<div id="BRADV175" class="sect1">
<h2 class="sect1">Testing the Media Management API</h2>
<p><a id="sthref1775"></a><a id="sthref1776"></a>On some platforms, Oracle provides a diagnostic tool called <code dir="ltr">sbttest</code>. This utility performs a simple test of the media management software by acting as the Oracle database server and attempting to communicate with the media manager.</p>
<div id="BRADV89882" class="sect2"><a id="sthref1777"></a>
<h3 class="sect2">Obtaining the sbttest Utility</h3>
<p><a id="sthref1778"></a><a id="sthref1779"></a>On UNIX, the <code dir="ltr">sbttest</code> utility is typically located in <code dir="ltr">$ORACLE_HOME/bin</code>. If for some reason the utility is not included with your platform, then contact Oracle Support Services to obtain the C version of the program. You can compile this version of the program on all UNIX platforms.</p>
<p>On platforms such as Solaris, you do not have to relink when using <code dir="ltr">sbttest</code>. On other platforms, relinking may be necessary.</p>
</div>
<!-- class="sect2" -->
<div id="BRADV89883" class="sect2"><a id="sthref1780"></a>
<h3 class="sect2">Obtaining Online Documentation for the sbttest Utility</h3>
<p>For online documentation of <code dir="ltr">sbttest</code>, issue the following on the command line:</p>
<pre dir="ltr">
% sbttest
</pre>
<p>The program displays the list of possible arguments for the program:</p>
<pre dir="ltr">
Error: backup file name must be specified
Usage: sbttest backup_file_name # this is the only required parameter
               &lt;-dbname database_name&gt;
               &lt;-trace trace_file_name&gt;
               &lt;-remove_before&gt;
               &lt;-no_remove_after&gt; 
               &lt;-read_only&gt;
               &lt;-no_regular_backup_restore&gt;
               &lt;-no_proxy_backup&gt;
               &lt;-no_proxy_restore&gt;
               &lt;-file_type n&gt;
               &lt;-copy_number n&gt;
               &lt;-media_pool n&gt;
               &lt;-os_res_size n&gt;
               &lt;-pl_res_size n&gt;
               &lt;-block_size block_size&gt; 
               &lt;-block_count block_count&gt;
               &lt;-proxy_file os_file_name bk_file_name 
                           [os_res_size pl_res_size block_size block_count]&gt;
               &lt;-libname sbt_library_name&gt;
</pre>
<p>The display also indicates the meaning of each argument. For example, following is the description for two optional parameters:</p>
<pre dir="ltr">
Optional parameters:
  -dbname  specifies the database name which will be used by SBT
           to identify the backup file. The default is "sbtdb"
  -trace   specifies the name of a file where the Media Management 
           software will write diagnostic messages.
</pre></div>
<!-- class="sect2" -->
<div id="BRADV89884" class="sect2"><a id="sthref1781"></a>
<h3 class="sect2">Using the sbttest Utility</h3>
<p>Use <code dir="ltr">sbttest</code> to perform a quick test of the media manager.</p>
<p>If <code dir="ltr">sbttest</code> returns 0, then the test ran without error, which means that the media manager is correctly installed and can accept a data stream and return the same data when requested. If <code dir="ltr">sbttest</code> returns a nonzero value, then either the media manager is not installed or it is not configured correctly.</p>
<p><span class="bold">To use sbttest:</span></p>
<ol>
<li>
<p>Confirm that the program is installed and included in the system path by typing <code dir="ltr">sbttest</code> at the command line:</p>
<pre dir="ltr">
% sbttest
</pre>
<p>If the program is operational, then you should see a display of the online documentation.</p>
</li>
<li>
<p>Execute the program, specifying any of the arguments described in the online documentation. For example, enter the following to create test file <code dir="ltr">some_file.f</code> and write the output to <code dir="ltr">sbtio.log</code>:</p>
<pre dir="ltr">
% sbttest some_file.f -trace sbtio.log
</pre>
<p>You can also test a backup of an existing data file. For example, this command tests data file <code dir="ltr">tbs_33.f</code> of database <code dir="ltr">prod</code>:</p>
<pre dir="ltr">
% sbttest tbs_33.f -dbname prod
</pre></li>
<li>
<p>Examine the output. If the program encounters an error, then it provides messages describing the failure. For example, if the database cannot find the library, you see:</p>
<pre dir="ltr">
libobk.so could not be loaded. Check that it is installed properly, and that
 LD_LIBRARY_PATH environment variable (or its equivalent on your platform)
 includes the directory where this file can be found. Here is some additional
 information on the cause of this error:
ld.so.1: sbttest: fatal: libobk.so: open failed: No such file or directory
</pre></li>
</ol>
<p>In some cases, <code dir="ltr">sbttest</code> can work but an RMAN backup does not. The reasons can be the following:</p>
<ul>
<li>
<p>The user who starts <code dir="ltr">sbttest</code> is not the owner of the Oracle Database processes.</p>
</li>
<li>
<p>If the database server is not linked with the media management library or cannot load it dynamically when needed, then RMAN backups to the media manager fail, but <code dir="ltr">sbttest</code> may still work.</p>
</li>
<li>
<p>The <code dir="ltr">sbttest</code> program passes all environment parameters from the shell but RMAN does not.</p>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006620"></a>
<div id="BRADV176" class="sect1">
<h2 class="sect1">Terminating an RMAN Command</h2>
<p><a id="sthref1782"></a><a id="sthref1783"></a><a id="sthref1784"></a><a id="sthref1785"></a><a id="sthref1786"></a><a id="sthref1787"></a>There are several ways to terminate an RMAN command in the middle of execution:</p>
<ul>
<li>
<p>The preferred method is to press Control+C (or the equivalent "attention" key combination for your system) in the RMAN interface. This also terminates allocated channels, unless they are suspended in the media management code, as happens when, for example, they are waiting for a tape to be mounted.</p>
</li>
<li>
<p>You can end the server session corresponding to the RMAN channel by running the SQL <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM KILL SESSION</code> statement.</p>
</li>
<li>
<p>You can terminate the server session corresponding to the RMAN channel on the operating system.</p>
</li>
</ul>
<div id="BRADV89885" class="sect2"><a id="sthref1788"></a>
<h3 class="sect2">Terminating the Session with ALTER SYSTEM KILL SESSION</h3>
<p>You can identify the Oracle session ID for an RMAN channel by looking in the RMAN log for messages with the format shown in the following example:</p>
<pre dir="ltr">
channel ch1: sid=15 devtype=SBT_TAPE
</pre>
<p>The <code dir="ltr">sid</code> and <code dir="ltr">devtype</code> are displayed for each allocated channel. The Oracle Database <code dir="ltr">sid</code> is different from the operating system process ID. You can end the session using a SQL <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">KILL</code> <code dir="ltr">SESSION</code> statement.</p>
<p><code dir="ltr">ALTER SYSTEM KILL SESSION</code> takes two arguments, the <code dir="ltr">sid</code> printed in the RMAN message and a serial number, both of which can be obtained by querying <code dir="ltr">V$SESSION</code>. For example, run the following statement, where <code dir="ltr"><span class="codeinlineitalic">sid_in_rman_output</span></code> is the number from the RMAN message:</p>
<pre dir="ltr">
SELECT SERIAL# 
FROM   V$SESSION 
WHERE  SID=<span class="codeinlineitalic">sid_in_rman_output</span>;
</pre>
<p><a id="sthref1789"></a>Then, run the following statement, substituting the <code dir="ltr"><span class="codeinlineitalic">sid_in_rman_output</span></code> and serial number obtained from the query:</p>
<pre dir="ltr">
ALTER SYSTEM KILL SESSION '<span class="codeinlineitalic">sid_in_rman_output</span><span class="italic">,</span><span class="codeinlineitalic">serial#</span>';
</pre>
<p>This statement has no effect on the session if the session stopped in media manager code.</p>
</div>
<!-- class="sect2" -->
<div id="BRADV89886" class="sect2"><a id="sthref1790"></a>
<h3 class="sect2">Terminating the Session at the Operating System Level</h3>
<p>Finding and terminating the processes that are associated with the server sessions is operating system-specific. On some platforms, the server sessions are not associated with any processes at all. See your operating system-specific documentation for more information.</p>
</div>
<!-- class="sect2" -->
<a id="i1006645"></a>
<div id="BRADV89887" class="sect2">
<h3 class="sect2">Terminating an RMAN Session That Is Not Responding in the Media Manager</h3>
<p>You may sometimes need to terminate an RMAN job that is not responding in the media manager. The best way to terminate RMAN when the channel connections are not responding in the media manager is to terminate the session in the media manager. If this action does not solve the problem, then on some platforms, such as Linux, you may be able to terminate the Oracle Database processes of the connections. (Terminating the Oracle processes may cause problems with the media manager. See your media manager documentation for details.)</p>
<div id="BRADV89888" class="sect3"><a id="sthref1791"></a>
<h4 class="sect3">Components of an RMAN Session</h4>
<p>The nature of an RMAN session depends on the operating system. In UNIX, an RMAN session has the following processes associated with it:</p>
<ul>
<li>
<p>The <span class="italic">RMAN client process</span> itself</p>
</li>
<li>
<p>The <span class="italic">default channel</span>, the initial connection to the target database</p>
</li>
<li>
<p>One <span class="italic">target connection</span> to the target database corresponding to each allocated channel</p>
</li>
<li>
<p>The <span class="italic">catalog connection</span> to the recovery catalog database, if you use a recovery catalog</p>
</li>
<li>
<p>An <span class="italic">auxiliary connection</span> to an auxiliary instance, during <code dir="ltr">DUPLICATE</code> or TSPITR operations</p>
</li>
<li>
<p>A <span class="italic">polling connection</span> to the target database, used for monitoring RMAN command execution on the various allocated channels. By default, RMAN makes one polling connection. RMAN makes additional polling connections if you use different connect strings in the <code dir="ltr">ALLOCATE</code> <code dir="ltr">CHANNEL</code> or <code dir="ltr">CONFIGURE</code> <code dir="ltr">CHANNEL</code> commands. One polling connection exists for each distinct connect string used in the <code dir="ltr">ALLOCATE</code> <code dir="ltr">CHANNEL</code> or <code dir="ltr">CONFIGURE</code> <code dir="ltr">CHANNEL</code> command.</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<a id="i1006670"></a>
<div id="BRADV89889" class="sect3">
<h4 class="sect3">Process Behavior During a Suspended Job</h4>
<p>RMAN usually stops responding because a channel connection is waiting in the media manager code for a tape resource. The catalog connection and the default channel appear to suspend, because they are waiting for RMAN to tell them what to do. Polling connections seem to be in an infinite loop while polling the RPC under the control of the RMAN process.</p>
<p>If you terminate the RMAN process itself, then you also terminate the catalog connection, the auxiliary connection, the default channel, and the polling connections. If target and auxiliary connections are suspended but not while executing media manager code, they also terminate. If either the target connection or any of the auxiliary connections are executing in the media management layer, then they do not terminate until the processes are manually terminated at the operating system level.</p>
<p>Not all media managers can detect the termination of the Oracle Database process. Those which cannot may keep resources busy or continue processing. Consult your media manager documentation for details.</p>
<p>Terminating the catalog connection does not cause the RMAN process to terminate because RMAN is not performing catalog operations while the backup or restore is in progress. Removing default channel and polling connections causes the RMAN process to detect that one channel is no longer present and then exits. In this case, the connections to the unresponsive channels remain active as described previously.</p>
</div>
<!-- class="sect3" -->
<a id="i1011783"></a>
<div id="BRADV89890" class="sect3">
<h4 class="sect3">Terminating an RMAN Session: Basic Steps</h4>
<p>After the unresponsive channels in the media manager code are terminated, the RMAN process detects this termination and exits, removing all connections except target connections that are still operative in the media management layer. The warning about the media manager resources still applies in this case.</p>
<p><span class="bold">To terminate an Oracle Database process that is not responding in the media manager:</span></p>
<ol>
<li>
<p>Query <code dir="ltr">V$SESSION</code> and <code dir="ltr">V$SESSION_WAIT</code> as described in <a href="#i1008552">"Using V$ Views for RMAN Troubleshooting"</a>. For example, execute the following query:</p>
<pre dir="ltr">
COLUMN EVENT FORMAT a17
COLUMN SECONDS_IN_WAIT FORMAT 999
COLUMN STATE FORMAT a10
COLUMN CLIENT_INFO FORMAT a30

SELECT p.SPID, s.EVENT, s.SECONDS_IN_WAIT AS SEC_WAIT, 
       sw.STATE, s.CLIENT_INFO
FROM   V$SESSION_WAIT sw, V$SESSION s, V$PROCESS p
WHERE  sw.EVENT LIKE '%MML%'
AND    s.SID=sw.SID
AND    s.PADDR=p.ADDR;
</pre>
<p>Examine the SQL output to determine which SBT functions are waiting. For example, the output may be as follows:</p>
<pre dir="ltr">
SPID EVENT             SEC_WAIT   STATE      CLIENT_INFO
---- -----------------  ---------- ---------- -----------------------------
8642 Backup:MML write   600        WAITING    rman channel=ORA_SBT_TAPE_1
8374 Backup:MML write   600        WAITING    rman channel=ORA_SBT_TAPE_2
</pre></li>
<li>
<p>Using operating system-level tools appropriate to your platform, end the unresponsive sessions. For example, on Linux execute a <code dir="ltr">kill</code> <code dir="ltr">-9</code> command:</p>
<pre dir="ltr">
% kill -9 8642 8374
</pre>
<p>Some platforms include a command-line utility called <code dir="ltr">orakill</code> that enables you to terminate a specific thread. From a command prompt, run the following command, where <code dir="ltr"><span class="codeinlineitalic">sid</span></code> identifies the database instance to target, and the <code dir="ltr"><span class="codeinlineitalic">thread_id</span></code> is the <code dir="ltr">SPID</code> value from the query in Step 1:</p>
<pre dir="ltr">
orakill <span class="italic">sid</span> <span class="italic">thread_id</span>
</pre></li>
<li>
<p>Check that the media manager also clears its processes. If any remain, the next backup or restore operation may freeze again, due to the previous problems in the backup or restore operation. In some media managers, the only solution is to shut down and restart the media manager. If the documentation from the media manager does not provide the needed information, contact technical support for the media manager.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
Your operating system-specific documentation for the relevant commands</div>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1933">
<tr>
<td class="cellalignment1942">
<table class="cellalignment1938">
<tr>
<td class="cellalignment1937"><a href="rcmtunin.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1937"><a href="part_tra.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1944">
<table class="cellalignment1936">
<tr>
<td class="cellalignment1937"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1937"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1937"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1937"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1937"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1937"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
