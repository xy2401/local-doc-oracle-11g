<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Scoring and Deployment</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 025" />
<meta name="dcterms.created" content="2011-06-30T14:1:10Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Data Mining Application Developer's Guide" />
<meta name="dcterms.identifier" content="E12218-07" />
<meta name="dcterms.isVersionOf" content="DMPRG" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2005, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="models_building.htm" title="Previous" type="text/html" />
<link rel="Next" href="java_api.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e12218.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">13/15</span> <!-- End Header --><a id="CHDFHCDH"></a><a id="DMPRG004"></a>
<h1 class="chapter"><span class="secnum">6</span> Scoring and Deployment</h1>
<p>This chapter <a id="sthref318"></a>explains how to use data mining <a id="sthref319"></a>models to mine your data.</p>
<p>This chapter contains the following sections:</p>
<ul>
<li>
<p><a href="#BABDFEGD">In-Database Scoring</a></p>
</li>
<li>
<p><a href="#CHDDFBJB">What is Deployment?</a></p>
</li>
<li>
<p><a href="#CHDDCFED">Real-Time Scoring</a></p>
</li>
<li>
<p><a href="#BABHCGHH">Cost-Sensitive Decision Making</a></p>
</li>
<li>
<p><a href="#CHDCGHBG">Batch Apply</a></p>
</li>
</ul>
<a id="BABDFEGD"></a><a id="DMPRG223"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">In-Database Scoring</h2>
<p>Scoring, the application of models to new data, is a primary objective of data mining. Once the models have been built, the challenges come in deploying them to obtain the best results, and in maintaining them within a production environment.</p>
<p>In traditional data mining, models are built using specialized software on a remote system and deployed to another system for scoring. This is a cumbersome, error-prone process open to security violations and difficulties in data synchronization.</p>
<p>With Oracle Data Mining, scoring is easy and secure. The scoring engine and the data both reside within the database. Scoring is an extension to the SQL language, so the results of mining can easily be incorporated into applications and reporting systems.</p>
<p>In-database mining provides security, backup and recovery, and high performance. It minimizes the IT effort needed to support data mining initiatives. Using standard database techniques, models can easily be refreshed (re-created) on more recent data and redeployed. The deployment is immediate since the scoring query remains the same; only the underlying model is replaced in the database.</p>
</div>
<!-- class="sect1" -->
<a id="CHDDFBJB"></a><a id="DMPRG224"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">What is Deployment?</h2>
<p><a id="sthref320"></a>Deploying a model means using it within a target environment. Model deployment could be:</p>
<ul>
<li>
<p>Scoring data either for batch or <a id="sthref321"></a>real-time results</p>
</li>
<li>
<p>Extracting model details to produce reports. For example: the rules from a Decision Tree model, or the attribute rankings from an Attribute Importance model</p>
</li>
<li>
<p>Extending the business intelligence infrastructure of a data warehouse by incorporating mining results in applications or operational systems</p>
</li>
<li>
<p>Moving a model from the database where it was built to the database where it will be used for scoring (export/import)</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink DMADM010" href="../../datamine.112/e16807/schemaobjs.htm#DMADM010"><span class="italic">Oracle Data Mining Administrator's Guide</span></a> for information about exporting and importing data mining models</div>
</div>
<!-- class="sect1" -->
<a id="CHDDCFED"></a><a id="DMPRG225"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Real-Time Scoring</h2>
<p>Oracle Data Mining SQL functions enable prediction, clustering, and feature extraction analysis to be easily integrated into live production and operational systems. Because mining results are returned within SQL queries, mining can occur in real time.</p>
<p>With real-time scoring, point-of-sales database transactions can be mined. Predictions and rule sets can be generated to help front-line workers make better analytical decisions. Real-time scoring enables fraud detection, identification of potential liabilities, and recognition of better marketing and selling opportunities.</p>
<p>The query in <a href="#CIHEFAAJ">Example 6-1</a> uses a <a id="sthref322"></a>Decision Tree model named <code>dt_sh_clas_sample</code> to predict the probability that customer 101488 will use an affinity card. A customer representative could retrieve this information in real time when talking to this customer on the phone. Based on the query result, the representative might offer an extra-value card, since there is a 73% chance that the customer will use a card.</p>
<div class="example">
<p class="titleinexample"><a id="CIHEFAAJ"></a><a id="DMPRG226"></a>Example 6-1 Real-Time Query with Prediction Probability</p>
<pre>
SELECT <a id="sthref323"></a>PREDICTION_PROBABILITY(dt_sh_clas_sample, 1 USING *) cust_card_prob
       FROM mining_data_apply_v
       WHERE cust_id = 101488;

CUST_CARD_PROB--------------    .727642276
</pre></div>
<!-- class="example" -->
<a id="DMPRG227"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref324"></a>
<h3 class="sect2">Prediction</h3>
<p>Oracle Data Mining supports six SQL functions that return results from predictive models (classification or regression).</p>
<p>Predictive models produce a target value for each row (case) in the scoring data. Each SQL function returns different information from the scoring results.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink DMCON042" href="../../datamine.112/e16808/part2.htm#DMCON042"><span class="italic">Oracle Data Mining Concepts</span></a> for information on classification and regression</div>
<a id="DMPRG228"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref325"></a>
<h4 class="sect3">Best Prediction</h4>
<p>(Classification or regression). For classification, the <code><a id="sthref326"></a>PREDICTION</code> function returns the target value that is predicted with the highest probability (or lowest cost, if costs are specified). For regression, <code>PREDICTION</code> returns the best predicted target value.</p>
<p><code>PREDICTION</code> supports costs for classification. See <a href="#BABHCGHH">"Cost-Sensitive Decision Making"</a>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF06219" href="../../server.112/e41084/functions132.htm#SQLRF06219"><span class="italic">Oracle Database SQL Language Reference</span></a> for syntax and an example that uses <code>PREDICTION</code></div>
</div>
<!-- class="sect3" -->
<a id="DMPRG229"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref327"></a>
<h4 class="sect3">Confidence Bounds (GLM only)</h4>
<p>(Classification or regression) The <code><a id="sthref328"></a>PREDICTION_BOUNDS</code> function returns the upper and lower confidence bounds computed by the model.</p>
<p>Confidence is the degree of certainty that the true value (regression) or probability (classification) lies within the bounded interval. The default confidence is .95. Confidence can be specified by the user in the <code>GLMS_CONF_LEVEL</code> setting for the model. You can override the confidence associated with the model by specifying the confidence inline when you invoke the <code>PREDICTION_BOUNDS</code> function.</p>
<p>No confidence bounds are returned if ridge regression is being used by the algorithm.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SQLRF20020" href="../../server.112/e41084/functions133.htm#SQLRF20020"><span class="italic">Oracle Database SQL Language Reference</span></a> for syntax and an example that uses <code>PREDICTION_BOUNDS</code></p>
</li>
<li>
<p><a class="olink DMCON022" href="../../datamine.112/e16808/algo_glm.htm#DMCON022"><span class="italic">Oracle Data Mining Concepts</span></a> for information on GLM</p>
</li>
<li>
<p><a class="olink ARPLS196" href="../../appdev.112/e40758/d_datmin.htm#ARPLS196"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information on <code>GET_MODEL_DETAILS_GLM</code></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="DMPRG230"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref329"></a>
<h4 class="sect3"><a id="sthref330"></a>Costs</h4>
<p>(Classification only) The <code><a id="sthref331"></a>PREDICTION_COST</code> function returns the cost associated with the class that is predicted with the lowest cost. If you specify a class, the function returns the cost associated with that class.</p>
<p>Costs are a user-specified biasing mechanism for classification. See <a href="#BABHCGHH">"Cost-Sensitive Decision Making"</a>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF06210" href="../../server.112/e41084/functions134.htm#SQLRF06210"><span class="italic">Oracle Database SQL Language Reference</span></a> for syntax and an example that uses <code>PREDICTION_COST</code></div>
</div>
<!-- class="sect3" -->
<a id="DMPRG231"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref332"></a>
<h4 class="sect3"><a id="sthref333"></a>Rules (<a id="sthref334"></a>Decision Tree only)</h4>
<p>(Classification only) The <code>PREDICTION_DETAILS</code> function returns the rule of a Decision Tree model corresponding to the given prediction. A rule is the condition (combination of attribute values) that leads to a specific classification.</p>
<p>Decision Tree rule identifiers are returned as XML. The full rules can be retrieved with the <code><a id="sthref335"></a>GET_MODEL_DETAILS_XML</code> function.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SQLRF06211" href="../../server.112/e41084/functions135.htm#SQLRF06211"><span class="italic">Oracle Database SQL Language Reference</span></a> for syntax and an example that uses <code>PREDICTION_DETAILS</code></p>
</li>
<li>
<p><a class="olink DMCON019" href="../../datamine.112/e16808/algo_decisiontree.htm#DMCON019"><span class="italic">Oracle Data Mining Concepts</span></a> for information about Decision Tree</p>
</li>
<li>
<p><a class="olink ARPLS196" href="../../appdev.112/e40758/d_datmin.htm#ARPLS196"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information on <code>GET_MODEL_DETAILS_XML</code></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="DMPRG232"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref336"></a>
<h4 class="sect3">Probability</h4>
<p>(Classification only) The <code><a id="sthref337"></a>PREDICTION_PROBABILITY</code> function returns the probability associated with the best prediction (prediction with the highest probability) or the probability associated with the class that you specify.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF06212" href="../../server.112/e41084/functions136.htm#SQLRF06212"><span class="italic">Oracle Database SQL Language Reference</span></a> for syntax and an example that uses <code>PREDICTION_PROBABILITY</code></div>
</div>
<!-- class="sect3" -->
<a id="DMPRG233"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref338"></a>
<h4 class="sect3">Per-Class Results</h4>
<p>(Classification only) The <code><a id="sthref339"></a>PREDICTION_SET</code> function returns all the target classes, associated probabilities, and associated costs (if specified) for each scored row. You can specify parameters to restrict the output of the function.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SQLRF06233" href="../../server.112/e41084/functions137.htm#SQLRF06233"><span class="italic">Oracle Database SQL Language Reference</span></a> for syntax and an example that uses <code>PREDICTION_SET</code></p>
</li>
<li>
<p><a href="#BABHCGHH">"Cost-Sensitive Decision Making"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="DMPRG234"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref340"></a>
<h3 class="sect2">Clustering</h3>
<p>Oracle Data Mining supports three SQL functions that return results when applying <a id="sthref341"></a>clustering models.</p>
<p>Clustering models assign each row to a cluster with an associated probability. Each SQL function returns different information from the scoring results.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink DMCON008" href="../../datamine.112/e16808/clustering.htm#DMCON008"><span class="italic">Oracle Data Mining Concepts</span></a> for information on clustering</div>
<a id="DMPRG235"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref342"></a>
<h4 class="sect3">Cluster Identifier</h4>
<p>The <code><a id="sthref343"></a>CLUSTER_ID</code> function returns the identifier of the cluster predicted with the highest probability.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF06213" href="../../server.112/e41084/functions027.htm#SQLRF06213"><span class="italic">Oracle Database SQL Language Reference</span></a> for syntax and an example that uses <code>CLUSTER_ID</code></div>
</div>
<!-- class="sect3" -->
<a id="DMPRG236"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref344"></a>
<h4 class="sect3">Probability</h4>
<p>The <code><a id="sthref345"></a>CLUSTER_PROBABILITY</code> function returns the probability associated with the cluster to which cases are most likely to be assigned. If you specify a cluster ID, the function returns the probability associated with that cluster.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF06214" href="../../server.112/e41084/functions028.htm#SQLRF06214"><span class="italic">Oracle Database SQL Language Reference</span></a> for syntax and an example that uses <code>CLUSTER_PROBABILITY</code></div>
</div>
<!-- class="sect3" -->
<a id="DMPRG237"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref346"></a>
<h4 class="sect3">Per-Cluster Probabilities</h4>
<p>The <code><a id="sthref347"></a>CLUSTER_SET</code> function returns the probability associated with each cluster for each scored row. You can specify parameters to restrict the output of the function.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="DMPRG238"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref348"></a>
<h3 class="sect2">Feature Extraction</h3>
<p>Oracle Data Mining supports three SQL functions that return results from <a id="sthref349"></a>feature extraction models.</p>
<p>Feature extraction models combine the attributes into a set<a id="sthref350"></a> of features that capture important characteristics of the data. The scoring process generates a value of each feature for each row. The value is a number that identifies the match quality of the case to the feature. Each SQL function returns different information from the scoring results.</p>
<a id="DMPRG239"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref351"></a>
<h4 class="sect3">Feature Identifier</h4>
<p>The <code><a id="sthref352"></a>FEATURE_ID</code> function returns the identifier of the feature with the highest value (match quality) for the data.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF06216" href="../../server.112/e41084/functions062.htm#SQLRF06216"><span class="italic">Oracle Database SQL Language Reference</span></a> for syntax and an example that uses <code>FEATURE_ID</code></div>
</div>
<!-- class="sect3" -->
<a id="DMPRG240"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref353"></a>
<h4 class="sect3">Match Quality</h4>
<p>The <code><a id="sthref354"></a>FEATURE_VALUE</code> function returns the highest feature value. If you specify a feature ID, the function returns the value of that feature.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF06218" href="../../server.112/e41084/functions064.htm#SQLRF06218"><span class="italic">Oracle Database SQL Language Reference</span></a> for syntax and an example that uses <code>FEATURE_VALUE</code></div>
</div>
<!-- class="sect3" -->
<a id="DMPRG241"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref355"></a>
<h4 class="sect3">Per-Feature Values</h4>
<p>The <code><a id="sthref356"></a>FEATURE_SET</code> function returns the values associated with each feature for each scored row. You can specify parameters to restrict the output of the function.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF06217" href="../../server.112/e41084/functions063.htm#SQLRF06217"><span class="italic">Oracle Database SQL Language Reference</span></a> for syntax and an example that uses <code>FEATURE_SET</code></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="DMPRG242"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref357"></a>
<h3 class="sect2">Save Scoring Results in a Table</h3>
<p>If you wish to save the results of a scoring function, you can store <a id="sthref358"></a>them in a table.</p>
<p>This example shows how to save the results of scoring a customer response model.</p>
<pre>
UPDATE CUST_RESPONSE_APPLY_UPDATE
SET prediction = prediction(CUST_RESPONSE19964_DT using *),
     probability =  prediction_probability(CUST_RESPONSE19964_DT using *)
</pre>
<p>The table in question has all of the predictors, and has columns to hold the prediction and probability. The assumption is that any necessary transformations are embedded in the model (otherwise the using clause would need to contain them).</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABHCGHH"></a><a id="DMPRG243"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Cost-Sensitive Decision Making</h2>
<p><a id="sthref359"></a>Costs are user-specified numbers that bias classification. The algorithm uses positive numbers to penalize more expensive outcomes over less expensive outcomes. Higher numbers indicate higher costs. The algorithm uses negative numbers to favor more beneficial outcomes over less beneficial outcomes. Lower negative numbers indicate higher benefits.</p>
<p>All classification algorithms can use costs for scoring. You can specify the costs in a cost matrix table, or you can specify the costs inline when scoring. The <code>PREDICTION</code>, <code>PREDICTION_COST</code>, and <code>PREDICTION_SET</code> functions all support costs.</p>
<p>A sample <a id="sthref360"></a>cost matrix table is shown in <a href="#BABECBFD">Table 6-1</a>.</p>
<div class="tblformal">
<p class="titleintable"><a id="DMPRG244"></a><a id="sthref361"></a><a id="BABECBFD"></a>Table 6-1 Sample Cost Matrix Table</p>
<table class="cellalignment1303" title="Sample Cost Matrix Table" summary="Columns of a cost matrix table" dir="ltr">
<thead>
<tr class="cellalignment1297">
<th class="cellalignment1304" id="r1c1-t16">ACTUAL_TARGET_VALUE</th>
<th class="cellalignment1304" id="r1c2-t16">PREDICTED_TARGET_VALUE</th>
<th class="cellalignment1304" id="r1c3-t16">COST</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1297">
<td class="cellalignment1305" id="r2c1-t16" headers="r1c1-t16">
<p>0</p>
</td>
<td class="cellalignment1305" headers="r2c1-t16 r1c2-t16">
<p>0</p>
</td>
<td class="cellalignment1305" headers="r2c1-t16 r1c3-t16">
<p>0</p>
</td>
</tr>
<tr class="cellalignment1297">
<td class="cellalignment1305" id="r3c1-t16" headers="r1c1-t16">
<p>0</p>
</td>
<td class="cellalignment1305" headers="r3c1-t16 r1c2-t16">
<p>1</p>
</td>
<td class="cellalignment1305" headers="r3c1-t16 r1c3-t16">
<p>2</p>
</td>
</tr>
<tr class="cellalignment1297">
<td class="cellalignment1305" id="r4c1-t16" headers="r1c1-t16">
<p>1</p>
</td>
<td class="cellalignment1305" headers="r4c1-t16 r1c2-t16">
<p>0</p>
</td>
<td class="cellalignment1305" headers="r4c1-t16 r1c3-t16">
<p>1</p>
</td>
</tr>
<tr class="cellalignment1297">
<td class="cellalignment1305" id="r5c1-t16" headers="r1c1-t16">
<p>1</p>
</td>
<td class="cellalignment1305" headers="r5c1-t16 r1c2-t16">
<p>1</p>
</td>
<td class="cellalignment1305" headers="r5c1-t16 r1c3-t16">
<p>0</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p>The cost matrix in <a href="#BABECBFD">Table 6-1</a> specifies costs for a binary target. The matrix indicates that the algorithm should treat a misclassified 0 as twice as costly as a misclassified 1. If the table name is <code>cost_tbl</code> and it is associated with the Naive Bayes model <code>nb_sh_clas_sample</code>, then the following query takes <code>cost_tbl</code> into account when scoring <code>nb_sh_clas_sample</code>. The output will be restricted to those rows where a prediction of 1 is less costly then a prediction of 0.</p>
<pre>
SELECT cust_gender, COUNT(*) AS cnt, ROUND(AVG(age)) AS avg_age
   FROM mining_data_apply_v
   WHERE <a id="sthref362"></a>PREDICTION (nb_sh_clas_sample COST MODEL
      USING cust_marital_status, education, household_size) = 1
   GROUP BY cust_gender
   ORDER BY cust_gender;
</pre>
<p>If there is a possibility that the cost matrix table is not present, or that a cost matrix was not specified for the model, you can use the <code>AUTO</code> keyword with <code>COST</code> <code>MODEL</code> so that scoring only uses costs if the cost matrix is available.</p>
<pre>
SELECT cust_gender, COUNT(*) AS cnt, ROUND(AVG(age)) AS avg_age
   FROM mining_data_apply_v
   WHERE PREDICTION (nb_sh_clas_sample COST MODEL AUTO
      USING cust_marital_status, education, household_size) = 1
   GROUP BY cust_gender
   ORDER BY cust_gender;
</pre>
<p>You can specify the costs inline when you invoke the scoring function. The inline costs are used for scoring even if a cost matrix table is associated with the model. Here is the same query with the costs specified inline.</p>
<pre>
SELECT cust_gender, COUNT(*) AS cnt, ROUND(AVG(age)) AS avg_age
   FROM mining_data_apply_v
   WHERE PREDICTION (nb_sh_clas_sample
                     COST (0,1) values ((0, 2),
                                        (1, 0))
                     USING cust_marital_status, education, household_size) = 1
   GROUP BY cust_gender
   ORDER BY cust_gender;
</pre>
<p>To associate a cost matrix table with a model for scoring, use the <code>ADD_COST_MATRIX</code> procedure in the <code>DBMS_DATA_MINING</code> package. You can retrieve the cost matrix with the <code>GET_COST_MATRIX</code> function. The <code>REMOVE_COST_MATRIX</code> procedure removes the cost matrix. If you want to use a different cost matrix table with a model, first remove the existing one then add the new one.</p>
<pre>
-- add cost matrix table cost_tbl
-- to model nb_sh_clas_sample
-- for scoring
--
EXEC DBMS_DATA_MINING.<a id="sthref363"></a>ADD_COST_MATRIX('nb_sh_clas_sample', 'cost_tbl');
--
-- replace cost_tbl with cost_tbl_2
--
EXEC DBMS_DATA_MINING.<a id="sthref364"></a>REMOVE_COST_MATRIX('nb_sh_clas_sample', 'cost_tbl');
EXEC DBMS_DATA_MINING.ADD_COST_MATRIX('nb_sh_clas_sample', 'cost_tbl_2');
</pre>
<p>The Decision Tree algorithm can use costs to bias the model build. If you want to create a Decision Tree model with costs, create a cost matrix table and provide its name in the <code>CLAS_COST_TABLE_NAME</code> setting for the model. If you specify costs when scoring the model, the cost matrix used to create the model will be used. If you want to use a different cost matrix table for scoring, first remove the existing cost matrix table then add the new one.</p>
</div>
<!-- class="sect1" -->
<a id="CHDCGHBG"></a><a id="DMPRG245"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Batch Apply</h2>
<p><a id="sthref365"></a>Oracle Data <a id="sthref366"></a>Mining supports a batch apply operation that writes the results of scoring directly to a table. The columns in the table are mining function-dependent. The apply operation is accomplished by <code>DBMS_DATA_MINING.APPLY</code>.</p>
<p><code>APPLY</code> creates an output table with the columns shown in <a href="#BABIHCEC">Table 6-2</a>.</p>
<div class="tblformal">
<p class="titleintable"><a id="DMPRG246"></a><a id="sthref367"></a><a id="BABIHCEC"></a>Table 6-2 APPLY Output Table</p>
<table class="cellalignment1303" title="APPLY Output Table" summary="Columns in Apply output table" dir="ltr">
<thead>
<tr class="cellalignment1297">
<th class="cellalignment1304" id="r1c1-t17">Mining Function</th>
<th class="cellalignment1304" id="r1c2-t17">Output Columns</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1297">
<td class="cellalignment1305" id="r2c1-t17" headers="r1c1-t17">
<p>classification</p>
</td>
<td class="cellalignment1305" headers="r2c1-t17 r1c2-t17">
<p><code>CASE_ID</code></p>
<p><code>PREDICTION</code></p>
<p><code>PROBABILITY</code></p>
</td>
</tr>
<tr class="cellalignment1297">
<td class="cellalignment1305" id="r3c1-t17" headers="r1c1-t17">
<p>regression</p>
</td>
<td class="cellalignment1305" headers="r3c1-t17 r1c2-t17">
<p><code>CASE_ID</code></p>
<p><code>PREDICTION</code></p>
</td>
</tr>
<tr class="cellalignment1297">
<td class="cellalignment1305" id="r4c1-t17" headers="r1c1-t17">
<p>anomaly detection (one-class SVM)</p>
</td>
<td class="cellalignment1305" headers="r4c1-t17 r1c2-t17">
<p><code>CASE_ID</code></p>
<p><code>PREDICTION</code></p>
<p><code>PROBABILITY</code></p>
</td>
</tr>
<tr class="cellalignment1297">
<td class="cellalignment1305" id="r5c1-t17" headers="r1c1-t17">
<p>clustering</p>
</td>
<td class="cellalignment1305" headers="r5c1-t17 r1c2-t17">
<p><code>CASE_ID</code></p>
<p><code>CLUSTER_ID</code></p>
<p><code>PROBABILITY</code></p>
</td>
</tr>
<tr class="cellalignment1297">
<td class="cellalignment1305" id="r6c1-t17" headers="r1c1-t17">
<p>feature extraction</p>
</td>
<td class="cellalignment1305" headers="r6c1-t17 r1c2-t17">
<p><code>CASE_ID</code></p>
<p><code>FEATURE_ID</code></p>
<p><code>MATCH_QUALITY</code></p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p><a href="#CIHHGHDA">Example 6-2</a> illustrates <a id="sthref368"></a>anomaly detection with <code>APPLY</code>. The query of the <code>APPLY</code> output table returns the ten first customers in the table. Each has a a probability for being typical (1) and a probability for being anomalous (0).</p>
<div class="example">
<p class="titleinexample"><a id="CIHHGHDA"></a><a id="DMPRG247"></a>Example 6-2 Anomaly Detection with DBMS_DATA_MINING.APPLY</p>
<pre>
EXEC dbms_data_mining.apply
        ('SVMO_SH_Clas_sample','svmo_sh_sample_prepared', 
         'cust_id', 'one_class_output'); 

SELECT * from one_class_output where rownum &lt; 11;
 
   CUST_ID PREDICTION PROBABILITY
---------- ---------- -----------
    101798          1  .567389309
    101798          0  .432610691
    102276          1  .564922469
    102276          0  .435077531
    102404          1   .51213544
    102404          0   .48786456
    101891          1  .563474346
    101891          0  .436525654
    102815          0  .500663683
    102815          1  .499336317
</pre></div>
<!-- class="example" -->
<a id="DMPRG248"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref369"></a>
<h3 class="sect2">Comparing APPLY and SQL Scoring Functions</h3>
<p>Whether performed by <code>APPLY</code> or by a SQL scoring function, scoring generates the same mining results. Classification produces a prediction and a probability for each case; clustering produces a cluster ID and a probability for each case, and so on. The difference lies in the way that scoring results are captured and the mechanisms that can be used for retrieving them.</p>
<p>Since <code>APPLY</code> output is stored separately from the scoring data, it must be joined to the scoring data to support queries that include the data attributes being mined (the scored rows). Thus any model that will be used with <code>APPLY</code> must have a case ID.</p>
<p>A <a id="sthref370"></a>case ID is not required for models that will be applied with SQL scoring functions. Likewise, storage and joins are not required, since scoring results are generated and consumed in real time within a SQL query.</p>
<p>The SQL scoring functions offer flexibility. You can invoke the function that returns the specific information you need. You simply reference a model and identify the kind of mining results you want to retrieve.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1296">
<tr>
<td class="cellalignment1305">
<table class="cellalignment1301">
<tr>
<td class="cellalignment1300"><a href="models_building.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1300"><a href="java_api.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2005, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1307">
<table class="cellalignment1299">
<tr>
<td class="cellalignment1300"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1300"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1300"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1300"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1300"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1300"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
