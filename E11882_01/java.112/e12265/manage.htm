<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Using the Connection Pool Manager</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.1 Build 018" />
<meta name="dcterms.created" content="2009-09-10T18:4:7Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Universal Connection Pool for JDBC Developer's Guide" />
<meta name="dcterms.identifier" content="E12265-02" />
<meta name="dcterms.isVersionOf" content="JJUCP" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2009,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="con_behv.htm" title="Previous" type="text/html" />
<link rel="Next" href="rac.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e12265.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">10/14</span> <!-- End Header --><a id="BABICIII"></a>
<h1 class="chapter"><span class="secnum">7</span> Using the Connection Pool Manager</h1>
<p>The following sections are included in this chapter:</p>
<ul>
<li>
<p><a href="#CACEACEI">Using the UCP Manager</a></p>
</li>
<li>
<p><a href="#CACJHBEC">Accessing JMX-based Management</a></p>
</li>
</ul>
<a id="CACEACEI"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Using the UCP Manager</h2>
<p>The Universal Connection Pool (UCP) manager creates and maintains UCP instances. A pool instance is registered with the pool manager every time a new pool is created. This section covers the following topics:</p>
<ul>
<li>
<p><a href="#BABGHEDJ">Connection Pool Manager Overview</a></p>
</li>
<li>
<p><a href="#BABHBFAA">Creating a Connection Pool Manager</a></p>
</li>
<li>
<p><a href="#BABFBFDE">Controlling the Lifecycle of a Connection</a></p>
</li>
<li>
<p><a href="#BABFBFJA">Performing Maintenance on a Connection Pool</a></p>
</li>
</ul>
<a id="BABGHEDJ"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Connection Pool Manager Overview</h3>
<p><a id="sthref263"></a><a id="sthref264"></a><a id="sthref265"></a>Applications use a connection pool manager to explicitly create and manage UCP JDBC connection pools. Applications use the manager because it offers full lifecycle control, such as creating, starting, stopping, and destroying a connection pool. Applications also use the manager to perform routine maintenance on the connection pool, such as refreshing, recycling, and purging connections in a pool. Lastly, applications use the connection pool manager because it offers a centralized integration point for administrative tools and consoles.</p>
</div>
<!-- class="sect2" -->
<a id="BABHBFAA"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Creating a Connection Pool Manager</h3>
<p><a id="sthref266"></a><a id="sthref267"></a><a id="sthref268"></a><a id="sthref269"></a>A connection pool manager is an instance of the <code>UniversalConnectionPoolManager</code> interface, which is located in the <code>oracle.ucp.admin</code> package. The manager is a Singleton instance that is used to manage multiple connection pools per JVM. The interface includes methods for interacting with a connection pool manager. UCP for JDBC includes an implementation that is used to get a connection pool manager instance. The following example demonstrates creating a connection pool manager instance using the implementation:</p>
<pre>
UniversalConnectionPoolManager mgr = UniversalConnectionPoolManagerImpl. getUniversalConnectionPoolManager();
</pre></div>
<!-- class="sect2" -->
<a id="BABFBFDE"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Controlling the Lifecycle of a Connection</h3>
<p><a id="sthref270"></a><a id="sthref271"></a>Applications use the connection pool manager to explicitly control the lifecycle of connection pools. The manager is used to create, start, stop, and destroy connection pools. Lifecycle methods are included as part of the <code>UniversalConnectionPoolManager</code> interface.</p>
<p class="subhead2"><a id="sthref272"></a>Understanding Lifecycle States</p>
<p><a id="sthref273"></a>The lifecycle states of a connection pool affects what manager operations can be performed on a connection pool. Applications that explicitly control the lifecycle of a pool must ensure that the manager's operations are used only when the pool is in an appropriate state. Lifecycle constraints are discussed throughout this section.</p>
<p>The following list describes the lifecycle states of a pool:</p>
<ul>
<li>
<p>Starting &ndash; Indicates that the connection pool's start method has been called and it is in the process of starting up.</p>
</li>
<li>
<p>Running &ndash; Indicates that the connection pool has been started and is ready to give out connections.</p>
</li>
<li>
<p>Stopping &ndash; Indicates that the connection pool is in the process of stopping.</p>
</li>
<li>
<p>Stopped &ndash; Indicates that the connection pool is stopped.</p>
</li>
<li>
<p>Failed &ndash; Indicates that the connection pool has encountered failures during starting, stopping, or execution.</p>
</li>
</ul>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref274"></a>
<h4 class="sect3">Creating a Connection Pool</h4>
<p><a id="sthref275"></a><a id="sthref276"></a><a id="sthref277"></a>The manager's <code>CreateConnectionPool</code> method creates and registers a connection pool. The manager uses a connection pool adapter to create the pool and relies on a pool-enabled data source to configure the pool's properties. A connection pool name must be defined as part of the configuration and provides a way to refer to specific pools when interacting with the manager. A connection pool name must be unique and cannot be used by more than one connection pool.</p>
<p>The following example demonstrates creating a connection pool instance when using a manager:</p>
<pre>
UniversalConnectionPoolManager mgr = UniversalConnectionPoolManagerImpl. getUniversalConnectionPoolManager();

PoolDataSource  pds = PoolDataSourceFactory.getPoolDataSource();
pds.setConnectionPoolName("mgr_pool");
pds.setConnectionFactoryClassName("oracle.jdbc.pool.OracleDataSource");
pds.setURL("jdbc:oracle:thin:@//localhost:1521/XE");
pds.setUser("<span class="italic">&lt;user&gt;</span>");
pds.setPassword("<span class="italic">&lt;password&gt;</span>");

mgr.createConnectionPool((UniversalConnectionPoolAdapter)pds);
</pre>
<p>An application does not have to use the manager to create a pool in order for the pool to be managed. A pool that is implicitly created (that is, automatically created when using a pool-enabled data source) and configured with a pool name is automatically registered and managed by the pool manager. Oracle recommends implicit pool creation.9</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The manager throws an exception if a connection pool already exists with the same name. An application must not implicitly start a connection pool before using the <code>createConnectionPool</code> method to explicitly create the same pool.</div>
</div>
<!-- class="sect3" -->
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref278"></a>
<h4 class="sect3">Starting a Connection Pool</h4>
<p><a id="sthref279"></a><a id="sthref280"></a><a id="sthref281"></a><a id="sthref282"></a>The manager's <code>startConnectionPool</code> method starts a connection pool using the pool name as a parameter to determine which pool to start. The pool name is defined as a pool property on a pool-enabled data source.</p>
<p>The following example demonstrates starting a connection pool:</p>
<pre>
mgr.startConnectionPool("mgr_pool");
</pre>
<p>An application must always create a connection pool using the manager's <code>createConnectionPool</code> method prior to starting the pool. In addition, a lifecycle state exception occurs if an application attempts to start a pool that has been previously started or if the pool is in a state other than stopped or failed.</p>
</div>
<!-- class="sect3" -->
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref283"></a>
<h4 class="sect3">Stopping a Connection Pool</h4>
<p><a id="sthref284"></a><a id="sthref285"></a><a id="sthref286"></a><a id="sthref287"></a>The manager's <code>stopConnectionPool</code> method stops a connection pool using the pool name as a parameter to determine which pool to stop. The pool name is defined as a pool property on the pool-enabled data source. Stopping a connection pool closes all available and borrowed connections.</p>
<p>The following example demonstrates stopping a connection pool:</p>
<pre>
mgr.stopConnectionPool("mgr_pool");
</pre>
<p>An application can use the manager to stop a connection pool that was started implicitly or explicitly. An error occurs if an application attempts to stop a pool that does not exist or if the pool is in a state other than started or starting.</p>
</div>
<!-- class="sect3" -->
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref288"></a>
<h4 class="sect3">Destroying a Connection Pool</h4>
<p><a id="sthref289"></a><a id="sthref290"></a><a id="sthref291"></a><a id="sthref292"></a>The manager's <code>destroyConnectionPool</code> method stops a connection pool and removes it from the connection pool manager. A pool name is used as a parameter to determine which pool to destroy. The pool name is defined as a pool property on the pool-enabled data source.</p>
<p>The following example demonstrates destroying a connection pool:</p>
<pre>
mgr.destroyConnectionPool("mgr_pool");
</pre>
<p>An application cannot start a connection pool that has been destroyed and must explicitly create and start a new connection pool.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BABFBFJA"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Performing Maintenance on a Connection Pool</h3>
<p><a id="sthref293"></a>Applications use the connection pool manager to perform maintenance on a connection pool. Maintenance includes refreshing, recycling, and purging a connection pool. The maintenance methods are included as part of the <code>UniversalConnectionPoolManager</code> interface.</p>
<p>Maintenance is typically performed to remove and replace invalid connections and ensures a high availability of valid connections. Invalid connections typically cannot be used to connect to a database but are still maintained by the pool. These connections waste system resources and directly affect a pool's maximum connection limit. Ultimately, too many invalid connections negatively affects an applications performance.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Applications can check whether or not a connection is valid when borrowing the connection from the pool. See <a href="connect.htm#CHDIDJGH">"Validating Connections in UCP"</a> for detailed information. If an application consistently has a high number of invalid connections, additional testing should be performed to determine the cause.</div>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref294"></a>
<h4 class="sect3">Refreshing a Connection Pool</h4>
<p><a id="sthref295"></a><a id="sthref296"></a><a id="sthref297"></a><a id="sthref298"></a>Refreshing a connection pool replaces every connection in the pool with a new connection. Any connections that are currently borrowed are marked for removal and refreshed after the connection is returned to the pool. The manager's <code>refreshConnectionPool</code> method refreshes a connection pool using the pool name as a parameter to determine which pool to refresh. The pool name is defined as a pool property on the pool-enabled data source.</p>
<p>The following example demonstrates refreshing a connection pool:</p>
<pre>
mgr.refreshConnectionPool("mgr_pool");
</pre></div>
<!-- class="sect3" -->
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref299"></a>
<h4 class="sect3">Recycling a Connection Pool</h4>
<p><a id="sthref300"></a><a id="sthref301"></a><a id="sthref302"></a><a id="sthref303"></a>Recycling a connection pool replaces only invalid connection in the pool with a new connection and does not replace borrowed connections. The manager's <code>recycleConnectionPool</code> method recycles a connection pool using the pool name as a parameter to determine which pool to recycle. The pool name is defined as a pool property on the pool-enabled data source.</p>
<p>The <code>setSQLForValidateConnection</code> property must be set when using non-Oracle drivers. UCP for JDBC uses this property to determine whether or not a connection is valid before recycling the connection. See <a href="connect.htm#CHDIDJGH">"Validating Connections in UCP"</a> for more information on using the <code>setSQLForValidateConnection</code> property.</p>
<p>The following example demonstrates recycling a connection pool:</p>
<pre>
mgr.recycleConnectionPool("mgr_pool");
</pre></div>
<!-- class="sect3" -->
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref304"></a>
<h4 class="sect3">Purging a Connection Pool</h4>
<p><a id="sthref305"></a><a id="sthref306"></a><a id="sthref307"></a><a id="sthref308"></a>Purging a connection pool removes every connection (available and borrowed) from the connection pool and leaves the connection pool empty. Subsequent requests for a connection result in a new connection being created. The manager's <code>purgeConnectionPool</code> method purges a connection pool using the pool name as a parameter to determine which pool to purge. The pool name is defined as a pool property on the pool-enabled data source.</p>
<p>The following example demonstrates purging a connection pool:</p>
<pre>
mgr.purgeConnectionPool("mgr_pool");
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
Connection pool properties, such as <code>minPoolSize</code> and <code>initialPoolSize</code>, may not be enforced after a connection pool is purged.</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CACJHBEC"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Accessing JMX-based Management</h2>
<p>JMX (Java Management Extensions) is a Java technology that supplies tools for managing and monitoring applications, system objects, devices, service-oriented networks, and JVM (Java Virtual Machine). This API allows its classes to be dynamically constructed and changed. So, you can use this technology to monitor and manage resources as they are created, installed, and implemented. The JMX API also includes remote access, so a remote management program can interact with a running application for these purposes.</p>
<p>In JMX, a given resource is instrumented by one or more Java objects known as MBeans (Managed Beans). These MBeans are registered in a core managed object server, known as an MBean server, that acts as a management agent and can run on most devices enabled for the Java programming language. A JMX agent consists of an MBean server, in which MBeans are registered, and a set of services for handling MBeans.</p>
<p>All MBean attributes and operations are available only when the <code>UniversalConnectionPoolManager.isJmxEnabled</code> method returns <code>true</code>. The default value of this flag is <code>true</code>. This default value can be altered by calling the <code>UniversalConnectionPoolManager.setJmxEnabled</code> method. When an MBeanServer is not available, the <code>jmxFlag</code> is automatically set to <code>false</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink JJUAR" href="../e12826/toc.htm"><span class="italic">Oracle Universal Connection Pool for JDBC Java API Reference</span></a></div>
<p>UCP provides the following two MBeans for pool management support:</p>
<ul>
<li>
<p><a href="#CACECEDE">UniversalConnectionPoolManagerMBean</a></p>
</li>
<li>
<p><a href="#CACFECED">UniversalConnectionPoolMBean</a></p>
</li>
</ul>
<a id="CACECEDE"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">UniversalConnectionPoolManagerMBean</h3>
<p>The <code>UniversalConnectionPoolManagerMBean</code> is a manager MBean that includes all the functionalities of a conventional connection pool manager. The <code>UniversalConnectionPoolManagerMBean</code> provides the following functionalities:</p>
<ul>
<li>
<p>Registering and unregistering pool MBeans</p>
</li>
<li>
<p>Pool management operations like starting the pool, stopping the pool, refreshing the pool, and so on</p>
</li>
<li>
<p>Starting and stopping DMS statistics</p>
</li>
<li>
<p>Logging</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CACFECED"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">UniversalConnectionPoolMBean</h3>
<p>The <code>UniversalConnectionPoolMBean</code> is a pool MBean that covers dynamic configuration of pool properties and pool statistics. The <code>UniversalConnectionPoolMBean</code> provides the following functionalities:</p>
<ul>
<li>
<p>Configuring pool property attributes like size, timeouts, and so on</p>
</li>
<li>
<p>Pool management operations like refreshing the pool, recycling the pool, and so on</p>
</li>
<li>
<p>Monitoring pool statistics and lifecycle states</p>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment31">
<tr>
<td class="cellalignment40">
<table class="cellalignment36">
<tr>
<td class="cellalignment35"><a href="con_behv.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment35"><a href="rac.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2009,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment42">
<table class="cellalignment34">
<tr>
<td class="cellalignment35"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment35"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment35"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment35"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment35"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment35"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
