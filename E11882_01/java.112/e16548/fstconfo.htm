<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Fast Connection Failover</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.1" />
<meta name="dcterms.created" content="2011-09-15T1:42:58Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database JDBC Developer's Guide" />
<meta name="dcterms.identifier" content="E16548-03" />
<meta name="dcterms.isVersionOf" content="JJDBC" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="part6.htm" title="Previous" type="text/html" />
<link rel="Next" href="ocitaf.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e16548.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">40/54</span> <!-- End Header --><a id="CIHJBFFC"></a><a id="JJDBC26000"></a>
<h1 class="chapter"><span class="secnum">27</span> Fast Connection Failover</h1>
<p><a id="ABC1119739"></a><a id="ABC1119739SRI1"></a>Fast Connection Failover offers a driver-independent way for your Java Database Connectivity (JDBC) application to take advantage of the connection failover facilities offered by Oracle Database 11<span class="italic">g</span>. This chapter discusses the following concepts:</p>
<ul>
<li>
<p><a href="#CIHIECJA">Overview of Fast Connection Failover</a></p>
</li>
<li>
<p><a href="#CIHGGBBJ">Using Fast Connection Failover</a></p>
</li>
<li>
<p><a href="#CIHBGCCC">Understanding Fast Connection Failover</a></p>
</li>
<li>
<p><a href="#CIHJGCFE">Comparison of Fast Connection Failover and TAF</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
<ul>
<li>
<p>Starting from Oracle Database 11<span class="italic">g</span> Release 2 (11.2), this feature has been deprecated, and replaced with Universal Connection Pool (UCP) for JDBC. Oracle recommends that you take advantage of the new architecture, which is more powerful and offers better performance. Refer to the following links for more information</p>
<p><code><a href="http://www.oracle.com/technetwork/database/focus-areas/application-development/index-099369.html">http://www.oracle.com/technetwork/database/focus-areas/application-development/index-099369.html</a></code></p>
<p><code><a href="http://download.oracle.com/docs/cd/B28359_01/java.111/e10788.pdf">http://download.oracle.com/docs/cd/B28359_01/java.111/e10788.pdf</a></code></p>
</li>
<li>
<p>If you are using UCP, then you <span class="italic">should not</span> enable implicit connection caching to use Fast Connection Failover feature. Refer to the following link for more information</p>
<p><code><a href="http://www.oracle.com/technetwork/database/enterprise-edition/ucp-transition-guide-129515.pdf">http://www.oracle.com/technetwork/database/enterprise-edition/ucp-transition-guide-129515.pdf</a></code></p>
</li>
</ul>
</div>
<a id="CIHIECJA"></a><a id="JJDBC28823"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Overview of Fast Connection Failover</h2>
<p>The Fast Connection Failover mechanism depends on the implicit connection cache feature. For more information about implicit connection cache, refer to <a href="concache.htm#CDEGABII">Chapter 21, "Implicit Connection Caching"</a>.</p>
<p>The advantages of Fast Connection Failover include the following:</p>
<ul>
<li>
<p>Driver independence</p>
<p>Fast Connection Failover supports both the JDBC Thin and JDBC Oracle Call Interface (OCI) drivers.</p>
</li>
<li>
<p>Integration with implicit connection cache</p>
<p>The two features work together synergistically to improve application performance and high availability.</p>
</li>
<li>
<p>Integration with Oracle Real Application Clusters (Oracle RAC)</p>
<p>This provides superior Real Application Clusters/high availability event notification mechanisms.</p>
</li>
<li>
<p>Easy integration with application code</p>
<p>You only need to enable Fast Connection Failover and no further configuration is required.</p>
</li>
</ul>
<p class="subhead2"><a id="CEGBDDEI"></a><a id="JJDBC28824"></a>Fast Connection Failover Features</p>
<p>When enabled, Fast Connection Failover provides the following:</p>
<ul>
<li>
<p>Rapid detection and cleanup of invalid cached connections, that is, DOWN event processing</p>
</li>
<li>
<p>Load balancing of available connections, that is, UP event processing</p>
</li>
<li>
<p>Run-time work request distribution to all active Oracle RAC instances</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="CIHGGBBJ"></a><a id="JJDBC28825"></a>
<div class="sect1">
<h2 class="sect1">Using Fast Connection Failover</h2>
<p>Applications manage Fast Connection Failover through <code>DataSource</code> instances.</p>
<p>This section covers the following topics:</p>
<ul>
<li>
<p><a href="#CIHECJIJ">Fast Connection Failover Prerequisites</a></p>
</li>
<li>
<p><a href="#CIHGGAAJ">Configuring ONS for Fast Connection Failover</a></p>
</li>
<li>
<p><a href="#CEGIDFEH">Enabling Fast Connection Failover</a></p>
</li>
<li>
<p><a href="#CEGFBBEC">Querying Fast Connection Failover Status</a></p>
</li>
</ul>
<a id="CIHECJIJ"></a><a id="JJDBC28826"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Fast Connection Failover Prerequisites</h3>
<p><a id="sthref837"></a>Fast Connection Failover is available under the following circumstances:</p>
<ul>
<li>
<p>The implicit connection cache is enabled.</p>
<p>Fast Connection Failover works in conjunction with the JDBC connection caching mechanism. This helps applications manage connections to ensure high availability.</p>
</li>
<li>
<p>The application uses service names to connect to the database.</p>
<p>The application cannot use service identifiers.</p>
</li>
<li>
<p>The underlying database has Oracle Database 11<span class="italic">g</span> Real Application Clusters (Oracle RAC) capability or Oracle Data Guard configured with either single instance Databases or Oracle RAC.</p>
<p>If failover events are not propagated, then connection failover cannot occur.</p>
</li>
<li>
<p>Oracle Notification Service (ONS) is configured and available on the node where JDBC is running.</p>
<p>JDBC depends on ONS to propagate database events and notify JDBC of them.</p>
</li>
<li>
<p>The Java Virtual Machine (JVM) in which your JDBC instance is running must have <code>oracle.ons.oraclehome</code> set to point to your <code><span class="codeinlineitalic">ORACLE_HOME</span></code>.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CIHGGAAJ"></a><a id="JJDBC28827"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Configuring ONS for Fast Connection Failover</h3>
<p><a id="ABC1119747"></a>In order for Fast Connection Failover to work, you must configure ONS correctly. ONS is shipped as part of Oracle Database 11<span class="italic">g</span>. For more information, refer to <a href="apxracfan.htm#CDCJEDJD">"Configuration of ONS"</a>.</p>
<a id="CHDGDIIB"></a><a id="JJDBC28828"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Remote ONS Subscription</h4>
<p>The advantages of remote ONS subscription are the following:</p>
<ul>
<li>
<p>Support for an All Java middle-tier stack</p>
</li>
<li>
<p>No ONS daemon needed on the client computer and, therefore, no need to manage this process</p>
</li>
<li>
<p>Simple configuration using the <code>DataSource</code> property</p>
</li>
</ul>
<p>When using remote ONS subscription for Fast Connection Failover, the application invokes the following method on an <code>OracleDataSource</code> instance:</p>
<pre>
setONSConfiguration(String remoteONSConfig)
</pre>
<p>The <code>remoteONSConfig</code> parameter is a list of name and value pairs of the form <code><span class="codeinlineitalic">name</span></code><code>=</code><code><span class="codeinlineitalic">value</span></code> that are separated by a new line character (\n). <code><span class="codeinlineitalic">name</span></code> can be one of <code>nodes</code>, <code>walletfile</code>, or <code>walletpassword</code>. This parameter should specify at least the <code>nodes</code> ONS configuration attribute, which is a list of <code><span class="codeinlineitalic">host</span></code><code>:</code><code><span class="codeinlineitalic">port</span></code> pairs, each pair separated by comma (,). The hosts and ports denote the remote ONS daemons available on the Oracle RAC nodes.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="apxracfan.htm#CDCJEDJD">"Configuration of ONS"</a></div>
<p>SSL could be used in communicating with the ONS daemons when the <code>walletfile</code> attribute is specified as an Oracle wallet file. In such cases, if the <code>walletpassword</code> attribute is not specified, single sign-on (SSO) would be assumed.</p>
<p>Following are a few examples, assuming <code>ods</code> is an <code>OracleDataSource</code> instance:</p>
<pre>
ods.setONSConfiguration("nodes=racnode1.example.com:4200,racnode2.example.com:4200");

ods.setONSConfiguration("nodes=racnode1:4200,racnode2:4200\nwalletfile=/mydir/Wallet\nwalletpassword=mypasswd");

ods.setONSConfiguration("nodes=racnode1:4200,racnode2:4200\nwalletfile=/mydir/conf/Wallet");
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CEGIDFEH"></a><a id="JJDBC28829"></a>
<div class="sect2">
<h3 class="sect2">Enabling Fast Connection Failover</h3>
<p>An application enables Fast Connection Failover by calling <code>setFastConnectionFailoverEnabled(true)</code> on a <code>DataSource</code> instance, before retrieving any connections from that instance.</p>
<p>You cannot enable Fast Connection Failover when reinitializing a connection cache. You must enable it before using the <code>OracleDataSource</code> instance.</p>
<p><a href="#CEGGAIIE">Example 27-1</a> illustrates how to enable Fast Connection Failover.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
After a cache is Fast Connection Failover-enabled, you cannot disable Fast Connection Failover during the lifetime of that cache.</div>
<p>To enable Fast Connection Failover, you must perform the following:</p>
<ul>
<li>
<p>Configure and start ONS. If ONS is not correctly set up, then implicit connection cache creation fails and an <code>ONSException</code> is thrown at the first <code>getConnection</code> request.</p>
</li>
<li>
<p>Set the <code>FastConnectionFailoverEnabled</code> property before making the first <code>getConnection</code> request to an <code>OracleDataSource</code>. When Fast Connection Failover is enabled, the failover applies to all connections in the connection cache. If your application explicitly creates a connection cache using the Connection Cache Manager, then you must first set <code>FastConnectionFailoverEnabled</code> before retrieving any connections.</p>
</li>
<li>
<p>Use a service name rather than a service identifier when setting the <code>OracleDataSource</code> <code>url</code> property.</p>
</li>
</ul>
<div class="example">
<p class="titleinexample"><a id="CEGGAIIE"></a><a id="JJDBC28830"></a>Example 27-1 Enabling Fast Connection Failover</p>
<pre>
// declare datasource
ods.setUrl(
"jdbc:oracle:oci:@(DESCRIPTION=
  (ADDRESS=(PROTOCOL=TCP)(HOST=cluster_alias)
    (PORT=1521))
    (CONNECT_DATA=(SERVICE_NAME=service_name)))");
ods.setUser("scott");
ods.setConnectionCachingEnabled(true);
ods.setFastConnectionFailoverEnabled(true):
ctx.bind("myDS",ods);
ds=(OracleDataSource) ctx.lookup("MyDS");
try {
 ds.getConnection();  // transparently creates and accesses cache
 catch (SQLException SE {
  }
}
...
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<a id="CEGFBBEC"></a><a id="JJDBC28831"></a>
<div class="sect2">
<h3 class="sect2">Querying Fast Connection Failover Status</h3>
<p>An application determines if Fast Connection Failover is enabled by calling <code>OracleDataSource.getFastConnectionFailoverEnabled</code>, which returns <code>true</code> if failover is enabled, <code>false</code> otherwise.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CIHBGCCC"></a><a id="JJDBC28832"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Understanding Fast Connection Failover</h2>
<p>After Fast Connection Failover is enabled, the mechanism is automatic; no application intervention is needed. This section discusses how a connection failover is presented to an application and what steps the application takes to recover.</p>
<p>This section covers the following topics:</p>
<ul>
<li>
<p><a href="#CEGIJDBE">What the Application Sees</a></p>
</li>
<li>
<p><a href="#CEGGDGEG">How It Works</a></p>
</li>
</ul>
<a id="CEGIJDBE"></a><a id="JJDBC28833"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">What the Application Sees</h3>
<p>By the time an Oracle RAC service failure is propagated to the JDBC application, the database already rolls back the local transaction. The cache manager then cleans up all invalid connections. When an application holding an invalid connection tries to do work through that connection, it is possible to receive <code>SQLException, ORA-17008, Closed Connection</code>.</p>
<p>When an application receives a <code>Closed Connection</code> error message, it should do the following:</p>
<ol>
<li>
<p>Retry the connection request. This is essential, because the old connection is no longer open.</p>
</li>
<li>
<p>Replay the transaction. All work done before the connection was closed has been lost.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
The application should not try to roll back the transaction. The transaction was already rolled back in the database by the time the application received the exception.</div>
</div>
<!-- class="sect2" -->
<a id="CEGGDGEG"></a><a id="JJDBC28834"></a>
<div class="sect2">
<h3 class="sect2">How It Works</h3>
<p>Under Fast Connection Failover, each connection in the cache maintains a mapping to a service, instance, database, and host name.</p>
<p>When a database generates an Oracle RAC event, that event is forwarded to the JVM in which JDBC is running. A daemon thread inside the JVM receives the Oracle RAC event and passes it on to the Connection Cache Manager. The Connection Cache Manager then throws SQL exceptions to the applications affected by the Oracle RAC event.</p>
<p>A typical failover scenario may work like the following:</p>
<ol>
<li>
<p>A database instance fails, leaving several stale connections in the cache.</p>
</li>
<li>
<p>The Oracle RAC mechanism in the database generates an Oracle RAC event which is sent to the JVM containing JDBC.</p>
</li>
<li>
<p>The daemon thread inside the JVM finds all the connections affected by the Oracle RAC event, notifies them of the closed connection through SQL exceptions, and rolls back any open transactions.</p>
</li>
<li>
<p>Each individual connection receives a SQL exception and must retry.</p>
</li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CIHJGCFE"></a><a id="JJDBC28835"></a>
<div class="sect1">
<h2 class="sect1">Comparison of Fast Connection Failover and TAF</h2>
<p>Fast Connection Failover differs from Transparent Application Failover (TAF) in the following ways:</p>
<ul>
<li>
<p>Application-level connection retries</p>
<p>Fast Connection Failover supports application-level connection retries. This gives the application control of responding to connection failovers. The application can choose whether to retry the connection or to rethrow the exception. TAF supports connection retries only at the OCI/Net layer.</p>
</li>
<li>
<p>Integration with the implicit connection cache</p>
<p>Fast Connection Failover is well-integrated with the implicit connection cache, which allows the Connection Cache Manager to manage the cache for high availability. For example, failed connections are automatically invalidated in the cache. TAF works at the network level on a per-connection basis, which means that the connection cache cannot be notified of failures.</p>
</li>
<li>
<p>Event-based</p>
<p>Fast Connection Failover is based on the Oracle RAC event mechanism. This means that Fast Connection Failover is efficient and detects failures quickly for both active and inactive connections.</p>
</li>
<li>
<p>Load-balancing support</p>
<p>Fast Connection Failover supports UP event load balancing of connections and run-time work request distribution across active Oracle RAC instances.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Oracle recommends <span class="italic">not</span> to use TAF and Fast Connection Failover in the same application.<a id="sthref838"></a><a id="sthref839"></a></div>
</div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1">
<tr>
<td class="cellalignment10">
<table class="cellalignment6">
<tr>
<td class="cellalignment5"><a href="part6.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5"><a href="ocitaf.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment13">
<table class="cellalignment4">
<tr>
<td class="cellalignment5"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
