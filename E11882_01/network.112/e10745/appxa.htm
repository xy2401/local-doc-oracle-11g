<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Advanced Topics in Oracle Label Security</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 737" />
<meta name="dcterms.created" content="2013-08-19T10:59:36Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Label Security Administrator's Guide" />
<meta name="dcterms.identifier" content="E10745-04" />
<meta name="dcterms.isVersionOf" content="OLSAG" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2000, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="part4.htm" title="Previous" type="text/html" />
<link rel="Next" href="appxb.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10745.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">25/30</span> <!-- End Header -->
<div id="OLSAG104" class="appendix"><a id="CDEGGAHE"></a><a id="i634412"></a>
<h1 class="appendix"><span class="secnum">A</span> Advanced Topics in Oracle Label Security</h1>
<p>This appendix covers topics of interest to advanced users of Oracle Label Security. It contains these sections:</p>
<ul>
<li>
<p><a href="#i634429">Analyzing the Relationships Between Labels</a></p>
</li>
<li>
<p><a href="#i634656">OCI Interface for Setting Session Labels</a></p>
</li>
</ul>
<a id="i634429"></a>
<div id="OLSAG105" class="sect1">
<h2 class="sect1"><span class="secnum">A.1</span> Analyzing the Relationships Between Labels</h2>
<p>This section describes <a id="sthref935"></a>relationships between labels. It contains these topics:</p>
<ul>
<li>
<p><a href="#i634445">Dominant and Dominated Labels</a></p>
</li>
<li>
<p><a href="#i634484">Non-Comparable Labels</a></p>
</li>
<li>
<p><a href="#i634488">Using Dominance Functions</a></p>
</li>
</ul>
<a id="i634445"></a>
<div id="OLSAG3484" class="sect2">
<h3 class="sect2"><span class="secnum">A.1.1</span> Dominant and Dominated Labels</h3>
<p>The relationship between two labels can be described in terms of <a id="sthref936"></a><span class="italic">dominance.</span> A user's ability to access an object depends on whether the user's label <a id="sthref937"></a>dominates the label of the object. If a user's label does not dominate the object's label, then the user is not allowed to access the object.</p>
<p>Label dominance is analyzed in terms of all its components: levels, compartments, and groups.</p>
<div id="OLSAG3485" class="tblformal">
<p class="titleintable"><a id="sthref938"></a><a id="sthref939"></a>Table A-1 Dominance in the Comparison of Labels</p>
<table class="cellalignment2269" title="Dominance in the Comparison of Labels" summary="This table describes what dominance means in each component of a label." dir="ltr">
<thead>
<tr class="cellalignment2260">
<th class="cellalignment2267" id="r1c1-t2">Factor</th>
<th class="cellalignment2267" id="r1c2-t2">Criteria for Dominance</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2260">
<td class="cellalignment2268" id="r2c1-t2" headers="r1c1-t2">
<p>Level</p>
</td>
<td class="cellalignment2268" headers="r2c1-t2 r1c2-t2">
<p>For <span class="italic">label1</span> to dominate <span class="italic">label2</span>, the level of <span class="italic">label1</span> must be greater than or equal to that of <span class="italic">label2</span>.</p>
</td>
</tr>
<tr class="cellalignment2260">
<td class="cellalignment2268" id="r3c1-t2" headers="r1c1-t2">
<p>Compartment</p>
</td>
<td class="cellalignment2268" headers="r3c1-t2 r1c2-t2">
<p>For <span class="italic">label1</span> to dominate <span class="italic">label2</span>, the compartments of <span class="italic">label1</span> must contain <span class="italic">all</span> the compartments of <span class="italic">label2</span>.</p>
</td>
</tr>
<tr class="cellalignment2260">
<td class="cellalignment2268" id="r4c1-t2" headers="r1c1-t2">
<p>Group</p>
</td>
<td class="cellalignment2268" headers="r4c1-t2 r1c2-t2">
<p>For <span class="italic">label1</span> to dominate <span class="italic">label2</span>, <span class="italic">label1</span> must contain <span class="italic">at least one</span> of the groups of <span class="italic">label2</span>.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p>One label <span class="italic">dominates</span> another label if all of its components dominate the components of the other label. For example, the label HIGHLY_SENSITIVE:FINANCE,OPERATIONS dominates the label HIGHLY_SENSITIVE:FINANCE. Similarly, the label HIGHLY_SENSITIVE::WR_AP dominates the label HIGHLY_SENSITIVE::WR_AP, WR_AR.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="releas.htm#i1014385">"Dominance Rules for Labels with Inverse Groups"</a></div>
</div>
<!-- class="sect2" -->
<a id="i634484"></a>
<div id="OLSAG3486" class="sect2">
<h3 class="sect2"><span class="secnum">A.1.2</span> Non-Comparable Labels</h3>
<p><a id="sthref940"></a>The relationship between two labels cannot always be defined by dominance. Two labels are <span class="italic">non-comparable</span> if neither label dominates the other. If any compartments differ between the two labels (as with HS:A and HS:B), then they are non-comparable. Similarly, the labels HS:A and S:B are non-comparable.</p>
</div>
<!-- class="sect2" -->
<a id="i634488"></a>
<div id="OLSAG3487" class="sect2">
<h3 class="sect2"><span class="secnum">A.1.3</span> Using Dominance Functions</h3>
<p>You can use <a id="sthref941"></a>dominance functions to specify ranges in queries. The following functions enable you to indicate dominance relationships between specified labels.</p>
<div id="OLSAG3488" class="tblformal">
<p class="titleintable"><a id="sthref942"></a><a id="sthref943"></a>Table A-2 Functions to Determine Dominance</p>
<table class="cellalignment2269" title="Functions to Determine Dominance " summary="This table lists the functions you can use to indicate dominance relationships between specified labels, listing each individual function and its meaning." dir="ltr">
<thead>
<tr class="cellalignment2260">
<th class="cellalignment2267" id="r1c1-t4">Function</th>
<th class="cellalignment2267" id="r1c2-t4">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2260">
<td class="cellalignment2268" id="r2c1-t4" headers="r1c1-t4">
<p>STRICTLY_<a id="sthref944"></a>DOMINATES</p>
</td>
<td class="cellalignment2268" headers="r2c1-t4 r1c2-t4">
<p>The value of <span class="italic">label1</span> dominates that of <span class="italic">label2</span>, and is not equal to it.</p>
</td>
</tr>
<tr class="cellalignment2260">
<td class="cellalignment2268" id="r3c1-t4" headers="r1c1-t4">
<p><a id="sthref945"></a>DOMINATES</p>
</td>
<td class="cellalignment2268" headers="r3c1-t4 r1c2-t4">
<p>The value of <span class="italic">label1</span> dominates, or is equal to, that of <span class="italic">label2</span>.</p>
</td>
</tr>
<tr class="cellalignment2260">
<td class="cellalignment2268" id="r4c1-t4" headers="r1c1-t4">
<p><a id="sthref946"></a>DOMINATED_BY</p>
</td>
<td class="cellalignment2268" headers="r4c1-t4 r1c2-t4">
<p>The value of <span class="italic">label1</span> is dominated by that of <span class="italic">label2</span>.</p>
</td>
</tr>
<tr class="cellalignment2260">
<td class="cellalignment2268" id="r5c1-t4" headers="r1c1-t4">
<p><a id="sthref947"></a>STRICTLY_DOMINATED_BY</p>
</td>
<td class="cellalignment2268" headers="r5c1-t4 r1c2-t4">
<p>The value of <span class="italic">label1</span> is dominated by that of <span class="italic">label2</span>, and is not equal to it.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p>Note that there are two types of dominance function. While the SA_UTL dominance functions return BOOLEAN values, the standalone dominance functions return integers.</p>
<ul>
<li>
<p><a href="#i634565">The DOMINATES Standalone Function</a></p>
</li>
<li>
<p><a href="#i634575">The STRICTLY_DOMINATES Standalone Function</a></p>
</li>
<li>
<p><a href="#i634585">The DOMINATED_BY Standalone Function</a></p>
</li>
<li>
<p><a href="#i634595">The STRICTLY_DOMINATED_BY Standalone Function</a></p>
</li>
<li>
<p><a href="#i634605">SA_UTL.DOMINATES</a></p>
</li>
<li>
<p><a href="#i634616">SA_UTL.STRICTLY_DOMINATES</a></p>
</li>
<li>
<p><a href="#i634626">SA_UTL.DOMINATED_BY</a></p>
</li>
<li>
<p><a href="#i634636">SA_UTL.STRICTLY_DOMINATED_BY</a></p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="worklabel.htm#i1008735">"Ordering Labeled Data Rows"</a></div>
</li>
</ul>
<a id="i634565"></a>
<div id="OLSAG3489" class="sect3">
<h4 class="sect3"><span class="secnum">A.1.3.1</span> The DOMINATES Standalone Function</h4>
<p>The <a id="sthref948"></a>DOMINATES (DOM) function returns 1 (TRUE) if <span class="italic">label1</span> dominates <span class="italic">label2</span>, or 0 (FALSE) if it does not.</p>
<p>Syntax:</p>
<pre>
FUNCTION DOMINATES (
  label1          IN NUMBER,
  label2          IN NUMBER) 
RETURN INTEGER; 
</pre></div>
<!-- class="sect3" -->
<a id="i634575"></a>
<div id="OLSAG3490" class="sect3">
<h4 class="sect3"><span class="secnum">A.1.3.2</span> The STRICTLY_DOMINATES Standalone Function</h4>
<p>The <a id="sthref949"></a>STRICTLY_DOMINATES (SDOM) function returns 1 (TRUE) if <span class="italic">label1</span> dominates <span class="italic">label2</span> and is not equal to it.</p>
<p>Syntax:</p>
<pre>
FUNCTION STRICTLY_DOMINATES (
  label1          IN NUMBER,
  label2          IN NUMBER) 
RETURN INTEGER; 
</pre></div>
<!-- class="sect3" -->
<a id="i634585"></a>
<div id="OLSAG3491" class="sect3">
<h4 class="sect3"><span class="secnum">A.1.3.3</span> The DOMINATED_BY Standalone Function</h4>
<p>The <a id="sthref950"></a>DOMINATED_BY (DOM_BY) function returns 1 (TRUE) if <span class="italic">label1</span> is dominated by <span class="italic">label2</span>.</p>
<p>Syntax:</p>
<pre>
FUNCTION DOMINATED_BY (
  label1          IN NUMBER,
  label2          IN NUMBER)
RETURN INTEGER;
</pre></div>
<!-- class="sect3" -->
<a id="i634595"></a>
<div id="OLSAG3492" class="sect3">
<h4 class="sect3"><span class="secnum">A.1.3.4</span> The STRICTLY_DOMINATED_BY Standalone Function</h4>
<p>The <a id="sthref951"></a>STRICTLY_DOMINATED_BY (SDOM_BY) function returns 1 (TRUE) if <span class="italic">label1</span> is dominated by <span class="italic">label2</span> and is not equal to it.</p>
<p>Syntax:</p>
<pre>
FUNCTION STRICTLY_DOMINATED_BY (
  label1          IN NUMBER,
  label2          IN NUMBER) 
RETURN INTEGER; 
</pre></div>
<!-- class="sect3" -->
<a id="i634605"></a>
<div id="OLSAG3493" class="sect3">
<h4 class="sect3"><span class="secnum">A.1.3.5</span> SA_UTL.DOMINATES</h4>
<p><a id="sthref952"></a>The SA_UTL.<a id="sthref953"></a>DOMINATES function returns TRUE if <span class="italic">label1</span> dominates <span class="italic">label2</span>.</p>
<p>Syntax:</p>
<pre>
FUNCTION DOMINATES (
  label1          IN NUMBER,
  label2          IN NUMBER) 
RETURN BOOLEAN; 
</pre></div>
<!-- class="sect3" -->
<a id="i634616"></a>
<div id="OLSAG3494" class="sect3">
<h4 class="sect3"><span class="secnum">A.1.3.6</span> SA_UTL.STRICTLY_DOMINATES</h4>
<p>The SA_UTL.STRICTLY_<a id="sthref954"></a>DOMINATES function returns TRUE if <span class="italic">label1</span> dominates <span class="italic">label2</span> and is not equal to it.</p>
<p>Syntax:</p>
<pre>
FUNCTION STRICTLY_DOMINATES (
  label1          IN NUMBER,
  label2          IN NUMBER) 
RETURN BOOLEAN; 
</pre></div>
<!-- class="sect3" -->
<a id="i634626"></a>
<div id="OLSAG3495" class="sect3">
<h4 class="sect3"><span class="secnum">A.1.3.7</span> SA_UTL.DOMINATED_BY</h4>
<p>The SA_UTL.<a id="sthref955"></a>DOMINATED_BY function returns TRUE if <span class="italic">label1</span> is dominated by <span class="italic">label2</span>.</p>
<p>Syntax:</p>
<pre>
FUNCTION DOMINATED_BY (
  label1          IN NUMBER,
  label2          IN NUMBER) 
RETURN BOOLEAN;
</pre></div>
<!-- class="sect3" -->
<a id="i634636"></a>
<div id="OLSAG3496" class="sect3">
<h4 class="sect3"><span class="secnum">A.1.3.8</span> SA_UTL.STRICTLY_DOMINATED_BY</h4>
<p>The SA_UTL.<a id="sthref956"></a>STRICTLY_DOMINATED_BY function returns TRUE if <span class="italic">label1</span> is dominated by <span class="italic">label2</span> and is not equal to it.</p>
<p>Syntax:</p>
<pre>
FUNCTION STRICTLY_DOMINATED_BY (
  label1          IN NUMBER,
  label2          IN NUMBER)
RETURN BOOLEAN;
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also::</p>
<a href="worklabel.htm#i1008754">"Determining Upper and Lower Bounds of Labels"</a>.</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i634656"></a>
<div id="OLSAG106" class="sect1">
<h2 class="sect1"><span class="secnum">A.2</span> OCI Interface for Setting Session Labels</h2>
<p><a id="sthref957"></a><a id="sthref958"></a>When using Oracle Call Interface (OCI) to connect, the policy's SYS_CONTEXT variables can be used to initialize the session label and the row label. The variables are set using the <a id="sthref959"></a>OCIAttrSet function to initialize <span class="italic">externally initialized</span> <a id="sthref960"></a>SYS_CONTEXT variables. These are available in Release 8.1.7 only when Oracle Label Security is installed.</p>
<p>Each policy has a SYS_CONTEXT named SA$<span class="italic">policy_name</span>_X. There are two variables that can be set, <a id="sthref961"></a>INITIAL_LABEL and <a id="sthref962"></a>INITIAL_ROW_LABEL.</p>
<p>When set to valid labels within the user's authorizations, the new values will be used instead of the default values stored for the user. This is the same mechanism used for remote connections</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="multiple.htm#CACGACFF">Chapter 13, "Using Oracle Label Security with a Distributed Database"</a></div>
<div id="OLSAG3497" class="sect2"><a id="sthref963"></a>
<h3 class="sect2"><span class="secnum">A.2.1</span> OCIAttrSet</h3>
<p>Additional attributes are defined for <a id="sthref964"></a>OCIAttrSet to insert context. Use <a id="sthref965"></a>OCI_ATTR_APPCTX_SIZE to initialize the context array size with the desired number of context attributes:</p>
<pre>
OCIAttrSet(session, OCI_HTYPE_SESSION, 
                 (dvoid *)&amp;size, (ub4)0, OCI_ATTR_APPCTX_SIZE, error_handle); 
 
</pre>
<p>Note that size is ub4 type.</p>
</div>
<!-- class="sect2" -->
<a id="i634684"></a>
<div id="OLSAG3498" class="sect2">
<h3 class="sect2"><span class="secnum">A.2.2</span> OCIAttrGet</h3>
<p>Then call <a id="sthref966"></a>OCIAttrGet with <a id="sthref967"></a>OCI_ATTR_APPCTX_LIST to get a handle on the application context list descriptor for the session:</p>
<pre>
OCIAttrGet(session, OCI_HTYPE_SESSION, 
               (dvoid *)&amp;ctxl_desc, (ub4)0, OCI_ATTR_APPCTX_LIST, error_handle);
</pre>
<p>Note that ctxl_desc is (OCIParam *) type.</p>
</div>
<!-- class="sect2" -->
<div id="OLSAG3499" class="sect2"><a id="sthref968"></a>
<h3 class="sect2"><span class="secnum">A.2.3</span> OCIParamGet</h3>
<p>Then use the application context list descriptor to obtain an individual descriptor for the i-th application context:</p>
<pre>
<a id="sthref969"></a>OCIParamGet(ctxl_desc, OCI_DTYPE_PARAM, error_handle,(dvoid **)&amp;ctx_desc, i);  
</pre>
<p>Note that ctx_desc is (OCIParam *) type.</p>
</div>
<!-- class="sect2" -->
<div id="OLSAG3500" class="sect2"><a id="sthref970"></a>
<h3 class="sect2"><span class="secnum">A.2.4</span> OCIAttrSet</h3>
<p>Set the proper values in the application context by using the three new attributes OCI_ATTR_APPCTX_NAME, OCI_ATTR_APPCTX_ATTR, and OCI_ATTR_APPCTX_VALUE:</p>
<pre>
<a id="sthref971"></a>OCIAttrSet(ctx_desc, OCI_DTYPE_PARAM,
                 (dvoid *)ctx_name, sizeof(ctx_name), OCI_ATTR_APPCTX_NAME,
                 error_handle);  

OCIAttrSet(ctx_desc, OCI_DTYPE_PARAM,
                 (dvoid *)attr_name, sizeof(attr_name), OCI_ATTR_APPCTX_ATTR,
                 error_handle);  

OCIAttrSet(ctx_desc, OCI_DTYPE_PARAM,
                 (dvoid *)value, sizeof(value), OCI_ATTR_APPCTX_VALUE,
                 error_handle);  
</pre>
<p>Note that only character type is supported, because application context operations are based on the VARCHAR2 type.</p>
</div>
<!-- class="sect2" -->
<div id="OLSAG3501" class="sect2"><a id="sthref972"></a>
<h3 class="sect2"><span class="secnum">A.2.5</span> OCI Example</h3>
<p><a id="sthref973"></a>The following example shows how to use externalized SYS_CONTEXT with Oracle Label Security.</p>
<pre>
#ifdef RCSID
static char *RCSid =
   "$Header: ext_mls.c 09-may-00.10:07:08 jdoe Exp $ ";
#endif /* RCSID */

/* Copyright (c) Oracle Corporation 1999, 2000. All Rights Reserved. */

/*

   NAME
</pre>
<pre>
ext_mls.c - externalized SYS_CONTEXT with Label Security
</pre>
<pre>
   DESCRIPTION
</pre>
<pre>
Run olsdemo.sql script before executing this example.
Usage: &lt;executable obtained with .c file&gt; &lt;user_name&gt; &lt;password&gt; &lt;session-initial-label
Example: avg_sal sa_demo sa_demo L3:M,E:D10
</pre>
<pre>
   PUBLIC FUNCTION(S)
</pre>
<pre>
&lt;list of external functions declared/defined - with one-line descriptions&gt;
</pre>
<pre>
   PRIVATE FUNCTION(S)
</pre>
<pre>
&lt;list of static functions defined in .c file - with one-line descriptions&gt;
</pre>
<pre>
   RETURNS
</pre>
<pre>
The average salary in the EMP table of the SA_DEMO schema querying as the specified user with the specified session label.
</pre>
<pre>
   NOTES
</pre>
<pre>
&lt;other useful comments, qualifications, and so on&gt;
</pre>
<pre>
   MODIFIED   (MM/DD/YY)
</pre>
<pre>
jlev      09/18/03 - cleanup
jdoe      05/09/00 - cleanup
</pre>
<pre>
   jdoe      10/13/99 - standalone OCI program to test MLS SYS_CONTEXT
   jdoe      10/13/99 - Creation

*/
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;oci.h&gt;

static OCIEnv *envhp;
static OCIError *errhp;

int main(/*_ int argc, char *argv[] _*/);

/* get and print error */
static void checkerr(/*_OCIError *errhp, sword status _*/);
/* print error */
static void printerr(char *call);
static sword status;

/* return the average of employees' salary */
static CONST text *const selectstmt = (text *)
     "select avg(sal) from sa_demo.emp";
 
int main(argc, argv)
int argc;
char *argv[];
{
  OCISession *authp = (OCISession *) 0;
  OCIServer *srvhp;
  OCISvcCtx *svchp;
  OCIDefine *defnp = (OCIDefine *) 0;
  dvoid *parmdp;
  ub4 ctxsize;
  OCIParam *ctxldesc;
  OCIParam *ctxedesc;
  OCIStmt *stmtp = (OCIStmt *) 0;
  ub4 avg_sal = 0;
  sword status;

  if (OCIInitialize((ub4) OCI_DEFAULT, (dvoid *) 0,
                    (dvoid * (*)(dvoid *, size_t)) 0,
                    (dvoid * (*)(dvoid *, dvoid *, size_t)) 0,
                    (void (*)(dvoid *, dvoid *)) 0))
    printerr("OCIInitialize");

  if (OCIEnvInit((OCIEnv **) &amp;envhp, OCI_DEFAULT, (size_t) 0, (dvoid **) 0))
    printerr("OCIEnvInit");
  
  if (OCIHandleAlloc((dvoid *) envhp, (dvoid **) &amp;errhp, OCI_HTYPE_ERROR,
                     (size_t) 0, (dvoid **) 0))
    printerr("OCIHandleAlloc:OCI_HTYPE_ERROR");

  if (OCIHandleAlloc((dvoid *) envhp, (dvoid **) &amp;srvhp, OCI_HTYPE_SERVER,
                     (size_t) 0, (dvoid **) 0))
    printerr("OCIHandleAlloc:OCI_HTYPE_SERVER");

  if (OCIHandleAlloc((dvoid *) envhp, (dvoid **) &amp;svchp, OCI_HTYPE_SVCCTX,
                     (size_t) 0, (dvoid **) 0))
    printerr("OCIHandleAlloc:OCI_HTYPE_SVCCTX");

  if (OCIServerAttach(srvhp, errhp, (text *) "", strlen(""), 0))
    printerr("OCIServerAttach");

  /* set attribute server context in the service context */
  if (OCIAttrSet((dvoid *) svchp, OCI_HTYPE_SVCCTX, (dvoid *) srvhp,
                 (ub4) 0, OCI_ATTR_SERVER, (OCIError *) errhp))
    printerr("OCIAttrSet:OCI_HTYPE_SVCCTX");

  if (OCIHandleAlloc((dvoid *) envhp, (dvoid **) &amp;authp,
                     (ub4) OCI_HTYPE_SESSION, (size_t) 0, (dvoid **) 0))
    printerr("OCIHandleAlloc:OCI_HTYPE_SESSION");

  /* set application context to 1 */
  ctxsize = 1;

  /* set up app ctx buffer */
  if (OCIAttrSet((dvoid *) authp, (ub4) OCI_HTYPE_SESSION, (dvoid *) &amp;ctxsize,
                 (ub4) 0, (ub4) OCI_ATTR_APPCTX_SIZE, errhp))
    printerr("OCIAttrSet:OCI_ATTR_APPCTX_SIZE");

  /* retrieve the list descriptor */
  if (OCIAttrGet((dvoid *) authp, (ub4) OCI_HTYPE_SESSION,
                 (dvoid *) &amp;ctxldesc, 0, OCI_ATTR_APPCTX_LIST, errhp))
    printerr("OCIAttrGet:OCI_ATTR_APPCTX_LIST");

  if (status = OCIParamGet(ctxldesc, OCI_DTYPE_PARAM, errhp,
                           (dvoid **) &amp;ctxedesc, 1))
    {
      if (status == OCI_NO_DATA)
        {
          printf("No Data found!\n");
          exit(1);
        }
    }

  /* set context namespace to SA$&lt;pol_name&gt;_X */
  if (OCIAttrSet((dvoid *) ctxedesc, (ub4) OCI_DTYPE_PARAM,
                 (dvoid *) "SA$HUMAN_RESOURCES_X",
                 (ub4) strlen((char *) "SA$HUMAN_RESOURCES_X"),
                 (ub4) OCI_ATTR_APPCTX_NAME, errhp))
    printerr("OCIAttrSet:OCI_ATTR_APPCTX_NAME:SA$HUMAN_RESOURCES_X");

  /* set context attribute to INITIAL_LABEL */
  if (OCIAttrSet((dvoid *) ctxedesc, (ub4) OCI_DTYPE_PARAM,
                 (dvoid *) "INITIAL_LABEL",
                 (ub4) strlen((char *) "INITIAL_LABEL"),
                 (ub4) OCI_ATTR_APPCTX_ATTR, errhp))
    printerr("OCIAttrSet:OCI_DTYPE_PARAM:INITIAL_LABEL");

  /* set context value to argv[3] - initial label */
  if (OCIAttrSet((dvoid *) ctxedesc, (ub4) OCI_DTYPE_PARAM,
                 (dvoid *) argv[3],
                 (ub4) strlen((char *) argv[3]),
                 (ub4) OCI_ATTR_APPCTX_VALUE, errhp))
    printerr("OCIAttrSet:argv[3]");

  /* username first command line argument */
  if (OCIAttrSet((dvoid *) authp, (ub4) OCI_HTYPE_SESSION, (dvoid *) argv[1],
                 (ub4) strlen((char *) argv[1]), (ub4) OCI_ATTR_USERNAME,
                 errhp))
    printerr("OCIAttrSet:username");

  /* password second command line argument */
  if (OCIAttrSet((dvoid *) authp, (ub4) OCI_HTYPE_SESSION, (dvoid *) argv[2],
                 (ub4) strlen((char *) argv[2]), (ub4) OCI_ATTR_PASSWORD,
                 errhp))
    printerr("OCIAttrSet:password");

  if (OCISessionBegin(svchp, errhp, authp, OCI_CRED_RDBMS, (ub4) OCI_DEFAULT))
    printerr("OCISessionBegin");

  if (OCIAttrSet((dvoid *) svchp, (ub4) OCI_HTYPE_SVCCTX, (dvoid *) authp,
                 (ub4) 0, (ub4) OCI_ATTR_SESSION, errhp))
    printerr("OCIAttrSet:OCI_ATTR_SESSION");

  if (OCIHandleAlloc((dvoid *) envhp, (dvoid **) &amp;stmtp, OCI_HTYPE_STMT,
                     0, 0))
    printerr("OCIHandleAlloc:OCI_HTYPE_STMT");

  if (OCIStmtPrepare(stmtp, errhp, (CONST OraText *) selectstmt,
                     (ub4) strlen((const char *) selectstmt),
                     (ub4) OCI_NTV_SYNTAX, (ub4) OCI_DEFAULT))
    printerr("OCIStmtPrepare");

  if (OCIDefineByPos(stmtp, &amp;defnp, errhp, (ub4) 1, (dvoid *) &amp;avg_sal,
                     (sb4) sizeof(avg_sal), SQLT_INT, 0, 0, 0, OCI_DEFAULT))
    printerr("OCIDefineByPos");

  if (status = OCIStmtExecute(svchp, stmtp, errhp, 1, 0, NULL, NULL,
                              OCI_DEFAULT))
    {
      if (status == OCI_NO_DATA)
        {
          printf("No Data found!\n");
          exit(1);
        }
    }

  if (OCISessionEnd(svchp, errhp, authp, OCI_DEFAULT))
    printerr("OCISessionEnd");

  printf("average salary is: %d\n", avg_sal);
}

void checkerr(errhp, status)
     OCIError *errhp;
     sword status;
{
  text errbuf[512];
  sb4 errcode = 0;

  switch (status)
    {
    case OCI_ERROR:
      (void) OCIErrorGet((dvoid *) errhp, 1, NULL, &amp;errcode, errbuf,
                         (ub4) sizeof(errbuf), OCI_HTYPE_ERROR);
      printf("Error - %.*s\n", 512, errbuf);
      break;
    default:
      break;
    }
}

void printerr(call)
     char *call;
{
  printf("Error: %s\n", call);
}
/* end of file ext_mls.c */
</pre></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="appendix" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2259">
<tr>
<td class="cellalignment2268">
<table class="cellalignment2264">
<tr>
<td class="cellalignment2263"><a href="part4.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2263"><a href="appxb.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2000, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2271">
<table class="cellalignment2262">
<tr>
<td class="cellalignment2263"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2263"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2263"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2263"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2263"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2263"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
