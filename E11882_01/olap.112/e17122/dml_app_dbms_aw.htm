<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>&nbsp;&nbsp;DBMS_AW PL/SQL Package</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 742" />
<meta name="dcterms.created" content="2013-11-14T21:22:0Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="OLAP DML Reference" />
<meta name="dcterms.identifier" content="E17122-08" />
<meta name="dcterms.isVersionOf" content="OLADM" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1994, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="dml_app_sqlfunc006.htm" title="Previous" type="text/html" />
<link rel="Next" href="dml_app_dbms_aw001.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e17122.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">557/593</span> <!-- End Header -->
<div id="OLADM946" class="appendix"><a id="sthref5450"></a>
<h1 class="appendix"><span class="secnum">B</span> &nbsp;&nbsp;DBMS_AW PL/SQL Package</h1>
<p><a id="ABC2634262"></a>The DBMS_AW PL/SQL package provides procedures and functions for <a id="ABC2625341"></a>interacting <a id="ABC2625343"></a>with analytic workspaces.</p>
<p>This appendix contains the following topics:</p>
<ul>
<li>
<p><a href="#BABJCFAE">Managing Analytic Workspaces</a></p>
</li>
<li>
<p><a href="#BABEDJCD">Embedding OLAP DML in SQL Statements</a></p>
</li>
<li>
<p><a href="#BABGGHHI">Using the Sparsity Advisor</a></p>
</li>
<li>
<p><a href="#BABBEFGI">Using the Aggregate Advisor</a></p>
</li>
<li>
<p><a href="dml_app_dbms_aw001.htm#BABHGFJE">Summary of DBMS_AW Subprograms</a></p>
</li>
<li>
<p>One reference topic for each DBMS_AW subprogram</p>
</li>
</ul>
<a id="BABJCFAE"></a>
<div id="OLADM947" class="sect1">
<h2 class="sect1">Managing Analytic Workspaces</h2>
<p>To interact with Oracle OLAP, you must attach an analytic workspace to your session. When you have DBMS_AW PL/SQL package installed you can perform this task from within SQL*Plus. For example, you can use the following command to attach an analytic workspace with read-only access.</p>
<pre>
EXECUTE dbms_aw.aw_attach ('<span class="codeinlineitalic">awname</span>');
</pre>
<p>Each analytic workspace is associated with a list of analytic workspaces. The read-only workspace <code>EXPRESS.AW</code>, which contains the OLAP engine code, is always attached last in the list. When you create a workspace, it is attached first in the list by default.</p>
<p>You can reposition an analytic workspace within the list by using keywords such as <code>FIRST</code> and <code>LAST</code>. For example, the following commands show how to move an analytic workspace called <code>MYAW.TEST2</code> from the second position to the first position on the list.</p>
<pre>
<span class="bold">EXECUTE dbms_aw.execute ('AW LIST');</span>

TEST1 R/O UNCHANGED GLOBAL.TEST1 
TEST2 R/O UNCHANGED GLOBAL.TEST2 
EXPRESS R/O UNCHANGED SYS.EXPRESS 

<span class="bold">EXECUTE dbms_aw.aw_attach ('test2', FALSE, FALSE, 'FIRST');</span>
<span class="bold">EXECUTE dbms_aw.execute ('AW LIST');</span>

TEST2 R/O UNCHANGED GLOBAL.TEST2 
TEST1 R/O UNCHANGED GLOBAL.TEST1 
EXPRESS R/O UNCHANGED SYS.EXPRESS 
</pre>
<p>From within SQL*Plus, you can rename workspaces and make copies of workspaces. If you have an analytic workspace attached with read/write access, you can update the workspace and save your changes in the permanent database table where the workspace is stored. You must do a SQL <code>COMMIT</code> to save the workspace changes within the database.</p>
<p>The following commands make a copy of the objects and data in workspace <code>test2</code> in a new workspace called <code>test3</code>, update <code>test3</code>, and commit the changes to the database.</p>
<pre>
<span class="bold">EXECUTE dbms_aw.aw_copy('test2', 'test3');</span>
<span class="bold">EXECUTE dbms_aw.aw_update('test3');</span>
<span class="bold">COMMIT;</span>
</pre></div>
<!-- class="sect1" -->
<a id="BABEDJCD"></a>
<div id="OLADM951" class="sect1">
<h2 class="sect1">Embedding OLAP DML in SQL Statements</h2>
<p><a id="sthref5451"></a>With the <code>DBMS_AW</code> package you can perform the full range of OLAP processing within analytic workspaces. You can import data from legacy workspaces, relational tables, or flat files. You can define OLAP objects and perform complex calculations.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you use the <code>DBMS_AW</code> package to create analytic workspaces from scratch, you may not be able to use OLAP utilities, such as Analytic Workspace Manager and the <code>DBMS_AW</code> Aggregate Advisor, which require analytic workspaces of a particular structure.</div>
<div id="OLADM952" class="sect2"><a id="sthref5452"></a>
<h3 class="sect2">Methods for Executing OLAP DML Commands</h3>
<p>The <code>DBMS_AW</code> package provides several procedures for executing ad hoc OLAP DML commands. Using the <code>EXECUTE</code> or <code>INTERP_SILENT</code> procedures or the <code>INTERP</code> or <code>INTERCLOB</code> functions, you can execute a single OLAP DML command or a series of commands separated by semicolons.</p>
<p>Which procedures you use depends on how you want to direct output and on the size of the input and output buffers. For example, the <code>EXECUTE</code> procedure directs output to a printer buffer, the <code>INTERP_SILENT</code> procedure suppresses output, and the <code>INTERP</code> function returns the session log.</p>
<p>The <code>DBMS_AW</code> package also provides functions for evaluating OLAP expressions. The <code>EVAL_TEXT</code> function returns the result of a text expression, and <code>EVAL_NUMBER</code> returns the result of a numeric expression.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Do not confuse the <code>DBMS_AW</code> functions <code>EVAL_NUMBER</code> and <code>EVAL_TEXT</code> with the SQL function <code>OLAP_EXPRESSION</code>. S<a id="sthref5453"></a>ee <a href="dml_app_sqlfunc003.htm#BGBGDDDF">"OLAP_EXPRESSION"</a> for more information.</div>
</div>
<!-- class="sect2" -->
<a id="CHDIJEGA"></a>
<div id="OLADM953" class="sect2">
<h3 class="sect2">Guidelines for Using Quotation Marks in OLAP DML Commands</h3>
<p><a id="sthref5454"></a><a id="sthref5455"></a>The SQL processor evaluates the embedded OLAP DML commands, either in whole or in part, before sending them to Oracle OLAP for processing. Follow these guidelines when formatting the OLAP DML commands in the <code>olap-commands</code> parameter of <code>DBMS_AW</code> procedures:</p>
<ul>
<li>
<p>Wherever you would normally use a single quote (<code>'</code>) in an OLAP DML command, use two single quotes (<code>''</code>). The SQL processor strips one of the single quotes before it sends the OLAP DML command to Oracle OLAP.</p>
</li>
<li>
<p>In the OLAP DML, a double quote (<code>"</code>) indicates the beginning of a comment.</p>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABGGHHI"></a>
<div id="OLADM954" class="sect1">
<h2 class="sect1">Using the Sparsity Advisor</h2>
<p><a id="ABC2607182"></a>Data can be stored in several different forms in an analytic workspace, depending on whether it is dense, sparse, or very sparse. The Sparsity Advisor is a group of subprograms in <code>DBMS_AW</code> that you can use to analyze the relational source data and get recommendations for storing it in an analytic workspace.</p>
<div id="OLADM955" class="sect2"><a id="sthref5456"></a>
<h3 class="sect2">Data Storage Options in Analytic Workspaces</h3>
<p>Analytic workspaces analyze and manipulate data in a multidimensional format that allocates one cell for each combination of dimension members. The cell can contain a data value, or it can contain an <code>NA</code> (null). Regardless of its content, the cell size is defined by the data type, for example, every cell in a <code>DECIMAL</code> variable is 8 bytes.</p>
<p>Variables can be either dense (they contain 30% or more cells with data values) or sparse (less than 30% data values). Most variables are sparse and many are extremely sparse.</p>
<p><a id="sthref5457"></a><a id="sthref5458"></a>Although data can also be stored in the multidimensional format used for analysis, other methods are available for storing sparse variables that make more efficient use of disk space and improve performance. Sparse data can be stored in a variable defined with a <span class="bold">composite</span> dimension. A composite has as its members the dimension-value combinations (called <span class="bold">tuples</span>) for which there is data. When a data value is added to a variable dimensioned by a composite, that action triggers the creation of a composite tuple. A composite is an index into one or more sparse data variables, and is used to store sparse data in a compact form. Very sparse data can be stored in a variable defined with a <span class="bold">compressed composite</span>, which uses a different algorithm for data storage from regular composites.</p>
</div>
<!-- class="sect2" -->
<div id="OLADM956" class="sect2"><a id="sthref5459"></a>
<h3 class="sect2">Selecting the Best Data Storage Method</h3>
<p>In contrast to dimensional data, relational data is stored in tables in a very compact format, with rows only for actual data values. When designing an analytic workspace, you may have difficulty manually identifying sparsity in the source data and determining the best storage method. The Sparsity Advisor analyzes the source data in relational tables and recommends a storage method. The recommendations may include the definition of a composite and partitioning of the data variable.</p>
<p>The Sparsity Advisor consists of these procedures and functions:</p>
<br />
<a href="dml_app_dbms_aw032.htm#CHDGAHHF">SPARSITY_ADVICE_TABLE Procedure</a><br />
<a href="dml_app_dbms_aw002.htm#CHDGEEDC">ADD_DIMENSION_SOURCE Procedure</a><br />
<a href="dml_app_dbms_aw009.htm#CHDDBBFF">ADVISE_SPARSITY Procedure</a><br />
<a href="dml_app_dbms_aw004.htm#CHDHGJHJ">ADVISE_DIMENSIONALITY Function</a><br />
<a href="dml_app_dbms_aw005.htm#CHDFEGGC">ADVISE_DIMENSIONALITY Procedure</a><br />
<p>The Sparsity Advisor also provides a public table type for storing information about the dimensions of the facts being analyzed. Three objects are used to define the table type:</p>
<br />
<code><a id="sthref5460"></a>DBMS_AW$_COLUMNLIST_T</code><br />
<code><a id="sthref5461"></a>DBMS_AW$_DIMENSION_SOURCE_T</code><br />
<code><a id="sthref5462"></a>DBMS_AW$_DIMENSION_SOURCES_T</code><br />
<p>The following SQL <code>DESCRIBE</code> statements show the object definitions.</p>
<pre>
<span class="bold">DESCRIBE dbms_aw$_columnlist_t</span>
dbms_aw$_columnlist_t TABLE OF VARCHAR2(100)
 
<span class="bold">DESCRIBE dbms_aw$_dimension_source_t</span>
 Name                                      Null?    Type
 ----------------------------------------- -------- ----------------------------
 DIMNAME                                            VARCHAR2(100)
 COLUMNNAME                                         VARCHAR2(100)
 SOURCEVALUE                                        VARCHAR2(32767)
 DIMTYPE                                            NUMBER(3)
 HIERCOLS                                           DBMS_AW$_COLUMNLIST_T
 PARTBY                                             NUMBER(9)

<span class="bold">DESCRIBE dbms_aw$_dimension_sources_t</span>
dbms_aw$_dimension_sources_t TABLE OF DBMS_AW$_DIMENSION_SOURCE_T
</pre></div>
<!-- class="sect2" -->
<div id="OLADM957" class="sect2"><a id="sthref5463"></a>
<h3 class="sect2">Using the Sparsity Advisor</h3>
<p>Take these steps to use the Sparsity Advisor:</p>
<ol>
<li>
<p>Call <code>SPARSITY_ADVICE_TABLE</code> to create a table for storing the evaluation of the Sparsity Advisor.</p>
</li>
<li>
<p>Call <code>ADD_DIMENSION_SOURCE</code> for each dimension related by one or more columns to the fact table being evaluated.</p>
<p>The information that you provide about these dimensions is stored in a <code>DBMS_AW$_DIMENSION_SOURCES_T</code> variable.</p>
</li>
<li>
<p>Call <code>ADVISE_SPARSITY</code> to evaluate the fact table.</p>
<p>Its recommendations are stored in the table created by <code>SPARSITY_ADVICE_TABLE</code>. You can use these recommendations to make your own judgements about defining variables in your analytic workspace, or you can continue with the following step.</p>
</li>
<li>
<p>Call the <code>ADVISE_DIMENSIONALITY</code> procedure to get the OLAP DML object definitions for the recommended composite, partitioning, and variable definitions.</p>
<p><span class="bolditalic">or</span></p>
<p>Use the <code>ADVISE_DIMENSIONALITY</code> function to get the OLAP DML object definition for the recommended composite and the dimension order for the variable definitions for a specific partition.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<div id="OLADM2977" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref5464"></a>
<h3 class="sect2">Example: Evaluating Sparsity in the GLOBAL Schema</h3>
<p><a href="#BABIEEEH">Example B-1, "Sparsity Advisor Script for GLOBAL"</a> provides a SQL script for evaluating the sparsity of the <code>UNITS_HISTORY_FACT</code> table in the <code>GLOBAL</code> schema. In the <code>GLOBAL</code> analytic workspace, <code>UNITS_HISTORY_FACT</code> defines the Units Cube and is the source for the <code>UNITS</code> variable. <code>UNITS_HISTORY_FACT</code> is a fact table with a primary key composed of foreign keys from four dimension tables. A fifth column contains the facts for Unit Sales.</p>
<p>The <code>CHANNEL_DIM</code> and <code>CUSTOMER_DIM</code> tables contain all of the information for the Channel and Customer dimensions in a basic star configuration. Three tables in a snowflake configuration provide data for the Time dimension: <code>MONTH_DIM</code>, <code>QUARTER_DIM</code>, and <code>YEAR_DIM</code>. The <code>PRODUCT_CHILD_PARENT</code> table is a parent-child table and defines the Product dimension.</p>
<div id="OLADM2978" class="example">
<p class="titleinexample"><a id="BABIEEEH"></a>Example B-1 Sparsity Advisor Script for GLOBAL</p>
<pre>
CONNECT global/global
SET ECHO ON
SET LINESIZE 300
SET PAGESIZE 300
SET SERVEROUT ON FORMAT WRAPPED
 
-- Define and initialize an advice table named AW_SPARSITY_ADVICE
BEGIN
     dbms_aw.sparsity_advice_table();
EXCEPTION
     WHEN OTHERS THEN NULL;
END;
/
 
TRUNCATE TABLE aw_sparsity_advice;
 
DECLARE
     dimsources dbms_aw$_dimension_sources_t;
     dimlist VARCHAR2(500);
     sparsedim VARCHAR2(500);
     defs CLOB;
BEGIN
-- Provide information about all dimensions in the cube
     dbms_aw.add_dimension_source('channel', 'channel_id', dimsources, 
         'channel_dim', dbms_aw.hier_levels,
          dbms_aw$_columnlist_t('channel_id', 'total_channel_id'));
     dbms_aw.add_dimension_source('product', 'item_id', dimsources, 
          'product_child_parent', dbms_aw.hier_parentchild, 
           dbms_aw$_columnlist_t('product_id', 'parent_id'));
     dbms_aw.add_dimension_source('customer', 'ship_to_id', dimsources,
         'customer_dim', dbms_aw.hier_levels,
          dbms_aw$_columnlist_t('ship_to_id', 'warehouse_id', 'region_id',
               'total_customer_id'));
     dbms_aw.add_dimension_source('time', 'month_id', dimsources,
           'SELECT m.month_id, q.quarter_id, y.year_id
                FROM time_month_dim m, time_quarter_dim q, time_year_dim y
                WHERE m.parent=q.quarter_id AND q.parent=y.year_id',
            dbms_aw.hier_levels, 
            dbms_aw$_columnlist_t('month_id', 'quarter_id', 'year_id'));
 
-- Analyze fact table and provide advice without partitioning
     dbms_aw.advise_sparsity('units_history_fact', 'units_cube', 
          dimsources, dbms_aw.advice_default, dbms_aw.partby_none);
 
COMMIT;
 
-- Generate OLAP DML for composite and variable definitions
dimlist := dbms_aw.advise_dimensionality('units_cube', sparsedim, 
           'units_cube_composite');
dbms_output.put_line('Dimension list:  ' || dimlist);
dbms_output.put_line('Sparse dimension:  ' || sparsedim);
dbms_aw.advise_dimensionality(defs, 'units_cube');
dbms_output.put_line('Definitions:  ');
dbms_aw.printlog(defs);
 
END;
/
</pre></div>
<!-- class="example" -->
<div id="OLADM2979" class="sect3"><a id="sthref5465"></a>
<h4 class="sect3">Advice from Sample Program</h4>
<p>The script in <a href="#BABIEEEH">Example B-1, "Sparsity Advisor Script for GLOBAL"</a> generates the following information.</p>
<pre>
Dimension list:  &lt;channel units_cube_composite&lt;product customer time&gt;&gt;
Sparse dimension:  DEFINE units_cube_composite COMPOSITE &lt;product customer time&gt;
Definitions:
DEFINE units_cube.cp COMPOSITE &lt;product customer time&gt;
DEFINE units_cube NUMBER VARIABLE &lt;channel units_cube.cp&lt;product customer time&gt;&gt;
PL/SQL procedure successfully completed.
</pre></div>
<!-- class="sect3" -->
<div id="OLADM2980" class="sect3"><a id="sthref5466"></a>
<h4 class="sect3">Information Stored in AW_SPARSITY_ADVICE Table</h4>
<p><a id="sthref5467"></a>This SQL <code>SELECT</code> statement shows some columns from the <code>AW_SPARSITY_ADVICE</code> table, which is the basis for the recommended OLAP DML object definitions.</p>
<pre>
SELECT fact, dimension, dimcolumn, membercount nmem, leafcount nleaf, 
     advice, density
     FROM aw_sparsity_advice
     WHERE cubename='units_cube';
 
</pre>
<p>This query returns the following result set:</p>
<pre>
FACT                 DIMENSION    DIMCOLUMN     NMEM  NLEAF ADVICE        DENSITY
-------------------- ------------ ------------ ----- ------ ------------ --------
units_history_fact   channel      channel_id       3      3 DENSE          .46182
units_history_fact   product      item_id         48     36 SPARSE         .94827
units_history_fact   customer     ship_to_id      61     61 SPARSE         .97031
units_history_fact   time         month_id        96     79 SPARSE         .97664
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABBEFGI"></a>
<div id="OLADM961" class="sect1">
<h2 class="sect1">Using the Aggregate Advisor</h2>
<p>The <a id="ABC2608071"></a>management <a id="sthref5468"></a>of aggregate data within analytic workspaces can have significant performance implications. To determine an optimal set of dimension member combinations to preaggregate, you can use the <code>ADVISE_REL</code> and <code>ADVISE_CUBE</code> procedures in the <code>DBMS_AW</code> package. These procedures are known together as the <span class="bold"><a id="ABC2608091"></a>Aggregate Advisor.</span></p>
<p>Based on a percentage that you specify, <code>ADVISE_REL</code> suggests a set of dimension members to preaggregate. The <code>ADVISE_CUBE</code> procedure suggests a set of members for each dimension of a cube.</p>
<div id="OLADM962" class="sect2"><a id="sthref5469"></a>
<h3 class="sect2">Aggregation Facilities within the Workspace</h3>
<p>Instructions for storing aggregate data are specified in an analytic workspace object called an aggmap. The OLAP DML <code>AGGREGATE</code> command uses the aggmap to preaggregate the data. Any data that is not preaggregated is aggregated dynamically by the <code>AGGREGATE</code> function when the data is queried.</p>
<p>Choosing a balance between static and dynamic aggregation depends on many factors including disk space, available memory, and the nature and frequency of the queries that run against the data. After weighing these factors, you may arrive at a percentage of the data to preaggregate.</p>
<p>Once you have determined the percentage of the data to preaggregate, you can use the Aggregate Advisor. These procedures analyze the distribution of dimension members within hierarchies and identify an optimal set of dimension members to preaggregate.</p>
</div>
<!-- class="sect2" -->
<div id="OLADM2981" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref5470"></a>
<h3 class="sect2">Example: Using the ADVISE_REL Procedure</h3>
<p>Based on a precompute percentage that you specify, the <code>ADVISE_REL</code> procedure analyzes a family relation, which represents a dimension with all its hierarchical relationships, and returns a list of dimension members. <a id="sthref5471"></a></p>
<p><code>ADVISE_CUBE</code> applies similar heuristics to each dimension in an aggmap for a cube.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="dml_app_dbms_aw008.htm#CEGFHDII">"ADVISE_REL Procedure"</a></p>
</li>
<li>
<p><a href="dml_app_dbms_aw003.htm#CEGJCHHA">ADVISE_CUBE Procedure</a></p>
</li>
</ul>
</div>
<p><a href="#CEGJADGH">Example B-2</a> uses the following sample Customer dimension to illustrate the <code>ADVISE_REL</code> procedure.</p>
<p class="subhead2"><a id="CEGEDHDG"></a><a id="OLADM2982"></a>Sample Dimension: Customer in the Global Analytic Workspace</p>
<p>The Customer dimension in <code>GLOBAL_AW.GLOBAL</code> has two hierarchies: <code>SHIPMENTS_ROLLUP</code> with four levels, and <code>MARKET_ROLLUP</code> with three levels. The dimension has 106 members. This number includes all members at each level and all level names.</p>
<p>The members of the Customer dimension are integer keys whose text values are defined in long and short descriptions.</p>
<p>The following OLAP DML commands show information about the representation of the Customer dimension, which is in database standard form.</p>
<pre>
<span class="bold">SET serveroutput ON</span>
---- Number of members of Customer dimension
<span class="bold">EXECUTE dbms_aw.execute('SHOW STATLEN(customer)')</span>
106

---- Hierarchies in Customer dimension;
<span class="bold">EXECUTE dbms_aw.execute('REPORT W 40 customer_hierlist');</span>
CUSTOMER_HIERLIST
----------------------------------------
MARKET_ROLLUP
SHIPMENTS_ROLLUP

---- Levels in Customer dimension
<span class="bold">EXECUTE dbms_aw.execute('REPORT W 40 customer_levellist');</span>

CUSTOMER_LEVELLIST
----------------------------------------
TOTAL_CUSTOMER
REGION
WAREHOUSE
TOTAL_MARKET
MARKET_SEGMENT
ACCOUNT
SHIP_TO
---- Levels in each hierarchy from leaf to highest
<span class="bold">EXECUTE dbms_aw.execute('REPORT W 20 customer_hier_levels');</span>
 
CUSTOMER_HIERL
IST            CUSTOMER_HIER_LEVELS
-------------- --------------------
SHIPMENTS      SHIP_TO
               WAREHOUSE
               REGION
               TOTAL_CUSTOMER
MARKET_SEGMENT SHIP_TO
               ACCOUNT
               MARKET_SEGMENT
               TOTAL_MARKET

---- Parent relation showing parent-child relationships in the Customer dimension
---- Only show the last 20 members
<span class="bold">EXECUTE dbms_aw.execute('LIMIT customer TO LAST 20');</span>
<span class="bold">EXECUTE dbms_aw.execute('REPORT W 10 DOWN customer W 20 customer_parentrel');</span>

           -----------CUSTOMER_PARENTREL------------
           ------------CUSTOMER_HIERLIST------------
CUSTOMER      MARKET_ROLLUP       SHIPMENTS_ROLLUP
---------- -------------------- --------------------
103        44                   21
104        45                   21
105        45                   21
106        45                   21
7          NA                   NA
1          NA                   NA
8          NA                   1
9          NA                   1
10         NA                   1
11         NA                   8
12         NA                   10
13         NA                   9
14         NA                   9
15         NA                   8
16         NA                   9
17         NA                   8
18         NA                   8
19         NA                   9
20         NA                   9
21         NA                   10

---- Show text descriptions for the same twenty dimension members 
<span class="bold">EXECUTE dbms_aw.execute('REPORT W 15 DOWN customer W 35 ACROSS customer_hierlist: &lt;customer_short_description&gt;');</span>
ALL_LANGUAGES: AMERICAN_AMERICA
                ---------------------------CUSTOMER_HIERLIST---------------------------
                -----------MARKET_ROLLUP----------- ---------SHIPMENTS_ROLLUP----------
CUSTOMER            CUSTOMER_SHORT_DESCRIPTION          CUSTOMER_SHORT_DESCRIPTION
--------------- ----------------------------------- -----------------------------------
103             US Marine Svcs Washington           US Marine Svcs Washington
104             Warren Systems New York             Warren Systems New York
105             Warren Systems Philladelphia        Warren Systems Philladelphia
106             Warren Systems Boston               Warren Systems Boston
7               Total Market                        NA
1               NA                                  All Customers
8               NA                                  Asia Pacific
9               NA                                  Europe
10              NA                                  North America
11              NA                                  Australia
12              NA                                  Canada
13              NA                                  France
14              NA                                  Germany
15              NA                                  Hong Kong
16              NA                                  Italy
17              NA                                  Japan
18              NA                                  Singapore
19              NA                                  Spain
20              NA                                  United Kingdom
21              NA                                  United States
</pre>
<div id="OLADM2983" class="example">
<p class="titleinexample"><a id="CEGJADGH"></a>Example B-2 ADVISE_REL: Suggested Preaggregation of the Customer Dimension</p>
<p>This example uses the <code>GLOBAL</code> Customer dimension described in <a href="#CEGEDHDG">Sample Dimension: Customer in the Global Analytic Workspace</a>.</p>
<p>The following PL/SQL statements assume that you want to preaggregate 25% of the Customer dimension. <code>ADVISE_REL</code> returns the suggested set of members in a valueset.</p>
<pre>
SET serveroutput ON
EXECUTE dbms_aw.execute('AW ATTACH global_aw.global');
EXECUTE dbms_aw.execute('DEFINE customer_preagg VALUESET customer');
EXECUTE dbms_aw.advise_rel('customer_parentrel', 'customer_preagg', 25);
EXECUTE dbms_aw.execute('SHOW VALUES(customer_preagg)');
31
2
4
5
6
7
1
8
9
20
21
</pre></div>
<!-- class="example" -->
<p>The returned Customer members with their <a id="sthref5472"></a>text <a id="sthref5473"></a>descriptions, related levels, and related hierarchies, are shown as follows.</p>
<div class="inftblinformal">
<table class="cellalignment3100" title="Customer Dimension Members Returned by DBMS_AW.ADVISE_REL" summary="DBMS_AW.ADVISE_REL example illustrating preaggregation of a Customer dimension" dir="ltr">
<thead>
<tr class="cellalignment3089">
<th class="cellalignment3099" id="r1c1-t5">Customer Member</th>
<th class="cellalignment3099" id="r1c2-t5">Description</th>
<th class="cellalignment3099" id="r1c3-t5">Hierarchy</th>
<th class="cellalignment3099" id="r1c4-t5">Level</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r2c1-t5" headers="r1c1-t5"><code>31</code></td>
<td class="cellalignment3095" headers="r2c1-t5 r1c2-t5"><code>Kosh Enterprises</code></td>
<td class="cellalignment3095" headers="r2c1-t5 r1c3-t5"><code>MARKET_ROLLUP</code></td>
<td class="cellalignment3095" headers="r2c1-t5 r1c4-t5"><code>ACCOUNT</code></td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r3c1-t5" headers="r1c1-t5"><code>2</code></td>
<td class="cellalignment3095" headers="r3c1-t5 r1c2-t5"><code>Consulting</code></td>
<td class="cellalignment3095" headers="r3c1-t5 r1c3-t5"><code>MARKET_ROLLUP</code></td>
<td class="cellalignment3095" headers="r3c1-t5 r1c4-t5"><code>MARKET_SEGMENT</code></td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r4c1-t5" headers="r1c1-t5"><code>4</code></td>
<td class="cellalignment3095" headers="r4c1-t5 r1c2-t5"><code>Government</code></td>
<td class="cellalignment3095" headers="r4c1-t5 r1c3-t5"><code>MARKET_ROLLUP</code></td>
<td class="cellalignment3095" headers="r4c1-t5 r1c4-t5"><code>MARKET_SEGMENT</code></td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r5c1-t5" headers="r1c1-t5"><code>5</code></td>
<td class="cellalignment3095" headers="r5c1-t5 r1c2-t5"><code>Manufacturing</code></td>
<td class="cellalignment3095" headers="r5c1-t5 r1c3-t5"><code>MARKET_ROLLUP</code></td>
<td class="cellalignment3095" headers="r5c1-t5 r1c4-t5"><code>MARKET_SEGMENT</code></td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r6c1-t5" headers="r1c1-t5"><code>6</code></td>
<td class="cellalignment3095" headers="r6c1-t5 r1c2-t5"><code>Reseller</code></td>
<td class="cellalignment3095" headers="r6c1-t5 r1c3-t5"><code>MARKET_ROLLUP</code></td>
<td class="cellalignment3095" headers="r6c1-t5 r1c4-t5"><code>MARKET_SEGMENT</code></td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r7c1-t5" headers="r1c1-t5"><code>7</code></td>
<td class="cellalignment3095" headers="r7c1-t5 r1c2-t5"><code>TOTAL_MARKET</code></td>
<td class="cellalignment3095" headers="r7c1-t5 r1c3-t5"><code>MARKET_ROLLUP</code></td>
<td class="cellalignment3095" headers="r7c1-t5 r1c4-t5"><code>TOTAL_MARKET</code></td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r8c1-t5" headers="r1c1-t5"><code>1</code></td>
<td class="cellalignment3095" headers="r8c1-t5 r1c2-t5"><code>TOTAL_CUSTOMER</code></td>
<td class="cellalignment3095" headers="r8c1-t5 r1c3-t5"><code>SHIPMENTS_ROLLUP</code></td>
<td class="cellalignment3095" headers="r8c1-t5 r1c4-t5"><code>TOTAL_CUSTOMER</code></td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r9c1-t5" headers="r1c1-t5"><code>8</code></td>
<td class="cellalignment3095" headers="r9c1-t5 r1c2-t5"><code>Asia Pacific</code></td>
<td class="cellalignment3095" headers="r9c1-t5 r1c3-t5"><code>SHIPMENTS_ROLLUP</code></td>
<td class="cellalignment3095" headers="r9c1-t5 r1c4-t5"><code>REGION</code></td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r10c1-t5" headers="r1c1-t5"><code>9</code></td>
<td class="cellalignment3095" headers="r10c1-t5 r1c2-t5"><code>Europe</code></td>
<td class="cellalignment3095" headers="r10c1-t5 r1c3-t5"><code>SHIPMENTS_ROLLUP</code></td>
<td class="cellalignment3095" headers="r10c1-t5 r1c4-t5"><code>REGION</code></td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r11c1-t5" headers="r1c1-t5"><code>20</code></td>
<td class="cellalignment3095" headers="r11c1-t5 r1c2-t5"><code>United Kingdom</code></td>
<td class="cellalignment3095" headers="r11c1-t5 r1c3-t5"><code>SHIPMENTS_ROLLUP</code></td>
<td class="cellalignment3095" headers="r11c1-t5 r1c4-t5"><code>WAREHOUSE</code></td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r12c1-t5" headers="r1c1-t5"><code>21</code></td>
<td class="cellalignment3095" headers="r12c1-t5 r1c2-t5"><code>United States</code></td>
<td class="cellalignment3095" headers="r12c1-t5 r1c3-t5"><code>SHIPMENTS_ROLLUP</code></td>
<td class="cellalignment3095" headers="r12c1-t5 r1c4-t5"><code>WAREHOUSE</code></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<div class="refentry"></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
</div>
</div>
<footer><!--
<hr />
<table class="cellalignment3088">
<tr>
<td class="cellalignment3095">
<table class="cellalignment3093">
<tr>
<td class="cellalignment3092"><a href="dml_app_sqlfunc006.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment3092"><a href="dml_app_dbms_aw001.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1994, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment3097">
<table class="cellalignment3091">
<tr>
<td class="cellalignment3092"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment3092"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment3092"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment3092"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment3092"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment3092"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>

<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
