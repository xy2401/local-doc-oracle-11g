<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>AGGREGATE command</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 742" />
<meta name="dcterms.created" content="2013-11-14T21:21:38Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="OLAP DML Reference" />
<meta name="dcterms.identifier" content="E17122-08" />
<meta name="dcterms.isVersionOf" content="OLADM" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1994, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="dml_commands_1008.htm" title="Previous" type="text/html" />
<link rel="Next" href="dml_commands_1010.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e17122.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">425/593</span> <!-- End Header --><a id="i78745"></a>
<hr />
<div id="OLADM739" class="refsect1">
<h1 class="refsect1">AGGREGATE command</h1>
<p><a id="ABC1046944"></a>The AGGREGATE command calculates summary data in the variable that is specified as PRECOMPUTE in the specified aggmap. (For information about specifying precompute data, see the <a href="dml_commands_1006.htm#BCFJGIGI">PRECOMPUTE</a> and <a href="dml_commands_1006.htm#i1017474">RELATION (for aggregation)</a> statements of the AGGMAP command.) The aggregation is limited to those values that are currently in status.</p>
<p>Use the $AGGMAP property or the AGGREGATE function to calculate data that is not specified as precomputed data.</p>
<div class="infoboxnotealso">
<p class="notep1">See also:</p>
<a href="dml_functions_1005.htm#i78750">AGGREGATE function</a></div>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3629"></a>Syntax</p>
<p class="synopsis">AGGREGATE|AGGR {&nbsp;<span class="italic">var</span> &nbsp;[(PARTITION <span class="italic">partition-name</span>)]}... [USING&nbsp;<span class="italic">aggmap</span>] -</p>
<p class="synopsis">[FROM <span class="italic">fromspec|</span>FROMVAR <span class="italic">textvar</span>] [FORCEORDER] [FUNCDATA]&nbsp;[COUNTVAR&nbsp;<span class="italic">countvar</span>...]</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3630"></a>Parameters</p>
<dl>
<dt><span class="italic">var</span></dt>
<dd>
<p>A variable whose data values are to be calculated. Every variable in a single AGGREGATE command must have the same dimensions in the same order.</p>
</dd>
<dt>PARTITION</dt>
<dd>
<p>Specifies that you want AGGREGATE to recalculate only the values in the specified partition of the specified variable. Frequently, the reason for aggregating only a single partition is to parallelize a build using multiwriter.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Because the AGGREGATE command does not consider partition dependencies when aggregating individual partitions, aggregate only a set of non-dependent partitions within a single AGGREGATE command.</div>
</dd>
<dt><span class="italic">partition-name</span></dt>
<dd>
<p>The name of a previously-defined partition. See <a href="dml_commands_1032.htm#i1007745">DEFINE PARTITION TEMPLATE</a></p>
</dd>
<dt>USING</dt>
<dd>
<p>This keyword indicates that the aggregation is performed using the specified aggmap. When you do not include this phrase, the command uses the default aggmap for the variable as previously specified using an AGGMAP statement or the $AGGMAP property.</p>
</dd>
<dt><span class="italic">aggmap</span></dt>
<dd>
<p>The name of a previously-defined aggmap that specifies how the data is aggregated.&nbsp;For information about aggmaps, see the <a href="dml_commands_1032.htm#i78488">DEFINE AGGMAP</a> command.</p>
</dd>
<dt>FROM</dt>
<dd>
<p>This keyword indicates that the detail data is obtained from a different object.</p>
<p>A FROM clause is only one way in which you can specify the variable from which detail data should be obtained when performing aggregation. See <a href="#i1013876">"Ways of Specifying Where to Obtain Detail Data for Aggregation"</a>.</p>
</dd>
<dt><span class="italic">fromspec</span></dt>
<dd>
<p>An arbitrarily dimensioned variable, formula, or relation from which the detail data for the aggregation is obtained.</p>
</dd>
<dt>FROMVAR</dt>
<dd>
<p>This keyword indicates that the detail data is obtained from different objects to perform a capstone aggregation. (For an example of using the FROMVAR clause, see <a href="#i1014840">Example 9-32, "Capstone Aggregation"</a>.)</p>
<p>A FROMVAR clause is only one way in which you can specify the variable from which detail data should be obtained when performing aggregation. See <a href="#i1013876">"Ways of Specifying Where to Obtain Detail Data for Aggregation"</a>.</p>
</dd>
<dt><span class="italic">textvar</span></dt>
<dd>
<p>An arbitrarily dimensioned variable used to resolve any leaf nodes. Specify <code>NA</code> to indicate that a node does not need detail data to calculate the value.</p>
</dd>
<dt>FORCEORDER</dt>
<dd>
<p>Specifies that the calculation must be performed in the order in which the RELATION statements are listed in the aggmap. Use this option when you have changed some values calculated by the AGGREGATE command. Otherwise, the optimization methods used by the AGGREGATE command may cause the modified values to be ignored.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also set an $AGGREGATE_FORCEORDER property on a variable to specify this behavior as the default aggregation behavior. In this case, you do not have to include the FORCEORDER keyword with the AGGREGATE command.</div>
</dd>
<dt>FUNCDATA</dt>
<dd>
<p>Compiles the aggregation specification for future use by the AGGREGATE function. When you use FUNCDATA, you do not have to recompile the aggmap before using the AGGREGATE function, unless afterward you make changes to the aggmap, the relation hierarchies, or a composite.</p>
<p>When the variables have composite dimensions, the indexes (composite tuples) are created and saved for use by the AGGREGATE function. Otherwise, the indexes are re-created each time the AGGREGATE function is called. Refer to AGGINDEX for more information about composite indexes.</p>
</dd>
<dt>COUNTVAR <span class="italic">countvar</span></dt>
<dd>
<p>Indicates that Oracle OLAP should use the user-defined variable specified by <span class="italic">countvar</span> to store the non-<code>NA</code> counts of the number of leaf nodes that contributed to aggregate values calculated for RELATION statements that have an AVERAGE, HAVERAGE, HWAVERAGE, or WAVERAGE operator.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Typically, you do <span class="italic">not</span> use a user-defined Countvar variable to store the counts for average aggregations. Instead, you use an Oracle OLAP-created Aggcount variable. You <span class="italic">must</span> use an Aggcount variable when the aggregation specification includes a RELATION statement with an average operator is for a compressed composite.
<p>For more information on Aggcount variables, see <a href="dml_commands_1032.htm#CIHFEAGE">"Aggcount Variables"</a>.</p>
</div>
<p>The <span class="italic">countvar</span> variable must be an <code>INTEGER</code> variable with the same dimensions in the same order as the dimensions of the variable specified by <span class="italic">var</span>. When you aggregate several variables together, you must define an <code>INTEGER</code> variable for each one to record the results.</p>
</dd>
</dl>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3631"></a>Usage Notes</p>
<p class="subhead2"><a id="OLADM2153"></a>Effect of Status on AGGREGATE</p>
<p>The current status only affects dimension values at the lowest level of the hierarchy, that is, the leaf nodes. Only leaf-node dimension values that are currently in status are aggregated. The parent values of leaf nodes in status are calculated, whether the parent values are in status or not (unless you exclude the dimension values in those levels with a PRECOMPUTE clause in the <a href="dml_commands_1006.htm#i1032719">AGGMAP</a> command). Thus, when you want to aggregate all of the data specified in the aggmap, then be sure to set the status of the dimensions to ALL before performing the aggregation.</p>
<p>AGGREGATE uses the parent relation to distinguish among dimension values at different levels of the hierarchy. Alternatively, you can perform a partial aggregation of the data by limiting status. However, this must be done carefully when some data is aggregated at run time by the AGGREGATE function. See the notes in the <a href="dml_functions_1005.htm#i78750">AGGREGATE function</a> topic for more information.</p>
<p>For example, suppose you use the <code>area</code> dimension and the <code>area.area</code> child-parent relation that supports one hierarchy for a geography dimension as illustrated in <a href="#g1042780">Table 9-2, "Geography Hierarchy"</a>.</p>
<div id="OLADM2154" class="tblformal">
<p class="titleintable"><a id="sthref3632"></a><a id="g1042780"></a>Table 9-2 Geography Hierarchy</p>
<table class="cellalignment3098" title="Geography Hierarchy" summary="This table shows the values for a child-parent relation that supports on hierarchy for a geography dimension." dir="ltr">
<thead>
<tr class="cellalignment3089">
<th class="cellalignment3099" id="r1c1-t36">Level</th>
<th class="cellalignment3099" id="r1c2-t36">area Dimension</th>
<th class="cellalignment3099" id="r1c3-t36">area.area Parent Relation</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r2c1-t36" headers="r1c1-t36">
<p>1</p>
</td>
<td class="cellalignment3095" headers="r2c1-t36 r1c2-t36">
<p><code>TotalUS</code></p>
</td>
<td class="cellalignment3095" headers="r2c1-t36 r1c3-t36">
<p><code>NA</code></p>
</td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r3c1-t36" headers="r1c1-t36">
<p>2</p>
</td>
<td class="cellalignment3095" headers="r3c1-t36 r1c2-t36">
<p><code>East</code></p>
</td>
<td class="cellalignment3095" headers="r3c1-t36 r1c3-t36">
<p><code>TotalUS</code></p>
</td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r4c1-t36" headers="r1c1-t36">
<p>2</p>
</td>
<td class="cellalignment3095" headers="r4c1-t36 r1c2-t36">
<p><code>South</code></p>
</td>
<td class="cellalignment3095" headers="r4c1-t36 r1c3-t36">
<p><code>TotalUS</code></p>
</td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r5c1-t36" headers="r1c1-t36">
<p>3</p>
</td>
<td class="cellalignment3095" headers="r5c1-t36 r1c2-t36">
<p><code>Boston</code></p>
</td>
<td class="cellalignment3095" headers="r5c1-t36 r1c3-t36">
<p><code>East</code></p>
</td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r6c1-t36" headers="r1c1-t36">
<p>3</p>
</td>
<td class="cellalignment3095" headers="r6c1-t36 r1c2-t36">
<p><code>New York</code></p>
</td>
<td class="cellalignment3095" headers="r6c1-t36 r1c3-t36">
<p><code>East</code></p>
</td>
</tr>
<tr class="cellalignment3089">
<td class="cellalignment3095" id="r7c1-t36" headers="r1c1-t36">
<p>3</p>
</td>
<td class="cellalignment3095" headers="r7c1-t36 r1c2-t36">
<p><code>Atlanta</code></p>
</td>
<td class="cellalignment3095" headers="r7c1-t36 r1c3-t36">
<p><code>South</code></p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p>Now suppose you change the data value for <code>New</code> <code>York</code>. When you then use AGGREGATE with only <code>New</code> <code>York</code>, the calculation occurs without including the child value for <code>South</code> (<code>Atlanta</code>), but still includes level <code>2</code> as it goes from level <code>3</code> to level <code>1</code> (<code>TotalUS</code>). When you want <span class="italic">all</span> the child values included in rolling up to <code>TotalUS</code>, use <code>a LIMIT TO ALL</code> statement before you execute the AGGREGATE command.</p>
<p>When the data has changed for some, but not all, of the child values in a hierarchy, you can set the status to calculate just the values that have changed. For example, when your embedded-total dimension is called <code>d2</code>, and its parent relation is called <code>reld2</code>, first limit <code>d2</code> to the values that have changed.</p>
<p>To calculate the data for every hierarchy in a dimension, limit the dimension's hierarchy dimension to <code>ALL</code> before you execute the AGGREGATE command.</p>
<p class="subhead2"><a id="OLADM2155"></a>Controlling the Amount of Data That Is Calculated</p>
<p>You can control how much of the variable data is calculated by using the PRECOMPUTE keyword with the RELATION statement in the aggmap. Use the limit clause (after the PRECOMPUTE keyword) to set the status of the dimension.</p>
<p class="subhead2"><a id="OLADM2156"></a>When Users Modify Data</p>
<p>When users are able to change the data in a variable, then calculate aggregates on the fly using the AGGREGATE function, so that their changes are reflected in the aggregate data. See the <a href="dml_functions_1005.htm#i78750">AGGREGATE function</a> for more information about run-time changes to the data.</p>
<p class="subhead2"><a id="OLADM2157"></a>Generation-Skipping Hierarchies</p>
<p>AGGREGATE automatically distinguishes between generations in the parent relation, even to the extent of allowing <span class="italic">generation-skipping</span> hierarchies. For example, you can have a four-level hierarchy (for example, <code>neighborhoods</code>, <code>cities</code>, <code>states</code>, and <code>totalUS</code>) that has a three-level branch (for example, <code>Boston</code>, <code>Massachusetts</code>, and <code>totalUS</code>).</p>
<p class="subhead2"><a id="OLADM2158"></a>Restrictions on Permissions</p>
<p>AGGREGATE does not work on variables that have cell-by-cell permissions; it immediately return an error. It also ignores the PERMITERROR option. However, AGGREGATE operates on variables with object level or dimension level permission. See the <a href="dml_commands_2026.htm#i79588">PERMIT</a> command and <a href="dml_options081.htm#i79593">PERMITERROR</a> option.</p>
<p class="subhead2"><a id="i1013876"></a><a id="OLADM2159"></a>Ways of Specifying Where to Obtain Detail Data for Aggregation</p>
<p>You can specify where to obtain detail data when aggregating data in the following ways:</p>
<ul>
<li>
<p>Assign either an $AGGREGATE_FROM property or an $AGGREGATE_FROMVAR property to a variable.</p>
<div class="infobox-note">
<p class="notep1"><span class="bold">Note</span>:</p>
You can only assign one of these properties to a variable. A variable cannot have both the $AGGREGATE_FROM and $AGGREGATE_FROMVAR properties assigned to it.</div>
</li>
<li>
<p>Include either a FROM or FROMVAR clause in the AGGREGATE command or AGGREGATE function that aggregates the data.</p>
</li>
</ul>
<p>When performing an aggregation, Oracle OLAP determines where to obtain the detail data as follows:</p>
<ol>
<li>
<p>When a location has been specified using a FROM or FROMVAR clause, Oracle OLAP uses the detail data at that location.</p>
</li>
<li>
<p>When a location has not been specified using a FROM or FROMVAR clause, Oracle OLAP checks to see if a location has been specified using an $AGGREGATE_FROM property or an $AGGREGATE_FROMVAR property. When a location has been specified using one of these properties, Oracle OLAP uses the detail data at that location.</p>
</li>
<li>
<p>When a location has not been specified using either FROM or FROMVAR clause or an $AGGREGATE_FROM property or an $AGGREGATE_FROMVAR property, Oracle OLAP performs the aggregation using the detail data in the variable itself.</p>
</li>
</ol>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref3633"></a>Examples</p>
<p>This section contains several examples of using the AGGREGATE command. For additional aggregation examples, see the examples in the <a href="dml_commands_1006.htm#i1032719">AGGMAP</a> command.</p>
<div id="OLADM2160" class="example">
<p class="titleinexample"><a id="CACEHBCH"></a><a id="i1034615"></a>Example 9-27 Precalculating Data in a Batch Job</p>
<p>Frequently, you generate precalculated aggregates in a batch window as part of maintaining the data in your database. For example, you can use Job Manager to schedule batch jobs in Oracle Enterprise Manager, as described in <span class="italic">Oracle OLAP User's Guide.</span></p>
<p>To generate precalculated aggregates, you use the AGGREGATE command. The AGGREGATE command aggregates the data for one or more variables according to the specifications provided in the aggmap.</p>
<p>Your batch job should include statements like the following<a id="sthref3634"></a>.</p>
<pre>
AGGREGATE sales units USING gpct.aggmap
UPDATE
COMMIT
</pre></div>
<!-- class="example" -->
<div id="OLADM2161" class="example">
<p class="titleinexample"><a id="i80192"></a>Example 9-28 Aggregating One Variable</p>
<p>Suppose your analytic workspace contains a variable named <code>actuals</code>, which has the following definition.</p>
<pre>
DEFINE actuals DECIMAL &lt;time, SPARSE &lt;product, customer, channel&gt;&gt;
</pre>
<p>The next step is to define an aggmap object, whose definition has the same dimensions in the same dimension order. Suppose you define an aggmap object named <code>act.agg</code> using DEFINE AGGMAP.</p>
<pre>
DEFINE act.agg AGGMAP &lt;time, SPARSE &lt;product, customer, channel&gt;&gt;
</pre>
<p>Suppose that the name of the hierarchy for the <code>time</code> dimension is <code>time.r</code>, the name of the <code>product</code> dimension is <code>product.r</code>, and so on Next, you use an AGGMAP statement to add the following text in the <code>act.agg</code> aggmap.</p>
<pre>
AGGMAP
RELATION time.r
RELATION product.r
RELATION customer.r
RELATION channel.r
END
</pre>
<p>The preceding text specifies the name of each dimension's hierarchy for which data should be rolled up. Assuming that the current status of every dimension is <code>ALL</code>, data is calculated for every dimension value of every dimension in the definition of <code>actuals</code>. No data is calculated on the fly.</p>
<p>Use the following statements to calculate the <code>actuals</code> variable. (It is not necessary to compile the aggmap, because the compilation is included as part of the AGGREGATE command.)</p>
<pre>
AGGREGATE actuals USING act.agg
</pre></div>
<!-- class="example" -->
<div id="OLADM2162" class="example">
<p class="titleinexample"><a id="sthref3635"></a>Example 9-29 Aggregating Multiple Variables</p>
<p>Suppose your analytic workspace contains a variable named <code>actuals</code> and a variable named <code>forecast</code>. As shown in the following variable definitions, these variables have the same dimensions in the same dimension order.</p>
<pre>
DEFINE actuals DECIMAL &lt;time, SPARSE &lt;product, customer, channel&gt;&gt;
DEFINE forecast DECIMAL &lt;time, SPARSE &lt;product, customer, channel&gt;&gt;
</pre>
<p>The next step is to define an aggmap object, whose definition has the same dimensions in the same dimension order. Suppose you define the same aggmap object named <code>act.agg</code>, as described in <a href="#i80192">"Aggregating One Variable"</a>. When you want the data for each variable to be rolled up in the same way, you can use the same aggmap to calculate both variables in a single statement.</p>
<p>Use the following statements to calculate the <code>actuals</code> and the <code>forecast</code> variables.</p>
<pre>
AGGREGATE actuals forecast USING act.agg
</pre>
<p>Because the aggmap specifies that all data for every dimension value in each dimension should be rolled up, this statement rolls up all of the data in <code>actuals</code> and all of the data in <code>forecast</code>.</p>
</div>
<!-- class="example" -->
<div id="OLADM2163" class="example">
<p class="titleinexample"><a id="sthref3636"></a>Example 9-30 Using COUNTVAR with Multiple Variables</p>
<p>Suppose you plan to use one AGGREGATE command to aggregate the data for three variables: <code>sales</code>, <code>units</code>, and <code>projected_sales</code>. Each variable has the following dimensionality.</p>
<pre>
&lt;month product geography&gt;
</pre>
<p>To tally the results with COUNTVAR, you must define three <code>INTEGER</code> variables that have the same dimensionality as <code>sales</code>, <code>units</code>, and <code>projected_sales</code>.</p>
<pre>
DEFINE intsales INTEGER &lt;month product geography&gt;
DEFINE intunits INTEGER &lt;month product geography&gt;
DEFINE intprojsales INTEGER &lt;month product geography&gt;
</pre>
<p>You can then specify the <code>INTEGER</code> variables in the following statement.</p>
<pre>
AGGREGATE sales units projected_sales USING sales.agg -
  COUNTVAR intsales intunits inprojsales
</pre></div>
<!-- class="example" -->
<div id="OLADM2164" class="example">
<p class="titleinexample"><a id="sthref3637"></a>Example 9-31 Performing a Partial Aggregation</p>
<p>This example limits the <code>time</code> dimension to the last two time periods, so that only newly loaded data is aggregated.</p>
<p>The <code>tp2.agg</code> aggmap specifies preaggregation for all detail data currently in status.</p>
<pre>
DEFINE TP2.AGG AGGMAP
LD Full preaggregation
AGGMAP
RELATION time.parentrel PRECOMPUTE (ALL)
RELATION product.parentrel PRECOMPUTE (ALL)
END
</pre>
<p>For the aggregation, <code>time</code> is limited to the last two time periods and all <code>product</code> values are in status.</p>
<pre>
LIMIT time TO LAST 2
STATUS time product
The current status of TIME is:
Apr02, May02
LIMIT product TO ALL
</pre>
<p>The following AGGREGATE statement calculates <code>units</code> using the <code>tp2.agg</code> aggmap.</p>
<pre>
AGGREGATE units USING tp2.agg
</pre>
<p>The results of this aggregation show that parent values are calculated, regardless of their own status, when their children are in status.</p>
<pre>
LIMIT time TO '2002' 'Q1.02' 'Q2.02' 'Jan02' to 'May02'
REPORT DOWN time units
</pre>
<pre>
 -----------------------------------------UNITS-----------------------------------------
 ----------------------------------------PRODUCT----------------------------------------
TIME     FOOD      SNACKS    DRINKS   POPCORN   COOKIES   CAKES     SODA      JUICE
-------  --------  --------  -------- --------  --------  --------  --------  --------
2002     38        24        14       6         9         9         9         5
Q1.02    NA        NA        NA       NA        NA        NA        NA        NA
Q2.02    38        24        14       6         9         9         9         5
Jan02    NA        NA        NA       8         2         4         5         8
Feb02    NA        NA        NA       5         3         2         2         5
Mar02    NA        NA        NA       3         4         4         2         4
Apr02    21        13        8        2         7         4         6         2
May02    17        11        6        4         2         5         3         3
</pre></div>
<!-- class="example" -->
<div id="OLADM2165" class="example">
<p class="titleinexample"><a id="BCFIGIJJ"></a><a id="i1014840"></a>Example 9-32 Capstone Aggregation</p>
<p>Assume that your analytic workspace has the two hierarchical <code>TEXT</code> dimensions named <code>geog.d</code> and <code>time.d</code> with the following values.</p>
<pre>
GEOG.D
--------------
Boston
Medford
San Diego
Sunnydale
Massachusetts
California
United States

TIME.D
--------------
Jan76
Feb76
Mar76
76Q1
</pre>
<p>Assume, also, that there are four variables with the following definitions</p>
<pre>
DEFINE sales_jan76 VARIABLE INTEGER &lt;geog.d&gt;
DEFINE sales_feb76 VARIABLE INTEGER &lt;geog.d&gt;
DEFINE sales_mar76 VARIABLE INTEGER &lt;geog.d&gt;
DEFINE sales_capstone76 VARIABLE INTEGER &lt;geog.d time.d&gt;
</pre>
<p>Assume that you issue the following REPORT statements for the variables. The output of the reports show the detail data in the variables.</p>
<pre>
REPORT sales_jan76  sales_feb76 sales_mar76
REPORT DOWN geog.d sales_capstone76

GEOG.D         SALES_JAN76  SALES_FEB76  SALES_MAR76
-------------- ------------ ------------ ------------
Boston                1,000        2,000        3,000
Medford               2,000        4,000        6,000
San Diego             3,000        6,000        9,000
Sunnydale             4,000        8,000       12,000
Massachusetts            NA           NA           NA
California               NA           NA           NA
United States            NA           NA           NA

               -----------------SALES_CAPSTONE76------------------
               ----------------------TIME.D-----------------------
GEOG.D            Jan76        Feb76        Mar76         76Q1
-------------- ------------ ------------ ------------ ------------
Boston                   NA           NA           NA           NA
Medford                  NA           NA           NA           NA
San Diego                NA           NA           NA           NA
Sunnydale                NA           NA           NA           NA
Massachusetts            NA           NA           NA           NA
California               NA           NA           NA           NA
United States            NA           NA           NA           NA
</pre>
<ol>
<li>
<p>Define two aggmap objects with the following definitions.</p>
<pre>
DEFINE leaf_aggmap AGGMAP
AGGMAP
RELATION geog.parentrel OPERATOR SUM
END

DEFINE capstone_aggmap AGGMAP
AGGMAP
RELATION time.parentrel OPERATOR SUM
END
</pre></li>
<li>
<p>Define a variable named <code>capstone_source</code> with the following definition to use to aggregate the data.</p>
<pre>
DEFINE capstone_source VARIABLE TEXT &lt;time.d&gt;
</pre>
<p>As the following output of a REPORT statement illustrates, for each value of <code>time.d</code>, you populate <code>capstone_source</code> with the name of the variable that contains the corresponding sales data.</p>
<pre>
TIME.D            CAPSTONE_SOURCE
-------------- ----------------------
Jan76          sales_jan76
Feb76          sales_feb76
Mar76          sales_mar76
76Q1           NA
</pre></li>
<li>
<p>Issue the following statements to aggregate the variables.</p>
<pre>
AGGREGATE sales_jan76 sales_feb76 sales_mar76 USING leaf_aggmap
AGGREGATE sales_capstone76 USING capstone_aggmap FROMVAR capstone_source
</pre>
<p>After aggregating the variables, when you issue the REPORT statements, the variables are populated with the calculated data.</p>
<pre>
REPORT sales_jan76  sales_feb76 sales_mar76
REPORT DOWN geog.d sales_capstone76

GEOG.D         SALES_JAN76  SALES_FEB76  SALES_MAR76
-------------- ------------ ------------ ------------
Boston                1,000        2,000        3,000
Medford               2,000        4,000        6,000
San Diego             3,000        6,000        9,000
Sunnydale             4,000        8,000       12,000
Massachusetts         3,000        6,000        9,000
California            7,000       14,000       21,000
United States        10,000       20,000       30,000

               -----------------SALES_CAPSTONE76------------------
               ----------------------TIME.D-----------------------
GEOG.D            Jan76        Feb76        Mar76         76Q1
-------------- ------------ ------------ ------------ ------------
Boston                1,000        2,000        3,000        6,000
Medford               2,000        4,000        6,000       12,000
San Diego             3,000        6,000        9,000       18,000
Sunnydale             4,000        8,000       12,000       24,000
Massachusetts         3,000        6,000        9,000       18,000
California            7,000       14,000       21,000       42,000
United States        10,000       20,000       30,000       60,000
</pre></li>
</ol>
</div>
<!-- class="example" --></div>
<!-- class="refsubsect" --></div>
<!-- class="refsect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment3088">
<tr>
<td class="cellalignment3095">
<table class="cellalignment3093">
<tr>
<td class="cellalignment3092"><a href="dml_commands_1008.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment3092"><a href="dml_commands_1010.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1994, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment3097">
<table class="cellalignment3091">
<tr>
<td class="cellalignment3092"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment3092"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment3092"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment3092"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment3092"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment3092"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
