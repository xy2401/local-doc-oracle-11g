<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Adding and Deleting Cluster Nodes</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1056" />
<meta name="dcterms.created" content="2015-06-03T16:55:36Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Clusterware Administration and Deployment Guide" />
<meta name="dcterms.identifier" content="E41959-04" />
<meta name="dcterms.isVersionOf" content="CWADD" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2007, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="votocr.htm" title="Previous" type="text/html" />
<link rel="Next" href="clonecluster.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e41959.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">9/21</span> <!-- End Header -->
<div id="CWADD1167" class="chapter"><a id="CHDFIAIE"></a>
<h1 class="chapter"><span class="secnum">4</span> Adding and Deleting Cluster Nodes</h1>
<p>This chapter describes how to add nodes to an existing cluster, and how to delete nodes from clusters. This chapter provides procedures for these tasks for Linux, UNIX, and Windows systems.</p>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>Unless otherwise instructed, perform all add and delete node steps as the user that installed Oracle Clusterware.</p>
</li>
<li>
<p>Oracle recommends that you use the cloning procedure described in <a href="clonecluster.htm#BABEDGHB">Chapter 5, "Cloning Oracle Clusterware"</a> to create clusters.</p>
</li>
</ul>
</div>
<p>The topics in this chapter include the following:</p>
<ul>
<li>
<p><a href="#CHDJFEEA">Prerequisite Steps for Adding Cluster Nodes</a></p>
</li>
<li>
<p><a href="#CHDDCJCI">Adding and Deleting Cluster Nodes on Linux and UNIX Systems</a></p>
</li>
<li>
<p><a href="#CHDDHEFF">Adding and Deleting Cluster Nodes on Windows Systems</a></p>
</li>
</ul>
<a id="CHDJFEEA"></a>
<div id="CWADD90987" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Prerequisite Steps for Adding Cluster Nodes</h2>
<div class="infobox-note">
<p class="notep1">Note:</p>
Ensure that you perform the preinstallation tasks listed in <a class="olink CWLIN168" href="../../install.112/e41961/prelinux.htm#CWLIN168"><span class="italic">Oracle Grid Infrastructure Installation Guide for Linux</span></a> before adding a node to a cluster.
<p><span class="italic">Do not</span> install Oracle Clusterware. The software is copied from an existing node when you add a node to the cluster.</p>
</div>
<p>Complete the following steps to prepare nodes to add to the cluster:</p>
<ol>
<li>
<p>Make physical connections.</p>
<p>Connect the nodes' hardware to the network infrastructure of your cluster. This includes establishing electrical connections, configuring network interconnects, configuring shared disk subsystem connections, and so on. See your hardware vendor documentation for details about this step.</p>
</li>
<li>
<p>Install the operating system.</p>
<p>Install a cloned image of the operating system that matches the operating system on the other nodes in your cluster. This includes installing required service patches, updates, and drivers. See your operating system vendor documentation for details about this process.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Oracle recommends that you use a cloned image. However, if the installation fulfills the installation requirements, then install the operating system according to the vendor documentation.</div>
</li>
<li>
<p>Create Oracle users.</p>
<p>You must create all Oracle users on the new node that exist on the existing nodes. For example, if you are adding a node to a cluster that has two nodes, and those two nodes have different owners for the Grid Infrastructure home and the Oracle home, then you must create those owners on the new node, even if you do not plan to install an Oracle home on the new node.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Perform this step only for Linux and UNIX systems.</div>
<p>As <code dir="ltr">root</code>, create the Oracle users and groups using the same user ID and group ID as on the existing nodes.</p>
</li>
<li>
<p>Ensure that SSH is configured on the node.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
SSH is configured when you install Oracle Clusterware 11<span class="italic">g</span> release 2 (11.2). If SSH is not configured, then see <a class="olink GINST" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=GINST"><span class="italic">Oracle Grid Infrastructure Installation Guide</span></a> for information about configuring SSH.</div>
</li>
<li id="BABJCFCD">
<p>Verify the hardware and operating system installations with the Cluster Verification Utility (CVU).</p>
<p>After you configure the hardware and operating systems on the nodes you want to add, you can run the following command to verify that the nodes you want to add are reachable by other nodes in the cluster. You can also use this command to verify user equivalence to all given nodes from the local node, node connectivity among all of the given nodes, accessibility to shared storage from all of the given nodes, and so on.</p>
<p>From the <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">/bin</code> directory on an existing node, run the CVU command to obtain a detailed comparison of the properties of the reference node with all of the other nodes that are part of your current cluster environment. Replace <code dir="ltr"><span class="codeinlineitalic">ref_node</span></code> with the name of a node in your existing cluster against which you want CVU to compare the nodes to be added. Specify a comma-delimited list of nodes after the <code dir="ltr">-n</code> option. In the following example, <code dir="ltr"><span class="codeinlineitalic">orainventory_group</span></code> is the name of the Oracle Inventory group, and <code dir="ltr"><span class="codeinlineitalic">osdba_group</span></code> is the name of the OSDBA group:</p>
<pre dir="ltr">
$ cluvfy comp peer [-refnode <span class="italic">ref_node</span>] -n <span class="italic">node_list</span>
[-orainv orainventory_group] [-osdba osdba_group] [-verbose]
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
For the reference node, select a cluster node against which you want CVU to compare, for example, the nodes that you want to add that you specify with the <code dir="ltr">-n</code> option.</div>
</li>
</ol>
<p>After completing the procedures in this section, you are ready to add the nodes to the cluster.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Avoid changing host names after you complete the Oracle Clusterware installation, including adding or deleting domain qualifications. Nodes with changed host names must be deleted from the cluster and added back with the new name.</div>
</div>
<!-- class="sect1" -->
<a id="CHDDCJCI"></a>
<div id="CWADD90988" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Adding and Deleting Cluster Nodes on Linux and UNIX Systems</h2>
<p><a id="sthref242"></a>This section explains cluster node addition and deletion on Linux and UNIX systems. The procedure in the section for adding nodes assumes that you have performed the steps in the <a href="#CHDJFEEA">"Prerequisite Steps for Adding Cluster Nodes"</a> section.</p>
<p>The last step of the node addition process includes extending the Oracle Clusterware home from an Oracle Clusterware home on an existing node to the nodes that you want to add.</p>
<p>This section includes the following topics:</p>
<ul>
<li>
<p><a href="#BEIHHFAG">Adding a Cluster Node on Linux and UNIX Systems</a></p>
</li>
<li>
<p><a href="#BEIFDCAF">Deleting a Cluster Node on Linux and UNIX Systems</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Beginning with Oracle Clusterware 11<span class="italic">g</span> release 1 (11.1), Oracle Universal Installer defaults to silent mode when adding nodes.</div>
<a id="BEIHHFAG"></a>
<div id="CWADD90989" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Adding a Cluster Node on Linux and UNIX Systems<a id="sthref243"></a></h3>
<p>This procedure describes how to add a node to your cluster. This procedure assumes that:</p>
<ul>
<li>
<p>There is an existing cluster with two nodes named <code dir="ltr">node1</code> and <code dir="ltr">node2</code></p>
</li>
<li>
<p>You are adding a node named <code dir="ltr">node3</code> using a virtual node name, <code dir="ltr">node3-vip</code>, that resolves to an IP address, if you are not using Grid Naming Service (GNS)</p>
</li>
<li>
<p>You have successfully installed Oracle Clusterware on <code dir="ltr">node1</code> and <code dir="ltr">node2</code> in a local (non-shared) home, where <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code> represents the successfully installed home</p>
</li>
</ul>
<p>To add a <a id="sthref244"></a><a id="sthref245"></a>node:</p>
<ol>
<li>
<p>Ensure that you have successfully installed Oracle Clusterware on at least one node in your cluster environment. To perform the following procedure, <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code> must identify your successfully installed Oracle Clusterware home.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink GINST" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=GINST"><span class="italic">Oracle Grid Infrastructure Installation Guide</span></a> for Oracle Clusterware installation instructions</div>
</li>
<li>
<p>Verify the integrity of the cluster and <code dir="ltr">node3</code>:</p>
<pre dir="ltr">
$ cluvfy stage -pre nodeadd -n node3 [-fixup [-fixupdir <span class="italic">fixup_dir</span>]] [-verbose]
</pre>
<p>You can specify the <code dir="ltr">-fixup</code> option and a directory into which CVU prints instructions to fix the cluster or node if the verification fails.</p>
</li>
<li>
<p>To extend the Grid Infrastructure home to the <code dir="ltr">node3</code>, navigate to the <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">/oui/bin</code> directory on <code dir="ltr">node1</code> and run the <code dir="ltr">addNode.sh</code> script as the user that installed Oracle Clusterware using the following syntax, where <code dir="ltr">node3</code> is the name of the node that you are adding and <code dir="ltr">node3-vip</code> is the VIP name for the node:</p>
<p>If you are using Grid Naming Service (GNS), run the following command:</p>
<pre dir="ltr">
$ ./addNode.sh "CLUSTER_NEW_NODES={node3}"
</pre>
<p>If you are not using GNS, run the following command:</p>
<pre dir="ltr">
$ ./addNode.sh "CLUSTER_NEW_NODES={node3}" "CLUSTER_NEW_VIRTUAL_
HOSTNAMES={node3-vip}"
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can specify multiple nodes for the <code dir="ltr">CLUSTER_NEW_NODES</code> and the <code dir="ltr">CLUSTER_NEW_VIRTUAL_HOSTNAMES</code> parameters by entering a comma-separated list of nodes between the braces. For example:
<pre dir="ltr">
"CLUSTER_NEW_NODES={node3,node4,node5}"
"CLUSTER_NEW_VIRTUAL_HOSTNAMES={node3-vip,node4-vip,node5-vip}"
</pre></div>
<p>Alternatively, you can specify the entries shown in <a href="#BABBHBHH">Example 4-1</a> in a response file, where <code dir="ltr"><span class="codeinlineitalic">file_name</span></code> is the name of the file, and run the <code dir="ltr">addNode.sh</code> script, as follows:</p>
<pre dir="ltr">
$ ./addNode.sh -responseFile <span class="italic">file_name</span>
</pre>
<div id="CWADD91275" class="example">
<p class="titleinexample"><a id="BABBHBHH"></a>Example 4-1 Response File Entries for Adding Oracle Clusterware Home</p>
<pre dir="ltr">
RESPONSEFILE_VERSION=2.2.1.0.0

CLUSTER_NEW_NODES={node3}
CLUSTER_NEW_VIRTUAL_HOSTNAMES={node3-vip}
</pre></div>
<!-- class="example" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<span class="italic">Oracle Universal Installer and OPatch User's Guide</span> for details about how to configure command-line response files</div>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>If you are not using Oracle Grid Naming Service (GNS), then you must add the name and IP address of <code dir="ltr">node3</code> to DNS.</p>
</li>
<li>
<p>Command-line values always override response file values.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="sthref246"></a>If you have an Oracle RAC or Oracle RAC One Node database configured on the cluster and you have a local Oracle home, then do the following to extend the Oracle database home to <code dir="ltr">node3</code>:</p>
<ol>
<li>
<p>Navigate to the <code dir="ltr"><span class="codeinlineitalic">Oracle_home</span></code><code dir="ltr">/oui/bin</code> directory on <code dir="ltr">node1</code> and run the <code dir="ltr">addNode.sh</code> script as the user that installed Oracle RAC using the following syntax:</p>
<pre dir="ltr">
$ ./addNode.sh "CLUSTER_NEW_NODES={node3}"
</pre></li>
<li>
<p>Run the <code dir="ltr"><span class="codeinlineitalic">Oracle_home</span></code><code dir="ltr">/root.sh</code> script on <code dir="ltr">node3</code> as <code dir="ltr">root</code>, where <code dir="ltr"><span class="codeinlineitalic">Oracle_home</span></code> is the Oracle RAC home.</p>
</li>
</ol>
<p><a id="sthref247"></a>If you have a shared Oracle home that is shared using Oracle Automatic Storage Management Cluster File System (Oracle ACFS), then do the following as the user that installed Oracle RAC to extend the Oracle database home to <code dir="ltr">node3</code>:</p>
<ol>
<li>
<p>Run the <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">/root.sh</code> script on <code dir="ltr">node3</code> as <code dir="ltr">root</code>, where <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code> is the Oracle Grid Infrastructure home.</p>
</li>
<li>
<p>Start the Oracle ACFS resource on the new node by running the following command as <code dir="ltr">root</code> from the <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">/bin</code> directory:</p>
<pre dir="ltr">
# srvctl start filesystem -d <span class="italic">volume_device_name</span> [-n <span class="italic">node_name</span>]
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
.Make sure the Oracle ACFS resources, including Oracle ACFS registry resource and Oracle ACFS file system resource where the ORACLE_HOME is located, are online on the newly added node.</div>
</li>
<li>
<p>Navigate to the <code dir="ltr"><span class="codeinlineitalic">Oracle_home</span></code><code dir="ltr">/oui/bin</code> directory on <code dir="ltr">node1</code> and run the <code dir="ltr">addNode.sh</code> script as the user that installed Oracle RAC using the following syntax:</p>
<pre dir="ltr">
$ ./addNode.sh -noCopy "CLUSTER_NEW_NODES={node3}"
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
Use the <code dir="ltr">-noCopy</code> option because the Oracle home on the destination node is already fully populated with software.</div>
</li>
</ol>
<p><a id="sthref248"></a>If you have a shared Oracle home on a shared file system that <span class="italic">is not</span> Oracle ACFS, then you must first create a mount point for the Oracle RAC database home on the target node, mount and attach the Oracle RAC database home, and update the Oracle Inventory, as follows:</p>
<ol>
<li>
<p>Run the <code dir="ltr">srvctl config db -d</code> <code dir="ltr"><span class="codeinlineitalic">db_name</span></code> command on an existing node in the cluster to obtain the mount point information.</p>
</li>
<li>
<p>Run the following command as <code dir="ltr">root</code> on <code dir="ltr">node3</code> to create the mount point:</p>
<pre dir="ltr">
# mkdir -p <span class="italic">mount_point_path</span>
</pre></li>
<li>
<p>Mount the file system that hosts the Oracle RAC database home.</p>
</li>
<li>
<p>Run the following command as the user that installed Oracle RAC from the <code dir="ltr"><span class="codeinlineitalic">Oracle_home</span></code><code dir="ltr">/oui/bin</code> directory on the node you are adding to add the Oracle RAC database home:</p>
<pre dir="ltr">
$ ./runInstaller -attachHome ORACLE_HOME="<span class="italic">ORACLE_HOME</span>" "CLUSTER
_NODES={<span class="italic">node_list</span>}" LOCAL_NODE="<span class="italic">node_name</span>"
</pre></li>
<li>
<p>Update the Oracle Inventory as the user that installed Oracle RAC, as follows:</p>
<pre dir="ltr">
$ ./runInstaller -updateNodeList ORACLE_HOME=<span class="italic">mount_point_path</span> "CLUSTER
_NODES={<span class="italic">node_list</span>}"
</pre>
<p>In the preceding command, <code dir="ltr"><span class="codeinlineitalic">node_list</span></code> refers to a list of all nodes where the Oracle RAC database home is installed, including the node you are adding.</p>
</li>
</ol>
</li>
<li>
<p>Run the <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">/root.sh</code> script on the <code dir="ltr">node3</code> as <code dir="ltr">root</code> and run the subsequent script, as instructed.</p>
</li>
<li>
<p>Run the following CVU command as the user that installed Oracle Clusterware to check cluster integrity. This command verifies that any number of specified nodes has been successfully added to the cluster at the network, shared storage, and clusterware levels:</p>
<pre dir="ltr">
$ cluvfy stage -post nodeadd -n node3 [-verbose]
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<code dir="ltr"><a href="cvu.htm#CJGBHBFD">"cluvfy stage [-pre | -post] nodeadd"</a></code> for more information about this CVU command</div>
</li>
</ol>
<p>Check whether either a policy-managed or administrator-managed Oracle RAC database is configured to run on <code dir="ltr">node3</code> (the newly added node). If you configured an administrator-managed Oracle RAC database, you may need to use DBCA to add an instance to the database to run on this newly added node.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink RACAD070" href="../../rac.112/e41960/adddelunix.htm#RACAD070"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for more information about using DBCA to add administrator-managed Oracle RAC database instances</p>
</li>
<li>
<p><a class="olink RACAD8316" href="../../rac.112/e41960/adddelunix.htm#RACAD8316"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span> to add an Oracle RAC database instance to the target node if you configured a policy-managed Oracle RAC database</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BEIFDCAF"></a>
<div id="CWADD90992" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Deleting a Cluster Node on Linux and UNIX Systems</h3>
<p><a id="sthref249"></a><a id="sthref250"></a>This section describes the procedure for deleting a node from a cluster.</p>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>You can remove the Oracle RAC database instance from the node before removing the node from the cluster but this step is not required. If you do not remove the instance, then the instance is still configured but never runs. Deleting a node from a cluster does not remove a node's configuration information from the cluster. The residual configuration information does not interfere with the operation of the cluster.</p>
<p><span class="bold">See Also:</span> <a class="olink RACAD7358" href="../../rac.112/e41960/adddelunix.htm#RACAD7358"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for more information about deleting an Oracle RAC database instance</p>
</li>
<li>
<p>If you run a dynamic Grid Plug and Play cluster using DHCP and GNS, then you need only perform step <a href="#BABDJCDG">3</a> (remove VIP resource), step <a href="#BABDCBGC">4</a> (delete node), and step <a href="#BABCJGEJ">7</a> (update inventory on remaining nodes).</p>
<p>Also, in a Grid Plug and Play cluster, if you have nodes that are unpinned, Oracle Clusterware forgets about those nodes after a time and there is no need for you to remove them.</p>
</li>
<li>
<p>If one creates node-specific configuration for a node (such as disabling a service on a specific node, or adding the node to the candidate list for a server pool) that node-specific configuration is not removed when the node is deleted from the cluster. Such node-specific configuration must be removed manually.</p>
</li>
<li>
<p>Voting disks are automatically backed up in OCR after any changes you make to the cluster.</p>
</li>
</ul>
</div>
<p>To delete a node from a cluster:</p>
<ol>
<li>
<p>Ensure that <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code> correctly specifies the full directory path for the Oracle Clusterware home on each node, where <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code> is the location of the installed Oracle Clusterware software.</p>
</li>
<li>
<p>Run the following command as either <code dir="ltr">root</code> or the user that installed Oracle Clusterware to determine whether the node you want to delete is active and whether it is pinned:</p>
<pre dir="ltr">
$ olsnodes -s -t
</pre>
<p>If the node is pinned, then run the <code dir="ltr">crsctl unpin css</code> command. Otherwise, proceed to the next step.</p>
</li>
<li id="BABDJCDG">
<p>Disable the Oracle Clusterware applications and daemons running on the node. Run the <code dir="ltr">rootcrs.pl</code> script as <code dir="ltr">root</code> from the <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">/crs/install</code> directory on the node to be deleted, as follows:</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Before you run this command, you must stop the <code dir="ltr">EMAGENT</code>, as follows:
<pre dir="ltr">
$ emctl stop dbconsole
</pre></div>
<pre dir="ltr">
# ./rootcrs.pl -deconfig -force
</pre>
<p>If you are deleting multiple nodes, then run the <code dir="ltr">rootcrs.pl</code> script on each node that you are deleting.</p>
<p>If you are deleting <span class="italic">all</span> nodes from a cluster, then append the <code dir="ltr">-lastnode</code> option to the preceding command to clear OCR and the voting disks, as follows:</p>
<pre dir="ltr">
# ./rootcrs.pl -deconfig -force -lastnode
</pre>
<div class="infobox-note">
<p class="notep1">Caution:</p>
Only use the <code dir="ltr">-lastnode</code> option if you are deleting all cluster nodes because that option causes the <code dir="ltr">rootcrs.pl</code> script to clear OCR and the voting disks of data.</div>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you do not use the <code dir="ltr">-force</code> option in the preceding command or the node you are deleting is not accessible for you to execute the preceding command, then the VIP resource remains running on the node. You must manually stop and remove the VIP resource using the following commands as <code dir="ltr">root</code> from any node that you are not deleting:
<pre dir="ltr">
# srvctl stop vip -i <span class="italic">vip_name</span> -f
# srvctl remove vip -i <span class="italic">vip_name</span> -f
</pre>
<p>Where <code dir="ltr"><span class="codeinlineitalic">vip_name</span></code> is the VIP for the node to be deleted. If you specify multiple VIP names, then separate the names with commas and surround the list in double quotation marks (<code dir="ltr">""</code>).</p>
</div>
</li>
<li id="BABDCBGC">
<p>From any node that you are <span class="italic">not deleting</span>, run the following command from the <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">/bin</code> directory as <code dir="ltr">root</code> to delete the node from the cluster:</p>
<pre dir="ltr">
# crsctl delete node -n <span class="italic">node_to_be_deleted</span>
</pre></li>
<li>
<p>On the node <span class="italic">you want to delete</span>, run the following command as the user that installed Oracle Clusterware from the <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">/oui/bin</code> directory where <code dir="ltr"><span class="codeinlineitalic">node_to_be_deleted</span></code> is the name of the node that you are deleting:</p>
<pre dir="ltr">
$ ./runInstaller -updateNodeList ORACLE_HOME=<span class="italic">Grid_home</span> "CLUSTER_NODES=
{<span class="italic">node_to_be_deleted</span>}" CRS=TRUE -silent -local
</pre>
<div class="infobox-note">
<p class="notep1">Caution:</p>
Before you proceed to the next step, check the <code dir="ltr">inventory.xml</code> to ensure that it has not been updated. If you perform this step and mistakenly update the <code dir="ltr">inventory.xml</code> file, or you fail to complete this step and move on to the next step, then the next step will deinstall the entire cluster.</div>
</li>
<li id="BABFHDGC">
<p>Depending on whether you have a shared or local Oracle home, complete one of the following procedures as the user that installed Oracle Clusterware:</p>
<ul>
<li>
<p>If you have a shared home, then run the following commands in the following order on the node you want to delete.</p>
<p>Run the following command to deconfigure Oracle Clusterware:</p>
<pre dir="ltr">
$ <span class="italic">Grid_home</span>/perl/bin/perl <span class="italic">Grid_home</span>/crs/install/rootcrs.pl -deconfig
</pre>
<p>Run the following command from the <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">/oui/bin</code> directory to detach the Grid home:</p>
<pre dir="ltr">
$ ./runInstaller -detachHome ORACLE_HOME=<span class="italic">Grid_home</span> -silent -local
</pre>
<p>Manually delete the following files:</p>
<pre dir="ltr">
/etc/oraInst.loc
/etc/oratab
/etc/oracle/
/opt/ORCLfmap/
$OraInventory/
</pre></li>
<li>
<p>For a local home, deinstall the Oracle Clusterware home from the node that you want to delete, as follows, by running the following command, where <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code> is the path defined for the Oracle Clusterware home:</p>
<pre dir="ltr">
$ <span class="italic">Grid_home</span>/deinstall/deinstall &ndash;local
</pre>
<div class="infobox-note">
<p class="notep1">Caution:</p>
If you do not specify the <code dir="ltr">-local</code> flag, then the command removes the Grid Infrastructure home from every node in the cluster.</div>
</li>
</ul>
</li>
<li id="BABCJGEJ">
<p>On any node other than the node you are deleting, run the following command from the <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">/oui/bin</code> directory where <code dir="ltr"><span class="codeinlineitalic">remaining_nodes_list</span></code> is a comma-delimited list of the nodes that are going to remain part of your cluster:</p>
<pre dir="ltr">
$ ./runInstaller -updateNodeList ORACLE_HOME=<span class="italic">Grid_home</span> "CLUSTER_NODES=
{<span class="italic">remaining_nodes_list</span>}" CRS=TRUE -silent
</pre>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>You must run this command a second time where <code dir="ltr">ORACLE_HOME=</code><code dir="ltr"><span class="codeinlineitalic">ORACLE_HOME</span></code>, and <code dir="ltr">CRS=TRUE -silent</code> is omitted from the syntax, as follows:</p>
<pre dir="ltr">
$ ./runInstaller -updateNodeList ORACLE_HOME=<span class="italic">ORACLE_HOME</span>
 "CLUSTER_NODES={<span class="italic">remaining_nodes_list</span>}"
</pre></li>
<li>
<p>If you have a shared Oracle Grid Infrastructure home, then append the <code dir="ltr">-cfs</code> option to the command example in this step and provide a complete path location for the cluster file system.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Run the following CVU command to verify that the specified nodes have been successfully deleted from the cluster:</p>
<pre dir="ltr">
$ cluvfy stage -post nodedel -n <span class="italic">node_list</span> [-verbose]
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<code dir="ltr"><a href="cvu.htm#CACFEIHC">"cluvfy stage -post nodedel"</a></code> for more information about this CVU command</div>
</li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDDHEFF"></a>
<div id="CWADD90995" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Adding and Deleting Cluster Nodes on Windows Systems</h2>
<p><a id="sthref251"></a>This section explains cluster node addition and deletion on Windows systems. This section includes the following topics:</p>
<ul>
<li>
<p><a href="#CHDGFJFH">Adding a Node to a Cluster on Windows Systems</a></p>
</li>
<li>
<p><a href="#CHDFGCCH">Deleting a Cluster Node on Windows Systems</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink GINST" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=GINST"><span class="italic">Oracle Grid Infrastructure Installation Guide</span></a> for more information about deleting an entire cluster</div>
<a id="CHDGFJFH"></a>
<div id="CWADD90996" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Adding a Node to a Cluster on Windows Systems</h3>
<p>Ensure that you complete the prerequisites listed in <a href="#CHDJFEEA">"Prerequisite Steps for Adding Cluster Nodes"</a> before adding nodes.</p>
<p>This procedure describes how to add a node to your cluster. This procedure assumes that:</p>
<ul>
<li>
<p>There is an existing cluster with two nodes named <code dir="ltr">node1</code> and <code dir="ltr">node2</code></p>
</li>
<li>
<p>You are adding a node named <code dir="ltr">node3</code></p>
</li>
<li>
<p>You have successfully installed Oracle Clusterware on <code dir="ltr">node1</code> and <code dir="ltr">node2</code> in a local home, where <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code> represents the successfully installed home</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Do not use the procedures described in this section to add cluster nodes in configurations where the Oracle database has been upgraded from Oracle Database 10<span class="italic">g</span> release 1 (10.1) on Windows systems.</div>
<p><a id="sthref252"></a><a id="sthref253"></a>To add a node:</p>
<ol>
<li>
<p>Verify the integrity of the cluster and <code dir="ltr">node3</code>:</p>
<pre dir="ltr">
C:\&gt;cluvfy stage -pre nodeadd -n node3 [-fixup [-fixupdir <span class="italic">fixup_dir</span>]] [-verbose]
</pre>
<p>You can specify the <code dir="ltr">-fixup</code> option and a directory into which CVU prints instructions to fix the cluster or node if the verification fails.</p>
</li>
<li>
<p>On <code dir="ltr">node1</code>, go to the <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">\oui\bin</code> directory and run the <code dir="ltr">addNode.bat</code> script, as follows:</p>
<pre dir="ltr">
C:\&gt;addNode.bat "CLUSTER_NEW_NODES={node3}"
"CLUSTER_NEW_VIRTUAL_HOSTNAMES={node3-vip}"
</pre>
<p>You can alternatively specify the entries shown in <a href="#BABFHIBG">Example 4-2</a> in a response file and run <code dir="ltr">addNode.bat</code> as follows:</p>
<pre dir="ltr">
C:\&gt;addNode.bat -responseFile <span class="italic">filename</span>
</pre>
<div id="CWADD91276" class="example">
<p class="titleinexample"><a id="BABFHIBG"></a>Example 4-2 Response File Entries for Adding a Node</p>
<pre dir="ltr">
CLUSTER_NEW_NODES={"node3"}
CLUSTER_NEW_VIRTUAL_HOSTNAMES={"node3-vip"}
</pre></div>
<!-- class="example" -->
<p>Command-line values always override response file values.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink OUICG" href="../../em.112/e12255/toc.htm"><span class="italic">Oracle Universal Installer and OPatch User's Guide</span></a> for details about how to configure command-line response files</div>
</li>
<li id="BABCHCBC">
<p>Run the following command on the new node:</p>
<pre dir="ltr">
C:\&gt;<span class="italic">Grid_home</span>\crs\config\gridconfig.bat
</pre></li>
<li id="BABIAABB">
<p>Run the following command to verify the integrity of the Oracle Clusterware components on all of the configured nodes, both the preexisting nodes and the nodes that you have added:</p>
<pre dir="ltr">
C:\&gt;cluvfy stage -post crsinst -n all [-verbose]
</pre></li>
</ol>
<p>After you complete the procedure in this section for adding nodes, you can optionally extend Oracle Database with Oracle Real Application Clusters (Oracle RAC) components to the new nodes, making them members of an existing Oracle RAC database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RACAD7348" href="../../rac.112/e41960/adddelunix.htm#RACAD7348"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for more information about extending Oracle Database with Oracle RAC to new nodes</div>
</div>
<!-- class="sect2" -->
<a id="CHDFGCCH"></a>
<div id="CWADD90997" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Deleting a Cluster Node on Windows Systems</h3>
<p>This section describes how to delete a cluster node on Windows systems. This procedure assumes that Oracle Clusterware is installed on <code dir="ltr">node1</code>, <code dir="ltr">node2</code>, and <code dir="ltr">node3</code>, and that you are deleting <code dir="ltr">node3</code> from the cluster.</p>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>Oracle does not support using Oracle Enterprise Manager to delete nodes on Windows systems.</p>
</li>
<li>
<p>Oracle recommends that you back up your voting disk and OCRs after you complete any node addition or deletion procedures.</p>
</li>
<li>
<p>You can remove the Oracle RAC database instance from the node before removing the node from the cluster but this step is not required. If you do not remove the instance, then the instance is still configured but never runs. Deleting a node from a cluster does not remove a node's configuration information from the cluster. The residual configuration information does not interfere with the operation of the cluster.</p>
<p><span class="bold">See Also:</span> <a class="olink RACAD8200" href="../../rac.112/e41960/adddelwin.htm#RACAD8200"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for more information about deleting an Oracle RAC database instance</p>
</li>
</ul>
</div>
<p>To delete a cluster node on Windows systems:</p>
<ol>
<li>
<p>Before you delete a node, you must disable the Oracle Clusterware applications and services running on the node.</p>
<p>On the node you want to delete, run the <code dir="ltr">rootcrs.pl -deconfig</code> script as a member of the Administrators groups, as follows:</p>
<pre dir="ltr">
C:\&gt;<span class="italic">Grid_home</span>\perl\bin\perl -I$<span class="italic">Grid_home</span>\perl\lib -I$<span class="italic">Grid_home</span>\crs\install
<span class="italic">Grid_home</span>\crs\install\rootcrs.pl -deconfig -force
</pre>
<p>If you are deleting multiple nodes, then run this script on each node that you are deleting.</p>
</li>
<li>
<p>On a node that you are not deleting, run the following command:</p>
<pre dir="ltr">
C:\&gt;<span class="italic">Grid_home</span>\bin\crsctl delete node -n <span class="italic">node_to_be_deleted</span>
</pre></li>
<li>
<p>Only if you have a local home, on the node you want to delete, run the following command with <code dir="ltr">-local</code> option to update the node list:</p>
<pre dir="ltr">
C:\&gt;<span class="italic">Grid_home</span>\oui\bin\setup.exe -updateNodeList ORACLE_HOME=<span class="italic">Grid_home</span> "CLUSTER_NODES=
{<span class="italic">node_to_be_deleted</span>}" CRS=TRUE -local
</pre></li>
<li>
<p>Run the deinstall tool located in the <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">\deinstall</code> directory to deinstall and deconfigure the Oracle Clusterware home, as follows:</p>
<pre dir="ltr">
C:\&gt;deinstall.bat
</pre></li>
<li>
<p>On any node that you are <span class="italic">not</span> deleting, run the following command from the <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">\oui\bin</code> directory where <code dir="ltr"><span class="codeinlineitalic">remaining_nodes_list</span></code> is a comma-delimited list of the nodes that are going to remain part of your cluster:</p>
<pre dir="ltr">
C:\&gt;setup.exe &ndash;updateNodeList ORACLE_HOME=<span class="italic">Grid_home</span>
"CLUSTER_NODES={<span class="italic">remaining_nodes_list</span>}" CRS=TRUE -silent
</pre>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>You must run this command a second time where <code dir="ltr">ORACLE_HOME=</code><code dir="ltr"><span class="codeinlineitalic">ORACLE_HOME</span></code>, and <code dir="ltr">CRS=TRUE -silent</code> is omitted from the syntax, as follows:</p>
<pre dir="ltr">
C:\&gt;setup.exe -updateNodeList ORACLE_HOME=<span class="italic">ORACLE_HOME</span>
 "CLUSTER_NODES={<span class="italic">remaining_nodes_list</span>}"
</pre></li>
<li>
<p>If you have a shared Oracle Grid Infrastructure home, then append the <code dir="ltr">-cfs</code> option to the command example in this step and provide a complete path location for the cluster file system.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Run the following CVU command to verify that the specified nodes have been successfully deleted from the cluster:</p>
<pre dir="ltr">
C:\&gt;cluvfy stage -post nodedel -n <span class="italic">node_list</span> [-verbose]
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<code dir="ltr"><a href="cvu.htm#CACFEIHC">"cluvfy stage -post nodedel"</a></code></div>
</li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment407">
<tr>
<td class="cellalignment416">
<table class="cellalignment412">
<tr>
<td class="cellalignment411"><a href="votocr.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment411"><a href="clonecluster.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2007, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment419">
<table class="cellalignment410">
<tr>
<td class="cellalignment411"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment411"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment411"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment411"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment411"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment411"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
