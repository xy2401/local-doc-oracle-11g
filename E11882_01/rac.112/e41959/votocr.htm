<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Managing Oracle Cluster Registry and Voting Disks</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1056" />
<meta name="dcterms.created" content="2015-06-03T16:55:36Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Clusterware Administration and Deployment Guide" />
<meta name="dcterms.identifier" content="E41959-04" />
<meta name="dcterms.isVersionOf" content="CWADD" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2007, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="admin.htm" title="Previous" type="text/html" />
<link rel="Next" href="adddelclusterware.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e41959.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">8/21</span> <!-- End Header -->
<div id="CWADD92368" class="chapter"><a id="BGBJEBDJ"></a>
<h1 class="chapter"><span class="secnum">3</span> Managing Oracle Cluster Registry and Voting Disks</h1>
<p>Oracle Clusterware includes two important components that manage configuration and node membership: Oracle Cluster Registry (OCR), which also includes the local component Oracle Local Registry (OLR), and voting disks.</p>
<ul>
<li>
<p>OCR manages Oracle Clusterware and Oracle RAC database configuration information</p>
</li>
<li>
<p>OLR resides on every node in the cluster and manages Oracle Clusterware configuration information for each particular node</p>
</li>
<li>
<p>Voting disks manage information about node membership. Each voting disk must be accessible by all nodes in the cluster for nodes to be members of the cluster</p>
</li>
</ul>
<p>You can store OCR and voting disks on Oracle Automatic Storage Management (Oracle ASM), or a certified cluster file system.</p>
<p>Oracle Universal Installer for Oracle Clusterware 11<span class="italic">g</span> release 2 (11.2), does not support the use of raw or block devices. However, if you upgrade from a previous Oracle Clusterware release, then you can continue to use raw or block devices. Oracle recommends that you use Oracle ASM to store OCR and voting disks.</p>
<p><a id="sthref160"></a><a id="sthref161"></a><a id="sthref162"></a>Oracle recommends that you configure multiple voting disks during Oracle Clusterware installation to improve availability. If you choose to put the voting disks into an Oracle ASM disk group, then Oracle ASM ensures the configuration of multiple voting disks if you use a normal or high redundancy disk group. If you choose to store the voting disks on a cluster file system, then select the option to configure multiple voting disks, in which case you will have to specify three different file systems based on different disks.</p>
<p>If necessary, you can dynamically add or replace voting disks after you complete the Oracle Clusterware installation process without stopping the cluster.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you use CRSCTL to add a new voting disk to a raw device after installation, then the file permissions of the new voting disk on remote nodes may be incorrect. On each remote node, check to ensure that the file permissions for the voting disk are correct (owned by the Grid Infrastructure installation owner and by members of the OINSTALL group). If the permissions are incorrect, then change them manually.
<p>For example:</p>
<pre dir="ltr">
grid@myserver&gt;$ ls -l /dev/rhdisk18
crwxrwxrwx  1 root  oinstall  36, 02 Feb 10 20:28 /dev/rhdisk18
$ su root
root@myserver&gt; # chown grid:oinstall /dev/rhdisk18
# exit
$ ls -l /dev/rhdisk18
crwxrwxrwx  1001 grid  oinstall  36, 19 Sep 09 20:29 /dev/rhdisk18
</pre></div>
<p>This chapter includes the following topics:</p>
<ul>
<li>
<p><a href="#BABIHADG">Managing Oracle Cluster Registry and Oracle Local Registry</a></p>
</li>
<li>
<p><a href="#i1011043">Managing Voting Disks</a></p>
</li>
</ul>
<a id="BABIHADG"></a>
<div id="CWADD70700" class="sect1">
<h2 class="sect1">Managing Oracle Cluster Registry and Oracle Local Registry</h2>
<p>This section describes how to manage OCR and the Oracle Local Registry (OLR) with the following utilities: OCRCONFIG, OCRDUMP, and OCRCHECK.</p>
<p>OCR contains information <a id="sthref163"></a>about all Oracle resources in the cluster.</p>
<p>OLR is a registry similar to OCR located on each node in a cluster, but contains information specific to each node. It contains manageability information about Oracle Clusterware, including dependencies between various services. Oracle High Availability Services uses this information. OLR is located on local storage on each node in a cluster. Its default location is in the path <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">/cdata/</code><code dir="ltr"><span class="codeinlineitalic">host_name</span></code><code dir="ltr">.olr</code>, where <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code> is the Oracle Grid Infrastructure home, and <code dir="ltr"><span class="codeinlineitalic">host_name</span></code> is the host name of the node.</p>
<p>This section describes how to administer OCR<a id="sthref164"></a> in the following topics:</p>
<ul>
<li>
<p><a href="#CHDJIIJH">Migrating Oracle Cluster Registry to Oracle Automatic Storage Management</a></p>
</li>
<li>
<p><a href="#BABEGAAH">Adding, Replacing, Repairing, and Removing Oracle Cluster Registry Locations</a></p>
</li>
<li>
<p><a href="#i1012456">Backing Up Oracle Cluster Registry</a></p>
</li>
<li>
<p><a href="#CHDIICJB">Restoring Oracle Cluster Registry</a></p>
</li>
<li>
<p><a href="#BGBFEEGA">Diagnosing Oracle Cluster Registry Problems</a></p>
</li>
<li>
<p><a href="#i1012107">Administering Oracle Cluster Registry with Oracle Cluster Registry Export and Import Commands</a></p>
</li>
<li>
<p><a href="#CHDFDGGB">Oracle Local Registry</a></p>
</li>
<li>
<p><a href="#BABDAIDI">Upgrading and Downgrading the Oracle Cluster Registry Configuration</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="ocrsyntax.htm#BABEGBEJ">"About OCRCONFIG"</a> for information about the OCRCONFIG utility, and <a href="ocrsyntax.htm#BABDGBGH">"Troubleshooting Oracle Cluster Registry"</a> for information about the OCRDUMP and OCRCHECK utilities</div>
<a id="CHDJIIJH"></a>
<div id="CWADD91099" class="sect2">
<h3 class="sect2">Migrating Oracle Cluster Registry to Oracle Automatic Storage Management</h3>
<p>To improve Oracle Clusterware storage manageability, OCR is configured, by default, to use Oracle ASM in Oracle Database 11<span class="italic">g</span> release 2 (11.2). With the Oracle Clusterware storage residing in an Oracle ASM disk group, you can manage both database and clusterware storage using Oracle Enterprise Manager.</p>
<p>However, if you upgrade from a previous version of Oracle Clusterware, you can migrate OCR to reside on Oracle ASM, and take advantage of the improvements in managing Oracle Clusterware storage.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you upgrade from a previous version of Oracle Clusterware to 11<span class="italic">g</span> release 2 (11.2) and you want to store OCR in an Oracle ASM disk group, then you must set the <span class="bold">ASM Compatibility</span> compatibility attribute to <code dir="ltr">11.2.0.0</code>.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink OSTMG02700" href="../../server.112/e18951/asmdiskgrps.htm#OSTMG02700"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for information about setting Oracle ASM compatibility attributes</div>
<p class="subhead2"><a id="CWADD92111"></a>To migrate <a id="sthref165"></a><a id="sthref166"></a><a id="sthref167"></a><a id="sthref168"></a>OCR to Oracle ASM using OCRCONFIG:</p>
<ol>
<li>
<p>Ensure the upgrade to Oracle Clusterware 11<span class="italic">g</span> release 2 (11.2) is complete. Run the following command to verify the current running version:</p>
<pre dir="ltr">
$ crsctl query crs activeversion
</pre></li>
<li>
<p>Use the Oracle ASM Configuration Assistant (ASMCA) to configure and start Oracle ASM on all nodes in the cluster.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink OSTMG50000" href="../../server.112/e18951/asmca.htm#OSTMG50000"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for more information about using ASMCA</div>
</li>
<li>
<p>Use ASMCA to create an Oracle ASM disk group that is at least the same size of the existing OCR and has at least normal redundancy.</p>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>If OCR is stored in an Oracle ASM disk group with external redundancy, then Oracle recommends that you add another OCR location to another disk group to avoid the loss of OCR, if a disk fails in the disk group.</p>
<p>Oracle does not support storing OCR on different storage types simultaneously, such as storing OCR on both Oracle ASM and a shared file system, except during a migration.</p>
</li>
<li>
<p>If an Oracle ASM instance fails on any node, then OCR becomes unavailable on that particular node.</p>
<p>If the <code dir="ltr">crsd</code> process running on the node affected by the Oracle ASM instance failure is the <a href="glossary.htm#CBADIHDI"><span class="xrefglossterm">OCR writer</span></a>, the majority of the OCR locations are stored in Oracle ASM, and you attempt I/O on OCR during the time the Oracle ASM instance is down on this node, then <code dir="ltr">crsd</code> stops and becomes inoperable. Cluster management is now affected on this particular node.</p>
<p>Under no circumstances will the failure of one Oracle ASM instance on one node affect the whole cluster.</p>
</li>
<li>
<p>Ensure that Oracle ASM disk groups that you create are mounted on all of the nodes in the cluster.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink GINST" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=GINST"><span class="italic">Oracle Grid Infrastructure Installation Guide</span></a> for more detailed sizing information</div>
</li>
<li>
<p>To add OCR to an Oracle ASM disk group, ensure that the <a href="glossary.htm#CBAIJHDB"><span class="xrefglossterm">Oracle Clusterware stack</span></a> is running and run the following command as <code dir="ltr">root</code>:</p>
<pre dir="ltr">
# ocrconfig -add +<span class="italic">new_disk_group</span>
</pre>
<p>You can run this command more than once if you add multiple OCR locations. You can have up to five OCR locations. However, each successive run must point to a different disk group.</p>
</li>
<li>
<p>To remove storage configurations no longer in use, run the following command as <code dir="ltr">root</code>:</p>
<pre dir="ltr">
# ocrconfig -delete <span class="italic">old_storage_location</span>
</pre>
<p>Run this command for every configured OCR.</p>
</li>
</ol>
<p>The following example shows how to migrate two OCRs to Oracle ASM using OCRCONFIG.</p>
<pre dir="ltr">
# ocrconfig -add +<span class="italic">new_disk_group</span>
# ocrconfig -delete /dev/raw/raw2
# ocrconfig -delete /dev/raw/raw1
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
OCR inherits the redundancy of the disk group. If you want high redundancy for OCR, you must configure the disk group with high redundancy when you create it.</div>
<div id="CWADD91101" class="sect3"><a id="sthref169"></a>
<h4 class="sect3">Migrating Oracle Cluster Registry from Oracle ASM to Other Types of Storage</h4>
<p>To <a id="sthref170"></a><a id="sthref171"></a><a id="sthref172"></a>migrate OCR from Oracle ASM to another storage type:</p>
<ol>
<li>
<p>Ensure the upgrade to Oracle Clusterware 11<span class="italic">g</span> release 2 (11.2) is complete. Run the following command to verify the current running version:</p>
<pre dir="ltr">
$ crsctl query crs activeversion
</pre></li>
<li>
<p>Create a file in a shared or cluster file system with the following permissions: <code dir="ltr">root</code>, <code dir="ltr">oinstall</code>, <code dir="ltr">640</code>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Create at least two mirrors of the primary storage location to eliminate a single point of failure for OCR. OCR supports up to five locations.</div>
</li>
<li>
<p>Ensure there is at least 280 MB of space on the mount partition.</p>
</li>
<li>
<p>Ensure that the file you created is visible from all nodes in the cluster.</p>
</li>
<li>
<p>To add the file as an OCR location, ensure that the Oracle Clusterware stack is running and run the following command as <code dir="ltr">root</code>:</p>
<pre dir="ltr">
# ocrconfig -add <span class="italic">file_location</span>
</pre>
<p>You can run this command more than once if you add more than one OCR location. Each successive run of this command must point to a different file location.</p>
</li>
<li>
<p>To remove storage configurations no longer in use, run the following command as <code dir="ltr">root</code>:</p>
<pre dir="ltr">
# ocrconfig -delete +<span class="italic">asm_disk_group</span>
</pre>
<p>You can run this command more than once if there is more than one OCR location configured.</p>
</li>
</ol>
<p>The following example shows how to migrate OCR from Oracle ASM to block devices using OCRCONFIG. For OCRs not stored on Oracle ASM, Oracle recommends that you mirror OCR on different devices.</p>
<pre dir="ltr">
# ocrconfig -add /dev/sdd1
# ocrconfig -add /dev/sde1
# ocrconfig -add /dev/sdf1
# ocrconfig -delete +<span class="italic">unused_disk_group</span>
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BABEGAAH"></a>
<div id="CWADD90964" class="sect2">
<h3 class="sect2">Adding, Replacing, Repairing, and Removing Oracle Cluster Registry Locations</h3>
<p><a id="sthref173"></a><a id="sthref174"></a><a id="sthref175"></a><a id="sthref176"></a>The Oracle installation process for Oracle Clusterware gives you the option of automatically mirroring <a id="sthref177"></a>OCR. You can manually put the mirrored OCRs on a shared network file system (NFS), or on any cluster file system that is certified by Oracle. Alternatively, you can place OCR on Oracle ASM and allow it to create mirrors automatically, depending on the redundancy option you select.</p>
<p>This section includes the following topics:</p>
<ul>
<li>
<p><a href="#BABBDAHA">Adding an Oracle Cluster Registry Location</a></p>
</li>
<li>
<p><a href="#BABJFBEC">Removing an Oracle Cluster Registry Location</a></p>
</li>
<li>
<p><a href="#BABEIEJI">Replacing an Oracle Cluster Registry Location</a></p>
</li>
<li>
<p><a href="#CHDJJDEF">Repairing an Oracle Cluster Registry Configuration on a Local Node</a></p>
</li>
<li>
<p><a href="#BABCADFE">Overriding the Oracle Cluster Registry Data Loss Protection Mechanism</a></p>
</li>
</ul>
<p>You can manually mirror OCR, as described in the <a href="#BABBDAHA">"Adding an Oracle Cluster Registry Location"</a> section, if you:</p>
<ul>
<li>
<p>Upgraded to Oracle Clusterware 11<span class="italic">g</span> release 2 (11.2) but did not choose to mirror OCR during the upgrade</p>
</li>
<li>
<p>Created only one OCR location during the Oracle Clusterware installation</p>
</li>
</ul>
<p>Oracle recommends that you configure:</p>
<ul>
<li>
<p>At least three OCR locations, if OCR is configured on non-mirrored or non-redundant storage. Oracle strongly recommends that you mirror OCR if the underlying storage is not RAID. Mirroring can help prevent OCR from becoming a single point of failure.</p>
</li>
<li>
<p>At least two OCR locations if OCR is configured on an Oracle ASM disk group. You should configure OCR in two independent disk groups. Typically this is the work area and the recovery area.</p>
</li>
<li>
<p>At least two OCR locations if OCR is configured on mirrored hardware or third-party mirrored volumes.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>If the original OCR location does not exist, then you must create an empty (0 byte) OCR location with appropriate permissions before you run the <code dir="ltr">ocrconfig -add</code> or <code dir="ltr">ocrconfig -replace</code> commands.</p>
</li>
<li>
<p>Ensure that the OCR devices that you specify in the OCR configuration exist and that these OCR devices are valid.</p>
</li>
<li>
<p>Ensure that the Oracle ASM disk group that you specify exists and is mounted.</p>
</li>
<li>
<p>The new OCR file, device, or disk group must be accessible from all of the active nodes in the cluster.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink GINST" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=GINST"><span class="italic">Oracle Grid Infrastructure Installation Guide</span></a> for information about creating OCRs</p>
</li>
<li>
<p><a class="olink OSTMG137" href="../../server.112/e18951/asmdiskgrps.htm#OSTMG137"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for more information about Oracle ASM disk group management</p>
</li>
</ul>
</div>
<p>In addition to mirroring OCR locations, you can also:</p>
<ul>
<li>
<p>Replace an OCR location if there is a misconfiguration or other type of OCR error, as described in the <a href="#BABEIEJI">"Replacing an Oracle Cluster Registry Location"</a> section.</p>
</li>
<li>
<p>Repair an OCR location if Oracle Database displays an OCR failure alert in Oracle Enterprise Manager or in the Oracle Clusterware alert log file, as described in the <a href="#CHDJJDEF">"Repairing an Oracle Cluster Registry Configuration on a Local Node"</a> section.</p>
</li>
<li>
<p>Remove an OCR location if, for example, your system experiences a performance degradation due to OCR processing or if you transfer your OCR to RAID storage devices and choose to no longer use multiple OCR locations, as described in the <a href="#BABJFBEC">"Removing an Oracle Cluster Registry Location"</a> section.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
The operations in this section affect OCR clusterwide: they change the OCR configuration information in the <a id="sthref178"></a><a id="sthref179"></a><code dir="ltr">ocr.loc</code> file on Linux and UNIX systems and the Registry keys on Windows systems. However, the <code dir="ltr">ocrconfig</code> command cannot modify OCR configuration information for nodes that are shut down or for nodes on which Oracle Clusterware is not running.</div>
<a id="BABBDAHA"></a>
<div id="CWADD90965" class="sect3">
<h4 class="sect3">Adding an Oracle Cluster Registry Location</h4>
<p><a id="sthref180"></a>Use the procedure in this section to add an OCR location. Oracle Clusterware can manage up to five redundant OCR locations.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If OCR resides on a cluster file system file or a network file system, create an empty (0 byte) OCR location file before performing the procedures in this section.</div>
<p>As the <code dir="ltr">root</code> user, run the following command to add an OCR location to either Oracle ASM or other storage device:</p>
<pre dir="ltr">
# ocrconfig -add +<span class="italic">asm_disk_group</span> | <span class="italic">file_name</span>
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
On Linux and UNIX systems, you must be <code dir="ltr">root</code> to run <code dir="ltr">ocrconfig</code> commands. On Windows systems, the user must be a member of the Administrator's group.</div>
</div>
<!-- class="sect3" -->
<a id="BABJFBEC"></a>
<div id="CWADD90968" class="sect3">
<h4 class="sect3">Removing an Oracle Cluster Registry Location</h4>
<p>To remove an OCR location or a failed OCR location, at least one other OCR must be online. <a id="sthref181"></a>You can remove an OCR location to reduce OCR-related overhead or to stop mirroring your OCR because you moved OCR to redundant storage such as RAID.</p>
<p>Perform the following procedure as the <code dir="ltr">root</code> user to remove an OCR location from your Oracle Clusterware environment:</p>
<ol>
<li>
<p>Ensure that <span class="italic">at least one</span> OCR location other than the OCR location that you are removing is online.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
Do <span class="italic">not</span> perform this OCR removal procedure unless there is at least one other active OCR location online.</div>
</li>
<li>
<p>Run the following command on any node in the cluster to remove an OCR location from either Oracle ASM or other location:</p>
<pre dir="ltr">
# ocrconfig -delete +<span class="italic">ASM_disk_group</span> | <span class="italic">file_name</span>
</pre>
<p>The <code dir="ltr"><span class="codeinlineitalic">file_name</span></code> variable can be a device name or a file name. This command updates the OCR configuration on all of the nodes on which Oracle Clusterware is running.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="BABEIEJI"></a>
<div id="CWADD90966" class="sect3">
<h4 class="sect3">Replacing an Oracle Cluster Registry Location<a id="sthref182"></a></h4>
<p>If you must change an existing OCR location, or change a failed OCR location to a working location, then you can use the following procedure, as long as all remaining OCR locations remain online. The <code dir="ltr">ocrconfig -replace</code> command requires that at least two OCR locations are configured.</p>
<p><a id="CWADD91264"></a><span class="bold">To change an Oracle Cluster Registry location:</span></p>
<p>Complete the following procedure:</p>
<ol>
<li>
<p>Use the OCRCHECK utility to verify that a copy of OCR other than the one you are going to replace is <span class="italic">online</span>, using the following command:</p>
<pre dir="ltr">
$ ocrcheck
</pre>
<p>OCRCHECK displays all OCR locations that are registered and whether they are available (online). If an OCR location suddenly becomes unavailable, then it might take a short period for Oracle Clusterware to show the change in status.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The OCR location that you are <span class="italic">replacing</span> can be either online or offline.</div>
</li>
<li>
<p><a id="sthref183"></a>Use the following command to verify that Oracle Clusterware is running on the node on which the you are going to perform the replace operation:</p>
<pre dir="ltr">
$ crsctl check crs
</pre></li>
<li>
<p>Run the following command as <code dir="ltr">root</code> to replace the current OCR location using either <code dir="ltr"><span class="codeinlineitalic">destination_file</span></code> or <code dir="ltr">+</code><code dir="ltr"><span class="codeinlineitalic">ASM_disk_group</span></code> to indicate the current and target OCR locations:</p>
<pre dir="ltr">
# ocrconfig -replace <span class="italic">current_OCR_location</span> -replacement <span class="italic">new_OCR_location</span>
</pre>
<p>The preceding command fails if you have less than two configured OCR locations that are online.</p>
<p>If you have only one OCR location configured and online, then you must first add a new location and then delete the failed location, as follows:</p>
<pre dir="ltr">
# ocrconfig -add <span class="italic">new_OCR_location</span>
# ocrconfig -delete <span class="italic">current_OCR_location</span>
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If your cluster configuration changes while the node on which OCR resides is stopped, and the Oracle Clusterware stack is running on the other nodes, then OCR detects configuration changes and self-corrects the configuration by changing the contents of the <code dir="ltr">ocr.loc</code> file.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink OSTMG12000" href="../../server.112/e18951/asm_rman.htm#OSTMG12000"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for more information about migrating storage</div>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDJJDEF"></a>
<div id="CWADD90967" class="sect3">
<h4 class="sect3">Repairing an Oracle Cluster Registry Configuration on a Local Node</h4>
<p><a id="sthref184"></a>It may be necessary to repair OCR if your cluster configuration changes while that node is stopped and this node is the only member in the cluster. Repairing an OCR involves either adding, deleting, or replacing an OCR location. For example, if any node that is part of your current Oracle RAC cluster is shut down, then you must update the OCR configuration on the stopped node to let that node rejoin the cluster after the node is restarted. Use the following command syntax as <code dir="ltr">root</code> on the restarted node where you use either a <code dir="ltr"><span class="codeinlineitalic">destination_file</span></code> or <code dir="ltr">+</code><code dir="ltr"><span class="codeinlineitalic">ASM_disk_group</span></code> to indicate the current and target OCR locations:</p>
<pre dir="ltr">
ocrconfig -repair -replace <span class="italic">current_OCR_location</span> -replacement <span class="italic">target_OCR_location</span>
</pre>
<p>This operation only changes OCR on the node on which you run this command. For example, if the OCR location is <code dir="ltr">/dev/sde1</code>, then use the command syntax <code dir="ltr">ocrconfig -repair -add /dev/sde1</code> on this node to repair OCR on that node.</p>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>You cannot repair the OCR configuration on a node on which the Oracle Cluster Ready Services daemon is running.</p>
</li>
<li>
<p>When you repair OCR on a stopped node using <code dir="ltr">ocrconfig -repair</code>, you must provide the same OCR file name (which should be case-sensitive) as the OCR file names on other nodes.</p>
</li>
<li>
<p>If you run the <code dir="ltr">ocrconfig -add | -repair | -replace</code> command, then the device, file, or Oracle ASM disk group that you are adding must be accessible. This means that a device must exist. You must create an empty (0 byte) OCR location, or the Oracle ASM disk group must exist and be mounted.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="ocrsyntax.htm#BABFHCGA">"OCRCONFIG Command Reference"</a> for more information about OCRCONFIG commands</p>
</li>
<li>
<p><a class="olink OSTMG137" href="../../server.112/e18951/asmdiskgrps.htm#OSTMG137"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for more information about Oracle ASM disk group management</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="BABCADFE"></a>
<div id="CWADD90969" class="sect3">
<h4 class="sect3">Overriding the Oracle Cluster Registry Data Loss Protection Mechanism</h4>
<p>OCR<a id="sthref185"></a> has a mechanism that prevents data loss due to accidental overwrites. If you configure a mirrored OCR and if Oracle Clusterware cannot access the mirrored OCR locations and also cannot verify that the available OCR location contains the most recent configuration, then Oracle Clusterware prevents further modification to the available OCR location. In addition, the process prevents overwriting by prohibiting Oracle Clusterware from starting on the node on which only one OCR is available. In such cases, Oracle Database displays an alert message in either Oracle Enterprise Manager, the Oracle Clusterware alert log files, or both. If this problem is local to only one node, you can use other nodes to start your cluster database.</p>
<p>However, if you are unable to start any cluster node in your environment and if you can neither repair OCR nor restore access to all OCR locations, then you can override the protection mechanism. The procedure described in the following list enables you to start the cluster using the available OCR location. However, overriding the protection mechanism can result in the loss of data that was not available when the previous known good state was created.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
Overriding OCR using the following procedure can result in the loss of OCR updates that were made between the time of the last known good OCR update made to the currently accessible OCR and the time at which you performed the overwrite. In other words, running the <code dir="ltr">ocrconfig -overwrite</code> command can result in data loss if the OCR location that you are using to perform the overwrite does not contain the latest configuration updates for your cluster environment.</div>
<p>Perform the following procedure to overwrite OCR if a node cannot start <span class="italic">and</span> if the alert log contains <a id="sthref186"></a>CLSD-1009 and<a id="sthref187"></a> CLSD-1011 messages.</p>
<ol>
<li>
<p>Attempt to resolve the cause of the CLSD-1009 and CLSD-1011 messages.</p>
<p>Compare the node's OCR configuration (<code dir="ltr">ocr.loc</code> on Linux and UNIX systems and the Registry on Windows systems) with other nodes on which Oracle Clusterware is running.</p>
<ul>
<li>
<p>If the configurations do not match, run <code dir="ltr">ocrconfig -repair</code>.</p>
</li>
<li>
<p>If the configurations match, ensure that the node can access all of the configured OCRs by running an <code dir="ltr">ls</code> command on Linux and UNIX systems. On Windows, use a <code dir="ltr">dir</code> command if the OCR location is a file and run <code dir="ltr">GuiOracleObjectManager.exe</code> to verify that the part of the cluster with the name exists.</p>
</li>
</ul>
</li>
<li>
<p>Ensure that the most recent OCR contains the latest OCR updates.</p>
<p>Look at output from the <code dir="ltr">ocrdump</code> command and determine whether it has your latest updates.</p>
</li>
<li>
<p>If you cannot resolve the problem that caused the CLSD message, then run the command <code dir="ltr">ocrconfig -overwrite</code> to start the node.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1012456"></a>
<div id="CWADD90970" class="sect2">
<h3 class="sect2">Backing Up Oracle Cluster Registry</h3>
<p>This section describes <a id="sthref188"></a>how to back up OCR content and use it for recovery. The first method uses automatically generated OCR copies and the second method enables you to issue a backup command manually:</p>
<ul>
<li>
<p><span class="bold">Automatic backups</span>: <a id="sthref189"></a>Oracle Clusterware automatically creates OCR backups every four hours. At any one time, Oracle Database always retains the last three backup copies of OCR. The CRSD process that creates the backups also creates and retains an OCR backup for each <span class="italic">full day</span> and <span class="italic">at the end of each week</span>. You cannot customize the backup frequencies or the number of files that Oracle Database retains.</p>
</li>
<li>
<p><span class="bold">Manual backups</span>: Run <a id="sthref190"></a>the <code dir="ltr">ocrconfig -manualbackup</code> command on a node where the Oracle Clusterware stack is up and running to force Oracle Clusterware to perform a backup of OCR at any time, rather than wait for the automatic backup. You must run the command as a user with administrative privileges. The <code dir="ltr">-manualbackup</code> option is especially useful when you want to obtain a binary backup on demand, such as before you make changes to OCR. The OLR only supports manual backups.</p>
</li>
</ul>
<p>When the clusterware stack is down on all nodes in the cluster, the backups that are listed by the <code dir="ltr">ocrconfig -showbackup</code> command may differ from node to node.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
After you install or upgrade Oracle Clusterware on a node, or add a node to the cluster, when the <code dir="ltr">root.sh</code> script finishes, it backs up OLR.</div>
<p class="subhead2"><a id="CHDDEGFB"></a><a id="CWADD92001"></a>Listing Backup Files</p>
<p>Run the following command to list the backup files:</p>
<pre dir="ltr">
ocrconfig -showbackup
</pre>
<p>The <code dir="ltr">ocrconfig -showbackup</code> command displays the backup location, timestamp, and the originating node name of the backup files that Oracle Clusterware creates. By default, the <code dir="ltr">-showbackup</code> option displays information for both automatic and manual backups but you can include the <code dir="ltr">auto</code> or <code dir="ltr">manual</code> flag to display only the automatic backup information or only the manual backup information, respectively.</p>
<p>Run the following command to inspect the contents and verify the integrity of the backup file:</p>
<pre dir="ltr">
ocrdump -backupfile <span class="italic">backup_file_name</span>
</pre>
<p>You can use any backup software to copy the automatically generated backup files at least once daily to a different device from where the primary OCR resides.</p>
<p>The default location for generating backups on Linux or UNIX systems is <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">/cdata/</code><code dir="ltr"><span class="codeinlineitalic">cluster_name</span></code>, where <code dir="ltr"><span class="codeinlineitalic">cluster_name</span></code> is the name of your cluster. The Windows default location for generating backups uses the same path structure. Because the default backup is on a local file system, Oracle recommends that you include the backup file created with the OCRCONFIG utility as part of your operating system backup using standard operating system or third-party tools.</p>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
You can use the <code dir="ltr">ocrconfig -backuploc</code> option to change the location where OCR creates backups. <a href="ocrsyntax.htm#BABGGCCA">Appendix G, "Oracle Cluster Registry Utility Reference"</a> describes the OCRCONFIG utility options.</div>
<div class="infobox-note">
<p class="notep1">Note:</p>
On Linux and UNIX systems, you must be <code dir="ltr">root</code> user to run most but not all of the <code dir="ltr">ocrconfig</code> command options. On Windows systems, the user must be a member of the Administrator's group.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#i1012107">"Administering Oracle Cluster Registry with Oracle Cluster Registry Export and Import Commands"</a> to use manually created OCR export files to copy OCR content and use it for recovery</p>
</li>
<li>
<p><a href="ocrsyntax.htm#BABFHCGA">"OCRCONFIG Command Reference"</a> for more information about OCRCONFIG commands</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CHDIICJB"></a>
<div id="CWADD92002" class="sect2">
<h3 class="sect2">Restoring Oracle Cluster Registry</h3>
<p><a id="sthref191"></a><a id="sthref192"></a>If a resource fails, then before attempting to restore OCR, restart the resource. As a definitive verification that OCR failed, run <code dir="ltr">ocrcheck</code> and if the command returns a failure message, then both the primary OCR and the OCR mirror have failed. Attempt to correct the problem using the OCR restoration procedure for your platform.</p>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>You <span class="italic">cannot</span> restore your configuration from an OCR backup file using the <code dir="ltr">-import</code> option, which is explained in <a href="#i1012107">"Administering Oracle Cluster Registry with Oracle Cluster Registry Export and Import Commands"</a>. You <span class="italic">must instead</span> use the <code dir="ltr">-restore</code> option, as described in the following sections.</p>
</li>
<li>
<p>If you store OCR on an Oracle ASM disk group and the disk group is not available, then you must recover and mount the Oracle ASM disk group.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink OSTMG137" href="../../server.112/e18951/asmdiskgrps.htm#OSTMG137"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for more information about managing Oracle ASM disk groups</div>
<ul>
<li>
<p><a href="#CHDHBBIJ">Restoring the Oracle Cluster Registry on Linux or UNIX Systems</a></p>
</li>
<li>
<p><a href="#CHDCABFC">Restoring the Oracle Cluster Registry on Windows Systems</a></p>
</li>
<li>
<p><a href="#BGBBAHDG">Restoring the Oracle Cluster Registry in an Oracle Restart Environment</a></p>
</li>
</ul>
<p class="subhead2"><a id="CHDHBBIJ"></a><a id="CWADD92003"></a>Restoring the Oracle Cluster Registry on Linux or UNIX Systems</p>
<p>If you are storing OCR on an Oracle ASM disk group, and that disk group is corrupt, then you must restore the Oracle ASM disk group using Oracle ASM utilities, and then mount the disk group again before recovering OCR. Recover OCR by running the <code dir="ltr">ocrconfig -restore</code> command, as instructed in the following procedure.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink OSTMG" href="../../server.112/e18951/toc.htm"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for information about how to restore Oracle ASM disk groups</div>
<div class="infobox-note">
<p class="notep1">Note:</p>
If the original OCR location does not exist, then you must create an empty (0 byte) OCR location with the same name as the original OCR location before you run the <code dir="ltr">ocrconfig -restore</code> command.</div>
<p>Use the following procedure to restore OCR on <a id="sthref193"></a>Linux or UNIX systems:</p>
<ol>
<li>
<p>List the nodes in your cluster by running the following command on one node:</p>
<pre dir="ltr">
$ olsnodes
</pre></li>
<li>
<p>Stop Oracle Clusterware by running the following command as <code dir="ltr">root</code> on all of the nodes:</p>
<pre dir="ltr">
# crsctl stop crs
</pre>
<p>If the preceding command returns any error due to OCR corruption, stop Oracle Clusterware by running the following command as <code dir="ltr">root</code> on all of the nodes:</p>
<pre dir="ltr">
# crsctl stop crs -f
</pre></li>
<li>
<p>If you are restoring OCR to a cluster file system or network file system, then run the following command as <code dir="ltr">root</code> to restore OCR with an OCR backup that you can identify in <a href="#CHDDEGFB">"Listing Backup Files"</a>:</p>
<pre dir="ltr">
# ocrconfig -restore <span class="italic">file_name</span>
</pre>
<p>After you complete this step, proceed to step <a href="#CHDCIGEE">10</a>.</p>
</li>
<li>
<p>Start the Oracle Clusterware stack on one node in exclusive mode by running the following command as <code dir="ltr">root</code>:</p>
<pre dir="ltr">
# crsctl start crs -excl -nocrs
</pre>
<p>The <code dir="ltr">-nocrs</code> option ensures that the <code dir="ltr">crsd</code> process and OCR do not start with the rest of the Oracle Clusterware stack.</p>
<p>Ignore any errors that display.</p>
<p>Check whether <code dir="ltr">crsd</code> is running. If it is, then stop it by running the following command as <code dir="ltr">root</code>:</p>
<pre dir="ltr">
# crsctl stop resource ora.crsd -init
</pre>
<div class="infobox-note">
<p class="notep1">Caution:</p>
<span class="italic">Do not</span> use the <code dir="ltr">-init</code> flag with any other command.</div>
</li>
<li>
<p>If you want to restore OCR to an Oracle ASM disk group, then you must first create a disk group using SQL*Plus that has the same name as the disk group you want to restore and mount it on the local node.</p>
<p>If you cannot mount the disk group locally, then run the following SQL*Plus command:</p>
<pre dir="ltr">
SQL&gt; drop diskgroup <span class="italic">disk_group_name</span> force including contents;
</pre>
<p>Optionally, if you want to restore OCR to a raw device, then you must run the <code dir="ltr">ocrconfig -repair -replace</code> command as <code dir="ltr">root</code>, assuming that you have all the necessary permissions on all nodes to do so <span class="italic">and</span> that OCR was not previously on Oracle ASM.</p>
</li>
<li>
<p>Restore OCR with an OCR backup that you can identify in <a href="#CHDDEGFB">"Listing Backup Files"</a> by running the following command as <code dir="ltr">root</code>:</p>
<pre dir="ltr">
# ocrconfig -restore <span class="italic">file_name</span>
</pre>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>Ensure that the OCR devices that you specify in the OCR configuration exist and that these OCR devices are valid.</p>
</li>
<li>
<p>If you configured OCR in an Oracle ASM disk group, then ensure that the Oracle ASM disk group exists and is mounted.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink GINST" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=GINST"><span class="italic">Oracle Grid Infrastructure Installation Guide</span></a> for information about creating OCRs</p>
</li>
<li>
<p><a class="olink OSTMG137" href="../../server.112/e18951/asmdiskgrps.htm#OSTMG137"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for more information about Oracle ASM disk group management</p>
</li>
</ul>
</div>
</li>
<li>
<p>Verify the integrity of OCR:</p>
<pre dir="ltr">
# ocrcheck
</pre></li>
<li>
<p>Stop Oracle Clusterware on the node where it is running in exclusive mode:</p>
<pre dir="ltr">
# crsctl stop crs -f
</pre></li>
<li>
<p>Run the <code dir="ltr">ocrconfig -repair -replace</code> command as <code dir="ltr">root</code> on all the nodes in the cluster where you <span class="italic">did not</span> the <code dir="ltr">ocrconfig -restore</code> command. For example, if you ran the <code dir="ltr">ocrconfig -restore</code> command on node 1 of a four-node cluster, then you must run the <code dir="ltr">ocrconfig -repair -replace</code> command on nodes 2, 3, and 4.</p>
</li>
<li id="CHDCIGEE">
<p>Begin to start Oracle Clusterware by running the following command as <code dir="ltr">root</code> on all of the nodes:</p>
<pre dir="ltr">
# crsctl start crs
</pre></li>
<li>
<p>Verify OCR integrity of all of the cluster nodes that are configured as part of your cluster by running the following CVU command:</p>
<pre dir="ltr">
$ cluvfy comp ocr -n all -verbose
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="cvu.htm#BABBJHHH">Appendix A, "Cluster Verification Utility Reference"</a> for more information about enabling and using CVU</div>
<p class="subhead2"><a id="CHDCABFC"></a><a id="CWADD92004"></a>Restoring the Oracle Cluster Registry on Windows Systems</p>
<p>If you are storing OCR on an Oracle ASM disk group, and that disk group is corrupt, then you must restore the Oracle ASM disk group using Oracle ASM utilities, and then mount the disk group again before recovering OCR. Recover OCR by running the <code dir="ltr">ocrconfig -restore</code> command, as instructed in the following procedure.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If the original OCR location does not exist, then you must create an empty (0 byte) OCR location with the same name as the original OCR location before you run the <code dir="ltr">ocrconfig -restore</code> command.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink OSTMG" href="../../server.112/e18951/toc.htm"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for information about how to restore Oracle ASM disk groups</div>
<p>Use the following procedure to restore OCR on <a id="sthref194"></a>Windows systems:</p>
<ol>
<li>
<p>List the nodes in your cluster by running the following command on one node:</p>
<pre dir="ltr">
C:\&gt;olsnodes
</pre></li>
<li>
<p>Stop Oracle Clusterware by running the following command as a member of the Administrators group on all of the nodes:</p>
<pre dir="ltr">
C:\&gt;crsctl stop crs
</pre>
<p>If the preceding command returns any error due to OCR corruption, stop Oracle Clusterware by running the following command as a member of the Administrators group on all of the nodes:</p>
<pre dir="ltr">
C:\&gt;crsctl stop crs -f
</pre></li>
<li>
<p>Start the Oracle Clusterware stack on one node in exclusive mode by running the following command as a member of the Administrators group:</p>
<pre dir="ltr">
C:\&gt;crsctl start crs -excl -nocrs
</pre>
<p>The <code dir="ltr">-nocrs</code> option ensures that the <code dir="ltr">crsd</code> process and OCR do not start with the rest of the Oracle Clusterware stack.</p>
<p>Ignore any errors that display.</p>
</li>
<li>
<p>Restore OCR with the OCR backup file that you identified in <a href="#CHDDEGFB">"Listing Backup Files"</a> by running the following command as a member of the Administrators group:</p>
<pre dir="ltr">
C:\&gt;ocrconfig -restore <span class="italic">file_name</span>
</pre>
<p>Make sure that the OCR devices that you specify in the OCR configuration exist and that these OCR devices are valid.</p>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>Ensure that the OCR devices that you specify in the OCR configuration exist and that these OCR devices are valid.</p>
</li>
<li>
<p>Ensure that the Oracle ASM disk group you specify exists and is mounted.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink GINST" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=GINST"><span class="italic">Oracle Grid Infrastructure Installation Guide</span></a> for information about creating OCRs</p>
</li>
<li>
<p><a class="olink OSTMG137" href="../../server.112/e18951/asmdiskgrps.htm#OSTMG137"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for more information about Oracle ASM disk group management</p>
</li>
</ul>
</div>
</li>
<li>
<p>Verify the integrity of OCR:</p>
<pre dir="ltr">
C:\&gt;ocrcheck
</pre></li>
<li>
<p>Stop Oracle Clusterware on the node where it is running in exclusive mode:</p>
<pre dir="ltr">
C:\&gt;crsctl stop crs -f
</pre></li>
<li>
<p>Begin to start Oracle Clusterware by running the following command as a member of the Administrators group on all of the nodes:</p>
<pre dir="ltr">
C:\&gt;crsctl start crs
</pre></li>
<li>
<p>Run the following Cluster Verification Utility (CVU) command to verify OCR integrity of all of the nodes in your cluster database:</p>
<pre dir="ltr">
C:\&gt;cluvfy comp ocr -n all -verbose
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="cvu.htm#BABBJHHH">Appendix A, "Cluster Verification Utility Reference"</a> for more information about enabling and using CVU</div>
</li>
</ol>
<p class="subhead2"><a id="BGBBAHDG"></a><a id="CWADD92357"></a>Restoring the Oracle Cluster Registry in an Oracle Restart Environment</p>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>OCR is present for backward compatibility.</p>
</li>
<li>
<p>Once an OCR location is created, it does not get updated in the Oracle Restart environment.</p>
</li>
<li>
<p>If the Oracle Restart home has been backed up, and if there is a failure, then restoring the Oracle Restart home restores OCR.</p>
</li>
</ul>
</div>
<p>Use the following procedure to restore OCR in an <a id="sthref195"></a><a id="sthref196"></a>Oracle Restart environment:</p>
<ol>
<li>
<p>Stop Oracle High Availability Services by running the following command on all of the nodes:</p>
<pre dir="ltr">
$ crsctl stop has [-f]
</pre></li>
<li>
<p>Run the <code dir="ltr">ocrcheck -config</code> command to determine the OCR location and then create an empty (0 byte) OCR location with appropriate permissions in that location.</p>
</li>
<li>
<p>Restore OCR by running the following command as <code dir="ltr">root</code>:</p>
<pre dir="ltr">
# crsctl pin css -n <span class="italic">host_name</span>
</pre>
<div class="infobox-note">
<p class="notep1">Notes:</p>
Ensure that the OCR devices that you specify in the OCR configuration exist and that these OCR devices are valid.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink GINST" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=GINST"><span class="italic">Oracle Grid Infrastructure Installation Guide</span></a> for information about creating OCRs</div>
</li>
<li>
<p>Run the <code dir="ltr">ocrcheck</code> command to verify the integrity of OCR:</p>
</li>
<li>
<p>Start Oracle High Availability Services by running the following command on all of the nodes:</p>
<pre dir="ltr">
$ crsctl start has
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BGBFEEGA"></a>
<div id="CWADD90974" class="sect2">
<h3 class="sect2">Diagnosing Oracle Cluster Registry Problems</h3>
<p>You can use the <a id="sthref197"></a><a id="sthref198"></a>OCRDUMP and <a id="sthref199"></a>OCRCHECK utilities to diagnose OCR <a id="sthref200"></a>problems.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="ocrsyntax.htm#BABGGGEG">"OCRDUMP Utility Syntax and Options"</a> for more information about the OCRDUMP utility</p>
</li>
<li>
<p><a href="ocrsyntax.htm#BABJEHAF">"Using the OCRCHECK Utility"</a> for more information about the OCRCHECK utility</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i1012107"></a>
<div id="CWADD834" class="sect2">
<h3 class="sect2">Administering Oracle Cluster Registry with Oracle Cluster Registry Export and Import Commands</h3>
<p><a id="sthref201"></a>In addition to using the automatically created OCR backup files, you should also export OCR contents before and after making significant configuration changes, such as adding or deleting nodes from your environment, modifying Oracle Clusterware resources, and upgrading, downgrading or creating a database. Do this by using the <code dir="ltr">ocrconfig -export</code> command, which exports OCR content to a file format.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
Note the following restrictions for restoring OCR:
<ul>
<li>
<p>The file format generated by <code dir="ltr">ocrconfig -restore</code> is incompatible with the file format generated by <code dir="ltr">ocrconfig -export</code>. The <code dir="ltr">ocrconfig -export</code> and <code dir="ltr">ocrconfig -import</code> commands are compatible. The <code dir="ltr">ocrconfig -manualbackup</code> and <code dir="ltr">ocrconfig -restore</code> commands are compatible. The two file formats are incompatible and must not be interchangeably used.</p>
</li>
<li>
<p>When exporting OCR, Oracle recommends including "<code dir="ltr">ocr</code>", the cluster name, and the timestamp in the name string. For example:</p>
<pre dir="ltr">
ocr_mycluster1_20090521_2130_export
</pre></li>
</ul>
</div>
<p><a id="sthref202"></a><a id="sthref203"></a>Using the <code dir="ltr">ocrconfig -export</code> command also enables you to restore OCR using the <code dir="ltr">-import</code> option if your configuration changes cause errors. For example, if you have <a id="sthref204"></a>configuration problems that you cannot resolve, or if you are unable to restart Oracle Clusterware after such changes, then restore your configuration using the procedure for your platform.</p>
<p>Oracle recommends that you use either automatic or manual backups, and the <code dir="ltr">ocrconfig -restore</code> command instead of the <code dir="ltr">ocrconfig -export</code> and <code dir="ltr">ocrconfig -import</code> commands to restore OCR for the following reasons:</p>
<ul>
<li>
<p>A backup is a consistent snapshot of OCR, whereas an export is not.</p>
</li>
<li>
<p>Backups are created when the system is online. You must shut down Oracle Clusterware on all nodes in the cluster to get a consistent snapshot using the <code dir="ltr">ocrconfig -export</code> command.</p>
</li>
<li>
<p>You can inspect a backup using the OCRDUMP utility. You cannot inspect the contents of an export.</p>
</li>
<li>
<p>You can list backups with the <code dir="ltr">ocrconfig -showbackup</code> command, whereas <span class="italic">you</span> must keep track of all generated exports.</p>
</li>
</ul>
<p>This section includes the following topics:</p>
<ul>
<li>
<p><a href="#i1016535">Importing Oracle Cluster Registry Content on Linux or UNIX Systems</a></p>
</li>
<li>
<p><a href="#i1016682">Importing Oracle Cluster Registry Content on Windows Systems</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Most configuration changes that you make not only change OCR contents, the configuration changes also cause file and database object creation. Some of these changes are often not restored when you restore OCR. Do not restore OCR as a correction to revert to previous configurations, if some of these configuration changes should fail. This may result in an OCR location that has contents that do not match the state of the rest of your system.</div>
<a id="i1016535"></a>
<div id="CWADD90977" class="sect3">
<h4 class="sect3">Importing Oracle Cluster Registry Content on Linux or UNIX Systems</h4>
<p>&nbsp;</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
This procedure assumes default installation of Oracle Clusterware on all nodes in the cluster, where Oracle Clusterware autostart is enabled.</div>
<p><a id="sthref205"></a><a id="sthref206"></a>Use the following procedure to import OCR on Linux or UNIX systems:</p>
<ol>
<li>
<p>List the nodes in your cluster by running the following command on one node:</p>
<pre dir="ltr">
$ olsnodes
</pre></li>
<li>
<p>Stop Oracle Clusterware by running the following command as <code dir="ltr">root</code> on all of the nodes:</p>
<pre dir="ltr">
# crsctl stop crs
</pre>
<p>If the preceding command returns any error due to OCR corruption, stop Oracle Clusterware by running the following command as <code dir="ltr">root</code> on all of the nodes:</p>
<pre dir="ltr">
# crsctl stop crs -f
</pre></li>
<li>
<p>Start the Oracle Clusterware stack on one node in exclusive mode by running the following command as <code dir="ltr">root</code>:</p>
<pre dir="ltr">
# crsctl start crs -excl
</pre>
<p>Ignore any errors that display.</p>
<p>Check whether <code dir="ltr">crsd</code> is running. If it is, stop it by running the following command as <code dir="ltr">root</code>:</p>
<pre dir="ltr">
# crsctl stop resource ora.crsd -init
</pre>
<div class="infobox-note">
<p class="notep1">Caution:</p>
<span class="italic">Do not</span> use the <code dir="ltr">-init</code> flag with any other command.</div>
</li>
<li>
<p>Import OCR by running the following command as <code dir="ltr">root</code>:</p>
<pre dir="ltr">
# ocrconfig -import <span class="italic">file_name</span>
</pre>
<p>If you are importing OCR to a cluster or network file system, then skip to step <a href="#BGBIJGAI">7</a>.</p>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>If the original OCR location does not exist, then you must create an empty (0 byte) OCR location before you run the <code dir="ltr">ocrconfig -import</code> command.</p>
</li>
<li>
<p>Ensure that the OCR devices that you specify in the OCR configuration exist and that these OCR devices are valid.</p>
</li>
<li>
<p>If you configured OCR in an Oracle ASM disk group, then ensure that the Oracle ASM disk group exists and is mounted.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink GINST" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=GINST"><span class="italic">Oracle Grid Infrastructure Installation Guide</span></a> for information about creating OCRs</p>
</li>
<li>
<p><a class="olink OSTMG137" href="../../server.112/e18951/asmdiskgrps.htm#OSTMG137"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for more information about Oracle ASM disk group management</p>
</li>
</ul>
</div>
</li>
<li>
<p>Verify the integrity of OCR:</p>
<pre dir="ltr">
# ocrcheck
</pre></li>
<li>
<p>Stop Oracle Clusterware on the node where it is running in exclusive mode:</p>
<pre dir="ltr">
# crsctl stop crs -f
</pre></li>
<li id="BGBIJGAI">
<p>Begin to start Oracle Clusterware by running the following command as <code dir="ltr">root</code> on all of the nodes:</p>
<pre dir="ltr">
# crsctl start crs
</pre></li>
<li>
<p>Verify OCR integrity of all of the cluster nodes that are configured as part of your cluster by running the following CVU command:</p>
<pre dir="ltr">
$ cluvfy comp ocr -n all -verbose
</pre></li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You <span class="italic">can only</span> import an exported OCR. To restore OCR from a backup, you must instead use the <code dir="ltr">-restore</code> option, as described in <a href="#i1012456">"Backing Up Oracle Cluster Registry"</a>.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="cvu.htm#BABBJHHH">Appendix A, "Cluster Verification Utility Reference"</a> for more information about enabling and using CVU</div>
</div>
<!-- class="sect3" -->
<a id="i1016682"></a>
<div id="CWADD90978" class="sect3">
<h4 class="sect3">Importing Oracle Cluster Registry Content on Windows Systems</h4>
<div class="infobox-note">
<p class="notep1">Note:</p>
This procedure assumes default installation of Oracle Clusterware on all nodes in the cluster, where Oracle Clusterware autostart is enabled.</div>
<p><a id="sthref207"></a>Use the following procedure to import OCR on Windows systems:</p>
<ol>
<li>
<p>List the nodes in your cluster by running the following command on one node:</p>
<pre dir="ltr">
C:\&gt;olsnodes
</pre></li>
<li>
<p>Stop Oracle Clusterware by running the following command as a member of the Administrators group on all of the nodes:</p>
<pre dir="ltr">
C:\&gt;crsctl stop crs
</pre>
<p>If the preceding command returns any error due to OCR corruption, stop Oracle Clusterware by running the following command as a member of the Administrators group on all of the nodes:</p>
<pre dir="ltr">
C:\&gt;crsctl stop crs -f
</pre></li>
<li>
<p>Start the Oracle Clusterware stack on one node in exclusive mode by running the following command as a member of the Administrators group:</p>
<pre dir="ltr">
C:\&gt;crsctl start crs -excl
</pre>
<p>Ignore any errors that display.</p>
<p>Check whether <code dir="ltr">crsd</code> is running. If it is, stop it by running the following command as a member of the Administrators group:</p>
<pre dir="ltr">
C:\&gt;crsctl stop resource ora.crsd -init
</pre>
<div class="infobox-note">
<p class="notep1">Caution:</p>
<span class="italic">Do not</span> use the <code dir="ltr">-init</code> flag in any other command.</div>
</li>
<li>
<p>Import OCR by running the following command as a member of the Administrators group:</p>
<pre dir="ltr">
C:\&gt;ocrconfig -import <span class="italic">file_name</span>
</pre>
<p>Make sure that the OCR devices that you specify in the OCR configuration exist and that these OCR devices are valid.</p>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>If the original OCR location does not exist, then you must create an empty (0 byte) OCR location before you run the <code dir="ltr">ocrconfig -import</code> command.</p>
</li>
<li>
<p>Ensure that the OCR devices that you specify in the OCR configuration exist and that these OCR devices are valid.</p>
</li>
<li>
<p>Ensure that the Oracle ASM disk group you specify exists and is mounted.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink CWGEN" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=CWGEN"><span class="italic">Oracle Grid Infrastructure Installation Guide</span></a> for information about creating OCRs</p>
</li>
<li>
<p><a class="olink OSTMG137" href="../../server.112/e18951/asmdiskgrps.htm#OSTMG137"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for more information about Oracle ASM disk group management</p>
</li>
</ul>
</div>
</li>
<li>
<p>Verify the integrity of OCR:</p>
<pre dir="ltr">
C:\&gt;ocrcheck
</pre></li>
<li>
<p>Stop Oracle Clusterware on the node where it is running in exclusive mode:</p>
<pre dir="ltr">
C:\&gt;crsctl stop crs -f
</pre></li>
<li>
<p>Begin to start Oracle Clusterware by running the following command as a member of the Administrators group on all of the nodes:</p>
<pre dir="ltr">
C:\&gt;crsctl start crs
</pre></li>
<li>
<p>Run the following Cluster Verification Utility (CVU) command to verify OCR integrity of all of the nodes in your cluster database:</p>
<pre dir="ltr">
C:\&gt;cluvfy comp ocr -n all -verbose
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="cvu.htm#BABBJHHH">Appendix A, "Cluster Verification Utility Reference"</a> for more information about enabling and using CVU</div>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDFDGGB"></a>
<div id="CWADD90963" class="sect2">
<h3 class="sect2">Oracle Local Registry</h3>
<p>In Oracle Clusterware 11<span class="italic">g</span> release 2 (11.2), each node in a cluster has a local registry for node-specific resources, called an <a id="sthref208"></a>Oracle Local Registry (OLR), that is installed and configured when Oracle Clusterware installs OCR. Multiple processes on each node have simultaneous read and write access to the OLR particular to the node on which they reside, regardless of whether Oracle Clusterware is running or fully functional.</p>
<p>By default, OLR is located at <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">/cdata/</code><code dir="ltr"><span class="codeinlineitalic">host_name</span></code><code dir="ltr">.olr</code> on each node.</p>
<p>Manage OLR using the OCRCHECK, OCRDUMP, and OCRCONFIG utilities as <code dir="ltr">root</code> with the <code dir="ltr">-local</code> option.</p>
<ul>
<li>
<p>You can check the status of OLR on the local node using the <a id="sthref209"></a><a id="sthref210"></a>OCRCHECK utility, as follows:</p>
<pre dir="ltr">
# ocrcheck -local

Status of Oracle Cluster Registry is as follows :
        Version                  :          3
        Total space (kbytes)     :     262132
        Used space (kbytes)      :       9200
        Available space (kbytes) :     252932
        ID                       :  604793089
        Device/File Name         : /private2/crs/cdata/localhost/dglnx6.olr
                                   Device/File integrity check succeeded

        Local OCR integrity check succeeded
</pre></li>
<li>
<p>You can display the content of OLR on the local node to the text terminal that initiated the program using the <a id="sthref211"></a><a id="sthref212"></a>OCRDUMP utility, as follows:</p>
<pre dir="ltr">
# ocrdump -local -stdout
</pre></li>
<li>
<p>You can perform administrative tasks on OLR on the local node using the <a id="sthref213"></a><a id="sthref214"></a>OCRCONFIG utility.</p>
<ul>
<li>
<p><a id="sthref215"></a>To export OLR to a file:</p>
<pre dir="ltr">
# ocrconfig &ndash;local &ndash;export <span class="italic">file_name</span>
</pre>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>Oracle recommends that you use the <code dir="ltr">-manualbackup</code> and <code dir="ltr">-restore</code> commands and not the <code dir="ltr">-import</code> and <code dir="ltr">-export</code> commands.</p>
</li>
<li>
<p>When exporting OLR, Oracle recommends including "<code dir="ltr">olr</code>", the host name, and the timestamp in the name string. For example:</p>
<pre dir="ltr">
olr_myhost1_20090603_0130_export
</pre></li>
</ul>
</div>
</li>
<li>
<p><a id="sthref216"></a>To import a specified file to OLR:</p>
<pre dir="ltr">
# ocrconfig &ndash;local &ndash;import <span class="italic">file_name</span>
</pre></li>
<li>
<p><a id="sthref217"></a>To manually back up OLR:</p>
<pre dir="ltr">
# ocrconfig &ndash;local &ndash;manualbackup
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
The OLR is backed up at the end of an installation or an upgrade. After that time, you can only manually back up the OLR. Automatic backups are not supported for the OLR. You should create a new backup when you migrate OCR from Oracle ASM to other storage, or when you migrate OCR from other storage to Oracle ASM.
<p>The default backup location for the OLR is in the path <code dir="ltr"><span class="codeinlineitalic">Grid_home</span></code><code dir="ltr">/cdata/</code><code dir="ltr"><span class="codeinlineitalic">host_name</span></code>.</p>
</div>
</li>
<li>
<p><a id="sthref218"></a>To view the contents of the OLR backup file:</p>
<pre dir="ltr">
ocrdump -local -backupfile <span class="italic">olr_backup_file_name</span>
</pre></li>
<li>
<p>To change the OLR backup location:</p>
<pre dir="ltr">
ocrconfig -local -backuploc <span class="italic">new_olr_backup_path</span>
</pre></li>
<li>
<p><a id="sthref219"></a>To restore OLR:</p>
<pre dir="ltr">
# crsctl stop crs
# ocrconfig -local -restore <span class="italic">file_name</span>
# ocrcheck -local
# crsctl start crs
$ cluvfy comp olr
</pre></li>
</ul>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="BABDAIDI"></a>
<div id="CWADD837" class="sect2">
<h3 class="sect2">Upgrading and Downgrading the Oracle Cluster Registry Configuration</h3>
<p><a id="sthref220"></a><a id="sthref221"></a>When you upgrade Oracle Clusterware, it automatically runs the <code dir="ltr">ocrconfig -upgrade</code> command. To downgrade, follow the downgrade instructions for each component and also downgrade OCR using the <code dir="ltr">ocrconfig -downgrade</code> command. If you are upgrading OCR, then you can use the OCRCHECK utility to verify the integrity of OCR.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1011043"></a>
<div id="CWADD833" class="sect1"><a id="CIHFBJEF"></a>
<h2 class="sect1">Managing Voting Disks</h2>
<p>This section includes the following topics for <a id="sthref222"></a>managing voting disks in your cluster:</p>
<ul>
<li>
<p><a href="#CHDFJHHJ">Storing Voting Disks on Oracle ASM</a></p>
</li>
<li>
<p><a href="#BABDJDHI">Backing Up Voting Disks</a></p>
</li>
<li>
<p><a href="#BGBCHCBI">Restoring Voting Disks</a></p>
</li>
<li>
<p><a href="#BGBBIGJH">Adding, Deleting, or Migrating Voting Disks</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Caution:</p>
The <code dir="ltr">dd</code> commands used to back up and recover voting disks in previous versions of Oracle Clusterware are not supported in Oracle Clusterware 11<span class="italic">g</span> release 2 (11.2). Restoring voting disks that were copied using <code dir="ltr">dd</code> or <code dir="ltr">cp</code> commands can prevent the Oracle Clusterware 11<span class="italic">g</span> release 2 (11.2) stack from coming up. Use the backup and restore procedures described in this chapter to ensure proper voting disk functionality.</div>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>Voting disk management requires a valid and working OCR. Before you add, delete, replace, or restore voting disks, run the <code dir="ltr">ocrcheck</code> command as <code dir="ltr">root</code>. If OCR is not available or it is corrupt, then you must restore OCR as described in <a href="#CHDIICJB">"Restoring Oracle Cluster Registry"</a>.</p>
</li>
<li>
<p>If you upgrade from a previous version of Oracle Clusterware to Oracle Clusterware 11<span class="italic">g</span> release 2 (11.2) and you want to store voting disks in an Oracle ASM disk group, then you must set the <span class="bold">ASM Compatibility</span> (<code dir="ltr">COMPATIBLE.ASM</code>) compatibility attribute to <code dir="ltr">11.2.0.0</code>.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink OSTMG02700" href="../../server.112/e18951/asmdiskgrps.htm#OSTMG02700"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for information about setting Oracle ASM compatibility attributes</div>
<a id="CHDFJHHJ"></a>
<div id="CWADD91889" class="sect2">
<h3 class="sect2">Storing Voting Disks on Oracle ASM</h3>
<p><a id="sthref223"></a>Oracle ASM manages voting disks differently from other files that it stores. If you choose to store your voting disks in Oracle ASM, then Oracle ASM stores all the voting disks for the cluster in the disk group you choose. You cannot use voting disks stored in Oracle ASM and voting disks not stored in Oracle ASM in the same cluster.</p>
<p>Once you configure voting disks on Oracle ASM, you can only make changes to the voting disks' configuration using the <code dir="ltr">crsctl replace votedisk</code> command. This is true even in cases where there are no working voting disks. Despite the fact that <code dir="ltr">crsctl query css votedisk</code> reports zero vote disks in use, Oracle Clusterware remembers the fact that Oracle ASM was in use and the <code dir="ltr">replace</code> verb is required. Only after you use the <code dir="ltr">replace</code> verb to move voting disks back to non-Oracle ASM storage are the verbs <code dir="ltr">add css votedisk</code> and <code dir="ltr">delete css votedisk</code> again usable.</p>
<p>The number of voting files you can store in a particular <a id="sthref224"></a>Oracle ASM disk group depends upon the redundancy of the disk group.</p>
<ul>
<li>
<p><span class="bold">External redundancy</span>: A disk group with external redundancy can store only one voting disk</p>
</li>
<li>
<p><span class="bold">Normal redundancy</span>: A disk group with normal redundancy stores three voting disks</p>
</li>
<li>
<p><span class="bold">High redundancy</span>: A disk group with high redundancy stores five voting disks</p>
</li>
</ul>
<p>By default, Oracle ASM puts each voting disk in its own failure group within the disk group. A <a id="sthref225"></a><a id="sthref226"></a>failure group is a subset of the disks in a disk group. Failure groups define disks that share components, such that if one fails then other disks sharing the component might also fail. An example of what you might define as a failure group would be a set of SCSI disks sharing the same SCSI controller. Failure groups are used to determine which Oracle ASM disks to use for storing redundant data. For example, if two-way mirroring is specified for a file, then redundant copies of file extents must be stored in separate failure groups.</p>
<p>If voting disks are stored on Oracle ASM with normal or high redundancy, and the storage hardware in one failure group suffers a failure, then if there is another disk available in a disk group in an unaffected failure group, Oracle ASM recovers the voting disk in the unaffected failure group.</p>
<p>A normal redundancy disk group must contain at least two failure groups but if you are storing your voting disks on Oracle ASM, then a normal redundancy disk group must contain at least three failure groups. A high redundancy disk group must contain at least three failure groups. However, Oracle recommends using several failure groups. A small number of failure groups, or failure groups of uneven capacity, can create allocation problems that prevent full use of all of the available storage.</p>
<p>You must specify enough failure groups in each disk group to support the redundancy type for that disk group.</p>
<p>Using the <code dir="ltr">crsctl replace votedisk</code> command, you can move a given set of voting disks from one Oracle ASM disk group into another, or onto a certified file system. If you move voting disks from one Oracle ASM disk group to another, then you can change the number of voting disks by placing them in a disk group of a different redundancy level as the former disk group.</p>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>You cannot directly influence the number of voting disks in one disk group.</p>
</li>
<li>
<p>You cannot use the <code dir="ltr">crsctl add | delete votedisk</code> commands on voting disks stored in Oracle ASM disk groups because Oracle ASM manages the number of voting disks according to the redundancy level of the disk group.</p>
</li>
<li>
<p>You cannot add a voting disk to a cluster file system if the voting disks are stored in an Oracle ASM disk group. Oracle does not support having voting disks in Oracle ASM and directly on a cluster file system for the same cluster at the same time.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink OSTMG137" href="../../server.112/e18951/asmdiskgrps.htm#OSTMG137"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for more information about disk group redundancy and quorum failure groups</p>
</li>
<li>
<p><a href="#BGBBIGJH">"Adding, Deleting, or Migrating Voting Disks"</a> for information about migrating voting disks</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABDJDHI"></a>
<div id="CWADD90960" class="sect2">
<h3 class="sect2">Backing Up Voting Disks</h3>
<p>In <a id="sthref227"></a>Oracle Clusterware 11<span class="italic">g</span> release 2 (11.2), you no longer have to back up the voting disk. The voting disk data is automatically backed up in OCR as part of any configuration change and is automatically restored to any voting disk added. If all voting disks are corrupted, however, you can restore them as described in <a href="#BGBCHCBI">"Restoring Voting Disks"</a>.</p>
</div>
<!-- class="sect2" -->
<a id="BGBCHCBI"></a>
<div id="CWADD90961" class="sect2">
<h3 class="sect2">Restoring Voting Disks</h3>
<p><a id="sthref228"></a>If all of the voting disks are corrupted, then you can restore them, as follows:</p>
<ol>
<li>
<p>Restore OCR as described in <a href="#CHDIICJB">"Restoring Oracle Cluster Registry"</a>, if necessary.</p>
<p>This step is necessary only if OCR is also corrupted or otherwise unavailable, such as if OCR is on Oracle ASM and the disk group is no longer available.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink OSTMG137" href="../../server.112/e18951/asmdiskgrps.htm#OSTMG137"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for more information about managing Oracle ASM disk groups</div>
</li>
<li>
<p>Run the following command as <code dir="ltr">root</code> from only one node to start the Oracle Clusterware stack in exclusive mode, which does not require voting files to be present or usable:</p>
<pre dir="ltr">
# crsctl start crs -excl
</pre></li>
<li>
<p>Run the <code dir="ltr">crsctl query css votedisk</code> command to retrieve the list of voting files currently defined, similar to the following:</p>
<pre dir="ltr">
$ crsctl query css votedisk
--  -----    -----------------                --------- ---------
##  STATE    File Universal Id                File Name Disk group
 1. ONLINE   7c54856e98474f61bf349401e7c9fb95 (/dev/sdb1) [DATA]
</pre>
<p>This list may be empty if all voting disks were corrupted, or may have entries that are marked as status <code dir="ltr">3</code> or <code dir="ltr">OFF</code>.</p>
</li>
<li>
<p>Depending on where you store your voting files, do one of the following:</p>
<ul>
<li>
<p>If the voting disks are stored in Oracle ASM, then run the following command to migrate the voting disks to the Oracle ASM disk group you specify:</p>
<pre dir="ltr">
crsctl replace votedisk +<span class="italic">asm_disk_group</span>
</pre>
<p>The Oracle ASM disk group to which you migrate the voting files must exist in Oracle ASM. You can use this command whether the voting disks were stored in Oracle ASM or some other storage device.</p>
</li>
<li>
<p>If you did not store voting disks in Oracle ASM, then run the following command using the File Universal Identifier (FUID) obtained in the previous step:</p>
<pre dir="ltr">
$ crsctl delete css votedisk <span class="italic">FUID</span>
</pre>
<p>Add a voting disk, as follows:</p>
<pre dir="ltr">
$ crsctl add css votedisk <span class="italic">path_to_voting_disk</span>
</pre></li>
</ul>
</li>
<li>
<p>Stop the Oracle Clusterware stack as <code dir="ltr">root</code>:</p>
<pre dir="ltr">
# crsctl stop crs
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If the Oracle Clusterware stack is running in exclusive mode, then use the <code dir="ltr">-f</code> option to force the shutdown of the stack.</div>
</li>
<li>
<p>Restart the Oracle Clusterware stack in normal mode as <code dir="ltr">root</code>:</p>
<pre dir="ltr">
# crsctl start crs
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BGBBIGJH"></a>
<div id="CWADD90962" class="sect2">
<h3 class="sect2">Adding, Deleting, or Migrating Voting Disks</h3>
<p><a id="sthref229"></a><a id="sthref230"></a><a id="sthref231"></a>You can add, remove, and migrate voting disks after you install Oracle Clusterware. Note that the commands you use to do this are different, depending on whether your voting disks are located in Oracle ASM, or are located in another storage option.</p>
<p class="subhead2"><a id="CWADD92369"></a><a id="sthref232"></a>Modifying voting disks that are stored in Oracle ASM</p>
<ul>
<li>
<p>To <a id="sthref233"></a>display the voting disk FUID and file path of each current voting disk, run the <code dir="ltr">crsctl query css votedisk</code> command to display output similar to the following:</p>
<pre dir="ltr">
$ crsctl query css votedisk
--  -----    -----------------                --------- ---------
##  STATE    File Universal Id                File Name Disk group
 1. ONLINE   7c54856e98474f61bf349401e7c9fb95 (/dev/sdb1) [DATA]
</pre>
<p>This command returns a disk sequence number, the status of the disk, the FUID, the path of the disk, and the name of the Oracle ASM disk group on which the disk is stored.</p>
</li>
<li>
<p><a id="sthref234"></a>To migrate voting disks from Oracle ASM to an alternative storage device, specify the path to the non-Oracle ASM storage device with which you want to replace the Oracle ASM disk group using the following command:</p>
<pre dir="ltr">
$ crsctl replace votedisk <span class="italic">path_to_voting_disk</span>
</pre>
<p>You can run this command on any node in the cluster.</p>
</li>
<li>
<p>To <a id="sthref235"></a>replace all voting disks not stored in Oracle ASM with voting disks managed by Oracle ASM in an Oracle ASM disk group, run the following command:</p>
<pre dir="ltr">
$ crsctl replace votedisk +<span class="italic">asm_disk_group</span>
</pre></li>
</ul>
<p class="subhead2"><a id="CWADD92370"></a><a id="sthref236"></a>Modifying voting disks that are not stored on Oracle ASM:</p>
<ul>
<li>
<p>To <a id="sthref237"></a>display the voting disk FUID and file path of each current voting disk, run the following command:</p>
<pre dir="ltr">
$ crsctl query css votedisk
##  STATE    File Universal Id                File Name Disk group
--  -----    -----------------                --------- ---------
 1. ONLINE   7c54856e98474f61bf349401e7c9fb95 (/cfs/host09_vd3) []
</pre>
<p>This command returns a disk sequence number, the status of the disk, the FUID, and the path of the disk and no name of an Oracle ASM disk group.</p>
</li>
<li>
<p>To <a id="sthref238"></a>add one or more voting disks, run the following command, replacing the <code dir="ltr"><span class="codeinlineitalic">path_to_voting_disk</span></code> variable with one or more space-delimited, complete paths to the voting disks you want to add:</p>
<pre dir="ltr">
$ crsctl add css votedisk <span class="italic">path_to_voting_disk</span> [...]
</pre></li>
<li>
<p>To <a id="sthref239"></a>replace voting disk A with voting disk B, you must add voting disk B, and then delete voting disk A. To add a new disk and remove the existing disk, run the following command, replacing the <code dir="ltr"><span class="codeinlineitalic">path_to_voting_diskB</span></code> variable with the fully qualified path name of voting disk B:</p>
<pre dir="ltr">
$ crsctl add css votedisk <span class="italic">path_to_voting_diskB</span> -purge
</pre>
<p>The <code dir="ltr">-purge</code> option deletes existing voting disks.</p>
</li>
<li>
<p>To <a id="sthref240"></a>remove a voting disk, run the following command, specifying one or more space-delimited, voting disk FUIDs or comma-delimited directory paths to the voting disks you want to remove:</p>
<pre dir="ltr">
$ crsctl delete css votedisk {<span class="italic">FUID</span> | <span class="italic">path_to_voting_disk</span>[...]}
</pre></li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
If the cluster is down and cannot restart due to lost voting disks, then you must start CSS in exclusive mode by running the following command, as <code dir="ltr">root</code>:
<pre dir="ltr">
# crsctl start crs -excl
</pre>
<p>After you start CSS in exclusive mode, you can replace the voting disk, as follows:</p>
<pre dir="ltr">
# crsctl replace votedisk <span class="italic">path_to_voting_disk</span>
</pre></div>
<p class="subhead2"><a id="CWADD92371"></a>Migrating voting disks to Oracle ASM</p>
<p>To <a id="sthref241"></a>migrate voting disks to Oracle ASM, specify the Oracle ASM disk group name in the following command:</p>
<pre dir="ltr">
$ crsctl replace votedisk +<span class="italic">asm_disk_group</span>
</pre>
<p>You can run this command on any node in the cluster.</p>
<p class="subhead2"><a id="CWADD92372"></a>Verifying the voting disk location</p>
<p>After modifying the voting disk, verify the voting disk location, as follows:</p>
<pre dir="ltr">
$ crsctl query css votedisk
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="crsref.htm#CHDGADEH">Appendix E, "CRSCTL Utility Reference"</a> for more information about CRSCTL commands</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment407">
<tr>
<td class="cellalignment416">
<table class="cellalignment412">
<tr>
<td class="cellalignment411"><a href="admin.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment411"><a href="adddelclusterware.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2007, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment419">
<table class="cellalignment410">
<tr>
<td class="cellalignment411"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment411"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment411"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment411"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment411"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment411"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
