<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Configuring Recovery Manager and Archiving</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1058" />
<meta name="dcterms.created" content="2015-06-24T11:50:38Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Real Application Clusters Administration and Deployment Guide" />
<meta name="dcterms.identifier" content="E41960-04" />
<meta name="dcterms.isVersionOf" content="RACAD" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="rac_glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="hafeats.htm" title="Previous" type="text/html" />
<link rel="Next" href="backup.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e41960.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">11/24</span> <!-- End Header -->
<div id="RACAD320" class="chapter"><a id="g496102"></a> <a id="i474611"></a>
<h1 class="chapter"><span class="secnum">6</span> Configuring Recovery Manager and Archiving</h1>
<p>This chapter explains how to configure Recovery Manager (RMAN) for use in Oracle Real Application Clusters (Oracle RAC) environments. This chapter also provides procedures for using for archiving in Oracle RAC environments and discusses online redo log and archived redo log considerations.</p>
<p>The topics in this chapter include:</p>
<ul>
<li>
<p><a href="#i472630">Overview of Configuring RMAN for Oracle RAC</a></p>
</li>
<li>
<p><a href="#i491246">Archiving Mode in Oracle RAC</a></p>
</li>
<li>
<p><a href="#i455026">Configuring the RMAN Snapshot Control File Location</a></p>
</li>
<li>
<p><a href="#i455044">Configuring RMAN to Automatically Backup the Control File and SPFILE</a></p>
</li>
<li>
<p><a href="#CHDIGIJD">Crosschecking on Multiple Oracle RAC Nodes</a></p>
</li>
<li>
<p><a href="#BABFGCBD">Configuring Channels for RMAN in Oracle RAC</a></p>
</li>
<li>
<p><a href="#i491408">Managing Archived Redo Logs Using RMAN in Oracle RAC</a></p>
</li>
<li>
<p><a href="#i491166">Archived Redo Log File Conventions in Oracle RAC</a></p>
</li>
<li>
<p><a href="#i490858">RMAN Archiving Configuration Scenarios</a></p>
</li>
<li>
<p><a href="#i491266">Monitoring the Archiver Processes</a></p>
</li>
</ul>
<a id="i472630"></a>
<div id="RACAD850" class="sect1">
<h2 class="sect1">Overview of Configuring RMAN for Oracle RAC</h2>
<p>RMAN enables you to back up, restore, and recover data files, control files, server parameter files (SPFILEs) and archived redo log files. RMAN is included with Oracle Database and does not require separate installation. You can run RMAN from the command line or use RMAN in the Backup Manager in Oracle Enterprise Manager.</p>
</div>
<!-- class="sect1" -->
<a id="i491246"></a>
<div id="RACAD327" class="sect1">
<h2 class="sect1">Archiving Mode in Oracle RAC</h2>
<p>In order for redo log files to be archived, the Oracle RAC database must be in <code dir="ltr">ARCHIVELOG</code> mode. You can run the <a id="sthref623"></a><code dir="ltr">ALTER DATABASE</code> SQL statement to change the archiving mode in Oracle RAC, because the database is mounted by the local instance but not open in any instances. You do not need to modify parameter settings to run this statement.</p>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>The <code dir="ltr">ARCHIVELOG</code> mode is set at the database level, not the instance level. Either all instances archive or none do.</p>
</li>
<li>
<p>You can also change the archive log mode by using the Recovery Settings page in the <span class="bold">Maintenance</span> tab of the Oracle Enterprise Manager Oracle RAC Database Home Page.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMIN008" href="../../server.112/e25494/archredo.htm#ADMIN008"><span class="italic">Oracle Database Administrator's Guide</span></a> for more information about setting the archiving mode</div>
</div>
<!-- class="sect1" -->
<a id="i455026"></a>
<div id="RACAD851" class="sect1">
<h2 class="sect1">Configuring the RMAN Snapshot Control File Location</h2>
<p>The <a id="sthref624"></a><a id="sthref625"></a><a id="sthref626"></a>snapshot control file is a copy of a database control file created in an operating system-specific location by RMAN. RMAN creates the snapshot control file so that it has a consistent version of a control file to use when either resynchronizing the recovery catalog or backing up the control file.</p>
<p>You can specify a <a href="rac_glossary.htm#CHDDAHDH"><span class="xrefglossterm">cluster file system</span></a> or a raw device destination for the location of your snapshot control file. This file is shared across all nodes in the <a href="rac_glossary.htm#CHDIADDF"><span class="xrefglossterm">cluster</span></a> and <span class="italic">must</span> be accessible by all nodes in the cluster. Run the following RMAN command to determine the configured location of the snapshot control file:</p>
<pre dir="ltr">
SHOW SNAPSHOT CONTROLFILE NAME;
</pre>
<p>You can change the configured location of the snapshot control file. For example, on Linux and UNIX systems you can specify the snapshot control file location as <code dir="ltr">$ORACLE_HOME/dbs/scf/snap_prod.cf</code> by entering the following at the <a id="sthref627"></a>RMAN prompt:</p>
<pre dir="ltr">
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '$ORACLE_HOME/dbs/scf/snap_prod.cf';
</pre>
<p>This command sets the configuration for the location of the snapshot control file for every instance of your <a href="rac_glossary.htm#CHDDEDDI"><span class="xrefglossterm">cluster database</span></a>. Therefore, ensure that the directory <code dir="ltr">$ORACLE_HOME/dbs/scf</code> exists on all nodes that perform backups.</p>
<p>The <code dir="ltr">CONFIGURE</code> command creates persistent settings across RMAN sessions. Therefore, you do not need to run this command again unless you want to change the location of the snapshot control file.</p>
<p>To delete a snapshot control file you must first change the snapshot control file location, then delete the file at the older location, as follows:</p>
<pre dir="ltr">
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '<span class="italic">new_name</span>';
DELETE COPY OF CONTROLFILE;
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF113" href="../../backup.112/e10643/rcmsynta010.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for more information about configuring the snapshot control file</div>
</div>
<!-- class="sect1" -->
<a id="i455044"></a>
<div id="RACAD853" class="sect1">
<h2 class="sect1">Configuring RMAN to Automatically Backup the Control File and SPFILE</h2>
<p>If you set <code dir="ltr">CONFIGURE CONTROLFILE AUTOBACKUP</code> to <code dir="ltr">ON</code>, then RMAN automatically creates a control file and an SPFILE backup after you run the <code dir="ltr">BACKUP</code> or <code dir="ltr">COPY</code> commands. RMAN can also automatically restore an SPFILE, if this is required to start an instance to perform recovery, because the default location for the SPFILE must be available to all nodes in your Oracle RAC database.</p>
<p>These features are important in disaster recovery because RMAN can restore the control file even without a recovery catalog. RMAN can restore an autobackup of the control file even after the loss of both the recovery catalog and the current control file. You can change the default name that RMAN gives to this file with the <code dir="ltr">CONFIGURE CONTROLFILE AUTOBACKUP FORMAT</code> command. Note that if you specify an absolute path name in this command, then this path must exist identically on all nodes that participate in backups.</p>
<p>RMAN performs the control file autobackup on the first allocated channel. Therefore, when you allocate multiple channels with different parameters, especially when you allocate a channel with the <code dir="ltr">CONNECT</code> command, determine which channel will perform the control file autobackup. Always allocate the channel for this node first.</p>
<p>Besides using the RMAN control file, you can also use <a id="sthref628"></a>Oracle Enterprise Manager to use the RMAN features.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink BRADV8101" href="../../backup.112/e10642/rcmconfb.htm#BRADV8101"><span class="italic">Oracle Database Backup and Recovery User's Guide</span></a> for more information about using the control file autobackup feature</div>
</div>
<!-- class="sect1" -->
<a id="CHDIGIJD"></a>
<div id="RACAD7320" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Crosschecking on Multiple Oracle RAC Nodes<a id="sthref629"></a><a id="sthref630"></a></h2>
<p>When crosschecking on multiple nodes (and when operating RMAN in general), configure the cluster so that all backups can be accessed by every node, regardless of which node created the backup. When the cluster is configured this way, you can <a id="sthref631"></a><a id="sthref632"></a><a id="sthref633"></a><a id="sthref634"></a>allocate channels to any node in the cluster during restore or crosscheck operations.</p>
<p>If you cannot configure the cluster so that each node can access all backups, then during restore and crosscheck operations, you must allocate channels on multiple nodes by providing the <code dir="ltr">CONNECT</code> option to the <code dir="ltr">CONFIGURE CHANNEL</code> command, so that every backup can be accessed by at least one node. If some backups are not accessible during crosscheck because no channel was configured on the node that can access those backups, then those backups are marked <code dir="ltr">EXPIRED</code> in the RMAN repository after the crosscheck.</p>
<p>For example, you can use <code dir="ltr">CONFIGURE CHANNEL ... CONNECT</code> in an Oracle RAC configuration in which tape backups are created on various nodes in the cluster and each backup is only accessible on the node on which it is created. This is described in more detail in <a href="#BABECBAI">"Configuring Channels to Use a Specific Node"</a>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink BRADV8171" href="../../backup.112/e10642/rcmmaint.htm#BRADV8171"><span class="italic">Oracle Database Backup and Recovery User's Guide</span></a> for more information about crosschecking</div>
</div>
<!-- class="sect1" -->
<a id="BABFGCBD"></a>
<div id="RACAD7321" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Configuring Channels for RMAN in Oracle RAC</h2>
<p>This section describes how to <a id="sthref635"></a><a id="sthref636"></a><a id="sthref637"></a>configure channels for RMAN. You can configure channels to use automatic load balancing or you can specify specific channels for specific instances as described in the following topics:</p>
<ul>
<li>
<p><a href="#BABCFIGH">Configuring Channels to Use Automatic Load Balancing</a></p>
</li>
<li>
<p><a href="#BABECBAI">Configuring Channels to Use a Specific Node</a></p>
</li>
</ul>
<a id="BABCFIGH"></a>
<div id="RACAD7322" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Configuring Channels to Use Automatic Load Balancing</h3>
<p>To configure channels to use automatic load balancing, use the following syntax:</p>
<pre dir="ltr">
CONFIGURE DEVICE TYPE [disk | sbt] PARALLELISM <span class="italic">number_of_channels</span>;
...
</pre>
<p>Where <code dir="ltr"><span class="codeinlineitalic">number_of_channels</span></code> is the number of channels that you want to use for the operation. After you complete this one-time configuration, you can issue <code dir="ltr">BACKUP</code> or <code dir="ltr">RESTORE</code> commands.</p>
</div>
<!-- class="sect2" -->
<a id="BABECBAI"></a>
<div id="RACAD7323" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Configuring Channels to Use a Specific Node</h3>
<p>To <a id="sthref638"></a><a id="sthref639"></a>configure one RMAN channel for each policy-managed Oracle RAC database instance, use the following syntax:</p>
<pre dir="ltr">
CONFIGURE CHANNEL DEVICE TYPE sbt CONNECT '@racinst_1'
CONFIGURE CHANNEL DEVICE TYPE sbt CONNECT '@racinst_2'
...
</pre>
<p>After this one-time configuration step, you can issue the <code dir="ltr">BACKUP</code> or <code dir="ltr">RESTORE</code> commands.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i491408"></a>
<div id="RACAD321" class="sect1">
<h2 class="sect1">Managing Archived Redo Logs Using RMAN in Oracle RAC</h2>
<p>When a node generates an archived redo log, Oracle Database always records the filename of the log in the control file of the target database. If you are using a recovery catalog, then RMAN also records the archived redo log filenames in the recovery catalog when a resynchronization occurs.</p>
<p>The archived redo log naming scheme that you use is important because when a node writes to a log with a specific file name on its file system, the file must be readable by any node that must access this archived redo log. For example, if <code dir="ltr">node1</code> archives a log to <code dir="ltr">/oracle/arc_dest/log_1_100_23452345.arc</code>, then <code dir="ltr">node2</code> can back up this archived redo log only if it can read <code dir="ltr">/oracle/arc_dest/log_1_100_23452345.arc</code> on its own file system.</p>
<p>The backup and recovery strategy that you choose depends on how you configure the archiving destinations for each node. Whether only one node or all nodes perform archived redo log backups, you must ensure that all archived redo logs are backed up. If you use RMAN parallelism during recovery, then the node that performs recovery must have read access to all archived redo logs in your cluster.</p>
<p>Multiple nodes can restore archived logs in parallel. However, during recovery, only one node applies the archived logs. Therefore, the node that is performing the recovery must be able to access all of the archived logs that are needed for the recovery operation. By default, the database determines the optimum number of parallel threads to use during the recovery operation. You can use the <code dir="ltr">PARALLEL</code> clause in the <code dir="ltr">RECOVER</code> command to change the number of parallel threads.</p>
<p class="subhead1"><a id="RACAD7691"></a>Guidelines and Considerations for Archived Redo Logs</p>
<p>The primary consideration is to ensure that all archived redo logs can be read from every node during recovery, and, if possible, during backups. During recovery, if the archived log destinations are visible from the node that performs the recovery, then Oracle Database can successfully recover the archived log data.</p>
</div>
<!-- class="sect1" -->
<a id="i491166"></a>
<div id="RACAD326" class="sect1">
<h2 class="sect1">Archived Redo Log File Conventions in Oracle RAC</h2>
<p>For any archived redo log configuration,<a id="sthref640"></a> uniquely identify the archived <a id="sthref641"></a>redo logs with the <a id="sthref642"></a><code dir="ltr">LOG_ARCHIVE_FORMAT</code> parameter. The format of this parameter is operating system-specific and it can include text strings, one or more variables, and a filename extension.<a id="sthref643"></a><a id="sthref644"></a><a id="sthref645"></a><a id="sthref646"></a><a id="sthref647"></a><a id="sthref648"></a><a id="sthref649"></a></p>
<div id="RACAD7693" class="tblruleformal">
<p class="titleintable"><a id="sthref650"></a><a id="sthref651"></a>Table 6-1 Archived Redo Log File Name Format Parameters</p>
<table class="cellalignment432" title="Archived Redo Log File Name Format Parameters " summary="Archived Redo Log Filename Format Parameters" dir="ltr">
<thead>
<tr class="cellalignment423">
<th class="cellalignment430" id="r1c1-t7"><span class="bold">Parameter</span></th>
<th class="cellalignment430" id="r1c2-t7"><span class="bold">Description</span></th>
<th class="cellalignment430" id="r1c3-t7"><span class="bold">Example</span></th>
</tr>
</thead>
<tbody>
<tr class="cellalignment423">
<td class="cellalignment431" id="r2c1-t7" headers="r1c1-t7">
<p><code dir="ltr">%r</code></p>
</td>
<td class="cellalignment431" headers="r2c1-t7 r1c2-t7">
<p>Resetlogs identifier, not padded</p>
</td>
<td class="cellalignment431" headers="r2c1-t7 r1c3-t7">
<p><code dir="ltr">log_1_62_23452345</code></p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r3c1-t7" headers="r1c1-t7">
<p><code dir="ltr">%R</code></p>
</td>
<td class="cellalignment431" headers="r3c1-t7 r1c2-t7">
<p>Resetlogs identifier, left-zero-padded</p>
</td>
<td class="cellalignment431" headers="r3c1-t7 r1c3-t7">
<p><code dir="ltr">log_1_62_0023452345</code></p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r4c1-t7" headers="r1c1-t7">
<p><code dir="ltr">%s</code></p>
</td>
<td class="cellalignment431" headers="r4c1-t7 r1c2-t7">
<p>Log sequence number, not padded</p>
</td>
<td class="cellalignment431" headers="r4c1-t7 r1c3-t7">
<p><code dir="ltr">log_251</code></p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r5c1-t7" headers="r1c1-t7">
<p><code dir="ltr">%S</code></p>
</td>
<td class="cellalignment431" headers="r5c1-t7 r1c2-t7">
<p>Log sequence number, left-zero-padded</p>
</td>
<td class="cellalignment431" headers="r5c1-t7 r1c3-t7">
<p><code dir="ltr">log_0000000251</code></p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r6c1-t7" headers="r1c1-t7">
<p><code dir="ltr">%t</code></p>
</td>
<td class="cellalignment431" headers="r6c1-t7 r1c2-t7">
<p>Thread number, not padded</p>
</td>
<td class="cellalignment431" headers="r6c1-t7 r1c3-t7">
<p><code dir="ltr">log_1</code></p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r7c1-t7" headers="r1c1-t7">
<p><code dir="ltr">%T</code></p>
</td>
<td class="cellalignment431" headers="r7c1-t7 r1c2-t7">
<p>Thread number, left-zero-padded</p>
</td>
<td class="cellalignment431" headers="r7c1-t7 r1c3-t7">
<p><code dir="ltr">log_0001</code></p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" -->
<p>All of the file name format parameters for the archive redo logs, in either upper or lowercase, are mandatory for Oracle RAC. These parameters enable Oracle Database to create unique names for archive logs across the incarnation. This requirement is in effect when the <code dir="ltr">COMPATIBLE</code> parameter is set to <code dir="ltr">10.0</code> or greater.</p>
<p>Use the <code dir="ltr">%R</code> or <code dir="ltr">%r</code> parameters to include the <code dir="ltr">resetlogs</code> identifier to avoid overwriting the logs from a previous incarnation. If you do not specify a log format, then the default is operating system-specific and includes <code dir="ltr">%t</code>, <code dir="ltr">%s</code>, and <code dir="ltr">%r</code>.</p>
<p>As an example, if the instance associated with redo thread number 1 sets <code dir="ltr">LOG_ARCHIVE_FORMAT</code> to <code dir="ltr">log_%t_%s_%r.arc</code>, then its archived redo log files are named:</p>
<pre dir="ltr">
log_1_1000_23435343.arc
log_1_1001_23452345.arc
log_1_1002_23452345.arc
...
</pre>
<div class="infoboxnotealso">
<p class="notep1"><span class="bold">See Also</span>:</p>
<a class="olink ADMIN008" href="../../server.112/e25494/archredo.htm#ADMIN008"><span class="italic">Oracle Database Administrator's Guide</span></a> about specifying the archived redo log filename format and destination, and Oracle Database platform-specific documentation about the default log archiving format and destination</div>
</div>
<!-- class="sect1" -->
<a id="i490858"></a>
<div id="RACAD322" class="sect1"><a id="BABBBGCI"></a>
<h2 class="sect1">RMAN Archiving Configuration Scenarios</h2>
<p>This section describes the archiving scenarios for an Oracle RAC database. The two configuration scenarios in this chapter describe a three-node UNIX cluster for an Oracle RAC database. For both scenarios, the <code dir="ltr">LOG_ARCHIVE_FORMAT</code> that you specify for the instance performing recovery must be the same as the format that you specified for the instances that archived the redo log files.</p>
<p>This section includes the following topics:</p>
<ul>
<li>
<p><a href="#i490879">Oracle Automatic Storage Management and Cluster File System Archiving Scheme</a></p>
</li>
<li>
<p><a href="#i490918">Noncluster File System Local Archiving Scheme</a></p>
</li>
</ul>
<a id="i490879"></a>
<div id="RACAD325" class="sect2">
<h3 class="sect2">Oracle Automatic Storage Management and Cluster File System Archiving Scheme</h3>
<p>The preferred configuration for Oracle RAC is to use Oracle Automatic Storage Management (<a id="sthref652"></a>Oracle ASM) for a recovery area using a disk group for your recovery set that is different from the disk group used for your data files. When you use Oracle ASM, it uses an Oracle Managed Files naming format.</p>
<p>Alternatively, you can use a <a id="sthref653"></a>cluster file system archiving scheme. If you use a cluster file system, then each node writes to a single location on the cluster file system when archiving the redo log files. Each node can read the archived redo log files of the other nodes. For example, as shown in <a href="#i490890">Figure 6-1</a>, if Node 1 archives a redo log file to <code dir="ltr">/arc_dest/log_1_100_23452345.arc</code> on the cluster file system, then any other node in the cluster can also read this file.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink BRADV" href="../../backup.112/e10642/toc.htm"><span class="italic">Oracle Database Backup and Recovery User's Guide</span></a> for more information about managing space in the recovery area and backing up archived redo logs with RMAN</div>
<div id="RACAD7694" class="figure">
<p class="titleinfigure"><a id="i490890"></a>Figure 6-1 Cluster File System Archiving Scheme</p>
<img width="321" height="275" src="img/racad006.eps" alt="Description of Figure 6-1 follows" /><br />
<a id="sthref654" href="img_text/racad006.htm">Description of "Figure 6-1 Cluster File System Archiving Scheme"</a><br />
<br /></div>
<!-- class="figure" -->
<div class="infobox-note">
<p class="notep1">Note:</p>
The archive log naming format in this example is only for a cluster file system example.</div>
<p>If you do not use a cluster file system, then the archived redo log files cannot be on raw devices. This is because raw devices do not enable sequential writing of consecutive archive log files.</p>
<div id="RACAD7324" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref655"></a>
<h4 class="sect3">Advantages of the Cluster File System Archiving Scheme</h4>
<p>The advantage of this scheme is that none of the nodes uses the network to archive logs. Because the file name written by a node can be read by any node in the cluster, RMAN can back up all logs from any node in the cluster. Backup and restore scripts are simplified because each node has access to all archived redo logs.</p>
</div>
<!-- class="sect3" -->
<div id="RACAD7325" class="sect3"><a id="sthref656"></a>
<h4 class="sect3">Initialization Parameter Settings for the Cluster File System Archiving Scheme</h4>
<p>In the <a id="sthref657"></a>cluster file system scheme, each node archives to a directory that is identified with the same name on all instances within the cluster database (<code dir="ltr">/arc_dest</code>, in the following example). To configure this directory, set values for the <code dir="ltr">LOG_ARCH_DEST_1</code> parameter, as shown in the following example:</p>
<pre dir="ltr">
*.LOG_ARCHIVE_DEST_1="LOCATION=/arc_dest"
</pre>
<p>The following list shows archived redo log entry examples that would appear in the RMAN catalog or in the control file based on the previous example. Note that any node can archive logs using any of the threads:</p>
<pre dir="ltr">
/arc_dest/log_1_999_23452345.arc
/arc_dest/log_1_1000_23435343.arc
/arc_dest/log_1_1001_23452345.arc &lt;- thread 1 archived in node3
/arc_dest/log_3_1563_23452345.arc &lt;- thread 3 archived in node2
/arc_dest/log_2_753_23452345.arc &lt;- thread 2 archived in node1
/arc_dest/log_2_754_23452345.arc
/arc_dest/log_3_1564_23452345.arc
</pre></div>
<!-- class="sect3" -->
<div id="RACAD7326" class="sect3"><a id="sthref658"></a>
<h4 class="sect3">Location of Archived Logs for the Cluster File System Archiving Scheme</h4>
<p>Because the file system is shared and because each node is writing its archived redo logs to the <code dir="ltr">/arc_dest</code> directory in the cluster file system, each node can read the logs written by itself and any other node.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i490918"></a>
<div id="RACAD324" class="sect2">
<h3 class="sect2">Noncluster File System Local Archiving Scheme</h3>
<p>When archiving locally to a <a id="sthref659"></a><a id="sthref660"></a>noncluster file system, each node archives to a uniquely named local directory. If recovery is required, then you can configure the recovery node so that it can access directories on the other nodes remotely. For example, use NFS on Linux and UNIX computers, or mapped drives on Windows systems. Therefore, each node writes only to a local destination, but each node can also read archived redo log files in remote directories on the other nodes.</p>
<div id="RACAD7327" class="sect3"><a id="sthref661"></a>
<h4 class="sect3">Considerations for Using Noncluster File System Local Archiving</h4>
<p>If you use noncluster file system local archiving for media recovery, then you must configure the node that is performing recovery for remote access to the other nodes so that it can read the archived redo log files in the archive directories on the other nodes. In addition, if you are performing recovery and you do not have all of the available archive logs, then you must perform an incomplete recovery up to the first missing archived redo log sequence number. You do not have to use a specific configuration for this scheme. However, to distribute the backup processing onto multiple nodes, the easiest method is to configure channels as described in the backup scenarios in <a href="backup.htm#g494903">Chapter 7, "Managing Backup and Recovery"</a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Because different file systems are used in a noncluster case, the archive log directories must be unique on each node. For example, <code dir="ltr">/arc_dest_1</code> is only available on <code dir="ltr">node1</code>, <code dir="ltr">/arc_dest_2</code> is only directly mounted on <code dir="ltr">node2</code>, and so on.
<p>Then <code dir="ltr">node1</code> mounts <code dir="ltr">/arc_dest_2</code> from <code dir="ltr">node2</code> and <code dir="ltr">/arc_dest_3</code> from <code dir="ltr">node3</code> through NFS.</p>
</div>
</div>
<!-- class="sect3" -->
<div id="RACAD7328" class="sect3"><a id="sthref662"></a>
<h4 class="sect3">Initialization Parameter Settings<a id="sthref663"></a> for Noncluster File System Local Archiving</h4>
<p>You can set the archiving destination values as follows in the initialization parameter file for either policy-managed or administrator-managed databases.</p>
<p>Set the the <code dir="ltr"><span class="codeinlineitalic">SID</span></code><code dir="ltr">.LOG_ARCH_DEST</code> parameter for each instance using the SID designator, as shown in the following example:</p>
<pre dir="ltr">
sid1.LOG_ARCHIVE_DEST_1="LOCATION=/arc_dest_1"
sid2.LOG_ARCHIVE_DEST_1="LOCATION=/arc_dest_2"
sid3.LOG_ARCHIVE_DEST_1="LOCATION=/arc_dest_3"
</pre>
<p>For policy-managed databases, manually create a node and instance binding to ensure that <code dir="ltr">sid1</code> always runs on the same node, as follows:</p>
<pre dir="ltr">
$ srvctl modify database -d mydb -n node1 -i sid1
$ srvctl modify database -d mydb -n node2 -i sid2
$ srvctl modify database -d mydb -n node3 -i sid3
</pre>
<p>The following list shows the possible archived redo log entries in the database control file. Note that any node can read archived redo logs from any of the threads, which must happen in order for the database to recover after a failure.</p>
<pre dir="ltr">
/arc_dest_1/log_1_1000_23435343.arc
/arc_dest_2/log_1_1001_23452345.arc &lt;- thread 1 archived in node2
/arc_dest_2/log_3_1563_23452345.arc &lt;- thread 3 archived in node2
/arc_dest_1/log_2_753_23452345.arc &lt;- thread 2 archived in node1
/arc_dest_2/log_2_754_23452345.arc
/arc_dest_3/log_3_1564_23452345.arc
</pre></div>
<!-- class="sect3" -->
<div id="RACAD7329" class="sect3"><a id="sthref664"></a>
<h4 class="sect3">Location of Archived Logs for Noncluster File System Local Archiving</h4>
<p>As illustrated in <a href="#CIHFAGAI">Table 6-2</a>, each of three nodes has a directory containing the locally archived redo logs. Additionally, if you mount directories on the other nodes remotely through NFS or mapped drives, then each node has two remote directories through which RMAN can read the archived redo log files that are archived by the remaining nodes.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The archive log destinations, similar to those shown in <a href="#CIHFAGAI">Table 6-2</a>, must be different on each node so that if you mount the NFS directory on a different node, then it does not conflict with an existing archive log directory</div>
<div id="RACAD7695" class="tblruleformal">
<p class="titleintable"><a id="sthref665"></a><a id="CIHFAGAI"></a>Table 6-2 UNIX/NFS Location Log Examples, Noncluster File System Local Archiving</p>
<table class="cellalignment432" title="UNIX/NFS Location Log Examples, Noncluster File System Local Archiving" summary="Location of Logs for Non-Cluster File System Local Archiving" dir="ltr">
<thead>
<tr class="cellalignment423">
<th class="cellalignment430" id="r1c1-t13">Node</th>
<th class="cellalignment430" id="r1c2-t13">Reads the archived redo log files in the directory</th>
<th class="cellalignment430" id="r1c3-t13">For logs archived by node</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment423">
<td class="cellalignment431" id="r2c1-t13" headers="r1c1-t13">
<p>1</p>
</td>
<td class="cellalignment431" headers="r2c1-t13 r1c2-t13">
<p><code dir="ltr">/arc_dest_1</code></p>
</td>
<td class="cellalignment431" headers="r2c1-t13 r1c3-t13">
<p>1</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r3c1-t13" headers="r1c1-t13">
<p>1</p>
</td>
<td class="cellalignment431" headers="r3c1-t13 r1c2-t13">
<p><code dir="ltr">/arc_dest_2</code></p>
</td>
<td class="cellalignment431" headers="r3c1-t13 r1c3-t13">
<p>2 (through NFS)</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r4c1-t13" headers="r1c1-t13">
<p>1</p>
</td>
<td class="cellalignment431" headers="r4c1-t13 r1c2-t13">
<p><code dir="ltr">/arc_dest_3</code></p>
</td>
<td class="cellalignment431" headers="r4c1-t13 r1c3-t13">
<p>3 (through NFS)</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r5c1-t13" headers="r1c1-t13">
<p>2</p>
</td>
<td class="cellalignment431" headers="r5c1-t13 r1c2-t13">
<p><code dir="ltr">/arc_dest_1</code></p>
</td>
<td class="cellalignment431" headers="r5c1-t13 r1c3-t13">
<p>1 (through NFS)</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r6c1-t13" headers="r1c1-t13">
<p>2</p>
</td>
<td class="cellalignment431" headers="r6c1-t13 r1c2-t13">
<p><code dir="ltr">/arc_dest_2</code></p>
</td>
<td class="cellalignment431" headers="r6c1-t13 r1c3-t13">
<p>2</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r7c1-t13" headers="r1c1-t13">
<p>2</p>
</td>
<td class="cellalignment431" headers="r7c1-t13 r1c2-t13">
<p><code dir="ltr">/arc_dest_3</code></p>
</td>
<td class="cellalignment431" headers="r7c1-t13 r1c3-t13">
<p>3 (through NFS)</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r8c1-t13" headers="r1c1-t13">
<p>3</p>
</td>
<td class="cellalignment431" headers="r8c1-t13 r1c2-t13">
<p><code dir="ltr">/arc_dest_1</code></p>
</td>
<td class="cellalignment431" headers="r8c1-t13 r1c3-t13">
<p>1 (through NFS)</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r9c1-t13" headers="r1c1-t13">
<p>3</p>
</td>
<td class="cellalignment431" headers="r9c1-t13 r1c2-t13">
<p><code dir="ltr">/arc_dest_2</code></p>
</td>
<td class="cellalignment431" headers="r9c1-t13 r1c3-t13">
<p>2 (through NFS)</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r10c1-t13" headers="r1c1-t13">
<p>3</p>
</td>
<td class="cellalignment431" headers="r10c1-t13 r1c2-t13">
<p><code dir="ltr">/arc_dest_3</code></p>
</td>
<td class="cellalignment431" headers="r10c1-t13 r1c3-t13">
<p>3</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" --></div>
<!-- class="sect3" -->
<div id="RACAD7330" class="sect3"><a id="sthref666"></a>
<h4 class="sect3">File System Configuration for Noncluster File System Local Archiving</h4>
<p>If you are performing recovery and a surviving instance must read all of the logs that are on disk but not yet backed up, then you should configure NFS as shown in <a href="#g493918">Table 6-3</a>.</p>
<div id="RACAD7696" class="tblruleformal">
<p class="titleintable"><a id="sthref667"></a><a id="g493918"></a>Table 6-3 UNIX/NFS Configuration for Shared Read Local Archiving Examples</p>
<table class="cellalignment432" title="UNIX/NFS Configuration for Shared Read Local Archiving Examples " summary="NFS Configuration for Shared Read Local Archiving" dir="ltr">
<thead>
<tr class="cellalignment423">
<th class="cellalignment430" id="r1c1-t14">Node</th>
<th class="cellalignment430" id="r1c2-t14">Directory...</th>
<th class="cellalignment430" id="r1c3-t14">Is configured...</th>
<th class="cellalignment430" id="r1c4-t14">And mounted on...</th>
<th class="cellalignment430" id="r1c5-t14">On node...</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment423">
<td class="cellalignment431" id="r2c1-t14" headers="r1c1-t14">
<p>1</p>
</td>
<td class="cellalignment431" headers="r2c1-t14 r1c2-t14">
<p><code dir="ltr">/arc_dest_1</code></p>
</td>
<td class="cellalignment431" headers="r2c1-t14 r1c3-t14">
<p>Local read/write</p>
</td>
<td class="cellalignment431" headers="r2c1-t14 r1c4-t14">
<p>n/a</p>
</td>
<td class="cellalignment431" headers="r2c1-t14 r1c5-t14">
<p>n/a</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r3c1-t14" headers="r1c1-t14">
<p>1</p>
</td>
<td class="cellalignment431" headers="r3c1-t14 r1c2-t14">
<p><code dir="ltr">/arc_dest_2</code></p>
</td>
<td class="cellalignment431" headers="r3c1-t14 r1c3-t14">
<p>NFS read</p>
</td>
<td class="cellalignment431" headers="r3c1-t14 r1c4-t14">
<p><code dir="ltr">/arc_dest_2</code></p>
</td>
<td class="cellalignment431" headers="r3c1-t14 r1c5-t14">
<p>2</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r4c1-t14" headers="r1c1-t14">
<p>1</p>
</td>
<td class="cellalignment431" headers="r4c1-t14 r1c2-t14">
<p><code dir="ltr">/arc_dest_3</code></p>
</td>
<td class="cellalignment431" headers="r4c1-t14 r1c3-t14">
<p>NFS read</p>
</td>
<td class="cellalignment431" headers="r4c1-t14 r1c4-t14">
<p><code dir="ltr">/arc_dest_3</code></p>
</td>
<td class="cellalignment431" headers="r4c1-t14 r1c5-t14">
<p>3</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r5c1-t14" headers="r1c1-t14">
<p>2</p>
</td>
<td class="cellalignment431" headers="r5c1-t14 r1c2-t14">
<p><code dir="ltr">/arc_dest_1</code></p>
</td>
<td class="cellalignment431" headers="r5c1-t14 r1c3-t14">
<p>NFS read</p>
</td>
<td class="cellalignment431" headers="r5c1-t14 r1c4-t14">
<p><code dir="ltr">/arc_dest_1</code></p>
</td>
<td class="cellalignment431" headers="r5c1-t14 r1c5-t14">
<p>1</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r6c1-t14" headers="r1c1-t14">
<p>2</p>
</td>
<td class="cellalignment431" headers="r6c1-t14 r1c2-t14">
<p><code dir="ltr">/arc_dest_2</code></p>
</td>
<td class="cellalignment431" headers="r6c1-t14 r1c3-t14">
<p>Local read/write</p>
</td>
<td class="cellalignment431" headers="r6c1-t14 r1c4-t14">
<p>n/a</p>
</td>
<td class="cellalignment431" headers="r6c1-t14 r1c5-t14">
<p>n/a</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r7c1-t14" headers="r1c1-t14">
<p>2</p>
</td>
<td class="cellalignment431" headers="r7c1-t14 r1c2-t14">
<p><code dir="ltr">/arc_dest_3</code></p>
</td>
<td class="cellalignment431" headers="r7c1-t14 r1c3-t14">
<p>NFS read</p>
</td>
<td class="cellalignment431" headers="r7c1-t14 r1c4-t14">
<p><code dir="ltr">/arc_dest_3</code></p>
</td>
<td class="cellalignment431" headers="r7c1-t14 r1c5-t14">
<p>3</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r8c1-t14" headers="r1c1-t14">
<p>3</p>
</td>
<td class="cellalignment431" headers="r8c1-t14 r1c2-t14">
<p><code dir="ltr">/arc_dest_1</code></p>
</td>
<td class="cellalignment431" headers="r8c1-t14 r1c3-t14">
<p>NFS read</p>
</td>
<td class="cellalignment431" headers="r8c1-t14 r1c4-t14">
<p><code dir="ltr">/arc_dest_1</code></p>
</td>
<td class="cellalignment431" headers="r8c1-t14 r1c5-t14">
<p>1</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r9c1-t14" headers="r1c1-t14">
<p>3</p>
</td>
<td class="cellalignment431" headers="r9c1-t14 r1c2-t14">
<p><code dir="ltr">/arc_dest_2</code></p>
</td>
<td class="cellalignment431" headers="r9c1-t14 r1c3-t14">
<p>NFS read</p>
</td>
<td class="cellalignment431" headers="r9c1-t14 r1c4-t14">
<p><code dir="ltr">/arc_dest_2</code></p>
</td>
<td class="cellalignment431" headers="r9c1-t14 r1c5-t14">
<p>2</p>
</td>
</tr>
<tr class="cellalignment423">
<td class="cellalignment431" id="r10c1-t14" headers="r1c1-t14">
<p>3</p>
</td>
<td class="cellalignment431" headers="r10c1-t14 r1c2-t14">
<p><code dir="ltr">/arc_dest_3</code></p>
</td>
<td class="cellalignment431" headers="r10c1-t14 r1c3-t14">
<p>Local read/write</p>
</td>
<td class="cellalignment431" headers="r10c1-t14 r1c4-t14">
<p>n/a</p>
</td>
<td class="cellalignment431" headers="r10c1-t14 r1c5-t14">
<p>n/a</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" -->
<div class="infobox-note">
<p class="notep1">Note:</p>
Windows users can achieve the same results depicted in the examples in this section by using mapped drives.</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i491266"></a>
<div id="RACAD855" class="sect1">
<h2 class="sect1">Monitoring the <a id="sthref668"></a><a id="sthref669"></a>Archiver Processes</h2>
<p>After your RMAN configuration is operative in your Oracle RAC environment, use the <code dir="ltr">GV$ARCHIVE_PROCESSES</code> and <code dir="ltr">V$ARCHIVE_PROCESSES</code> views to determine the status of the archiver processes. Depending on whether you query the global or local views, these views display information for all database instances, or for only the instance to which you are connected.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you use the <code dir="ltr">kill</code> command to stop the archiver process, then the database instance will fail.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ADMIN11332" href="../../server.112/e25494/archredo.htm#ADMIN11332"><span class="italic">Oracle Database Administrator's Guide</span></a> for more information about the archiver processes</p>
</li>
<li>
<p><a class="olink REFRN" href="../../server.112/e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a> for more information about the database views</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment422">
<tr>
<td class="cellalignment431">
<table class="cellalignment427">
<tr>
<td class="cellalignment426"><a href="hafeats.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment426"><a href="backup.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment434">
<table class="cellalignment425">
<tr>
<td class="cellalignment426"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment426"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment426"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment426"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment426"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment426"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
