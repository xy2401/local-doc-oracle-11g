<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Securing Data</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 743" />
<meta name="dcterms.created" content="2013-11-26T15:10:6Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database 2 Day + Security Guide" />
<meta name="dcterms.identifier" content="E10575-09" />
<meta name="dcterms.isVersionOf" content="TDPSG" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2006, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="tdpsg_network_secure.htm" title="Previous" type="text/html" />
<link rel="Next" href="tdpsg_auditing.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10575.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">10/12</span> <!-- End Header -->
<script  >
<!-- // <![CDATA[
window.name='tdpsg_securing_data'
// ]]> -->
</script> <script  >
// <![CDATA[
function footdisplay(footnum,footnote) {
    var msg = window.open('', 'NewWindow' + footnum,
        'directories=no,height=120,location=no,menubar=no,resizable=yes,' +
        'scrollbars=yes,status=no,toolbar=no,width=598');
    msg.document.open('text/html');
    msg.document.write('<!DOCTYPE html ');
    msg.document.write('PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" ');

    msg.document.write('"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">');
    msg.document.write('<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>');
    msg.document.write('Footnote ' + footnum);
    msg.document.write('<\/title><meta http-equiv="Content-Type" ');
    msg.document.write('content="text/html; charset=utf-8" />');
    msg.document.write('');
    msg.document.write('<style> <![CDATA[ ');
    msg.document.write('h1 {text-align: center; font-size: 14pt;}');
    msg.document.write('fieldset {border: none;}');
    msg.document.write('form {text-align: center;}');
    msg.document.write(' ]]\u003e <\/style>');
    msg.document.write('<\/head><body><h1>Footnote ' + footnum + '<\/h1><p>');
    msg.document.write(footnote);
    msg.document.write('<\/p><form action="" method="post"><fieldset>');
    msg.document.write('<input type="button" value="OK" ');
    msg.document.write('onclick="window.close();" />');
    msg.document.write('<\/fieldset><\/form><\/body><\/html>');
    msg.document.close();
    msg.focus();
}
// ]]>
</script> <noscript>
<p>The script content on this page is for navigation purposes only and does not alter the content in any way.</p>
</noscript>
<div id="TDPSG40000" class="chapter"><a id="CHDFJGID"></a>
<h1 class="chapter"><span class="secnum">6</span> Securing Data</h1>
<p>This chapter contains:</p>
<ul>
<li>
<p><a href="#CIAFAFJD">About Securing Data</a></p>
</li>
<li>
<p><a href="#CHDCGGBH">Encrypting Data Transparently with Transparent Data Encryption</a></p>
</li>
<li>
<p><a href="#BGBFGAJJ">Choosing Between Oracle Virtual Private Database and Oracle Label Security</a></p>
</li>
<li>
<p><a href="#CHDBICEI">Controlling Data Access with Oracle Virtual Private Database</a></p>
</li>
<li>
<p><a href="#CHDBIIGG">Enforcing Row-Level Security with Oracle Label Security</a></p>
</li>
<li>
<p><a href="#CIADFEAG">Controlling Administrator Access with Oracle Database Vault</a></p>
</li>
</ul>
<a id="CIAFAFJD"></a>
<div id="TDPSG30041" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">About Securing Data</h2>
<p>Oracle Database provides many ways to secure data. This chapter describes the following methods that you can use to secure data on your site:</p>
<ul>
<li>
<p><span class="bold">Transparent data encryption.</span> Transparent data encryption encrypts data in one or more database table columns, or it can encrypt an entire tablespace. Transparent data encryption is the quickest and easiest way to encrypt data. Transparent data encryption supports the Advanced Encryption Standard (AES) and Triple Data Encryption Standard (3DES) algorithms.</p>
<p>You can also encrypt data on the network. <a href="tdpsg_network_secure.htm#CHDHFHIE">"Protecting Data on the Network by Using Network Encryption"</a> explains how.</p>
</li>
<li>
<p><span class="bold">Oracle Virtual Private Database (VPD).</span> This feature restricts row and column level data access by creating a policy that enforces a <code>WHERE</code> clause for all SQL statements that query the database. You create and manage the VPD policy at the database table or view level, which means that you do not modify the applications that access the database.</p>
</li>
<li>
<p><span class="bold">Oracle Label Security (OLS).</span> This feature secures your database tables at the row level, and assigns these rows different levels of security based on security labels. You then create a security authorization for users based on the OLS labels.</p>
</li>
<li>
<p><span class="bold">Oracle Database Vault.</span> This feature enables you to restrict administrator access to your databases, enforce separation of duty, and control who, when, where and how applications, databases, and data are accessed.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="CHDCGGBH"></a>
<div id="TDPSG40043" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Encrypting Data Transparently with Transparent Data Encryption</h2>
<p>Transparent data encryption enables you to quickly encrypt one or more table columns or a tablespace. It is easy to implement and has many advantages over other types of database encryption.</p>
<p>This section contains:</p>
<ul>
<li>
<p><a href="#CHDGHADI">About Encrypting Sensitive Data</a></p>
</li>
<li>
<p><a href="#CHDCEDEJ">When Should You Encrypt Data?</a></p>
</li>
<li>
<p><a href="#CHDGJHGE">How Transparent Data Encryption Works</a></p>
</li>
<li>
<p><a href="#CHDBHJEG">Configuring Data to Use Transparent Data Encryption</a></p>
</li>
<li>
<p><a href="#CHDFHHJB">Checking Existing Encrypted Data</a></p>
</li>
</ul>
<a id="CHDGHADI"></a>
<div id="TDPSG40041" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Encrypting Sensitive Data</h3>
<p><a id="sthref348"></a>Encrypted data can only be read by its recipient. You use encryption to protect data in a potentially unprotected environment, such as data you have placed on backup media that is sent to an offsite storage location.</p>
<p><a id="sthref349"></a>The encryption data includes the following components:</p>
<ul>
<li>
<p><span class="bold">An algorithm to encrypt the data.</span> The encryption algorithm is used by Oracle databases to encrypt data. Oracle Database supports several industry-standard encryption and hashing algorithms, including the Advanced Encryption Standard (AES) encryption algorithm, which has been approved by the National Institute of Standards and Technology (NIST).</p>
</li>
<li>
<p><span class="bold">A key to encrypt and decrypt data.</span> When you encrypt data, Oracle Database uses the key and clear text data as input into the encryption algorithm. Conversely, when you decrypt data, the key is used as input into the algorithm to reverse the process and retrieve the clear text data. Oracle Database uses a symmetric encryption key to perform this task, in which the same key is used to both encrypt and decrypt the data. The encryption key is stored in the data dictionary, but encrypted with another master key.</p>
</li>
</ul>
<p>As mentioned earlier, you can encrypt individual table columns or an entire tablespace. Be careful that you do not mix the two. For example, suppose you encrypt a table column and then encrypt its surrounding tablespace. This double encryption can cause performance problems. In addition, column encryption has limitations in data type support, and only supports B-tree indexes for equality searches. To check the current encrypted settings, you can query the <code>V$ENCRYPTED_TABLESPACES</code> data dictionary view for tablespaces, and the <code>DBA_ENCRYPTED_COLUMNS</code> view for encrypted columns.</p>
</div>
<!-- class="sect2" -->
<a id="CHDCEDEJ"></a>
<div id="TDPSG40042" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">When Should You Encrypt Data?</h3>
<p><a id="sthref350"></a><a id="sthref351"></a>In most cases, you encrypt sensitive data on your site to meet a regulatory compliance. For example, sensitive data such as credit card numbers, Social Security numbers, or patient health information must be encrypted.</p>
<p>Historically, users have wanted to encrypt data because they want to restrict data access from their database administrators. However, this problem is more of an <a id="sthref352"></a>access control problem, not an encryption problem. You can address this problem by using Oracle Database Vault to control the access to your application data from database administrators.</p>
<p>In most cases, you encrypt sensitive data such as credit cards, and Social Security numbers to prevent access when backup tapes or disk drives are lost or stolen. In recent years industry regulations such as the Payment Card Industry (PCI) Data Security Standard and the Healthcare Insurance Portability and Accountability Act (HIPAA) have become a driving factor behind increased usage of encryption for protecting credit card and health care information, respectively.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink DBSEG80083" href="../../network.112/e36292/data_encryption.htm#DBSEG80083"><span class="italic">Oracle Database Security Guide</span></a> for common misconceptions about encrypting stored data</div>
</div>
<!-- class="sect2" -->
<a id="CHDGJHGE"></a>
<div id="TDPSG40431" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">How Transparent Data Encryption Works</h3>
<p><a id="sthref353"></a>Transparent data encryption enables you to encrypt individual table columns or an entire tablespace. When a user inserts data into an encrypted column, transparent data encryption automatically encrypts the data. When users select the column, the data is automatically decrypted.</p>
<p><a id="sthref354"></a>To encrypt data by using transparent data encryption, you create the following components:</p>
<ul>
<li>
<p><span class="bold">A wallet to store the master encryption key.</span> The wallet is an operating system file located outside the database. The database uses the wallet to store the master encryption key. To create the wallet, you can use Enterprise Manager or the <code>ALTER SYSTEM</code> command. The wallet is encrypted using a password as the encryption key. You create the password when you create the wallet. Access to the contents (or master key) of the wallet is thus restricted to only those who know the password. After the wallet is created, you must open the wallet using the password so that the database can access the master encryption key.</p>
</li>
<li>
<p><span class="bold">A location for the wallet.</span> You can specify the wallet location in the <code>sqlnet.ora</code> file.</p>
</li>
</ul>
<p><a id="sthref355"></a>Afterward, when a user enters data, Oracle Database performs the following steps:</p>
<ol>
<li>
<p>Retrieves the master key from the wallet.</p>
</li>
<li>
<p>Decrypts the encryption key using the master key.</p>
</li>
<li>
<p>Uses the encryption key to encrypt the data the user entered.</p>
</li>
<li>
<p>Stores the data in encrypted format in the database.</p>
</li>
</ol>
<p>If the user is selecting data, the process is similar: Oracle Database decrypts the data and then displays it in clear text format.</p>
<p><a id="sthref356"></a>Transparent data encryption has the following advantages:</p>
<ul>
<li>
<p>As a security administrator, you can be sure that sensitive data is safe if the storage media or data file is stolen or lost.</p>
</li>
<li>
<p>Implementing transparent data encryption helps you address security-related regulatory compliance issues.</p>
</li>
<li>
<p>Data from tables is transparently decrypted for the database user. You do not need to create triggers or views to decrypt data.</p>
</li>
<li>
<p>Database users need not be aware of the fact that the data they are accessing is stored in encrypted form. Data is transparently decrypted for the database users and does not require any action on their part.</p>
</li>
<li>
<p>Applications need not be modified to handle encrypted data. Data encryption and decryption is managed by the database.</p>
</li>
</ul>
<p><a id="sthref357"></a>Transparent data encryption has a minimal impact on performance. Transparent data encryption column encryption affects performance only when data is retrieved from or inserted into an encrypted column. There is no impact on performance for operations involving unencrypted columns, even if these columns are in a table containing encrypted columns. However, be aware that encrypted data needs more <a id="sthref358"></a>storage space than clear text data. On average, encrypting a single column requires between 32 and 48 bytes of additional storage for each row. Transparent tablespace encryption provides even better performance because Oracle Database performs the encryption and decryption at the I/O block layer. Once blocks are decrypted, they are cached in Oracle Database memory for optimal performance.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ASOAG600" href="../../network.112/e40393/asotrans.htm#ASOAG600"><span class="italic">Oracle Database Advanced Security Administrator's Guide</span></a> for detailed information about using Transparent Data Encryption</div>
</div>
<!-- class="sect2" -->
<a id="CHDBHJEG"></a>
<div id="TDPSG40432" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Configuring Data to Use Transparent Data Encryption</h3>
<p><a id="sthref359"></a>To start using transparent data encryption, you must create a wallet and set a master key. The wallet can be the default database wallet shared with other Oracle Database components, or a separate wallet specifically used by transparent data encryption. Oracle recommends that you use a separate wallet to store the master encryption key. This wallet will be used for all data that is being encrypted through transparent data encryption.</p>
<p>You follow these steps to configure table columns to use transparent data encryption:</p>
<ul>
<li>
<p><a href="#CHDIBDBE">Step 1: Configure the Wallet Location</a></p>
</li>
<li>
<p><a href="#CHDCFBGA">Step 2: Create the Wallet</a></p>
</li>
<li>
<p><a href="#CHDFHEBC">Step 3: Open (or Close) the Wallet</a></p>
</li>
<li>
<p><a href="#CHDFFFIA">Step 4: Encrypt (or Decrypt) Data</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ASOAG620" href="../../network.112/e40393/asotrans.htm#ASOAG620"><span class="italic">Oracle Database Advanced Security Administrator's Guide</span></a> for detailed information about using tablespace encryption</div>
<a id="CHDIBDBE"></a>
<div id="TDPSG44321" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 1: Configure the Wallet Location</h4>
<p>You <a id="sthref360"></a>designate the directory location for the wallet in the <code>sqlnet.ora</code> file. You perform this step once.</p>
<p class="orderedlisttitle">To configure the wallet location: &nbsp;</p>
<ol>
<li>
<p>Create a directory in the <code>$ORACLE_HOME</code> directory in which to store the wallet.</p>
<p>For example, create a directory called <code>ORA_WALLETS</code> in the <code>C:\oracle\product\11.2.0\db_1</code> directory.</p>
</li>
<li>
<p>Create a backup copy of the <code>sqlnet.ora</code> file, which by default is located in the <code>$ORACLE_HOME/network/admin</code> directory.</p>
</li>
<li>
<p>At the end of the <code>sqlnet.ora</code> file, add code similar to the following, where <code>ORA_WALLETS</code> is the name of the directory where you plan to store the wallet:</p>
<pre>
ENCRYPTION_WALLET_LOCATION=
 (SOURCE=
  (METHOD=file)
   (METHOD_DATA=
    (DIRECTORY=C:\oracle\product\11.2.0\db_1\ORA_WALLETS)))
</pre></li>
<li>
<p>Save and close the <code>sqlnet.ora</code> file.</p>
</li>
<li>
<p>If the compatibility <a id="sthref362"></a>of the database is set to a release earlier than Oracle Database Release 10.2, then restart the database.</p>
<ol>
<li>
<p>Log in to SQL*Plus and then check the database compatibility.</p>
<pre>
sqlplus sys as sysdba
Enter password: <span class="italic">password</span>
</pre>
<p>SQL*Plus starts, connects to the default database, and then displays a <code>SQL&gt;</code> prompt.</p>
<p>For detailed information about starting SQL*Plus, see <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a>.</p>
</li>
<li>
<p>Check the value of the <code>COMPATIBLE</code> parameter.</p>
<pre>
SHOW PARAMETER COMPATIBLE

NAME                       TYPE           VALUE
-------------------------- -------------- --------------------
compatible                 string         11.2.0
</pre></li>
<li>
<p>If the value is greater than 10.2, then you can go to <a href="#CHDCFBGA">Step 2: Create the Wallet</a>. If the value is less than 10.2, then restart the database as follows.</p>
<pre>
SHUTDOWN IMMEDIATE
STARTUP
</pre></li>
</ol>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDCFBGA"></a>
<div id="TDPSG44322" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 2: Create the Wallet</h4>
<p><a id="sthref363"></a><a id="sthref364"></a>To create the wallet, use the <code>ALTER SYSTEM</code> SQL statement. By default, the Oracle wallet stores a history of retired master keys, which enables you to change them and still be able to decrypt data that was encrypted under an old master key. A case-sensitive wallet password unknown to the database administrator provides separation of duty: The database administrator might be able to restart the database, but the wallet is closed and must be manually opened by a security administrator before the database can encrypt or decrypt the data.</p>
<p class="orderedlisttitle">To create the wallet: &nbsp;</p>
<ol>
<li>
<p>In SQL*Plus, connect as a user with administrative privileges, such as <code>SYS</code>, or as a security administrator.</p>
<p>For example:</p>
<pre>
CONNECT SYSTEM
Enter password: <span class="italic">password</span>
</pre></li>
<li>
<p>Enter the following <code>ALTER SYSTEM</code> statement, where password is the <code><span class="codeinlineitalic">password</span></code> you want to use to protect the Oracle wallet:</p>
<pre>
ALTER SYSTEM SET ENCRYPTION KEY IDENTIFIED BY "<span class="italic">password</span>";
</pre>
<p>Enclose the password in double quotation marks. As with other passwords that you create in Oracle Database, the password does not appear in clear text or in any dynamic views or logs.</p>
<p>This statement generates the wallet with a new encryption key and sets it as the current transparent data encryption master key. If you plan to use public key infrastructure (PKI) to configure the master encryption key, then specify a certificate ID, which is an optional string that contains the unique identifier of a certificate stored in the Oracle wallet. Use the following syntax:</p>
<pre>
ALTER SYSTEM SET ENCRYPTION KEY <span class="italic">certificate_ID</span> IDENTIFIED BY "<span class="italic">password</span>";
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDFHEBC"></a>
<div id="TDPSG44323" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 3: Open (or Close) the Wallet</h4>
<p>Immediately after you create the wallet key, the wallet is open, and you are ready to start encrypting data. However, if you have restarted the database after you created the wallet, you must manually open the wallet before you can use transparent data encryption.</p>
<p class="itemizedlisttitle">To open the wallet: &nbsp;</p>
<ul>
<li>
<p>In SQL*Plus, enter the following <code>ALTER SYSTEM</code> statement, where password is the <code><span class="codeinlineitalic">password</span></code> you use to protect the wallet:</p>
<pre>
ALTER SYSTEM SET ENCRYPTION WALLET OPEN IDENTIFIED BY "<span class="italic">password</span>";
</pre></li>
</ul>
<p>You must inclose the password in quotation marks.</p>
<p>In most cases, leave the wallet open unless you have a reason for closing it. You can close the wallet to disable access to the master key and prevent access to the encrypted columns. The wallet must be open for transparent data encryption to work. To reopen the wallet, use the <code>ALTER SYSTEM SET WALLET OPEN IDENTIFIED BY</code> <code><span class="codeinlineitalic">password</span></code> statement.</p>
<p class="itemizedlisttitle">To close the wallet: <a id="sthref368"></a>&nbsp;</p>
<ul>
<li>
<p>In SQL*Plus, enter the following statement, and ensure that you enclose the password in quotation marks:</p>
<pre>
ALTER SYSTEM SET ENCRYPTION WALLET CLOSE IDENTIFIED BY "<span class="italic">password</span>";
</pre></li>
</ul>
</div>
<!-- class="sect3" -->
<a id="CHDFFFIA"></a>
<div id="TDPSG44324" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 4: Encrypt (or Decrypt) Data</h4>
<p>After you have created a directory location for the wallet in the <code>sqlnet.ora</code> file and created the wallet itself, you are ready to encrypt either individual table columns or an entire tablespace.</p>
<p>This section contains the following topics:</p>
<ul>
<li>
<p><a href="#CHDHFDID">Encrypting Individual Table Columns</a></p>
</li>
<li>
<p><a href="#CHDHHHFH">Encrypting a Tablespace</a></p>
</li>
</ul>
<a id="CHDHFDID"></a>
<div id="TDPSG44325" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4">Encrypting Individual Table Columns</h5>
<p>The <a id="sthref369"></a>decisions that you make when you identify columns to be encrypted are determined by governmental security regulations, such as California Senate Bill 1386, or by industry standards such as the Payment Card Industry (PCI) Data Security Standard. Credit card numbers, Social Security numbers, and other personally identifiable information (PII) fall under this category. Another need for encryption is defined by your own internal security policies &mdash; trade secrets, research results, or employee salaries and bonuses. See <a href="#CHDCEDEJ">"When Should You Encrypt Data?"</a> for guidelines about when and when not to encrypt data.</p>
<p>Follow these guidelines when you select columns to encrypt:</p>
<ul>
<li>
<p><span class="bold">Check the data types of the columns you plan to encrypt.</span> Transparent data encryption supports the following data types:</p>
<div class="inftblsimple">
<table class="cellalignment1886" title="Supported Data Types for TDE" summary="List of supported data types, from top to bottom, left to right" >
<tbody>
<tr class="cellalignment1875">
<td class="cellalignment1883">&nbsp;</td>
<td class="cellalignment1883"><code>BINARY_FLOAT</code></td>
<td class="cellalignment1883"><code>NUMBER</code></td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883">&nbsp;</td>
<td class="cellalignment1883"><code>BINARY_DOUBLE</code></td>
<td class="cellalignment1883"><code>NVARCHAR2</code></td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883">&nbsp;</td>
<td class="cellalignment1883"><code>CHAR</code></td>
<td class="cellalignment1883"><code>RAW</code></td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883">&nbsp;</td>
<td class="cellalignment1883"><code>DATE</code></td>
<td class="cellalignment1883"><code>TIMESTAMP</code></td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883">&nbsp;</td>
<td class="cellalignment1883"><code>NCHAR</code></td>
<td class="cellalignment1883"><code>VARCHAR2</code></td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883">&nbsp;</td>
<td class="cellalignment1883">Large object types (LOBs) such as <code>BLOB</code> and <code>CLOB</code><a id="sthref370" href="#sthref370" onclick='footdisplay(1,"You cannot encrypt external LOBs (\u003ccode\u003eBFILE\u003c/code\u003e).")'><sup class="tablefootnote">Foot&nbsp;1&nbsp;</sup></a></td>
<td class="cellalignment1883">&nbsp;</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblsimple" -->
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;1&nbsp;</sup>You cannot encrypt external LOBs (<code>BFILE</code>).</p>
</li>
<li>
<p><span class="bold">Ensure that the columns you select are not part of a foreign key.</span> With transparent data encryption, each table has its own encryption key, which is stored in the database data dictionary and encrypted with the external master key. Encrypted columns cannot be used as foreign keys.</p>
</li>
</ul>
<p class="orderedlisttitle">To encrypt a column in a table: &nbsp;</p>
<ol>
<li>
<p>Ensure that you have created and opened a wallet key.</p>
<p><a href="#CHDCFBGA">"Step 2: Create the Wallet"</a> explains how to create a wallet key. To open an existing wallet key, see <a href="#CHDFHEBC">"Step 3: Open (or Close) the Wallet"</a>.</p>
</li>
<li>
<p>Start Database Control.</p>
<p>See <a class="olink ADMQS033" href="../../server.112/e10897/em_manage.htm#ADMQS033"><span class="italic">Oracle Database 2 Day DBA</span></a> for instructions about how to start Database Control.</p>
</li>
<li>
<p>Enter an administrator user name (for example, <code>SYSTEM</code>, or the name of a security administrator) and password, and then click <span class="bold">Login</span>.</p>
<p>The Database Home page appears.</p>
</li>
<li>
<p>Click <span class="bold">Schema</span> to display the Schema subpage.</p>
</li>
<li>
<p>Under Database Objects, select <span class="bold">Tables</span>.</p>
<p>The Tables page appears.</p>
</li>
<li>
<p>Do one of the following:</p>
<ul>
<li>
<p>To create a new table, click <span class="bold">Create</span>, and then answer the questions in the subsequent page to start creating the table.</p>
</li>
<li>
<p>To modify an existing table, search for the table name by entering its schema name into the <span class="bold">Schema</span> field and the table name in the <span class="bold">Object Name</span> field. (You can use the percent sign (%) wildcard character to search for a group of tables, for example <code>O%</code> to find all tables beginning with the letter O.) When the table is listed in the Tables page, select the table, and then click <span class="bold">Edit</span>.</p>
</li>
</ul>
<p>In the Create Table or Edit Table page, you can set its encryption options.</p>
<p>For example, to encrypt columns in the <code>OE.ORDERS</code> table, the Edit Table page appears as follows:</p>
<img width="913" height="474" src="img/encrypt_cols.gif" alt="Description of encrypt_cols.gif follows" /><br />
<a id="sthref372" href="img_text/encrypt_cols.htm">Description of the illustration encrypt_cols.gif</a><br />
<br /></li>
<li>
<p>In the Create Table (or Edit Table) page, do the following:</p>
<ol>
<li>
<p>Select the column that you want to encrypt.</p>
<p>Do not select columns that are part of a foreign key constraint (primary or unique key columns). You cannot encrypt these columns. These columns are indicated with a key or check mark icon to the left of their names.</p>
</li>
<li>
<p>Click <span class="bold">Encryption Options</span> to display the Encryption Options for the Table page.</p>
</li>
<li>
<p>From the Encryption Algorithm list, select from the following options:</p>
<ul>
<li>
<p><span class="bold">AES192</span>: Sets the key length to 192 bits. AES is the abbreviation for Advanced Encryption Standard.</p>
</li>
<li>
<p><span class="bold">3DES168</span>: Sets the key length to 168 bits. 3DES is the abbreviation for Triple Data Encryption Standard.</p>
</li>
<li>
<p><span class="bold">AES128</span>: Sets the key length to 128 bits. This option is the default.</p>
</li>
<li>
<p><span class="bold">AES256</span>: Sets the key length to 256 bits.</p>
</li>
</ul>
</li>
<li>
<p>Under Key Generation, select either <span class="bold">Generate Key Randomly</span> or <span class="bold">Specify Key</span>. If you select <span class="bold">Specify Key</span>, enter characters for the seed values in the <span class="bold">Enter Key</span> and <span class="bold">Confirm Key</span> fields.</p>
<p>The <span class="bold">Generate Key Randomly</span> setting enables salt. <span class="bold">Salt</span> is a way to strengthen the security of encrypted data. It is a random string added to the data before it is encrypted, causing the same text to appear different when encrypted. Salt removes one method attackers use to steal data, namely, matching patterns of encrypted text.</p>
</li>
<li>
<p>Click <span class="bold">Continue</span> to return to the Create Table (or Edit Table) page.</p>
</li>
<li>
<p>Enable encryption for the column by selecting its box under <span class="bold">Encrypted</span>.</p>
</li>
</ol>
</li>
<li>
<p>Click <span class="bold">Continue</span>.</p>
<p>The Create Table (or Edit Table) page appears.</p>
</li>
</ol>
<p>While a table is being updated, read access is still possible. Afterward, existing and future data in the column is encrypted when it is written to the database file, and it is decrypted when an authorized user selects it. If data manipulation language (DML) statements are needed, you can use online redefinition statements.</p>
</div>
<!-- class="sect4" -->
<a id="CHDHHHFH"></a>
<div id="TDPSG44326" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4">Encrypting a Tablespace</h5>
<p>You <a id="sthref373"></a><a id="sthref374"></a>can encrypt a new tablespace while you are creating it, but you cannot encrypt an existing tablespace. As a workaround, you can use the <code>CREATE TABLE AS SELECT</code>, <code>ALTER TABLE MOVE</code>, or use Oracle Data Pump import to get data from an existing tablespace into an encrypted tablespace. For details about creating a tablespace, see <a class="olink ADMQS0622" href="../../server.112/e10897/storage.htm#ADMQS0622"><span class="italic">Oracle Database 2 Day DBA</span></a>.</p>
<p class="orderedlisttitle">To encrypt a tablespace: &nbsp;</p>
<ol>
<li>
<p>Ensure that you have created and opened a wallet key.</p>
<p><a href="#CHDCFBGA">"Step 2: Create the Wallet"</a> explains how to create a wallet key. To open an existing wallet key, see <a href="#CHDFHEBC">"Step 3: Open (or Close) the Wallet"</a>.</p>
</li>
<li>
<p>Start Database Control.</p>
<p>See <a class="olink ADMQS033" href="../../server.112/e10897/em_manage.htm#ADMQS033"><span class="italic">Oracle Database 2 Day DBA</span></a> for instructions about how to start Database Control.</p>
</li>
<li>
<p>Enter an administrator user name (for example, <code>SYSTEM</code>, or the name of a security administrator) and password, and then click <span class="bold">Login</span>.</p>
<p>The Database Home page appears.</p>
</li>
<li>
<p>Click <span class="bold">Server</span> to display the Server subpage.</p>
</li>
<li>
<p>Under Storage, click <span class="bold">Tablespaces</span>.</p>
<p>The Tablespaces page appears.</p>
</li>
<li>
<p>Click <span class="bold">Create</span>, and then answer the questions in the subsequent page to start creating the tablespace and its required data file.</p>
</li>
<li>
<p>In the Create Tablespace page, do the following:</p>
<ol>
<li>
<p>Under Type, select the <span class="bold">Encryption</span> box, under Permanent.</p>
</li>
<li>
<p>Select <span class="bold">Encryption</span> options to display the Encryption Options page.</p>
</li>
<li>
<p>From the Encryption Algorithm list, select from the following options:</p>
<ul>
<li>
<p><span class="bold">AES192</span>: Sets the key length to 192 bits. AES is the abbreviation for Advanced Encryption Standard.</p>
</li>
<li>
<p><span class="bold">3DES168</span>: Sets the key length to 168 bits. 3DES is the abbreviation for Triple Data Encryption Standard.</p>
</li>
<li>
<p><span class="bold">AES128</span>: Sets the key length to 128 bits. This option is the default.</p>
</li>
<li>
<p><span class="bold">AES256</span>: Sets the key length to 256 bits.</p>
</li>
</ul>
<p>See "Available Methods" under Step <a href="tdpsg_network_secure.htm#CHDJBFBE">5</a> in <a href="tdpsg_network_secure.htm#CHDEGJFD">"Configuring Network Encryption"</a> for more information about these encryption algorithms.</p>
</li>
<li>
<p>Click <span class="bold">Continue</span>.</p>
<p>The Create Tablespace page appears.</p>
</li>
</ol>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
<p>The new tablespace appears in the list of existing tablespaces. Remember that you cannot encrypt an existing tablespace.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDECIDD">"Checking Encrypted Tablespaces in the Current Database Instance"</a> to query the database for existing encrypted tablespaces</p>
</li>
<li>
<p><a class="olink ASOAG" href="../../network.112/e40393/toc.htm"><span class="italic">Oracle Database Advanced Security Administrator's Guide</span></a> for detailed information about tablespace encryption</p>
</li>
<li>
<p><a class="olink SQLRF01403" href="../../server.112/e41084/statements_7003.htm#SQLRF01403"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information about the <code>CREATE TABLESPACE</code> statement</p>
</li>
</ul>
</div>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDFHHJB"></a>
<div id="TDPSG40433" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Checking Existing Encrypted Data</h3>
<p>You can query the database for the data that you have encrypted. You can check for individually encrypted columns, all tables in the current database instance that have encrypted columns, or all tablespaces that are encrypted.</p>
<p>This section contains:</p>
<ul>
<li>
<p><a href="#CHDIFJFD">Checking Whether a Wallet Is Open or Closed</a></p>
</li>
<li>
<p><a href="#CHDGDCBI">Checking Encrypted Columns of an Individual Table</a></p>
</li>
<li>
<p><a href="#CHDBBEGI">Checking All Encrypted Table Columns in the Current Database Instance</a></p>
</li>
<li>
<p><a href="#CHDECIDD">Checking Encrypted Tablespaces in the Current Database Instance</a></p>
</li>
</ul>
<a id="CHDIFJFD"></a>
<div id="TDPSG44334" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Checking Whether a Wallet Is Open or Closed</h4>
<p>You can find out if a wallet is open or closed by running the <code>V$ENCRYPTION_WALLET</code> view.</p>
<p class="itemizedlisttitle">To check whether a wallet is open or closed:&nbsp;</p>
<ul>
<li>
<p>In SQL*Plus, query the <code>V$ENCRYPTION_VIEW</code> view as follows:</p>
<pre>
SELECT * FROM V$ENCRYPTION_WALLET;
</pre>
<p>The wallet status appears, similar to the following:</p>
<pre>
WRL_TYPE  WRL_PARAMETER                             STATUS
--------  ----------------------------------------  -------
file      C:\oracle\product\11.2.0\db_1\wallets     OPEN
</pre></li>
</ul>
</div>
<!-- class="sect3" -->
<a id="CHDGDCBI"></a>
<div id="TDPSG44331" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Checking Encrypted Columns of an Individual Table</h4>
<p>You use the <code>DESC</code> (for <code>DESCRIBE</code>) statement in SQL*Plus to check the encrypted columns in a database table.<a id="sthref377"></a></p>
<p class="itemizedlisttitle">To check the encrypted columns of an individual table:&nbsp;</p>
<ul>
<li>
<p>In SQL*Plus, run the <code>DESC</code> statement using the following syntax.</p>
<pre>
DESC <span class="italic">tablename</span>;
</pre>
<p>For example:</p>
<pre>
DESC OE.ORDER_ITEMS;
</pre>
<p>A description of the table schema appears. For example:</p>
<pre>
Name                                      Null?     Type
----------------------------------------  --------  --------------------------
ORDER_ID                                  NOT NULL  NUMBER(12)
LINE_ITEM_ID                              NOT NULL  NUMBER(3)
PRODUCT_ID                                NOT NULL  NUMBER(6)
UNIT_PRICE                                          NUMBER(8,2)
QUANTITY                                            NUMBER(8) ENCRYPT
</pre></li>
</ul>
</div>
<!-- class="sect3" -->
<a id="CHDBBEGI"></a>
<div id="TDPSG44332" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Checking All Encrypted Table Columns in the Current Database Instance</h4>
<p>To check all encrypted table columns, you use the <code>DBA_ENCRYPTED_COLUMNS</code> view. <a id="sthref379"></a></p>
<p class="itemizedlisttitle">To check all encrypted table columns in the current database instance:&nbsp;</p>
<ul>
<li>
<p>In SQL*Plus, select from the <code>DBA_ENCRYPTED_COLUMNS</code> view:</p>
<p>For example:</p>
<pre>
SELECT * FROM DBA_ENCRYPTED_COLUMNS;
</pre>
<p>This <code>SELECT</code> statement lists all tables and column in the database that contain columns encrypted using Oracle Transparent Data Encryption. For example:</p>
<pre>
OWNER        TABLE_NAME    COLUMN_NAME    ENCRYPTION_ALG     SALT
-----------  ----------    -----------    ----------------   ----
OE           CUSTOMERS     INCOME_LEVEL   AES 128 bits key   YES
OE           UNIT_PRICE    ORADER_ITEMS   AES 128 bits key   YES
HR           EMPLOYEES     SALARY         AES 192 bits key   YES
</pre></li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN23534" href="../../server.112/e40402/statviews_3168.htm#REFRN23534"><span class="italic">Oracle Database Reference</span></a> for more information about the <code>DBA_ENCRYPTED_COLUMNS</code> view</div>
</div>
<!-- class="sect3" -->
<a id="CHDECIDD"></a>
<div id="TDPSG44333" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Checking Encrypted Tablespaces in the Current Database Instance</h4>
<p><a href="#CIACJEIB">Table 6-1</a> lists data dictionary views that you can use to check encrypted tablespaces. <a id="sthref381"></a></p>
<div id="TDPSG94373" class="tblhruleformal">
<p class="titleintable"><a id="sthref382"></a><a id="CIACJEIB"></a>Table 6-1 Data Dictionary Views for Encrypted Tablespaces</p>
<table class="cellalignment1881" title="Data Dictionary Views for Encrypted Tablespaces" summary="Data Dictionary Views for Encrypted Tablespaces" dir="ltr">
<thead>
<tr class="cellalignment1875">
<th class="cellalignment1882" id="r1c1-t8">Data Dictionary View</th>
<th class="cellalignment1882" id="r1c2-t8">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r2c1-t8" headers="r1c1-t8">
<p><a class="olink REFRN23287" href="../../server.112/e40402/statviews_5060.htm#REFRN23287"><code>DBA_TABLESPACES</code></a></p>
</td>
<td class="cellalignment1883" headers="r2c1-t8 r1c2-t8">
<p>Describes all tablespaces in the database. For example, find out if the tablespace has been encrypted, enter the following:</p>
<pre>
SELECT TABLESPACE_NAME, ENCRYPTED FROM DBA_TABLESPACES

TABLESPACE_NAME              ENC
---------------------------- ----
SYSTEM                       NO
SYSAUX                       NO
UNCOTBS1                     NO
TEMP                         NO
USERS                        NO
EXAMPLE                      NO
SECURESPACE                  YES
</pre></td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r3c1-t8" headers="r1c1-t8">
<p><a class="olink REFRN26287" href="../../server.112/e40402/statviews_5491.htm#REFRN26287"><code>USER_TABLESPACES</code></a></p>
</td>
<td class="cellalignment1883" headers="r3c1-t8 r1c2-t8">
<p>Describes the tablespaces accessible to the current user. It has the same columns as <code>DBA_TABLESPACES</code>, except for the <code>PLUGGED_IN</code> column.</p>
</td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r4c1-t8" headers="r1c1-t8">
<p><a class="olink REFRN30496" href="../../server.112/e40402/dynviews_1124.htm#REFRN30496"><code>V$ENCRYPTED_TABLESPACE</code></a>S</p>
</td>
<td class="cellalignment1883" headers="r4c1-t8 r1c2-t8">
<p>Displays information about the tablespaces that are encrypted. For example:</p>
<pre>
SELECT * FROM V$ENCRYPTED_TABLESPACES;
</pre>
<pre>
        TS#  ENCRYPTIONALG  ENCRYPTEDTS
<span class="bold">-----------  -------------  ----</span>-------
         6   AES128          YES
</pre>
<p>The list includes the tablespace number, its encryption algorithm, and whether its encryption is enabled or disabled.</p>
<p>If you want to find the name of the tablespace, use the following join operation:</p>
<pre>
SELECT NAME, ENCRYPTIONALG ENCRYPTEDTS
FROM V$ENCRYPTED_TABLESPACES, V$TABLESPACE
WHERE V$ENCRYPTED_TABLESPACES.TS# = V$TABLESPACE.TS#;
</pre></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN" href="../e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a> for more information about data dictionary views</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BGBFGAJJ"></a>
<div id="TDPSG90066" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Choosing Between Oracle Virtual Private Database and Oracle Label Security</h2>
<p>Both <a id="sthref383"></a>Oracle Virtual Private Database (VPD) and <a id="sthref384"></a>Oracle Label Security (OLS) enable you to restrict the data that different users can see in database tables. But when should you use Virtual Private Database and when should you use Oracle Label Security? Virtual Private Database is effective when there is existing data you can use to determine the access requirements. For example, you can configure a sales representative to see only the rows and columns in a customer order entry table for orders he or she handles. Oracle Label Security is useful if you have no natural data (such as user accounts or employee IDs) that can be used to indicate a table's access requirements. To determine this type of user access, you assign different levels of sensitivity to the table rows.</p>
<p>In some cases, <a id="sthref385"></a>Oracle Virtual Private Database and <a id="sthref386"></a>Oracle Label Security can complement each other. The following Oracle Technology Network hands-on tutorial demonstrates how a Virtual Private Database policy can compare an Oracle Label Security user clearance with a minimum clearance. When the user clearance dominates the threshold, the <code>Salary</code> column is not hidden.</p>
<p><code><a href="http://www.oracle.com/technetwork/database/security/ols-cs1-099558.html">http://www.oracle.com/technetwork/database/security/ols-cs1-099558.html</a></code></p>
<p><a href="#BGBJACBH">Table 6-2</a> compares the features of Oracle Virtual Private Database with Oracle Label Security.</p>
<div id="TDPSG94428" class="tblhruleformal">
<p class="titleintable"><a id="sthref387"></a><a id="BGBJACBH"></a>Table 6-2 Comparing Oracle Virtual Private Database with Oracle Label Security</p>
<table class="cellalignment1881" title="Comparing Oracle Virtual Private Database with Oracle Label Security" summary="Differences between VPD and OLS" dir="ltr">
<thead>
<tr class="cellalignment1875">
<th class="cellalignment1882" id="r1c1-t10">Feature</th>
<th class="cellalignment1882" id="r1c2-t10">VPD</th>
<th class="cellalignment1882" id="r1c3-t10">OLS</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r2c1-t10" headers="r1c1-t10">
<p>Provides row-level security</p>
</td>
<td class="cellalignment1883" headers="r2c1-t10 r1c2-t10">
<p>Yes</p>
</td>
<td class="cellalignment1883" headers="r2c1-t10 r1c3-t10">
<p>Yes</p>
</td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r3c1-t10" headers="r1c1-t10">
<p>Provides column-level security (column masking)</p>
</td>
<td class="cellalignment1883" headers="r3c1-t10 r1c2-t10">
<p>Yes</p>
</td>
<td class="cellalignment1883" headers="r3c1-t10 r1c3-t10">
<p>No</p>
</td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r4c1-t10" headers="r1c1-t10">
<p>Binds a user-defined PL/SQL package to a table, view, or synonym</p>
</td>
<td class="cellalignment1883" headers="r4c1-t10 r1c2-t10">
<p>Yes</p>
</td>
<td class="cellalignment1883" headers="r4c1-t10 r1c3-t10">
<p>No<a id="sthref388" href="#sthref388" onclick='footdisplay(1,"Oracle Label Security uses predefined PL/SQL packages, not user-created packages, to attach security policies to tables.")'><sup class="tablefootnote">Foot&nbsp;1&nbsp;</sup></a></p>
</td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r5c1-t10" headers="r1c1-t10">
<p>Modifies SQL by dynamically adding a <code>WHERE</code> clause returned from the PL/SQL procedures</p>
</td>
<td class="cellalignment1883" headers="r5c1-t10 r1c2-t10">
<p>Yes</p>
</td>
<td class="cellalignment1883" headers="r5c1-t10 r1c3-t10">
<p>No</p>
</td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r6c1-t10" headers="r1c1-t10">
<p>Restricts database operations by privileged users<a id="sthref389" href="#sthref389" onclick='footdisplay(2,"If you must restrict privileged user access, consider using Oracle Database Vault.")'><sup class="tablefootnote">Foot&nbsp;2&nbsp;</sup></a></p>
</td>
<td class="cellalignment1883" headers="r6c1-t10 r1c2-t10">
<p>No</p>
</td>
<td class="cellalignment1883" headers="r6c1-t10 r1c3-t10">
<p>No</p>
</td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r7c1-t10" headers="r1c1-t10">
<p>Controls access to a set of rows based on the sensitivity label of the row and the security level of the user</p>
</td>
<td class="cellalignment1883" headers="r7c1-t10 r1c2-t10">
<p>No</p>
</td>
<td class="cellalignment1883" headers="r7c1-t10 r1c3-t10">
<p>Yes</p>
</td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r8c1-t10" headers="r1c1-t10">
<p>Adds a column (optionally hidden) designed to store sensitivity labels for rows in the protected table<a id="sthref390" href="#sthref390" onclick='footdisplay(3,"Usually, this column is hidden to achieve transparency and not break applications that are not designed to show an additional column. ")'><sup class="tablefootnote">Foot&nbsp;3&nbsp;</sup></a></p>
</td>
<td class="cellalignment1883" headers="r8c1-t10 r1c2-t10">
<p>No</p>
</td>
<td class="cellalignment1883" headers="r8c1-t10 r1c3-t10">
<p>Yes</p>
</td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r9c1-t10" headers="r1c1-t10">
<p>Provides a user account to manage its administration</p>
</td>
<td class="cellalignment1883" headers="r9c1-t10 r1c2-t10">
<p>No<a id="sthref391" href="#sthref391" onclick='footdisplay(4,"Oracle Virtual Private Database does not provide a user account, but you can create a user account that is solely responsible for managing Virtual Private Database policies.")'><sup class="tablefootnote">Foot&nbsp;4&nbsp;</sup></a></p>
</td>
<td class="cellalignment1883" headers="r9c1-t10 r1c3-t10">
<p>Yes<a id="sthref392" href="#sthref392" onclick='footdisplay(5,"The \u003ccode\u003eLBACSYS\u003c/code\u003e account manages Oracle Label Security policies. This provides an additional layer of security in that one specific user account is responsible for these policies, which reduces the risk of another user tampering with the policies. ")'><sup class="tablefootnote">Foot&nbsp;5&nbsp;</sup></a></p>
</td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r10c1-t10" headers="r1c1-t10">
<p>Provides pre-defined PL/SQL packages for row-level security</p>
</td>
<td class="cellalignment1883" headers="r10c1-t10 r1c2-t10">
<p>No</p>
</td>
<td class="cellalignment1883" headers="r10c1-t10 r1c3-t10">
<p>Yes</p>
</td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r11c1-t10" headers="r1c1-t10">
<p>Is provided in the default installation of Oracle Database</p>
</td>
<td class="cellalignment1883" headers="r11c1-t10 r1c2-t10">
<p>Yes</p>
</td>
<td class="cellalignment1883" headers="r11c1-t10 r1c3-t10">
<p>No</p>
</td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r12c1-t10" headers="r1c1-t10">
<p>Is provided as an additional option to Oracle Database and must be licensed</p>
</td>
<td class="cellalignment1883" headers="r12c1-t10 r1c2-t10">
<p>No</p>
</td>
<td class="cellalignment1883" headers="r12c1-t10 r1c3-t10">
<p>Yes</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;1&nbsp;</sup>Oracle Label Security uses predefined PL/SQL packages, not user-created packages, to attach security policies to tables.</p>
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;2&nbsp;</sup>If you must restrict privileged user access, consider using Oracle Database Vault.</p>
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;3&nbsp;</sup>Usually, this column is hidden to achieve transparency and not break applications that are not designed to show an additional column.</p>
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;4&nbsp;</sup>Oracle Virtual Private Database does not provide a user account, but you can create a user account that is solely responsible for managing Virtual Private Database policies.</p>
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;5&nbsp;</sup>The <code>LBACSYS</code> account manages Oracle Label Security policies. This provides an additional layer of security in that one specific user account is responsible for these policies, which reduces the risk of another user tampering with the policies.</p>
</div>
<!-- class="sect1" -->
<a id="CHDBICEI"></a>
<div id="TDPSG90034" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Controlling Data Access with Oracle Virtual Private Database</h2>
<p>Oracle Virtual Private Database (VPD) enables you to dynamically add a <code>WHERE</code> clause in any SQL statement that a user executes. The <code>WHERE</code> clause filters the data the user is allowed to access, based on the identity of a user.</p>
<p>This section contains:</p>
<ul>
<li>
<p><a href="#CIHBBEDB">About Oracle Virtual Private Database</a></p>
</li>
<li>
<p><a href="#CIHIIGCE">Tutorial: Creating an Oracle Virtual Private Database Policy</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink DBSEG007" href="../../network.112/e36292/vpd.htm#DBSEG007"><span class="italic">Oracle Database Security Guide</span></a> for detailed information about how Oracle Virtual Private Database works</div>
<a id="CIHBBEDB"></a>
<div id="TDPSG30341" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Oracle Virtual Private Database</h3>
<p>Oracle Virtual Private <a id="sthref393"></a><a id="sthref394"></a>Database (VPD) provides row-level security at the database table or view level. You can extend it to provide column-level security as well. Essentially, Virtual Private Database inserts an additional <code>WHERE</code> clause to any SQL statement that is used on any table or view to which a Virtual Private Database security policy has been applied. (A security policy is a function that allows or prevents access to data.) The <code>WHERE</code> clause allows only users whose identity passes the security policy, and hence, have access to the data that you want to protect.</p>
<p><a id="sthref395"></a>An Oracle Virtual Private Database policy has the following components, which are typically created in the schema of the security administrator:</p>
<ul>
<li>
<p><span class="bold">A PL/SQL function to append the dynamic WHERE clause to SQL statements that affect the Virtual Private Database tables.</span> For example, a PL/SQL function translates the following <code>SELECT</code> statement:</p>
<pre>
SELECT * FROM ORDERS;
</pre>
<p>to the following:</p>
<pre>
SELECT * FROM ORDERS
  WHERE SALES_REP_ID = 159;
</pre>
<p>In this example, the user can only view orders by Sales Representative 159. The PL/SQL function used to generate this <code>WHERE</code> clause is as follows:</p>
<div class="inftblsimple">
<table class="cellalignment1886" title="sales_rep_id example" summary="sales_rep_id example, line numbers and code, listed left to right" dir="ltr">
<tbody>
<tr class="cellalignment1875">
<td class="cellalignment1883">&nbsp;</td>
<td class="cellalignment1883">
<pre>
1
2
3
4
5
6
7
8
9
10
11
12
</pre></td>
<td class="cellalignment1883">
<pre>
CREATE OR REPLACE FUNCTION auth_orders( 
 schema_var IN VARCHAR2, 
 table_var  IN VARCHAR2 
) 
RETURN VARCHAR2
IS  
 return_val VARCHAR2 (400); 
BEGIN 
 return_val := 'SALES_REP_ID = 159';
 RETURN return_val; 
END auth_orders; 
/
</pre></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblsimple" -->
<p>In this example:</p>
<ul>
<li>
<p><span class="bold">Lines 2&ndash;3:</span> Create parameters to store the schema name, <code>OE</code>, and table name, <code>ORDERS</code>. (The second parameter, <code>table_var</code>, for the table, can also be used for views and synonyms.) Always create these two parameters in this order: create the parameter for the schema first, followed by the parameter for the table, view, or synonym object. Note that the function itself does not specify the <code>OE</code> schema or its <code>ORDERS</code> table. The Virtual Private Database policy you create uses these parameters to specify the <code>OE.ORDERS</code> table.</p>
</li>
<li>
<p><span class="bold">Line 5:</span> Returns the string that will be used for the <code>WHERE</code> predicate clause.</p>
</li>
<li>
<p><span class="bold">Lines 6&ndash;10:</span> Encompass the creation of the <code>WHERE SALES_REP_ID = 159</code> predicate.</p>
</li>
</ul>
<p><a id="sthref396"></a><a id="sthref397"></a>You can design the <code>WHERE</code> clause to filter the user information based on the session information of that user, such as the user ID. To do so, you create an <a id="sthref398"></a><a id="sthref399"></a>application context. Application contexts can be used to authenticate both database and nondatabase <a id="sthref400"></a>users. An application context is a name-value pair. For example:</p>
<pre>
SELECT * FROM oe.orders 
 WHERE sales_rep_id = SYS_CONTEXT('userenv','session_user'); 
</pre>
<p>In this example, the <code>WHERE</code> clause uses the <code>SYS_CONTEXT</code> PL/SQL function to retrieve the user session ID (<code>session_user</code>) designated by the <code>userenv</code> context. See <a class="olink DBSEG011" href="../../network.112/e36292/app_context.htm#DBSEG011"><span class="italic">Oracle Database Security Guide</span></a> for detailed information about application contexts.</p>
</li>
<li>
<p><span class="bold">A way to attach the policy the package.</span> Use the <code>DBMS_RLS.ADD_POLICY</code> function to attach the policy to the package. Before you can use the <code>DBMS_RLS</code> PL/SQL package, you must be granted <code>EXECUTE</code> privileges on it. User <code>SYS</code> owns the <code>DBMS_RLS</code> package.</p>
</li>
</ul>
<p><a id="sthref401"></a>The advantages of enforcing row-level security at the database level rather than at the application program level are enormous. Because the security policy is implemented in the database itself, where the data to be protected is, this data is less likely to be vulnerable to attacks by different data access methods. This layer of security is present and enforced no matter how users (or intruders) try to access the data it protects. The maintenance overhead is low because you maintain the policy in one place, the database, rather than having to maintain it in the applications that connect to this database. The policies that you create provide a great deal of flexibility because you can write them for specific DML operations.</p>
</div>
<!-- class="sect2" -->
<a id="CIHIIGCE"></a>
<div id="TDPSG30343" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Tutorial: Creating an Oracle Virtual Private Database Policy</h3>
<p><a id="ABC6617148"></a><a id="ABC6617148SRI1"></a>The <code>ORDERS</code> table in the Order Entry database, <code>OE</code>, contains the following information:</p>
<pre>
Name                                   Null?    Type
-------------------------------------- -------- ---------------------------------
ORDER_ID                               NOTNULL  NUMBER(12)
ORDER_DATE                             NOTNULL  TIMESTAMP(6) WITH LOCAL TIME ZONE
ORDER_MODE                                      VARCHAR2(8)
CUSTOMER_ID                            NOTNULL  NUMBER(6)
ORDER_STATUS                                    NUMBER(2)
ORDER_TOTAL                                     NUMBER(8,2)
SALES_REP_ID                                    NUMBER(6)
PROMOTION_ID                                    NUMBER(6)
</pre>
<p>Suppose you want to limit access to this table based on the person who is querying the table. For example, a sales representative should only see the orders that he or she have created, but other employees should not. In this tutorial, you create a sales representative user account and an account for a finance manager. Then, you create an Oracle Virtual Private Database policy that will limit the data access to these users based on their roles.</p>
<p>The Virtual Private Database policy that you will create is associated with a PL/SQL function. Because VPD policies are controlled by PL/SQL functions or procedures, you can design the policy to restrict access in many different ways. For this tutorial, the function you create will restrict access by the employees based on to whom they report. The function will restrict the customer access based on the customer's ID.</p>
<p>You may want to store VPD policies in a database account separate from the database administrator and from application accounts. In this tutorial, you will use the <code>sec_admin</code> account, which was created in <a href="tdpsg_privileges.htm#CIHHGDAE">"Tutorial: Creating a Secure Application Role"</a>, to create the VPD policy. This provides better security by separating the VPD policy from the applications tables.</p>
<p>To restrict access based on the sensitivity of row data, you can use Oracle Label Security (OLS). OLS lets you categorize data into different levels of security, with each level determining who can access the data in that row. This way, the data access restriction is focused on the data itself, rather than on user privileges. See <a href="#CHDBIIGG">"Enforcing Row-Level Security with Oracle Label Security"</a> for more information.</p>
<p>In this tutorial:</p>
<ul>
<li>
<p><a href="#CIHBAEEC">Step 1: If Necessary, Create the Security Administrator Account</a></p>
</li>
<li>
<p><a href="#CIAHGFGB">Step 2: Update the Security Administrator Account</a></p>
</li>
<li>
<p><a href="#CIHIBEGE">Step 3: Create User Accounts for This Tutorial</a></p>
</li>
<li>
<p><a href="#CIHCJFAE">Step 4: Create the F_POLICY_ORDERS Policy Function</a></p>
</li>
<li>
<p><a href="#CIHBADHC">Step 5: Create the ACCESSCONTROL_ORDERS Virtual Private Database Policy</a></p>
</li>
<li>
<p><a href="#CIHEEFAH">Step 6: Test the ACCESSCONTROL_ORDERS Virtual Private Database Policy</a></p>
</li>
<li>
<p><a href="#CIHHAEGB">Step 7: Optionally, Remove the Components for This Tutorial</a></p>
</li>
</ul>
<a id="CIHBAEEC"></a>
<div id="TDPSG33431" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 1: If Necessary, Create the Security Administrator Account</h4>
<p>In <a href="tdpsg_privileges.htm#CIHHGDAE">"Tutorial: Creating a Secure Application Role"</a>, you created a security administrator account called <code>sec_admin</code> for that tutorial. You can use that account for this tutorial. If you have not yet created this account, follow the steps in <a href="tdpsg_privileges.htm#CIHHIJCB">"Step 1: Create a Security Administrator Account"</a> to create <code>sec_admin</code>.</p>
</div>
<!-- class="sect3" -->
<a id="CIAHGFGB"></a>
<div id="TDPSG33437" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 2: Update the Security Administrator Account</h4>
<p>The <code>sec_admin</code> account user must have privileges to use the <code>DBMS_RLS</code> packages. User <code>SYS</code> owns this package, so you must log on as <code>SYS</code> to grant these package privileges to <code>sec_admin</code>. The user <code>sec_admin</code> also must have <code>SELECT</code> privileges on the <code>CUSTOMERS</code> table in the <code>OE</code> schema and the <code>EMPLOYEES</code> table in the <code>HR</code> schema.</p>
<p class="orderedlisttitle">To grant sec_admin privileges to use the DBMS_RLS package:&nbsp;</p>
<ol>
<li>
<p>Start Database Control.</p>
<p>See <a class="olink ADMQS033" href="../../server.112/e10897/em_manage.htm#ADMQS033"><span class="italic">Oracle Database 2 Day DBA</span></a> for instructions about how to start Database Control.</p>
</li>
<li>
<p>Log in as user <code>SYS</code> and connect with the <code>SYSDBA</code> privilege:</p>
<ul>
<li>
<p><span class="bold">User Name</span>: <code>SYS</code></p>
</li>
<li>
<p><span class="bold">Password</span>: Enter the password for <code>SYS</code>.</p>
</li>
<li>
<p><span class="bold">Connect As</span>: <code>SYSDBA</code></p>
</li>
</ul>
</li>
<li>
<p>Click <span class="bold">Server</span> to display the Server subpage.</p>
</li>
<li>
<p>Under Security, select <span class="bold">Users</span>.</p>
<p>The Users Page appears.</p>
</li>
<li>
<p>Select the <span class="bold">SEC_ADMIN</span> user, and in the View User page, click <span class="bold">Edit</span>.</p>
<p>The Edit User page appears.</p>
</li>
<li>
<p>Click <span class="bold">Object Privileges</span> to display the Object Privileges page.</p>
</li>
<li>
<p>From the <span class="bold">Select Object Type</span> list, select <span class="bold">Package</span>, and then click <span class="bold">Add</span>.</p>
<p>The Add Package Object Privileges page appears.</p>
</li>
<li>
<p>Under Select Package Objects, enter <code>SYS.DBMS_RLS</code> so that <code>sec_admin</code> will have access to the <code>DBMS_RLS</code> package.</p>
</li>
<li>
<p>Under Available Privileges, select <span class="bold">EXECUTE</span>, and then click <span class="bold">Move</span> to move it to the Selected Privileges list.</p>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
<p>The Edit User page appears.</p>
</li>
<li>
<p>From the <span class="bold">Select Object Type</span> list, select <span class="bold">Table</span>, and then click <span class="bold">Add</span>.</p>
<p>The Add Table Object Privileges page appears.</p>
</li>
<li>
<p>In the <span class="bold">Select</span> <span class="bold">Table Objects</span> field, enter <code>HR.EMPLOYEES</code> so that <code>sec_admin</code> will have access to the <code>HR.EMPLOYEES</code> table.</p>
</li>
<li>
<p>Under Available Privileges, select <span class="bold">SELECT</span>, and then click <span class="bold">Move</span> to move it to the Selected Privileges list.</p>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
<p>The Edit User page appears. It shows that user sec_admin has object privileges for the <code>EMPLOYEES</code> table and <code>DBMS_RLS</code> PL/SQL package. Ensure that you do not select the grant option for either of these objects.</p>
</li>
<li>
<p>Click <span class="bold">Apply</span>.</p>
<p>All the changes you have made, in this case, the addition of the two object privileges, are applied to the <code>sec_admin</code> user account.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIHIBEGE"></a>
<div id="TDPSG33432" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 3: Create User Accounts for This Tutorial</h4>
<p>You are ready to create accounts for the employees who must access the <code>OE.ORDERS</code> table.</p>
<p class="orderedlisttitle">To create the employee user accounts: &nbsp;</p>
<ol>
<li>
<p>In Database Control, click <span class="bold">Users</span> in the <span class="bold">Database Instance</span> link to return to the Users page.</p>
<p>The Users page appears.</p>
</li>
<li>
<p>Click <span class="bold">Create</span>.</p>
<p>The Create User page appears.</p>
</li>
<li>
<p>Enter the following information:</p>
<ul>
<li>
<p><span class="bold">Name</span>: <code>LDORAN</code> (to create the user account Louise Doran)</p>
</li>
<li>
<p><span class="bold">Profile</span>: <code>DEFAULT</code></p>
</li>
<li>
<p><span class="bold">Authentication</span>: <code>Password</code></p>
</li>
<li>
<p><span class="bold">Enter Password</span> and <span class="bold">Confirm Password</span>: Enter a password that meets the requirements in <a href="tdpsg_user_accounts.htm#BEICECGF">"Requirements for Creating Passwords"</a>.</p>
</li>
<li>
<p><span class="bold">Default Tablespace</span>: <code>USERS</code></p>
</li>
<li>
<p><span class="bold">Temporary Tablespace</span>: <code>TEMP</code></p>
</li>
<li>
<p><span class="bold">Status</span>: <code>Unlocked</code></p>
</li>
</ul>
</li>
<li>
<p>Select the <span class="bold">Object Privileges</span> tab.</p>
</li>
<li>
<p>From the <span class="bold">Select Object Type</span> list, select <span class="bold">Table</span>, and then click <span class="bold">Add</span>.</p>
<p>The Add Table Object Privileges page appears.</p>
</li>
<li>
<p>In the <span class="bold">Select Table Objects</span> field, enter the following text:</p>
<pre>
OE.ORDERS
</pre>
<p>Do not include spaces in this text.</p>
</li>
<li>
<p>In the Available Privileges list, select <span class="bold">SELECT</span>, and then click <span class="bold">Move</span> to move it to the Selected Privileges list. Click <span class="bold">OK</span>.</p>
<p>The Create User page appears, with <code>SELECT</code> privileges for <code>OE.ORDERS</code> listed.</p>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
<p>The Users page appears, with user <code>ldoran</code> is listed in the UserName column.</p>
</li>
<li id="CIADJHFI">
<p>Select the selection button for user <span class="bold">LDORAN</span>, and from the <span class="bold">Actions</span> list, select <span class="bold">Create Like</span>. Then, click <span class="bold">Go</span>.</p>
<p>The Create User page appears.</p>
</li>
<li id="CIHIADHF">
<p>Enter the following information:</p>
<ul>
<li>
<p><span class="bold">Name</span>: <code>LPOPP</code> (to create the user account for Finance Manager Luis Popp.)</p>
</li>
<li>
<p><span class="bold">Enter Password</span> and <span class="bold">Confirm Password</span>: Enter a password that meets the requirements in <a href="tdpsg_user_accounts.htm#BEICECGF">"Requirements for Creating Passwords"</a>.</p>
</li>
</ul>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
</li>
</ol>
<p>Both employee accounts have been created, and they have identical privileges. If you check the privileges for user <code>LPOPP</code>, you will see that they are identical to those of user <code>LDORAN</code>'s. At this stage, if either of these users performs a <code>SELECT</code> statement on the <code>OE.ORDERS</code> table, he or she will be able to see all of its data.</p>
</div>
<!-- class="sect3" -->
<a id="CIHCJFAE"></a>
<div id="TDPSG33433" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 4: Create the F_POLICY_ORDERS Policy Function</h4>
<p>The <code>f_policy_orders</code> policy is a PL/SQL function that defines the policy used to filter users who query the <code>ORDERS</code> table. To filter the users, the policy function uses the <code>SYS_CONTEXT</code> PL/SQL function to retrieve session information about users who are logging in to the database.</p>
<p class="orderedlisttitle">To create the application context and its package:&nbsp;</p>
<ol>
<li>
<p>In Database Control, click <span class="bold">Logout</span> and then <span class="bold">Login</span>.</p>
</li>
<li>
<p>Log in as user <code>sec_admin</code>.</p>
</li>
<li>
<p>Click <span class="bold">Schema</span> to display the Schema subpage.</p>
</li>
<li>
<p>Under Programs, select <span class="bold">Functions</span>.</p>
<p>The Functions page appears.</p>
</li>
<li>
<p>Ensure that the <span class="bold">Object Type</span> menu is set to <span class="bold">Function</span>, and then click <span class="bold">Create</span>.</p>
<p>The Create Function page appears.</p>
</li>
<li>
<p>Enter the following information:</p>
<ul>
<li>
<p><span class="bold">Name</span>: <code>F_POLICY_ORDERS</code></p>
</li>
<li>
<p><span class="bold">Schema</span>: <code>SEC_ADMIN</code></p>
</li>
<li>
<p><span class="bold">Source</span>: Delete the empty function code that has been provided, and then enter the following code (but not the line numbers on the left side of the code) to create a function that checks whether the user who has logged on is a sales representative. You can copy and paste this text by positioning the cursor at the start of <code>(schema in varchar2)</code> in the first line.</p>
<p>The <code>f_policy_orders</code> function accomplishes this by using the <code><a id="sthref405"></a><a id="sthref406"></a>SYS_CONTEXT</code> PL/SQL function to get the session information of the user, and then it compares this information with the job ID of that user in the <code>HR.EMPLOYEES</code> table, for which <code>sec_admin</code> has <code>SELECT</code> privileges.</p>
<div class="inftblsimple">
<table class="cellalignment1886" title="f_policy_orders example" summary="f_policy_orders example, line numbers and code, listed left to right" dir="ltr">
<tbody>
<tr class="cellalignment1875">
<td class="cellalignment1883">&nbsp;</td>
<td class="cellalignment1883">
<pre>
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td>
<td class="cellalignment1883">
<pre>
(schema in varchar2,
tab in varchar2)
return varchar2 
as 
 v_job_id   varchar2(20);
 v_user     varchar2(100);
 predicate  varchar2(400);
 
begin
 v_job_id  := null;
 v_user    := null;
 predicate := '1=2';

v_user := lower(sys_context('userenv','session_user'));

 select lower(job_id) into v_job_id from hr.employees
   where lower(email) = v_user;
 
 if  v_job_id='sa_rep' then
    predicate := '1=1';
 else 
    null; 
 end if;

 return predicate;

 exception 
  when no_data_found then 
   null;
end;
</pre></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblsimple" -->
<p>In this example:</p>
<ul>
<li>
<p><span class="bold">Lines 1&ndash;2:</span> Define parameters for the schema (<code>schema</code>) and table (<code>tab</code>) that must be protected. Notice that the function does not mention the <code>OE.ORDERS</code> table. The <code>ACCESSCONTROL_ORDERS</code> policy that you create in <a href="#CIHBADHC">Step 5: Create the ACCESSCONTROL_ORDERS Virtual Private Database Policy</a> uses these parameters to specify the <code>OE</code> schema and <code>ORDERS</code> table. Ensure that you create the <code>schema</code> parameter first, followed by the <code>tab</code> parameter.</p>
</li>
<li>
<p><span class="bold">Line 3:</span> Returns the string that will be used for the <code>WHERE</code> predicate clause. Always use <code>VARCHAR2</code> as the data type for this return value.</p>
</li>
<li>
<p><span class="bold">Lines 4&ndash;7:</span> Define variables to store the job ID, user name of the user who has logged on, and predicate values.</p>
</li>
<li>
<p><span class="bold">Lines 9&ndash;25:</span> Encompass the creation of the <code>WHERE</code> predicate, starting the with the <code>BEGIN</code> clause at <span class="bold">Line 9</span>.</p>
</li>
<li>
<p><span class="bold">Lines 10&ndash;12:</span> Sets the <code>v_job_id</code> and <code>v_user</code> variables to null, and the <code>predicate</code> variable to 1=2, that is, to a false value. At this stage, no <code>WHERE</code> predicate can be generated until these variables pass the tests starting with <span class="bold">Line 16</span>.</p>
</li>
<li>
<p><span class="bold">Line 14:</span> Uses the <code>SYS_CONTEXT</code> function to retrieve the session information of the user and write it to the <code>v_user</code> variable.</p>
</li>
<li>
<p><span class="bold">Lines 16&ndash;23:</span> Checks if the user is a sales representative by comparing the job ID with the user who has logged on. If the job ID of the user who has logged on is <code>sa_rep</code> (sales representative), then the <code>predicate</code> variable is set to <code>1=1</code>. In other words, the user, by being a sales representative, has passed the test.</p>
</li>
<li>
<p><span class="bold">Line 25:</span> Returns the <code>WHERE</code> predicate, which translates to <code>WHERE</code> <code><span class="codeinlineitalic">role_of_user_logging_on</span></code> <code>IS</code> <code>"sa_rep"</code>. Oracle Database appends this <code>WHERE</code> predicate onto any <code>SELECT</code> statement that users <code>LDORAN</code> and <code>LPOPP</code> issue on the <code>OE.ORDERS</code> table.</p>
</li>
<li>
<p><span class="bold">Lines 27&ndash;29:</span> Provide an <code>EXCEPTION</code> clause for cases where a user without the correct privileges has logged on.</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIHBADHC"></a>
<div id="TDPSG33434" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 5: Create the ACCESSCONTROL_ORDERS Virtual Private Database Policy</h4>
<p>Now that you have created the Virtual Private Database policy function, you can create the Virtual Private Database policy, <code>accesscontrol_orders</code>, and then attach it to the <code>ORDERS</code> table. To increase performance, add the <code>CONTEXT_SENSITIVE</code> parameter to the policy, so that Oracle Database only executes the <code>f_policy_orders</code> function when the content of the application context changes, in this case, when a new user logs on. Oracle Database only activates the policy when a user performs a SQL <code>SELECT</code> statement on the <code>ORDERS</code> table. Hence, the user cannot run the <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code> statements, because the policy does not allow him or her to do so.</p>
<p class="orderedlisttitle">To create the ACCESSCONTROL_ORDERS Virtual Private Database policy: &nbsp;</p>
<ol>
<li>
<p>In Database Control, click the <span class="bold">Database Instance</span> link to display the Database Home page.</p>
</li>
<li>
<p>Click <span class="bold">Server</span> to display the Server subpage.</p>
</li>
<li>
<p>In the Security section, click <span class="bold">Virtual Private Database</span>.</p>
<p>The Virtual Private Database Policies page appears.</p>
</li>
<li>
<p>Click <span class="bold">Create</span>.</p>
<p>The Create Policy page appears, with the Policy subpage displaying.</p>
</li>
<li>
<p>Under General, enter the following:</p>
<ul>
<li>
<p><span class="bold">Policy Name</span>: <code>ACCESSCONTROL_ORDERS</code></p>
</li>
<li>
<p><span class="bold">Object Name</span>: <code>OE.ORDERS</code></p>
</li>
<li>
<p><span class="bold">Policy Type</span>: Select <code>CONTEXT_SENSITIVE</code>.</p>
<p>This type reevaluates the policy function at statement run-time if it detects context changes since the last use of the cursor. For session pooling, where multiple clients share a database session, the middle tier must reset the context during client switches. Note that Oracle Database does not cache the value that the function returns for this policy type; it always runs the policy function during statement parsing. The <code>CONTEXT_SENSITIVE</code> policy type applies to only one object.</p>
<p>To enable the Policy Type, select the <span class="bold">Enabled</span> box.</p>
</li>
</ul>
</li>
<li>
<p>Under Policy Function, enter the following:</p>
<ul>
<li>
<p><span class="bold">Policy Function</span>: Enter the name of the function that generates a predicate for the policy, in this case, <code>SEC_ADMIN.F_POLICY_ORDERS</code>.</p>
</li>
<li>
<p><span class="bold">Long Predicate</span>: Do not select this box.</p>
<p>Typically, you select this box to return a predicate with a length of up to 32K bytes. By not selecting this box, Oracle Database limits the predicate to 4000 bytes.</p>
</li>
</ul>
</li>
<li>
<p>Under Enforcement, select the <span class="bold">SELECT</span> option but deselect the remaining options that already may be selected.</p>
</li>
<li>
<p>Do not select any options under Security Relevant Columns.</p>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
<p>The Virtual Private Database Policies page appears, with the <code>ACCESSCONTROL_ORDERS</code> policy listed in the list of policies.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIHEEFAH"></a>
<div id="TDPSG33435" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 6: Test the ACCESSCONTROL_ORDERS Virtual Private Database Policy</h4>
<p>At this stage, you are ready to test the <code>accesscontrol_orders</code> policy by logging on as each user and attempting to select data from the <code>ORDERS</code> table.</p>
<p class="orderedlisttitle">To test the ACCESSCONTROL_ORDERS policy: &nbsp;</p>
<ol>
<li>
<p>Start SQL*Plus.</p>
<p>From a command prompt, enter the following command to start SQL*Plus, and log in as Sales Representative Louise Doran, whose user name is <code>ldoran</code>:</p>
<pre>
sqlplus ldoran
Enter password: <span class="italic">password</span>
</pre>
<p>SQL*Plus starts, connects to the default database, and then displays a prompt.</p>
<p>For detailed information about starting SQL*Plus, see <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a>.</p>
</li>
<li>
<p>Enter the following <code>SELECT</code> statement:</p>
<pre>
SELECT COUNT(*) FROM OE.ORDERS;
</pre>
<p>The following results should appear for Louise. As you can see, Louise is able to access all the orders in the <code>OE.ORDERS</code> table.</p>
<pre>
COUNT(*)
--------
     105
</pre></li>
<li>
<p>Connect as Finance Manager Luis Popp.</p>
<pre>
CONNECT lpopp
Enter password: <span class="italic">password</span>
</pre></li>
<li>
<p>Enter the following <code>SELECT</code> statement:</p>
<pre>
SELECT COUNT(*) FROM OE.ORDERS;
</pre>
<p>The following results should appear, because Mr. Popp, who is not a sales representative, does not have access to the data in the <code>OE.ORDERS</code> table. Because Mr. Popp does not have access, Oracle Database only allows him access to 0 rows.</p>
<pre>
COUNT(*)
--------
       0
</pre></li>
<li>
<p>Exit SQL*Plus:</p>
<pre>
EXIT
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIHHAEGB"></a>
<div id="TDPSG33436" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 7: Optionally, Remove the Components for This Tutorial</h4>
<p>After completing this tutorial, you can remove the data structures that you used if you no longer need them.</p>
<p class="orderedlisttitle">To remove the data structures created by sec_admin:&nbsp;</p>
<ol>
<li>
<p>In Database Control, log in as user <code>sec_admin</code>.</p>
</li>
<li>
<p>Click <span class="bold">Server</span> to display the Server subpage.</p>
</li>
<li>
<p>Under Security, select <span class="bold">Virtual Private Database</span>.</p>
<p>The Virtual Private Database Policies page appears.</p>
</li>
<li>
<p>Under Search, enter the following information, and then click <span class="bold">Go</span>:</p>
<ul>
<li>
<p><span class="bold">Schema Name:</span> <code>OE</code></p>
</li>
<li>
<p><span class="bold">Object Name:</span> <code>ORDERS</code></p>
</li>
<li>
<p><span class="bold">Policy Name:</span> %</p>
</li>
</ul>
<p>The policy you created, <code>ACCESSCONTROL_ORDERS</code>, is listed.</p>
</li>
<li>
<p>Select <span class="bold">ACCESSCONTROL_ORDERS</span>, and then click <span class="bold">Delete</span>.</p>
</li>
<li>
<p>In the Confirmation page, click <span class="bold">Yes</span>.</p>
</li>
</ol>
<p class="orderedlisttitle">To remove the user accounts and roles:&nbsp;</p>
<ol>
<li>
<p>In Database Control, click <span class="bold">Logout</span>, and then <span class="bold">Login</span>.</p>
</li>
<li>
<p>Log in as the administrative user (for example, <code>SYSTEM</code>) who created the user accounts and roles used in this tutorial.</p>
</li>
<li>
<p>Click <span class="bold">Server</span> to display the Server subpage.</p>
</li>
<li>
<p>Under Security, select <span class="bold">Users</span>.</p>
<p>The Users page appears.</p>
</li>
<li>
<p>Select each of the following users, and then click <span class="bold">Delete</span> to remove them:</p>
<ul>
<li>
<p><code>LDORAN</code></p>
</li>
<li>
<p><code>LPOPP</code></p>
</li>
</ul>
<p>Do not remove <code>sec_admin</code> because you will need this account for later tutorials in this guide.</p>
</li>
<li>
<p>Exit Database Control. <a id="sthref411"></a><a id="sthref412"></a></p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDBIIGG"></a>
<div id="TDPSG30035" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Enforcing Row-Level Security with Oracle Label Security</h2>
<p>Oracle Label Security (OLS) provides row-level security for your database tables. You can accomplish this by assigning one or more security labels that define the level of security you want for the data rows of the table.</p>
<p>This section contains:</p>
<ul>
<li>
<p><a href="#BABDEIBH">About Oracle Label Security</a></p>
</li>
<li>
<p><a href="#CIHBCEJC">Guidelines for Planning an Oracle Label Security Policy</a></p>
</li>
<li>
<p><a href="#BABBHHFE">Tutorial: Applying Security Labels to the HR.LOCATIONS Table</a></p>
</li>
</ul>
<a id="BABDEIBH"></a>
<div id="TDPSG30351" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Oracle Label Security</h3>
<p><a id="sthref413"></a><a id="sthref414"></a>You use Oracle Label Security to secure your database tables at the row level, and assign these rows different levels of security based on the needs of your site. For example, rows that contain highly sensitive data can be assigned a label entitled <code>HIGHLY SENSITIVE</code>; rows that are less sensitive can be labeled as <code>SENSITIVE</code>, and so on. Rows that all users can have access to can be labeled <code>PUBLIC</code>. You can create as many labels as you need, to fit your site's security requirements.</p>
<p>After you create and assign the labels, you can use Oracle Label Security to assign specific users authorization for specific rows, based on these labels. Afterward, Oracle Label Security automatically compares the label of the data row with the security clearance of the user to determine whether the user is allowed access to the data in the row.</p>
<p><a id="sthref415"></a>An Oracle Label Security policy has the following components:</p>
<ul>
<li>
<p><span class="bold">Labels.</span> Labels for data and users, along with authorizations for users and program units, govern access to specified protected objects. Labels are composed of the following:</p>
<ul>
<li>
<p><span class="bold">Levels.</span> Levels indicate the type of sensitivity that you want to assign to the row, for example, <code>SENSITIVE</code> or <code>HIGHLY SENSITIVE</code>.</p>
</li>
<li>
<p><span class="bold">Compartments.</span> (Optional) Data can have the same level (Public, Confidential and Secret), but can belong to different projects inside a company, for example ACME Merger and IT Security. Compartments represent the projects in this example, that help define more precise <a id="sthref416"></a>access controls. They are most often used in government environments.</p>
</li>
<li>
<p><span class="bold">Groups.</span> (Optional) Groups identify organizations owning or accessing the data, for example, UK, US, Asia, Europe. Groups are used both in commercial and government environments, and frequently used in place of compartments due to their flexibility.</p>
</li>
</ul>
</li>
<li>
<p><span class="bold">Policy.</span> A policy is a name associated with these labels, rules, and authorizations.</p>
</li>
</ul>
<p><a id="sthref417"></a>You can create Oracle Label Security labels and policies in Database Control, or you can create them using the <code>SA_SYSDBA</code>, <code>SA_COMPONENTS</code>, and <code>SA_LABEL_ADMIN</code> PL/SQL packages. For information about using the PL/SQL packages, see <a class="olink OLSAG" href="../../network.112/e10745/toc.htm"><span class="italic">Oracle Label Security Administrator's Guide</span></a>. This guide explains how to create Oracle Label Security labels and policies by using Database Control.</p>
<p>For example, assume that a user has the <code>SELECT</code> privilege on an application table. As illustrated in the following figure, when the user runs a <code>SELECT</code> statement, Oracle Label Security evaluates each row selected to determine whether the user can access it. The decision is based on the privileges and access labels assigned to the user by the security administrator. You can also configure Oracle Label Security to perform security checks on <code>UPDATE</code>, <code>DELETE</code>, and <code>INSERT</code> statements.</p>
<img width="498" height="130" src="img/olsag008.gif" alt="Description of olsag008.gif follows" /><br />
<a id="sthref418" href="img_text/olsag008.htm">Description of the illustration olsag008.gif</a><br />
<br /></div>
<!-- class="sect2" -->
<a id="CIHBCEJC"></a>
<div id="TDPSG30352" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Guidelines for Planning an Oracle Label Security Policy</h3>
<p>Before <a id="sthref419"></a><a id="sthref420"></a>you create an Oracle Label Security policy, you must determine where and how to apply the labels to the application schema.</p>
<p class="orderedlisttitle">To determine where and how to apply Oracle Label Security policies for application data, follow these guidelines:&nbsp;</p>
<ol>
<li id="CIHBCFHI">
<p><span class="bold">Analyze the application schema.</span> Identify the tables that require an Oracle Label Security policy. In most cases, only a small number of the application tables will require an Oracle Label Security policy. For example, tables that store lookup values or constants usually do not need to be protected with a security policy. However, tables that contain sensitive data, such as patient medical histories or employee salaries, do.</p>
</li>
<li id="CIHCEFAB">
<p><span class="bold">Analyze the use of data levels</span>. After you identify the candidate tables, evaluate the data in the tables to determine the level of security for the table. Someone who has broad familiarity with business operations can provide valuable assistance with this stage of the analysis.</p>
<p>Data levels refer to the sensitivity of the data. <code>PUBLIC</code>, <code>SENSITIVE</code>, and <code>HIGHLY SENSITIVE</code> are examples of data levels. You should also consider future sensitivities. Doing so creates a robust set of label definitions.</p>
<p>Remember that if a data record is assigned a sensitivity label whose level component is lower than the clearance of the user, then a user attempting to read the record is granted access to that row.</p>
</li>
<li>
<p><span class="bold">Analyze the use of data compartments.</span> Data compartments are used primarily in government environments. If your application is a commercial application, in most cases, you will not create data compartments.</p>
</li>
<li id="CIHGFHDA">
<p><span class="bold">Analyze the data groups.</span> Data groups and data compartments are typically used to control access to data by organization, region, or data ownership. For example, if the application is a sales application, access to the sales data can be controlled by country or region.</p>
<p>When a data record is assigned a sensitivity label with compartments and groups, a user attempting to read the record must have a user clearance that contains a level that is equal to or greater than the level of the data label, all of its compartments, and at least one of the groups in the sensitivity label. Because groups are hierarchical, a user could have the parent of one of the groups in the sensitivity label assigned to the data label and still be able to access that record.</p>
</li>
<li>
<p><span class="bold">Analyze the user population.</span> Separate the users into one or more designated user types. For example, a user might be designated as a typical user, privileged user, or administrative user. After you create these categories of users, compare the categories with the data levels you created in Step <a href="#CIHCEFAB">2</a>. They must correspond correctly for each table identified during the schema analysis you performed in Step <a href="#CIHBCFHI">1</a>. Then, compare the organizational structure of the user population with the data groups that you identified in Step <a href="#CIHGFHDA">4</a>.</p>
</li>
<li>
<p><span class="bold">Examine the highly privileged and administrative users to determine which Oracle Label Security authorizations should be assigned to the user.</span> Oracle Label Security has several special authorizations that can be assigned to users. In general, typical users do not require any special authorizations. See <a class="olink OLSAG016" href="../../network.112/e10745/accpriv.htm#OLSAG016"><span class="italic">Oracle Label Security Administrator's Guide</span></a> for a complete list of these authorizations.</p>
</li>
<li>
<p><span class="bold">Review and document the data you gathered.</span> This step is crucial for continuity across the enterprise, and the resulting document should become part of the enterprise security policy. For example, this document should contain a list of protected application tables and corresponding justifications.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABBHHFE"></a>
<div id="TDPSG30354" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Tutorial: Applying Security Labels to the HR.LOCATIONS Table</h3>
<p><a id="ABC6626291"></a><a id="ABC6626291SRI1"></a>This tutorial demonstrates the general concepts of using Oracle Label Security. In it, you will apply security labels to the <code>HR.LOCATIONS</code> table. Three users, <code>sking</code>, <code>kpartner</code>, and <code>ldoran</code> will have access to specific rows within this table, based on the cities listed in the <code>LOCATIONS</code> table.</p>
<p>With Oracle Label Security, you restrict user access to data by focusing on row data, and designing different levels of access based on the sensitivity of your data. If you must restrict user access by focusing on user privileges, or some other method such as the job title that the user in your organization has, you can create a PL/SQL function or procedure to use with a Virtual Private Database policy. See <a href="#CHDBICEI">"Controlling Data Access with Oracle Virtual Private Database"</a> for more information.</p>
<p>The schema for <code>HR.LOCATIONS</code> is as follows:</p>
<pre>
Name                                      Null?    Type
----------------------------------------- -------- -------------
LOCATION_ID                               NOT NULL NUMBER(4)
STREET_ADDRESS                                     VARCHAR2(40)
POSTAL_CODE                                        VARCHAR2(12)
CITY                                      NOT NULL VARCHAR2(30)
STATE_PROVINCE                                     VARCHAR2(25)
COUNTRY_ID                                         CHAR(2)
</pre>
<p>You will apply the following labels:</p>
<div class="inftblhruleinformal">
<table class="cellalignment1881" title="OLS Labels Assigned to OE.CUSTOMERS" summary="Example labels for the customers table" dir="ltr">
<thead>
<tr class="cellalignment1875">
<th class="cellalignment1882" id="r1c1-t14">Label</th>
<th class="cellalignment1882" id="r1c2-t14">Privileges</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r2c1-t14" headers="r1c1-t14"><code>CONFIDENTIAL</code></td>
<td class="cellalignment1883" headers="r2c1-t14 r1c2-t14">Read access to the cities Munich, Oxford, and Roma</td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r3c1-t14" headers="r1c1-t14"><code>SENSITIVE</code></td>
<td class="cellalignment1883" headers="r3c1-t14 r1c2-t14">Read access to the cities Beijing, Tokyo, and Singapore</td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883" id="r4c1-t14" headers="r1c1-t14"><code>PUBLIC</code></td>
<td class="cellalignment1883" headers="r4c1-t14 r1c2-t14">Read access to all other cities listed in <code>HR.LOCATIONS</code></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblhruleinformal" -->
<p>In this tutorial:</p>
<ul>
<li>
<p><a href="#CIHHCEII">Step 1: Register Oracle Label Security and Enable the LBACSYS Account</a></p>
</li>
<li>
<p><a href="#CIHDGDFG">Step 2: Create a Role and Three Users for the Oracle Label Security Tutorial</a></p>
</li>
<li>
<p><a href="#BABCICBJ">Step 3: Create the ACCESS_LOCATIONS Oracle Label Security Policy</a></p>
</li>
<li>
<p><a href="#BABEJCDB">Step 4: Define the ACCESS_LOCATIONS Policy-Level Components</a></p>
</li>
<li>
<p><a href="#BABBDABC">Step 5: Create the ACCESS_LOCATIONS Policy Data Labels</a></p>
</li>
<li>
<p><a href="#BABEAHIJ">Step 6: Create the ACCESS_LOCATIONS Policy User Authorizations</a></p>
</li>
<li>
<p><a href="#BABBHCIE">Step 7: Apply the ACCESS_LOCATIONS Policy to the HR.LOCATIONS Table</a></p>
</li>
<li>
<p><a href="#CIHEHIFI">Step 8: Add the ACCESS_LOCATIONS Labels to the HR.LOCATIONS Data</a></p>
</li>
<li>
<p><a href="#CIHIFJAE">Step 9: Test the ACCESS_LOCATIONS Policy</a></p>
</li>
<li>
<p><a href="#CIHICGDG">Step 10: Optionally, Remove the Components for This Tutorial</a></p>
</li>
</ul>
<a id="CIHHCEII"></a>
<div id="TDPSG33541" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 1: Register Oracle Label Security and Enable the LBACSYS Account</h4>
<p>In a default Oracle Database installation, Oracle Label Security is installed. However, you must register Oracle Label Security and then enable the default Oracle Label Security account, which is called <code>LBACSYS</code>.</p>
<ul>
<li>
<p><a href="#CIHGGFGA">Registering Oracle Label Security with Oracle Database</a></p>
</li>
<li>
<p><a href="#CIHEIJGE">Enabling the Default Oracle Label Security User Account LBACSYS</a></p>
</li>
</ul>
<p class="subhead2"><a id="CIHGGFGA"></a><a id="TDPSG94384"></a>Registering Oracle Label Security with Oracle Database</p>
<p><a id="sthref422"></a>After you complete the installation, you must register Oracle Label Security with Oracle Database. You can check if Oracle Label Security is already registered by entering the following <code>SELECT</code> statement in SQL*Plus. The <code>PARAMETER</code> column is case sensitive, so use the case shown here.</p>
<pre>
SELECT * FROM V$OPTION WHERE PARAMETER = 'Oracle Label Security';
</pre>
<p>If the output is <code>TRUE</code>, then Oracle Label Security has been registered. Go to <a href="#CIHEIJGE">"Enabling the Default Oracle Label Security User Account LBACSYS"</a>. If it is <code>FALSE</code>, then register Oracle Label Security.</p>
<p class="orderedlisttitle">To register Oracle Label Security with Oracle Database:&nbsp;</p>
<ol>
<li>
<p>Stop the database, Database Control console process, and listener.</p>
<ul>
<li>
<p><span class="bold">UNIX:</span> Log in to SQL*Plus as user <code>SYS</code> with the <code>SYSOPER</code> privilege and shut down the database. Then from the command line, stop the Database Control console process and listener.</p>
<p>For example:</p>
<pre>
sqlplus sys as sysoper
Enter password: <span class="italic">password</span>

SQL&gt; SHUTDOWN IMMEDIATE
SQL&gt; EXIT

$ emctl stop dbconsole
$ lsnrctl stop [<span class="italic">listener_name</span>]
</pre>
<p>For Oracle RAC installations, shut down each database instance as follows:</p>
<pre>
$ srvctl stop database -d <span class="italic">db_name</span>
</pre></li>
<li>
<p><span class="bold">Windows:</span> Stop the database, Database Control console process, and listener from the Services tool in the Control Panel. The names of Oracle Database services begin with <code>Oracle</code>.</p>
</li>
</ul>
</li>
<li>
<p>Enable Oracle Label Security as follows:</p>
<ul>
<li>
<p><span class="bold">UNIX:</span> Run the following commands:</p>
<pre>
$ cd $ORACLE_HOME/rdbms/lib
$ make -f ins_rdbms.mk lbac_on ioracle
</pre></li>
<li>
<p><span class="bold">Windows:</span> In the <code><span class="codeinlineitalic">ORACLE_BASE\ORACLE_HOME</span></code><code>\bin</code> directory, rename the <code>oralbacll.dll.dbl</code> file to <code>oralbacll.dll</code>.</p>
</li>
</ul>
</li>
<li>
<p>Restart the database and listener. (Do not restart the Database Control console process yet.)</p>
<ul>
<li>
<p><span class="bold">UNIX:</span> Log in to SQL*Plus as user <code>SYS</code> with the <code>SYSOPER</code> privilege and restart the database. Then from the command line, restart the listener.</p>
<p>For example:</p>
<pre>
sqlplus sys as sysoper
Enter password: <span class="italic">password</span>

SQL&gt; STARTUP
SQL&gt; EXIT

$ lsnrctl start [<span class="italic">listener_name</span>]
</pre>
<p>For Oracle RAC installations, restart each database instance as follows:</p>
<pre>
$ srvctl start database -d <span class="italic">db_name</span>
</pre></li>
<li>
<p><span class="bold">Windows:</span> Restart the database and listener from the Services tool in the Control Panel. The names of Oracle Database services begin with <code>Oracle</code>.</p>
</li>
</ul>
</li>
<li>
<p>Start Database Configuration Assistant.</p>
<ul>
<li>
<p><span class="bold">UNIX:</span> Enter the following command at a terminal window:</p>
<pre>
dbca
</pre>
<p>Typically, <code>dbca</code> is in the <code>$ORACLE_HOME/bin</code> directory.</p>
</li>
<li>
<p><span class="bold">Windows:</span> From the <span class="bold">Start</span> menu, click <span class="bold">All Programs</span>. Then, click <span class="bold">Oracle -</span> <span class="bolditalic">ORACLE_HOME</span>, <span class="bold">Configuration and Migration Tools</span>, and then <span class="bold">Database Configuration Assistant</span>.</p>
<p>Alternatively, you can start Database Configuration Assistant at a command prompt:</p>
<pre>
dbca
</pre>
<p>As with UNIX, typically, <code>dbca</code> is in the <code><span class="codeinlineitalic">ORACLE_BASE</span></code><code>\</code><code><span class="codeinlineitalic">ORACLE_HOME</span></code><code>\bin</code> directory.</p>
</li>
</ul>
</li>
<li>
<p>In the Welcome page, click <span class="bold">Next</span>.</p>
<p>The Operations page appears.</p>
</li>
<li>
<p>Select <span class="bold">Configure Database Options</span>, and then click <span class="bold">Next</span>.</p>
<p>The Database page appears.</p>
</li>
<li>
<p>From the list, select the database where you installed Oracle Database and then enter the name and password of a user who has been granted the <code>DBA</code> role (for example, user <code>SYS</code>). Click <span class="bold">Next</span>.</p>
<p>The Database Content page appears.</p>
<img width="754" height="540" src="img/ols_config.gif" alt="Database Content page of DBCA" /><br />
<a id="sthref424" href="img_text/ols_config.htm">Description of the illustration ols_config.gif</a><br />
<br /></li>
<li>
<p>Select <span class="bold">Oracle Label Security</span> and then click <span class="bold">Next</span>.</p>
<p>The Connection Mode page appears.</p>
</li>
<li>
<p>Select either <span class="bold">Dedicated Server Mode</span> or <span class="bold">Shared Server Mode</span> (depending on the selection you made when you created this database), click <span class="bold">Finish</span>, and then click <span class="bold">OK</span> in the confirmation prompts.</p>
<p>Database Configuration Assistant registers Oracle Label Security, and then restarts the database instance.</p>
</li>
<li>
<p>Exit Database Configuration Assistant.</p>
</li>
<li>
<p>Restart the Database Control console process.</p>
<ul>
<li>
<p><span class="bold">UNIX:</span> Run the following command:</p>
<pre>
$ emctl start dbconsole
</pre></li>
<li>
<p><span class="bold">Windows:</span> Restart the Database Control console process (for example, OracleDBConsoleorcl if the database is named <code>orcl</code>) from the Services tool in the Control Panel.</p>
</li>
</ul>
</li>
</ol>
<p class="subhead2"><a id="CIHEIJGE"></a><a id="TDPSG94386"></a>Enabling the Default Oracle Label Security User Account LBACSYS</p>
<p>The Oracle Label Security installation process creates a default user account, <code>LBACSYS</code>, who manages the Oracle Label Security features. An administrator can create a user who has the same privileges as this user, that is, <code>EXECUTE</code> privileges on the <code>SA_SYSDBA</code>, <code>SA_COMPONENTS</code>, and <code>SA_LABEL_ADMIN</code> PL/SQL packages. By default, <code>LBACYS</code> is created as a locked account with its password expired. Your next step is to unlock <code>LBACYS</code> and create a new password. Because user <code>LBACSYS</code> is using Database Control to create the Oracle Label Security policy, you must grant the <code>SELECT ANY DICTIONARY</code> privilege to <code>LBACSYS</code>.</p>
<p class="orderedlisttitle">To enable the LBACSYS user account: &nbsp;</p>
<ol>
<li>
<p>Log in to Database Control as the user <code>SYS</code> with the <code>SYSDBA</code> privilege.</p>
</li>
<li>
<p>Click <span class="bold">Server</span> to display the Server subpage.</p>
</li>
<li>
<p>Under Security, select <span class="bold">Users</span>.</p>
<p>The Users page appears.</p>
</li>
<li>
<p>Select the <span class="bold">LBACSYS</span> user, and in the View User page, click <span class="bold">Edit</span>.</p>
<p>The Edit User page appears.</p>
</li>
<li>
<p>Next to Status, select <span class="bold">Unlocked</span>.</p>
</li>
<li>
<p>In the <span class="bold">Enter Password</span> and <span class="bold">Confirm Password</span> fields, enter a secure password, according to the guidelines in <a href="tdpsg_user_accounts.htm#BEICECGF">"Requirements for Creating Passwords"</a>.</p>
<p>For greater security, do not reuse the same password that was used in previous releases of Oracle Database.</p>
</li>
<li>
<p>Click <span class="bold">Roles</span> to display the Edit User: LBACSYS page.</p>
</li>
<li>
<p>Click <span class="bold">Edit List</span>.</p>
<p>The Modify Roles page appears.</p>
</li>
<li>
<p>In the Available Roles list, select the <span class="bold">SELECT_CATALOG_ROLE</span> role and then then click <span class="bold">Move</span> to move it to the Selected Roles list. Then click <span class="bold">OK</span> to return to the Edit User page.</p>
</li>
<li id="CIADAECH">
<p>Click <span class="bold">System Privileges</span>.</p>
</li>
<li>
<p>Click <span class="bold">Edit List</span>.</p>
<p>The Modify System Privileges page appears.</p>
</li>
<li>
<p>In the Available System Privileges list, select <code>SELECT ANY DICTIONARY</code>, and then click <span class="bold">Move</span> to move it to the Selected System Privileges list. Then click <span class="bold">OK</span> to return to the Edit User page.</p>
</li>
<li>
<p>Select <span class="bold">Object Privileges</span>.</p>
</li>
<li>
<p>In the <span class="bold">Select Object Type</span> list, select <span class="bold">Package</span> and then click <span class="bold">Add</span>.</p>
</li>
<li>
<p>In the Add Package Object Privileges page, do the following:</p>
<ol>
<li>
<p>Under Select Package Objects, select the flashlight icon to display the Select Package Objects window.</p>
</li>
<li>
<p>Set the Schema to <span class="bold">LBACSYS</span>.</p>
</li>
<li>
<p>Enter <code>%</code> in the <span class="bold">Search Package Name</span> field and then click <span class="bold">Go</span>.</p>
</li>
<li>
<p>Select all the package objects listed, for both pages of listed objects.</p>
</li>
<li>
<p>Click <span class="bold">Select</span> to return to the Add Package Object Privileges window.</p>
</li>
<li>
<p>Under Available Privileges, move the <span class="bold">EXECUTE</span> privilege to the Selected Privileges list.</p>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
</li>
</ol>
</li>
<li id="CIAEGGGC">
<p>Click <span class="bold">OK</span> to return to the Edit User page, and then click <span class="bold">Apply</span> to apply the changes.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIHDGDFG"></a>
<div id="TDPSG33542" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 2: Create a Role and Three Users for the Oracle Label Security Tutorial</h4>
<p>You are ready to create a role and three users, and then grant these users the role.</p>
<ul>
<li>
<p><a href="#CIHGBBJC">Creating a Role</a></p>
</li>
<li>
<p><a href="#CIHEDHFH">Creating the Users</a></p>
</li>
</ul>
<p class="subhead2"><a id="CIHGBBJC"></a><a id="TDPSG94388"></a>Creating a Role</p>
<p>The <code>emp_role</code> role provides the necessary privileges for the three users you will create.</p>
<p class="orderedlisttitle">To create the role emp_role:&nbsp;</p>
<ol>
<li>
<p>Connect to Database Control as user <code>SYSTEM</code>.</p>
</li>
<li>
<p>From the Database Home page, click <span class="bold">Server</span> to display the Server subpage.</p>
</li>
<li>
<p>In the Security section, click <span class="bold">Roles</span>.</p>
<p>The Roles page appears.</p>
</li>
<li>
<p>Click <span class="bold">Create</span>.</p>
<p>The Create Role page appears.</p>
</li>
<li>
<p>In the <span class="bold">Name</span> field, enter <code>EMP_ROLE</code> and leave Authentication set to <span class="bold">None</span>.</p>
</li>
<li>
<p>Select the <span class="bold">Object Privileges</span> subpage.</p>
</li>
<li>
<p>From the <span class="bold">Select Object Type</span> list, select <span class="bold">Table</span>, and then click <span class="bold">Add</span>.</p>
<p>The Add Table Object Privileges page appears.</p>
</li>
<li>
<p>Under Select Table Objects, enter <code>HR.LOCATIONS</code> to select the <code>LOCATIONS</code> table in the <code>HR</code> schema, and then under Available Privileges, move <code>SELECT</code> to the Selected Privileges list.</p>
</li>
<li>
<p>Click <span class="bold">OK</span> to return to the Create Role page, and then click <span class="bold">OK</span> to return to the Roles page.</p>
</li>
</ol>
<p class="subhead2"><a id="CIHEDHFH"></a><a id="TDPSG94390"></a>Creating the Users</p>
<p>The three users you create will have different levels of access to the <code>HR.LOCATIONS</code> table, depending on their position. Steven King (<code>sking</code>) is the advertising president, so he has full read access to the <code>HR.LOCATIONS</code> table. Karen Partners (<code>kpartner</code>) is a sales manager who has less access, and Louise Doran (<code>ldoran</code>) is a sales representative who has the least access.</p>
<p class="orderedlisttitle">To create the users:&nbsp;</p>
<ol>
<li>
<p>Ensure that you are logged in to Database Control as <code>SYSTEM</code>.</p>
<p>If you are not already logged in as <code>SYSTEM</code>, then select <span class="bold">Logout</span>, and then select <span class="bold">Login</span>. In the Login page, enter <code>SYSTEM</code> and the password assigned to that account. Set <span class="bold">Connect As</span> to <span class="bold">Normal</span>. Select <span class="bold">Login</span> to log in.</p>
<p>If you are logged in as <code>SYSTEM</code>, click the <span class="bold">Database Instance</span> link to display the home page.</p>
</li>
<li>
<p>Click <span class="bold">Server</span> to display the Server subpage.</p>
</li>
<li>
<p>In the Security section, click <span class="bold">Users</span>.</p>
<p>The Users page appears.</p>
</li>
<li>
<p>Click <span class="bold">Create</span>.</p>
<p>The Create User page appears.</p>
</li>
<li>
<p>Enter the following information:</p>
<ul>
<li>
<p><span class="bold">Name</span>: <code>SKING</code></p>
</li>
<li>
<p><span class="bold">Profile</span>: <code>DEFAULT</code></p>
</li>
<li>
<p><span class="bold">Authentication</span>: Password</p>
</li>
<li>
<p><span class="bold">Enter Password</span> and <span class="bold">Confirm Password</span>: Enter a password that meets the requirements in <a href="tdpsg_user_accounts.htm#BEICECGF">"Requirements for Creating Passwords"</a>.</p>
</li>
<li>
<p><span class="bold">Default Tablespace</span>: <code>USERS</code></p>
</li>
<li>
<p><span class="bold">Temporary Tablespace</span>: <code>TEMP</code></p>
</li>
<li>
<p><span class="bold">Status:</span> Set to <span class="bold">Unlocked</span>.</p>
</li>
<li>
<p><span class="bold">Roles</span>: Select the <span class="bold">Roles</span> subpage, and then grant the <code>emp_role</code> role to <code>sking</code> by selecting <span class="bold">Edit List</span>. From the Available Roles list, select <code>emp_role</code>, and then click <span class="bold">Move</span> to move it to the Selected Roles list. Click <span class="bold">OK</span>. In the Create User page, ensure that the <span class="bold">Default</span> box is selected for both the <code>CONNECT</code> and <code>emp_role</code> roles.</p>
</li>
<li>
<p><span class="bold">System Privileges</span>: Select the <span class="bold">System Privileges</span> subpage and then click <span class="bold">Edit List</span> to grant the <code>CREATE SESSION</code> privileges. Do not grant <code>sking</code> the <code>ADMIN OPTION</code> option.</p>
</li>
</ul>
</li>
<li>
<p>Click <span class="bold">OK</span> to return to the Create User page, and then from there, click <span class="bold">OK</span> to return to the Users page.</p>
</li>
<li>
<p>In the Users page, select <code>SKING</code>, set <span class="bold">Actions</span> to <span class="bold">Create Like</span>, and then click <span class="bold">Go</span>.</p>
<p>The Create User page appears.</p>
</li>
<li>
<p>Create accounts for <code>kpartner</code> and <code>ldoran</code>.</p>
<p>Create their names and passwords. (See <a href="tdpsg_user_accounts.htm#BEICECGF">"Requirements for Creating Passwords"</a>.) You do not need to grant roles or system privileges to them. Their roles and system privileges, defined in the <code>sking</code> account, are automatically created.</p>
</li>
</ol>
<p>At this stage, you have created three users who have identical privileges. All of these users have the <code>SELECT</code> privilege on the <code>HR.LOCATIONS</code> table, through the <code>EMP_ROLE</code> role.</p>
</div>
<!-- class="sect3" -->
<a id="BABCICBJ"></a>
<div id="TDPSG33543" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 3: Create the ACCESS_LOCATIONS Oracle Label Security Policy</h4>
<p>Next, you are ready to create the <code>ACCESS_LOCATIONS</code> policy.</p>
<p class="orderedlisttitle">To create the ACCESS_LOCATIONS policy:&nbsp;</p>
<ol>
<li>
<p>Log in to Database Control as user <code>LBACSYS</code>.</p>
<p>Select <span class="bold">Logout</span>, and then select <span class="bold">Login</span>. In the Login page, log in as user <code>LBACSYS</code>. Set <span class="bold">Connect As</span> to <span class="bold">Normal</span>. Select <span class="bold">Login</span> to log in.</p>
</li>
<li>
<p>Click <span class="bold">Server</span> to display the Server subpage.</p>
</li>
<li>
<p>In the Security section, click <span class="bold">Oracle Label Security</span>.</p>
<p>The Label Security Policies page appears.</p>
</li>
<li>
<p>Click <span class="bold">Create</span>.</p>
</li>
<li>
<p>In the Create Label Security Policy page, enter the following information:</p>
<ul>
<li>
<p><span class="bold">Name</span>: <code>ACCESS_LOCATIONS</code></p>
</li>
<li>
<p><span class="bold">Label Column</span>: <code>OLS_COLUMN</code></p>
<p>Later on, when you apply the policy to a table, the label column is added to that table. By default, the data type of the policy label column is <code>NUMBER(10)</code>.</p>
</li>
<li>
<p><span class="bold">Hide Label Column</span>: Deselect this box so that the label column will not be hidden. (It should be deselected by default.)</p>
<p>Usually, the label column is hidden, but during the development phase, you may want to have it visible so that you can check it. After the policy is created and working, hide this column so that it is transparent to applications. Many applications are designed not to show an another column, so hiding the column prevents the application from breaking.</p>
</li>
<li>
<p><span class="bold">Enabled</span>: Select this box to enable the policy. (It should be enabled by default.)</p>
</li>
<li>
<p><span class="bold">Inverse user's read and write groups (INVERSE_GROUP)</span>: Do not select this option.</p>
</li>
<li>
<p><span class="bold">Default Policy Enforcement Options</span>: Select <span class="bold">Apply Policy Enforcements</span>, and then select the following options:</p>
<p><span class="bold">For all queries (READ_CONTROL)</span></p>
<p><span class="bold">To use session's default label for label column update (LABEL_DEFAULT)</span></p>
</li>
</ul>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
<p>The <code>ACCESS_LOCATIONS</code> policy appears in the Label Security Policies page.</p>
<img width="538" height="364" src="img/ols_new_policy.gif" alt="Description of ols_new_policy.gif follows" /><br />
<a id="sthref429" href="img_text/ols_new_policy.htm">Description of the illustration ols_new_policy.gif</a><br />
<br /></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="BABEJCDB"></a>
<div id="TDPSG3354" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 4: Define the ACCESS_LOCATIONS Policy-Level Components</h4>
<p>At this stage, you have the policy and have set enforcement options for it. Next, you are ready to create label components for the policy.</p>
<p>At a minimum, you must create one or more levels, such as <code>PUBLIC</code> or <code>SENSITIVE</code>; and define a long name, a short name, and a number indicating the sensitivity level. Compartments and groups are optional.</p>
<p>The level numbers indicate the level of sensitivity needed for their corresponding labels. Select a numeric range that can be expanded later on, in case your security policy needs more levels. For example, to create the additional levels <code>LOW_SENSITIVITY</code> and <code>HIGH_SENSITIVITY</code>, you can assign them numbers 7300 (for <code>LOW_SENSITIVITY</code>) and 7600 (for <code>HIGH_SENSITIVITY</code>), so that they fit in the scale of security your policy creates. Generally, the higher the number, the more sensitive the data.</p>
<p>Compartments identify areas that describe the sensitivity of the labeled data, providing a finer level of granularity within a level. Compartments are optional.</p>
<p>Groups identify organizations owning or accessing the data. Groups are useful for the controlled dissemination of data and for timely reaction to organizational change. Groups are optional.</p>
<p>In this step, you define the level components, which reflect the names and relationships of the <code>SENSITIVE</code>, <code>CONFIDENTIAL</code>, and <code>PUBLIC</code> labels that you must create for the <code>ACCESS_LOCATIONS</code> policy.</p>
<p class="orderedlisttitle">To define the label components for the ACCESS_LOCATIONS policy: &nbsp;</p>
<ol>
<li>
<p>In the Label Security policies page, select the <span class="bold">ACCESS_LOCATIONS</span> policy, and then select <span class="bold">Edit</span>.</p>
<p>The Edit Label Security Policy page appears.</p>
</li>
<li>
<p>Select the <span class="bold">Label Components</span> subpage.</p>
</li>
<li>
<p>Under Levels, click <span class="bold">Add 5 Rows</span>, and then enter a long name, short name, and a numeric tag as follows. (To move from one field to the next, press the <span class="bold">Tab</span> key.)</p>
<div class="inftblsimple">
<table class="cellalignment1886" title="Values for OLS Levels" summary="Values for OLS Levels" dir="ltr">
<thead>
<tr class="cellalignment1875">
<th class="cellalignment1882"><br /></th>
<th class="cellalignment1882">Long Name</th>
<th class="cellalignment1882">Short Name</th>
<th class="cellalignment1882">Numeric Tag</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1875">
<td class="cellalignment1883">&nbsp;</td>
<td class="cellalignment1883"><code>SENSITIVE</code></td>
<td class="cellalignment1883"><code>SENS</code></td>
<td class="cellalignment1883"><code>3000</code></td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883">&nbsp;</td>
<td class="cellalignment1883"><code>CONFIDENTIAL</code></td>
<td class="cellalignment1883"><code>CONF</code></td>
<td class="cellalignment1883"><code>2000</code></td>
</tr>
<tr class="cellalignment1875">
<td class="cellalignment1883">&nbsp;</td>
<td class="cellalignment1883"><code>PUBLIC</code></td>
<td class="cellalignment1883"><code>PUB</code></td>
<td class="cellalignment1883"><code>1000</code></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblsimple" --></li>
<li>
<p>Click <span class="bold">Apply</span>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="BABBDABC"></a>
<div id="TDPSG33545" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 5: Create the ACCESS_LOCATIONS Policy Data Labels</h4>
<p>In this step, you create data labels for the policy you created in <a href="#BABEJCDB">Step 4: Define the ACCESS_LOCATIONS Policy-Level Components</a>. To create the data label, you must assign a numeric tag to each level. Later on, the tag number will be stored in the security column when you apply the policy to a table. It has nothing to do with the sensitivity of the label; it is only used to identify the labels for the policy.</p>
<p class="orderedlisttitle">To create the data labels:&nbsp;</p>
<ol>
<li>
<p>Return to the Label Security policies page by selecting the <span class="bold">Label Security Policies</span> link.</p>
</li>
<li>
<p>Select the selection button for the <span class="bold">ACCESS_LOCATIONS</span> policy.</p>
</li>
<li>
<p>In the Actions list, select <span class="bold">Data Labels</span>, and then click <span class="bold">Go</span>.</p>
<p>The Data Labels page appears.</p>
</li>
<li>
<p>Click <span class="bold">Add</span>.</p>
<p>The Create Data Label page appears.</p>
</li>
<li>
<p>Enter the following information:</p>
<ul>
<li>
<p><span class="bold">Numeric Tag</span>: Enter <code>1000</code>.</p>
</li>
<li>
<p><span class="bold">Level</span>: Enter <code>PUB</code>.</p>
<img width="704" height="141" src="img/ols_dlabel.gif" alt="Description of ols_dlabel.gif follows" /><br />
<a id="sthref432" href="img_text/ols_dlabel.htm">Description of the illustration ols_dlabel.gif</a><br />
<br /></li>
</ul>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
<p>The data label appears in the Data Labels page.</p>
</li>
<li>
<p>Click <span class="bold">Add</span> again, and then create a data label for the <code>CONF</code> label as follows:</p>
<ul>
<li>
<p><span class="bold">Numeric Tag:</span> Enter <code>2000</code>.</p>
</li>
<li>
<p><span class="bold">Level:</span> Select <code>CONF</code> from the list.</p>
</li>
</ul>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
</li>
<li>
<p>Click <span class="bold">Add</span> again, and then create a data label for the <code>SENS</code> label as follows:</p>
<ul>
<li>
<p><span class="bold">Numeric Tag:</span> Enter <code>3000</code>.</p>
</li>
<li>
<p><span class="bold">Level:</span> Select <code>SENS</code> from the list.</p>
</li>
</ul>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
<p>At this stage, the <code>CONF</code>, <code>PUB</code>, and <code>SENS</code> labels appear in the Data Labels page.</p>
<img width="619" height="143" src="img/ols_dlabel2.gif" alt="Description of ols_dlabel2.gif follows" /><br />
<a id="sthref433" href="img_text/ols_dlabel2.htm">Description of the illustration ols_dlabel2.gif</a><br />
<br />
<p>Later, the tag number will be stored in the security column when you apply the policy to the <code>HR.LOCATIONS</code> table. It has nothing to do with the sensitivity of the label; it is only used to identify the labels for the policy.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="BABEAHIJ"></a>
<div id="TDPSG33546" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 6: Create the ACCESS_LOCATIONS Policy User Authorizations</h4>
<p>Next, you are ready to create user authorizations for the policy.</p>
<p class="orderedlisttitle">To create user authorizations for the policy: &nbsp;</p>
<ol>
<li>
<p>Return to the Label Security policies page by selecting the <span class="bold">Label Security Policies</span> link.</p>
</li>
<li>
<p>Select the selection button for the <code>ACCESS_LOCATIONS</code> policy.</p>
</li>
<li>
<p>In the <span class="bold">Actions</span> list, select <span class="bold">Authorization</span>, and then click <span class="bold">Go</span>.</p>
<p>The Authorization page appears.</p>
</li>
<li id="CIAJBAHJ">
<p>Click <span class="bold">Add Users</span>.</p>
<p>The Add User: Users page appears.</p>
</li>
<li>
<p>Under Database Users, click <span class="bold">Add</span>.</p>
<p>The Search and Select: Userpage appears. Enter <code>SKING</code>, and then click <span class="bold">Go</span>.</p>
<p>Typically, a database user account already has been created in the database, for example, by using the <code>CREATE USER</code> SQL statement.</p>
<p>The other option is <span class="bold">Non Database Users</span>. Most application users are considered nondatabase users. A nondatabase user does not exist in the database. This can be any user name that meets the Oracle Label Security naming standards and can fit into the <code>VARCHAR2(30)</code> length field. However, be aware that Oracle Database does not automatically configure the associated security information for the nondatabase user when the application connects to the database. In this case, the application must call an Oracle Label Security function to assume the label authorizations of the specified user who is not a database user.</p>
</li>
<li>
<p>Select the check box for user <code>SKING</code>, and then click <span class="bold">Select</span>.</p>
<p>The Create User page lists user <code>SKING</code>.</p>
<img width="395" height="209" src="img/ols_auth_user.gif" alt="Description of ols_auth_user.gif follows" /><br />
<a id="sthref435" href="img_text/ols_auth_user.htm">Description of the illustration ols_auth_user.gif</a><br />
<br /></li>
<li>
<p>Select the check box for user <span class="bold">SKING</span> and then click <span class="bold">Next</span>.</p>
<p>(You may need to refresh the page to display user <code>SKING</code>'s check box.)</p>
</li>
<li>
<p>In the Labels, Compartments and Groups page, enter the following settings:</p>
<ul>
<li>
<p><span class="bold">Maximum Level</span>: <code>SENS</code> (for <code>SENSITIVE</code>)</p>
</li>
<li>
<p><span class="bold">Minimum Level</span>: <code>CONF</code> (for <code>CONFIDENTIAL</code>)</p>
</li>
<li>
<p><span class="bold">Default Level</span>: <code>SENS</code></p>
</li>
<li>
<p><span class="bold">Row Level</span>: <code>SENS</code></p>
</li>
</ul>
</li>
<li>
<p>Click <span class="bold">Next</span> to go to the Privileges page.</p>
</li>
<li>
<p>In the Privileges page, select <span class="bold">Next</span> to move to the Audit page.</p>
<p>Oracle Label Security enforces the policy through the label authorizations. The Privileges page enables the user to override the policy label authorization, so do not select any of its options.</p>
</li>
<li>
<p>In the Audit pane of the Add Users: Audit page, ensure that all of the audit operations are set to <code>None</code>, and then click <span class="bold">Next</span>.</p>
<p>The Review page appears.</p>
<img width="926" height="575" src="img/ols_auth.gif" alt="Description of ols_auth.gif follows" /><br />
<a id="sthref436" href="img_text/ols_auth.htm">Description of the illustration ols_auth.gif</a><br />
<br /></li>
<li id="CIAIGJDB">
<p>Ensure that the settings are correct, and then click <span class="bold">Finish</span>.</p>
<p>The Review page lists all the authorization settings you have selected.</p>
</li>
<li>
<p>Repeat Step <a href="#CIAJBAHJ">4</a> through Step <a href="#CIAIGJDB">12</a> to create the following authorizations for user <code>KPARTNER</code>, so that she can read confidential and public data in <code>HR.LOCATIONS</code>.</p>
<ul>
<li>
<p><span class="bold">Labels, Compartments And Groups</span>: Set all four levels to the following:</p>
<ul>
<li>
<p><span class="bold">Maximum Level</span>: <code>CONF</code> (for <code>CONFIDENTIAL</code>)</p>
</li>
<li>
<p><span class="bold">Minimum Level</span>: <code>PUB</code> (for <code>PUBLIC</code>)</p>
</li>
<li>
<p><span class="bold">Default Level</span>: <code>CONF</code></p>
</li>
<li>
<p><span class="bold">Row Level</span>: <code>CONF</code></p>
</li>
</ul>
</li>
<li>
<p><span class="bold">Privileges</span>: Select no privileges.</p>
</li>
<li>
<p><span class="bold">Audit</span>: Set all to <code>None</code>.</p>
</li>
</ul>
</li>
<li>
<p>Create the following authorizations for user <code>LDORAN</code>, who is only allowed to read public data from <code>HR.LOCATIONS</code>:</p>
<ul>
<li>
<p><span class="bold">Labels, Compartments And Groups</span>: Set all four levels to <code>PUB</code>.</p>
</li>
<li>
<p><span class="bold">Privileges</span>: Select no privileges.</p>
</li>
<li>
<p><span class="bold">Audit</span>: Set all to <code>None</code>.</p>
</li>
</ul>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="BABBHCIE"></a>
<div id="TDPSG33547" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 7: Apply the ACCESS_LOCATIONS Policy to the HR.LOCATIONS Table</h4>
<p>Next, you are ready to apply the policy to the <code>HR.LOCATIONS</code> table.</p>
<p class="orderedlisttitle">To apply the ACCESS_LOCATIONS policy to the HR.LOCATIONS table:&nbsp;</p>
<ol>
<li>
<p>Return to the Label Security policies page by selecting the <span class="bold">Label Security Policies</span> link.</p>
</li>
<li>
<p>Select the selection button for the <code>ACCESS_LOCATIONS</code> policy.</p>
</li>
<li>
<p>In the <span class="bold">Actions</span> list, select <span class="bold">Apply</span>, and then click <span class="bold">Go</span>.</p>
<p>The Apply page appears.</p>
</li>
<li>
<p>Click <span class="bold">Create</span>.</p>
<p>The Add Table page appears.</p>
</li>
<li>
<p>In the <span class="bold">Table</span> field, enter <code>HR.LOCATIONS</code>.</p>
</li>
<li>
<p>Ensure that the <span class="bold">Hide Policy Column</span> box is not selected.</p>
</li>
<li>
<p>Ensure that the <span class="bold">Enabled</span> box is selected.</p>
</li>
<li>
<p>Under Policy Enforcement Options, select <span class="bold">Use Default Policy Enforcement</span>.</p>
<p>The default policy enforcement options for <code>ACCESS_LOCATIONS</code> are:</p>
<ul>
<li>
<p><span class="bold">For all queries (READ_CONTROL)</span></p>
</li>
<li>
<p><span class="bold">Use session's default label for label column update (LABEL_DEFAULT)</span></p>
</li>
</ul>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
<p>The <code>ACCESS_LOCATIONS</code> policy is applied to the <code>HR.LOCATIONS</code> table.</p>
<img width="783" height="112" src="img/ols_apply.gif" alt="Description of ols_apply.gif follows" /><br />
<a id="sthref438" href="img_text/ols_apply.htm">Description of the illustration ols_apply.gif</a><br />
<br /></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIHEHIFI"></a>
<div id="TDPSG33548" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 8: Add the ACCESS_LOCATIONS Labels to the HR.LOCATIONS Data</h4>
<p>After you have applied the <code>ACCESS_LOCATIONS</code> policy to the <code>HR.LOCATIONS</code> table, you must apply the labels of the policy to the <code>OLS_COLUMN</code> in <code>LOCATIONS</code>. For the user <code>HR</code> (the owner of that table) to accomplish this, the user must have <code>FULL</code> access to locations before being able to add the data labels to the hidden <code>OLS_COLUMN</code> column in <code>LOCATIONS</code>.</p>
<ul>
<li>
<p><a href="#CIHEIJEF">Granting HR FULL Policy Privilege for the HR.LOCATIONS Table</a></p>
</li>
<li>
<p><a href="#CIHDFGAF">Updating the OLS_COLUMN Table in HR.LOCATIONS</a></p>
</li>
</ul>
<p class="subhead2"><a id="CIHEIJEF"></a><a id="TDPSG94397"></a>Granting HR FULL Policy Privilege for the HR.LOCATIONS Table</p>
<p>The label security administrative user, <code>LBACSYS</code>, can grant <code>HR</code> the necessary privilege.</p>
<p class="orderedlisttitle">To grant HR FULL access to the ACCESS_LOCATIONS policy:&nbsp;</p>
<ol>
<li>
<p>Return to the Label Security policies page by selecting the <span class="bold">Label Security Policies</span> link.</p>
</li>
<li>
<p>Select the selection button for the <span class="bold">ACCESS_LOCATIONS</span> policy.</p>
</li>
<li>
<p>Select <span class="bold">Authorization</span> from the <span class="bold">Actions</span> list, and then click <span class="bold">Go</span>.</p>
<p>The Authorization page appears.</p>
</li>
<li>
<p>Click <span class="bold">Add Users</span>.</p>
<p>The Add Users page appears.</p>
</li>
<li>
<p>Under Database Users, click <span class="bold">Add</span>.</p>
<p>The Search and Select window appears.</p>
</li>
<li>
<p>Select the box for user <code>HR</code>, and then click <span class="bold">Select</span>.</p>
<p>The Create User page lists user <code>HR</code>.</p>
</li>
<li>
<p>Click <span class="bold">Next</span> to display the Add Users: Levels, Compartments and Groups page, and then click <span class="bold">Next</span> again to display the Privileges page.</p>
</li>
<li>
<p>Select the <span class="bold">Bypass all Label Security checks (FULL)</span> privilege, and then click <span class="bold">Next</span>.</p>
<p>The Audit page appears.</p>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
<p>The Review page appears.</p>
</li>
<li>
<p>Click <span class="bold">Finish</span>.</p>
<p>At this stage, <code>HR</code> is listed in the Authorization page with the other users.</p>
<img width="716" height="172" src="img/ols_hr_added.gif" alt="Description of ols_hr_added.gif follows" /><br />
<a id="sthref440" href="img_text/ols_hr_added.htm">Description of the illustration ols_hr_added.gif</a><br />
<br /></li>
<li>
<p>Exit Database Control.</p>
</li>
</ol>
<p class="subhead2"><a id="CIHDFGAF"></a><a id="TDPSG94399"></a>Updating the OLS_COLUMN Table in HR.LOCATIONS</p>
<p>The user <code>HR</code> now can update the <code>OLS_COLUMN</code> column in the <code>HR.LOCATIONS</code> table to include data labels that will be assigned to specific rows in the table, based on the cities listed in the <code>CITY</code> column.</p>
<p class="orderedlisttitle">To update the OLS_COLUMN table in HR.LOCATIONS:&nbsp;</p>
<ol>
<li>
<p>In SQL*Plus, connect as user <code>HR</code>.</p>
<pre>
CONNECT HR
Enter password: <span class="italic">password</span>
</pre>
<p>If you cannot log in as <code>HR</code> because this account locked and expired, log in as <code>SYSTEM</code> and then enter the following statement. Replace <span class="italic">password</span> with an appropriate password for the <code>HR</code> account. For greater security, do not reuse the same password that was used in previous releases of Oracle Database. See <a href="tdpsg_user_accounts.htm#BEICECGF">"Requirements for Creating Passwords"</a>.</p>
<pre>
ALTER USER HR ACCOUNT UNLOCK IDENTIFIED BY <span class="italic">password</span>
</pre>
<p>After you complete this <code>ALTER USER</code> statement, try logging in as user <code>HR</code> again.</p>
</li>
<li>
<p>Enter the following <code>UPDATE</code> statement to apply the <code>SENS</code> label to the cities Beijing, Tokyo, and Singapore:</p>
<pre>
UPDATE LOCATIONS
SET ols_column = CHAR_TO_LABEL('ACCESS_LOCATIONS','SENS')
WHERE UPPER(city) IN ('BEIJING', 'TOKYO', 'SINGAPORE');
</pre></li>
<li>
<p>Enter the following <code>UPDATE</code> statement to apply the <code>CONF</code> label to the cities Munich, Oxford, and Roma:</p>
<pre>
UPDATE LOCATIONS
SET ols_column = CHAR_TO_LABEL('ACCESS_LOCATIONS','CONF')
WHERE UPPER(city) IN ('MUNICH', 'OXFORD', 'ROMA');
</pre></li>
<li>
<p>Enter the following <code>UPDATE</code> statement to apply the <code>PUB</code> label to the remaining cities:</p>
<pre>
UPDATE LOCATIONS
SET ols_column = CHAR_TO_LABEL('ACCESS_LOCATIONS','PUB')
WHERE ols_column IS NULL;
</pre></li>
<li>
<p>To check that the columns were updated, enter the following statement:</p>
<pre>
SELECT LABEL_TO_CHAR (OLS_COLUMN) FROM LOCATIONS;
</pre>
<p>The following output should appear:</p>
<pre>
LABEL_TO_CHAR(OLS_COLUMN)
-----------------------------------------------------------------------------
CONF
PUB
SENS
PUB
PUB
PUB
PUB
PUB
PUB
PUB
SENS
 
LABEL_TO_CHAR(OLS_COLUMN)
-----------------------------------------------------------------------------
PUB
PUB
SENS
PUB
CONF
PUB
CONF
PUB
PUB
PUB
PUB
 
LABEL_TO_CHAR(OLS_COLUMN)
-----------------------------------------------------------------------------
PUB
 
23 rows selected. 
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
Using the label column name (<code>OLS_COLUMN</code>) explicitly in the preceding query enables you to see the label column, even if it was hidden.
<p>If the label column is hidden, and you do not specify the label column name explicitly, then the label column is not displayed in the query results. For example, using the <code>SELECT * FROM LOCATIONS</code> query does not show the label column if it is hidden. This feature enables the label column to remain transparent to applications. An application that was designed before the label column was added does not know about the label column and will never see it.</p>
</div>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIHIFJAE"></a>
<div id="TDPSG33549" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 9: Test the ACCESS_LOCATIONS Policy</h4>
<p>The <code>ACCESS_LOCATIONS</code> policy is complete and ready to be tested. You can test it by logging in to SQL*Plus as each of the three users and performing a <code>SELECT</code> on the <code>HR.LOCATIONS</code> table.</p>
<p class="orderedlisttitle">To test the ACCESS_LOCATIONS policy:&nbsp;</p>
<ol>
<li id="CIAFECDF">
<p>In SQL*Plus, connect as user <code>sking</code>.</p>
<pre>
CONNECT sking
Enter password: <span class="italic">password</span>
</pre></li>
<li id="CIAHBDEI">
<p>Enter the following:</p>
<p>The following commands format the width of the table columns so that you can read them easier. You only need to perform this step once for the entire session (including when <code>kpartner</code> and <code>ldoran</code> log in.)</p>
<pre>
COL city HEADING City FORMAT a25
COL country_id HEADING Country FORMAT a11
COL Label format a10
</pre>
<p>Now enter the <code>SELECT</code> statement as follows:</p>
<pre>
SELECT city, country_id, LABEL_TO_CHAR (OLS_COLUMN)
   AS Label FROM hr.locations ORDER BY ols_column;
</pre>
<p>User <code>sking</code> is able to access all 23 rows of the <code>HR.LOCATIONS</code> table. Even though he is only authorized to access rows that are labeled <code>CONF</code> and <code>SENS</code>, he can still read (but not write to) rows labeled <code>PUB</code>.</p>
<pre>
City                      Country     LABEL
------------------------- ----------- ----------
Venice                    IT          PUB
Utrecht                   NL          PUB
Bern                      CH          PUB
Geneva                    CH          PUB
Sao Paulo                 BR          PUB
Stretford                 UK          PUB
Mexico City               MX          PUB
Hiroshima                 JP          PUB
Southlake                 US          PUB
South San Francisco       US          PUB
South Brunswick           US          PUB
Seattle                   US          PUB
Toronto                   CA          PUB
Whitehorse                CA          PUB
Bombay                    IN          PUB
Sydney                    AU          PUB
London                    UK          PUB
Oxford                    UK          CONF
Munich                    DE          CONF
Roma                      IT          CONF
Singapore                 SG          SENS
Tokyo                     JP          SENS
Beijing                   CN          SENS

23 rows selected.
</pre></li>
<li>
<p>Repeat Steps <a href="#CIAFECDF">1</a> and <a href="#CIAHBDEI">2</a> for users <code>kpartner</code> and <code>ldoran</code>.</p>
<p>User <code>KPARTNER</code> can access the rows labeled <code>CONF</code> and <code>PUB</code>:</p>
<pre>
City                      Country     LABEL
------------------------- ----------- ----------
Venice                    IT          PUB
Utrecht                   NL          PUB
Bern                      CH          PUB
Mexico City               MX          PUB
Hiroshima                 JP          PUB
Southlake                 US          PUB
South San Francisco       US          PUB
South Brunswick           US          PUB
Seattle                   US          PUB
Toronto                   CA          PUB
Whitehorse                CA          PUB
Bombay                    IN          PUB
Sydney                    AU          PUB
London                    UK          PUB
Stretford                 UK          PUB
Sao Paulo                 BR          PUB
Geneva                    CH          PUB
Oxford                    UK          CONF
Munich                    DE          CONF
Roma                      IT          CONF
 
20 rows selected.
</pre>
<p>User <code>LDORAN</code> can access the rows labeled <code>PUB</code>:</p>
<pre>
City                      Country     LABEL
------------------------- ----------- ----------
Venice                    IT          PUB
Hiroshima                 JP          PUB
Southlake                 US          PUB
South San Francisco       US          PUB
South Brunswick           US          PUB
Seattle                   US          PUB
Toronto                   CA          PUB
Whitehorse                CA          PUB
Bombay                    IN          PUB
Sydney                    AU          PUB
London                    UK          PUB
Stretford                 UK          PUB
Sao Paulo                 BR          PUB
Geneva                    CH          PUB
Bern                      CH          PUB
Utrecht                   NL          PUB
Mexico City               MX          PUB
 
17 rows selected.
</pre></li>
<li>
<p>Exit SQL*Plus.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIHICGDG"></a>
<div id="TDPSG93549" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 10: Optionally, Remove the Components for This Tutorial</h4>
<p>Remove the components that you created for this tutorial.</p>
<p class="orderedlisttitle">To remove the components for this tutorial:&nbsp;</p>
<ol>
<li>
<p>In Database Control, connect as user <code>SYSTEM</code>.</p>
</li>
<li>
<p>Click <span class="bold">Server</span> to display the Server subpage.</p>
</li>
<li>
<p>In the Security section, click <span class="bold">Users</span>.</p>
</li>
<li id="CIHIFFCH">
<p>Select user <code>kpartner</code>, and then click <span class="bold">Delete</span>.</p>
</li>
<li id="CIHEJDFH">
<p>In the Confirmation page, click <span class="bold">Yes</span>.</p>
</li>
<li>
<p>Repeat Step <a href="#CIHIFFCH">4</a> and Step <a href="#CIHEJDFH">5</a> for users <code>ldoran</code> and <code>sking</code>.</p>
</li>
<li>
<p>Click the <span class="bold">Database Instance</span> link to return to the Database home page.</p>
</li>
<li>
<p>Click <span class="bold">Server</span> to display the Server subpage.</p>
</li>
<li>
<p>In the Security section, click <span class="bold">Roles</span>.</p>
</li>
<li>
<p>Select the role <code>emp_role</code>, and then click <span class="bold">Delete</span>.</p>
</li>
<li>
<p>In the Confirmation dialog box, click <span class="bold">Yes</span>.</p>
</li>
<li>
<p>Log out of Database Control, and then log back in as <code>LABCSYS</code>.</p>
</li>
<li>
<p>Click <span class="bold">Server</span> to display the Server subpage.</p>
</li>
<li>
<p>In the Security section, click <span class="bold">Oracle Label Security</span>.</p>
</li>
<li>
<p>In the Label Security Policies page, select the <code>ACCESS_LOCATIONS</code> policy and then click <span class="bold">Delete</span>. In the Confirmation page, select the <span class="bold">Drop column</span> check box and then click <span class="bold">Yes</span>.</p>
<p>Deleting the <code>ACCESS_LOCATIONS</code> policy also drops the <code>OLS_COLUMN</code> column from the <code>HR.LOCATIONS</code> table. <a id="sthref444"></a><a id="sthref445"></a></p>
</li>
<li>
<p>Log out of Database Control.</p>
</li>
<li>
<p>Optionally, remove Oracle Label Security.</p>
<p>See <a class="olink OLSAG117" href="../../network.112/e10745/appxc.htm#OLSAG117"><span class="italic">Oracle Label Security Administrator's Guide</span></a> for information about removing Oracle Label Security.s</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CIADFEAG"></a>
<div id="TDPSG90065" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Controlling Administrator Access with Oracle Database Vault</h2>
<p>Oracle Database Vault enables you to <a id="sthref446"></a>restrict administrative access to an Oracle database. This helps you address the most difficult security problems remaining today: protecting against insider threats, meeting regulatory compliance requirements, and enforcing separation of duty.</p>
<ul>
<li>
<p><a href="#CIAGIBAH">About Oracle Database Vault</a></p>
</li>
<li>
<p><a href="#CIAJDCGE">Tutorial: Controlling Administrator Access to the OE Schema</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink DVADM" href="../e23090/toc.htm"><span class="italic">Oracle Database Vault Administrator's Guide</span></a></div>
<a id="CIAGIBAH"></a>
<div id="TDPSG90651" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Oracle Database Vault</h3>
<p>Typically, the main job of an Oracle database administrator is to perform tasks such database tuning, installing upgrades, monitoring the state of the database, and then remedying any problems that he or she finds. In a default Oracle Database installation, database administrators also have the ability to create users and access user data. For greater security, you should restrict these activities only to those users who must perform them. This is called <span class="bold"><a id="sthref447"></a><a id="sthref448"></a>separation of duty</span>, and it frees the database administrator to focus on tasks ideally suited to his or her expertise, such as performance tuning.</p>
<p>By <a id="sthref449"></a>restricting administrator access to your <a id="sthref450"></a>Oracle databases, Oracle Database Vault helps you to follow common regulatory compliance requirements, such as the Payment Card Industry (PCI) Data Security Standard (DSS) requirements, Sarbanes-Oxley (SOX) Act, European Union (EU) Privacy Directive, and Healthcare Insurance Portability and Accountability Act (HIPAA). These regulations require strong internal controls on access, disclosure or modification of sensitive information that could lead to fraud, identity theft, financial irregularities and financial penalties.</p>
<p>Oracle<a id="sthref451"></a> Database Vault provides the following ways for you to restrict administrator access to an Oracle database:</p>
<ul>
<li>
<p><span class="bold">Group database schemas, objects, and roles that you want to secure.</span> This grouping is called a <span class="bold">realm</span>, and all the components of the realm are protected. After you, the Database Vault administrator, create a realm, you designate a user to manage access to the realm. For example, you can create a realm around one table within a schema, or around the entire schema itself.</p>
</li>
<li>
<p><span class="bold">Create PL/SQL expressions to customize your database restrictions.</span> You create an expression in a <span class="bold">rule</span>, and for multiple rules within one category, you can group the rules into a <span class="bold">rule set</span>. To enforce the rules within the rule set, you then associate the rule set with a realm or command rule. For example, if you wanted to prevent access to a database during a maintenance period (for example, from 10 to 12 p.m.), you can create a rule to restrict access only during those hours.</p>
</li>
<li>
<p><span class="bold">Designate specific PL/SQL statements that are accessible or not accessible to users.</span> These are called <span class="bold">command rules</span>. A command rule contains a command to be protected and a rule set that determines whether the execution of the command is permitted. You can create a command rule to protect <code>SELECT</code>, <code>ALTER SYSTEM</code>, database definition language (DDL), and data manipulation language (DML) statements that affect one or more database objects. You can associate a rule set to further customize the command rule.</p>
</li>
<li>
<p><span class="bold">Define attributes to record data such as session users or IP addresses that Oracle Database Vault can recognize and secure.</span> These attributes are called <span class="bold">factors</span>. You can use factors for activities such as authorizing database accounts to connect to the database or creating filtering logic to restrict the visibility and manageability of data. To further customize the factor, you can associate a rule set with it.</p>
</li>
<li>
<p><span class="bold">Design secure application roles that are enabled only by Oracle Database Vault rules.</span> After you create the secure application role in Oracle Database Vault, you associate a rule set with it. The rule set defines when and how the secure application role is enabled or disabled.</p>
</li>
</ul>
<p>You can create these components by using either Oracle Database Vault Administrator, or by using its PL/SQL packages.</p>
</div>
<!-- class="sect2" -->
<a id="CIAJDCGE"></a>
<div id="TDPSG90652" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Tutorial: Controlling Administrator Access to the OE Schema</h3>
<p>The <code>OE</code> schema <a id="ABC8865723"></a><a id="ABC8865723SRI1"></a>has several tables that contain confidential data, such as the credit limits allowed for customers and other information. Order Entry tables typically contain sensitive information, such as credit card or Social Security numbers. This type of information must be restricted only to individuals whose job requires access to this information, according to Payment Card Industry (PCI) Data Security Standards (DSS).</p>
<p>In this tutorial, you create a realm around the <code>OE</code> schema, which will protect it from administrator access. However, user <code>SCOTT</code> needs access to the <code>OE.CUSTOMERS</code> table, so you must ensure that he can continue to access this data.</p>
<p>In this tutorial:</p>
<ul>
<li>
<p><a href="#CIABJEEC">Step 1: Enable Oracle Database Vault</a></p>
</li>
<li>
<p><a href="#CIAFHHJJ">Step 2: Grant the SELECT Privilege on the OE.CUSTOMERS Table to User SCOTT</a></p>
</li>
<li>
<p><a href="#CIAEABEA">Step 3: Select from the OE.CUSTOMERS Table as Users SYS and SCOTT</a></p>
</li>
<li>
<p><a href="#CIAEJGGG">Step 4: Create a Realm to Protect the OE.CUSTOMERS Table</a></p>
</li>
<li>
<p><a href="#CIAJCBEB">Step 5: Test the OE Protections Realm</a></p>
</li>
<li>
<p><a href="#CIAHEIJA">Step 6: Optionally, Remove the Components for This Tutorial</a></p>
</li>
</ul>
<a id="CIABJEEC"></a>
<div id="TDPSG66521" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 1: Enable Oracle Database Vault</h4>
<p>Oracle Database Vault is installed when you perform a default installation of Oracle Database. After you install it, you must register Oracle Database Vault with Oracle Database and then enable the Oracle Database Vault Account Manager user account.</p>
<ul>
<li>
<p><a href="#CIADHHJA">Checking if Oracle Database Vault Is Enabled</a></p>
</li>
<li>
<p><a href="#CIACAJAH">Registering Oracle Database Vault with Oracle Database</a></p>
</li>
<li>
<p><a href="#CIAIHCIA">Enabling Database Access Control for the Database Vault Account Manager Account</a></p>
</li>
</ul>
<a id="CIADHHJA"></a>
<div id="TDPSG94429" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4">Checking if Oracle Database Vault Is Enabled</h5>
<p>You <a id="sthref452"></a>can check if Oracle Database Vault is enabled by logging in to SQL*Plus and entering the following <code>SELECT</code> statement. The <code>PARAMETER</code> column is case sensitive, so use the case shown here.</p>
<pre>
SELECT * FROM V$OPTION WHERE PARAMETER = 'Oracle Database Vault';
</pre>
<p>If it returns <code>TRUE</code>, then Oracle Database Vault is registered. Go to <a href="#CIAIHCIA">"Enabling Database Access Control for the Database Vault Account Manager Account"</a>. Otherwise, complete the registration process described in the next section.</p>
</div>
<!-- class="sect4" -->
<a id="CIACAJAH"></a>
<div id="TDPSG94430" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4">Registering Oracle Database Vault with Oracle Database</h5>
<p>In the registration process, Oracle Database Vault is enabled and you are prompted to create its administrative accounts.</p>
<p class="orderedlisttitle">To register Oracle Database Vault:&nbsp;</p>
<ol>
<li>
<p>Stop the database, Database Control console process, and listener.</p>
<ul>
<li>
<p><span class="bold">UNIX:</span> Log in to SQL*Plus as user <code>SYS</code> with the <code>SYSOPER</code> privilege and shut down the database. Then from the command line, stop the Database Control console process and listener.</p>
<p>For example:</p>
<pre>
sqlplus sys as sysoper
Enter password: <span class="italic">password</span>

SQL&gt; SHUTDOWN IMMEDIATE
SQL&gt; EXIT

$ emctl stop dbconsole
$ lsnrctl stop [<span class="italic">listener_name</span>]
</pre>
<p>For Oracle RAC installations, shut down each database instance as follows:</p>
<pre>
$ srvctl stop database -d <span class="italic">db_name</span>
</pre></li>
<li>
<p><span class="bold">Windows:</span> Stop the database, Database Control console process, and listener from the Services tool in the Control Panel. The names of Oracle Database services begin with <code>Oracle</code>.</p>
</li>
</ul>
</li>
<li>
<p>Enable Oracle Database Vault as follows:</p>
<ul>
<li>
<p><span class="bold">UNIX:</span> Run the following commands. The <code>make</code> command enables both Oracle Database Vault (<code>dv_on</code>) and Oracle Label Security (<code>lbac_on</code>). You must enable Oracle Label Security before you can use Database Vault.</p>
<pre>
$ cd $ORACLE_HOME/rdbms/lib
$ make -f ins_rdbms.mk dv_on lbac_on ioracle
</pre></li>
<li>
<p><span class="bold">Windows:</span> In the <code><span class="codeinlineitalic">ORACLE_BASE\ORACLE_HOME</span></code><code>\bin</code> directory, rename the <code>oradvll.dll.dbl</code> file to <code>oradvll.dll</code>. If Oracle Label Security has not been enabled, then change the name of the <code>oralbacll.dll.dbl</code> file to <code>oralbacll.dll</code>. You must enable Oracle Label Security before you can use Database Vault.</p>
</li>
</ul>
</li>
<li>
<p>Restart the database and listener. (Do not restart the Database Control console process yet.)</p>
<ul>
<li>
<p><span class="bold">UNIX:</span> Log in to SQL*Plus as user <code>SYS</code> with the <code>SYSOPER</code> privilege and restart the database. Then from the command line, restart the listener.</p>
<p>For example:</p>
<pre>
sqlplus sys as sysoper
Enter password: <span class="italic">password</span>

SQL&gt; STARTUP
SQL&gt; EXIT

$ lsnrctl start [<span class="italic">listener_name</span>]
</pre>
<p>For Oracle RAC installations, restart each database instance as follows:</p>
<pre>
$ srvctl start database -d <span class="italic">db_name</span>
</pre></li>
<li>
<p><span class="bold">Windows:</span> Restart the database and listener from the Services tool in the Control Panel. The names of Oracle Database services begin with <code>Oracle</code>.</p>
</li>
</ul>
</li>
<li>
<p>Start Database Configuration Assistant.</p>
<ul>
<li>
<p><span class="bold">UNIX:</span> Enter the following command at a terminal window:</p>
<pre>
dbca
</pre>
<p>Typically, <code>dbca</code> is in the <code>$ORACLE_HOME/bin</code> directory.</p>
</li>
<li>
<p><span class="bold">Windows:</span> From the <span class="bold">Start</span> menu, click <span class="bold">All Programs</span>. Then, click <span class="bold">Oracle -</span> <span class="bolditalic">ORACLE_HOME</span>, <span class="bold">Configuration and Migration Tools</span>, and then <span class="bold">Database Configuration Assistant</span>.</p>
<p>Alternatively, you can start Database Configuration Assistant at a command prompt:</p>
<pre>
dbca
</pre>
<p>As with UNIX, typically, <code>dbca</code> is in the <code><span class="codeinlineitalic">ORACLE_BASE</span></code><code>\</code><code><span class="codeinlineitalic">ORACLE_HOME</span></code><code>\bin</code> directory.</p>
</li>
</ul>
</li>
<li>
<p>In the Welcome page, click <span class="bold">Next</span>.</p>
<p>The Operations page appears.</p>
</li>
<li>
<p>Select <span class="bold">Configure Database Options</span>, and then click <span class="bold">Next</span>.</p>
<p>The Database page appears.</p>
</li>
<li>
<p>From the list, select the database where you installed Oracle Database and then enter the name and password of a user who has been granted the <code>DBA</code> role. Click <span class="bold">Next</span>.</p>
<p>The Database Content page appears.</p>
</li>
<li>
<p>Perform one of the following actions:</p>
<ul>
<li>
<p><span class="bold">If Oracle Label Security is already enabled:</span> Select the <span class="bold">Oracle Database Vault</span> option, and then click <span class="bold">Next</span>.</p>
</li>
<li>
<p><span class="bold">If Oracle Label Security is not enabled:</span> Select the <span class="bold">Oracle Label Security</span> option so that the <span class="bold">Oracle Database Vault</span> option becomes available for selection. Select the <span class="bold">Oracle Database Vault</span> option as well, and then click <span class="bold">Next</span>.</p>
</li>
</ul>
<p>The Oracle Database Vault Credentials page appears.</p>
</li>
<li>
<p>Specify the name and password for the Database Vault Owner account (for example, <code>DBVOWNER</code>) and the Database Vault Account Manager (for example, <code>DBVACCTMGR</code>).</p>
<p>Enter any password that is secure, according to the password guidelines described in <a href="tdpsg_user_accounts.htm#BEICECGF">"Requirements for Creating Passwords"</a>. Oracle Database Vault has additional password requirements, which are displayed if you try to create an incorrect password.</p>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
<p>The Connection Mode page appears.</p>
</li>
<li>
<p>Select either <span class="bold">Dedicated Server Mode</span> or <span class="bold">Shared Server Mode</span> (depending on the selection you made when you created this database), click <span class="bold">Finish</span>, and then click <span class="bold">OK</span> in the confirmation prompts.</p>
<p>Database Configuration Assistant registers Oracle Database Vault, and then restarts the database instance.</p>
</li>
<li>
<p>Exit Database Configuration Assistant.</p>
</li>
<li>
<p>Restart the Database Control console process.</p>
<ul>
<li>
<p><span class="bold">UNIX:</span> Run the following command:</p>
<pre>
$ emctl start dbconsole
</pre></li>
<li>
<p><span class="bold">Windows:</span> Restart the Database Control console process (for example, OracleDBConsoleorcl if the database is named <code>orcl</code>) from the Services tool in the Control Panel.</p>
</li>
</ul>
</li>
</ol>
</div>
<!-- class="sect4" -->
<a id="CIAIHCIA"></a>
<div id="TDPSG94431" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4">Enabling Database Access Control for the Database Vault Account Manager Account</h5>
<p>The Database Vault Account Manager account must have additional privileges to use Database Control.</p>
<p class="orderedlisttitle">To grant the necessary privileges to the Database Vault Account Manager account:&nbsp;</p>
<ol>
<li>
<p>Log in to Database Control as the user <code>SYS</code>.</p>
<p>In the Login page, enter <code>SYS</code> and the password assigned to <code>SYS</code>. Set <span class="bold">Connect As</span> to <span class="bold">SYSDBA</span>. Select <span class="bold">Login</span> to log in. See <a class="olink ADMQS033" href="../../server.112/e10897/em_manage.htm#ADMQS033"><span class="italic">Oracle Database 2 Day DBA</span></a> for instructions about how to start Database Control.</p>
</li>
<li>
<p>Click <span class="bold">Server</span> to display the Server subpage.</p>
</li>
<li>
<p>Under Security, select <span class="bold">Users</span>.</p>
<p>The Users page appears.</p>
</li>
<li>
<p>Select the Database Vault Account Manager account (for example, <code>DBVACCTMGR</code>).</p>
<p>To quickly find <code>DBVACCTMGR</code>, enter <code>DBV</code> in the <span class="bold">Object Name</span> field, and then click <span class="bold">Go</span>.</p>
</li>
<li>
<p>Select the <span class="bold">DBVACCTMGR</span> user, and in the View User page, click <span class="bold">Edit</span>.</p>
<p>The Edit User page appears.</p>
</li>
<li>
<p>Click <span class="bold">Roles</span> to display the Edit User: DBVACCTMGR page.</p>
</li>
<li>
<p>Click <span class="bold">Edit List</span>.</p>
<p>The Modify Roles page appears.</p>
</li>
<li>
<p>In the Available Roles list, select the <span class="bold">SELECT_CATALOG_ROLE</span> role and then then click <span class="bold">Move</span> to move it to the Selected Roles list. Then click <span class="bold">OK</span> to return to the Edit User page.</p>
</li>
<li>
<p>Click <span class="bold">System Privileges</span>.</p>
</li>
<li>
<p>Click <span class="bold">Edit List</span>.</p>
<p>The Modify System Privileges page appears.</p>
</li>
<li>
<p>In the Available System Privileges list, select <code>SELECT ANY DICTIONARY</code>, and then click <span class="bold">Move</span> to move it to the Selected System Privileges list. Then click <span class="bold">OK</span>.</p>
</li>
<li>
<p>Click <span class="bold">Apply</span>.</p>
</li>
</ol>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="CIAFHHJJ"></a>
<div id="TDPSG66522" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 2: Grant the SELECT Privilege on the OE.CUSTOMERS Table to User SCOTT</h4>
<p>To test the tutorial later on, user <code>SCOTT</code> must select from the <code>OE.CUSTOMERS</code> table. First, you should ensure that he <code>SCOTT</code> account is active.</p>
<p class="orderedlisttitle">To enable user SCOTT:&nbsp;</p>
<ol>
<li>
<p>In Database Control, connect as the Oracle Database Vault Account Manager account with the <code>Normal</code> privilege.</p>
<p>After you install Oracle Database Vault, you no longer can use the administrative accounts (such as <code>SYS</code> and <code>SYSTEM</code>) to create or enable user accounts. This is because right out of the box, Oracle Database Vault provides <a id="sthref456"></a>separation-of-duty principles to administrative accounts. From now on, to manage user accounts, you must use the Oracle Database Vault Account Manager account.</p>
<p>However, administrative users still have the privileges they do need. For example, user <code>SYS</code>, who owns system privileges and many PL/SQL packages, can still grant privileges on these to other users. However, user <code>SYS</code> can no longer create, modify, or drop user accounts.</p>
</li>
<li>
<p>Click <span class="bold">Server</span> to display the Server subpage.</p>
</li>
<li>
<p>Under Security, select <span class="bold">Users</span>.</p>
<p>The Users page appears.</p>
</li>
<li>
<p>Select the <span class="bold">SCOTT</span> user, and in the View User page, click <span class="bold">Edit</span>.</p>
<p>The Edit User page appears.</p>
</li>
<li>
<p>Enter the following settings:</p>
<ul>
<li>
<p><span class="bold">Enter Password</span> and <span class="bold">Confirm Password</span>: If the <code>SCOTT</code> account password status is expired, then enter a new password. Enter any password that is secure, according to the password guidelines described in <a href="tdpsg_user_accounts.htm#BEICECGF">"Requirements for Creating Passwords"</a>.</p>
</li>
<li>
<p><span class="bold">Status</span>: Click <span class="bold">Unlocked</span>.</p>
</li>
</ul>
</li>
<li>
<p>Click <span class="bold">Apply</span>.</p>
</li>
<li>
<p>Click <span class="bold">Logout</span>.</p>
</li>
</ol>
<p class="orderedlisttitle">To grant user SCOTT the SELECT privilege on the OE.CUSTOMERS table:&nbsp;</p>
<ol>
<li>
<p>Log in to SQL*Plus as user <code>OE</code>.</p>
<pre>
sqlplus oe
Enter password: <span class="italic">password</span>
Connected. 
</pre></li>
<li>
<p>Grant user <code>SCOTT</code> the <code>SELECT</code> privilege on the <code>OE.CUSTOMERS</code> table.</p>
<pre>
SQL&gt; GRANT SELECT ON CUSTOMERS TO SCOTT;
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIAEABEA"></a>
<div id="TDPSG66523" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 3: Select from the OE.CUSTOMERS Table as Users SYS and SCOTT</h4>
<p>At this stage, both users <code>SYS</code> and <code>SCOTT</code> can select from the <code>OE.CUSTOMERS</code> table, because <code>SYS</code> has administrative privileges and because <code>SCOTT</code> has an explicit <code>SELECT</code> privilege granted by user <code>OE</code>.</p>
<p class="orderedlisttitle">To select from OE.CUSTOMERS as users SYS and SCOTT:&nbsp;</p>
<ol>
<li>
<p>In SQL*Plus, connect as user <code>SYS</code> using the <code>SYSDBA</code> privilege</p>
<pre>
sqlplus sys as sysdba
Enter password: <span class="italic">password</span>
</pre></li>
<li>
<p>Select from the <code>OE.CUSTOMERS</code> table as follows:</p>
<pre>
SELECT COUNT(*) FROM OE.CUSTOMERS;
</pre>
<p>The following output should appear</p>
<pre>
COUNT(*)
--------
     319
</pre></li>
<li>
<p>Connect as user <code>SCOTT</code>, and then perform the same <code>SELECT</code> statement.</p>
<pre>
CONNECT SCOTT
Enter password: <span class="italic">password</span>
Connected.

SELECT COUNT(*) FROM OE.CUSTOMERS;
</pre>
<p>The following output should appear:</p>
<pre>
COUNT(*)
--------
     319
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIAEJGGG"></a>
<div id="TDPSG66524" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 4: Create a Realm to Protect the OE.CUSTOMERS Table</h4>
<p>To restrict the <code>OE.CUSTOMER</code> table from administrative access, you will create a realm around the <code>OE</code> schema.</p>
<p class="orderedlisttitle">To create a realm around the OE schema:&nbsp;</p>
<ol>
<li id="CIAHFBGF">
<p>Start Oracle Database Vault Administrator.</p>
<p>In a browser, enter the following URL:</p>
<p><code>https://</code><code><span class="codeinlineitalic">host_name</span></code><code>:</code><code><span class="codeinlineitalic">port</span></code><code>/dva</code></p>
<p>Replace <code><span class="codeinlineitalic">host_name</span></code> with the name of the server on which you installed Oracle Database Vault, and <code><span class="codeinlineitalic">port</span></code> with the Oracle Enterprise Manager Console HTTPS port number. In most cases, the name of the server and port number are the same as those used by Database Control.</p>
<p>If you cannot start Database Vault Administrator, you may need to manually deploy it. See <a class="olink DVADM30032" href="../../server.112/e23090/dvca.htm#DVADM30032"><span class="italic">Oracle Database Vault Administrator's Guide</span></a> for more information.</p>
</li>
<li>
<p>In the Login to Database page, enter the following information:</p>
<ul>
<li>
<p><span class="bold">User Name</span>: Enter the name of the <code>DV_OWNER</code> or <code>DV_ADMIN</code> account (for example, <code>DBVOWNER</code>).</p>
</li>
<li>
<p><span class="bold">Password</span>: Enter the password of the user whose name you entered.</p>
</li>
<li>
<p><span class="bold">Host</span>: Enter the host name or IP address of the computer where you installed Oracle Database Vault, for example, <code>myserver.us.example.com</code>.</p>
</li>
<li>
<p><span class="bold">Port</span>: Enter the port number for the database, for example, 1521.</p>
</li>
<li>
<p><span class="bold">SID/Service</span>: Enter either the SID (for example, <code>orcl</code>) of the database, or the service (for example, <code>myserver.us.example.com</code>).</p>
</li>
</ul>
<p>The Database Instance Administration page appears.</p>
</li>
<li>
<p>Under Database Vault Feature Administration, select <span class="bold">Realms</span>.</p>
<p>The Realms page appears.</p>
</li>
<li>
<p>Click <span class="bold">Create</span>.</p>
<p>The Create Realm page appears.</p>
</li>
<li>
<p>Enter the following information:</p>
<ul>
<li>
<p><span class="bold">Name</span>: <code>OE Protections</code></p>
</li>
<li>
<p><span class="bold">Description</span>: <code>Realm to protect the OE schema</code></p>
</li>
<li>
<p><span class="bold">Status</span>: Click <span class="bold">Enabled</span>.</p>
</li>
<li>
<p><span class="bold">Audit Options</span>: Select <span class="bold">Audit on Failure</span>.</p>
</li>
</ul>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
<p>The Realms page appears, with the <code>OE</code> schema listed as a realm. However, it has no protected objects or authorized users yet.</p>
<img width="914" height="433" src="img/dv_realm.gif" alt="Realms page in DVA" /><br />
<a id="sthref460" href="img_text/dv_realm.htm">Description of the illustration dv_realm.gif</a><br />
<br /></li>
<li>
<p>Select the <span class="bold">OE Protections</span> realm and then click <span class="bold">Edit</span>.</p>
<p>The Edit Realm page appears.</p>
</li>
<li>
<p>Under Realm Secured Objects, click <span class="bold">Create</span>.</p>
<p>The Create Realm Secured Object page appears.</p>
</li>
<li>
<p>From the <span class="bold">Object Owner</span> list, select <span class="bold">OE</span>.</p>
</li>
<li>
<p>From the <span class="bold">Object Type</span> list, select <span class="bold">TABLE</span>.</p>
</li>
<li>
<p>In the <span class="bold">Object Name</span> field, enter <code>%</code> to specify all tables within the <code>OE</code> schema, and then click <span class="bold">OK</span>.</p>
<p>The Edit Realm page appears.</p>
</li>
<li>
<p>Under <span class="bold">Realm Authorizations</span>, click <span class="bold">Create</span>.</p>
<p>The Create Realm Authorization page appears.</p>
</li>
<li>
<p>From the <span class="bold">Grantee</span> list, select <code>OE [USER]</code>, and then set the <span class="bold">Authorization Type</span> to <span class="bold">Owner</span>. Then set <span class="bold">Authorization Rule Set</span> to <span class="bold">&lt;Non Selected&gt;</span>.</p>
<p>This authorizes the <code>OE</code> user to manage access to the objects within the <code>OE</code> schema. As an Owner, the <code>OE</code> user can grant or revoke realm-secured database roles, and access, manipulate, and create objects protected by the <code>OE</code> Protections realm.</p>
<p>The <span class="bold">Authorization Rule Set</span> list enables to you select a rule that further controls access, such as the time the realm is in effect, and so on.</p>
</li>
<li>
<p>Click <span class="bold">OK</span> to return to the Edit Realm page, and then click <span class="bold">OK</span> again to return to the Realms page.</p>
</li>
<li>
<p>Do not exit Oracle Database Vault Administrator.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIAJCBEB"></a>
<div id="TDPSG66525" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 5: Test the OE Protections Realm</h4>
<p>Now that you have created a realm to protect the <code>OE</code> schema, you are ready to test it. You do not need to restart the database session, because any protections you define in Oracle Database Vault take effect right away.</p>
<p class="orderedlisttitle">To test the OE Protections realm:&nbsp;</p>
<ol>
<li>
<p>Connect to SQL*Plus as user <code>SYS</code> using the <code>SYSDBA</code> privilege.</p>
<pre>
CONNECT SYS/AS SYSDBA
Enter password: <span class="italic">password</span>
Connected.
</pre></li>
<li>
<p>Try selecting from the <code>OE.CUSTOMERS</code> table.</p>
<pre>
SELECT COUNT(*) FROM OE.CUSTOMERS;
</pre>
<p>The following output should appear:</p>
<pre>
ERROR at line 1:
ORA-01031: insufficient privileges
</pre>
<p>The OE Protections realm prevents the administrative user from accessing the <code>OE.CUSTOMERS</code> table. Because you defined the OE Protections realm to protect the entire schema, the administrative user does not have access to any of the other tables in <code>OE</code>, either.</p>
</li>
<li>
<p>Connect as user <code>SCOTT</code>.</p>
<pre>
CONNECT SCOTT
Enter password: <span class="italic">password</span>
Connected.
</pre></li>
<li>
<p>Try selecting from the <code>OE.CUSTOMERS</code> table.</p>
<pre>
SELECT COUNT(*) FROM OE.CUSTOMERS;
</pre>
<p>The following output should appear:</p>
<pre>
  COUNT(*)
----------
       319
</pre>
<p>The OE Protections realm does not apply to user <code>SCOTT</code> because user <code>OE</code> has explicitly granted this user the <code>SELECT</code> privilege on the <code>OE.CUSTOMERS</code> table. Oracle Database Vault sets up the protections you need, but does not override the explicit privileges you have defined. <code>SCOTT</code> still can query this table.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIAHEIJA"></a>
<div id="TDPSG66526" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Step 6: Optionally, Remove the Components for This Tutorial</h4>
<p>After completing this tutorial, you can remove the data structures that you used if you no longer need them.</p>
<p class="orderedlisttitle">To revoke the SELECT privilege on OE.CUSTOMERS from user SCOTT:&nbsp;</p>
<ol>
<li>
<p>In SQL*Plus, connect as user <code>OE</code>.</p>
<pre>
CONNECT OE
Enter password: <span class="italic">password</span>
Connected. 
</pre></li>
<li>
<p>Revoke the <code>SELECT</code> privilege from user <code>SCOTT</code>.</p>
<pre>
REVOKE SELECT ON CUSTOMERS FROM SCOTT;
</pre></li>
</ol>
<p class="orderedlisttitle">To drop the OE Protections realm:&nbsp;</p>
<ol>
<li>
<p>If you have logged out of Oracle Database Vault Administrator, log back in as the Database Vault Owner account that you created when you installed Oracle Database Vault (for example, <code>DBVOWNER</code>).</p>
<p>See Step <a href="#CIAHFBGF">1</a> in <a href="#CIAEJGGG">"Step 4: Create a Realm to Protect the OE.CUSTOMERS Table"</a> for how to start Database Vault Administrator.</p>
<p>The Administration page appears.</p>
</li>
<li>
<p>Under Database Vault Feature Administration, click <span class="bold">Realms</span>.</p>
<p>The Realms page appears.</p>
</li>
<li>
<p>Select <span class="bold">OE Protections</span> from the list of realms, and then click <span class="bold">Remove</span>. Then click <span class="bold">Yes</span> in the Confirmation page.</p>
</li>
<li>
<p>Log out of Oracle Database Vault Administrator.<a id="sthref464"></a><a id="sthref465"></a></p>
</li>
</ol>
<p class="itemizedlisttitle">To disable Oracle Database Vault:&nbsp;</p>
<ul>
<li>
<p>See <a class="olink DVADM01203" href="../../server.112/e23090/dvdisabl.htm#DVADM01203"><span class="italic">Oracle Database Vault Administrator's Guide</span></a> for information about disabling Oracle Database Vault.</p>
</li>
</ul>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1874">
<tr>
<td class="cellalignment1883">
<table class="cellalignment1879">
<tr>
<td class="cellalignment1878"><a href="tdpsg_network_secure.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1878"><a href="tdpsg_auditing.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2006, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1885">
<table class="cellalignment1877">
<tr>
<td class="cellalignment1878"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1878"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1878"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1878"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1878"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1878"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
</body>
</html>
