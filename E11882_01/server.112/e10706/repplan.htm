<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Planning Your Replication Environment</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 732" />
<meta name="dcterms.created" content="2013-06-03T15:3:0Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Advanced Replication" />
<meta name="dcterms.identifier" content="E10706-06" />
<meta name="dcterms.isVersionOf" content="REPLN" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="repconflicts.htm" title="Previous" type="text/html" />
<link rel="Next" href="reptrouble.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10706.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">11/14</span> <!-- End Header -->
<div id="REPLN006" class="chapter"><a id="BABEEDCH"></a><a id="i21350"></a>
<h1 class="chapter"><span class="secnum">6</span> Planning Your Replication Environment</h1>
<p><a id="sthref921"></a><a id="sthref922"></a>Before you begin to plan your replication environment, it is important to understand the replication concepts and architecture described in the previous chapters of this book. After you understand replication concepts and architecture, this chapter presents important considerations for planning a replication environment.</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#i15320">Considerations for Replicated Tables</a></p>
</li>
<li>
<p><a href="#i14922">Initialization Parameters</a></p>
</li>
<li>
<p><a href="#i24116">Master Sites and Materialized View Sites</a></p>
</li>
<li>
<p><a href="#i24273">Interoperability in an Advanced Replication Environment</a></p>
</li>
<li>
<p><a href="#i18408">Guidelines for Scheduled Links</a></p>
</li>
<li>
<p><a href="#i15338">Guidelines for Scheduled Purges of a Deferred Transaction Queue</a></p>
</li>
<li>
<p><a href="#i14014">Serial and Parallel Propagation</a></p>
</li>
<li>
<p><a href="#i15660">Deployment Templates</a></p>
</li>
<li>
<p><a href="#i15473">Conflict Resolution</a></p>
</li>
<li>
<p><a href="#i15775">Security and Replication</a></p>
</li>
<li>
<p><a href="#i16790">Designing for Survivability</a></p>
</li>
</ul>
<a id="i15320"></a>
<div id="REPLN497" class="sect1">
<h2 class="sect1">Considerations for Replicated Tables<a id="sthref923"></a><a id="sthref924"></a><a id="sthref925"></a></h2>
<p>The following sections discuss considerations for tables you plan to use in a replication environment:</p>
<ul>
<li>
<p><a href="#CACDBGBI">Primary Keys and Replicated Tables</a></p>
</li>
<li>
<p><a href="#i21860">Foreign Keys and Replicated Tables</a></p>
</li>
<li>
<p><a href="#i13947">Data Type Considerations for Replicated Tables</a></p>
</li>
<li>
<p><a href="#CACBIFBG">Unsupported Table Types</a></p>
</li>
<li>
<p><a href="#i20201">Row-Level Dependency Tracking</a></p>
</li>
</ul>
<a id="CACDBGBI"></a>
<div id="REPLN498" class="sect2">
<h3 class="sect2">Primary Keys and Replicated Tables<a id="sthref926"></a><a id="sthref927"></a></h3>
<p>If possible, each replicated table should have a primary key. Where a primary key is not possible, each replicated table must have a set of columns that can be used as a unique identifier for each row of the table. If the tables that you plan to use in your replication environment do not have a primary key or a set of unique columns, then alter these tables accordingly. In addition, if you plan to create any primary key materialized views based on a master table or master materialized view, then that master must have a primary key.</p>
</div>
<!-- class="sect2" -->
<a id="i21860"></a>
<div id="REPLN499" class="sect2">
<h3 class="sect2">Foreign Keys and Replicated Tables<a id="sthref928"></a><a id="sthref929"></a><a id="sthref930"></a><a id="sthref931"></a></h3>
<p>When replicating tables with foreign key referential constraints, Oracle recommends that you always index foreign key columns and replicate these indexes, unless no updates and deletes are allowed in the parent table. Indexes are not replicated automatically. To replicate an index, add it to the master group containing its table using either the Advanced Replication interface in Oracle Enterprise Manager or the <code>CREATE_MASTER_REPOBJECT</code> procedure in the <code>DBMS_REPCAT</code> package.</p>
</div>
<!-- class="sect2" -->
<a id="i13947"></a>
<div id="REPLN500" class="sect2">
<h3 class="sect2">Data Type Considerations for Replicated Tables<a id="sthref932"></a><a id="sthref933"></a></h3>
<p>Advanced Replication supports the replication of tables and materialized views with columns that use the following data types:</p>
<ul>
<li>
<p><code>VARCHAR2</code></p>
</li>
<li>
<p><code>NVARCHAR2</code></p>
</li>
<li>
<p><code>NUMBER</code></p>
</li>
<li>
<p><code>DATE</code></p>
</li>
<li>
<p><code>TIMESTAMP</code></p>
</li>
<li>
<p><code>TIMESTAMP</code> <code>WITH</code> <code>TIME</code> <code>ZONE</code></p>
</li>
<li>
<p><code>TIMESTAMP</code> <code>LOCAL</code> <code>TIME</code> <code>ZONE</code></p>
</li>
<li>
<p><code>INTERVAL</code> <code>YEAR</code> <code>TO</code> <code>MONTH</code></p>
</li>
<li>
<p><code>INTERVAL</code> <code>DAY</code> <code>TO</code> <code>SECOND</code></p>
</li>
<li>
<p><code>RAW</code></p>
</li>
<li>
<p><code>ROWID</code></p>
</li>
<li>
<p><code>CHAR</code></p>
</li>
<li>
<p><code>NCHAR</code></p>
</li>
<li>
<p><code>CLOB</code> with <code>BASICFILE</code> storage</p>
</li>
<li>
<p><code>NCLOB</code> with <code>BASICFILE</code> storage</p>
</li>
<li>
<p><code>BLOB</code> with <code>BASICFILE</code> storage</p>
</li>
<li>
<p><code>XMLType</code> stored as <code>CLOB</code></p>
</li>
<li>
<p>User-defined types that do not use type inheritance or type evolution</p>
</li>
<li>
<p>Oracle-supplied types that do not use type inheritance or type evolution</p>
</li>
</ul>
<p>The deferred and synchronous remote procedure call mechanism used for multimaster replication propagates only the piece-wise changes to the supported LOB data types when piece-wise updates and appends are applied to these LOB columns. Also, you cannot reference LOB columns in a <code>WHERE</code> clause of a materialized view's defining query.</p>
<p>You can replicate tables and materialized views that use user-defined types, including column objects, object tables, <code>REF</code>s, varrays, and nested tables.</p>
<p>Advanced Replication does not support the replication of tables and materialized views with columns that use the following data types:</p>
<ul>
<li>
<p><code>FLOAT</code></p>
</li>
<li>
<p><code>BINARY_FLOAT</code></p>
</li>
<li>
<p><code>BINARY_DOUBLE</code></p>
</li>
<li>
<p><code>LONG</code></p>
</li>
<li>
<p><code>LONG</code> <code>RAW</code></p>
</li>
<li>
<p><code>CLOB</code> with <code>SECUREFILE</code> storage</p>
</li>
<li>
<p><code>NCLOB</code> with <code>SECUREFILE</code> storage</p>
</li>
<li>
<p><code>BLOB</code> with <code>SECUREFILE</code> storage</p>
</li>
<li>
<p><code>BFILE</code></p>
</li>
<li>
<p><code>XMLType</code> stored object relationally or as binary XML</p>
</li>
<li>
<p><code>Expression</code> type</p>
</li>
<li>
<p>User-defined types that use type inheritance or type evolution</p>
</li>
<li>
<p>Oracle-supplied types that use type inheritance or type evolution</p>
</li>
</ul>
<p>For Advanced Replication support, you should convert <code>LONG</code> data types to LOBs with <code>BASICFILE</code> storage.</p>
<p>Oracle also does not support the replication of <code>UROWID</code> columns in master tables or updatable materialized views. However, <code>UROWID</code> columns are allowed in read-only materialized views.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink REPMA118" href="../../server.112/e10707/rarmanage.htm#REPMA118"><span class="italic">Oracle Database Advanced Replication Management API Reference</span></a> for information about converting a <code>LONG</code> column into a LOB column in a replicated table</p>
</li>
<li>
<p><a class="olink SQLRF0021" href="../../server.112/e41084/sql_elements001.htm#SQLRF0021"><span class="italic">Oracle Database SQL Language Reference</span></a> for information about data types</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CACBIFBG"></a>
<div id="REPLN590" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Unsupported Table Types<a id="sthref934"></a></h3>
<p>Advanced Replication does not support the replication of the following types of tables and does not support materialized views based on these types of tables:</p>
<ul>
<li>
<p><a id="sthref935"></a><a id="sthref936"></a>Tables that have been compressed with the table compression feature</p>
</li>
<li>
<p><a id="sthref937"></a>Tables with virtual columns</p>
</li>
<li>
<p><a id="sthref938"></a>Temporary tables</p>
</li>
<li>
<p><a id="sthref939"></a>Tables in a flashback data archive</p>
</li>
</ul>
<p><a id="sthref940"></a>In addition, tables with columns that have been encrypted using transparent data encryption are not supported for master replication. However, materialized views based on tables with columns that have been encrypted are supported.</p>
</div>
<!-- class="sect2" -->
<a id="i20201"></a>
<div id="REPLN501" class="sect2">
<h3 class="sect2">Row-Level Dependency Tracking<a id="sthref941"></a><a id="sthref942"></a><a id="sthref943"></a><a id="sthref944"></a><a id="sthref945"></a><a id="sthref946"></a></h3>
<p>When you create a table, you can specify the following options for tracking system change numbers (SCNs):</p>
<ul>
<li>
<p><code>NOROWDEPENDENCIES</code>, the default, specifies that the SCN is tracked at the data block level.</p>
</li>
<li>
<p><code>ROWDEPENDENCIES</code> specifies that the SCN is tracked for each row in the table.</p>
</li>
</ul>
<p>Using the <code>ROWDEPENDENCIES</code> option improves performance and scalability when using parallel propagation, but this option also requires six bytes of additional storage space for each row.</p>
<p>The following SQL statement creates a table with the <code>ROWDEPENDENCIES</code> option:</p>
<pre>
CREATE TABLE order_items 
  (order_id          NUMBER(12), 
  line_item_id       NUMBER(3)  NOT NULL, 
  product_id         NUMBER(6)  NOT NULL, 
  unit_price         NUMBER(8,2), 
  quantity           NUMBER(8)
  ) ROWDEPENDENCIES;
</pre>
<p>Oracle tracks the SCN for each row in this <code>order_items</code> table. You can also use the <code>ROWDEPENDENCIES</code> option in a <code>CREATE</code> <code>CLUSTER</code> statement if your tables are part of a cluster.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="repmaster.htm#i42149">"Data Propagation Dependency Maintenance"</a> for more information about the <code>ROWDEPENDENCIES</code> option</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i14922"></a>
<div id="REPLN104" class="sect1">
<h2 class="sect1">Initialization Parameters<a id="sthref947"></a><a id="sthref948"></a></h2>
<p><a href="#BABHEAIF">Table 6-1</a> lists initialization parameters that are important for the operation, reliability, and performance of a replication environment. This table specifies whether each parameter is modifiable. A modifiable initialization parameter can be modified using the <code>ALTER</code> <code>SYSTEM</code> statement while an instance is running. Some of the modifiable parameters can also be modified for a single session using the <code>ALTER</code> <code>SESSION</code> statement.</p>
<div id="REPLN502" class="tblhruleformalwide">
<p class="titleintable"><a id="sthref949"></a><a id="BABHEAIF"></a>Table 6-1 Initialization Parameters Important for Advanced Replication</p>
<table class="cellalignment1701" title="Initialization Parameters Important for Advanced Replication " summary="This table lists each initialization parameter that is important for Advanced Replication and, for each parameter, the possible values, the description, and the recommendation for an Advanced Replication environment." dir="ltr">
<thead>
<tr class="cellalignment1695">
<th class="cellalignment1702" id="r1c1-t4">Parameter</th>
<th class="cellalignment1702" id="r1c2-t4">Values</th>
<th class="cellalignment1702" id="r1c3-t4">Description</th>
<th class="cellalignment1702" id="r1c4-t4">Recommendation</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r2c1-t4" headers="r1c1-t4">
<pre>
<a class="olink REFRN10065" href="../../server.112/e40402/initparams098.htm#REFRN10065">GLOBAL_NAMES</a><a id="sthref950"></a><a id="sthref951"></a>
</pre></td>
<td class="cellalignment1703" headers="r2c1-t4 r1c2-t4">
<p><span class="bold">Default:</span> <code>false</code></p>
<p><span class="bold">Range:</span> <code>true</code> or <code>false</code></p>
<p><span class="bold">Modifiable?:</span> Yes</p>
</td>
<td class="cellalignment1703" headers="r2c1-t4 r1c3-t4">
<p>Specifies whether a database link is required to have the same name as the database to which it connects.</p>
</td>
<td class="cellalignment1703" headers="r2c1-t4 r1c4-t4">
<p><code>GLOBAL_NAMES</code> must be set to <code>true</code> at each database that is participating in your replication environment, including both master sites and materialized view sites.</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r3c1-t4" headers="r1c1-t4">
<pre>
<a class="olink REFRN10077" href="../../server.112/e40402/initparams112.htm#REFRN10077">JOB_QUEUE_PROCESSES</a><a id="sthref952"></a><a id="sthref953"></a>
</pre></td>
<td class="cellalignment1703" headers="r3c1-t4 r1c2-t4">
<p><span class="bold">Default:</span> <code>1000</code></p>
<p><span class="bold">Range:</span> <code>0</code> to <code>1000</code></p>
<p><span class="bold">Modifiable?:</span> Yes</p>
</td>
<td class="cellalignment1703" headers="r3c1-t4 r1c3-t4">
<p>Specifies the number of J<span class="italic">n</span> job slaves for each instance (<code>J000</code> <code>...</code> <code>J999</code>). Job slaves handle requests created by <code>DBMS_JOB</code>.</p>
<p>When <code>JOB_QUEUE_PROCESSES</code> is set to <code>0</code> at a site, you must apply administrative requests manually for all groups at the site, and you must manually push and purge the deferred transaction queue.</p>
</td>
<td class="cellalignment1703" headers="r3c1-t4 r1c4-t4">
<p>This parameter should either be unset or set to at least&nbsp;1. If it is set, then it should be set to the same value as the maximum number of jobs that can run simultaneously plus one.</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r4c1-t4" headers="r1c1-t4">
<pre>
<a class="olink REFRN10284" href="../../server.112/e40402/initparams142.htm#REFRN10284">MEMORY_MAX_TARGET</a><a id="sthref954"></a><a id="sthref955"></a>
</pre></td>
<td class="cellalignment1703" headers="r4c1-t4 r1c2-t4">
<p><span class="bold">Default:</span> <code>0</code></p>
<p><span class="bold">Range:</span> <code>0</code> to the physical memory size available to the Oracle Database</p>
<p><span class="bold">Modifiable?:</span> No</p>
</td>
<td class="cellalignment1703" headers="r4c1-t4 r1c3-t4">
<p>Specifies the maximum system-wide usable memory for the Oracle database.</p>
</td>
<td class="cellalignment1703" headers="r4c1-t4 r1c4-t4">
<p>If the <code>MEMORY_TARGET</code> parameter is set to a nonzero value, then set this parameter to a large nonzero value if you must specify the maximum memory usage of the Oracle database.</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r5c1-t4" headers="r1c1-t4">
<pre>
<a class="olink REFRN10285" href="../../server.112/e40402/initparams143.htm#REFRN10285">MEMORY_TARGET</a><a id="sthref956"></a><a id="sthref957"></a>
</pre></td>
<td class="cellalignment1703" headers="r5c1-t4 r1c2-t4">
<p><span class="bold">Default:</span> <code>0</code></p>
<p><span class="bold">Range:</span> <code>152</code> <code>MB</code> to <code>MEMORY_MAX_TARGET</code> setting</p>
<p><span class="bold">Modifiable?:</span> Yes</p>
</td>
<td class="cellalignment1703" headers="r5c1-t4 r1c3-t4">
<p>Specifies the system-wide usable memory for the Oracle database.</p>
</td>
<td class="cellalignment1703" headers="r5c1-t4 r1c4-t4">
<p>Oracle recommends enabling the autotuning of the memory usage of the Oracle database by setting <code>MEMORY_TARGET</code> to a large nonzero value (if this parameter is supported on your platform).</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r6c1-t4" headers="r1c1-t4">
<pre>
<a class="olink REFRN10138" href="../../server.112/e40402/initparams164.htm#REFRN10138">OPEN_LINKS</a><a id="sthref958"></a><a id="sthref959"></a>
</pre></td>
<td class="cellalignment1703" headers="r6c1-t4 r1c2-t4">
<p><span class="bold">Default:</span> <code>4</code></p>
<p><span class="bold">Range:</span> <code>0</code> to <code>255</code></p>
<p><span class="bold">Modifiable?:</span> No</p>
</td>
<td class="cellalignment1703" headers="r6c1-t4 r1c3-t4">
<p>Specifies the maximum number of concurrent open connections to remote databases in one session. These connections include the schema objects called database links, as well as external procedures and cartridges, each of which uses a separate process.</p>
</td>
<td class="cellalignment1703" headers="r6c1-t4 r1c4-t4">
<p>If you are using synchronous replication, <code>OPEN_LINKS</code> must be set to at least the number of master sites. For example, an environment with five master sites requires that <code>OPEN_LINKS</code> be set to at least 5.</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r7c1-t4" headers="r1c1-t4">
<pre>
<a class="olink REFRN10158" href="../../server.112/e40402/initparams186.htm#REFRN10158">PARALLEL_MAX_SERVERS</a><a id="sthref960"></a><a id="sthref961"></a>
</pre></td>
<td class="cellalignment1703" headers="r7c1-t4 r1c2-t4">
<p><span class="bold">Default:</span> Derived automatically</p>
<p><span class="bold">Range:</span> <code>0</code> to <code>3600</code></p>
<p><span class="bold">Modifiable?:</span> Yes</p>
</td>
<td class="cellalignment1703" headers="r7c1-t4 r1c3-t4">
<p>Specifies the maximum number of parallel execution processes and parallel recovery processes for an instance. As demand increases, Oracle increases the number of processes from the number created at instance startup up to this value.</p>
</td>
<td class="cellalignment1703" headers="r7c1-t4 r1c4-t4">
<p>If you use parallel propagation, then ensure that the value of this parameter is set high enough to support it.</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r8c1-t4" headers="r1c1-t4">
<pre>
<a class="olink REFRN10160" href="../../server.112/e40402/initparams188.htm#REFRN10160">PARALLEL_MIN_SERVERS</a><a id="sthref962"></a><a id="sthref963"></a>
</pre></td>
<td class="cellalignment1703" headers="r8c1-t4 r1c2-t4">
<p><span class="bold">Default:</span> <code>0</code></p>
<p><span class="bold">Range:</span> <code>0</code> to value of <code>PARALLEL_MAX_SERVERS</code></p>
<p><span class="bold">Modifiable?:</span> Yes</p>
</td>
<td class="cellalignment1703" headers="r8c1-t4 r1c3-t4">
<p>Specifies the minimum number of parallel execution processes for the instance. This value is the number of parallel execution processes Oracle creates when the instance is started.</p>
</td>
<td class="cellalignment1703" headers="r8c1-t4 r1c4-t4">
<p>If you use parallel propagation, then ensure that you have at least one process for each stream.</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r9c1-t4" headers="r1c1-t4">
<pre>
<a class="olink REFRN10175" href="../../server.112/e40402/initparams202.htm#REFRN10175">PROCESSES</a><a id="sthref964"></a><a id="sthref965"></a>
</pre></td>
<td class="cellalignment1703" headers="r9c1-t4 r1c2-t4">
<p><span class="bold">Default:</span> <code>100</code></p>
<p><span class="bold">Range:</span> <code>6</code> to operating system dependent limit</p>
<p><span class="bold">Modifiable?:</span> No</p>
</td>
<td class="cellalignment1703" headers="r9c1-t4 r1c3-t4">
<p>Specifies the maximum number of operating system user processes that can simultaneously connect to Oracle.</p>
</td>
<td class="cellalignment1703" headers="r9c1-t4 r1c4-t4">
<p>Ensure that the value of this parameter allows for all background processes, such as locks, job slaves, and parallel execution processes.</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r10c1-t4" headers="r1c1-t4">
<pre>
<a class="olink REFRN10187" href="../../server.112/e40402/initparams215.htm#REFRN10187">REPLICATION_DEPENDENCY_TRACKING</a><a id="sthref966"></a><a id="sthref967"></a>
</pre></td>
<td class="cellalignment1703" headers="r10c1-t4 r1c2-t4">
<p><span class="bold">Default:</span> <code>true</code></p>
<p><span class="bold">Range:</span> <code>true</code> or <code>false</code></p>
<p><span class="bold">Modifiable?:</span> No</p>
</td>
<td class="cellalignment1703" headers="r10c1-t4 r1c3-t4">
<p>Enables or disables dependency tracking for read/write operations to the database. Dependency tracking is essential for propagating changes in a replication environment in parallel.</p>
<p><code>true</code>: Enables dependency tracking.</p>
<p><code>false</code>: Allows read/write operations to the database to run faster, but does not produce dependency information for Oracle to perform parallel propagation.</p>
</td>
<td class="cellalignment1703" headers="r10c1-t4 r1c4-t4">
<p>Typically, specify <code>true</code>. Do not specify <code>false</code> unless you are sure that your application will perform no read/write operations to the replicated tables.</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r11c1-t4" headers="r1c1-t4">
<pre>
<a class="olink REFRN10256" href="../../server.112/e40402/initparams236.htm#REFRN10256">SGA_TARGET</a><a id="sthref968"></a><a id="sthref969"></a>
</pre></td>
<td class="cellalignment1703" headers="r11c1-t4 r1c2-t4">
<p><span class="bold">Default:</span> <code>0</code></p>
<p><span class="bold">Range:</span> <code>64</code> <code>MB</code> to operating system dependent limit</p>
<p><span class="bold">Modifiable?:</span> Yes</p>
</td>
<td class="cellalignment1703" headers="r11c1-t4 r1c3-t4">
<p>Specifies the total size of all SGA components.</p>
</td>
<td class="cellalignment1703" headers="r11c1-t4 r1c4-t4">
<p>If <code>MEMORY_MAX_TARGET</code> and <code>MEMORY_TARGET</code> are set to <code>0</code> (zero), then Oracle recommends enabling the autotuning of SGA memory by setting <code>SGA_TARGET</code> to a large nonzero value.</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r12c1-t4" headers="r1c1-t4">
<pre>
<a class="olink REFRN10202" href="../../server.112/e40402/initparams240.htm#REFRN10202">SHARED_POOL_SIZE</a><a id="sthref970"></a><a id="sthref971"></a>
</pre></td>
<td class="cellalignment1703" headers="r12c1-t4 r1c2-t4">
<p><span class="bold">Default:</span> <code>0</code></p>
<p>If <code>SGA_TARGET</code> is set to a nonzero value: If the parameter is not specified, then the default is <code>0</code> (internally determined by the Oracle database). If the parameter is specified, then the user-specified value indicates a minimum value for the memory pool.</p>
<p>If <code>SGA_TARGET</code> is not set (32-bit platforms): <code>64</code> <code>MB</code>, rounded up to the nearest granule size</p>
<p>If <code>SGA_TARGET</code> is not set (64-bit platforms): <code>128</code> <code>MB</code>, rounded up to the nearest granule size</p>
<p><span class="bold">Range:</span> The granule size to operating system-dependent limit</p>
<p><span class="bold">Modifiable?:</span> Yes</p>
</td>
<td class="cellalignment1703" headers="r12c1-t4 r1c3-t4">
<p>Specifies in bytes the size of the shared pool. The shared pool contains shared cursors, stored procedures, control structures, and other structures. Larger values improve performance in multiuser systems. Smaller values use less memory.</p>
</td>
<td class="cellalignment1703" headers="r12c1-t4 r1c4-t4">
<p>Typically, the shared pool should be larger for an Oracle database in a replication environment than in a nonreplication environment.</p>
<p>You can monitor utilization of the shared pool by querying the view <code>V$SGASTAT</code>.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformalwide" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink REFRN" href="../e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a> for more information about these initialization parameters</p>
</li>
<li>
<p><a class="olink ADMIN00207" href="../../server.112/e25494/memory.htm#ADMIN00207"><span class="italic">Oracle Database Administrator's Guide</span></a> for more information about the <code>MEMORY_TARGET</code>, <code>MEMORY_MAX_TARGET</code>, and <code>SGA_TARGET</code> parameters</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="i24116"></a>
<div id="REPLN503" class="sect1">
<h2 class="sect1">Master Sites and Materialized View Sites<a id="sthref972"></a><a id="sthref973"></a><a id="sthref974"></a></h2>
<p>When you are planning your replication environment, you must decide whether the sites participating in the replication environment will be master sites or materialized view sites. Consider the characteristics and advantages of both types of replication sites when you are deciding whether a particular site in your replication environment should be a master site or a materialized view site. One replication environment can support both master sites and materialized view sites.</p>
<div id="REPLN504" class="tblhruleformal">
<p class="titleintable"><a id="sthref975"></a><a id="sthref976"></a>Table 6-2 Characteristics of Master Sites and Materialized View Sites</p>
<table class="cellalignment1701" title="Characteristics of Master Sites and Materialized View Sites" summary="This table lists the characteristics of master sites and materialized view sites." dir="ltr">
<thead>
<tr class="cellalignment1695">
<th class="cellalignment1702" id="r1c1-t6">Master Sites</th>
<th class="cellalignment1702" id="r1c2-t6">Materialized View Sites</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r2c1-t6" headers="r1c1-t6">
<p>Typically communicate with a small number of other master sites, and might communicate with a large number of materialized view sites</p>
</td>
<td class="cellalignment1703" headers="r2c1-t6 r1c2-t6">
<p>Communicate with one master site or one master materialized view site</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r3c1-t6" headers="r1c1-t6">
<p>Contain large amounts of data that are full copies of the other master sites' data</p>
</td>
<td class="cellalignment1703" headers="r3c1-t6 r1c2-t6">
<p>Contain small amounts of data that can be subsets of the master site's or master materialized view site's data</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r4c1-t6" headers="r1c1-t6">
<p>Typically communicate continuously with short intervals between data propagation</p>
</td>
<td class="cellalignment1703" headers="r4c1-t6 r1c2-t6">
<p>Communicate periodically with longer intervals between bulk data transfers</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<div id="REPLN505" class="sect2"><a id="sthref977"></a>
<h3 class="sect2">Advantages of Master Sites<a id="sthref978"></a><a id="sthref979"></a></h3>
<p>Master sites have the following advantages:</p>
<ul>
<li>
<p>Support for highly available data access by remote sites</p>
</li>
<li>
<p>Provide better support for frequent data manipulation language (DML) changes because changes are propagated automatically and, typically, at short intervals</p>
</li>
<li>
<p>Allow simultaneous DML changes and data propagation without locking tables</p>
</li>
<li>
<p>Can provide failover protection</p>
</li>
</ul>
<p>To set up a master site, use either the Advanced Replication interface's Configure Master Sites for Replication Wizard or the replication management API.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p>The Advanced Replication interface's online Help for instructions on using the Configure Master Sites for Replication Wizard to set up master sites in Oracle Enterprise Manager</p>
</li>
<li>
<p>The <a class="olink REPMA002" href="../../server.112/e10707/rarrepsite.htm#REPMA002"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> for instructions on using the replication management API to set up a master site</p>
</li>
<li>
<p><a href="#i16790">"Designing for Survivability"</a> for information about designing your replication environment for failover protection</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<div id="REPLN506" class="sect2"><a id="sthref980"></a>
<h3 class="sect2">Advantages of Materialized View Sites<a id="sthref981"></a><a id="sthref982"></a></h3>
<p>Materialized view sites have the following advantages:</p>
<ul>
<li>
<p>Support disconnected computing</p>
</li>
<li>
<p>Can contain a subset of its master site's or master materialized view site's data</p>
</li>
</ul>
<p>To set up a materialized view site, you can use either the Advanced Replication interface's Configure Master and Materialized View Sites for Replication Wizard or the replication management API.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p>The Advanced Replication interface's online Help for instructions on using the Configure Materialized View Sites for Replication Wizard to set up materialized view sites in Oracle Enterprise Manager</p>
</li>
<li>
<p><a class="olink REPMA119" href="../../server.112/e10707/rarrepsite.htm#REPMA119"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> for instructions on using the replication management API to set up a materialized view site</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i16456"></a>
<div id="REPLN101" class="sect2">
<h3 class="sect2">Preparing for Materialized Views<a id="sthref983"></a></h3>
<p>Most problems encountered with materialized view replication result from not preparing the environment properly. There are four essential tasks that you must perform before you begin creating your materialized view environment:</p>
<ul>
<li>
<p>Create the necessary schema.</p>
</li>
<li>
<p>Create the necessary database links.</p>
</li>
<li>
<p>Assign the appropriate privileges.</p>
</li>
<li>
<p>Allocate sufficient job processes.</p>
</li>
</ul>
<p>The Advanced Replication interface's Configure Master and Materialized View Sites for Replication Wizard automatically performs these tasks. The following discussion is provided to help you understand the replication environment and to help those who use the replication management API. After running Setup Wizard, create the necessary materialized view logs. See the Advanced Replication interface's online Help in Oracle Enterprise Manager for instructions on using the interface to set up your materialized view site.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#i16626">"Creating a Materialized View Log"</a></div>
<p>If you are not able to use the Advanced Replication interface, then review the "Set Up Materialized View Sites" section in Chapter 2 of the <a class="olink REPMA119" href="../../server.112/e10707/rarrepsite.htm#REPMA119"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> for detailed instructions on setting up your materialized view site using the replication management API.</p>
<p>The following sections describe what the Advanced Replication interface's Configure Master and Materialized View Sites for Replication Wizard or the script in the <a class="olink REPMA119" href="../../server.112/e10707/rarrepsite.htm#REPMA119"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> does to set up your materialized view site.</p>
<div id="REPLN507" class="sect3"><a id="sthref984"></a>
<h4 class="sect3">Create Materialized View Site Users</h4>
<p>Each materialized view site needs several users to perform the administrative and refreshing activities at the materialized view site. You must create and grant the necessary privileges to the materialized view administrator and to the refresher.</p>
</div>
<!-- class="sect3" -->
<div id="REPLN508" class="sect3"><a id="sthref985"></a>
<h4 class="sect3">Create Master Site Users</h4>
<p>You need equivalent proxy users at the target master site to perform tasks on behalf of the materialized view site users. Usually, a proxy materialized view administrator and a proxy refresher are created.</p>
</div>
<!-- class="sect3" -->
<div id="REPLN509" class="sect3"><a id="sthref986"></a>
<h4 class="sect3">Create Schemas at Materialized View Site<a id="sthref987"></a><a id="sthref988"></a><a id="sthref989"></a></h4>
<p>A schema containing a materialized view in a remote database must correspond to the schema that contains the master table in the master database. Therefore, identify the schemas that contain the master tables that you want to replicate with materialized views. After you have identified the target schemas at the master database, create the corresponding accounts with the same names at the remote database. For example, if all master tables are in the <code>sales</code> schema of the <code>ny.example.com</code> database, then create a corresponding <code>sales</code> schema in the materialized view database <code>sf.example.com</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
If you are reviewing the steps in <a class="olink REPMA005" href="../../server.112/e10707/rarmviewgroup.htm#REPMA005"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a>, then the necessary schemas are created as part of the script described in the instructions for creating a materialized view group</div>
</div>
<!-- class="sect3" -->
<div id="REPLN510" class="sect3"><a id="sthref990"></a>
<h4 class="sect3">Create Database Links<a id="sthref991"></a><a id="sthref992"></a></h4>
<p>The defining query of a materialized view can use one or more database links to reference remote table data. Before creating materialized views, the database links you plan to use must be available. Furthermore, the account that a database link uses to access a remote database defines the security context under which Oracle creates and subsequently refreshes a materialized view.</p>
<p>To ensure proper behavior, a materialized view's defining query must use a database link that includes an embedded user name and password in its definition; you cannot use a public database link when creating a materialized view. A database link with an embedded name and password always establishes connections to the remote database using the specified account. Additionally, the remote account that the link uses must have the <code>SELECT</code> privileges necessary to access the data referenced in the materialized view's defining query.</p>
<p>Before creating your materialized views, you must create several administrative database links. Specifically, you should create a <code>PUBLIC</code> database link from the materialized view site to the master site. Doing so makes defining your private database links easier because you do not need to include the <code>USING</code> clause in each link. You also need private database links from the materialized view administrator to the proxy administrator and from the propagator to the receiver, but, if you use the Advanced Replication interface's Configure Master and Materialized View Sites for Replication Wizard, then these database links are created for you automatically.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
The information about security options in <a class="olink REPMA028" href="../../server.112/e10707/rarsec.htm#REPMA028"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> for more information</div>
<p>After the administrative database links have been created, a private database link must be created connecting each replicated materialized view schema at the materialized view database to the corresponding schema at the master database. Be sure to embed the associated master database account information in each private database link at the materialized view database. For example, the <code>hr</code> schema at a materialized view database should have a private database link to the master database that connects using the <code>hr</code> user name and password.</p>
<div id="REPLN511" class="figure">
<p class="titleinfigure"><a id="i17071"></a>Figure 6-1 Recommended Schema and Database Link Configuration</p>
<img width="600" height="312" src="img/repln056.gif" alt="Description of Figure 6-1 follows" /><br />
<a id="sthref993" href="img_text/repln056.htm">Description of "Figure 6-1 Recommended Schema and Database Link Configuration"</a><br />
<br /></div>
<!-- class="figure" -->
<p><a id="sthref994"></a><a id="sthref995"></a>For multimaster replication, there must be no Virtual Private Database (VPD) restrictions on the replication propagator and receiver schemas. For materialized views, the defining query for the materialized view cannot be modified by VPD. VPD must return a <code>NULL</code> policy for the schema that performs both the create and refresh of the materialized view. Creating a materialized view with a non-<code>NULL</code> VPD policy is allowed when the <code>USING</code> <code>TRUSTED</code> <code>CONSTRAINTS</code> clause is specified. In this case, ensure that the materialized view behaves correctly. Materialized view results are computed based on the rows and columns filtered by VPD policy. Therefore, you must coordinate the materialized view definition with the VPD policy to ensure the correct results.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ADMIN028" href="../../server.112/e25494/ds_concepts.htm#ADMIN028"><span class="italic">Oracle Database Administrator's Guide</span></a> for more information about database links</p>
</li>
<li>
<p><a class="olink DBSEG" href="../../network.112/e36292/toc.htm"><span class="italic">Oracle Database Security Guide</span></a> for more information about&nbsp;VPD</p>
</li>
<li>
<p><a class="olink OLSAG086" href="../../network.112/e10745/multiple.htm#OLSAG086"><span class="italic">Oracle Label Security Administrator's Guide</span></a> for information about Advanced Replication and Oracle Label Security</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="i16527"></a>
<div id="REPLN512" class="sect3">
<h4 class="sect3">Assign Privileges<a id="sthref996"></a><a id="sthref997"></a></h4>
<p>Both the creator and the owner of the materialized view must be able to issue the defining <code>SELECT</code> statement of the materialized view. The owner is the schema that contains the materialized view. If a user other than the replication or materialized view administrator creates the materialized view, then that user must have the <code>CREATE</code> <code>MATERIALIZED</code> <code>VIEW</code> privilege and the appropriate <code>SELECT</code> privileges to execute the defining <code>SELECT</code> statement.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
If you are reviewing the steps in <a class="olink REPMA005" href="../../server.112/e10707/rarmviewgroup.htm#REPMA005"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a>, then the necessary privileges are granted as part of the script described in instructions for creating a materialized view group. Privilege requirements are also described in <a href="repmview.htm#i53514">"Required Privileges for Materialized View Operations"</a></div>
</div>
<!-- class="sect3" -->
<div id="REPLN513" class="sect3"><a id="sthref998"></a>
<h4 class="sect3">Schedule Purge at Master Site<a id="sthref999"></a><a id="sthref1000"></a></h4>
<p>To keep the size of the deferred transaction queues in check, schedule a purge operation to remove all successfully completed deferred transactions from the deferred transaction queue. This operation might have already been performed at the master site. Scheduling the purge operation again does not harm the master site, but might change the purge scheduling characteristics.</p>
</div>
<!-- class="sect3" -->
<div id="REPLN514" class="sect3"><a id="sthref1001"></a>
<h4 class="sect3">Schedule Push<a id="sthref1002"></a><a id="sthref1003"></a><a id="sthref1004"></a></h4>
<p>Scheduling a push at the materialized view site automatically propagates the deferred transactions at the materialized view site to the associated target master site using a database link. These types of database links are called scheduled links. Typically, there is only a single scheduled link for each materialized view group at a materialized view site, because a materialized view group only has a single target master site.</p>
</div>
<!-- class="sect3" -->
<a id="i16547"></a>
<div id="REPLN515" class="sect3">
<h4 class="sect3">Allocate Job Slaves<a id="sthref1005"></a><a id="sthref1006"></a><a id="sthref1007"></a><a id="sthref1008"></a></h4>
<p>It is important that you have allocated sufficient job slaves to handle the automation of your replication environment. The job slaves automatically propagate the deferred transaction queue, purge the deferred transaction queue, refresh materialized views, and so on.</p>
<p>For multimaster replication, each site has a scheduled link to each of the other master sites. For example, if you have six master sites, then each site has scheduled links to the other five sites. You typically need one process for each scheduled link. You might also want to add additional job processes for purging the deferred transaction queue and other user-defined jobs.</p>
<p>By the nature of materialized view replication, each materialized view site typically has one scheduled link to the master database and requires at least one job process. Materialized view sites typically require between one and three job processes, depending on purge scheduling, user-defined jobs, and the scheduled link. Also, you need at least one job slave for each degree of parallelism.</p>
<p>Alternatively, if your users are responsible for manually refreshing the materialized view through an application interface, then you do not need to create a scheduled link and your materialized view site requires one less job process.</p>
<p>The job slaves are defined using the <code>JOB_QUEUE_PROCESSES</code> initialization parameter in the initialization parameter file for your database. This initialization parameter is modifiable. Therefore, you can modify it while an instance is running. Oracle automatically determines the interval for job slaves. That is, Oracle determines when the job slaves should "wake up" to execute jobs.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#i14922">"Initialization Parameters"</a> and the <a class="olink REFRN10077" href="../../server.112/e40402/initparams112.htm#REFRN10077"><span class="italic">Oracle Database Reference</span></a> for information about <code>JOB_QUEUE_PROCESSES</code></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i16626"></a>
<div id="REPLN516" class="sect2">
<h3 class="sect2">Creating a Materialized View Log<a id="sthref1009"></a><a id="sthref1010"></a></h3>
<p>Before creating materialized view groups and materialized views for a remote materialized view site, ensure that you create the necessary materialized view logs at the master site or master materialized view site. A materialized view log is necessary for every master table or master materialized view that supports at least one materialized view with fast refreshes.</p>
<p>To create a materialized view log, you need the following privileges:</p>
<ul>
<li>
<p><code>CREATE</code> <code>ANY</code> <code>TABLE</code></p>
</li>
<li>
<p><code>CREATE</code> <code>ANY</code> <code>TRIGGER</code></p>
</li>
<li>
<p><code>SELECT</code> (on the materialized view log's master)</p>
</li>
<li>
<p><code>COMMENT</code> <code>ANY</code> <code>TABLE</code></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
The Advanced Replication interface's online Help for detailed information about creating materialized view logs at the master site or master materialized view site with the Advanced Replication interface in Oracle Enterprise Manager.</div>
<a id="i16640"></a>
<div id="REPLN106" class="sect3">
<h4 class="sect3">Logging Columns in the Materialized View Log<a id="sthref1011"></a><a id="sthref1012"></a><a id="sthref1013"></a><a id="sthref1014"></a><a id="sthref1015"></a></h4>
<p>When you create a materialized view log, you can add columns to the log when necessary. To perform a fast refresh on a materialized view, the following types of columns must be added to the materialized view log:</p>
<ul>
<li>
<p>A column referenced in the <code>WHERE</code> clause of a subquery that is not part of an equi-join and is not a primary key column. These columns are called filter columns.</p>
</li>
<li>
<p>A column in an equi-join that is not a primary key column, if the subquery is either many to many or one to many. If the subquery is many to one, then you do not need to add the join column to the materialized view log.</p>
</li>
</ul>
<p>A collection column cannot be added to a materialized view log. Also, materialized view logs are not required for materialized views that use complete refresh.</p>
<p>For example, consider the following DDL:</p>
<pre>
1) CREATE MATERIALIZED VIEW oe.customers REFRESH FAST AS
2)  SELECT * FROM oe.customers@orc1.example.com c
3)  WHERE EXISTS
4)    (SELECT * FROM oe.orders@orc1.example.com o
5)     WHERE c.customer_id = o.customer_id AND o.order_total &gt; 20000);
</pre>
<p>Notice in line 5 of the preceding DDL that three columns are referenced in the <code>WHERE</code> clause. Columns <code>orders.customer_id</code> and <code>customers.customer_id</code> are referenced as part of the equi-join clause. Because <code>customers.customer_id</code> is a primary key column, it is logged by default, but <code>orders.customer_id</code> is not a primary key column and so must be added to the materialized view log. Also, the column <code>orders.order_total</code> is an additional filter column and so must be logged.</p>
<p>Therefore, add <code>orders.customer_id</code> and <code>orders.order_total</code> the materialized view log for the <code>oe.orders</code> table.</p>
<p>To create the materialized view log with these columns added, issue the following statement:</p>
<pre>
CREATE MATERIALIZED VIEW LOG ON oe.orders 
  WITH PRIMARY KEY (customer_id,order_total);
</pre>
<p><a id="sthref1016"></a>If a materialized view log already exists on the <code>oe.customers</code> table, you can add these columns by issuing the following statement:</p>
<pre>
ALTER MATERIALIZED VIEW LOG ON oe.orders ADD (customer_id,order_total);
</pre>
<p>If you are using user-defined data types, then the attributes of column objects can be logged in the materialized view log. For example, the <code>oe.customers</code> table has the <code>cust_address.postal_code</code> attribute, which can be logged in the materialized view log by issuing the following statement:</p>
<pre>
ALTER MATERIALIZED VIEW LOG ON oe.customers ADD (cust_address.postal_code);
</pre>
<p>You are encouraged to analyze the defining queries of your planned materialized views and identify which columns must be added to your materialized view logs. If you try to create or refresh a materialized view that requires an added column without adding the column to the materialized view log, then your materialized view creation or refresh might fail.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
To perform a fast refresh on a materialized view, you must add join columns in subqueries to the materialized view log if the join column is not a primary key and the subquery is either many to many or one to many. If the subquery is many to one, then you do not need to add the join column to the materialized view log.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="repmview.htm#i28635">"Data Subsetting with Materialized Views"</a> for information about materialized views with subqueries</p>
</li>
<li>
<p><a href="repmview.htm#i28701">"Restrictions for Materialized Views with Subqueries"</a> for additional information about materialized views with subqueries</p>
</li>
<li>
<p><a href="#i16626">"Creating a Materialized View Log"</a> for information about creating a materialized view log</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i16679"></a>
<div id="REPLN517" class="sect2">
<h3 class="sect2">Creating a Materialized View Environment<a id="sthref1017"></a></h3>
<p>Materialized view environments can be created in several different ways and from several different locations. In most cases, you should use deployment templates at the master site to locally precreate a materialized view environment that will be individually deployed to the target materialized view site.</p>
<p>You can also individually create the materialized view environment by establishing a connection to the materialized view site and building the materialized view environment directly.</p>
<div id="REPLN518" class="sect3"><a id="sthref1018"></a>
<h4 class="sect3">Creating a Materialized View Environment Using the Replication Management&nbsp;Interface</h4>
<p>See the Advanced Replication interface's online Help in Oracle Enterprise Manager for information about using deployment templates to centrally create a materialized view environment using the Advanced Replication interface.</p>
<p>See the Advanced Replication interface's online Help in Enterprise Manager for information about individually creating the materialized view environment with a direct connection to the remote materialized view site using the Advanced Replication interface.</p>
<div id="REPLN519" class="figure">
<p class="titleinfigure"><a id="sthref1019"></a>Figure 6-2 Flowchart for Creating Materialized Views</p>
<img width="600" height="368" src="img/repln076.gif" alt="Description of Figure 6-2 follows" /><br />
<a id="sthref1020" href="img_text/repln076.htm">Description of "Figure 6-2 Flowchart for Creating Materialized Views"</a><br />
<br /></div>
<!-- class="figure" --></div>
<!-- class="sect3" -->
<div id="REPLN520" class="sect3"><a id="sthref1021"></a>
<h4 class="sect3">Creating a Materialized View Environment Using the Replication Management&nbsp;API</h4>
<p>The instructions for creating a deployment template in the <a class="olink REPMA004" href="../../server.112/e10707/rardt.htm#REPMA004"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> manual for information about using deployment templates to centrally precreate a materialized view environment using the replication management API.</p>
<p>The instructions for creating a materialized view group the <a class="olink REPMA005" href="../../server.112/e10707/rarmviewgroup.htm#REPMA005"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> manual for information about individually creating the materialized view environment with a direct connection to the remote materialized view site using the replication management API.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i18389"></a>
<div id="REPLN521" class="sect2">
<h3 class="sect2">Avoiding Problems When Adding a New Materialized View Site<a id="sthref1022"></a><a id="sthref1023"></a></h3>
<p>After you have created a materialized view environment with one or more materialized view sites, you might need to add new materialized view sites. You might encounter problems when you try to perform a fast refresh on the materialized views you create at a new materialized view site if both of the following conditions are true:</p>
<ul>
<li>
<p>Materialized views at the new materialized view site and existing materialized views at other materialized view sites are based on the same master table or master materialized view.</p>
</li>
<li>
<p>Existing materialized views can be refreshed while you create the new materialized views at the new materialized view site.</p>
</li>
</ul>
<p>The problem arises when the materialized view logs for the masters are purged before a new materialized view can perform its first fast refresh. If this happens and you try to perform a fast refresh on the materialized views at the new materialized view site, then you might encounter the following errors:</p>
<pre>
ORA-12004 REFRESH FAST cannot be used for materialized view <span class="italic">materialized_view_name</span>
ORA-12034 materialized view log on <span class="italic">materialized_view_name</span> younger than last refresh
</pre>
<p>If you receive these errors, then the only solution is to perform a complete refresh of the new materialized view.</p>
<p>To avoid this problem, choose one of the following options:</p>
<ul>
<li>
<p>Use deployment templates to create the materialized view environment at materialized view sites. You will not encounter this problem if you use deployment templates.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="repdt.htm#g49875">Chapter 4, "Deployment&nbsp;Templates Concepts and Architecture"</a> for information about deployment templates</div>
</li>
<li>
<p>Create a dummy materialized view at the new materialized view site before you create your production materialized views. The dummy materialized view ensures that the materialized view log will not be purged while your production materialized views are being created.</p>
</li>
</ul>
<p>If you choose to create a dummy materialized view at the materialized view site, complete the following steps:</p>
<ol>
<li>
<p>Create a dummy materialized view called <code>dummy_mview</code> based on the master table or master materialized view. For example, to create a dummy materialized view based on a master table named <code>sales</code>, issue the following statement at the new materialized view site:</p>
<pre>
CREATE MATERIALIZED VIEW dummy_mview REFRESH FAST AS 
  SELECT * FROM pr.sales@orc1.example.com WHERE 1=0; 
</pre></li>
<li>
<p>Create your production materialized views at the new materialized view site.</p>
</li>
<li>
<p>Perform fast refresh of your production materialized views at the new materialized view site.</p>
</li>
<li>
<p>Drop the dummy materialized view.</p>
</li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i24273"></a>
<div id="REPLN522" class="sect1">
<h2 class="sect1">Interoperability in an Advanced Replication Environment<a id="sthref1024"></a><a id="sthref1025"></a></h2>
<p>If you plan to configure an Advanced Replication environment that involves different releases of Oracle Database at different replication sites, then your environment must meet the following requirements:</p>
<ul>
<li>
<p>Oracle Database 11<span class="italic">g</span> master sites can only interact with Oracle9<span class="italic">i</span> Release 2 (9.2) or later master sites.</p>
</li>
<li>
<p>Oracle Database 11<span class="italic">g</span> materialized view sites can only interact with Oracle9<span class="italic">i</span> Release 2 (9.2) or later master sites.</p>
</li>
<li>
<p>Oracle Database 11<span class="italic">g</span> master sites can only interact with Oracle9<span class="italic">i</span> Release 2 (9.2) or later materialized view sites.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="repunicode.htm#i11506">"Replication Support for Unicode"</a> for information about interoperability in Advanced Replication environments that use <code>NCHAR</code> or <code>NVARCHAR2</code> data types</div>
</div>
<!-- class="sect1" -->
<a id="i18408"></a>
<div id="REPLN103" class="sect1">
<h2 class="sect1">Guidelines for Scheduled Links<a id="sthref1026"></a><a id="sthref1027"></a><a id="sthref1028"></a></h2>
<p>A scheduled link determines how a master site propagates its deferred transaction queue to another master site, or how a materialized view site propagates its deferred transaction queue to its master site or master materialized view site. When you create a scheduled link, Oracle creates a job in the local job queue to push the deferred transaction queue to another site in the system. When Oracle propagates deferred transactions to a remote master site, it does so within the security context of the replication propagator.</p>
<p>You can configure a scheduled link to push information using serial or parallel propagation. In general, you should use parallel propagation, even if you set the <code>parallelism</code> parameter to 1.</p>
<p>Before creating the scheduled links for a replication environment, carefully consider how you want replication to occur globally throughout the system. For example, you can choose to propagate deferred transactions at intervals, with time in between these intervals when the deferred transactions are not propagated. In this case, you must decide how often and when to schedule pushes. Alternatively, to simulate real-time (or synchronous) replication, you might want to have each scheduled link continuously push a master site's deferred transaction queue to its destination.</p>
<p>Also, you might want to schedule pushes at a time of the day when connectivity is guaranteed or when communications costs are lowest, such as during evening hours. Furthermore, you might want to stagger the scheduling for links among all master sites to distribute the load that replication places on network resources.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#i14014">"Serial and Parallel Propagation"</a> for more information about issues related to serial and parallel propagation</div>
<div id="REPLN523" class="sect2"><a id="sthref1029"></a>
<h3 class="sect2">Scheduling Periodic Pushes<a id="sthref1030"></a><a id="sthref1031"></a><a id="sthref1032"></a><a id="sthref1033"></a><a id="sthref1034"></a></h3>
<p>You can schedule periodic intervals between pushes of a site's deferred transaction queue to a remote destination. Examples of periodic intervals are once an hour or once a day. To do so, you can use the <code>DBMS_DEFER_SYS.SCHEDULE_PUSH</code> procedure and specify the settings shown in <a href="#g38976">Table 6-3</a>.</p>
<div id="REPLN524" class="tblhruleformal">
<p class="titleintable"><a id="sthref1035"></a><a id="g38976"></a>Table 6-3 Settings to Schedule Periodic Pushes</p>
<table class="cellalignment1701" title="Settings to Schedule Periodic Pushes" summary="This table lists some SCHEDULE_PUSH procedure parameters and the setting for each parameter for periodic pushes." dir="ltr">
<thead>
<tr class="cellalignment1695">
<th class="cellalignment1702" id="r1c1-t21">SCHEDULE_PUSH Procedure Parameter</th>
<th class="cellalignment1702" id="r1c2-t21">Value</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r2c1-t21" headers="r1c1-t21">
<p><code>delay_seconds</code></p>
</td>
<td class="cellalignment1703" headers="r2c1-t21 r1c2-t21">
<p>0</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r3c1-t21" headers="r1c1-t21">
<p><code>interval</code></p>
</td>
<td class="cellalignment1703" headers="r3c1-t21 r1c2-t21">
<p>An appropriate date expression; for example, to specify an interval of one hour, use <code>'sysdate + 1/24'</code></p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<p>You can also use the Advanced Replication interface in Oracle Enterprise Manager to schedule periodic pushes. To do so, set delay seconds to 0 (zero) when configuring a scheduled link.</p>
<p>Then configure the interval (the "then push every" control) to push the deferred transaction queue periodically.</p>
<p>The following is an example that schedules a periodic push once an hour:</p>
<pre>
BEGIN
   DBMS_DEFER_SYS.SCHEDULE_PUSH (
      destination =&gt; 'orc2.example.com',
      interval =&gt; 'SYSDATE + (1/24)',
      next_date =&gt; SYSDATE,
      delay_seconds =&gt; 0);
END;
/
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="repmaster.htm#i46930">"Delay Seconds"</a> for more information about setting delay seconds</p>
</li>
<li>
<p><a class="olink REPMA120" href="../../server.112/e10707/rardefsyspac.htm#REPMA120"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> for information about the <code>DBMS_DEFER_SYS.SCHEDULE_PUSH</code> procedure</p>
</li>
<li>
<p>The Advanced Replication interface online Help for information about using this interface in Enterprise Manager</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i20874"></a>
<div id="REPLN100" class="sect2">
<h3 class="sect2">Scheduling Continuous Pushes<a id="sthref1036"></a><a id="sthref1037"></a><a id="sthref1038"></a><a id="sthref1039"></a><a id="sthref1040"></a></h3>
<p>Even when using Oracle's asynchronous replication mechanisms, you can configure a scheduled link to simulate continuous, real-time replication. To do so, use the <code>DBMS_DEFER_SYS.SCHEDULE_PUSH</code> procedure and specify the settings shown in <a href="#g38816">Table 6-4</a>.</p>
<div id="REPLN525" class="tblhruleformal">
<p class="titleintable"><a id="sthref1041"></a><a id="g38816"></a>Table 6-4 Settings to Simulate Continuous Push</p>
<table class="cellalignment1701" title="Settings to Simulate Continuous Push" summary="This table lists some SCHEDULE_PUSH procedure parameters and the setting for each parameter to simulate continuous pushes." dir="ltr">
<thead>
<tr class="cellalignment1695">
<th class="cellalignment1702" id="r1c1-t23">SCHEDULE_PUSH Procedure Parameter</th>
<th class="cellalignment1702" id="r1c2-t23">Value</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r2c1-t23" headers="r1c1-t23">
<p><code>delay_seconds</code></p>
</td>
<td class="cellalignment1703" headers="r2c1-t23 r1c2-t23">
<p>1200</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r3c1-t23" headers="r1c1-t23">
<p><code>interval</code></p>
</td>
<td class="cellalignment1703" headers="r3c1-t23 r1c2-t23">
<p>Lower than the <code>delay_seconds</code> setting</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r4c1-t23" headers="r1c1-t23">
<p><code>parallelism</code></p>
</td>
<td class="cellalignment1703" headers="r4c1-t23 r1c2-t23">
<p>1 or higher</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r5c1-t23" headers="r1c1-t23">
<p><code>execution_seconds</code></p>
</td>
<td class="cellalignment1703" headers="r5c1-t23 r1c2-t23">
<p>Higher than the <code>delay_seconds</code> setting</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<p>With this configuration, Oracle continues to push transactions that enter the deferred transaction queue for the duration of the entire interval. If the deferred transaction queue has no transactions to propagate for the amount of time specified by the <code>delay_seconds</code> parameter, then Oracle releases the resources used by the job and starts fresh when the next job slave becomes available.</p>
<p>If you are using serial propagation by setting the <code>parallelism</code> parameter to 0 (zero), then you can simulate continuous push by reducing the settings of the <code>delay_seconds</code> and <code>interval</code> parameters to an appropriate value for your environment. However, if you are using serial propagation, simulating continuous push is costly when the push job must initiate often.</p>
<p>The following is an example that simulates continual pushes:</p>
<pre>
BEGIN
   DBMS_DEFER_SYS.SCHEDULE_PUSH (
      destination =&gt; 'orc2.example.com',
      interval =&gt; 'SYSDATE + (1/144)',
      next_date =&gt; SYSDATE,
      parallelism =&gt; 1,
      execution_seconds =&gt; 1500,
      delay_seconds =&gt; 1200);
END;
/
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="repmaster.htm#i46930">"Delay Seconds"</a> for more information about setting delay seconds</p>
</li>
<li>
<p><a href="#i14014">"Serial and Parallel Propagation"</a> for more information about issues related to serial and parallel propagation</p>
</li>
<li>
<p><a class="olink REPMA120" href="../../server.112/e10707/rardefsyspac.htm#REPMA120"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> for information about the <code>DBMS_DEFER_SYS.SCHEDULE_PUSH</code> procedure</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i15338"></a>
<div id="REPLN108" class="sect1">
<h2 class="sect1">Guidelines for Scheduled Purges of a Deferred Transaction Queue<a id="sthref1042"></a><a id="sthref1043"></a><a id="sthref1044"></a><a id="sthref1045"></a></h2>
<p>A scheduled purge determines how a master site or materialized view site purges applied transactions from its deferred transaction queue. When you use a configuration wizard in the Advanced Replication interface in Oracle Enterprise Manager to set up a master site or materialized view site, Oracle creates a job in each site's local job queue to purge the local deferred transaction queue on a regular basis. Carefully consider how you want purging to occur before configuring the sites in a replication environment. For example, consider the following options:</p>
<ul>
<li>
<p>You can synchronize the pushing and purging of a site's deferred transaction queue. For example, you can configure continuous pushing and purging of the transaction queue. This type of configuration can offer performance advantages because it is likely that information about recently pushed transactions is already in the server's buffer cache for the corresponding purge operation.</p>
</li>
<li>
<p>When a server is not CPU bound, you can schedule continuous purging of the deferred transaction queue to keep the size of the queue as small as possible.</p>
</li>
<li>
<p>For servers that experience a high-volume of transaction throughput during normal business hours, you can schedule purges to occur during off-peak hours if you can store an entire day's deferred transactions.</p>
</li>
</ul>
<div id="REPLN526" class="sect2"><a id="sthref1046"></a>
<h3 class="sect2">Scheduling Periodic Purges<a id="sthref1047"></a><a id="sthref1048"></a><a id="sthref1049"></a></h3>
<p>You can schedule periodic purges of a site's deferred transaction queue. Examples of periodic purges are purges that occur once a day or once a week. To do so, you can use the <code>DBMS_DEFER_SYS.SCHEDULE_PURGE</code> procedure and specify the settings shown in <a href="#g38923">Table 6-5</a>.</p>
<div id="REPLN527" class="tblhruleformal">
<p class="titleintable"><a id="sthref1050"></a><a id="g38923"></a>Table 6-5 Settings to Schedule Periodic Purges</p>
<table class="cellalignment1701" title="Settings to Schedule Periodic Purges" summary="This table lists some SCHEDULE_PURGE procedure parameters and the setting for each parameter for periodic purges." dir="ltr">
<thead>
<tr class="cellalignment1695">
<th class="cellalignment1702" id="r1c1-t25">SCHEDULE_PURGE Procedure Parameter</th>
<th class="cellalignment1702" id="r1c2-t25">Value</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r2c1-t25" headers="r1c1-t25">
<p><code>delay_seconds</code></p>
</td>
<td class="cellalignment1703" headers="r2c1-t25 r1c2-t25">
<p>0</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r3c1-t25" headers="r1c1-t25">
<p><code>interval</code></p>
</td>
<td class="cellalignment1703" headers="r3c1-t25 r1c2-t25">
<p>An appropriate date expression; for example, to specify an interval of one day, use <code>'sysdate + 1'</code></p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<p>You can also use the Advanced Replication interface in Oracle Enterprise Manager to schedule periodic purges. To do so, set delay seconds to 0 (zero). Then configure the interval (the "then purge every" control) to purge the deferred transaction queue.</p>
<p>The following is an example that schedules a periodic purge once a day:</p>
<pre>
BEGIN
   DBMS_DEFER_SYS.SCHEDULE_PURGE (
      next_date =&gt; SYSDATE,
      interval =&gt; 'SYSDATE + 1',
      delay_seconds =&gt; 0);
END;
/
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink REPMA121" href="../../server.112/e10707/rardefsyspac.htm#REPMA121"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> for information about the <code>DBMS_DEFER_SYS.SCHEDULE_PURGE</code> procedure</p>
</li>
<li>
<p>The Advanced Replication interface online Help for information about using this interface in Enterprise Manager</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<div id="REPLN528" class="sect2"><a id="sthref1051"></a>
<h3 class="sect2">Scheduling Continuous Purges<a id="sthref1052"></a><a id="sthref1053"></a></h3>
<p>To configure continuous purging of a site's deferred transaction queue, you can use the <code>DBMS_DEFER_SYS.SCHEDULE_PURGE</code> procedure and specify the settings shown in <a href="#g38936">Table 6-6</a>.</p>
<div id="REPLN529" class="tblhruleformal">
<p class="titleintable"><a id="sthref1054"></a><a id="g38936"></a>Table 6-6 Settings to Schedule Continuous Purges</p>
<table class="cellalignment1701" title="Settings to Schedule Continuous Purges" summary="This table lists some SCHEDULE_PURGE procedure parameters and the setting for each parameter for continuous purges." dir="ltr">
<thead>
<tr class="cellalignment1695">
<th class="cellalignment1702" id="r1c1-t27">SCHEDULE_PURGE Procedure Parameter</th>
<th class="cellalignment1702" id="r1c2-t27">Value</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r2c1-t27" headers="r1c1-t27">
<p><code>delay_seconds</code></p>
</td>
<td class="cellalignment1703" headers="r2c1-t27 r1c2-t27">
<p>500000</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r3c1-t27" headers="r1c1-t27">
<p><code>interval</code></p>
</td>
<td class="cellalignment1703" headers="r3c1-t27 r1c2-t27">
<p>Lower than the <code>delay_seconds</code> setting</p>
</td>
</tr>
<tr class="cellalignment1695">
<td class="cellalignment1703" id="r4c1-t27" headers="r1c1-t27">
<p><code>purge_method</code></p>
</td>
<td class="cellalignment1703" headers="r4c1-t27 r1c2-t27">
<p><code>dbms_defer_sys.purge_method_quick</code> setting</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<p>You can also use the Advanced Replication interface to configure continuous purge. To do so, on the Purge Schedule page, set <span class="bold">Delay Seconds</span> to 500,000 and set interval (the <span class="bold">Every</span> field) to a value less than the <span class="bold">Delay Seconds</span> setting.</p>
<p>The following is an example that simulates continuous purges:</p>
<pre>
BEGIN
   DBMS_DEFER_SYS.SCHEDULE_PURGE (
      next_date =&gt; SYSDATE,
      interval =&gt; 'SYSDATE + (1/144)',
      purge_method =&gt; dbms_defer_sys.purge_method_quick,
      delay_seconds =&gt; 500000);
END;
/
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="repmaster.htm#i46930">"Delay Seconds"</a> for more information about setting delay seconds</p>
</li>
<li>
<p><a class="olink REPMA121" href="../../server.112/e10707/rardefsyspac.htm#REPMA121"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> for information about the <code>DBMS_DEFER_SYS.SCHEDULE_PURGE</code> procedure</p>
</li>
<li>
<p>The Advanced Replication interface online Help for information about using this interface in Enterprise Manager</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i14014"></a>
<div id="REPLN112" class="sect1">
<h2 class="sect1">Serial and Parallel Propagation<a id="sthref1055"></a><a id="sthref1056"></a><a id="sthref1057"></a><a id="sthref1058"></a></h2>
<p>When you create the scheduled links for a replication environment, each link can asynchronously propagate changes to a destination using either serial or parallel propagation. Before you configure your replication environment, decide whether you want to use serial propagation or parallel propagation.</p>
<ul>
<li>
<p>With serial propagation, Oracle propagates replicated transactions one at a time in the same order that they are committed on the source system. To configure a scheduled link with serial propagation, set the <code>parallelism</code> parameter to 0 (zero) in the <code>DBMS_DEFER_SYS.SCHEDULE_PUSH</code> procedure. Or, using the Advanced Replication interface in Oracle Enterprise Manager, set the <span class="bold">Propagation Processes</span> control to 0 (zero) in the Edit Push Schedule page.</p>
</li>
<li>
<p>With parallel propagation, Oracle propagates replicated transactions using multiple parallel streams for higher throughput. When necessary, Oracle orders the execution of dependent transactions to preserve data integrity. To configure a scheduled link with parallel propagation, set the <code>parallelism</code> parameter to 1 or higher in the <code>DBMS_DEFER_SYS.SCHEDULE_PUSH</code> procedure. Or, using the Advanced Replication interface in Oracle Enterprise Manager, set the <span class="bold">Propagation Processes</span> control to 1 or higher in the Edit Push Schedule page. Typically, you should use parallel propagation.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="repmaster.htm#i37218">"Parallel Propagation"</a></p>
</li>
<li>
<p><a class="olink REPMA013" href="../../server.112/e10707/rardefsyspac.htm#REPMA013"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> for information about the <code>DBMS_DEFER_SYS</code> package</p>
</li>
<li>
<p>The Advanced Replication interface online Help for information about using this interface in Enterprise Manager</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="i15660"></a>
<div id="REPLN102" class="sect1">
<h2 class="sect1">Deployment Templates<a id="sthref1059"></a><a id="sthref1060"></a></h2>
<p>If you plan to include materialized view sites in your replication environment, then consider using deployment templates to create the replicated objects at the materialized view sites.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="repdt.htm#g49875">Chapter 4, "Deployment&nbsp;Templates Concepts and Architecture"</a> for information about deployment templates</div>
<a id="i15472"></a>
<div id="REPLN530" class="sect2">
<h3 class="sect2">Preparing Materialized View Sites for Instantiation of Deployment Templates</h3>
<p>If you decide to use deployment templates, then you must prepare your materialized view sites for instantiation. If a deployment template has been designed well, then little preparation is necessary at the remote materialized view site. This section describes the most common preparations that must be performed at the remote materialized view site. After any required preparations have been completed, you are ready to perform either an online or offline instantiation.</p>
<p>Use the following questions to assess which actions are necessary to prepare the remote materialized view site for instantiation:</p>
<ul>
<li>
<p>Does the remote materialized view site have network connectivity to the target master site?</p>
</li>
<li>
<p>Does the materialized view site have an Oracle9<span class="italic">i</span> Release 2 (9.2) or later database?</p>
</li>
<li>
<p>Has the remote materialized view site been set up to support materialized view replication?</p>
</li>
<li>
<p>Do the schemas required by the deployment template exist at the materialized view site?</p>
</li>
<li>
<p>If required database links are not part of the deployment template, then do the required database links from the materialized view site to the master site exist?</p>
</li>
<li>
<p>Will you use online instantiation or offline instantiation to instantiate the deployment template at the materialized view sites?</p>
</li>
<li>
<p>Do the rollback segments that might be required by the deployment template exist at the materialized view site and are they online?</p>
</li>
</ul>
<p>The following sections provide guidance for the issues raised by each of these questions.</p>
<div id="REPLN531" class="sect3"><a id="sthref1061"></a>
<h4 class="sect3">Network Connectivity<a id="sthref1062"></a></h4>
<p>As with all replication environments, network connectivity is a key component in Advanced Replication. Verify that the remote materialized view site has a proper Oracle Net connection to the target master site.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink NETAG" href="../../network.112/e41945/toc.htm"><span class="italic">Oracle Database Net Services Administrator's Guide</span></a> for information about setting up an Oracle network connection</div>
</div>
<!-- class="sect3" -->
<div id="REPLN532" class="sect3"><a id="sthref1063"></a>
<h4 class="sect3">Database Version<a id="sthref1064"></a></h4>
<p>The materialized view site must have an Oracle9<span class="italic">i</span> Release 2 (9.2) or later database to work with Oracle Database 11<span class="italic">g</span>. If your materialized view site does not meet the database version requirements, then you must upgrade your database at the materialized view site before instantiating a deployment template.</p>
</div>
<!-- class="sect3" -->
<div id="REPLN533" class="sect3"><a id="sthref1065"></a>
<h4 class="sect3">Materialized View Site Setup<a id="sthref1066"></a></h4>
<p>Each materialized view site needs several users that have special privileges to support a materialized view site. In addition to having the administrative privileges, these users also participate in the propagation and refreshing of data.</p>
<p>Materialized view site setup also includes scheduling several automated jobs to handle the automatic refreshing of the materialized view (optional) and the purging of the deferred transaction queue.</p>
<p>You can set up your materialized view site with:</p>
<ul>
<li>
<p><span class="bold">Advanced Replication Interface:</span> You can connect to the remote materialized view site with the Advanced Replication interface and use the Configure Master and Materialized View Sites for Replication Wizard.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
The Advanced Replication interface's online Help for instructions on setting up your materialized view site with the Advanced Replication interface in Oracle Enterprise Manager</div>
</li>
<li>
<p><span class="bold">Replication Management API:</span> Using the replication management API to setup your materialized view site is an ideal solution when you are not able to connect to the remote materialized view site with the Advanced Replication interface in Enterprise Manager. When you build a SQL script containing the API calls to setup your materialized view site, you can also add the DDL and API calls to complete the remaining preparation (such as creating any necessary schemas, database links, and rollback segments, as described in the following three sections). The script that you create should be distributed with the offline instantiation file and executed before the offline instantiation file.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REPMA119" href="../../server.112/e10707/rarrepsite.htm#REPMA119"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> for instructions on setting up your materialized view site with the replication management API</div>
</li>
</ul>
</div>
<!-- class="sect3" -->
<div id="REPLN534" class="sect3"><a id="sthref1067"></a>
<h4 class="sect3">Create Necessary Schemas<a id="sthref1068"></a></h4>
<p>If the deployment template that you are instantiating creates objects in multiple schemas, then ensure that all of the necessary schemas have been created. Additionally, the user instantiating the deployment template must have the appropriate <code>CREATE</code> privileges on that schema. For example, if the deployment template will create a procedure in schema <code>oe</code> and the user <code>hr</code> is instantiating the template, then <code>hr</code> must have the <code>CREATE</code> <code>ANY</code> <code>PROCEDURE</code> privilege on schema <code>oe</code>.</p>
</div>
<!-- class="sect3" -->
<div id="REPLN535" class="sect3"><a id="sthref1069"></a>
<h4 class="sect3">Create Database Links<a id="sthref1070"></a><a id="sthref1071"></a></h4>
<p>While it is advantageous to include the DDL to create all necessary database links for a remote materialized view site in the deployment template, it is not required. If the database link DDL is not in the deployment template, then manually create the database links to the target master site before instantiating the deployment template. The database links are required to populate the materialized views during an online instantiation and are required for the proper maintenance of the materialized view environment.</p>
</div>
<!-- class="sect3" -->
<div id="REPLN536" class="sect3"><a id="sthref1072"></a>
<h4 class="sect3">Online or Offline Instantiation</h4>
<p>You have the option of performing online or offline instantiation of deployment templates at materialized view sites. With online instantiation, the data in your materialized views is pulled from the master site during instantiation. With offline instantiation, the data in your materialized views is packaged in the template itself and is applied locally when you instantiate the template. In general, if your materialized views will contain a large amount of data, then offline instantiation is preferred to minimize utilization of your network resources.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="repdt.htm#i27111">"Deployment Template Packaging and Instantiation"</a> for more information about online and offline instantiation</div>
</div>
<!-- class="sect3" -->
<div id="REPLN537" class="sect3"><a id="sthref1073"></a>
<h4 class="sect3">Create Necessary Rollback Segment<a id="sthref1074"></a><a id="sthref1075"></a>s</h4>
<p>If the deployment template that you are instantiating will use specific rollback segments that do not currently exist at the remote materialized view site, then create the necessary rollback segments. To see if your template objects use the default rollback segment or a specific rollback segment, query the <code>DBA_REPCAT_TEMPLATE_OBJECTS</code> data dictionary view.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REPMA024" href="../../server.112/e10707/rarrcatviews.htm#REPMA024"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> for information about data dictionary views related to replication</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i15473"></a>
<div id="REPLN538" class="sect1">
<h2 class="sect1">Conflict Resolution</h2>
<p>Asynchronous multimaster and updatable materialized view replication environments must address the possibility of replication conflicts that can occur when, for example, two transactions originating from different sites update the same row at nearly the same time. If possible, plan your replication environment to avoid the possibility of conflicts. If data conflicts can occur in your replication environment, then you need a mechanism to ensure that the conflict is resolved in accordance with your business rules and to ensure that the data converges correctly at all sites.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="repconflicts.htm#i26513">Chapter 5, "Conflict Resolution Concepts and Architecture"</a>, for more information about avoiding conflicts and for information about the conflict resolution methods available to you if conflicts can occur</div>
</div>
<!-- class="sect1" -->
<a id="i15775"></a>
<div id="REPLN539" class="sect1">
<h2 class="sect1">Security and Replication</h2>
<p>Security might be a concern in both multimaster and materialized view replication environments. You should plan your security strategy before you configure your replication environment.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REPMA028" href="../../server.112/e10707/rarsec.htm#REPMA028"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a> for information about security options in a replication environment</div>
</div>
<!-- class="sect1" -->
<a id="i16790"></a>
<div id="REPLN540" class="sect1">
<h2 class="sect1">Designing for Survivability<a id="sthref1076"></a><a id="sthref1077"></a><a id="sthref1078"></a></h2>
<p>Survivability is the capability to continue running applications despite system or site failures. Survivability enables you to run applications on a fail over system, accessing the same, or very nearly the same, data as these systems accessed on the primary system when it failed. As shown in <a href="#i16797">Figure 6-3</a>, the Oracle server provides two different technologies for accomplishing survivability: multimaster replication and Oracle Real Application Clusters (Oracle RAC).</p>
<div id="REPLN541" class="figure">
<p class="titleinfigure"><a id="i16797"></a>Figure 6-3 Survivability Methods: Replication Or Oracle Real Application Clusters</p>
<img width="600" height="448" src="img/repln019.gif" alt="Description of Figure 6-3 follows" /><br />
<a id="sthref1079" href="img_text/repln019.htm">Description of "Figure 6-3 Survivability Methods: Replication Or Oracle Real Application Clusters"</a><br />
<br /></div>
<!-- class="figure" -->
<div id="REPLN542" class="sect2"><a id="sthref1080"></a>
<h3 class="sect2">Oracle Real Application Clusters versus Replication<span class="bold"><a id="sthref1081"></a><a id="sthref1082"></a><a id="sthref1083"></a></span></h3>
<p>Oracle Real Application Clusters (Oracle RAC) supports fail over to surviving systems when a system supporting an instance of the Oracle server fails. Oracle RAC requires a cluster or massively parallel hardware platform, and thus is applicable for protection against processor system failures in the local environment where the cluster or massively parallel system is running.</p>
<p>In these environments, Oracle RAC is a good solution for survivability &mdash; supporting high transaction volumes with no lost transactions or data inconsistencies in the event of an instance failure. If an instance fails in an Oracle RAC environment, then a surviving instance automatically recovers any incomplete transactions. Applications running on the failed system can execute on the fail over system, accessing all data in the database.</p>
<p>Oracle RAC does not, however, provide survivability for site failures (such as power outages, flood, fire, or sabotage) that render an entire site, and thus the entire cluster or massively parallel system, inoperable. To provide survivability for site failures, you can use the multimaster replication to maintain a replica of a database at a geographically remote location. In addition, you can use multimaster replication to replicate data between sites running different operating systems or different releases of Oracle or both.</p>
<p>Should the local system fail, the application can continue to execute at the remote site. Using multimaster replication, some administrative procedures might be necessary to recover transactions at the failed site and to prevent data inconsistencies when restarting the failed site.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also configure standby database to protect an Oracle database from site failures.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink RACAD" href="../../rac.112/e41960/toc.htm"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a></p>
</li>
<li>
<p><a class="olink SBYDB" href="../e41134/toc.htm"><span class="variable">Oracle Data Guard Concepts and Administration</span></a> for more information about standby database</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CHDBJFAE"></a>
<div id="REPLN543" class="sect2">
<h3 class="sect2">Designing a Replication Environment for Survivability<a id="sthref1084"></a></h3>
<p>If you choose to use the replication facility for survivability, then consider the following issues:</p>
<ul>
<li>
<p>The replication facility must be able to keep up with the transaction volume of the primary system.</p>
</li>
<li>
<p>If a failure occurs at the primary site, then recently committed transactions at the primary site might not have been asynchronously propagated to the failover site yet. These transactions appear to be lost.</p>
<p>These "lost" transactions must be dealt with when the primary site is recovered.</p>
<p>Suppose, for example, you are running an order-entry system that uses replication to maintain a remote fail over order-entry system, and the primary system fails.</p>
<p>At the time of the failure, there were two transactions recently executed at the primary site that did not have their changes propagated and applied at the failover site. The first of these was a transaction that entered a new order, and the second was a transaction that canceled an existing order.</p>
<p>In the first case, someone might notice the absence of the new order when processing continues on the fail over system, and reenter it. In the second case, the cancellation of the order might not be noticed, and processing of the order might proceed; that is, the canceled item might be shipped and the customer billed.</p>
<p>What happens when you restore the primary site? If you simply push all of the changes executed on the failover system back to the primary system, then you will encounter conflicts.</p>
<p>Specifically, duplicate orders exist for the item originally ordered at the primary system just before it failed. Additionally, data changes result from the transactions to ship and bill the order that was originally canceled on the primary system.</p>
</li>
</ul>
<p>You must carefully design your system to deal with these situations. The next section explains this process.</p>
</div>
<!-- class="sect2" -->
<div id="REPLN544" class="sect2"><a id="sthref1085"></a>
<h3 class="sect2">Implementing a Survivable System<a id="sthref1086"></a><a id="sthref1087"></a></h3>
<p>Advanced Replication provides survivability against site failures by using multiple replicated master sites. You must configure your system using one of the following methods, which are listed in order of increasing implementation difficulty:</p>
<ul>
<li>
<p>The failover site is used for read access only. That is, no updates are allowed at the failover site, even when the primary site fails.</p>
</li>
<li>
<p>After a failure, the primary site is restored from the fail over site using export/import, or through full backup.</p>
</li>
<li>
<p>Full conflict resolution is employed for all data/transactions. This requires careful design and implementation. You must ensure proper resolution of conflicts that can occur when the primary site is restored, such as duplicate transactions.</p>
</li>
<li>
<p>Provide your own special applications-level routines and procedures to deal with the inconsistencies that occur when the primary site is restored, and the queued transactions from the active fail over system are propagated and applied to the primary site.</p>
</li>
</ul>
<p><a id="sthref1088"></a><a id="sthref1089"></a>You can use Oracle Net to configure automatic connect-time failover, which enables Oracle Net to fail over to a different master site if the first master site fails. You configure automatic connect-time failover in your <code>tnsnames.ora</code> file by setting the <code>FAILOVER</code> option to <code>on</code> and specifying multiple connect descriptors.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink NETAG013" href="../../network.112/e41945/advcfg.htm#NETAG013"><span class="italic">Oracle Database Net Services Administrator's Guide</span></a> for more information about configuring connect-time failover</div>
<div id="REPLN545" class="sect3"><a id="sthref1090"></a>
<h4 class="sect3">Database Recovery in Replication Environments<a id="sthref1091"></a></h4>
<p>If you recover a database that is a master site in a replication environment, then the replicated data might not be consistent, and you might encounter replication errors. For example, a restored master site might have propagated different transactions to different masters. You might need to perform extra steps to correct for an incorrect recovery operation. One such method is to drop and re-create all replicated objects in the recovered database.</p>
<p>Before dropping and re-creating replicated objects, remove pending deferred transactions and deferred error records from the restored database, and resolve any outstanding distributed transactions. If the restored database was a master definition site for some replication environments, then you should designate a new master definition site before dropping and creating objects. Any materialized views that are mastered at the restored database should be fully refreshed, as well as any materialized views in the restored database.</p>
<p>To provide continued access to your data, you might need to change master definition sites (assuming the database being recovered was the master definition site), or change the master site of materialized view sites (assuming their master site is being recovered).</p>
<div id="REPLN546" class="sect4"><a id="sthref1092"></a>
<h5 class="sect4">Performing Checks on Imported Data<a id="sthref1093"></a><a id="sthref1094"></a><a id="sthref1095"></a><a id="sthref1096"></a><a id="sthref1097"></a></h5>
<p>After performing an export/import of a replicated object or an object used by Advanced Replication, such as the <code>DBA_REPSITES</code> data dictionary view, you should run the <code>REPCAT_IMPORT_CHECK</code> procedure in the <code>DBMS_REPCAT</code> package.</p>
<p>In the following example, the procedure checks the objects in the <code>hr_repg</code> replication group at a materialized view site to ensure that they have the appropriate object identifiers and status values:</p>
<pre>
BEGIN
DBMS_REPCAT.REPCAT_IMPORT_CHECK( gname     =&gt;   'hr_repg',
                                 master    =&gt;   FALSE);
END;
/
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
The <code>REPCAT_IMPORT_CHECK</code> procedure in <a class="olink REPMA122" href="../../server.112/e10707/rarrcatpac.htm#REPMA122"><span class="variable">Oracle Database Advanced Replication Management API Reference</span></a></div>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1694">
<tr>
<td class="cellalignment1703">
<table class="cellalignment1699">
<tr>
<td class="cellalignment1698"><a href="repconflicts.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1698"><a href="reptrouble.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1705">
<table class="cellalignment1697">
<tr>
<td class="cellalignment1698"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1698"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1698"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1698"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1698"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1698"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
