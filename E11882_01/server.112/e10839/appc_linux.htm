<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Administering Oracle Database on Linux</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1093" />
<meta name="dcterms.created" content="2017-09-07T5:10:53Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Administrator's Reference" />
<meta name="dcterms.identifier" content="E10839-25" />
<meta name="dcterms.isVersionOf" content="UNXAR" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2006, 2017,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="appa_aix.htm" title="Previous" type="text/html" />
<link rel="Next" href="appb_hpux.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e10839.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">14/20</span> <!-- End Header -->
<div id="UNXAR011" class="appendix"><a id="BEJJBAGF"></a>
<h1 class="appendix"><span class="secnum">B</span> Administering Oracle Database on Linux</h1>
<p>This appendix contains information about administering Oracle Database on Linux.</p>
<p>It contains the following topics:</p>
<ul>
<li>
<p><a href="#CHDFFCJB">Extended Buffer Cache Support</a></p>
</li>
<li>
<p><a href="#CIHIGAEC">Using HugePages on Linux</a></p>
</li>
<li>
<p><a href="#BABIIHEJ">Asynchronous Input-Output Support</a></p>
</li>
<li>
<p><a href="#CEGBHEAF">Simultaneous Multithreading</a></p>
</li>
<li>
<p><a href="#CHDFHJHA">Allocating Shared Resources</a></p>
</li>
<li>
<p><a href="#BABJGEFC">Database Migration from 32-Bit Linux to 64-Bit Linux</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Starting with Oracle Database 11<span class="italic">g</span> release 2 (11.2), Linux x86-64 media does not contain Linux x86 binaries. You must use Linux x86 media to install 32-bit Oracle home.</div>
<a id="CHDFFCJB"></a>
<div id="UNXAR321" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">B.1</span> Extended Buffer Cache Support<a id="sthref516"></a></h2>
<div class="infobox-note">
<p class="notep1">Note:</p>
This section applies to Linux x86 only.</div>
<p>Oracle Database can allocate and use more than 4 GB of memory for the database buffer cache. This section describes the limitations and requirements of the extended buffer cache feature on Linux x86 systems.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="appi_vlm.htm#CACEGHIB">Very Large Memory on Linux x86</a> for more information.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink CNCPT" href="../e40540/toc.htm"><span class="italic">Oracle Database Concepts</span></a> for more information about the extended buffer cache feature.</div>
<p class="subhead2"><a id="UNXAR322"></a>In-Memory File System<a id="sthref517"></a></p>
<p>To use the extended buffer cache feature, create an in-memory file system on the <code dir="ltr">/dev/shm</code> mount point equal in size or larger than the amount of memory that you intend to use for the database buffer cache. For example, to create an 8 GB file system on the <code dir="ltr">/dev/shm</code> mount point:</p>
<ol>
<li>
<p>Run the following command as the <code dir="ltr">root</code> user:</p>
<pre dir="ltr">
# mount -t tmpfs shmfs -o size=8g /dev/shm
</pre></li>
<li>
<p>To ensure that the in-memory file system is mounted when the system restarts, add an entry in the <code dir="ltr">/etc/fstab</code> file similar to the following:</p>
<pre dir="ltr">
shmfs /dev/shm tmpfs size=8g 0 0
</pre></li>
</ol>
<p>When Oracle Database starts with the extended buffer cache feature enabled, it creates a file in the <code dir="ltr">/dev/shm</code> directory that corresponds to the Oracle buffer cache.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If an in-memory file system is mounted on the <code dir="ltr">/dev/shm</code> mount point, then ensure that its size equals or is larger than the amount of memory that is used for the database buffer cache.</div>
<p class="subhead2"><a id="UNXAR323"></a>USE_INDIRECT_DATA_BUFFERS<a id="sthref518"></a><a id="sthref519"></a> Initialization Parameter</p>
<p>To enable the extended buffer cache feature, set the <code dir="ltr">USE_INDIRECT_DATA_BUFFERS</code> initialization parameter to TRUE in the parameter file. This enables Oracle Database to specify a larger buffer cache.</p>
<p class="subhead2"><a id="UNXAR324"></a>Dynamic Cache Parameters<a id="sthref520"></a><a id="sthref521"></a></p>
<p>If the extended cache feature is enabled, then you must use the <code dir="ltr">DB_BLOCK_BUFFERS</code> parameter to specify the database cache size.</p>
<p>Do not use the following dynamic cache parameters while the extended buffer cache feature is enabled:</p>
<ul>
<li>
<p><code dir="ltr">DB_CACHE_SIZE</code></p>
</li>
<li>
<p><code dir="ltr">DB_2K_CACHE_SIZE</code></p>
</li>
<li>
<p><code dir="ltr">DB_4K_CACHE_SIZE</code></p>
</li>
<li>
<p><code dir="ltr">DB_8K_CACHE_SIZE</code></p>
</li>
<li>
<p><code dir="ltr">DB_16K_CACHE_SIZE</code></p>
</li>
</ul>
<p class="subhead2"><a id="UNXAR325"></a>Limitations<a id="sthref522"></a></p>
<p>The following limitations apply to the extended buffer cache feature:</p>
<ul>
<li>
<p>You cannot create or use tablespaces with nondefault block sizes. You can create tablespaces using only the block size specified by the <code dir="ltr">DB_BLOCK_SIZE</code> parameter.</p>
</li>
<li>
<p>You cannot change the size of the buffer cache while the instance is running.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF" href="../e41084/toc.htm"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information about the default block size used by the <code dir="ltr">CREATE TABLESPACE</code> command.</div>
<div class="infobox-note">
<p class="notep1">Note:</p>
The default VLM window size is 512 MB. This memory size is allocated to the address space of the process. To increase or decrease this value, set the <code dir="ltr">VLM_WINDOW_SIZE</code> environment variable to the new size in bytes. For example, to set the <code dir="ltr">VLM_WINDOW_SIZE</code> to 256 MB, run the following command:
<pre dir="ltr">
$ export VLM_WINDOW_SIZE=268435456
</pre>
<p>The value that you specify for the <code dir="ltr">VLM_WINDOW_SIZE</code> environment variable must be a multiple of 64 KB.</p>
</div>
</div>
<!-- class="sect1" -->
<a id="CIHIGAEC"></a>
<div id="UNXAR327" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">B.2</span> Using HugePages on Linux<a id="sthref523"></a></h2>
<p>To enable Oracle Database to use large pages (sometimes called HugePages) on Linux, set the value of the <code dir="ltr">vm.nr_hugepages</code> kernel parameter to specify the number of large pages that you want to reserve. You must specify a enough large pages to hold the entire SGA for the database instance. To determine the required parameter value, divide the SGA size for the instance by the size of a large page, then round up the result to the nearest integer.</p>
<p>To determine the default large page size, run the following command:</p>
<pre dir="ltr">
# grep Hugepagesize /proc/meminfo
</pre>
<p>For example, if <code dir="ltr">/proc/meminfo</code> lists the large page size as 2 MB, and the total SGA size for the instance is 1.6 GB, then set the value for the <code dir="ltr">vm.nr_hugepages</code> kernel parameter to 820 (1.6 GB / 2 MB = 819.2).</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="appi_vlm.htm#CACDCGAH">Overview of HugePages</a> for more information on tuning SGA with hugepages, configuring hugepages, and hugepages configuration restrictions.</div>
</div>
<!-- class="sect1" -->
<a id="BABIIHEJ"></a>
<div id="UNXAR328" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">B.3</span> Asynchronous Input-Output Support<a id="sthref524"></a></h2>
<p>Oracle Database supports kernel asynchronous Input-Output. Asynchronous Input-Output is enabled by default on raw volumes. Automatic Storage Management uses asynchronous Input-Output by default.</p>
<p>By default, the <code dir="ltr">DISK_ASYNCH_IO</code> initialization parameter in the parameter file is set to TRUE. To enable asynchronous Input-Output on file system files:</p>
<ol>
<li>
<p>Ensure that all Oracle Database files are located on file systems that support asynchronous Input-Output.</p>
</li>
<li>
<p>Set the <code dir="ltr">FILESYSTEMIO_OPTIONS</code> initialization parameter in the parameter file to <code dir="ltr">ASYNCH</code> or <code dir="ltr">SETALL</code>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If the file system files are managed through ODM library interface or dNFS, asynchronous Input-Output is enabled by default. There is no need to set <code dir="ltr">FILESYSTEMIO_OPTIONS</code> to enable asynchronous Input-Output in these environments.</div>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="BEJGEAGE"></a>
<div id="UNXAR330" class="sect1">
<h2 class="sect1"><span class="secnum">B.4</span> Direct Input-Output Support<a id="sthref525"></a></h2>
<p>Direct Input-Output support is available and supported on Linux.</p>
<p>To enable direct Input-Output support:</p>
<ul>
<li>
<p>Set the <code dir="ltr">FILESYSTEMIO_OPTIONS</code> initialization parameter to <code dir="ltr">DIRECTIO</code>.</p>
</li>
<li>
<p>Set the <code dir="ltr">FILESYSTEMIO_OPTIONS</code> initialization parameter in the parameter file to <code dir="ltr">SETALL</code>, which will enable both asynchronous Input-Output and direct Input-Output.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="CEGBHEAF"></a>
<div id="UNXAR333" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">B.5</span> Simultaneous Multithreading</h2>
<p>If Simultaneous Multithreading is enabled, then the <code dir="ltr">v$osstat</code> view reports two additional rows corresponding to the online logical (<code dir="ltr">NUM_LCPUS</code>) and virtual CPUs (<code dir="ltr">NUM_VCPUS</code>).</p>
</div>
<!-- class="sect1" -->
<a id="CHDFHJHA"></a>
<div id="UNXAR334" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">B.6</span> Allocating Shared Resources</h2>
<p>To use the <code dir="ltr">MEMORY_TARGET</code> or <code dir="ltr">MEMORY_MAX_TARGET</code> feature, the following kernel parameters must be modified.</p>
<ul>
<li>
<p><code dir="ltr">/dev/shm</code> mount point should be equal in size or larger than the value of <code dir="ltr">SGA_MAX_SIZE</code>, if set, or should be set to be at least <code dir="ltr">MEMORY_TARGET</code> or <code dir="ltr">MEMORY_MAX_TARGET</code>, whichever is larger. For example, with <code dir="ltr">MEMORY_MAX_TARGET=4GB</code> only set, to create a 4GB system on the <code dir="ltr">/dev/shm</code> mount point:</p>
<ul>
<li>
<p>Run the following command as the <code dir="ltr">root</code> user:</p>
<pre dir="ltr">
# mount -t tmpfs shmfs -o size=4g /dev/shm
</pre></li>
<li>
<p>Ensure that the in-memory file system is mounted when the system restarts, add an entry in the <code dir="ltr">/etc/fstab</code> file similar to the following:</p>
<pre dir="ltr">
  tmpfs /dev/shm tmpfs size=4g 0
</pre></li>
</ul>
</li>
<li>
<p>The number of file descriptors for each Oracle instance are increased by 512*<code dir="ltr">PROCESSES</code>. Therefore, the maximum number of file descriptors should be at least this value, plus some more for the operating system requirements. For example, if the <code dir="ltr">cat /proc/sys/fs/file-max</code> command returns 32768 and <code dir="ltr">PROCESSES</code> are 100, you can set it to 6815744 or higher as <code dir="ltr">root</code>, to have 51200 available for Oracle. Use one of the following options to set the value for the <code dir="ltr">file-max</code> descriptor.</p>
<ul>
<li>
<p>Run the following command:</p>
<pre dir="ltr">
echo 6815744 &gt; /proc/sys/fs/file-max
</pre>
<p>OR</p>
</li>
<li>
<p>Modify the following entry in the <code dir="ltr">/etc/sysctl.conf</code> file and restart the system as <code dir="ltr">root</code>.</p>
<pre dir="ltr">
fs.file-max = 6815744
</pre></li>
</ul>
</li>
<li>
<p>Per-process number of file descriptors must be at least 512. For example, as <code dir="ltr">root</code> run the following command.</p>
<ul>
<li>
<p>On bash and sh:</p>
<pre dir="ltr">
# ulimit -n
</pre></li>
<li>
<p>On csh:</p>
<pre dir="ltr">
# limit descriptors
</pre></li>
</ul>
<p>If the preceding command returns 200, then run the following command to set the value for the per processor file descriptors limit, for example to 1000:</p>
<ul>
<li>
<p>On bash and sh:</p>
<pre dir="ltr">
# sudo sh
# ulimit -n 1000
</pre></li>
<li>
<p>On csh:</p>
<pre dir="ltr">
# sudo sh
# limit descriptors 1000
</pre></li>
</ul>
</li>
<li>
<p><code dir="ltr">MEMORY_TARGET</code> and <code dir="ltr">MEMORY_MAX_TARGET</code> cannot be used when <code dir="ltr">LOCK_SGA</code> is enabled. <code dir="ltr">MEMORY_TARGE</code><code dir="ltr">T</code> and <code dir="ltr">MEMORY_MAX_TARGET</code> also cannot be used with huge pages on Linux.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="BABJGEFC"></a>
<div id="UNXAR335" class="sect1">
<h2 class="sect1"><span class="secnum">B.7</span> Database Migration from 32-Bit Linux to 64-Bit Linux</h2>
<p>To migrate an Oracle Database 11<span class="italic">g</span> Release 2 (11.2) for 32-bit Linux to an Oracle Database 11<span class="italic">g</span> Release 2 (11.2) for 64-bit Linux, you must perform the following steps:</p>
<ul>
<li>
<p><a href="#BABECIGA">Online Backup of Database With RMAN</a></p>
</li>
<li>
<p><a href="#BABBHFDB">Migrating 32-Bit Linux Database to 64-Bit Linux Database</a></p>
</li>
<li>
<p><a href="#CHDFBEIC">Migrating Data To and From ASM</a></p>
</li>
</ul>
<a id="BABECIGA"></a>
<div id="UNXAR336" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">B.7.1</span> Online Backup of Database With RMAN</h3>
<p>Online backup enables to take a backup of the database without having to shutdown the database. To achieve this, perform the following steps:</p>
<ol>
<li>
<p>Connect to the database instance as <code dir="ltr">SYSDBA</code>:</p>
<pre dir="ltr">
SQL&gt; CONNECT / AS SYSDBA;
</pre></li>
<li>
<p>Run the following commands to ensure that the database is in <code dir="ltr">ARCHIVELOG</code> mode:</p>
<pre dir="ltr">
SQL&gt; SHUTDOWN IMMEDIATE
Database closed
Database dismounted
Oracle instance shutdown

SQL&gt; STARTUP MOUNT
Oracle instance started

Total System Global Area  272629760 bytes
Fixed Size                   788472 bytes
Variable Size             103806984 bytes
Database Buffers          167772160 bytes
Redo Buffers                 262144 bytes
Database mounted

SQL&gt;ALTER DATABASE ARCHIVELOG;
Database altered

SQL&gt; ALTER DATABASE OPEN;
Database altered
</pre></li>
<li>
<p>Run the following command to start RMAN, which is located under <code dir="ltr">$ORACLE_HOME/bin</code> directory:</p>
<pre dir="ltr">
RMAN&gt;connect target
</pre></li>
<li>
<p>To backup the 32-bit database and all the archived redo log files, run the following command:</p>
<pre dir="ltr">
RMAN&gt;backup database plus archivelog delete input;
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
Archive redo logs are very important to recover the database. Oracle recommends that you back them up along with your database. You can backup the archive redo logs from time to time by issuing the following command:
<pre dir="ltr">
RMAN&gt;backup archivelog all delete input;
</pre></div>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABBHFDB"></a>
<div id="UNXAR337" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">B.7.2</span> Migrating 32-Bit Linux Database to 64-Bit Linux Database</h3>
<p>This section covers the following topics:</p>
<ul>
<li>
<p><a href="#BABEBAEE">Migrating 32-Bit Database to 64-Bit Database With the Same Directory Structure for Data Files</a></p>
</li>
<li>
<p><a href="#BABEDFCJ">Migrating 32-Bit Database to 64-Bit Database With Different Directory Structure for Data Files</a></p>
</li>
</ul>
<a id="BABEBAEE"></a>
<div id="UNXAR338" class="sect3">
<h4 class="sect3"><span class="secnum">B.7.2.1</span> Migrating 32-Bit Database to 64-Bit Database With the Same Directory Structure for Data Files</h4>
<p>If the control file, data file, redo log files have the same structure on the target computer as in the source computer, then perform the following steps:</p>
<ol>
<li>
<p>Perform an online backup of the database before starting the migration process. Refer to <a href="#BABECIGA">Online Backup of Database With RMAN</a> for more information.</p>
</li>
<li>
<p>Install Oracle Database 11<span class="italic">g</span> Release 2 (11.2) for 64-bit Linux in a new Oracle Database home. It is recommended that you use the same version of Oracle Database home as on the 32-bit computer.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink LADBI" href="../../install.112/e47689/toc.htm"><span class="italic">Oracle Database Installation Guide for Linux</span></a></div>
</li>
<li>
<p>Copy <code dir="ltr">init.ora</code>, data files, control file, and the redo log files from the 32-bit Linux computer to the corresponding locations on the 64-bit Linux computer.</p>
</li>
<li>
<p>Edit <code dir="ltr">init.ora</code> file to include the following changes:</p>
<ul>
<li>
<p>Update the memory requirements included in the file.</p>
</li>
<li>
<p>Edit the control file location if necessary.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Oracle recommends that you double the values of shared pool, java pool, <code dir="ltr">sga_target</code> and large pool listed in the <code dir="ltr">init.ora</code> file.</div>
</li>
<li>
<p>Connect to the database instance as <code dir="ltr">SYSDBA</code>:</p>
<pre dir="ltr">
SQL&gt; CONNECT / AS SYSDBA;
</pre></li>
<li>
<p>Set the system to spool results to a log file for later verification of success. For example:</p>
<pre dir="ltr">
SQL&gt; SPOOL /tmp/utlirp.log
</pre></li>
<li>
<p>Start the 64-bit Oracle Database as follows:</p>
<pre dir="ltr">
SQL&gt; STARTUP UPGRADE pfile=init.ora;
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
<a class="olink UPGRD12354" href="../../server.112/e23633/intro.htm#UPGRD12354"><span class="italic">Oracle Database Upgrade Guide</span></a> for more information on changing from 32-bit to 64-bit</div>
</li>
<li>
<p>Run the following command on the 64-bit Oracle Database, to invalidate all the PL/SQL modules:</p>
<pre dir="ltr">
SQL&gt; @$ORACLE_HOME/rdbms/admin/utlirp.sql 
</pre></li>
<li>
<p>Shut down the 64-bit Oracle Database:</p>
<pre dir="ltr">
SQL&gt;shutdown immediate; 
</pre></li>
<li>
<p>Start the 64-bit Oracle Database:</p>
<pre dir="ltr">
SQL&gt; STARTUP pfile=init.ora;
</pre></li>
<li>
<p>If the JServer JAVA Virtual Machine component is installed, perform the following steps after connecting as <code dir="ltr">SYS</code>:</p>
<pre dir="ltr">
begin
  update obj$ set status=5 where obj#=(select obj# from obj$,javasnm$
    where owner#=0 and type#=29 and short(+)=name and
    nvl(longdbcs,name)='oracle/aurora/rdbms/Compiler');
  commit;
  declare
    cursor C1 is select
       'DROP JAVA DATA "' || u.name || '"."' || o.name || '"'
       from obj$ o,user$ u where o.type#=56 and u.user#=o.owner#;

    ddl_statement varchar2(200);
    iterations number;
    previous_iterations number;
    loop_count number;
    my_err     number;
  begin
    previous_iterations := 10000000;
    loop
      -- To make sure we eventually stop, pick a max number of iterations
      select count(*) into iterations from obj$ where type#=56;
      exit when iterations=0 or iterations &gt;= previous_iterations;
      previous_iterations := iterations;
      loop_count := 0;
      open C1;
     loop
       begin
         fetch C1 into ddl_statement;
         exit when C1%NOTFOUND or loop_count &gt; iterations;
      exception when others then
         my_err := sqlcode;
         if my_err = -1555 then -- snapshot too old, re-execute fetch query
           exit;
         else
           raise;
        end if;
      end;
      initjvmaux.exec(ddl_statement);
      loop_count := loop_count + 1;
     end loop;
     close C1;
    end loop;
  end;
  commit;
  initjvmaux.drp('delete from java$policy$shared$table');
  update obj$ set status=1 where obj#=(select obj# from obj$,javasnm$ 
    where owner#=0 and type#=29 and short(+)=name and
    nvl(longdbcs,name)='oracle/aurora/rdbms/Compiler');
  commit;
end;
/
create or replace java system;
/
</pre></li>
<li>
<p>Revalidate all the existing PL/SQL modules in the format required by the 64-bit Oracle Database:</p>
<pre dir="ltr">
SQL&gt;$ORACLE_HOME/rdbms/admin/utlrp.sql;
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="BABEDFCJ"></a>
<div id="UNXAR339" class="sect3">
<h4 class="sect3"><span class="secnum">B.7.2.2</span> Migrating 32-Bit Database to 64-Bit Database With Different Directory Structure for Data Files</h4>
<p>If the control file, data file, redo log files have different structure on the target computer as compared to the source computer, then perform the following steps:</p>
<ol>
<li>
<p>Perform an online backup of the database before starting the migration process. Refer to <a href="#BABECIGA">Online Backup of Database With RMAN</a> for more information.</p>
</li>
<li>
<p>Install Oracle Database 11<span class="italic">g</span> Release 2 (11.2) for 64-bit Linux in a new Oracle Database home. It is recommended that you use the same version of Oracle Database home as on the 32-bit computer.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<span class="italic">Oracle Database Installation Guide for Linux</span></div>
</li>
<li>
<p>Edit <code dir="ltr">init.ora</code> file on the 64-bit computer to include the following changes:</p>
<ul>
<li>
<p>Update the memory requirements included in the file.</p>
</li>
<li>
<p>The <code dir="ltr">init.ora</code> file still contains the 32-bit control file path. You must manually update <code dir="ltr">control_files</code> parameter value to include the 64-bit control file location.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Oracle recommends that you double the values of shared pool, java pool, <code dir="ltr">sga_target</code> and large pool listed in the <code dir="ltr">init.ora</code> file.</div>
</li>
<li>
<p>If the 64-bit target computer contains a different structure for data files, then you must re-create the control file or mount database on 64-bit computer. Refer to <a href="#BABIGGDD">Re-aligning Data File Path and Name</a> for more information.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Oracle recommends not to use the <code dir="ltr">RESETLOGS</code> option to re-create control files.</div>
</li>
<li>
<p>Set the system to spool results to a log file for later verification of success. For example:</p>
<pre dir="ltr">
SQL&gt; SPOOL /tmp/utlirp.log
</pre></li>
<li>
<p>Run the following command on the 64-bit Oracle Database, to invalidate all the PL/SQL modules:</p>
<pre dir="ltr">
SQL&gt; @$ORACLE_HOME/rdbms/admin/utlirp.sql 
</pre></li>
<li>
<p>Turn off the spooling of script results to the log file:</p>
<pre dir="ltr">
SQL&gt; SPOOL OFF;
</pre></li>
<li>
<p>Shut down the 64-bit Oracle Database:</p>
<pre dir="ltr">
SQL&gt;shutdown immediate; 
</pre></li>
<li>
<p>Start the 64-bit Oracle Database:</p>
<pre dir="ltr">
SQL&gt; STARTUP pfile=init.ora;
</pre></li>
<li>
<p>If the JServer JAVA Virtual Machine component is installed, perform the following steps after connecting as <code dir="ltr">SYS</code>:</p>
<pre dir="ltr">
begin
  update obj$ set status=5 where obj#=(select obj# from obj$,javasnm$
    where owner#=0 and type#=29 and short(+)=name and
    nvl(longdbcs,name)='oracle/aurora/rdbms/Compiler');
  commit;
  declare
    cursor C1 is select
       'DROP JAVA DATA "' || u.name || '"."' || o.name || '"'
       from obj$ o,user$ u where o.type#=56 and u.user#=o.owner#;

    ddl_statement varchar2(200);
    iterations number;
    previous_iterations number;
    loop_count number;
    my_err     number;
  begin
    previous_iterations := 10000000;
    loop
      -- To make sure we eventually stop, pick a max number of iterations
      select count(*) into iterations from obj$ where type#=56;
      exit when iterations=0 or iterations &gt;= previous_iterations;
      previous_iterations := iterations;
      loop_count := 0;
      open C1;
     loop
       begin
         fetch C1 into ddl_statement;
         exit when C1%NOTFOUND or loop_count &gt; iterations;
      exception when others then
         my_err := sqlcode;
         if my_err = -1555 then -- snapshot too old, re-execute fetch query
           exit;
         else
           raise;
        end if;
      end;
      initjvmaux.exec(ddl_statement);
      loop_count := loop_count + 1;
     end loop;
     close C1;
    end loop;
  end;
  commit;
  initjvmaux.drp('delete from java$policy$shared$table');
  update obj$ set status=1 where obj#=(select obj# from obj$,javasnm$ 
    where owner#=0 and type#=29 and short(+)=name and
    nvl(longdbcs,name)='oracle/aurora/rdbms/Compiler');
  commit;
end;
/
create or replace java system;
/
</pre></li>
<li>
<p>Revalidate all the existing PL/SQL modules in the format required by the 64-bit Oracle Database:</p>
<pre dir="ltr">
SQL&gt;$ORACLE_HOME/rdbms/admin/utlrp.sql;
</pre></li>
</ol>
<p class="subhead2"><a id="BABIGGDD"></a><a id="UNXAR340"></a>Re-aligning Data File Path and Name</p>
<p>The following are some methods to realign the data file names and path to point to the correct location:</p>
<ul>
<li>
<p><a href="#BABGDBFJ">Re-creating Control File</a></p>
</li>
<li>
<p><a href="#BABHJEHI">Mounting Database on a 64-Bit Computer</a></p>
</li>
</ul>
<p class="subhead2"><a id="BABGDBFJ"></a><a id="UNXAR341"></a>Re-creating Control File</p>
<p>Perform the following steps to re-create the control file:</p>
<ol>
<li>
<p>Run the following command to backup the control file to trace. The trace file is located under the <code dir="ltr">diagnostic_dest</code> directory on the 32-bit Linux computer. The following command generates a trace file which contains the necessary sql to re-create the control file:</p>
<pre dir="ltr">
SQL&gt; alter database backup controlfile to trace;
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
Ensure that you open the Oracle Database in the <code dir="ltr">UPGRADE</code> mode after the control file is created.</div>
</li>
<li>
<p>Rename the trace file generated into <code dir="ltr">.sql</code> format on the 32-bit Linux computer. For example:</p>
<pre dir="ltr">
$ cp trace.ora control.sql
</pre>
<p>The contents of the control file are as follows, for example:</p>
<ul>
<li>
<p>Re-creating control files with <code dir="ltr">NORESETLOGS</code> option.</p>
<p>32-bit control file with <code dir="ltr">NORESETLOGS</code> option:</p>
<pre dir="ltr">
STARTUP NOMOUNT pfile=t_init1.ora
CREATE CONTROLFILE REUSE DATABASE "L32" NORESETLOGS  NOARCHIVELOG
    MAXLOGFILES 32
    MAXLOGMEMBERS 2
    MAXDATAFILES 32
    MAXINSTANCES 1
    MAXLOGHISTORY 454
LOGFILE
     GROUP 1 '/ade/aime_l32/oracle/dbs/t_log1.f'  SIZE 25M,
     GROUP 2 '/ade/aime_l32/oracle/dbs/t_log2.f'  SIZE 25M
DATAFILE
     '/ade/aime_l32/oracle/dbs/t_db1.f'
     '/ade/aime_l32/oracle/dbs/t_ax1.f'
     '/ade/aime_l32/oracle/dbs/t_undo1.f'
CHARACTER SET AL32UTF8;
RECOVER DATABASE;
ALTER DATABASE OPEN UPGRADE;
ALTER TABLESPACE TEMP ADD TEMPFILE '/ade/aime_l32/oracle/dbs/t_tmp1.f' SIZE 41943040  REUSE AUTOEXTEND ON NEXT 8192  MAXSIZE 32767M;
</pre>
<p>Now, let us consider the modified 64-bit control file:</p>
<pre dir="ltr">
STARTUP NOMOUNT pfile=t_init1.ora
CREATE CONTROLFILE REUSE DATABASE "L32" NORESETLOGS  NOARCHIVELOG
    MAXLOGFILES 32
    MAXLOGMEMBERS 2
    MAXDATAFILES 32
    MAXINSTANCES 1
    MAXLOGHISTORY 454
LOGFILE
     GROUP 1 '/ade/aime_l64/oracle/dbs/t_log1.f'  SIZE 25M,
     GROUP 2 '/ade/aime_l64/oracle/dbs/t_log2.f'  SIZE 25M
DATAFILE
     '/ade/aime_l64/oracle/dbs/t_db1.f'
     '/ade/aime_l64/oracle/dbs/t_ax1.f'
     '/ade/aime_l64/oracle/dbs/t_undo1.f'
CHARACTER SET AL32UTF8;
RECOVER DATABASE;
ALTER DATABASE OPEN UPGRADE;
ALTER TABLESPACE TEMP ADD TEMPFILE '/ade/aime_l64/oracle/dbs/t_tmp1.f' SIZE 41943040  REUSE AUTOEXTEND ON NEXT 8192  MAXSIZE 32767M;
</pre></li>
<li>
<p>Re-creating control files with <code dir="ltr">RESETLOGS</code> option:</p>
<p>32-bit control file with <code dir="ltr">RESETLOGS</code> option:</p>
<pre dir="ltr">
STARTUP NOMOUNT pfile=t_init1.ora
CREATE CONTROLFILE REUSE DATABASE "L32" RESETLOGS  NOARCHIVELOG
    MAXLOGFILES 32
    MAXLOGMEMBERS 2
    MAXDATAFILES 32
    MAXINSTANCES 1
    MAXLOGHISTORY 454
LOGFILE
     GROUP 1 '/ade/aime_l32/oracle/dbs/t_log1.f'  SIZE 25M,
     GROUP 2 '/ade/aime_l32/oracle/dbs/t_log2.f'  SIZE 25M
DATAFILE
     '/ade/aime_l32/oracle/dbs/t_db1.f'
     '/ade/aime_l32/oracle/dbs/t_ax1.f'
     '/ade/aime_l32/oracle/dbs/t_undo1.f'
CHARACTER SET AL32UTF8;
RECOVER DATABASE USING BACKUP CONTROLFILE;
ALTER DATABASE OPEN RESETLOGS UPGRADE;
ALTER TABLESPACE TEMP ADD TEMPFILE '/ade/aime_l32/oracle/dbs/t_tmp1.f' SIZE 41943040  REUSE AUTOEXTEND ON NEXT 8192  MAXSIZE 32767M;
</pre>
<p>Now, let us consider the modified 64-bit control file:</p>
<pre dir="ltr">
STARTUP NOMOUNT pfile=t_init1.ora
CREATE CONTROLFILE REUSE DATABASE "L32" RESETLOGS  NOARCHIVELOG
    MAXLOGFILES 32
    MAXLOGMEMBERS 2
    MAXDATAFILES 32
    MAXINSTANCES 1
    MAXLOGHISTORY 454
LOGFILE
     GROUP 1 '/ade/aime_l64/oracle/dbs/t_log1.f'  SIZE 25M,
     GROUP 2 '/ade/aime_l64/oracle/dbs/t_log2.f'  SIZE 25M
DATAFILE
     '/ade/aime_l64/oracle/dbs/t_db1.f'
     '/ade/aime_l64/oracle/dbs/t_ax1.f'
     '/ade/aime_l64/oracle/dbs/t_undo1.f'
CHARACTER SET AL32UTF8;
RECOVER DATABASE USING BACKUP CONTROLFILE;
ALTER DATABASE OPEN RESETLOGS UPGRADE;
ALTER TABLESPACE TEMP ADD TEMPFILE '/ade/aime_l64/oracle/dbs/t_tmp1.f' SIZE 41943040  REUSE AUTOEXTEND ON NEXT 8192  MAXSIZE 32767M;
</pre></li>
</ul>
</li>
<li>
<p>Based on the method employed to realign the file paths to point to the correct locations, you must copy the necessary files from the source 32-bit Linux computer to the target 64-bit Linux computer:</p>
<ul>
<li>
<p><code dir="ltr">NORESETLOGS</code> option: Copy <code dir="ltr">init.ora</code>, data files, re-created control files (<code dir="ltr"><span class="codeinlineitalic">control.sql</span></code>), and the redo log files from the 32-bit Linux computer to the corresponding locations on the 64-bit Linux computer</p>
</li>
<li>
<p><code dir="ltr">RESETLOGS</code> option: Copy <code dir="ltr">init.ora</code>, data files, and re-created control files (<code dir="ltr"><span class="codeinlineitalic">control.sql</span></code>) from the 32-bit Linux computer to the corresponding locations on the 64-bit Linux computer</p>
</li>
</ul>
</li>
<li>
<p>Connect to the database instance as <code dir="ltr">SYSDBA</code>:</p>
<pre dir="ltr">
SQL&gt; CONNECT / AS SYSDBA;
</pre></li>
<li>
<p>To change from 32-bit to 64-bit, run the following command from the Linux 64-bit Oracle Database home:</p>
<pre dir="ltr">
sql&gt;set echo on
sql&gt;@control.sql
</pre></li>
</ol>
<p class="subhead2"><a id="BABHJEHI"></a><a id="UNXAR342"></a>Mounting Database on a 64-Bit Computer</p>
<p>Perform the following steps to mount the database on a 64-bit computer:</p>
<ol>
<li>
<p>Copy <code dir="ltr">init.ora</code>, data files, control file and the redo log files from the 32-bit Linux computer to the corresponding locations on the 64-bit Linux computer</p>
</li>
<li>
<p>Connect to the database instance as <code dir="ltr">SYSDBA</code>:</p>
<pre dir="ltr">
SQL&gt; CONNECT / AS SYSDBA;
</pre></li>
<li>
<p>Start the 64-bit Oracle Database as follows:</p>
<pre dir="ltr">
SQL&gt; STARTUP mount pfile=init.ora;
</pre></li>
<li>
<p>Update all the 32-bit data file locations to include the 64-bit data file locations. For example:</p>
<pre dir="ltr">
sql&gt; alter database rename file '/ade/aime_l32/oracle/dbs/t_db1.f' to '/ade/aime_l64/oracle/dbs/t_db1.f'
sql&gt; Database altered.
</pre></li>
<li>
<p>Update all the 32-bit log file locations to include the 64-bit log file locations. For example:</p>
<pre dir="ltr">
sql&gt; alter database rename file '/ade/aime_l32/oracle/dbs/t_log.f' to '/ade/aime_l64/oracle/dbs/t_log.f'
sql&gt; Database altered.
</pre></li>
<li>
<p>To change from 32-bit to 64-bit, run the following command from the Linux 64-bit Oracle Database home:</p>
<pre dir="ltr">
sql&gt; ALTER DATABASE OPEN UPGRADE;
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
Refer to <a class="olink UPGRD12354" href="../../server.112/e23633/intro.htm#UPGRD12354"><span class="italic">Oracle Database Upgrade Guide</span></a> for more information on changing from 32-bit to 64-bit</div>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDFBEIC"></a>
<div id="UNXAR343" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">B.7.3</span> Migrating Data To and From ASM</h3>
<p>To take advantage of Automatic Storage Management (ASM), you can migrate an Oracle 11<span class="italic">g</span> Release 2 (11.2) database into and out of an ASM disk group using Recovery Manager (RMAN). This migration is performed using RMAN even if you are not using RMAN for your primary backup and recovery strategy.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
Chapter 8, "Performing ASM Data Migration with RMAN", in <a class="olink OSTMG12000" href="../../server.112/e18951/asm_rman.htm#OSTMG12000"><span class="italic">Oracle Automatic Storage Management Administrator's Guide</span></a> for more information on migrating databases.</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="appendix" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1783">
<tr>
<td class="cellalignment1792">
<table class="cellalignment1788">
<tr>
<td class="cellalignment1787"><a href="appa_aix.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1787"><a href="appb_hpux.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2006, 2017,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1794">
<table class="cellalignment1786">
<tr>
<td class="cellalignment1787"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1787"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1787"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1787"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1787"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1787"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
