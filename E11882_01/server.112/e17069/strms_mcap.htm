<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Managing Oracle Streams Implicit Capture</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 732" />
<meta name="dcterms.created" content="2013-06-04T12:39:36Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Streams Concepts and Administration" />
<meta name="dcterms.identifier" content="E17069-08" />
<meta name="dcterms.isVersionOf" content="STRMS" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="strms_glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="strms_mintro.htm" title="Previous" type="text/html" />
<link rel="Next" href="strms_mprop.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e17069.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">24/57</span> <!-- End Header -->
<div id="STRMS116" class="chapter"><a id="g1032206"></a><a id="BEHIEACF"></a>
<h1 class="chapter"><span class="secnum">15</span> Managing Oracle Streams Implicit Capture</h1>
<p><a id="sthref649"></a>Both <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>es and <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a>s perform <a href="strms_glossary.htm#CHDECBHI"><span class="xrefglossterm">implicit capture</span></a>. This chapter contains instructions for managing implicit capture.</p>
<p>The following topics describe managing Oracle Streams implicit capture:</p>
<ul>
<li>
<p><a href="#BEHJFCDD">Managing a Capture Process</a></p>
</li>
<li>
<p><a href="#BEHJAHDA">Managing a Synchronous Capture</a></p>
</li>
<li>
<p><a href="#i1011044">Managing Extra Attributes in Captured LCRs</a></p>
</li>
<li>
<p><a href="#BEHIDCEB">Switching From a Capture Process to a Synchronous Capture</a></p>
</li>
<li>
<p><a href="#BEHGJDCF">Switching from a Synchronous Capture to a Capture Process</a></p>
</li>
</ul>
<p>Each task described in this chapter should be completed by an Oracle Streams administrator that has been granted the appropriate privileges, unless specified otherwise.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#i1006083">Chapter 2, "Oracle Streams Information Capture"</a></p>
</li>
<li>
<p><a class="olink STREP200" href="../../server.112/e10705/prep_rep.htm#STREP200"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about creating an Oracle Streams administrator</p>
</li>
<li>
<p><a href="strms_cpmon.htm#CFFGDGCI">"Monitoring Oracle Streams Implicit Capture"</a></p>
</li>
<li>
<p><a href="strms_trcapture.htm#CACCGFEH">Chapter 31, "Troubleshooting Implicit Capture"</a></p>
</li>
</ul>
</div>
<a id="BEHJFCDD"></a>
<div id="STRMS619" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Managing a Capture Process<a id="sthref650"></a><a id="sthref651"></a><a id="sthref652"></a></h2>
<p>A <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> captures changes in a redo log, reformats each captured change into a <a href="strms_glossary.htm#CHDEJJAF"><span class="xrefglossterm">logical change record (LCR)</span></a>, and enqueues the LCR into an <code>ANYDATA</code> queue.</p>
<p>The following topics describe managing a capture process:</p>
<ul>
<li>
<p><a href="#i1006296">Starting a Capture Process</a></p>
</li>
<li>
<p><a href="#i1009968">Stopping a Capture Process</a></p>
</li>
<li>
<p><a href="#i1010115">Managing the Rule Set for a Capture Process</a></p>
</li>
<li>
<p><a href="#i1006402">Setting a Capture Process Parameter</a></p>
</li>
<li>
<p><a href="#i1012600">Setting the Capture User for a Capture Process</a></p>
</li>
<li>
<p><a href="#BEHGFEIB">Managing the Checkpoint Retention Time for a Capture Process</a></p>
</li>
<li>
<p><a href="#i1013584">Adding an Archived Redo Log File to a Capture Process Explicitly</a></p>
</li>
<li>
<p><a href="#i1008955">Setting the First SCN for an Existing Capture Process</a></p>
</li>
<li>
<p><a href="#i1006494">Setting the Start SCN for an Existing Capture Process</a></p>
</li>
<li>
<p><a href="#i1008283">Specifying Whether Downstream Capture Uses a Database Link</a></p>
</li>
<li>
<p><a href="#i1009977">Dropping a Capture Process</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#CACGECDI">"Implicit Capture with an Oracle Streams Capture Process"</a></p>
</li>
<li>
<p><a class="olink STREP209" href="../../server.112/e10705/ccap.htm#STREP209"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about configuring a capture process</p>
</li>
<li>
<p><a class="olink TDPII137" href="../../server.112/e17516/tdpii_adcont.htm#TDPII137"><span class="italic">Oracle Database 2 Day + Data Replication and Integration Guide</span></a> and the Enterprise Manager online Help for instructions on managing a capture process with Enterprise Manager</p>
</li>
</ul>
</div>
<a id="i1006296"></a>
<div id="STRMS217" class="sect2">
<h3 class="sect2">Starting a Capture Process<a id="sthref653"></a><a id="sthref654"></a></h3>
<p>You run the <code>START_CAPTURE</code> procedure in the <code>DBMS_CAPTURE_ADM</code> package to start an existing <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>. For example, the following procedure starts a capture process named <code>strm01_capture</code>:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.START_CAPTURE(
    capture_name =&gt; 'strm01_capture');
END;
/
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If a new capture process will use a new <a href="strms_glossary.htm#CBACJIJH"><span class="xrefglossterm">LogMiner data dictionary</span></a>, then, when you first start the new capture process, some time might be required to populate the new LogMiner data dictionary. A new LogMiner data dictionary is created if a non-<code>NULL</code> first SCN value was specified when the capture process was created.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink TDPII138" href="../../server.112/e17516/tdpii_adcont.htm#TDPII138"><span class="italic">Oracle Database 2 Day + Data Replication and Integration Guide</span></a> for instructions about starting a capture process with Oracle Enterprise Manager</div>
</div>
<!-- class="sect2" -->
<a id="i1009968"></a>
<div id="STRMS620" class="sect2">
<h3 class="sect2">Stopping a Capture Process<a id="sthref655"></a><a id="sthref656"></a></h3>
<p>You run the <code>STOP_CAPTURE</code> procedure in the <code>DBMS_CAPTURE_ADM</code> package to stop an existing <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>. For example, the following procedure stops a capture process named <code>strm01_capture</code>:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.STOP_CAPTURE(
    capture_name =&gt; 'strm01_capture');
END;
/
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink TDPII138" href="../../server.112/e17516/tdpii_adcont.htm#TDPII138"><span class="italic">Oracle Database 2 Day + Data Replication and Integration Guide</span></a> for instructions about stopping a capture process with Oracle Enterprise Manager</div>
</div>
<!-- class="sect2" -->
<a id="i1010115"></a>
<div id="STRMS621" class="sect2">
<h3 class="sect2">Managing the Rule Set for a Capture Process</h3>
<p>This section contains instructions for completing the following tasks:</p>
<ul>
<li>
<p><a href="#i1006305">Specifying a Rule Set for a Capture Process</a></p>
</li>
<li>
<p><a href="#i1006328">Adding Rules to a Rule Set for a Capture Process</a></p>
</li>
<li>
<p><a href="#i1006367">Removing a Rule from a Rule Set for a Capture Process</a></p>
</li>
<li>
<p><a href="#BEHEFAHI">Removing a Rule Set for a Capture Process</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_rules.htm#g1049257">Chapter 5, "How Rules Are Used in Oracle Streams"</a></p>
</li>
<li>
<p><a href="strms_adrules.htm#BABEBHGC">Chapter 11, "Advanced Rule Concepts"</a></p>
</li>
</ul>
</div>
<a id="i1006305"></a>
<div id="STRMS622" class="sect3">
<h4 class="sect3">Specifying a Rule Set for a Capture Process<a id="sthref657"></a><a id="sthref658"></a></h4>
<p>You can specify one <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> and one <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> for a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>. The capture process captures a change if it evaluates to <code>TRUE</code> for at least one <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a> in the positive rule set and evaluates to <code>FALSE</code> for all the rules in the negative rule set. The negative rule set is evaluated before the positive rule set.</p>
<div id="STRMS623" class="sect4"><a id="sthref659"></a>
<h5 class="sect4">Specifying a Positive Rule Set for a Capture Process</h5>
<p>You specify an existing <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a> as the positive rule set for an existing capture process using the <code>rule_set_name</code> parameter in the <code>ALTER_CAPTURE</code> procedure. This procedure is in the <code>DBMS_CAPTURE_ADM</code> package.</p>
<p>For example, the following procedure sets the positive rule set for a capture process named <code>strm01_capture</code> to <code>strm02_rule_set</code>.</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.ALTER_CAPTURE(
    capture_name  =&gt; 'strm01_capture',
    rule_set_name =&gt; 'strmadmin.strm02_rule_set');
END;
/
</pre></div>
<!-- class="sect4" -->
<div id="STRMS624" class="sect4"><a id="sthref660"></a>
<h5 class="sect4">Specifying a Negative Rule Set for a Capture Process</h5>
<p>You specify an existing rule set as the negative rule set for an existing capture process using the <code>negative_rule_set_name</code> parameter in the <code>ALTER_CAPTURE</code> procedure. This procedure is in the <code>DBMS_CAPTURE_ADM</code> package.</p>
<p>For example, the following procedure sets the negative rule set for a capture process named <code>strm01_capture</code> to <code>strm03_rule_set</code>.</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.ALTER_CAPTURE(
    capture_name           =&gt; 'strm01_capture',
    negative_rule_set_name =&gt; 'strmadmin.strm03_rule_set');
END;
/
</pre></div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="i1006328"></a>
<div id="STRMS625" class="sect3">
<h4 class="sect3">Adding Rules to a Rule Set for a Capture Process<a id="sthref661"></a></h4>
<p>To add <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s to a <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a> for an existing <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>, you can run one of the following procedures in the <code>DBMS_STREAMS_ADM</code> package and specify the existing capture process:</p>
<ul>
<li>
<p><a class="olink ARPLS308" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS308"><code>ADD_TABLE_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS329" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS329"><code>ADD_SUBSET_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS309" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS309"><code>ADD_SCHEMA_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS310" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS310"><code>ADD_GLOBAL_RULES</code></a></p>
</li>
</ul>
<p>Excluding the <code>ADD_SUBSET_RULES</code> procedure, these procedures can add rules to the <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> or <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> for a capture process. The <code>ADD_SUBSET_RULES</code> procedure can add rules only to the positive rule set for a capture process.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="strms_rules.htm#i1006169">"System-Created Rules"</a></div>
<a id="BABBFHCB"></a>
<div id="STRMS626" class="sect4">
<h5 class="sect4">Adding Rules to the Positive Rule Set for a Capture Process</h5>
<p>The following example runs the <code>ADD_TABLE_RULES</code> procedure in the <code>DBMS_STREAMS_ADM</code> package to add rules to the positive rule set of a capture process named <code>strm01_capture</code>:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt;  'hr.departments',
    streams_type    =&gt;  'capture',
    streams_name    =&gt;  'strm01_capture',
    queue_name      =&gt;  'strmadmin.streams_queue',
    include_dml     =&gt;  TRUE,
    include_ddl     =&gt;  TRUE,
    inclusion_rule  =&gt;  TRUE);
END;
/
</pre>
<p>Running this procedure performs the following actions:</p>
<ul>
<li>
<p>Creates two rules. One rule evaluates to <code>TRUE</code> for DML changes to the <code>hr.departments</code> table, and the other rule evaluates to <code>TRUE</code> for DDL changes to the <code>hr.departments</code> table. The rule names are system generated.</p>
</li>
<li>
<p>Adds the two rules to the positive rule set associated with the capture process because the <code>inclusion_rule</code> parameter is set to <code>TRUE</code>.</p>
</li>
<li>
<p>Prepares the <code>hr.departments</code> table for <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> by running the <code>PREPARE_TABLE_INSTANTIATION</code> procedure in the <code>DBMS_CAPTURE_ADM</code> package.</p>
</li>
<li>
<p>Enables <a href="strms_glossary.htm#CHDIHHGA"><span class="xrefglossterm">supplemental logging</span></a> for any primary key, unique key, bitmap index, and foreign key columns in the <code>hr.departments</code> table. When the <code>PREPARE_TABLE_INSTANTIATION</code> procedure is run, the default value (<code>keys</code>) is specified for the <code>supplemental_logging</code> parameter.</p>
</li>
</ul>
<p>If the capture process is performing downstream capture, then the table is prepared for instantiation and supplemental logging is enabled for key columns only if the <a href="strms_glossary.htm#CHDHEBHD"><span class="xrefglossterm">downstream capture process</span></a> uses a database link to the <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a>. If a downstream capture process does not use a database link to the source database, then the table must be prepared for instantiation manually and supplemental logging must be enabled manually.</p>
</div>
<!-- class="sect4" -->
<div id="STRMS627" class="sect4"><a id="sthref662"></a>
<h5 class="sect4">Adding Rules to the Negative Rule Set for a Capture Process</h5>
<p>The following example runs the <code>ADD_TABLE_RULES</code> procedure in the <code>DBMS_STREAMS_ADM</code> package to add rules to the <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> of a capture process named <code>strm01_capture</code>:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt;  'hr.job_history',
    streams_type    =&gt;  'capture',
    streams_name    =&gt;  'strm01_capture',
    queue_name      =&gt;  'strmadmin.streams_queue',
    include_dml     =&gt;  TRUE,
    include_ddl     =&gt;  TRUE,
    inclusion_rule  =&gt;  FALSE);
END;
/
</pre>
<p>Running this procedure performs the following actions:</p>
<ul>
<li>
<p>Creates two rules. One rule evaluates to <code>TRUE</code> for DML changes to the <code>hr.job_history</code> table, and the other rule evaluates to <code>TRUE</code> for DDL changes to the <code>hr.job_history</code> table. The rule names are system generated.</p>
</li>
<li>
<p>Adds the two rules to the negative rule set associated with the capture process, because the <code>inclusion_rule</code> parameter is set to <code>FALSE</code>.</p>
</li>
</ul>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="i1006367"></a>
<div id="STRMS628" class="sect3">
<h4 class="sect3">Removing a Rule from a Rule Set for a Capture Process<a id="sthref663"></a><a id="sthref664"></a></h4>
<p>You remove a rule from the rule set for a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> if you no longer want the capture process to capture the changes specified in the rule. For example, assume that the <code>departments3</code> rule specifies that DML changes to the <code>hr.departments</code> table be captured. If you no longer want a capture process to capture changes to the <code>hr.departments</code> table, then remove the <code>departments3</code> rule from its rule set.</p>
<p>You remove a <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a> from a <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a> for an existing <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> by running the <code>REMOVE_RULE</code> procedure in the <code>DBMS_STREAMS_ADM</code> package. For example, the following procedure removes a rule named <code>departments3</code> from the <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> of a capture process named <code>strm01_capture</code>.</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.REMOVE_RULE(
    rule_name        =&gt; 'departments3',
    streams_type     =&gt; 'capture',
    streams_name     =&gt; 'strm01_capture',
    drop_unused_rule =&gt; TRUE,
    inclusion_rule   =&gt; TRUE);
END;
/
</pre>
<p>In this example, the <code>drop_unused_rule</code> parameter in the <code>REMOVE_RULE</code> procedure is set to <code>TRUE</code>, which is the default setting. Therefore, if the rule being removed is not in any other rule set, then it will be dropped from the database. If the <code>drop_unused_rule</code> parameter is set to <code>FALSE</code>, then the rule is removed from the rule set, but it is not dropped from the database.</p>
<p>If the <code>inclusion_rule</code> parameter is set to <code>FALSE</code>, then the <code>REMOVE_RULE</code> procedure removes the rule from the <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> for the capture process, not the positive rule set.</p>
<p>To remove all of the rules in a rule set for the capture process, specify <code>NULL</code> for the <code>rule_name</code> parameter when you run the <code>REMOVE_RULE</code> procedure.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="strms_rules.htm#i1016002">"Oracle Streams Client with One or More Empty Rule Sets"</a></div>
</div>
<!-- class="sect3" -->
<a id="BEHEFAHI"></a>
<div id="STRMS629" class="sect3">
<h4 class="sect3">Removing a Rule Set for a Capture Process<a id="sthref665"></a><a id="sthref666"></a></h4>
<p>You remove a <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a> from an existing <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> using the <code>ALTER_CAPTURE</code> procedure in the <code>DBMS_CAPTURE_ADM</code> package. This procedure can remove the <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a>, <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a>, or both. Specify <code>TRUE</code> for the <code>remove_rule_set</code> parameter to remove the positive rule set for the capture process. Specify <code>TRUE</code> for the <code>remove_negative_rule_set</code> parameter to remove the negative rule set for the capture process.</p>
<p>For example, the following procedure removes both the positive and negative rule set from a capture process named <code>strm01_capture</code>.</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.ALTER_CAPTURE(
    capture_name             =&gt; 'strm01_capture',
    remove_rule_set          =&gt; TRUE,
    remove_negative_rule_set =&gt; TRUE);
END;
/
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If a capture process does not have a positive or negative rule set, then the capture process captures all supported changes to all objects in the database, excluding database objects in the <code>SYS</code>, <code>SYSTEM</code>, and <code>CTXSYS</code> schemas.</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1006402"></a>
<div id="STRMS630" class="sect2">
<h3 class="sect2">Setting a Capture Process Parameter<a id="sthref667"></a><a id="sthref668"></a></h3>
<p>Set a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> parameter using the <code>SET_PARAMETER</code> procedure in the <code>DBMS_CAPTURE_ADM</code> package. Capture process parameters control the way a capture process operates.</p>
<p>For example, the following procedure sets the <code>parallelism</code> parameter for a capture process named <code>strm01_capture</code> to <code>4</code>.</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.SET_PARAMETER(
    capture_name =&gt; 'strm01_capture',
    parameter    =&gt; 'parallelism',
    value        =&gt; '4');
END;
/
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
<ul>
<li>
<p>Setting the <code>parallelism</code> parameter automatically stops and restarts a capture process.</p>
</li>
<li>
<p>The <code>value</code> parameter is always entered as a <code>VARCHAR2</code> value, even if the parameter value is a number.</p>
</li>
<li>
<p>If the <code>value</code> parameter is set to <code>NULL</code> or is not specified, then the parameter is set to its default value.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink TDPII139" href="../../server.112/e17516/tdpii_adcont.htm#TDPII139"><span class="italic">Oracle Database 2 Day + Data Replication and Integration Guide</span></a> for instructions about setting capture process parameters with Oracle Enterprise Manager</p>
</li>
<li>
<p><a href="strms_capture.htm#i1006718">"Capture Process Subcomponents"</a></p>
</li>
<li>
<p>The <code>DBMS_CAPTURE_ADM.SET_PARAMETER</code> procedure in the <a class="olink ARPLS306" href="../../appdev.112/e40758/d_cap_a.htm#ARPLS306"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for detailed information about the capture process parameters</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i1012600"></a>
<div id="STRMS631" class="sect2">
<h3 class="sect2">Setting the Capture User for a Capture Process<a id="sthref669"></a><a id="sthref670"></a></h3>
<p>The <a href="strms_glossary.htm#CBAEBCEE"><span class="xrefglossterm">capture user</span></a> is the user who captures all DML changes and DDL changes that satisfy the <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a>s. Set the capture user for a capture process using the <code>capture_user</code> parameter in the <code>ALTER_CAPTURE</code> procedure in the <code>DBMS_CAPTURE_ADM</code> package.</p>
<p>To change the capture user, the user who invokes the <code>ALTER_CAPTURE</code> procedure must be granted <code>DBA</code> role. Only the <code>SYS</code> user can set the <code>capture_user</code> to <code>SYS</code>.</p>
<p>For example, the following procedure sets the capture user for a capture process named <code>strm01_capture</code> to <code>hr</code>.</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.ALTER_CAPTURE(
    capture_name =&gt; 'strm01_capture',
    capture_user =&gt; 'hr');
END;
/
</pre>
<p>Running this procedure grants the new capture user enqueue privilege on the queue used by the capture process and configures the user as a <a href="strms_glossary.htm#CHDGHFGG"><span class="xrefglossterm">secure queue</span></a> user of the <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a>. In addition, ensure that the capture user has the following privileges:</p>
<ul>
<li>
<p><code>EXECUTE</code> privilege on the rule sets used by the capture process</p>
</li>
<li>
<p><code>EXECUTE</code> privilege on all <a href="strms_glossary.htm#CHDDGIFE"><span class="xrefglossterm">custom rule-based transformation</span></a> functions used in the rule set</p>
</li>
</ul>
<p>These privileges can be granted to the capture user directly or through roles.</p>
<p>In addition, the capture user must be granted <code>EXECUTE</code> privilege on all packages, including Oracle-supplied packages, that are invoked in rule-based transformations run by the capture process. These privileges must be granted directly to the capture user. They cannot be granted through roles.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If Oracle Database Vault is installed, follow the steps outlined in <a href="ap_other.htm#BGBCEHCG">"Oracle Streams and Oracle Data Vault"</a> to ensure the correct privileges and roles have been granted.</div>
</div>
<!-- class="sect2" -->
<a id="BEHGFEIB"></a>
<div id="STRMS632" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Managing the Checkpoint Retention Time for a Capture Process<a id="sthref671"></a><a id="sthref672"></a></h3>
<p>The <a href="strms_glossary.htm#CBAGHCAC"><span class="xrefglossterm">checkpoint retention time</span></a> is the amount of time that a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> retains <a href="strms_glossary.htm#CHDBFBJI"><span class="xrefglossterm">checkpoint</span></a>s before purging them automatically.</p>
<p>Set the checkpoint retention time for a capture process using <code>checkpoint_retention_time</code> parameter in the <code>ALTER_CAPTURE</code> procedure of the <code>DBMS_CAPTURE_ADM</code> package.</p>
<p>This section contains these topics:</p>
<ul>
<li>
<p><a href="#BABGGGIG">Setting the Checkpoint Retention Time for a Capture Process to a New Value</a></p>
</li>
<li>
<p><a href="#BABBCFAF">Setting the Checkpoint Retention Time for a Capture Process to Infinite</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_adcapture.htm#i1010653">"Capture Process Checkpoints"</a></p>
</li>
</ul>
</div>
<a id="BABGGGIG"></a>
<div id="STRMS633" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Setting the Checkpoint Retention Time for a Capture Process to a New Value</h4>
<p>When you set the checkpoint retention time, you can specify partial days with decimal values. For example, run the following procedure to specify that a capture process named <code>strm01_capture</code> should purge checkpoints automatically every ten days and twelve hours:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.ALTER_CAPTURE(
    capture_name              =&gt; 'strm01_capture',
    checkpoint_retention_time =&gt; 10.5);
END;
/
</pre></div>
<!-- class="sect3" -->
<a id="BABBCFAF"></a>
<div id="STRMS634" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Setting the Checkpoint Retention Time for a Capture Process to Infinite</h4>
<p>To specify that a capture process should not purge checkpoints automatically, set the checkpoint retention time to <code>DBMS_CAPTURE_ADM.INFINITE</code>. For example, the following procedure sets the checkpoint retention time for a name <code>strm01_capture</code> to infinite:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.ALTER_CAPTURE(
    capture_name              =&gt; 'strm01_capture',
    checkpoint_retention_time =&gt; DBMS_CAPTURE_ADM.INFINITE);
END;
/
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1013584"></a>
<div id="STRMS635" class="sect2">
<h3 class="sect2">Adding an Archived Redo Log File to a Capture Process Explicitly<a id="sthref673"></a></h3>
<p>You can add an archived redo log file to a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> manually using the following statement:</p>
<pre>
ALTER DATABASE REGISTER LOGICAL LOGFILE 
   <span class="italic">file_name</span> FOR <span class="italic">capture_process</span>;
</pre>
<p>Here, <code><span class="codeinlineitalic">file_name</span></code> is the name of the archived redo log file being added, and <code><span class="codeinlineitalic">capture_process</span></code> is the name of the capture process that will use the redo log file at the <a href="strms_glossary.htm#CHDBJECA"><span class="xrefglossterm">downstream database</span></a>. The <code><span class="codeinlineitalic">capture_process</span></code> is equivalent to the <code><span class="codeinlineitalic">logminer_session_name</span></code> and must be specified. The redo log file must be present at the site running capture process.</p>
<p>For example, to add the <code>/usr/log_files/1_3_486574859.dbf</code> archived redo log file to a capture process named <code>strm03_capture</code>, issue the following statement:</p>
<pre>
ALTER DATABASE REGISTER LOGICAL LOGFILE '/usr/log_files/1_3_486574859.dbf' 
  FOR 'strm03_capture';
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF00802" href="../../server.112/e41084/statements_1004.htm#SQLRF00802"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information about the <code>ALTER</code> <code>DATABASE</code> statement and <a class="olink SBYDB" href="../e41134/toc.htm"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for more information registering redo log files</div>
</div>
<!-- class="sect2" -->
<a id="i1008955"></a>
<div id="STRMS636" class="sect2">
<h3 class="sect2">Setting the First SCN for an Existing Capture Process<a id="sthref674"></a><a id="sthref675"></a></h3>
<p>You can set the <a href="strms_glossary.htm#CHDCJHGI"><span class="xrefglossterm">first SCN</span></a> for an existing <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>.</p>
<p>The specified first SCN must meet the following requirements:</p>
<ul>
<li>
<p>It must be greater than the current first SCN for the capture process.</p>
</li>
<li>
<p>It must be less than or equal to the current <a href="strms_glossary.htm#CHDGDHFE"><span class="xrefglossterm">applied SCN</span></a> for the capture process. However, this requirement does not apply if the current applied SCN for the capture process is zero.</p>
</li>
<li>
<p>It must be less than or equal to the <a href="strms_glossary.htm#CHDJHFCB"><span class="xrefglossterm">required checkpoint SCN</span></a> for the capture process.</p>
</li>
</ul>
<p>You can determine the current first SCN, applied SCN, and required checkpoint SCN for each capture process in a database using the following query:</p>
<pre>
SELECT CAPTURE_NAME, FIRST_SCN, APPLIED_SCN, REQUIRED_CHECKPOINT_SCN
   FROM DBA_CAPTURE;
</pre>
<p>When you reset a first SCN for a capture process, information below the new first SCN setting is purged from the <a href="strms_glossary.htm#CBACJIJH"><span class="xrefglossterm">LogMiner data dictionary</span></a> for the capture process automatically. Therefore, after the first SCN is reset for a capture process, the <a href="strms_glossary.htm#CHDIJJCD"><span class="xrefglossterm">start SCN</span></a> for the capture process cannot be set lower than the new first SCN. Also, redo log files that contain information before the new first SCN setting will never be needed by the capture process.</p>
<p>For example, the following procedure sets the first SCN for a capture process named <code>strm01_capture</code> to <code>351232</code> using the <code>ALTER_CAPTURE</code> procedure in the <code>DBMS_CAPTURE_ADM</code> package:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.ALTER_CAPTURE(
    capture_name =&gt; 'strm01_capture',
    first_scn    =&gt; 351232);
END;
/
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
<ul>
<li>
<p>If the specified first SCN is higher than the current start SCN for the capture process, then the start SCN is set automatically to the new value of the first SCN.</p>
</li>
<li>
<p>If you must capture changes in the redo log from a point in time in the past, then you can create a capture process and specify a first SCN that corresponds to a previous data dictionary build in the redo log. The <code>BUILD</code> procedure in the <code>DBMS_CAPTURE_ADM</code> package performs a data dictionary build in the redo log.</p>
</li>
<li>
<p>You can query the <code>DBA_LOGMNR_PURGED_LOG</code> data dictionary view to determine which redo log files will never be needed by any capture process.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#i1006559">"SCN Values Related to a Capture Process"</a></p>
</li>
<li>
<p><a href="strms_adcapture.htm#i1010542">"The LogMiner Data Dictionary for a Capture Process"</a></p>
</li>
<li>
<p><a href="strms_cpmon.htm#i1021143">"Displaying SCN Values for Each Redo Log File Used by Each Capture Process"</a> for a query that determines which redo log files are no longer needed</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i1006494"></a>
<div id="STRMS638" class="sect2">
<h3 class="sect2">Setting the Start SCN for an Existing Capture Process<a id="sthref676"></a><a id="sthref677"></a></h3>
<p>You can set the <a href="strms_glossary.htm#CHDIJJCD"><span class="xrefglossterm">start SCN</span></a> for an existing <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>. Typically, you reset the start SCN for a capture process if point-in-time recovery must be performed on one of the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>s that receive changes from the capture process.</p>
<p>The specified start SCN must be greater than or equal to the <a href="strms_glossary.htm#CHDCJHGI"><span class="xrefglossterm">first SCN</span></a> for the capture process. When you reset a start SCN for a capture process, ensure that the required redo log files are available to the capture process.</p>
<p>You can determine the first SCN for each capture process in a database using the following query:</p>
<pre>
SELECT CAPTURE_NAME, FIRST_SCN FROM DBA_CAPTURE;
</pre>
<p>For example, to set the start SCN for a capture process named <code>strm01_capture</code> to <code>750338</code>, complete the following steps:</p>
<ol>
<li>
<p>Stop the capture process. See <a href="#i1009968">"Stopping a Capture Process"</a> for instructions.</p>
</li>
<li>
<p>Run the <code>ALTER_CAPTURE</code> procedure to set the start SCN:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.ALTER_CAPTURE(
    capture_name =&gt; 'strm01_capture',
    start_scn    =&gt; 750338);
END;
/
</pre></li>
<li>
<p>Start the capture process. See <a href="#i1006296">"Starting a Capture Process"</a> for instructions.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#i1006559">"SCN Values Related to a Capture Process"</a></p>
</li>
<li>
<p><a class="olink STREP121" href="../../server.112/e10705/man_gen_rep.htm#STREP121"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about performing database point-in-time recovery on a destination database in an Oracle Streams environment</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i1008283"></a>
<div id="STRMS640" class="sect2">
<h3 class="sect2">Specifying Whether Downstream Capture Uses a Database Link<a id="sthref678"></a><a id="sthref679"></a></h3>
<p>You specify whether an existing <a href="strms_glossary.htm#CHDHEBHD"><span class="xrefglossterm">downstream capture process</span></a> uses a database link to the <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a> for administrative purposes using the <code>ALTER_CAPTURE</code> procedure in the <code>DBMS_CAPTURE_ADM</code> package. Set the <code>use_database_link</code> parameter to <code>TRUE</code> to specify that the downstream capture process uses a database link, or you set the <code>use_database_link</code> parameter to <code>FALSE</code> to specify that the downstream capture process does not use a database link.</p>
<p>If you want a capture process that is not using a database link currently to begin using a database link, then specify <code>TRUE</code> for the <code>use_database_link</code> parameter. In this case, a database link with the same name as the global name as the source database must exist at the <a href="strms_glossary.htm#CHDBJECA"><span class="xrefglossterm">downstream database</span></a>.</p>
<p>If you want a capture process that is using a database link currently to stop using a database link, then specify <code>FALSE</code> for the <code>use_database_link</code> parameter. In this case, some administration must be performed manually after you alter the capture process. For example, if you add new capture process <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s using the <code>DBMS_STREAMS_ADM</code> package, then you must prepare the objects relating to the rules for <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> manually at the source database.</p>
<p>If you specify <code>NULL</code> for the <code>use_database_link</code> parameter, then the current value of this parameter for the capture process is not changed.</p>
<p>To create a database link to the source database <code>dbs1.example.com</code> and specify that this capture process uses the database link, complete the following steps:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the downstream database as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMIN00102" href="../../server.112/e25494/dba.htm#ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Create the database link to the source database. Ensure that the database link connects to the Oracle Streams administrator at the source database. For example:</p>
<pre>
CREATE DATABASE LINK dbs1.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING 'dbs1.example.com';
</pre></li>
<li>
<p>Alter the capture process to use the database link. For example:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.ALTER_CAPTURE(
    capture_name       =&gt; 'strm05_capture',
    use_database_link  =&gt; TRUE);
END;
/
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="strms_capture.htm#i1013269">"Local Capture and Downstream Capture"</a></div>
</div>
<!-- class="sect2" -->
<a id="i1009977"></a>
<div id="STRMS641" class="sect2">
<h3 class="sect2">Dropping a Capture Process<a id="sthref680"></a><a id="sthref681"></a></h3>
<p>You run the <code>DROP_CAPTURE</code> procedure in the <code>DBMS_CAPTURE_ADM</code> package to drop an existing <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>. For example, the following procedure drops a capture process named <code>strm02_capture</code>:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.DROP_CAPTURE(
    capture_name          =&gt; 'strm02_capture',
    drop_unused_rule_sets =&gt; TRUE);
END;
/
</pre>
<p>Because the <code>drop_unused_rule_sets</code> parameter is set to <code>TRUE</code>, this procedure also drops any <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a>s used by the <code>strm02_capture</code> capture process, unless a rule set is used by another <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a>. If the <code>drop_unused_rule_sets</code> parameter is set to <code>TRUE</code>, then both the <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> and <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> for the capture process might be dropped. If this procedure drops a rule set, then it also drops any <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s in the rule set that are not in another rule set.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The status of a capture process must be <code>DISABLED</code> or <code>ABORTED</code> before it can be dropped. You cannot drop an <code>ENABLED</code> capture process.</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BEHJAHDA"></a>
<div id="STRMS643" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Managing a Synchronous Capture<a id="sthref682"></a></h2>
<p>A <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a> uses an internal mechanism to capture data manipulation language (DML) changes made to tables. A synchronous capture reformats each captured change into a <a href="strms_glossary.htm#CHDEJJAF"><span class="xrefglossterm">logical change record (LCR)</span></a>, and enqueues the LCR into an <code>ANYDATA</code> queue.</p>
<p>This section contains these topics:</p>
<ul>
<li>
<p><a href="#BEHEIJCG">Managing the Rule Set for a Synchronous Capture</a></p>
</li>
<li>
<p><a href="#BEHFHHID">Setting the Capture User for a Synchronous Capture</a></p>
</li>
<li>
<p><a href="#BEHEECJB">Dropping a Synchronous Capture</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#CACIDGBI">"Implicit Capture with Synchronous Capture"</a></p>
</li>
<li>
<p><a class="olink STREP208" href="../../server.112/e10705/ccap.htm#STREP208"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about configuring synchronous capture</p>
</li>
<li>
<p><a href="strms_cpmon.htm#CFFGCIJJ">"Monitoring a Synchronous Capture"</a></p>
</li>
<li>
<p><a class="olink TDPII080" href="../../server.112/e17516/tdpii_repcont.htm#TDPII080"><span class="italic">Oracle Database 2 Day + Data Replication and Integration Guide</span></a> for an example that configures a replication environment that uses synchronous capture</p>
</li>
</ul>
</div>
<a id="BEHEIJCG"></a>
<div id="STRMS644" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Managing the Rule Set for a Synchronous Capture</h3>
<p>This section contains instructions for completing the following tasks:</p>
<ul>
<li>
<p><a href="#BEHEEIHD">Specifying a Rule Set for a Synchronous Capture</a></p>
</li>
<li>
<p><a href="#BEHDCGAJ">Adding Rules to a Rule Set for a Synchronous Capture</a></p>
</li>
<li>
<p><a href="#BEHICDDC">Removing a Rule from a Rule Set for a Synchronous Capture</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_rules.htm#g1049257">Chapter 5, "How Rules Are Used in Oracle Streams"</a></p>
</li>
<li>
<p><a href="strms_adrules.htm#BABEBHGC">Chapter 11, "Advanced Rule Concepts"</a></p>
</li>
</ul>
</div>
<a id="BEHEEIHD"></a>
<div id="STRMS645" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Specifying a Rule Set for a Synchronous Capture<a id="sthref683"></a><a id="sthref684"></a></h4>
<p>You can specify one <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> for a <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a>. The synchronous capture captures a change if it evaluates to <code>TRUE</code> for at least one <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a> in the positive rule set.</p>
<p>You specify an existing <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a> as the positive rule set for an existing synchronous capture using the <code>rule_set_name</code> parameter in the <code>ALTER_SYNC_CAPTURE</code> procedure. This procedure is in the <code>DBMS_CAPTURE_ADM</code> package.</p>
<p>For example, the following procedure sets the positive rule set for a synchronous capture named <code>sync_capture</code> to <code>sync_rule_set</code>.</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.ALTER_SYNC_CAPTURE(
    capture_name  =&gt; 'sync_capture',
    rule_set_name =&gt; 'strmadmin.sync_rule_set');
END;
/
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
You cannot remove the rule set for a synchronous capture.</div>
</div>
<!-- class="sect3" -->
<a id="BEHDCGAJ"></a>
<div id="STRMS646" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Adding Rules to a Rule Set for a Synchronous Capture<a id="sthref685"></a></h4>
<p>To add <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s to a <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a> for an existing <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a>, you can run one of the following procedures in the <code>DBMS_STREAMS_ADM</code> package and specify the existing synchronous capture:</p>
<ul>
<li>
<p><a class="olink ARPLS308" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS308"><code>ADD_TABLE_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS329" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS329"><code>ADD_SUBSET_RULES</code></a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="strms_rules.htm#i1006169">"System-Created Rules"</a></div>
<p>The following example runs the <code>ADD_TABLE_RULES</code> procedure in the <code>DBMS_STREAMS_ADM</code> package to add rules to the positive rule set of a synchronous capture named <code>sync_capture</code>:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt;  'hr.departments',
    streams_type    =&gt;  'sync_capture',
    streams_name    =&gt;  'sync_capture',
    queue_name      =&gt;  'strmadmin.streams_queue',
    include_dml     =&gt;  TRUE);
END;
/
</pre>
<p>Running this procedure performs the following actions:</p>
<ul>
<li>
<p>Creates one rule which evaluates to <code>TRUE</code> for DML changes to the <code>hr.departments</code> table. The rule name is system generated.</p>
</li>
<li>
<p>Adds the rule to the positive rule set associated with the synchronous capture.</p>
</li>
<li>
<p>Prepares the <code>hr.departments</code> table for <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> by running the <code>PREPARE_SYNC_INSTANTIATION</code> function in the <code>DBMS_CAPTURE_ADM</code> package.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
<ul>
<li>
<p>A synchronous capture captures changes to a table only if the <code>ADD_TABLE_RULES</code> or <code>ADD_SUBSET_RULES</code> procedure was used to add the rule or rules for the table to the synchronous capture rule set. Synchronous capture does not capture changes to a table if a table or subset rule is added to its rule set using the <code>ADD_RULE</code> procedure in the <code>DBMS_RULE_ADM</code> package. In addition, a synchronous capture ignores all non-table and non-subset rules in its rule set, including global and schema rules.</p>
</li>
<li>
<p>When the <code>ADD_TABLE_RULES</code> or the <code>ADD_SUBSET_RULES</code> procedure adds rules to a synchronous capture rule set, the procedure must obtain an exclusive lock on the specified table. If there are outstanding transactions on the specified table, then the procedure waits until it can obtain a lock.</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="BEHICDDC"></a>
<div id="STRMS647" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Removing a Rule from a Rule Set for a Synchronous Capture</h4>
<p>You remove a rule from the rule set for a <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a> if you no longer want the synchronous capture to capture the changes specified in the rule. For example, assume that the <code>departments3</code> rule specifies that DML changes to the <code>hr.departments</code> table be captured. If you no longer want a synchronous capture to capture changes to the <code>hr.departments</code> table, then remove the <code>departments3</code> rule from its rule set.</p>
<p>You remove a <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a> from a <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a> for an existing synchronous capture by running the <code>REMOVE_RULE</code> procedure in the <code>DBMS_STREAMS_ADM</code> package. For example, the following procedure removes a rule named <code>departments3</code> from the <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> of a synchronous capture named <code>sync_capture</code>.</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.REMOVE_RULE(
    rule_name        =&gt; 'departments3',
    streams_type     =&gt; 'sync_capture',
    streams_name     =&gt; 'sync_capture',
    drop_unused_rule =&gt; TRUE);
END;
/
</pre>
<p>In this example, the <code>drop_unused_rule</code> parameter in the <code>REMOVE_RULE</code> procedure is set to <code>TRUE</code>, which is the default setting. Therefore, if the rule being removed is not in any other rule set, then it will be dropped from the database. If the <code>drop_unused_rule</code> parameter is set to <code>FALSE</code>, then the rule is removed from the rule set, but it is not dropped from the database.</p>
<p>To remove all of the rules in a rule set for the synchronous capture, specify <code>NULL</code> for the <code>rule_name</code> parameter when you run the <code>REMOVE_RULE</code> procedure.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="strms_rules.htm#i1016002">"Oracle Streams Client with One or More Empty Rule Sets"</a></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BEHFHHID"></a>
<div id="STRMS648" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Setting the Capture User for a Synchronous Capture<a id="sthref686"></a><a id="sthref687"></a></h3>
<p>The <a href="strms_glossary.htm#CBAEBCEE"><span class="xrefglossterm">capture user</span></a> is the user who captures all DML changes that satisfy the <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a> <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a>. Set the capture user for a synchronous capture using the <code>capture_user</code> parameter in the <code>ALTER_SYNC_CAPTURE</code> procedure in the <code>DBMS_CAPTURE_ADM</code> package.</p>
<p>To change the capture user, the user who invokes the <code>ALTER_SYNC_CAPTURE</code> procedure must be granted <code>DBA</code> role. Only the <code>SYS</code> user can set the <code>capture_user</code> to <code>SYS</code>.</p>
<p>For example, the following procedure sets the capture user for a synchronous capture named <code>sync_capture</code> to <code>hr</code>.</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.ALTER_SYNC_CAPTURE(
    capture_name =&gt; 'sync_capture',
    capture_user =&gt; 'hr');
END;
/
</pre>
<p>Running this procedure grants the new capture user enqueue privilege on the queue used by the synchronous capture and configures the user as a <a href="strms_glossary.htm#CHDGHFGG"><span class="xrefglossterm">secure queue</span></a> user of the <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a>. In addition, ensure that the capture user has the following privileges:</p>
<ul>
<li>
<p><code>EXECUTE</code> privilege on the rule set used by the synchronous capture</p>
</li>
<li>
<p><code>EXECUTE</code> privilege on all <a href="strms_glossary.htm#CHDDGIFE"><span class="xrefglossterm">custom rule-based transformation</span></a> functions used in the rule set</p>
</li>
</ul>
<p>These privileges can be granted to the capture user directly or through roles.</p>
<p>In addition, the capture user must be granted <code>EXECUTE</code> privilege on all packages, including Oracle-supplied packages, that are invoked in rule-based transformations run by the synchronous capture. These privileges must be granted directly to the capture user. They cannot be granted through roles.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If Oracle Database Vault is installed, follow the steps outlined in <a href="ap_other.htm#BGBCEHCG">"Oracle Streams and Oracle Data Vault"</a> to ensure the correct privileges and roles have been granted.</div>
</div>
<!-- class="sect2" -->
<a id="BEHEECJB"></a>
<div id="STRMS649" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Dropping a Synchronous Capture<a id="sthref688"></a><a id="sthref689"></a></h3>
<p>You run the <code>DROP_CAPTURE</code> procedure in the <code>DBMS_CAPTURE_ADM</code> package to drop an existing <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a>. For example, the following procedure drops a synchronous capture named <code>sync_capture</code>:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.DROP_CAPTURE(
    capture_name          =&gt; 'sync_capture',
    drop_unused_rule_sets =&gt; TRUE);
END;
/
</pre>
<p>Because the <code>drop_unused_rule_sets</code> parameter is set to <code>TRUE</code>, this procedure also drops any <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a>s used by the <code>sync_capture</code> synchronous capture, unless a rule set is used by another <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a>. If the <code>drop_unused_rule_sets</code> parameter is set to <code>TRUE</code>, then the rule set for the synchronous capture might be dropped. If this procedure drops a rule set, then it also drops any <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s in the rule set that are not in another rule set.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1011044"></a>
<div id="STRMS650" class="sect1">
<h2 class="sect1">Managing Extra Attributes in Captured LCRs<a id="sthref690"></a><a id="sthref691"></a></h2>
<p>You can use the <code>INCLUDE_EXTRA_ATTRIBUTE</code> procedure in the <code>DBMS_CAPTURE_ADM</code> package to instruct a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> or a <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a> to capture one or more extra attributes. You can also use this procedure to instruct a capture process or synchronous capture to exclude an extra attribute that it is capturing currently.</p>
<p>The extra attributes are the following:</p>
<ul>
<li>
<p><code>row_id</code> (row LCRs only)</p>
</li>
<li>
<p><code>serial#</code></p>
</li>
<li>
<p><code>session#</code></p>
</li>
<li>
<p><code>thread#</code></p>
</li>
<li>
<p><code>tx_name</code></p>
</li>
<li>
<p><code>username</code></p>
</li>
</ul>
<p>This section contains instructions for completing the following tasks:</p>
<ul>
<li>
<p><a href="#i1011019">Including Extra Attributes in Implicitly Captured LCRs</a></p>
</li>
<li>
<p><a href="#i1011031">Excluding Extra Attributes from Implicitly Captured LCRs</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#CACHIIJF">"Extra Information in LCRs"</a></p>
</li>
<li>
<p><a href="strms_cpmon.htm#i1013673">"Viewing the Extra Attributes Captured by Implicit Capture"</a></p>
</li>
<li>
<p><a class="olink ARPLS522" href="../../appdev.112/e40758/d_cap_a.htm#ARPLS522"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code>INCLUDE_EXTRA_ATTRIBUTE</code> procedure</p>
</li>
</ul>
</div>
<a id="i1011019"></a>
<div id="STRMS651" class="sect2">
<h3 class="sect2">Including Extra Attributes in Implicitly Captured LCRs</h3>
<p>To include an extra attribute in the LCRs captured by a capture process or synchronous capture, run the <code>INCLUDE_EXTRA_ATTRIBUTES</code> procedure, and set the <code>include</code> parameter to <code>TRUE</code>. For example, to instruct a capture process or synchronous capture named <code>strm01_capture</code> to include the transaction name in each LCR that it captures, run the following procedure:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.INCLUDE_EXTRA_ATTRIBUTE(
    capture_name   =&gt; 'strm01_capture',
    attribute_name =&gt; 'tx_name',
    include        =&gt; TRUE);
END;
/
</pre></div>
<!-- class="sect2" -->
<a id="i1011031"></a>
<div id="STRMS652" class="sect2">
<h3 class="sect2">Excluding Extra Attributes from Implicitly Captured LCRs</h3>
<p>To exclude an extra attribute from the LCRs captured by a capture process or synchronous capture, run the <code>INCLUDE_EXTRA_ATTRIBUTES</code> procedure, and set the <code>include</code> parameter to <code>FALSE</code>. For example, to instruct a capture process or synchronous capture named <code>strm01_capture</code> to exclude the transaction name from each LCR that it captures, run the following procedure:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.INCLUDE_EXTRA_ATTRIBUTE(
    capture_name   =&gt; 'strm01_capture',
    attribute_name =&gt; 'tx_name',
    include        =&gt; FALSE);
END;
/
</pre></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BEHIDCEB"></a>
<div id="STRMS653" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Switching From a Capture Process to a Synchronous Capture<a id="sthref692"></a><a id="sthref693"></a></h2>
<p>This section describes how to switch from a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> to a <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a>. Typically, a synchronous capture is used to capture data manipulation language (DML) changes to a relatively small number of tables. You might decide to make this switch if you are currently capturing changes to a small number of tables with a capture process instead of a synchronous capture.</p>
<p>You should not switch from a capture process to a synchronous capture if any of the following conditions are true:</p>
<ul>
<li>
<p>Instead of capturing the changes made to a small number of tables, the capture process is capturing changes made to an entire database, one or more schemas, or a large number of tables, and you want to continue to capture these changes.</p>
</li>
<li>
<p>The capture process is capturing data definition language (DDL) changes, and you want to continue to capture DDL changes. A synchronous capture cannot capture DDL changes.</p>
</li>
<li>
<p>The capture process uses a <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a>, and you want to continue to use a negative rule set. A synchronous capture cannot use negative rule set.</p>
</li>
<li>
<p>The capture process is a <a href="strms_glossary.htm#CHDHEBHD"><span class="xrefglossterm">downstream capture process</span></a>. Downstream capture is not possible with a synchronous capture.</p>
</li>
</ul>
<p>This section uses an example to describe how to switch from a capture process to a synchronous capture. <a href="#BEHIHIGH">Table 15-1</a> shows the Oracle Streams components in the sample environment before the switch and after the switch.</p>
<div id="STRMS654" class="tblhruleformal">
<p class="titleintable"><a id="sthref694"></a><a id="BEHIHIGH"></a>Table 15-1 Sample Switch From a Capture Process to a Synchronous Capture</p>
<table class="cellalignment1634" title="Sample Switch From a Capture Process to a Synchronous Capture" summary="This table shows each Streams component in the environment before the switch from a capture process to a synchronous capture and after the switch." dir="ltr">
<thead>
<tr class="cellalignment1625">
<th class="cellalignment1635" id="r1c1-t29">Oracle Streams Component</th>
<th class="cellalignment1635" id="r1c2-t29">Before Switch</th>
<th class="cellalignment1635" id="r1c3-t29">After Switch</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r2c1-t29" headers="r1c1-t29">
<p>Capture Process</p>
</td>
<td class="cellalignment1631" headers="r2c1-t29 r1c2-t29">
<p><code>cap_proc</code></p>
</td>
<td class="cellalignment1631" headers="r2c1-t29 r1c3-t29">
<p>None</p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r3c1-t29" headers="r1c1-t29">
<p>Capture Process Rule Set</p>
</td>
<td class="cellalignment1631" headers="r3c1-t29 r1c2-t29">
<p><code>cap_rules</code></p>
</td>
<td class="cellalignment1631" headers="r3c1-t29 r1c3-t29">
<p>None</p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r4c1-t29" headers="r1c1-t29">
<p>Synchronous Capture</p>
</td>
<td class="cellalignment1631" headers="r4c1-t29 r1c2-t29">
<p>None</p>
</td>
<td class="cellalignment1631" headers="r4c1-t29 r1c3-t29">
<p><code>sync_cap</code></p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r5c1-t29" headers="r1c1-t29">
<p>Synchronous Capture Rule Set</p>
</td>
<td class="cellalignment1631" headers="r5c1-t29 r1c2-t29">
<p>None</p>
</td>
<td class="cellalignment1631" headers="r5c1-t29 r1c3-t29">
<p><code>cap_rules</code></p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r6c1-t29" headers="r1c1-t29">
<p>Propagation</p>
</td>
<td class="cellalignment1631" headers="r6c1-t29 r1c2-t29">
<p><code>cap_proc_prop</code></p>
</td>
<td class="cellalignment1631" headers="r6c1-t29 r1c3-t29">
<p><code>sync_cap_prop</code></p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r7c1-t29" headers="r1c1-t29">
<p>Propagation Rule Set</p>
</td>
<td class="cellalignment1631" headers="r7c1-t29 r1c2-t29">
<p><code>prop_rules</code></p>
</td>
<td class="cellalignment1631" headers="r7c1-t29 r1c3-t29">
<p><code>prop_rules</code></p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r8c1-t29" headers="r1c1-t29">
<p>Source Queue</p>
</td>
<td class="cellalignment1631" headers="r8c1-t29 r1c2-t29">
<p><code>cap_proc_source</code></p>
</td>
<td class="cellalignment1631" headers="r8c1-t29 r1c3-t29">
<p><code>sync_cap_source</code></p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r9c1-t29" headers="r1c1-t29">
<p>Destination Queue</p>
</td>
<td class="cellalignment1631" headers="r9c1-t29 r1c2-t29">
<p><code>cap_proc_dest</code></p>
</td>
<td class="cellalignment1631" headers="r9c1-t29 r1c3-t29">
<p><code>sync_cap_dest</code></p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r10c1-t29" headers="r1c1-t29">
<p>Apply Process</p>
</td>
<td class="cellalignment1631" headers="r10c1-t29 r1c2-t29">
<p><code>apply_cap_proc</code></p>
</td>
<td class="cellalignment1631" headers="r10c1-t29 r1c3-t29">
<p><code>apply_sync_cap</code></p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r11c1-t29" headers="r1c1-t29">
<p>Apply Process Rule Set</p>
</td>
<td class="cellalignment1631" headers="r11c1-t29 r1c2-t29">
<p><code>apply_rules</code></p>
</td>
<td class="cellalignment1631" headers="r11c1-t29 r1c3-t29">
<p><code>apply_rules</code></p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<p>In <a href="#BEHIHIGH">Table 15-1</a>, notice that the Oracle Streams environment uses the same <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a>s before the switch and after the switch. Also, for the example in this section, assume that the <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a> is <code>db1.example.com</code> and the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> is <code>db2.example.com</code>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The example in this section assumes that the Oracle Streams environment only involves two databases. If you are using a <a href="strms_glossary.htm#CHDECDHJ"><span class="xrefglossterm">directed network</span></a> to send changes through multiple databases, then you might need to configure additional <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a>s and <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a>s for the new synchronous capture stream of changes, and you might need to drop additional propagations and queues that were used by the capture process stream.</div>
<p>To switch from a capture process to a synchronous capture, complete the following steps:</p>
<ol>
<li>
<p>In SQL*Plus, log in to the source database as the Oracle Streams administrator.</p>
<p>This example assumes that the Oracle Streams administrator is <code>strmadmin</code> at each database. See <a class="olink STREP200" href="../../server.112/e10705/prep_rep.htm#STREP200"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about creating an Oracle Streams administrator.</p>
</li>
<li id="BEHCJGAE">
<p>Stop the capture process.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.STOP_CAPTURE(
    capture_name =&gt; 'cap_proc');
END;
/
</pre></li>
<li>
<p>In SQL*Plus, log in to the destination database as the Oracle Streams administrator.</p>
</li>
<li id="BEHDHCEA">
<p>Create a commit-time queue for the <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> that will apply the changes that were captured by the synchronous capture.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; 'strmadmin.sync_cap_dest_qt',
    queue_name  =&gt; 'strmadmin.sync_cap_dest');
END;
/
</pre></li>
<li id="BEHEAFFI">
<p>Create an apply process that applies the changes in the queue created in Step&nbsp;<a href="#BEHDHCEA">4</a>. Ensure that the <code>apply_captured</code> parameter is set to <code>FALSE</code>. Also, ensure that the <code>rule_set_name</code> parameter specifies the rule set used by the existing apply process.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.CREATE_APPLY(
    queue_name     =&gt; 'strmadmin.sync_cap_dest',
    apply_name     =&gt; 'apply_sync_cap',
    rule_set_name  =&gt; 'strmadmin.apply_rules',
    apply_captured =&gt; FALSE);
END;
/
</pre>
<p>Ensure that the apply process is configured properly for your environment. Specifically, ensure that the new apply process is configured properly regarding the following items:</p>
<ul>
<li>
<p>Apply user</p>
</li>
<li>
<p>Apply handlers</p>
</li>
<li>
<p>Apply tag</p>
</li>
</ul>
<p>If appropriate, then ensure that the new apply process is configured in the same way as the existing apply process regarding these items.</p>
<p>See <a class="olink STREP206" href="../../server.112/e10705/capply.htm#STREP206"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about creating an apply process.</p>
</li>
<li>
<p>In SQL*Plus, log in to the source database as the Oracle Streams administrator.</p>
</li>
<li id="BEHCAEBI">
<p>Create a <a href="strms_glossary.htm#CBAEEFJE"><span class="xrefglossterm">commit-time queue</span></a> for the synchronous capture.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; 'strmadmin.sync_cap_source_qt',
    queue_name  =&gt; 'strmadmin.sync_cap_source');
END;
/
</pre>
<p>See <a class="olink STREP205" href="../../server.112/e10705/cprop.htm#STREP205"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about configuring queues.</p>
</li>
<li>
<p>Create a propagation that sends changes from the queue created in Step <a href="#BEHCAEBI">7</a> to the queue created in Step <a href="#BEHDHCEA">4</a>. Ensure that the <code>rule_set_name</code> parameter specifies the rule set used by the existing propagation.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_PROPAGATION_ADM.CREATE_PROPAGATION(
    propagation_name   =&gt; 'sync_cap_prop',
    source_queue       =&gt; 'strmadmin.sync_cap_source',
    destination_queue  =&gt; 'strmadmin.sync_cap_dest',
    destination_dblink =&gt; 'db2.example.com',
    rule_set_name      =&gt; 'strmadmin.prop_rules');
END;
/
</pre>
<p>See <a class="olink STREP205" href="../../server.112/e10705/cprop.htm#STREP205"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about creating propagations.</p>
</li>
<li>
<p>Create a synchronous capture. Ensure that the <code>queue_name</code> parameter specifies the queue created in Step <a href="#BEHCAEBI">7</a>. Also, ensure that the <code>rule_set_name</code> parameter specifies the rule set used by the existing capture process.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.CREATE_SYNC_CAPTURE(
    queue_name    =&gt; 'strmadmin.sync_cap_source',
    capture_name  =&gt; 'sync_cap',
    rule_set_name =&gt; 'strmadmin.capture_rules');
END;
/
</pre>
<p>The specified rule set must only contain rules that were created using the <code>ADD_TABLE_RULES</code> and <code>ADD_SUBSET_RULES</code> procedures in the <code>DBMS_STREAMS_ADM</code> package. If the current capture process rule set contains other types of rules, then create a rule set for the synchronous capture and use the <code>ADD_TABLE_RULES</code> and <code>ADD_SUBSET_RULES</code> procedures to add rules to the new rule set.</p>
<p>In addition, a synchronous capture cannot have a negative rule set. If the current capture process has a negative rule set, and you want the synchronous capture to behave the same as the capture process, then add rules to the positive synchronous capture rule set that result in the same behavior.</p>
<p>If the existing capture process uses a capture user that is not the Oracle Streams administrator, then ensure that you use the <code>capture_user</code> parameter in the <code>CREATE_SYNC_CAPTURE</code> procedure to specify the correct capture user for the new synchronous capture.</p>
<p>See <a class="olink STREP208" href="../../server.112/e10705/ccap.htm#STREP208"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about configuring synchronous capture.</p>
</li>
<li>
<p>Verify that the tables that are configured for synchronous capture are the same as the ones configured for the existing capture process by running the following query:</p>
<pre>
SELECT * FROM DBA_SYNC_CAPTURE_TABLES ORDER BY TABLE_OWNER, TABLE_NAME;
</pre>
<p>If any table is missing or not enabled, then use the <code>ADD_TABLE_RULES</code> or <code>ADD_SUBSET_RULES</code> procedure to add the table.</p>
</li>
<li id="BEHEJAHF">
<p>Prepare the replicated tables for instantiation. The replicated tables are the tables for which the synchronous capture captures changes.</p>
<p>For example, if the synchronous capture captures changes to the <code>hr.employees</code> and <code>hr.departments</code> tables, then run the following function:</p>
<pre>
SET SERVEROUTPUT ON
DECLARE
  tables       DBMS_UTILITY.UNCL_ARRAY;
  prepare_scn  NUMBER;
  BEGIN
    tables(1) := 'hr.departments';
    tables(2) := 'hr.employees';
    prepare_scn := DBMS_CAPTURE_ADM.PREPARE_SYNC_INSTANTIATION(
                      table_names =&gt; tables);
  DBMS_OUTPUT.PUT_LINE('Prepare SCN = ' || prepare_scn);
END;
/
</pre>
<p>The returned prepare system change number (SCN) is used in Steps <a href="#BEHEEIII">13</a>, <a href="#BEHBECID">17</a>, and <a href="#BEHEBEFH">18</a>. This example assumes that the prepare SCN is <code>2700000</code>.</p>
<p>All of the replicated tables must be included in one call to the <code>PREPARE_SYNC_INSTANTIATION</code> function.</p>
<p>See <a class="olink STREP114" href="../../server.112/e10705/instant.htm#STREP114"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for more information about preparing database objects for instantiation.</p>
</li>
<li>
<p>In SQL*Plus, log in to the destination database as the Oracle Streams administrator.</p>
</li>
<li id="BEHEEIII">
<p>Set the apply process that applies changes from the capture process to stop applying changes when it reaches the SCN returned in Step <a href="#BEHEJAHF">11</a> plus 1.</p>
<p>For example, if the prepare SCN is <code>2700000</code>, then run the following procedure to set the <code>maximum_scn</code> parameter to <code>2700001</code> (2700000 + 1).:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.SET_PARAMETER(
    apply_name   =&gt; 'apply_cap_proc',
    parameter    =&gt; 'maximum_scn',
    value        =&gt; '2700001');
END;
/
</pre></li>
<li>
<p>In SQL*Plus, log in to the source database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Start the capture process that you stopped in Step <a href="#BEHCJGAE">2</a>.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.START_CAPTURE(
    capture_name =&gt; 'cap_proc');
END;
/
</pre></li>
<li>
<p>In SQL*Plus, log in to the destination database as the Oracle Streams administrator.</p>
</li>
<li id="BEHBECID">
<p>Wait until the apply process that applies changes that were captured by the capture process has reached the SCN specified in Step <a href="#BEHEEIII">13</a>. When this event occurs, the apply process is automatically disabled with error ORA-26717 to indicate the SCN limit has reached.</p>
<p>To determine if the apply process has reached this point, query the <code>DBA_APPLY</code> view. In this example, run the following query:</p>
<pre>
SELECT 1 FROM DBA_APPLY 
   WHERE STATUS       = 'DISABLED' AND
         ERROR_NUMBER = 26717 AND 
         APPLY_NAME   = 'APPLY_CAP_PROC';
</pre>
<p>Do not proceed to the next step until this query returns a row.</p>
</li>
<li id="BEHEBEFH">
<p>Set the <a href="strms_glossary.htm#CHDHBBHE"><span class="xrefglossterm">instantiation SCN</span></a> for the replicated tables to the SCN value the SCN returned in Step <a href="#BEHEJAHF">11</a>.</p>
<p>In this example, run the following procedures:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN(
    source_object_name    =&gt; 'hr.employees',
    source_database_name  =&gt; 'db1.example.com',
    instantiation_scn     =&gt; 2700000);
END;
/

BEGIN
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN(
    source_object_name    =&gt; 'hr.departments',
    source_database_name  =&gt; 'db1.example.com',
    instantiation_scn     =&gt; 2700000);
END;
/
</pre>
<p>See <a class="olink STREP117" href="../../server.112/e10705/instant.htm#STREP117"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for more information about setting the instantiation SCN.</p>
</li>
<li>
<p>Start the apply process that you created in Step <a href="#BEHEAFFI">5</a>.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name =&gt; 'apply_sync_cap');
END;
/
</pre></li>
<li id="BEHJBHJJ">
<p>Drop the apply process that applied changes that were captured by the capture process.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.DROP_APPLY(
    apply_name =&gt; 'apply_cap_proc');
END;
/
</pre></li>
<li>
<p>If it is no longer needed, then drop the queue that was used by the apply process that you dropped in Step <a href="#BEHJBHJJ">20</a>.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.REMOVE_QUEUE(
    queue_name  =&gt; 'strmadmin.cap_proc_dest',
    drop_unused_queue_table =&gt; TRUE);
END;
/
</pre></li>
<li>
<p>In SQL*Plus, log in to the source database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Stop the capture process.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.STOP_CAPTURE(
    capture_name =&gt; 'cap_proc');
END;
/
</pre></li>
<li id="BEHFGHHI">
<p>Drop the capture process.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.DROP_CAPTURE(
    capture_name =&gt; 'cap_proc');
END;
/
</pre></li>
<li id="BEHDDIFG">
<p>Drop the propagation that sent changes that were captured by the capture process.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_PROPAGATION_ADM.DROP_PROPAGATION(
    propagation_name =&gt; 'cap_proc_prop');
END;
/
</pre></li>
<li>
<p>If it is no longer needed, then drop the queue that was used by the capture process and propagation that you dropped in Steps <a href="#BEHFGHHI">24</a> and <a href="#BEHDDIFG">25</a>.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.REMOVE_QUEUE(
    queue_name  =&gt; 'strmadmin.cap_proc_source',
    drop_unused_queue_table =&gt; TRUE);
END;
/
</pre></li>
</ol>
<p>If you have a bi-directional <a href="strms_glossary.htm#CHDCDAHE"><span class="xrefglossterm">replication</span></a> environment, then you can perform these steps independently to switch from a capture process to synchronous capture in both directions.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#i1006083">Chapter 2, "Oracle Streams Information Capture"</a></p>
</li>
<li>
<p><a href="strms_rules.htm#g1049257">Chapter 5, "How Rules Are Used in Oracle Streams"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="BEHGJDCF"></a>
<div id="STRMS655" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Switching from a Synchronous Capture to a Capture Process<a id="sthref695"></a><a id="sthref696"></a></h2>
<p>This section describes how to switch from a <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a> to a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>. You might decide to make this switch for one or more of the following reasons:</p>
<ul>
<li>
<p>You are currently capturing changes to a small number of tables but want to expand your environment to capture changes to a large number of tables, one or more schemas, or an entire database.</p>
</li>
<li>
<p>You want to use a <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> during change capture.</p>
</li>
<li>
<p>You want to capture data definition language (DDL) changes to database objects.</p>
</li>
</ul>
<p>This section uses an example to describe how to switch from a synchronous capture to a capture process. <a href="#BEHJGHCH">Table 15-2</a> shows the Oracle Streams components in the sample environment before the switch and after the switch.</p>
<div id="STRMS656" class="tblhruleformal">
<p class="titleintable"><a id="sthref697"></a><a id="BEHJGHCH"></a>Table 15-2 Sample Switch From a Synchronous Capture to a Capture Process</p>
<table class="cellalignment1634" title="Sample Switch From a Synchronous Capture to a Capture Process" summary="This table shows each Streams component in the environment before the switch from a synchronous capture to a capture process and after the switch." dir="ltr">
<thead>
<tr class="cellalignment1625">
<th class="cellalignment1635" id="r1c1-t32">Oracle Streams Component</th>
<th class="cellalignment1635" id="r1c2-t32">Before Switch</th>
<th class="cellalignment1635" id="r1c3-t32">After Switch</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r2c1-t32" headers="r1c1-t32">
<p>Synchronous Capture</p>
</td>
<td class="cellalignment1631" headers="r2c1-t32 r1c2-t32">
<p><code>sync_proc</code></p>
</td>
<td class="cellalignment1631" headers="r2c1-t32 r1c3-t32">
<p>None</p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r3c1-t32" headers="r1c1-t32">
<p>Synchronous Capture Rule Set</p>
</td>
<td class="cellalignment1631" headers="r3c1-t32 r1c2-t32">
<p><code>cap_rules</code></p>
</td>
<td class="cellalignment1631" headers="r3c1-t32 r1c3-t32">
<p>None</p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r4c1-t32" headers="r1c1-t32">
<p>Capture Process</p>
</td>
<td class="cellalignment1631" headers="r4c1-t32 r1c2-t32">
<p>None</p>
</td>
<td class="cellalignment1631" headers="r4c1-t32 r1c3-t32">
<p><code>cap_proc</code></p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r5c1-t32" headers="r1c1-t32">
<p>Capture Process Rule Set</p>
</td>
<td class="cellalignment1631" headers="r5c1-t32 r1c2-t32">
<p>None</p>
</td>
<td class="cellalignment1631" headers="r5c1-t32 r1c3-t32">
<p><code>cap_rules</code></p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r6c1-t32" headers="r1c1-t32">
<p>Propagation</p>
</td>
<td class="cellalignment1631" headers="r6c1-t32 r1c2-t32">
<p><code>sync_cap_prop</code></p>
</td>
<td class="cellalignment1631" headers="r6c1-t32 r1c3-t32">
<p><code>cap_proc_prop</code></p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r7c1-t32" headers="r1c1-t32">
<p>Propagation Rule Set</p>
</td>
<td class="cellalignment1631" headers="r7c1-t32 r1c2-t32">
<p><code>prop_rules</code></p>
</td>
<td class="cellalignment1631" headers="r7c1-t32 r1c3-t32">
<p><code>prop_rules</code></p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r8c1-t32" headers="r1c1-t32">
<p>Source Queue</p>
</td>
<td class="cellalignment1631" headers="r8c1-t32 r1c2-t32">
<p><code>sync_cap_source</code></p>
</td>
<td class="cellalignment1631" headers="r8c1-t32 r1c3-t32">
<p><code>cap_proc_source</code></p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r9c1-t32" headers="r1c1-t32">
<p>Destination Queue</p>
</td>
<td class="cellalignment1631" headers="r9c1-t32 r1c2-t32">
<p><code>sync_cap_dest</code></p>
</td>
<td class="cellalignment1631" headers="r9c1-t32 r1c3-t32">
<p><code>cap_proc_dest</code></p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r10c1-t32" headers="r1c1-t32">
<p>Apply Process</p>
</td>
<td class="cellalignment1631" headers="r10c1-t32 r1c2-t32">
<p><code>apply_sync_cap</code></p>
</td>
<td class="cellalignment1631" headers="r10c1-t32 r1c3-t32">
<p><code>apply_cap_proc</code></p>
</td>
</tr>
<tr class="cellalignment1625">
<td class="cellalignment1631" id="r11c1-t32" headers="r1c1-t32">
<p>Apply Process Rule Set</p>
</td>
<td class="cellalignment1631" headers="r11c1-t32 r1c2-t32">
<p><code>apply_rules</code></p>
</td>
<td class="cellalignment1631" headers="r11c1-t32 r1c3-t32">
<p><code>apply_rules</code></p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<p>In <a href="#BEHJGHCH">Table 15-2</a>, notice that the Oracle Streams environment uses the same <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a>s before the switch and after the switch. Also, for the example in this section, assume that the <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a> is <code>db1.example.com</code> and the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> is <code>db2.example.com</code>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The example in this section assumes that the Oracle Streams environment only involves two databases. If you are using a <a href="strms_glossary.htm#CHDECDHJ"><span class="xrefglossterm">directed network</span></a> to send changes through multiple databases, then you might need to configure additional <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a>s and <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a>s for the new capture process stream of changes, and you might need to drop additional propagations and queues that were used by the synchronous capture stream.</div>
<p>To switch from a synchronous capture to a capture process, complete the following steps:</p>
<ol>
<li>
<p>Ensure that the source database is running in <code>ARCHIVELOG</code> mode. See <a href="strms_adcapture.htm#i1007010">"ARCHIVELOG Mode and a Capture Process"</a> and <a class="olink ADMIN008" href="../../server.112/e25494/archredo.htm#ADMIN008"><span class="italic">Oracle Database Administrator's Guide</span></a> for more information.</p>
</li>
<li>
<p>In SQL*Plus, log in to the destination database as the Oracle Streams administrator.</p>
<p>This example assumes that the Oracle Streams administrator is <code>strmadmin</code> at each database. See <a class="olink STREP200" href="../../server.112/e10705/prep_rep.htm#STREP200"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about creating an Oracle Streams administrator.</p>
</li>
<li id="BEHCEIDH">
<p>Create the queue for the <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> that will apply the changes that were captured by the capture process.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; 'strmadmin.cap_proc_dest_qt',
    queue_name  =&gt; 'strmadmin.cap_proc_dest');
END;
/
</pre>
<p>See <a class="olink STREP205" href="../../server.112/e10705/cprop.htm#STREP205"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about configuring queues.</p>
</li>
<li id="BEHJJGIA">
<p>Create an apply process that applies the changes in the queue created in Step&nbsp;<a href="#BEHCEIDH">3</a>. Ensure that the <code>apply_captured</code> parameter is set to <code>TRUE</code>. Also, ensure that the <code>rule_set_name</code> parameter specifies the rule set used by the existing apply process.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.CREATE_APPLY(
    queue_name     =&gt; 'strmadmin.cap_proc_dest',
    apply_name     =&gt; 'apply_cap_proc',
    rule_set_name  =&gt; 'strmadmin.apply_rules',
    apply_captured =&gt; TRUE);
END;
/
</pre>
<p>Ensure that the apply process is configured properly for your environment. Specifically, ensure that the new apply process is configured properly regarding the following items:</p>
<ul>
<li>
<p>Apply user</p>
</li>
<li>
<p>Apply handlers</p>
</li>
<li>
<p>Apply tag</p>
</li>
</ul>
<p>If appropriate, then ensure that the new apply process is configured in the same way as the existing apply process regarding these items.</p>
<p>See <a class="olink STREP206" href="../../server.112/e10705/capply.htm#STREP206"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about creating an apply process.</p>
</li>
<li>
<p>Stop the apply process that applies changes captured by the synchronous capture.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.STOP_APPLY(
    apply_name =&gt; 'apply_sync_cap');
END;
/
</pre></li>
<li>
<p>In SQL*Plus, log in to the source database as the Oracle Streams administrator.</p>
</li>
<li id="BEHGECBB">
<p>Create the queue for the capture process.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; 'strmadmin.cap_proc_source_qt',
    queue_name  =&gt; 'strmadmin.cap_proc_source');
END;
/
</pre></li>
<li>
<p>Create a propagation that sends changes from the queue created in Step <a href="#BEHGECBB">7</a> to the queue created in Step <a href="#BEHCEIDH">3</a>. Ensure that the <code>rule_set_name</code> parameter specifies the rule set used by the existing propagation.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_PROPAGATION_ADM.CREATE_PROPAGATION(
    propagation_name   =&gt; 'cap_proc_prop',
    source_queue       =&gt; 'strmadmin.cap_proc_source',
    destination_queue  =&gt; 'strmadmin.cap_proc_dest',
    destination_dblink =&gt; 'db2.example.com',
    rule_set_name      =&gt; 'strmadmin.prop_rules');
END;
/
</pre>
<p>See <a class="olink STREP205" href="../../server.112/e10705/cprop.htm#STREP205"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about creating propagations.</p>
</li>
<li id="BEHHHBJF">
<p>Create a capture process. Ensure that the parameters are set properly in the <code>CREATE_CAPTURE</code> procedure:</p>
<ul>
<li>
<p>Set the <code>queue_name</code> parameter to the queue created in Step <a href="#BEHGECBB">7</a>.</p>
</li>
<li>
<p>Set the <code>rule_set_name</code> parameter to the rule set used by the existing synchronous capture.</p>
</li>
<li>
<p>If the existing synchronous capture uses a capture user that is not the Oracle Streams administrator, then set the <code>capture_user</code> parameter to the correct capture user for the new capture process.</p>
</li>
</ul>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.CREATE_CAPTURE(
    queue_name    =&gt; 'strmadmin.cap_proc_source',
    capture_name  =&gt; 'cap_proc',
    rule_set_name =&gt; 'strmadmin.cap_rules');
END;
/
</pre>
<p>See <a class="olink STREP209" href="../../server.112/e10705/ccap.htm#STREP209"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for more information about configuring a capture process.</p>
</li>
<li>
<p>Prepare the replicated tables for instantiation. The replicated tables are the tables for which the capture process captures changes.</p>
<p>For example, if the capture process captures changes to the <code>hr.employees</code> and <code>hr.departments</code> tables, then run the following procedures:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.PREPARE_TABLE_INSTANTIATION(
    table_name           =&gt; 'hr.employees',
    supplemental_logging =&gt; 'keys');
END;
/

BEGIN
  DBMS_CAPTURE_ADM.PREPARE_TABLE_INSTANTIATION(
    table_name           =&gt; 'hr.departments',
    supplemental_logging =&gt; 'keys');
END;
/
</pre>
<p>See <a class="olink STREP114" href="../../server.112/e10705/instant.htm#STREP114"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for more information about preparing database objects for instantiation.</p>
</li>
<li>
<p>Lock all of the replicated tables in <code>SHARE</code> <code>MODE</code>.</p>
<p>In this example, run the following SQL statement:</p>
<pre>
LOCK TABLE hr.employees, hr.departments IN SHARE MODE;
</pre></li>
<li id="BEHBECFJ">
<p>Determine the current system change number (SCN) by running the following query:</p>
<pre>
SELECT CURRENT_SCN FROM V$DATABASE;
</pre>
<p>The returned switch SCN is used in Steps <a href="#BEHGHEIH">15</a> and <a href="#BEHCJJCG">18</a>. This example assumes that the switch SCN is <code>2700000</code>.</p>
</li>
<li>
<p>Run a <code>COMMIT</code> statement to release the lock on the replicated tables:</p>
<pre>
COMMIT;
</pre></li>
<li>
<p>In SQL*Plus, log in to the destination database as the Oracle Streams administrator.</p>
</li>
<li id="BEHGHEIH">
<p>Set the apply process that applies changes from the synchronous capture to stop applying changes when it reaches the SCN returned in Step <a href="#BEHBECFJ">12</a> plus 1.</p>
<p>For example, if the switch SCN is <code>2700000</code>, then run the following procedure to set the <code>maximum_scn</code> parameter to <code>2700001</code> (2700000 + 1):</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.SET_PARAMETER(
    apply_name   =&gt; 'apply_sync_cap',
    parameter    =&gt; 'maximum_scn',
    value        =&gt; '2700001');
END;
/
</pre></li>
<li>
<p>Start the apply process that applies changes from the synchronous capture.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name =&gt; 'apply_sync_cap');
END;
/
</pre></li>
<li id="BEHEBEFA">
<p>Wait until the apply process that applies changes that were captured by the synchronous capture has reached the SCN specified in Step <a href="#BEHGHEIH">15</a>. When this event occurs, the apply process is automatically disabled with error ORA-26717 to indicate the SCN limit has reached.</p>
<p>To determine if the apply process has reached this point, query the <code>DBA_APPLY</code> view. In this example, run the following query:</p>
<pre>
SELECT 1 FROM DBA_APPLY 
   WHERE STATUS       = 'DISABLED' AND
         ERROR_NUMBER = 26717 AND 
         APPLY_NAME   = 'APPLY_SYNC_CAP';
</pre>
<p>Do not proceed to the next step until this query returns a row.</p>
</li>
<li id="BEHCJJCG">
<p>Set the <a href="strms_glossary.htm#CHDHBBHE"><span class="xrefglossterm">instantiation SCN</span></a> for the replicated tables to the SCN value returned in Step <a href="#BEHBECFJ">12</a>.</p>
<p>In this example, run the following procedures:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN(
    source_object_name    =&gt; 'hr.employees',
    source_database_name  =&gt; 'db1.example.com',
    instantiation_scn     =&gt; 2700000);
END;
/

BEGIN
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN(
    source_object_name    =&gt; 'hr.departments',
    source_database_name  =&gt; 'db1.example.com',
    instantiation_scn     =&gt; 2700000);
END;
/
</pre>
<p>See <a class="olink STREP117" href="../../server.112/e10705/instant.htm#STREP117"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for more information about setting the instantiation SCN.</p>
</li>
<li>
<p>Start the apply process that you created in Step <a href="#BEHJJGIA">4</a>.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name =&gt; 'apply_cap_proc');
END;
/
</pre></li>
<li id="BEHHDBFE">
<p>Drop the apply process that applied changes that were captured by the synchronous capture.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.DROP_APPLY(
    apply_name =&gt; 'apply_sync_cap');
END;
/
</pre></li>
<li>
<p>If it is no longer needed, then drop the queue that was used by the apply process that you dropped in Step <a href="#BEHHDBFE">20</a>.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.REMOVE_QUEUE(
    queue_name              =&gt; 'strmadmin.sync_cap_dest',
    drop_unused_queue_table =&gt; TRUE);
END;
/
</pre></li>
<li>
<p>In SQL*Plus, log in to the source database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Start the capture process that you created in Step <a href="#BEHHHBJF">9</a>.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.START_CAPTURE(
    capture_name =&gt; 'cap_proc');
END;
/
</pre></li>
<li id="BEHHAABI">
<p>Drop the synchronous capture.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_CAPTURE_ADM.DROP_CAPTURE(
    capture_name =&gt; 'sync_cap');
END;
/
</pre></li>
<li id="BEHGGDIJ">
<p>Drop the propagation that sent changes that were captured by the synchronous capture.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_PROPAGATION_ADM.DROP_PROPAGATION(
    propagation_name =&gt; 'sync_cap_prop');
END;
/
</pre></li>
<li>
<p>If it is no longer needed, then drop the queue that was used by the synchronous capture and propagation that you dropped in Steps <a href="#BEHHAABI">24</a> and <a href="#BEHGGDIJ">25</a>.</p>
<p>In this example, run the following procedure:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.REMOVE_QUEUE(
    queue_name              =&gt; 'strmadmin.sync_cap_source',
    drop_unused_queue_table =&gt; TRUE);
END;
/
</pre></li>
</ol>
<p>If you have a bi-directional <a href="strms_glossary.htm#CHDCDAHE"><span class="xrefglossterm">replication</span></a> environment, then you can perform these steps independently to switch from a synchronous capture to a capture process in both directions.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#i1006083">Chapter 2, "Oracle Streams Information Capture"</a></p>
</li>
<li>
<p><a href="strms_rules.htm#g1049257">Chapter 5, "How Rules Are Used in Oracle Streams"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1624">
<tr>
<td class="cellalignment1631">
<table class="cellalignment1629">
<tr>
<td class="cellalignment1628"><a href="strms_mintro.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1628"><a href="strms_mprop.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1633">
<table class="cellalignment1627">
<tr>
<td class="cellalignment1628"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1628"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1628"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1628"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1628"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1628"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
