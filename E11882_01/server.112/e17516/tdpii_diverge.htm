<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Comparing and Converging Data</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 033" />
<meta name="dcterms.created" content="2011-07-28T22:42:0Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database 2 Day + Data Replication and Integration Guide" />
<meta name="dcterms.identifier" content="E17516-08" />
<meta name="dcterms.isVersionOf" content="TDPII" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2007, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="tdpii_messaging.htm" title="Previous" type="text/html" />
<link rel="Next" href="index.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e17516.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">13/14</span> <!-- End Header --><a id="CHDIHFBH"></a><a id="TDPII090"></a>
<h1 class="chapter"><span class="secnum">10</span> Comparing and Converging Data</h1>
<p><a id="sthref792"></a><a id="sthref793"></a><a id="sthref794"></a><a id="sthref795"></a>This chapter describes how to compare data in shared database objects at two different databases. It also describes how to converge divergent data in shared database objects.</p>
<p>This chapter contains the following sections:</p>
<ul>
<li>
<p><a href="#BABBAFCB">About Comparing and Converging Data in Different Databases</a></p>
</li>
<li>
<p><a href="#BABDBGFC">Tutorial: Preparing to Compare and Converge Data</a></p>
</li>
<li>
<p><a href="#BABCDFGB">Tutorial: Comparing Data in Two Different Databases</a></p>
</li>
<li>
<p><a href="#BABFHACE">Tutorial: Converging Divergent Data</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tdpii_reppit.htm#BEHHGGIB">Chapter 7, "Replicating Data Using Materialized Views"</a></p>
</li>
<li>
<p><a href="tdpii_repcont.htm#BABEFAFI">Chapter 4, "Replicating Data Using Oracle Streams"</a></p>
</li>
<li>
<p><a class="olink ARPLS868" href="../../appdev.112/e40758/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a></p>
</li>
<li>
<p><a class="olink STREP146" href="../../server.112/e10705/man_comp.htm#STREP146"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a></p>
</li>
</ul>
</div>
<a id="BABBAFCB"></a><a id="TDPII091"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">About Comparing and Converging Data in Different Databases<a id="sthref796"></a></h2>
<p>You can share database objects at two or more databases. When copies of the same database object exist at multiple databases, the database object is a <span class="bold">shared database object</span>. Shared database objects might be maintained by data replication. For example, materialized views or Oracle Streams components might replicate the database objects and maintain them at multiple databases. A custom application might also maintain shared database objects. Typically, replication environments share database objects that contain data, such as tables, and other types of databases objects, such as indexes.</p>
<p>When a change is made to a shared database object at one database, the change is transferred to and made at each of the other databases that share the database object. In this way, the replication environment keeps the shared database object synchronized at each database.</p>
<p>Sometimes, shared database objects that contain data can become inconsistent at different databases. That is, the data might diverge in the different instances of the shared database object. For example, if the database object is a table, then one instance of the table might have more rows than another instance of the table, or two instances of the table might have different data in the same rows.</p>
<p>When shared database objects diverge in an Oracle Streams replication environment, it is usually for one of the following reasons:</p>
<ul>
<li>
<p>Data changes are not being captured at one or more of the databases.</p>
</li>
<li>
<p>Data changes are being captured, but they are not being transferred from one database to another.</p>
</li>
<li>
<p>Data changes are being captured and transferred from one database to another, but they are not being made to shared database objects at the other databases.</p>
</li>
</ul>
<p>Common causes of data divergence are network problems, incorrect configurations, or user errors. When shared database objects diverge in a replication environment that uses materialized views, it might be because there is a problem with the materialized view refresh.</p>
<p><a id="sthref797"></a>The <code>DBMS_COMPARISON</code> package enables you to compare database objects at different databases and identify differences. This package also enables you to converge the database objects so that they are consistent at different databases. The <code>DBMS_COMPARISON</code> package is an Oracle-supplied PL/SQL package that is always installed with Oracle Database.</p>
<p>The <code>DBMS_COMPARISON</code> package can compare and converge the following types of database objects:</p>
<ul>
<li>
<p>Tables</p>
</li>
<li>
<p>Single-table views</p>
</li>
<li>
<p>Materialized views</p>
</li>
<li>
<p>Synonyms for tables, single-table views, and materialized views</p>
</li>
</ul>
<p>Database objects of different types can be compared and converged at different databases. For example, a table at one database and a materialized view at another database can be compared and converged.</p>
<p>In the examples in this guide, the shared database object has the same name at the two databases, and the entire database object is compared and converged. However, the <code>DBMS_COMPARISON</code> package provides flexibility for differences in the shared database object at different databases. The database objects being compared do not need to have the same name. In addition, column names can also be different in the database objects, if the corresponding columns are the same data type. You can compare and converge the entire shared database object or subsets of columns and rows.</p>
<p>To create a comparison, use the <code>CREATE_COMPARISON</code> procedure in the <code>DBMS_COMPARISON</code> package. This procedure identifies one or more index columns in the shared database object. The <code>DBMS_COMPARISON</code> package must be able to identify at least one column that it can use as an index column. If the specified database object does not have a column that can be used as an index column, then the <code>CREATE_COMPARISON</code> procedure cannot create a comparison for the database object.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If your environment has shared database objects that have diverged, then you should investigate the cause of the problem and correct it. Although the <code>DBMS_COMPARISON</code> package can compare and converge shared database objects, it is better if these database objects do not diverge.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ARPLS868" href="../../appdev.112/e40758/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for detailed information about the <code>DBMS_COMPARISON</code> package</p>
</li>
<li>
<p><a class="olink STREP146" href="../../server.112/e10705/man_comp.htm#STREP146"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about using the advanced features of the <code>DBMS_COMPARISON</code> package</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="BABDBGFC"></a><a id="TDPII092"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Tutorial: Preparing to Compare and Converge Data</h2>
<p>Suppose you share the <code>hr.departments</code> table in two databases. You want to compare this table at these databases to see if their data is consistent. If the tables have diverged at the two databases, then you want to converge them to make them consistent.</p>
<p>Meet the following prerequisites to complete this tutorial:</p>
<ul>
<li>
<p>Configure network connectivity so that the two databases can communicate with each other. See <a class="olink ADMQS004" href="../../server.112/e10897/network.htm#ADMQS004"><span class="italic">Oracle Database 2 Day DBA</span></a> for information about configuring network connectivity between databases.</p>
</li>
<li>
<p>Ensure that the <code>hr</code> sample schema is installed on both databases. The <code>hr</code> sample schema is installed by default with Oracle Database.</p>
</li>
</ul>
<p>In this example, the global names of the databases are <code>ii1.example.com</code> and <code>ii2.example.com</code>, but you can substitute any two databases in your environment that meet the prerequisites.</p>
<p class="orderedlisttitle">To prepare for comparison and convergence of the hr.departments table at the ii1.example.com and ii2.example.com databases:&nbsp;</p>
<ol>
<li>
<p><a id="BABCFHIG"></a>For the purposes of this example, make the <code>hr.departments</code> table diverge at the two databases:</p>
<ol>
<li>
<p>On a command line, open SQL*Plus and connect to the <code>ii2.example.com</code> database as <code>hr</code> user.</p>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p>Delete the department in the <code>hr.departments</code> table with the <code>department_id</code> equal to&nbsp;<code>270</code>:</p>
<pre>
DELETE FROM hr.departments WHERE department_id=270;
COMMIT;
</pre></li>
<li>
<p>Modify the data in a row in the <code>hr.departments</code> table:</p>
<pre>
UPDATE hr.departments SET manager_id=114 WHERE department_id=10;
COMMIT;
</pre></li>
<li>
<p>Insert a row into the <code>hr.departments</code> table:</p>
<pre>
INSERT INTO hr.departments VALUES(280, 'Bean Counters', 108, 2700);
COMMIT;
</pre></li>
<li>
<p>Exit SQL*Plus:</p>
<pre>
EXIT;
</pre></li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
Usually, Step <a href="#BABCFHIG">1</a> is not required. It is included in this example to ensure that the <code>hr.departments</code> table diverges at the two databases.</div>
</li>
<li>
<p><a id="BABBJGAB"></a>Create a database link from the <code>ii1.example.com</code> database to the <code>ii2.example.com</code> database.</p>
<p>The database link should connect from an administrative user in <code>ii1.example.com</code> to an administrative user schema in <code>ii2.example.com</code>. The administrative user at both databases should have the necessary privileges to access and modify the <code>hr.departments</code> table and the necessary privileges to run subprograms in the <code>DBMS_COMPARISON</code> package. If you are not sure which user has these privileges, then use <code>SYSTEM</code> user. Also, both the name and the service name of the database link must be <code>ii2.example.com</code>. See <a href="tdpii_common_ii.htm#BGBGIACD">"Tutorial: Creating a Database Link"</a> for instructions.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="BABCDFGB"></a><a id="TDPII093"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Tutorial: Comparing Data in Two Different Databases<a id="sthref799"></a><a id="sthref800"></a><a id="sthref801"></a><a id="sthref802"></a></h2>
<p>This example continues the scenario described in <a href="#BABDBGFC">"Tutorial: Preparing to Compare and Converge Data"</a>. Complete the steps in that topic before continuing.</p>
<p>You can use the <code>CREATE_COMPARISON</code> procedure in the <code>DBMS_COMPARISON</code> package to define a comparison of a shared database object at two different databases. Once the comparison is defined, you can use the <code>COMPARE</code> function in this package to compare the database object specified in the comparison at the current point in time. You can run the <code>COMPARE</code> function multiple times for a specific comparison. Each time you run the function, it results one or more scans of the database objects, and each scan has its own scan ID.</p>
<p class="orderedlisttitle">To compare the entire hr.departments table at the ii1.example.com and ii2.example.com databases:&nbsp;</p>
<ol>
<li>
<p>On a command line, open SQL*Plus and connect to the <code>ii1.example.com</code> database as the administrative user who owns the database link created in <a href="#BABDBGFC">"Tutorial: Preparing to Compare and Converge Data"</a>. For example, if <code>SYSTEM</code> user owns the database link, then connect as <code>SYSTEM</code> user:</p>
<pre>
sqlplus system@ii1.example.com
Enter password: <span class="italic">password</span>
</pre>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p><a id="BABJIHBD"></a>Run the <code>CREATE_COMPARISON</code> procedure to create the comparison for the <code>hr.departments</code> table:</p>
<pre>
BEGIN
  DBMS_COMPARISON.CREATE_COMPARISON(
    comparison_name =&gt; 'compare_departments',
    schema_name     =&gt; 'hr',
    object_name     =&gt; 'departments',
    dblink_name     =&gt; 'ii2.example.com');
END;
/
</pre>
<p>Note that the name of the new comparison is <code>compare_departments</code>. This comparison is owned by the user who runs the <code>CREATE_COMPARISON</code> procedure.</p>
</li>
<li>
<p><a id="BABFHCBI"></a>Run the <code>COMPARE</code> function to compare the <code>hr.departments</code> table at the two databases:</p>
<pre>
SET SERVEROUTPUT ON
DECLARE
  consistent   BOOLEAN;
  scan_info    DBMS_COMPARISON.COMPARISON_TYPE;
BEGIN
  consistent := DBMS_COMPARISON.COMPARE(
                  comparison_name =&gt; 'compare_departments',
                  scan_info       =&gt; scan_info,
                  perform_row_dif =&gt; TRUE);
  DBMS_OUTPUT.PUT_LINE('Scan ID: '||scan_info.scan_id);
  IF consistent=TRUE THEN
    DBMS_OUTPUT.PUT_LINE('No differences were found.');
  ELSE
    DBMS_OUTPUT.PUT_LINE('Differences were found.');
  END IF;
END;
/

<span class="bold">Scan ID: 1</span>
<span class="bold">Differences were found.</span>
 
<span class="bold">PL/SQL procedure successfully completed.</span>
</pre>
<p>Specify the name of the comparison created in Step <a href="#BABJIHBD">2</a> for the <code>comparison_name</code> parameter.</p>
<p>The function prints the scan ID for the comparison. The scan ID is important when you are querying data dictionary views for information about the comparison and when you are converging the database objects.</p>
<p>The function also prints whether differences were found in the table at the two databases:</p>
<ul>
<li>
<p>If the function prints <code>'No differences were found'</code>, then the table is consistent at the two databases.</p>
</li>
<li>
<p>If the function prints <code>'Differences were found'</code>, then the table has diverged at the two databases.</p>
</li>
</ul>
</li>
<li>
<p><a id="BABFBHHJ"></a>Make a note of the scan ID returned by the function in the previous step. In this example, assume the scan ID is <code>1</code>.</p>
</li>
<li>
<p><a id="sthref804"></a><a id="sthref805"></a>If differences were found in Step <a href="#BABFHCBI">3</a>, then run the following query to show the number of differences found:</p>
<pre>
COLUMN OWNER HEADING 'Comparison Owner' FORMAT A16
COLUMN COMPARISON_NAME HEADING 'Comparison Name' FORMAT A20
COLUMN SCHEMA_NAME HEADING 'Schema Name' FORMAT A11
COLUMN OBJECT_NAME HEADING 'Object Name' FORMAT A11
COLUMN CURRENT_DIF_COUNT HEADING 'Differences' FORMAT 9999999
 
SELECT c.OWNER, 
       c.COMPARISON_NAME, 
       c.SCHEMA_NAME, 
       c.OBJECT_NAME, 
       s.CURRENT_DIF_COUNT 
  FROM DBA_COMPARISON c, DBA_COMPARISON_SCAN s
  WHERE c.COMPARISON_NAME = s.COMPARISON_NAME AND
        c.OWNER           = s.OWNER AND
        s.SCAN_ID         = 1;
</pre>
<p>Specify the scan ID you recorded in Step <a href="#BABFBHHJ">4</a> in the <code>WHERE</code> clause of the query.</p>
<p>The output will be similar to the following:</p>
<pre>
<span class="bold">Comparison Owner Comparison Name      Schema Name Object Name Differences</span>
<span class="bold">---------------- -------------------- ----------- ----------- -----------</span>
<span class="bold">SYSTEM           COMPARE_DEPARTMENTS  HR          DEPARTMENTS           3</span>
</pre></li>
<li>
<p><a id="sthref806"></a><a id="sthref807"></a><a id="sthref808"></a>To see which rows were different in the database object being compared, run the following query:</p>
<pre>
COLUMN COLUMN_NAME HEADING 'Index Column' FORMAT A15
COLUMN INDEX_VALUE HEADING 'Index Value' FORMAT A15
COLUMN LOCAL_ROWID HEADING 'Local Row Exists?' FORMAT A20
COLUMN REMOTE_ROWID HEADING 'Remote Row Exists?' FORMAT A20
 
SELECT c.COLUMN_NAME,
       r.INDEX_VALUE, 
       DECODE(r.LOCAL_ROWID,
                NULL, 'No',
                      'Yes') LOCAL_ROWID,
       DECODE(r.REMOTE_ROWID,
                NULL, 'No',
                      'Yes') REMOTE_ROWID
  FROM DBA_COMPARISON_COLUMNS c,
       DBA_COMPARISON_ROW_DIF r,
       DBA_COMPARISON_SCAN s
  WHERE c.COMPARISON_NAME = 'COMPARE_DEPARTMENTS' AND
        r.SCAN_ID         = s.SCAN_ID AND
        s.PARENT_SCAN_ID  = 1 AND
        r.STATUS          = 'DIF' AND
        c.INDEX_COLUMN    = 'Y' AND
        c.COMPARISON_NAME = r.COMPARISON_NAME AND
        c.OWNER           = r.OWNER
  ORDER BY r.INDEX_VALUE;
</pre>
<p>In the <code>WHERE</code> clause, specify the name of the comparison and the scan ID for the comparison. In this example, the name of the comparison is <code>compare_departments</code> and the scan ID is <code>1</code>.</p>
<p>The output will be similar to the following:</p>
<pre>
<span class="bold">Index Column    Index Value     Local Row Exists?    Remote Row Exists?</span>
<span class="bold">--------------- --------------- -------------------- --------------------</span>
<span class="bold">DEPARTMENT_ID   10              Yes                  Yes</span>
<span class="bold">DEPARTMENT_ID   270             Yes                  No</span>
<span class="bold">DEPARTMENT_ID   280             No                   Yes</span>
</pre>
<p>This output shows the index column for the table being compared and the index value for each row that is different in the shared database object. In this example, the index column is the primary key column for the <code>hr.departments</code> table (<code>department_id</code>). The output also shows the type of difference for each row:</p>
<ul>
<li>
<p>If <code>Local</code> <code>Row</code> <code>Exists?</code> and <code>Remote</code> <code>Row</code> <code>Exists?</code> are both <code>Yes</code> for a row, then the row exists in both instances of the database object, but the data in the row is different.</p>
</li>
<li>
<p>If <code>Local</code> <code>Row</code> <code>Exists?</code> is <code>Yes</code> and <code>Remote</code> <code>Row</code> <code>Exists?</code> is <code>No</code> for a row, then the row exists in the local database object but not in the remote database object.</p>
</li>
<li>
<p>If <code>Local</code> <code>Row</code> <code>Exists?</code> is <code>No</code> and <code>Remote</code> <code>Row</code> <code>Exists?</code> is <code>Yes</code> for a row, then the row exists in the remote database object but not in the local database object.</p>
</li>
</ul>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="BABFHACE"></a><a id="TDPII094"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Tutorial: Converging Divergent Data<a id="sthref809"></a><a id="sthref810"></a><a id="sthref811"></a></h2>
<p>This example continues the scenario described in <a href="#BABCDFGB">"Tutorial: Comparing Data in Two Different Databases"</a>. Complete the steps in that topic before continuing.</p>
<p>When a shared database object has diverged at two different databases, you can use the <code>CONVERGE</code> procedure in the <code>DBMS_COMPARISON</code> package to converge the two instances of the database object. After the <code>CONVERGE</code> procedure runs successfully, the shared database object is consistent at the two databases. To run the <code>CONVERGE</code> procedure, you must specify the following information:</p>
<ul>
<li>
<p>The name of an existing comparison created using the <code>CREATE_COMPARISON</code> procedure in the <code>DBMS_COMPARISON</code> package</p>
</li>
<li>
<p>The scan ID of the comparison that you want to converge</p>
</li>
</ul>
<p>The scan ID contains information about the differences that will be converged. In this example, the name of the comparison is <code>compare_departments</code> and the scan ID is&nbsp;<code>1</code>.</p>
<p>Also, when you run the <code>CONVERGE</code> procedure, you must specify which database "wins" when the shared database object is converged. If you specify that the local database wins, then the data in the database object at the local database replaces the data in the database object at the remote database when the data is different. If you specify that the remote database wins, then the data in the database object at the remote database replaces the data in the database object at the local database when the data is different. In this example, the local database <code>ii1.example.com</code> wins.</p>
<p class="orderedlisttitle">To converge divergent data in the hr.departments table at the ii1.example.com and ii2.example.com databases:&nbsp;</p>
<ol>
<li>
<p>On a command line, open SQL*Plus and connect to the <code>ii1.example.com</code> database as the administrative user who owns the database link created in <a href="#BABDBGFC">"Tutorial: Preparing to Compare and Converge Data"</a>. For example, if the <code>SYSTEM</code> user owns the database link, then connect as the <code>SYSTEM</code> user:</p>
<pre>
sqlplus system@ii1.example.com
Enter password: <span class="italic">password</span>
</pre>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p>Run the <code>CONVERGE</code> procedure to converge the <code>hr.departments</code> table at the two databases:</p>
<pre>
SET SERVEROUTPUT ON
DECLARE
  scan_info    DBMS_COMPARISON.COMPARISON_TYPE;
BEGIN
  DBMS_COMPARISON.CONVERGE(
    comparison_name  =&gt; 'compare_departments',
    scan_id          =&gt; 1,
    scan_info        =&gt; scan_info,
    converge_options =&gt; DBMS_COMPARISON.CMP_CONVERGE_LOCAL_WINS);
  DBMS_OUTPUT.PUT_LINE('Local Rows Merged: '||scan_info.loc_rows_merged);
  DBMS_OUTPUT.PUT_LINE('Remote Rows Merged: '||scan_info.rmt_rows_merged);
  DBMS_OUTPUT.PUT_LINE('Local Rows Deleted: '||scan_info.loc_rows_deleted);
  DBMS_OUTPUT.PUT_LINE('Remote Rows Deleted: '||scan_info.rmt_rows_deleted);
END;
/

<span class="bold">Local Rows Merged: 0</span>
<span class="bold">Remote Rows Merged: 2</span>
<span class="bold">Local Rows Deleted: 0</span>
<span class="bold">Remote Rows Deleted: 1</span>

<span class="bold">PL/SQL procedure successfully completed.</span>
</pre></li>
</ol>
<p>The <code>CONVERGE</code> procedure synchronizes the portion of the database object compared by the specified scan and returns information about the changes it made. Some scans might compare a subset of the database object. In this example, the specified scan compared the entire table. So, the entire table is synchronized, assuming no new differences appeared after the comparison scan completed.</p>
<p>The local table wins in this example because the <code>converge_options</code> parameter is set to <code>DBMS_COMPARISON.CMP_CONVERGE_LOCAL_WINS</code> in the procedure. That is, for the rows that are different in the two databases, the rows at the local database replace the corresponding rows at the remote database. If some rows exist at the remote database but not at the local database, then the extra rows at the remote database are deleted. If instead you want the remote database to win, then set the <code>converge_options</code> parameter to <code>DBMS_COMPARISON.CMP_CONVERGE_REMOTE_WINS</code> in the procedure.</p>
<p><a id="sthref813"></a><a id="sthref814"></a>In addition, if you run the <code>CONVERGE</code> procedure on a shared database object that is part of an Oracle Streams replication environment, then you might not want the changes made by the procedure to be replicated to other databases. In this case, you can set the following parameters in the <code>CONVERGE</code> procedure to values that will prevent the changes from being replicated:</p>
<ul>
<li>
<p><code>local_converge_tag</code></p>
</li>
<li>
<p><code>remote_converge_tag</code></p>
</li>
</ul>
<p>When one of these parameters is set to a non-<code>NULL</code> value, a tag is set in the session that makes the changes during convergence. The <code>local_converge_tag</code> parameter sets the tag in the session at the local database, while the <code>remote_converge_tag</code> parameter sets the tag in the session at the remote database. If you do not want the changes made by the <code>CONVERGE</code> procedure to be replicated, then set these parameters to a value that will prevent Oracle Streams capture processes and synchronous captures from capturing the changes.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tdpii_repcont.htm#BABICHGF">"About Tags for Avoiding Change Cycling"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1402">
<tr>
<td class="cellalignment1409">
<table class="cellalignment1407">
<tr>
<td class="cellalignment1406"><a href="tdpii_messaging.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1406"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2007, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1411">
<table class="cellalignment1405">
<tr>
<td class="cellalignment1406"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1406"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1406"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1406"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1406"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1406"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
