<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Sending Messages Using Oracle Streams Advanced Queuing</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 033" />
<meta name="dcterms.created" content="2011-07-28T22:41:18Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database 2 Day + Data Replication and Integration Guide" />
<meta name="dcterms.identifier" content="E17516-08" />
<meta name="dcterms.isVersionOf" content="TDPII" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2007, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="tdpii_adpit.htm" title="Previous" type="text/html" />
<link rel="Next" href="tdpii_diverge.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e17516.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">12/14</span> <!-- End Header --><a id="CHDDFFEA"></a><a id="TDPII026"></a>
<h1 class="chapter"><span class="secnum">9</span> Sending Messages Using Oracle Streams Advanced Queuing</h1>
<p><a id="sthref624"></a><a id="sthref625"></a>This chapter describes how to configure an Oracle Streams Advanced Queuing (AQ) environment that sends messages between databases and applications. It also describes administering, monitoring, and troubleshooting a messaging environment once it is in place.</p>
<p>This chapter contains the following sections:</p>
<ul>
<li>
<p><a href="#CHDIJFHB">About Messaging</a></p>
</li>
<li>
<p><a href="#CHDGIEEC">Preparing for Messaging</a></p>
</li>
<li>
<p><a href="#CHDBACBE">Tutorial: Sending Messages Between Oracle Databases</a></p>
</li>
<li>
<p><a href="#CHDGEHCF">Tutorial: Configuring Message Notifications</a></p>
</li>
<li>
<p><a href="#CHDEBJHA">Modifying Queues</a></p>
</li>
<li>
<p><a href="#BABBBFAI">Modifying Queue Tables</a></p>
</li>
<li>
<p><a href="#CHDBGJHH">Modifying Propagations</a></p>
</li>
<li>
<p><a href="#CHDDICBF">Monitoring a Messaging Environment</a></p>
</li>
<li>
<p><a href="#CHDDGAFD">Troubleshooting a Messaging Environment</a></p>
</li>
</ul>
<a id="CHDIJFHB"></a><a id="TDPII027"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">About Messaging<a id="sthref626"></a><a id="sthref627"></a><a id="sthref628"></a><a id="sthref629"></a><a id="sthref630"></a><a id="sthref631"></a><a id="sthref632"></a></h2>
<p>A messaging environment stores information in queues. <span class="bold">Enqueuing</span> is the process of placing messages into queues. <span class="bold">Dequeuing</span> is the process of retrieving messages from queues.</p>
<p>The information in queues can be used to complete tasks, or it can be processed by applications. A messaging environment allows applications to communicate with each other asynchronously. That is, one application does not need to wait for another application to complete a particular task. Asynchronous communication means that a messaging system has minimal impact on the functionality of the applications that use the system.</p>
<p>For example, when one application wants to communicate with another application, it can put messages in a queue. The messages can be stored in the queue until the other application retrieves them. In fact, one application might not be running while another application is enqueuing messages for it to process later. The messages might instruct the retrieving application to perform an action, or the messages might contain information that must be processed by the retrieving application.</p>
<p>When an organization has several different systems that must communicate with each other, a messaging environment can be a good solution. The various systems might be in different locations, some might be older than others, and some might run on different platforms. Messaging provides a standard, reliable way to transport critical information between these systems.</p>
<p>The messaging feature of Oracle Database is called Oracle Streams Advanced Queuing (AQ). Oracle Streams AQ provides the advantages of messaging, and it also integrates the messaging system with Oracle Database. Therefore, Oracle Streams AQ provides the reliability, scalability, security, and manageability of Oracle Database.</p>
<p><a id="sthref633"></a><a id="sthref634"></a><a id="sthref635"></a>You can use Oracle Streams AQ to configure a messaging environment that sends messages between queues in a single database or between queues in different databases. A messaging environment that sends messages between queues includes the following components:</p>
<ul>
<li>
<p><span class="bold">Queues:</span> Abstract storage units that store messages in a messaging environment</p>
</li>
<li>
<p><span class="bold">Producers:</span> Users or applications that enqueue messages</p>
</li>
<li>
<p><span class="bold">Propagations:</span> Oracle Scheduler jobs that copy messages from one queue to another according to a set schedule</p>
</li>
<li>
<p><span class="bold">Consumers:</span> Users or applications that dequeue messages</p>
</li>
</ul>
<p>A single user or application can act as both a producer and a consumer. In a messaging environment, both <span class="bold">subscribers</span> and <span class="bold">messaging clients</span> are consumers. Both subscribers and messaging clients are mechanisms that are authorized to dequeue messages from a queue, and both can use rules to determine which messages to dequeue.</p>
<p>Oracle Streams AQ provides many features, some of which are beyond the scope of this guide. The following topics provide an overview of some of the features of Oracle Streams AQ:</p>
<ul>
<li>
<p><a href="#CHDDACEF">About Message Ordering</a></p>
</li>
<li>
<p><a href="#CHDCFHBF">About Message Modes</a></p>
</li>
<li>
<p><a href="#CHDFEFHI">About Message Notifications</a></p>
</li>
<li>
<p><a href="#CHDEJBBD">About Propagations</a></p>
</li>
<li>
<p><a href="#BABCICDC">About Oracle Messaging Gateway</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tdpii_intro2ii.htm#CFHFDDIG">"When to Send Messages Between Databases"</a></p>
</li>
<li>
<p><a class="olink STRMS004" href="../../server.112/e17069/strms_apply.htm#STRMS004"><span class="italic">Oracle Streams Concepts and Administration</span></a> for more information about messaging clients</p>
</li>
<li>
<p><a class="olink ADQUE" href="../e11013/toc.htm"><span class="italic">Oracle Streams Advanced Queuing User's Guide</span></a> for detailed information about subscribers and all of the other features of Oracle Streams AQ</p>
</li>
</ul>
</div>
<a id="CHDDACEF"></a><a id="TDPII028"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Message Ordering<a id="sthref636"></a><a id="sthref637"></a><a id="sthref638"></a></h3>
<p><span class="bold">Message ordering</span> determines the order in which messages are dequeued. Oracle Streams Advanced Queuing (AQ) provides the following options for message ordering:</p>
<ul>
<li>
<p><span class="bold">Enqueue time:</span> Messages are dequeued in the same order that they were enqueued. This option is sometimes called first in first out (FIFO) ordering. For example, banking applications often use this ordering so that financial transactions are always ordered according to the time when they occurred.</p>
</li>
<li>
<p><span class="bold">Priority:</span> A priority is specified for messages during enqueuing, and messages are dequeued based on their priority. For example, shipping companies might use this ordering for messages because some packages have higher priority than others.</p>
</li>
<li>
<p><span class="bold">Commit time:</span> Messages are dequeued based on when the transaction that enqueued the messages committed. Commit-time ordering is typically used when the messages result in database changes with transaction dependencies. For example, an application that handles sales for a company might use commit-time ordering when the messages result in changes to several database tables that have dependencies.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CHDCFHBF"></a><a id="TDPII029"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Message Modes<a id="sthref639"></a><a id="sthref640"></a><a id="sthref641"></a><a id="sthref642"></a><a id="sthref643"></a><a id="sthref644"></a><a id="sthref645"></a><a id="sthref646"></a></h3>
<p>Oracle Streams Advanced Queuing (AQ) supports the following <span class="bold">message modes</span>:</p>
<ul>
<li>
<p><span class="bold">Persistent messaging:</span> Messages are always stored on disk in a database table called a <span class="bold">queue table</span>. This type of storage is sometimes called <span class="bold">persistent queue</span> storage.</p>
</li>
<li>
<p><span class="bold">Buffered messaging:</span> Messages are stored in memory but can spill to a queue table under certain conditions. This type of storage is sometimes called <span class="bold">buffered queue</span> storage.</p>
</li>
</ul>
<p>Buffered messaging provides better performance, but it does not support some messaging features, such as message retention. Message retention lets you specify the amount of time a message is retained in the queue table after being dequeued. In addition, when a database goes down unexpectedly, persistent messages are retained on disk, but buffered messages can be lost because they are stored in memory.</p>
<p>Message retention provides an audit trail, which might be required for some organizations. For example, while messages are stored in the queue table, users and applications can run queries to gather information about the messages. For example, a sales application might gather this information to generate a report on orders.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ADQUE" href="../e11013/toc.htm"><span class="italic">Oracle Streams Advanced Queuing User's Guide</span></a> for information about the differences between persistent messaging and buffered messaging</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CHDFEFHI"></a><a id="TDPII030"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Message Notifications<a id="sthref647"></a><a id="sthref648"></a></h3>
<p>Oracle Streams Advanced Queuing (AQ) can notify an application and users when a message of interest is enqueued. <span class="bold">Notifications</span> enable applications and users to do their work without constantly checking a queue for new messages. Notifications can be sent to an application using PL/SQL, Java Message Service (JMS), or Oracle Call Interface (OCI) callback functions. Notification can also be sent to a specified e-mail address or HTTP post. In addition, notifications can be presented in either <code>RAW</code> data type form or XML form. Applications and users do not need to be connected to a database to receive notifications. When they are notified that a message of interest has appeared in a queue, they can connect to the database and check the queue.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDGIEEC">"Preparing for Messaging"</a></p>
</li>
<li>
<p><a href="#CHDGEHCF">"Tutorial: Configuring Message Notifications"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CHDEJBBD"></a><a id="TDPII031"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Propagations<a id="sthref649"></a><a id="sthref650"></a><a id="sthref651"></a><a id="sthref652"></a><a id="sthref653"></a><a id="sthref654"></a></h3>
<p><span class="bold">Propagation</span> is the process of sending messages from one queue to another. These queues can be in the same database or in different databases. Propagations are not a required part of a messaging system. Propagations enable applications to communicate with each other even if they are not connected to the same database or same queue. Also, using multiple propagations, you can send the same messages from one queue to several other queues.</p>
<p>Propagations use database links to send messages between queues at different databases. A <span class="bold">database link</span> is a pointer that defines a one-way communication path from an Oracle database to another database. Propagation is performed by an Oracle Scheduler job called a <span class="bold">propagation job</span>. A propagation schedule determines how often a propagation sends messages, and you control the schedule for each propagation job.</p>
<p>Oracle Streams Advanced Queuing (AQ) supports both queue-to-queue or queue-to-database link (queue-to-dblink) propagations. A <span class="bold">queue-to-queue propagation</span> always has its own exclusive propagation job to send messages from the source queue to the destination queue. Therefore, the propagation schedule of each queue-to-queue propagation can be managed separately. Multiple queue-to-queue propagations can use a single database link. Use queue-to-queue propagation when you want fine-grained control over multiple propagations that send messages from a single queue, and each propagation should use a different schedule.</p>
<p>In contrast, a <span class="bold">queue-to-dblink propagation</span> shares a propagation job with other queue-to-dblink propagations from the same source queue that use the same database link. If several propagations send messages from a single source queue to several queues at the remote database, then these propagations share the same propagation schedule. Any change to the propagation schedule affects all of the queue-to-dblink propagations from the same source queue that use the database link. Use queue-to-dblink propagation when you want bulk control over multiple propagations that send messages from a single queue, and all of the propagations should use the same schedule.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDGIEEC">"Preparing for Messaging"</a></p>
</li>
<li>
<p><a href="#CHDBACBE">"Tutorial: Sending Messages Between Oracle Databases"</a></p>
</li>
<li>
<p><a href="#CHDBGJHH">"Modifying Propagations"</a></p>
</li>
<li>
<p><a href="tdpii_common_ii.htm#BGBGIACD">"Tutorial: Creating a Database Link"</a></p>
</li>
<li>
<p><a class="olink STRMS155" href="../../server.112/e17069/strms_prop.htm#STRMS155"><span class="italic">Oracle Streams Concepts and Administration</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABCICDC"></a><a id="TDPII032"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Oracle Messaging Gateway<a id="sthref655"></a><a id="sthref656"></a><a id="sthref657"></a></h3>
<p>Oracle Messaging Gateway integrates an Oracle Streams Advanced Queuing (AQ) messaging system with other messaging systems, such as IBM Websphere MQ (formerly called MQSeries) and TIBCO Rendezvous. This integration enables Oracle Database applications that use Oracle Streams AQ to communicate bidirectionally and seamlessly with other applications that use non-Oracle messaging systems.</p>
<p>Messaging Gateway uses a gateway agent to send messages from Oracle Streams AQ queues to queues in non-Oracle messaging systems. The gateway agent also enables Oracle Streams AQ queues to receive messages from non-Oracle messaging systems.</p>
<p>Messaging Gateway supports automatic type conversion for Oracle Streams AQ types that can be directly mapped to a non-Oracle messaging system. For types that cannot be directly mapped, you can define custom transformations to map the types. Once defined, custom transformations are performed automatically during propagation.</p>
<p>Messaging Gateway supports the native message formats of the messaging systems. Oracle Streams AQ messages can have <code>RAW</code> or any Oracle object type payload supported by Oracle Streams AQ. IBM Websphere MQ messages can be text or byte messages. TIBCO Rendezvous messages can be any TIBCO Rendezvous wire format data type.</p>
<p>Oracle Streams AQ queues can be securely accessed through the Internet. Messaging Gateway provides secure, Internet-enabled messaging between Oracle Streams AQ queues and queues in a non-Oracle messaging system.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ADQUE1700" href="../../server.112/e11013/mg_intro.htm#ADQUE1700"><span class="italic">Oracle Streams Advanced Queuing User's Guide</span></a> for detailed information about the Oracle Messaging Gateway and for information about how to use it</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDGIEEC"></a><a id="TDPII033"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Preparing for Messaging<a id="sthref658"></a><a id="sthref659"></a><a id="sthref660"></a><a id="sthref661"></a><a id="sthref662"></a><a id="sthref663"></a><a id="sthref664"></a></h2>
<p>This topic describes actions that are required to prepare your databases for a messaging environment.</p>
<p class="orderedlisttitle">To prepare your databases for a messaging environment:&nbsp;</p>
<ol>
<li>
<p>Set the <a class="olink REFRN10065" href="../../server.112/e40402/initparams098.htm#REFRN10065"><code>GLOBAL_NAMES</code></a> initialization parameter to <code>TRUE</code> at each database involved in the messaging environment. See <a href="tdpii_common_ii.htm#BGBEEDCD">"Setting the GLOBAL_NAMES Initialization Parameter to TRUE"</a> for instructions.</p>
</li>
<li>
<p>Configure network connectivity so that a database that sends messages can communicate with a database that receives messages. See <a class="olink ADMQS004" href="../../server.112/e10897/network.htm#ADMQS004"><span class="italic">Oracle Database 2 Day DBA</span></a> for information about configuring network connectivity between databases.</p>
</li>
<li>
<p>Configure an Oracle Streams administrator at each database involved in the messaging environment. See <a href="tdpii_common_ii.htm#BGBHDJHF">"Tutorial: Configuring an Oracle Streams Administrator"</a> for instructions.</p>
</li>
<li>
<p>Ensure that the Oracle Streams pool is large enough to accommodate the queues created for the messaging environment. Each queue requires at least 10 MB of memory. The Oracle Streams pool is part of the System Global Area (SGA). You can manage the Oracle Streams pool by setting the <a class="olink REFRN10285" href="../../server.112/e40402/initparams143.htm#REFRN10285"><code>MEMORY_TARGET</code></a> initialization parameter (Automatic Memory Management), the <a class="olink REFRN10256" href="../../server.112/e40402/initparams236.htm#REFRN10256"><code>SGA_TARGET</code></a> initialization parameter (Automatic Shared Memory Management), or the <a class="olink REFRN10243" href="../../server.112/e40402/initparams255.htm#REFRN10243"><code>STREAMS_POOL_SIZE</code></a> initialization parameter. See <a class="olink STREP202" href="../../server.112/e10705/prep_rep.htm#STREP202"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for more information about the Oracle Streams pool.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDIJFHB">"About Messaging"</a></p>
</li>
<li>
<p><a href="#CHDBACBE">"Tutorial: Sending Messages Between Oracle Databases"</a></p>
</li>
<li>
<p><a href="#CHDGEHCF">"Tutorial: Configuring Message Notifications"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CHDBACBE"></a><a id="TDPII034"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Tutorial: Sending Messages Between Oracle Databases<a id="sthref666"></a></h2>
<p>The example in this topic involves a business that enters orders in an Oracle database at headquarters. When an order is entered, the business wants to use a messaging system to send the order ID and order date to an Oracle database in a warehouse in a different location. These messages alert employees at the warehouse about the orders so that they can fill and ship them. The employees at the warehouse have access to the data at headquarters to find detailed information about any particular order.</p>
<p>This example uses the <code>oe</code> sample schema for its order-entry schema. The <code>oe</code> sample schema is installed by default with Oracle Database.</p>
<p>In this example, the global name of the database at headquarters is <code>ii1.example.com</code>, and the global name of the database at the warehouse is <code>ii2.example.com</code>. However, you can substitute any two databases in your environment to complete the example.</p>
<p><a href="#BABHIEBJ">Figure 9-1</a> provides an overview of the messaging environment created in this example.</p>
<div class="figure">
<p class="titleinfigure"><a id="BABHIEBJ"></a><a id="TDPII305"></a>Figure 9-1 Sample Messaging Environment That Sends Messages Between Databases</p>
<img width="507" height="453" src="img/tdpii507.gif" alt="Description of Figure 9-1 follows" /><br />
<a id="sthref667" href="img_text/tdpii507.htm">Description of "Figure 9-1 Sample Messaging Environment That Sends Messages Between Databases"</a><br />
<br /></div>
<!-- class="figure" -->
<p>Before you start this example, complete the tasks described in <a href="#CHDGIEEC">"Preparing for Messaging"</a>.</p>
<p class="itemizedlisttitle">To configure a messaging system that sends messages about orders from the ii1.example.com database to the ii2.example.com database:&nbsp;</p>
<ul>
<li>
<p><a href="#CHDEFIBH">Task 1: Creating the Message Type at Each Database</a></p>
</li>
<li>
<p><a href="#CHDHBBDJ">Task 2: Configuring the Queues and Propagation Between Them</a></p>
</li>
<li>
<p><a href="#CHDBIECC">Task 3: Configuring a Message Enqueuing Mechanism</a></p>
</li>
<li>
<p><a href="#CHDHGJAG">Task 4: Configuring a Messaging Client to Dequeue Messages</a></p>
</li>
<li>
<p><a href="#CHDBIDGD">Task 5: Enqueuing Messages</a></p>
</li>
<li>
<p><a href="#CHDJEJEE">Task 6: Dequeuing Messages</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tdpii_intro2ii.htm#CFHFDDIG">"When to Send Messages Between Databases"</a></p>
</li>
</ul>
</div>
<a id="CHDEFIBH"></a><a id="TDPII035"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 1: Creating the Message Type at Each Database<a id="sthref669"></a><a id="sthref670"></a></h3>
<p>Create a user-defined type to define the information that you want to send about orders. This example creates the <code>strmadmin.order_id_date</code> type for messages that will contain the order ID and order date.</p>
<p class="orderedlisttitle">To create the strmadmin.order_id_date type at each database:&nbsp;</p>
<ol>
<li>
<p>Prepare your environment for messaging if you have not already done so. See <a href="#CHDGIEEC">"Preparing for Messaging"</a>.</p>
</li>
<li>
<p><a id="sthref672"></a>In Oracle Enterprise Manager, log in to the <code>ii1.example.com</code> database as the Oracle Streams administrator.</p>
</li>
<li>
<p><a id="BABBCJBH"></a>Go to the Database Home page.</p>
</li>
<li>
<p><a id="BABIGJJE"></a>Click <span class="bold">Schema</span> to open the Schema subpage.</p>
</li>
<li>
<p><a id="CHDIFEDC"></a>Click <span class="bold">Object Types</span> in the User Defined Types section.</p>
</li>
<li>
<p>On the Object Types page, click <span class="bold">Create</span> to open the Create Object Type page.</p>
<img width="666" height="358" src="img/tdpii_create_object_type.gif" alt="Description of tdpii_create_object_type.gif follows" /><br />
<a id="sthref673" href="img_text/tdpii_create_object_type.htm">Description of the illustration tdpii_create_object_type.gif</a><br />
<br /></li>
<li>
<p>Enter <code>order_id_date</code> in the Name field.</p>
</li>
<li>
<p>Ensure that <code>strmadmin</code> is selected in the Schema field.</p>
</li>
<li>
<p>Ensure that <span class="bold">Predefined Type</span> is selected for Datatype in the Attributes section.</p>
</li>
<li>
<p>Click <span class="bold">Add</span> in the Attributes section to open the Add Predefined Type Attributes page.</p>
<img width="666" height="173" src="img/tdpii_add_type_attribute.gif" alt="Description of tdpii_add_type_attribute.gif follows" /><br />
<a id="sthref674" href="img_text/tdpii_add_type_attribute.htm">Description of the illustration tdpii_add_type_attribute.gif</a><br />
<br /></li>
<li>
<p>To add an attribute:</p>
<ol>
<li>
<p>Enter <code>order_id</code> in the Name field.</p>
</li>
<li>
<p>Select <code>NUMBER</code> for Type.</p>
</li>
<li>
<p>Enter <code>12</code> in the Length field.</p>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
</li>
</ol>
</li>
<li>
<p>On the Create Object Type page, ensure that <span class="bold">Predefined Type</span> is selected in the Attributes section.</p>
</li>
<li>
<p>Click <span class="bold">Add</span> in the Attributes section to open the Add Predefined Type Attributes page.</p>
</li>
<li>
<p>To add an attribute:</p>
<ol>
<li>
<p>Enter <code>order_date</code> in the Name field.</p>
</li>
<li>
<p>Select <code>VARCHAR2</code> for Type.</p>
</li>
<li>
<p>Enter <code>100</code> in the Length field.</p>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
</li>
</ol>
</li>
<li>
<p><a id="CHDDBDAD"></a>On the Create Object Type page, click <span class="bold">OK</span> to create the type.</p>
</li>
<li>
<p>Log in to the <code>ii2.example.com</code> database as the Oracle Streams administrator in Enterprise Manager.</p>
</li>
<li>
<p>Complete Steps <a href="#BABBCJBH">3</a> through <a href="#CHDDBDAD">15</a> at the <code>ii2.example.com</code> database so that both databases have the <code>strmadmin.order_id_date</code> type.</p>
</li>
<li>
<p>Complete the steps in <a href="#CHDHBBDJ">"Task 2: Configuring the Queues and Propagation Between Them"</a> to continue this extended example.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also use the <a class="olink SQLRF01506" href="../../server.112/e41084/statements_8001.htm#SQLRF01506"><code>CREATE</code> <code>TYPE</code></a> SQL statement to create a type.</div>
</div>
<!-- class="sect2" -->
<a id="CHDHBBDJ"></a><a id="TDPII037"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 2: Configuring the Queues and Propagation Between Them<a id="sthref675"></a></h3>
<p>Create a queue at each database, and create a propagation to send messages about orders from the queue at the <code>ii1.example.com</code> database to the queue at the <code>ii2.example.com</code> database.</p>
<p class="orderedlisttitle">To create a propagation:&nbsp;</p>
<ol>
<li>
<p>Create a queue named <code>streams_queue</code> in the schema of the Oracle Streams administrator at both the <code>ii1.example.com</code> and <code>ii2.example.com</code> databases. See <a href="tdpii_common_ii.htm#CHDJHCAI">"Creating an ANYDATA Queue"</a> for instructions.</p>
</li>
<li>
<p><a id="CHDDIHDB"></a>Create a database link named <code>ii2.example.com</code> in the Oracle Streams administrator schema at <code>ii1.example.com</code>. Configure the database link to connect to the Oracle Streams administrator schema at <code>ii2.example.com</code>. The service name of the database link must be <code>ii2.example.com</code>. See <a href="tdpii_common_ii.htm#BGBGIACD">"Tutorial: Creating a Database Link"</a> for instructions.</p>
</li>
<li>
<p>In Oracle Enterprise Manager, log in to the <code>ii1.example.com</code> database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Under High Availability, click the number link in <span class="bold">Streams Components</span>.</p>
</li>
<li>
<p>On the Manage Replication page, click <span class="bold">Setup Propagation</span> in Related Links to open the Setup Propagation page.</p>
<img width="1004" height="264" src="img/tdpii_setup_propgation.gif" alt="Description of tdpii_setup_propgation.gif follows" /><br />
<a id="sthref677" href="img_text/tdpii_setup_propgation.htm">Description of the illustration tdpii_setup_propgation.gif</a><br />
<br /></li>
<li>
<p>Enter <code>send_orders</code> in the Propagation Name field.</p>
</li>
<li>
<p>Enter <code>strmadmin.streams_queue</code> in the Source Queue field. This queue is the queue at the <code>ii1.example.com</code> database into which messages about orders will be enqueued.</p>
</li>
<li>
<p>Enter the name of the database link that you created in Step <a href="#CHDDIHDB">2</a> in the Destination Database Link field. In this example, the database link name is <code>ii2.example.com</code>.</p>
</li>
<li>
<p>Enter <code>strmadmin.streams_queue</code> in the Destination Queue field. This is the queue at the <code>ii2.example.com</code> database to which messages about orders will be sent.</p>
</li>
<li>
<p>Leave the Positive Rule Set and Negative Rule Set fields empty. When a propagation does not have a rule set, it sends all of the messages in the source queue to the destination queue.</p>
</li>
<li>
<p>Enable the <span class="bold">Queue to Queue Propagation</span> option.</p>
</li>
<li>
<p>Click <span class="bold">OK</span> to create the propagation.</p>
</li>
<li>
<p>Complete the steps in <a href="#CHDBIECC">"Task 3: Configuring a Message Enqueuing Mechanism"</a> to continue this extended example.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also use the <a class="olink ARPLS333" href="../../appdev.112/e40758/d_prop_a.htm#ARPLS333"><code>DBMS_PROPAGATION_ADM.CREATE_PROPAGATION</code></a> procedure to create a propagation.</div>
</div>
<!-- class="sect2" -->
<a id="CHDBIECC"></a><a id="TDPII038"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 3: Configuring a Message Enqueuing Mechanism<a id="sthref678"></a><a id="sthref679"></a><a id="sthref680"></a></h3>
<p>Configure a mechanism to enqueue the messages in your messaging system. Typically, an application creates and enqueues messages that will be dequeued and processed by another application. For simplicity, this example creates a trigger called <code>enqueue_orders</code> to enqueue a message that includes the order ID and order date of an order. The trigger fires when an order is inserted into the <code>oe.orders</code> table.</p>
<p class="orderedlisttitle">To configure a message enqueuing mechanism:&nbsp;</p>
<ol>
<li>
<p><a id="BABFAHIF"></a>Grant the <code>EXECUTE</code> privilege on the <code>DBMS_STREAMS_MESSAGING</code> package to the Oracle Streams administrator.</p>
<p>This example configures a trigger that runs the <code>ENQUEUE</code> procedure in the <code>DBMS_STREAMS_MESSAGING</code> package. The user who runs this procedure in a trigger must have explicit <code>EXECUTE</code> privilege on the package that contains the procedure. The privilege cannot be granted through a role. Therefore, the Oracle Streams administrator must be granted explicit <code>EXECUTE</code> privilege on the package.</p>
<ol>
<li>
<p><a id="sthref682"></a>Log in to Enterprise Manager as an administrative user who can grant privileges to the <code>strmadmin</code> user. For example, you can log in as a user with <code>SYSDBA</code> privilege. In this example, log in to the <code>ii1.example.com</code> database.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Click <span class="bold">Server</span> to open the Server subpage.</p>
</li>
<li>
<p>Click <span class="bold">Users</span> in the Security section.</p>
<p>The Users page appears.</p>
</li>
<li>
<p>Select the <code>STRMADMIN</code> user.</p>
</li>
<li>
<p>Click <span class="bold">Edit</span>.</p>
<p>The Edit User page appears, showing the General subpage.</p>
</li>
<li>
<p>Click <span class="bold">Object Privileges</span> to open the Object Privileges subpage.</p>
<img width="804" height="227" src="img/tdpii_edit_user.gif" alt="Description of tdpii_edit_user.gif follows" /><br />
<a id="sthref683" href="img_text/tdpii_edit_user.htm">Description of the illustration tdpii_edit_user.gif</a><br />
<br /></li>
<li>
<p>Select <span class="bold">Package</span> in the Select Object Type list.</p>
</li>
<li>
<p>Click <span class="bold">Add</span> to open the Add Package Object Privileges page.</p>
<img width="558" height="399" src="img/tdpii_add_package_privs.gif" alt="Description of tdpii_add_package_privs.gif follows" /><br />
<a id="sthref684" href="img_text/tdpii_add_package_privs.htm">Description of the illustration tdpii_add_package_privs.gif</a><br />
<br /></li>
<li>
<p>Enter <code>SYS.DBMS_STREAMS_MESSAGING</code> in the Select Package Objects field.</p>
</li>
<li>
<p>Move <span class="bold">EXECUTE</span> from the Available Privileges list to the Selected Privileges list.</p>
</li>
<li>
<p>Click <span class="bold">OK</span> to add the privilege.</p>
</li>
<li>
<p>Click <span class="bold">Apply</span> to grant the privilege.</p>
</li>
<li>
<p>Log out of Enterprise Manager.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also use the <a class="olink SQLRF01603" href="../../server.112/e41084/statements_9013.htm#SQLRF01603"><code>GRANT</code></a> SQL statement to grant privileges to a user.</div>
</li>
<li>
<p><a id="sthref685"></a>Create a trigger in the <code>ii1.example.com</code> database to enqueue a message automatically when a change is made to the <code>oe.orders</code> table.</p>
<ol>
<li>
<p>Log in to <code>ii1.example.com</code> database in Enterprise Manager as the Oracle Streams administrator.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Click <span class="bold">Schema</span> to open the Schema subpage.</p>
</li>
<li>
<p>Click <span class="bold">Triggers</span> in the Programs section.</p>
</li>
<li>
<p>On the Triggers page, click <span class="bold">Create</span>.</p>
<p>The Create Trigger page appears, showing the General subpage.</p>
<img width="752" height="417" src="img/tdpii_create_trigger.gif" alt="Description of tdpii_create_trigger.gif follows" /><br />
<a id="sthref686" href="img_text/tdpii_create_trigger.htm">Description of the illustration tdpii_create_trigger.gif</a><br />
<br /></li>
<li>
<p>Enter <code>enqueue_orders</code> in the Name field.</p>
</li>
<li>
<p>Ensure that <code>strmadmin</code> is entered in the Schema field.</p>
</li>
<li>
<p><a id="sthref687"></a>Enter the following in the Trigger Body field:</p>
<pre>
DECLARE  
  message  strmadmin.order_id_date;  
BEGIN  
  message := strmadmin.order_id_date(  
                order_id   =&gt; :NEW.order_id,  
                order_date =&gt; TO_CHAR(:NEW.order_date));  
  DBMS_STREAMS_MESSAGING.ENQUEUE (  
    queue_name =&gt; 'strmadmin.streams_queue',  
    payload    =&gt; ANYDATA.CONVERTOBJECT(message));  
END;
</pre></li>
<li>
<p>Click <span class="bold">Event</span> to open the Event subpage.</p>
</li>
<li>
<p>Ensure that <span class="bold">Table</span> is selected in the Trigger On list.</p>
</li>
<li>
<p>Enter <code>oe.orders</code> in the Table (Schema.Table) field.</p>
</li>
<li>
<p>Select <span class="bold">After</span> for <span class="bold">Fire Trigger</span>.</p>
</li>
<li>
<p>Select <span class="bold">Insert</span> for Event. In this example, only Insert should be selected because the messages track new orders, not changes to existing orders.</p>
</li>
<li>
<p>Click <span class="bold">Advanced</span>.</p>
</li>
<li>
<p>Select <span class="bold">Trigger for each row</span>.</p>
</li>
<li>
<p>Enter <code>OLD</code> in the Old as field in the Referencing section.</p>
</li>
<li>
<p>Enter <code>NEW</code> in the New as field in the Referencing section.</p>
</li>
<li>
<p>Click <span class="bold">OK</span> to create the trigger.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also use the <a class="olink SQLRF01405" href="../../server.112/e41084/statements_7004.htm#SQLRF01405"><code>CREATE</code> <code>TRIGGER</code></a> SQL statement to create a trigger.</div>
</li>
<li>
<p>Complete the steps in <a href="#CHDHGJAG">"Task 4: Configuring a Messaging Client to Dequeue Messages"</a> to continue this extended example.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CHDHGJAG"></a><a id="TDPII039"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 4: Configuring a Messaging Client to Dequeue Messages<a id="sthref688"></a><a id="sthref689"></a><a id="sthref690"></a><a id="sthref691"></a><a id="sthref692"></a></h3>
<p>Configure a mechanism to dequeue the messages in your messaging system. Typically, an application dequeues and processes messages that were created by another application. For simplicity, this example creates a PL/SQL procedure called <code>dequeue_orders</code> to dequeue messages that include the order ID and order date of an order. You call the procedure to dequeue messages in this example, but an application can run such a procedure periodically.</p>
<p class="orderedlisttitle">To configure a messaging client to dequeue messages:&nbsp;</p>
<ol>
<li>
<p>Grant <code>EXECUTE</code> privilege on the <code>SYS.DBMS_STREAMS_MESSAGING</code> package to the Oracle Streams administrator at the <code>ii2.example.com</code> database. See Step <a href="#BABFAHIF">1</a> in <a href="#CHDBIECC">"Task 3: Configuring a Message Enqueuing Mechanism"</a> for an example that grants this privilege to the Oracle Streams administrator in the <code>ii1.example.com</code> database.</p>
</li>
<li>
<p>On a command line, open SQL*Plus and connect to the <code>ii2.example.com</code> database as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p><a id="sthref694"></a>Create a messaging client to enable the Oracle Streams administrator to dequeue messages from the <code>streams_queue</code> queue:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.ADD_MESSAGE_RULE (
    message_type   =&gt; 'strmadmin.order_id_date',
    rule_condition =&gt; ':MSG.ORDER_ID &gt; 0',
    streams_type   =&gt; 'DEQUEUE',
    streams_name   =&gt; 'strmadmin',
    queue_name     =&gt; 'strmadmin.streams_queue');
END;
/
</pre>
<p>The user name of the Oracle Streams administrator must be specified for the <code>streams_name</code> parameter. In this example, the user name of the Oracle Streams administrator is <code>strmadmin</code>.</p>
<p>A messaging client uses rules to determine which messages to dequeue. In this example, the rule for the messaging client specifies that all messages with an <code>order_id</code> greater than zero should be dequeued. So, with this rule, the messaging client will dequeue all new messages of type <code>strmadmin.order_id_date</code> that appear in the <code>strmadmin.streams_queue</code> queue.</p>
</li>
<li>
<p>In Oracle Enterprise Manager, log in to the <code>ii2.example.com</code> database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Click <span class="bold">Schema</span> to open the Schema subpage.</p>
</li>
<li>
<p>Click <span class="bold">Procedures</span> in the Programs section.</p>
</li>
<li>
<p>On the Procedures page, click <span class="bold">Create</span>.</p>
</li>
<li>
<p>On the Create Procedure page, enter <code>dequeue_orders</code> in the Name field.</p>
</li>
<li>
<p>Ensure that <code>strmadmin</code> is entered in the Schema field.</p>
</li>
<li>
<p>Delete the sample text in the Source field.</p>
</li>
<li>
<p><a id="sthref695"></a>Enter the following in the Source field:</p>
<pre>
AS 
  msg            ANYDATA; 
  user_msg       strmadmin.order_id_date; 
  num_var        PLS_INTEGER; 
  more_messages  BOOLEAN := TRUE; 
  navigation     VARCHAR2(30); 
BEGIN 
  navigation := 'FIRST MESSAGE'; 
  WHILE (more_messages) LOOP 
    BEGIN 
      DBMS_STREAMS_MESSAGING.DEQUEUE( 
        queue_name   =&gt; 'strmadmin.streams_queue', 
        streams_name =&gt; 'strmadmin', 
        payload      =&gt; msg, 
        navigation   =&gt; navigation, 
        wait         =&gt; DBMS_STREAMS_MESSAGING.NO_WAIT); 
      IF msg.GETTYPENAME() = 'STRMADMIN.ORDER_ID_DATE' THEN 
        num_var := msg.GETOBJECT(user_msg); 
        DBMS_OUTPUT.PUT_LINE('Order ID: ' || user_msg.order_id); 
        DBMS_OUTPUT.PUT_LINE('Order Date: ' || user_msg.order_date); 
      END IF; 
      navigation := 'NEXT MESSAGE'; 
      COMMIT; 
    EXCEPTION WHEN SYS.DBMS_STREAMS_MESSAGING.ENDOFCURTRANS THEN 
                navigation := 'NEXT TRANSACTION'; 
              WHEN DBMS_STREAMS_MESSAGING.NOMOREMSGS THEN 
                more_messages := FALSE; 
                DBMS_OUTPUT.PUT_LINE('No more messages.'); 
              WHEN OTHERS THEN 
                RAISE;   
    END; 
  END LOOP; 
END;
</pre></li>
<li>
<p>Click <span class="bold">OK</span>.</p>
</li>
<li>
<p>Complete the steps in <a href="#CHDBIDGD">"Task 5: Enqueuing Messages"</a> to continue this extended example.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also use the <a class="olink SQLRF01309" href="../../server.112/e41084/statements_6009.htm#SQLRF01309"><code>CREATE</code> <code>PROCEDURE</code></a> SQL statement to create a procedure.</div>
</div>
<!-- class="sect2" -->
<a id="CHDBIDGD"></a><a id="TDPII040"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 5: Enqueuing Messages<a id="sthref696"></a><a id="sthref697"></a></h3>
<p>The example in <a href="#CHDBIECC">"Task 3: Configuring a Message Enqueuing Mechanism"</a> created a trigger. The trigger enqueues a message with information about an order that was inserted into the <code>oe.orders</code> table into the <code>strmadmin.streams_queue</code> queue. So, you can enqueue messages into the <code>strmadmin.streams_queue</code> queue by inserting rows into the <code>oe.orders</code> table.</p>
<p class="orderedlisttitle">To insert rows into the oe.orders table:&nbsp;</p>
<ol>
<li>
<p>On a command line, open SQL*Plus and connect to the <code>ii1.example.com</code> database as <code>oe</code> user.</p>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p>In SQL*Plus, insert rows into the <code>oe.orders</code> table:</p>
<pre>
INSERT INTO oe.orders VALUES(3000, SYSDATE, 'direct', 116, 0, 4000.00, 153, NULL);
 
INSERT INTO oe.orders VALUES(3001, SYSDATE, 'direct', 117, 5, 5000.00, 163, NULL);
 
INSERT INTO oe.orders VALUES(3002, SYSDATE, 'direct', 118, 7, 6000.00, 159, NULL);
</pre></li>
<li>
<p>In SQL*Plus, commit your changes:</p>
<pre>
COMMIT;
</pre></li>
<li>
<p>Complete the steps in <a href="#CHDJEJEE">"Task 6: Dequeuing Messages"</a> to continue this extended example.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CHDJEJEE"></a><a id="TDPII041"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 6: Dequeuing Messages<a id="sthref699"></a><a id="sthref700"></a></h3>
<p>The example in <a href="#CHDBIDGD">"Task 5: Enqueuing Messages"</a> enqueues messages into the <code>strmadmin.streams_queue</code> queue in the <code>ii1.example.com</code> database. After messages are enqueued, the propagation configured in <a href="#CHDHBBDJ">"Task 2: Configuring the Queues and Propagation Between Them"</a> sends the messages to the <code>strmadmin.streams_queue</code> queue in the <code>ii2.example.com</code> database.</p>
<p>This example dequeues the messages from the queue in the <code>ii2.example.com</code> database using the <code>dequeue_orders</code> procedure created in <a href="#CHDHGJAG">"Task 4: Configuring a Messaging Client to Dequeue Messages"</a>.</p>
<p class="orderedlisttitle">To dequeue messages:&nbsp;</p>
<ol>
<li>
<p>Optionally, verify that the messages have arrived in the <code>strmadmin.streams_queue</code> queue at <code>ii2.example.com</code> before you attempt to dequeue them. It might take time for the propagation to send messages from the queue at <code>ii1.example.com</code> to the queue at <code>ii2.example.com</code>. See <a href="#BABBAHDB">"Viewing the Messages in a Queue"</a> for instructions.</p>
<p>Three messages should appear on the Messages page. Each message contains information about an order you inserted into the <code>oe.orders</code> table in <a href="#CHDBIDGD">"Task 5: Enqueuing Messages"</a>.</p>
</li>
<li>
<p>On a command line, open SQL*Plus and connect to the <code>ii2.example.com</code> database as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p>In SQL*Plus, run the <code>dequeue_orders</code> procedure:</p>
<pre>
SET SERVEROUTPUT ON
exec dequeue_orders;
</pre>
<p>The output will be similar to the following:</p>
<pre>
<span class="bold">Order ID: 3000</span>
<span class="bold">Order Date: 01-FEB-07 01.47.48.000000000 PM</span>
<span class="bold">Order ID: 3001</span>
<span class="bold">Order Date: 01-FEB-07 01.47.57.000000000 PM</span>
<span class="bold">Order ID: 3002</span>
<span class="bold">Order Date: 01-FEB-07 01.48.04.000000000 PM</span>
<span class="bold">No more messages.</span>
 
<span class="bold">PL/SQL procedure successfully completed.</span>
</pre></li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDGEHCF"></a><a id="TDPII043"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Tutorial: Configuring Message Notifications<a id="sthref702"></a><a id="sthref703"></a></h2>
<p>You can configure message notifications that alert applications or users when a message of interest is enqueued.</p>
<p>The example in this topic illustrates how you can use message notifications to enable two applications to communicate with each other. In this example, the applications communicate in the following way:</p>
<ol>
<li>
<p>The first application determines various parameters that must be set in the second application and the values for these parameters.</p>
</li>
<li>
<p>The first application enqueues messages that contain the following attributes:</p>
<ul>
<li>
<p><code>parameter:</code> Specifies the parameter to set in the second application</p>
</li>
<li>
<p><code>value:</code> Specifies the parameter value</p>
</li>
</ul>
</li>
<li>
<p>Message notification alerts the second application that there are new messages in the queue.</p>
</li>
<li>
<p>The second application dequeues the messages and sets the parameters to the values in the messages.</p>
</li>
</ol>
<p>For simplicity, this example does not create the two applications. Instead, it illustrates how to configure a message notification and how message notification can be used to dequeue messages of interest automatically when they are enqueued.</p>
<p><a href="#BABGEHJC">Figure 9-2</a> provides an overview of the messaging environment created in this example.</p>
<div class="figure">
<p class="titleinfigure"><a id="BABGEHJC"></a><a id="TDPII313"></a>Figure 9-2 Sample Messaging Environment That Uses Message Notification</p>
<img width="507" height="383" src="img/tdpii508.gif" alt="Description of Figure 9-2 follows" /><br />
<a id="sthref704" href="img_text/tdpii508.htm">Description of "Figure 9-2 Sample Messaging Environment That Uses Message Notification"</a><br />
<br /></div>
<!-- class="figure" -->
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also configure message notification in an environment that sends messages between databases. See <a href="#CHDBACBE">"Tutorial: Sending Messages Between Oracle Databases"</a> for an example of an environment that sends messages between databases.</div>
<p class="itemizedlisttitle">To configure a message notification:&nbsp;</p>
<ul>
<li>
<p><a href="#BABIJEBG">Task 1: Creating the Message Type</a></p>
</li>
<li>
<p><a href="#BABGHHDA">Task 2: Configuring a Queue and a Messaging Client</a></p>
</li>
<li>
<p><a href="#BABFGHCC">Task 3: Configuring a Mechanism for Dequeuing Messages</a></p>
</li>
<li>
<p><a href="#BABJIDFE">Task 4: Configuring Message Notification</a></p>
</li>
<li>
<p><a href="#BABEGBAG">Task 5: Enqueuing Messages and Checking for Message Notification</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDFEFHI">"About Message Notifications"</a></p>
</li>
<li>
<p><a class="olink ADQUE" href="../e11013/toc.htm"><span class="italic">Oracle Streams Advanced Queuing User's Guide</span></a> for detailed information about message notification features</p>
</li>
</ul>
</div>
<a id="BABIJEBG"></a><a id="TDPII096"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 1: Creating the Message Type<a id="sthref706"></a><a id="sthref707"></a></h3>
<p>Create a user-defined type to define the information that you want to track for the applications. This example creates the <code>strmadmin.app_info</code> type for messages that will contain a parameter and a value.</p>
<p class="orderedlisttitle">To create the strmadmin.app_info type:&nbsp;</p>
<ol>
<li>
<p>Prepare your environment for messaging if you have not already done so. See <a href="#CHDGIEEC">"Preparing for Messaging"</a>.</p>
</li>
<li>
<p><a id="sthref709"></a>In Oracle Enterprise Manager, log in to the database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Click <span class="bold">Schema</span> to open the Schema subpage.</p>
</li>
<li>
<p>Click <span class="bold">Object Types</span> in the User Defined Types section.</p>
</li>
<li>
<p>On the Object Types page, click <span class="bold">Create</span> to open the Create Object Type page.</p>
<img width="666" height="358" src="img/tdpii_create_object_type.gif" alt="Description of tdpii_create_object_type.gif follows" /><br />
<a id="sthref710" href="img_text/tdpii_create_object_type.htm">Description of the illustration tdpii_create_object_type.gif</a><br />
<br /></li>
<li>
<p>Enter <code>app_info</code> in the Name field.</p>
</li>
<li>
<p>Ensure that <code>strmadmin</code> is selected in the Schema field.</p>
</li>
<li>
<p>Ensure that <span class="bold">Predefined Type</span> is selected for Datatype in the Attributes section.</p>
</li>
<li>
<p>Click <span class="bold">Add</span> in the Attributes section to open the Add Predefined Type Attributes page.</p>
<img width="666" height="173" src="img/tdpii_add_type_attribute.gif" alt="Description of tdpii_add_type_attribute.gif follows" /><br />
<a id="sthref711" href="img_text/tdpii_add_type_attribute.htm">Description of the illustration tdpii_add_type_attribute.gif</a><br />
<br /></li>
<li>
<p>To add the first attribute to the <code>app_info</code> type:</p>
<ol>
<li>
<p>Enter <code>parameter</code> in the Name field.</p>
</li>
<li>
<p>Select <code>VARCHAR2</code> for Type.</p>
</li>
<li>
<p>Enter <code>20</code> in the Length field.</p>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
</li>
</ol>
</li>
<li>
<p>On the Create Object Type page, ensure that <span class="bold">Predefined Type</span> is selected for Datatype in the Attributes section.</p>
</li>
<li>
<p>Click <span class="bold">Add</span> in the Attributes section to open the Add Predefined Type Attributes page.</p>
</li>
<li>
<p>To add the next attribute to the <code>app_info</code> type:</p>
<ol>
<li>
<p>Enter <code>value</code> in the Name field.</p>
</li>
<li>
<p>Select <code>NUMBER</code> for Type.</p>
</li>
<li>
<p>Enter <code>12</code> in the Length field.</p>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
</li>
</ol>
</li>
<li>
<p>On the Create Object Type page, click <span class="bold">OK</span> to create the type.</p>
</li>
<li>
<p>Complete the steps in <a href="#BABGHHDA">"Task 2: Configuring a Queue and a Messaging Client"</a> to continue this extended example.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also use the <a class="olink SQLRF01506" href="../../server.112/e41084/statements_8001.htm#SQLRF01506"><code>CREATE</code> <code>TYPE</code></a> SQL statement to create a type.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDGEHCF">"Tutorial: Configuring Message Notifications"</a></p>
</li>
<li>
<p><a href="#CHDIJFHB">"About Messaging"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABGHHDA"></a><a id="TDPII098"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 2: Configuring a Queue and a Messaging Client<a id="sthref712"></a><a id="sthref713"></a><a id="sthref714"></a></h3>
<p>Create a queue table and a queue to store the messages that the first application will generate for the second application. After the queue is created, message notification requires a consumer who can dequeue messages from the queue. In this example, a messaging client is the consumer who can dequeue messages from the <code>streams_queue</code> queue.</p>
<p class="orderedlisttitle">To configure a queue and a messaging client:&nbsp;</p>
<ol>
<li>
<p>Create a queue named <code>streams_queue</code> in the schema of the Oracle Streams administrator. See <a href="tdpii_common_ii.htm#CHDJHCAI">"Creating an ANYDATA Queue"</a> for instructions.</p>
</li>
<li>
<p>On a command line, open SQL*Plus and connect to the database as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p><a id="sthref716"></a>Create a messaging client to enable the Oracle Streams administrator to dequeue messages from the <code>streams_queue</code> queue:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.ADD_MESSAGE_RULE (
    message_type   =&gt; 'strmadmin.app_info',
    rule_condition =&gt; ':MSG.VALUE &gt;= 0',
    streams_type   =&gt; 'DEQUEUE',
    streams_name   =&gt; 'strmadmin',
    queue_name     =&gt; 'strmadmin.streams_queue');
END;
/
</pre>
<p>The user name for the Oracle Streams administrator must be specified for the <code>streams_name</code> parameter. In this example, the user name for the Oracle Streams administrator is <code>strmadmin</code>. The name of the new messaging client is also <code>strmadmin</code>.</p>
<p>A messaging client uses rules to determine which messages to dequeue. In this example, the rule for the messaging client specifies that all messages with a <code>value</code> greater than zero should be dequeued. So, with this rule, the messaging client will dequeue all new messages of type <code>strmadmin.app_info</code> that appear in <code>strmadmin.streams_queue</code> because all parameter values are greater than or equal to zero.</p>
</li>
<li>
<p>Complete the steps in <a href="#BABFGHCC">"Task 3: Configuring a Mechanism for Dequeuing Messages"</a> to continue this extended example.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDGEHCF">"Tutorial: Configuring Message Notifications"</a></p>
</li>
<li>
<p><a href="#CHDIJFHB">"About Messaging"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABFGHCC"></a><a id="TDPII099"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 3: Configuring a Mechanism for Dequeuing Messages<a id="sthref717"></a><a id="sthref718"></a></h3>
<p>In this extended example, the second application must be able to dequeue messages from the <code>streams_queue</code> queue. For simplicity, this example creates a PL/SQL procedure called <code>dequeue_app_messages</code> to dequeue messages of type <code>strmadmin.app_info</code>. This procedure uses the messaging client created in <a href="#BABGHHDA">"Task 2: Configuring a Queue and a Messaging Client"</a> to dequeue messages.</p>
<p class="orderedlisttitle">To configure a mechanism for dequeuing messages:&nbsp;</p>
<ol>
<li>
<p>Grant the <code>EXECUTE</code> privilege on the <code>DBMS_AQ</code> package to the Oracle Streams administrator.</p>
<p>This example configures a procedure that runs the <code>DEQUEUE</code> procedure in the <code>DBMS_AQ</code> package. The user who runs this procedure must have explicit <code>EXECUTE</code> privilege on the package that contains the procedure. The privilege cannot be granted through a role. Therefore, the Oracle Streams administrator must be granted explicit <code>EXECUTE</code> privilege on the package.</p>
<ol>
<li>
<p><a id="sthref720"></a>Log in to Enterprise Manager as an administrative user who can grant privileges to the <code>strmadmin</code> user.</p>
</li>
<li>
<p>Go to the Server subpage.</p>
</li>
<li>
<p>Click <span class="bold">Users</span> in the Security section.</p>
<p>The Users page appears.</p>
</li>
<li>
<p>Select the <code>STRMADMIN</code> user.</p>
</li>
<li>
<p>Click <span class="bold">Edit</span>.</p>
<p>The General subpage of the Edit User page appears.</p>
</li>
<li>
<p>Click <span class="bold">Object Privileges</span> to open the Object Privileges subpage.</p>
<img width="804" height="227" src="img/tdpii_edit_user.gif" alt="Description of tdpii_edit_user.gif follows" /><br />
<a id="sthref721" href="img_text/tdpii_edit_user.htm">Description of the illustration tdpii_edit_user.gif</a><br />
<br /></li>
<li>
<p>Select <span class="bold">Package</span> in the Select Object Type list.</p>
</li>
<li>
<p>Click <span class="bold">Add</span> to open the Add Package Object Privileges page.</p>
<img width="558" height="399" src="img/tdpii_add_package_privs.gif" alt="Description of tdpii_add_package_privs.gif follows" /><br />
<a id="sthref722" href="img_text/tdpii_add_package_privs.htm">Description of the illustration tdpii_add_package_privs.gif</a><br />
<br /></li>
<li>
<p>Enter <code>SYS.DBMS_AQ</code> in the Select Package Objects field.</p>
</li>
<li>
<p>Move <span class="bold">EXECUTE</span> from the Available Privileges list to the Selected Privileges list.</p>
</li>
<li>
<p>Click <span class="bold">OK</span> to add the privilege.</p>
</li>
<li>
<p>Click <span class="bold">Apply</span> to grant the privilege.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also use the <a class="olink SQLRF01603" href="../../server.112/e41084/statements_9013.htm#SQLRF01603"><code>GRANT</code></a> SQL statement to grant privileges to a user.</div>
</li>
<li>
<p>Create a PL/SQL procedure that dequeues messages.</p>
<ol>
<li>
<p>In Oracle Enterprise Manager, log in to the database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Click <span class="bold">Schema</span> to open the Schema subpage.</p>
</li>
<li>
<p>Click <span class="bold">Procedures</span> in the Programs section.</p>
</li>
<li>
<p>On the Procedures page, click <span class="bold">Create</span>.</p>
</li>
<li>
<p>On the Create Procedure page, enter <code>dequeue_app_messages</code> in the Name field.</p>
</li>
<li>
<p>Ensure that <code>strmadmin</code> is entered in the Schema field.</p>
</li>
<li>
<p>Delete the sample text in the Source field.</p>
</li>
<li>
<p><a id="sthref723"></a>Enter the following in the Source field:</p>
<pre>
(
  context  ANYDATA, 
  reginfo  SYS.AQ$_REG_INFO, 
  descr    SYS.AQ$_DESCRIPTOR)
AS 
  dequeue_options     DBMS_AQ.DEQUEUE_OPTIONS_T; 
  message_properties  DBMS_AQ.MESSAGE_PROPERTIES_T; 
  message_handle      RAW(16); 
  message             ANYDATA; 
  app_message         strmadmin.app_info; 
  rc                  PLS_INTEGER; 
BEGIN 
  -- Get the message identifier and consumer name from the descriptor 
  dequeue_options.msgid := descr.msg_id; 
  dequeue_options.consumer_name := descr.consumer_name; 
  -- Dequeue the message 
  DBMS_AQ.DEQUEUE( 
    queue_name         =&gt; descr.queue_name, 
    dequeue_options    =&gt; dequeue_options, 
    message_properties =&gt; message_properties, 
    payload            =&gt; message, 
    msgid              =&gt; message_handle);
  rc := message.getobject(app_message); 
  COMMIT; 
END;
</pre>
<p>A message notification PL/SQL procedure must have the following signature:</p>
<pre>
PROCEDURE <span class="italic">procedure_name</span>(
  context  IN  ANYDATA,
  reginfo  IN  SYS.AQ$_REG_INFO,
  descr    IN  SYS.AQ$_DESCRIPTOR);
</pre>
<p>Here, <code><span class="codeinlineitalic">procedure_name</span></code> stands for the name of the procedure. The procedure is a <code>PLSQLCALLBACK</code> data structure that specifies the user-defined PL/SQL procedure to be invoked on message notification.</p>
<p>The procedure in this example is a simple notification procedure that dequeues a message of type <code>strmadmin.app_info</code> type using the message identifier and consumer name sent by the notification.</p>
</li>
<li>
<p>Click <span class="bold">OK</span> to create the procedure.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also use the <a class="olink SQLRF01309" href="../../server.112/e41084/statements_6009.htm#SQLRF01309"><code>CREATE</code> <code>PROCEDURE</code></a> SQL statement to create a procedure.</div>
</li>
<li>
<p>Complete the steps in <a href="#BABJIDFE">"Task 4: Configuring Message Notification"</a> to continue this extended example.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDGEHCF">"Tutorial: Configuring Message Notifications"</a></p>
</li>
<li>
<p><a href="#CHDIJFHB">"About Messaging"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABJIDFE"></a><a id="TDPII100"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 4: Configuring Message Notification<a id="sthref724"></a><a id="sthref725"></a></h3>
<p>In this extended example, message notification invokes the <code>strmadmin.dequeue_app_messages</code> procedure when a new message is enqueued into the <code>strmadmin.streams_queue</code> queue. This procedure dequeues the new message or messages. After dequeuing, an application can process the messages in any customized way. In this example, the second application uses the information in the messages to set application parameter values. For simplicity, this example does not configure the second application.</p>
<p class="orderedlisttitle">To configure message notification that invokes a procedure:&nbsp;</p>
<ol>
<li>
<p>On a command line, open SQL*Plus and connect to the database as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p><a id="sthref727"></a>Set the message notification to invoke the <code>strmadmin.dequeue_app_messages</code> procedure when messages are enqueued and they can be dequeued by the <code>strmadmin</code> messaging client:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.SET_MESSAGE_NOTIFICATION (
    streams_name         =&gt; 'strmadmin',
    notification_action  =&gt; 'strmadmin.dequeue_app_messages',
    notification_type    =&gt; 'PROCEDURE',
    include_notification =&gt; TRUE,
    queue_name           =&gt; 'strmadmin.streams_queue');
END;
/
</pre></li>
<li>
<p>Complete the steps in <a href="#BABEGBAG">"Task 5: Enqueuing Messages and Checking for Message Notification"</a> to continue this extended example.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDGEHCF">"Tutorial: Configuring Message Notifications"</a></p>
</li>
<li>
<p><a href="#CHDIJFHB">"About Messaging"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABEGBAG"></a><a id="TDPII101"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 5: Enqueuing Messages and Checking for Message Notification<a id="sthref728"></a><a id="sthref729"></a><a id="sthref730"></a><a id="sthref731"></a></h3>
<p>In this extended example, one application enqueues messages that are processed by a second application. For simplicity, this example enqueues messages manually. After the messages are enqueued, you can ensure that they have been dequeued automatically through message notification.</p>
<p class="orderedlisttitle">To enqueue messages and check for message notification:&nbsp;</p>
<ol>
<li>
<p>On a command line, open SQL*Plus and connect to the database as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p><a id="sthref733"></a>Enqueue messages into the <code>strmadmin.streams_queue</code> queue:</p>
<pre>
DECLARE
  msg    strmadmin.app_info;
BEGIN
  msg := strmadmin.app_info(
            parameter =&gt; 'THRESHOLD',
            value     =&gt; 1000);
  DBMS_STREAMS_MESSAGING.ENQUEUE (
    queue_name   =&gt; 'strmadmin.streams_queue',
    payload      =&gt; ANYDATA.CONVERTOBJECT(msg));
  COMMIT;
END;
/ 
 
DECLARE
  msg    strmadmin.app_info;
BEGIN
  msg := strmadmin.app_info(
            parameter =&gt; 'MIN_WAIT',
            value     =&gt; 1);
  DBMS_STREAMS_MESSAGING.ENQUEUE (
    queue_name   =&gt; 'strmadmin.streams_queue',
    payload      =&gt; ANYDATA.CONVERTOBJECT(msg));
  COMMIT;
END;
/
 
DECLARE
  msg    strmadmin.app_info;
BEGIN
  msg := strmadmin.app_info(
            parameter =&gt; 'BUFFER_SIZE',
            value     =&gt; 30);
  DBMS_STREAMS_MESSAGING.ENQUEUE (
    queue_name   =&gt; 'strmadmin.streams_queue',
    payload      =&gt; ANYDATA.CONVERTOBJECT(msg));
  COMMIT;
END;
/ 
</pre></li>
<li>
<p>Optionally, view the messages in the <code>streams_queue</code> queue, and verify that they have been dequeued automatically using message notification. See <a href="#BABBAHDB">"Viewing the Messages in a Queue"</a> for instructions.</p>
<p>When the message notification configured in this example is working properly, you should see one of the following on the Messages page:</p>
<ul>
<li>
<p>One or more of the enqueued messages might appear with <code>Processed</code> in the Consumers in Different States field. A <code>Processed</code> value in this field means that the message has been dequeued by all consumers.</p>
</li>
<li>
<p>No messages appear in the queue. Eventually, processed messages are deleted from a queue automatically. If no messages appear, then the enqueued messages were dequeued by message notification and then deleted automatically.</p>
</li>
</ul>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDGEHCF">"Tutorial: Configuring Message Notifications"</a></p>
</li>
<li>
<p><a href="#CHDIJFHB">"About Messaging"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDEBJHA"></a><a id="TDPII044"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Modifying Queues<a id="sthref734"></a><a id="sthref735"></a></h2>
<p>You can use Enterprise Manager to modify some properties of an existing queue, including the following properties:</p>
<ul>
<li>
<p><span class="bold">Maximum Retries:</span> The number of dequeuing attempts allowed on a message before the message is moved to the exception queue. If there is poor connectivity in your messaging environment, then a connection might be lost while an application is in the process of dequeuing messages. In such environment, you might increase the number of maximum retries allowed so that applications can try to dequeue messages several times before the messages are moved to the exception queue.</p>
</li>
<li>
<p><span class="bold">Retry Delay:</span> The amount of time after which a message is scheduled for processing again after an application rollback. If there is poor connectivity in your messaging environment, then you might want applications to wait for a set period of time after a failed attempt to dequeue messages. In such environments, you might increase the retry delay setting to specify the amount of time to wait.</p>
</li>
<li>
<p><span class="bold">Retention Time:</span> The amount of time that a message is retained in a queue after the message has been dequeued by all of its consumers. If you want to track messages that have been consumed, then you might set a retention time that enables you to record information about the messages that have been stored in the queue.</p>
</li>
</ul>
<p>You can set these properties to values that work best with the applications that dequeue messages from the queue.</p>
<p class="orderedlisttitle">To modify a queue:&nbsp;</p>
<ol>
<li>
<p>In Oracle Enterprise Manager, log in to the database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Click <span class="bold">Data Movement</span> to open the Data Movement subpage.</p>
</li>
<li>
<p>In the Streams section, click <span class="bold">Manage Advanced Queues</span> to open the Manage Advanced Queues page.</p>
</li>
<li>
<p>Select the queue to modify. If necessary, use the search tool to find the queue, and then select it.</p>
</li>
<li>
<p>Click <span class="bold">Edit</span> to open the Edit Queue page.</p>
<img width="646" height="333" src="img/tdpii_edit_queue.gif" alt="Description of tdpii_edit_queue.gif follows" /><br />
<a id="sthref737" href="img_text/tdpii_edit_queue.htm">Description of the illustration tdpii_edit_queue.gif</a><br />
<br /></li>
<li>
<p>Modify one or more queue properties.</p>
</li>
<li>
<p>Click <span class="bold">Apply</span> to save your changes.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also use the <a class="olink ARPLS111" href="../../appdev.112/e40758/d_aqadm.htm#ARPLS111"><code>DBMS_AQADM.ALTER_QUEUE</code></a> procedure to modify a queue.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDIJFHB">About Messaging</a></p>
</li>
<li>
<p><a href="#CHDBACBE">"Tutorial: Sending Messages Between Oracle Databases"</a></p>
</li>
<li>
<p><a href="#CHDGEHCF">"Tutorial: Configuring Message Notifications"</a></p>
</li>
<li>
<p><a href="#BABBBFAI">"Modifying Queue Tables"</a></p>
</li>
<li>
<p><a href="#CHDDICBF">"Monitoring a Messaging Environment"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="BABBBFAI"></a><a id="TDPII095"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Modifying Queue Tables<a id="sthref738"></a><a id="sthref739"></a></h2>
<p>You can use Enterprise Manager to modify some storage options of an existing queue table. Changing the storage options for a queue table can improve the performance of the queues that use the queue table.</p>
<p class="orderedlisttitle">To modify a queue table:&nbsp;</p>
<ol>
<li>
<p>In Oracle Enterprise Manager, log in to the database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Click <span class="bold">Data Movement</span> to open the Data Movement subpage.</p>
</li>
<li>
<p>Click <span class="bold">Manage Advanced Queues</span>.</p>
</li>
<li>
<p>In the Related Links section, click <span class="bold">Queue Tables</span> to open the Queue Tables page.</p>
<img width="821" height="295" src="img/tdpii_queue_tables.gif" alt="Description of tdpii_queue_tables.gif follows" /><br />
<a id="sthref741" href="img_text/tdpii_queue_tables.htm">Description of the illustration tdpii_queue_tables.gif</a><br />
<br /></li>
<li>
<p>Select the queue table to modify.</p>
</li>
<li>
<p>Click <span class="bold">Edit</span>.</p>
<p>The Edit Queue Table page appears, showing the General subpage.</p>
</li>
<li>
<p>Click <span class="bold">Storage</span> to open the Storage subpage or <span class="bold">LOB Storage</span> to open the LOB Storage subpage.</p>
<img width="718" height="507" src="img/tdpii_edit_queue_table.gif" alt="Description of tdpii_edit_queue_table.gif follows" /><br />
<a id="sthref742" href="img_text/tdpii_edit_queue_table.htm">Description of the illustration tdpii_edit_queue_table.gif</a><br />
<br /></li>
<li>
<p>Modify one or more queue table properties.</p>
</li>
<li>
<p>Click <span class="bold">Apply</span> to save your changes.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also use the <a class="olink ARPLS107" href="../../appdev.112/e40758/d_aqadm.htm#ARPLS107"><code>DBMS_AQADM.ALTER_QUEUE_TABLE</code></a> procedure to modify a queue table.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDIJFHB">"About Messaging"</a></p>
</li>
<li>
<p><a href="#CHDBACBE">"Tutorial: Sending Messages Between Oracle Databases"</a></p>
</li>
<li>
<p><a href="#CHDGEHCF">"Tutorial: Configuring Message Notifications"</a></p>
</li>
<li>
<p><a href="#CHDEBJHA">"Modifying Queues"</a></p>
</li>
<li>
<p><a href="#CHDDICBF">"Monitoring a Messaging Environment"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CHDBGJHH"></a><a id="TDPII045"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Modifying Propagations<a id="sthref743"></a><a id="sthref744"></a></h2>
<p>You can use Enterprise Manager to modify the schedule of an existing propagation. A propagation schedule determines when and how often the propagation sends messages from one queue to another and how long each propagation lasts. You can modify the following schedule options:</p>
<ul>
<li>
<p><span class="bold">Latency:</span> The amount of time to wait before new messages in a completely propagated queue are propagated</p>
</li>
<li>
<p><span class="bold">Duration of the Propagation:</span> The amount of time that each individual propagation lasts</p>
</li>
<li>
<p><span class="bold">Next Time:</span> The amount of time in between individual propagations</p>
</li>
</ul>
<p>Typically, you modify a propagation schedule to improve the performance of a propagation in your messaging environment. The default settings for these options are usually the best settings. However, you can try different settings for these options to achieve the best performance.</p>
<p class="orderedlisttitle">To modify a propagation:&nbsp;</p>
<ol>
<li>
<p>In Oracle Enterprise Manager, log in to the database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Click <span class="bold">Data Movement</span> to open the Data Movement subpage.</p>
</li>
<li>
<p>Click <span class="bold">Manage Advanced Queues</span> to open the Manage Advanced Queues page.</p>
</li>
<li>
<p>Select the source queue for the propagation that you want to modify. The source queue is the queue from which the propagation sends messages to a destination queue.</p>
</li>
<li>
<p>Select <span class="bold">Propagation Schedules</span> in the Actions list.</p>
</li>
<li>
<p>Click <span class="bold">Go</span> to open the Propagation Schedules page.</p>
<img width="457" height="123" src="img/tdpii_prop_sched.gif" alt="Description of tdpii_prop_sched.gif follows" /><br />
<a id="sthref746" href="img_text/tdpii_prop_sched.htm">Description of the illustration tdpii_prop_sched.gif</a><br />
<br /></li>
<li>
<p>Select the propagation schedule to modify.</p>
</li>
<li>
<p>Click <span class="bold">Edit</span> to open the Edit Propagation Schedule page.</p>
<img width="722" height="394" src="img/tdpii_edit_prop_sched.gif" alt="Description of tdpii_edit_prop_sched.gif follows" /><br />
<a id="sthref747" href="img_text/tdpii_edit_prop_sched.htm">Description of the illustration tdpii_edit_prop_sched.gif</a><br />
<br /></li>
<li>
<p>Modify one or more schedule options.</p>
</li>
<li>
<p>Click <span class="bold">Apply</span> to save your changes.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also use the <a class="olink ARPLS125" href="../../appdev.112/e40758/d_aqadm.htm#ARPLS125"><code>DBMS_AQADM.ALTER_PROPAGATION_SCHEDULE</code></a> procedure to modify a propagation schedule.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDEJBBD">"About Propagations"</a></p>
</li>
<li>
<p><a href="#CHDBACBE">"Tutorial: Sending Messages Between Oracle Databases"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CHDDICBF"></a><a id="TDPII046"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Monitoring a Messaging Environment<a id="sthref748"></a><a id="sthref749"></a></h2>
<p>This section describes using Enterprise Manager to display information about a messaging environment. This section contains instructions for viewing the messages in a queue, queue statistics, and queue consumers.</p>
<p>The following topics describe monitoring a messaging environment:</p>
<ul>
<li>
<p><a href="#BABBAHDB">Viewing the Messages in a Queue</a></p>
</li>
<li>
<p><a href="#BABCJJGF">Viewing Persistent Queue Statistics</a></p>
</li>
<li>
<p><a href="#BABBJDHF">Viewing the Consumers Who Can Dequeue Messages</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDIJFHB">"About Messaging"</a></p>
</li>
<li>
<p><a href="#CHDGIEEC">"Preparing for Messaging"</a></p>
</li>
<li>
<p><a href="#CHDBACBE">"Tutorial: Sending Messages Between Oracle Databases"</a></p>
</li>
<li>
<p><a href="#CHDGEHCF">"Tutorial: Configuring Message Notifications"</a></p>
</li>
<li>
<p><a href="#CHDDGAFD">"Troubleshooting a Messaging Environment"</a></p>
</li>
</ul>
</div>
<a id="BABBAHDB"></a><a id="TDPII162"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Viewing the Messages in a Queue<a id="sthref750"></a><a id="sthref751"></a><a id="sthref752"></a></h3>
<p>You can view the messages in a queue to ensure that an application is enqueuing messages correctly or to see which messages are currently ready to be dequeued or propagated to another queue.</p>
<p class="orderedlisttitle">To view the messages currently stored in a queue:&nbsp;</p>
<ol>
<li>
<p>In Oracle Enterprise Manager, log in to the database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Click <span class="bold">Data Movement</span> to open the Data Movement subpage.</p>
</li>
<li>
<p>Click <span class="bold">Manage Advanced Queues</span> to open the Manage Advanced Queues page.</p>
</li>
<li>
<p>Select the queue that contains the messages. If necessary, use the search tool to find the queue, and then select it.</p>
</li>
<li>
<p>Select <span class="bold">Messages</span> in the Actions list.</p>
</li>
<li>
<p>Click <span class="bold">Go</span>.</p>
</li>
<li>
<p>On the Messages page, click <span class="bold">Go</span>. The messages are listed.</p>
<img width="963" height="325" src="img/tdpii_messages.gif" alt="Description of tdpii_messages.gif follows" /><br />
<a id="sthref754" href="img_text/tdpii_messages.htm">Description of the illustration tdpii_messages.gif</a><br />
<br /></li>
<li>
<p>Click the number link in the Consumers In Different States field to view the consumers of a message. A consumer might be a propagation that sends the message to a different queue or an application that dequeues the message.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDEBJHA">"Modifying Queues"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABCJJGF"></a><a id="TDPII165"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Viewing Persistent Queue Statistics<a id="sthref755"></a><a id="sthref756"></a><a id="sthref757"></a><a id="sthref758"></a><a id="sthref759"></a></h3>
<p>If you are using persistent messaging mode, then messages are stored in queue table on hard disk. This topic describes viewing statistics for messages that were enqueued in persistent mode into a persistent queue.</p>
<p class="orderedlisttitle">To view persistent queue statistics:&nbsp;</p>
<ol>
<li>
<p>In Oracle Enterprise Manager, log in to the database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Click <span class="bold">Data Movement</span> to open the Data Movement subpage.</p>
</li>
<li>
<p>Click <span class="bold">Manage Advanced Queues</span> to open the Manage Advanced Queues page.</p>
</li>
<li>
<p>Select the queue that contains the messages. If necessary, use the search tool to find the queue, and then select it.</p>
</li>
<li>
<p>Select <span class="bold">Queue Statistics</span> in the Actions list.</p>
</li>
<li>
<p>Click <span class="bold">Go</span>.</p>
</li>
<li>
<p>On the Queue Statistics page, click <span class="bold">Message Statistics</span> to view the persistent queue statistics for the queue.</p>
</li>
</ol>
<img width="699" height="267" src="img/tdpii_message_stats.gif" alt="Description of tdpii_message_stats.gif follows" /><br />
<a id="sthref761" href="img_text/tdpii_message_stats.htm">Description of the illustration tdpii_message_stats.gif</a><br />
<br />
<p>The message statistics show the number of messages in each state in the persistent queue. They also show the total wait time and the average wait time for messages to be dequeued.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
<ul>
<li>
<p>Messages can also be enqueued in buffered mode. In this case, the messages are stored in memory in a buffered queue. See <a href="tdpii_adcont.htm#CHDEHBJF">"Viewing Buffered Queue Statistics"</a> for information about viewing statistics for these messages.</p>
</li>
<li>
<p>You can also query the <a class="olink REFRN30004" href="../../server.112/e40402/dynviews_1010.htm#REFRN30004"><code>V$AQ</code></a> dynamic performance view for queue statistics.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDEBJHA">"Modifying Queues"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABBJDHF"></a><a id="TDPII163"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Viewing the Consumers Who Can Dequeue Messages<a id="sthref762"></a><a id="sthref763"></a><a id="sthref764"></a><a id="sthref765"></a></h3>
<p>Consumers are configured to dequeue messages from a specific queue. In a messaging environment, consumers are represented by subscribers to a queue, and multiple consumers might use a single subscriber.</p>
<p>Consumers can be:</p>
<ul>
<li>
<p>Applications or users that dequeue and process messages</p>
</li>
<li>
<p>Propagations that send messages from one queue to another</p>
</li>
<li>
<p>Apply processes that can dequeue messages for custom processes in a messaging environment or dequeue changes to database objects in a replication environment</p>
</li>
</ul>
<p class="orderedlisttitle">To view the consumers who can dequeue messages from a specific queue:&nbsp;</p>
<ol>
<li>
<p>In Oracle Enterprise Manager, log in to the database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Click <span class="bold">Data Movement</span> to open the Data Movement subpage.</p>
</li>
<li>
<p>Click <span class="bold">Manage Advanced Queues</span> to open the Manage Advanced Queues page.</p>
</li>
<li>
<p>Select the queue. If necessary, use the search tool to find the queue, and then select it.</p>
</li>
<li>
<p>Select <span class="bold">Subscribers</span> in the Actions list.</p>
</li>
<li>
<p>Click <span class="bold">Go</span> to open the Subscribers page.</p>
</li>
</ol>
<img width="683" height="328" src="img/tdpii_q_subscribers.gif" alt="Description of tdpii_q_subscribers.gif follows" /><br />
<a id="sthref767" href="img_text/tdpii_q_subscribers.htm">Description of the illustration tdpii_q_subscribers.gif</a><br />
<br />
<p>The Subscribers page includes the following information about each subscriber to the queue:</p>
<ul>
<li>
<p>The Name field contains the name of the subscriber.</p>
</li>
<li>
<p>The Address field is typically populated if the subscriber is a propagation that sends messages to another queue. The Address field shows the name of the queue that receives the messages.</p>
</li>
<li>
<p>The Database Link field shows the database link to a remote database if the subscriber is at the remote database.</p>
</li>
<li>
<p>The Rule field shows the rule used by the subscriber. Rules can determine which messages are dequeued by the subscriber. Some subscribers do not use rules.</p>
</li>
<li>
<p>The Transformation field shows the transformation used by the subscriber. Transformations modify messages while they are being dequeued. Some subscribers do not use transformations.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also query the <a class="olink REFRN20544" href="../../server.112/e40402/statviews_2017.htm#REFRN20544"><code>ALL_QUEUE_SUBSCRIBERS</code></a> data dictionary to view the consumers who can dequeue messages.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDIJFHB">"About Messaging"</a></p>
</li>
<li>
<p><a href="tdpii_repcont.htm#BABBAJFE">"About Change Apply"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDDGAFD"></a><a id="TDPII047"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Troubleshooting a Messaging Environment<a id="sthref768"></a><a id="sthref769"></a></h2>
<p>This section describes the most common problems in a messaging environment. It also describes how to correct these problems.</p>
<p>The following topics describe troubleshooting a messaging environment:</p>
<ul>
<li>
<p><a href="#BABDGHAD">Correcting an ORA-01031 Error While Enqueuing or Dequeuing Messages</a></p>
</li>
<li>
<p><a href="#BABHIJAG">Correcting an ORA-24033 Error While Enqueuing Messages</a></p>
</li>
<li>
<p><a href="#BABHFBAB">Correcting an ORA-02019 Error for a Propagation</a></p>
</li>
<li>
<p><a href="#BABDJJDB">Understanding Why Dequeued Messages Remain in a Queue</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ADQUE0700" href="../../server.112/e11013/aq_trbl.htm#ADQUE0700"><span class="italic">Oracle Streams Advanced Queuing User's Guide</span></a></p>
</li>
<li>
<p><a href="#CHDIJFHB">"About Messaging"</a></p>
</li>
</ul>
</div>
<a id="BABDGHAD"></a><a id="TDPII184"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Correcting an ORA-01031 Error While Enqueuing or Dequeuing Messages<a id="sthref770"></a><a id="sthref771"></a><a id="sthref772"></a><a id="sthref773"></a><a id="sthref774"></a><a id="sthref775"></a><a id="sthref776"></a></h3>
<p>If a user who does not have the required privileges attempts to enqueue or dequeue messages, then Oracle Database returns the following error:</p>
<pre>
ORA-01031: insufficient privileges
</pre>
<p>The enqueue or dequeue operation fails when Oracle Database returns this message. To correct the problem, grant <code>ENQUEUE</code> or <code>DEQUEUE</code> privileges on the queue to the user.</p>
<p class="orderedlisttitle">To grant ENQUEUE or DEQUEUE privileges to a user:&nbsp;</p>
<ol>
<li>
<p>On a command line, open SQL*Plus and connect to the database as an administrative user, such as the Oracle Streams administrator or <code>SYSTEM</code>.</p>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p>Run the <code>GRANT_QUEUE_PRIVILEGE</code> procedure in the <code>DBMS_AQADM</code> package to grant the required queue privileges to the user.</p>
<p>For example, to grant the <code>ENQUEUE</code> privilege to the <code>hr</code> user on the <code>strmadmin.streams_queue</code> queue, run the following procedure:</p>
<pre>
BEGIN
   DBMS_AQADM.GRANT_QUEUE_PRIVILEGE (
      privilege  =&gt; 'ENQUEUE', 
      queue_name =&gt; 'strmadmin.streams_queue',
      grantee    =&gt; 'hr');
END;
/
</pre>
<p>To grant the <code>DEQUEUE</code> privilege to the <code>hr</code> user on the <code>strmadmin.streams_queue</code> queue, run the following procedure:</p>
<pre>
BEGIN
   DBMS_AQADM.GRANT_QUEUE_PRIVILEGE (
      privilege  =&gt; 'DEQUEUE', 
      queue_name =&gt; 'strmadmin.streams_queue',
      grantee    =&gt; 'hr');
END;
/
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ADQUE0800" href="../../server.112/e11013/aq_admin.htm#ADQUE0800"><span class="italic">Oracle Streams Advanced Queuing User's Guide</span></a></p>
</li>
<li>
<p><a href="#CHDIJFHB">"About Messaging"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABHIJAG"></a><a id="TDPII164"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Correcting an ORA-24033 Error While Enqueuing Messages<a id="sthref778"></a><a id="sthref779"></a><a id="sthref780"></a></h3>
<p>If there are no consumers for a message when a user or application tries to enqueue it, then Oracle Database returns the following error:</p>
<pre>
ORA-24033: no recipients for message
</pre>
<p>The message is not enqueued when Oracle Database returns this message.</p>
<p class="orderedlisttitle">To correct the problem:&nbsp;</p>
<ol>
<li>
<p>Configure at least one consumer for the messages.</p>
</li>
<li>
<p>Enqueue the messages.</p>
</li>
</ol>
<p>Consumers can be:</p>
<ul>
<li>
<p>Applications or users that dequeue and process messages</p>
</li>
<li>
<p>Propagations that send messages from one queue to another</p>
</li>
<li>
<p>Apply processes that can dequeue messages for custom processes in a messaging environment or dequeue changes to database objects in a replication environment</p>
</li>
<li>
<p>Messaging clients that dequeue messages and pass them to an application</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ADQUE0700" href="../../server.112/e11013/aq_trbl.htm#ADQUE0700"><span class="italic">Oracle Streams Advanced Queuing User's Guide</span></a></p>
</li>
<li>
<p><a href="#CHDIJFHB">"About Messaging"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABHFBAB"></a><a id="TDPII185"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Correcting an ORA-02019 Error for a Propagation<a id="sthref782"></a><a id="sthref783"></a><a id="sthref784"></a><a id="sthref785"></a></h3>
<p>A propagation uses the privileges of the database user who owns its source queue when it sends messages. If the source queue owner cannot access the database link used by the propagation, then Oracle Database returns the following error:</p>
<pre>
ORA-02019: connection description for remote database not found
</pre>
<p>The messages are not propagated when Oracle Database returns this message. The easiest way to correct this problem is to delete and re-create the database link so that the source queue owner can access it.</p>
<p class="orderedlisttitle">To delete and re-create a database link:&nbsp;</p>
<ol>
<li>
<p>In Oracle Enterprise Manager, log in to the database as an administrative user, such as the Oracle Streams administrator or <code>SYSTEM</code>.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Click <span class="bold">Schema</span> to open the Schema subpage.</p>
</li>
<li>
<p>Click <span class="bold">Database Links</span> in the Database Objects section.</p>
<p>The Database Links page appears.</p>
</li>
<li>
<p>Use the search tool to list the database link you want to delete and re-create.</p>
</li>
<li>
<p>Select the database link.</p>
</li>
<li>
<p>Click <span class="bold">Delete</span>.</p>
</li>
<li>
<p>Click <span class="bold">Yes</span> on the confirmation page to delete the database link.</p>
</li>
<li>
<p>Follow the instructions in <a href="tdpii_common_ii.htm#BGBGIACD">"Tutorial: Creating a Database Link"</a> to re-create the database link.</p>
</li>
</ol>
<p>To ensure that the source queue owner for the propagation has access to the database link, specify this user as the fixed user in the Connect As section when you create the database link.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDEJBBD">"About Propagations"</a></p>
</li>
<li>
<p><a class="olink ADMIN12150" href="../../server.112/e25494/ds_admin.htm#ADMIN12150"><span class="italic">Oracle Database Administrator's Guide</span></a> for more information about database links</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABDJJDB"></a><a id="TDPII186"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Understanding Why Dequeued Messages Remain in a Queue<a id="sthref787"></a><a id="sthref788"></a><a id="sthref789"></a><a id="sthref790"></a></h3>
<p>A message can remain in a queue after it has been dequeued for the following reasons:</p>
<ul>
<li>
<p>One or more consumers of the message have not yet dequeued it. A message is not removed from a queue until all of its consumers have dequeued it.</p>
</li>
<li>
<p>The message has not been cleaned up by a background process. After all of the consumers of a message have dequeued it, the message remains in the queue until a background process removes it automatically.</p>
</li>
</ul>
<p>If you see messages in a queue that were dequeued by a consumer, then you can use Enterprise Manager to check on the consumers for a message and to determine whether all of the consumers for a message have dequeued it.</p>
<p class="orderedlisttitle">To check on messages in a queue:&nbsp;</p>
<ol>
<li>
<p>Follow the instructions in <a href="#BABBJDHF">"Viewing the Consumers Who Can Dequeue Messages"</a> to view the consumers who can dequeue the messages. If there are multiple consumers for a message, then some consumers might not have dequeued the message yet.</p>
</li>
<li>
<p>Follow the instructions in <a href="#BABBAHDB">"Viewing the Messages in a Queue"</a>. If the Consumers in Different States field shows <code>PROCESSED</code> for a message, then all of the consumers of the message have dequeued it. In this case, the message remains in the queue until the background process removes it automatically.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ADQUE" href="../e11013/toc.htm"><span class="italic">Oracle Streams Advanced Queuing User's Guide</span></a></p>
</li>
<li>
<p><a href="#CHDIJFHB">"About Messaging"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1402">
<tr>
<td class="cellalignment1409">
<table class="cellalignment1407">
<tr>
<td class="cellalignment1406"><a href="tdpii_adpit.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1406"><a href="tdpii_diverge.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2007, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1411">
<table class="cellalignment1405">
<tr>
<td class="cellalignment1406"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1406"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1406"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1406"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1406"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1406"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
