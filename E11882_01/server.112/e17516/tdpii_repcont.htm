<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Replicating Data Using Oracle Streams</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 033" />
<meta name="dcterms.created" content="2011-07-28T22:38:14Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database 2 Day + Data Replication and Integration Guide" />
<meta name="dcterms.identifier" content="E17516-08" />
<meta name="dcterms.isVersionOf" content="TDPII" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2007, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="tdpii_distdbs.htm" title="Previous" type="text/html" />
<link rel="Next" href="tdpii_adcont.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e17516.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">7/14</span> <!-- End Header --><a id="BABEFAFI"></a><a id="TDPII065"></a>
<h1 class="chapter"><span class="secnum">4</span> Replicating Data Using Oracle Streams</h1>
<p>This chapter contains conceptual information about Oracle Streams replication and describes how to replicate data continuously between databases.</p>
<p>This chapter contains the following sections:</p>
<ul>
<li>
<p><a href="#BABEHDDF">About Oracle Streams Replication</a></p>
</li>
<li>
<p><a href="#BABDHIIH">Preparing for Oracle Streams Replication</a></p>
</li>
<li>
<p><a href="#CIHFHFFJ">Configuring Oracle Streams Replication: Examples</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tdpii_adcont.htm#CHDHCDDJ">Chapter 5, "Administering an Oracle Streams Replication Environment"</a></p>
</li>
<li>
<p><a href="tdpii_repextend.htm#BEBHDEHC">Chapter 6, "Extending an Oracle Streams Replication Environment"</a></p>
</li>
<li>
<p><a class="olink STREP" href="../e10705/toc.htm"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a></p>
</li>
<li>
<p><a href="tdpii_reppit.htm#BEHHGGIB">Chapter 7, "Replicating Data Using Materialized Views"</a></p>
</li>
</ul>
</div>
<a id="BABEHDDF"></a><a id="TDPII066"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">About Oracle Streams Replication<a id="sthref103"></a><a id="sthref104"></a><a id="sthref105"></a><a id="sthref106"></a><a id="sthref107"></a></h2>
<p><span class="bold">Replication</span> is the process of sharing database objects and data at multiple databases. To maintain the database objects and data at multiple databases, a change to one of these database objects at a database is shared with the other databases. In this way, the database objects and data are kept synchronized at all of the databases in the replication environment.</p>
<p>Some replication environments must continually replicate the changes made to shared database objects. <span class="bold">Oracle Streams</span> is the Oracle Database feature for continuous replication. Typically, in such environments, the databases that contain the shared database objects are connected to the network nearly all the time and continually push database changes over these network connections.</p>
<p>When a change is made to one shared database object, Oracle Streams performs the following actions to ensure that the same change is made to the corresponding shared database object at each of the other databases:</p>
<ol>
<li>
<p>Oracle Streams automatically captures the change and stages it in a queue.</p>
</li>
<li>
<p>Oracle Streams automatically pushes the change to a queue in each of the other databases that contain the shared database object.</p>
</li>
<li>
<p>Oracle Streams automatically consumes the change at each of the other databases. During consumption, Oracle Streams dequeues the change and applies the change to the shared database object.</p>
</li>
</ol>
<p><a href="#BABBCJFA">Figure 4-1</a> shows the Oracle Streams information flow:</p>
<div class="figure">
<p class="titleinfigure"><a id="BABBCJFA"></a><a id="TDPII218"></a>Figure 4-1 Oracle Streams Information Flow</p>
<img width="600" height="80" src="img/tdpii022.gif" alt="Description of Figure 4-1 follows" /><br />
<a id="sthref108" href="img_text/tdpii022.htm">Description of "Figure 4-1 Oracle Streams Information Flow"</a><br />
<br /></div>
<!-- class="figure" -->
<p>You can use Oracle Streams replication to share data at multiple databases and efficiently keep the data current at these databases. For example, a company with several call centers throughout the world might want to store customer information in a local database at each call center. In such an environment, continuous replication with Oracle Streams can ensure that a change made to customer data at one location is pushed to all of the other locations as soon as possible.</p>
<p><a id="sthref109"></a><a id="sthref110"></a><a id="sthref111"></a>When you use Oracle Streams to capture changes to database objects, the changes are formatted into <span class="bold">logical change records (LCRs)</span>. An LCR is a message with a specific format that describes a database change. If the change was a data manipulation language (DML) operation, then a <span class="bold">row LCR</span> encapsulates each row change resulting from the DML operation. One DML operation might result in multiple row changes, and so one DML operation might result in multiple row LCRs. If the change was a data definition language (DDL) operation, then a single <span class="bold">DDL LCR</span> encapsulates the DDL change.</p>
<p>The following topics describe Oracle Streams replication in more detail:</p>
<ul>
<li>
<p><a href="#BABJGJEH">About Change Capture</a></p>
</li>
<li>
<p><a href="#BABFIHAI">About Change Propagation Between Databases</a></p>
</li>
<li>
<p><a href="#BABBAJFE">About Change Apply</a></p>
</li>
<li>
<p><a href="#BABHHDGG">About Rules for Controlling the Behavior of Capture, Propagation, and Apply</a></p>
</li>
<li>
<p><a href="#BABECEFJ">About Rule-Based Transformations for Nonidentical Copies</a></p>
</li>
<li>
<p><a href="#CIHJCGBA">About Supplemental Logging</a></p>
</li>
<li>
<p><a href="#BABGAACC">About Conflicts and Conflict Resolution</a></p>
</li>
<li>
<p><a href="#BABICHGF">About Tags for Avoiding Change Cycling</a></p>
</li>
<li>
<p><a href="#CIHGGCCB">About the Common Types of Oracle Streams Replication Environments</a></p>
</li>
<li>
<p><a href="#CIHGFFFF">About Key Oracle Streams Supplied PL/SQL Packages and Data Dictionary Views</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tdpii_intro2ii.htm#CFHJAAEA">"When to Replicate Data with Oracle Streams"</a></p>
</li>
</ul>
</div>
<a id="BABJGJEH"></a><a id="TDPII067"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Change Capture<a id="sthref112"></a><a id="sthref113"></a></h3>
<p>Oracle Streams provides two ways to capture database changes automatically:</p>
<ul>
<li>
<p>Use a <span class="bold">capture process</span> to capture data manipulation language (DML) changes to a relatively large number of tables, an entire schema, or a database. Also, a capture process must be used to capture data definition language (DDL) changes to tables and other database objects. See <a href="#BABBFECB">"About Change Capture with a Capture Process"</a>.</p>
</li>
<li>
<p>Use a <span class="bold">synchronous capture</span> to capture DML changes to a relatively small number of tables. See <a href="#BABJJJDE">"About Change Capture with a Synchronous Capture"</a>.</p>
</li>
</ul>
<p>A single capture process or a single synchronous capture can capture changes made to only one database. The database where a change originated is called the <span class="bold">source database</span> for the change.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The examples in this guide replicate DML changes only. You should understand the implications of replicating DDL changes before doing so. See <a class="olink STREP163" href="../../server.112/e10705/prep_rep.htm#STREP163"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> and <a class="olink ARPLS878" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS878"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about replicating DDL changes.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tdpii_adcont.htm#CHDGHGBI">"Managing Capture Processes"</a></p>
</li>
<li>
<p><a href="#BABDHIIH">"Preparing for Oracle Streams Replication"</a></p>
</li>
</ul>
</div>
<a id="BABBFECB"></a><a id="TDPII068"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">About Change Capture with a Capture Process<a id="sthref114"></a><a id="sthref115"></a><a id="sthref116"></a><a id="sthref117"></a><a id="sthref118"></a></h4>
<p>A <span class="bold">capture process</span> is an optional Oracle Database background process that asynchronously captures changes recorded in the redo log. When a capture process captures a database change, it converts it into a logical change record (LCR) and enqueues the LCR. <span class="bold">Enqueuing</span> is the process of placing messages into queues.</p>
<p>A capture process is always associated with a single queue, and it enqueues LCRs into this queue only. For improved performance, captured LCRs are always stored in a <span class="bold">buffered queue</span>, which is System Global Area (SGA) memory associated with a queue.</p>
<p><a href="#BABGECJA">Figure 4-2</a> shows how a capture process works.</p>
<div class="figure">
<p class="titleinfigure"><a id="BABGECJA"></a><a id="TDPII219"></a>Figure 4-2 Capture Process</p>
<img width="201" height="350" src="img/tdpii012.gif" alt="Description of Figure 4-2 follows" /><br />
<a id="sthref119" href="img_text/tdpii012.htm">Description of "Figure 4-2 Capture Process"</a><br />
<br /></div>
<!-- class="figure" -->
<p><a id="sthref120"></a><a id="sthref121"></a>A capture process can run on the source database or on a remote database. When a capture process runs on the source database, the capture process is called a <span class="bold">local capture process</span>. When a capture process runs on a remote database, the capture process is called a <span class="bold">downstream capture process</span>.</p>
<p>With downstream capture, redo transport services use the log writer process (LGWR) at the source database to send redo data to the database that runs the downstream capture process. A downstream capture process requires fewer resources at the source database because a different database captures the changes. A local capture process, however, is easier to configure and manage than a downstream capture process. Local capture processes also provide more flexibility in replication environments with different platforms or different versions of Oracle Database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#BABIJCDG">"Tutorial: Configuring Two-Database Replication with a Downstream Capture Process"</a></p>
</li>
<li>
<p><a href="#BABBIBCD">"Tutorial: Configuring Hub-and-Spoke Replication with Local Capture Processes"</a></p>
</li>
<li>
<p><a href="tdpii_adcont.htm#CHDGHGBI">"Managing Capture Processes"</a></p>
</li>
<li>
<p><a href="tdpii_adcont.htm#CHDHEHGH">"Monitoring Capture Processes"</a></p>
</li>
<li>
<p><a class="olink STRMS002" href="../../server.112/e17069/strms_capture.htm#STRMS002"><span class="italic">Oracle Streams Concepts and Administration</span></a></p>
</li>
<li>
<p><a class="olink ADMQS12049" href="../../server.112/e10897/storage.htm#ADMQS12049"><span class="italic">Oracle Database 2 Day DBA</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="BABJJJDE"></a><a id="TDPII069"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">About Change Capture with a Synchronous Capture<a id="sthref122"></a><a id="sthref123"></a></h4>
<p>Instead of asynchronously mining the redo log, a <span class="bold">synchronous capture</span> uses an internal mechanism to capture data manipulation language (DML) changes when they are made to tables. A single DML change can result in changes to one or more rows in the table. A synchronous capture captures each row change, converts it into a row logical change record (LCR), and enqueues it.</p>
<p>A synchronous capture is always associated with a single queue, and it enqueues row LCRs into this queue only. Synchronous capture always enqueues row LCRs into the <span class="bold">persistent queue</span>. The persistent queue is the portion of a queue that stores messages on hard disk in a queue table, not in memory.</p>
<p>It is usually best to use synchronous capture in a replication environment that captures changes to a relatively small number of tables. If you must capture changes to many tables, to an entire schema, or to an entire database, then you should use a capture process instead of a synchronous capture.</p>
<p><a href="#BABCGIHC">Figure 4-3</a> shows how a synchronous capture works.</p>
<div class="figure">
<p class="titleinfigure"><a id="BABCGIHC"></a><a id="TDPII220"></a>Figure 4-3 Synchronous Capture</p>
<img width="240" height="350" src="img/tdpii058.gif" alt="Description of Figure 4-3 follows" /><br />
<a id="sthref124" href="img_text/tdpii058.htm">Description of "Figure 4-3 Synchronous Capture"</a><br />
<br /></div>
<!-- class="figure" -->
<div class="infobox-note">
<p class="notep1">Note:</p>
If you are using Oracle Database 11<span class="italic">g</span> Standard Edition, then synchronous capture is the only Oracle Streams component that can capture database changes automatically. To use capture processes, you must have Oracle Database 11<span class="italic">g</span> Enterprise Edition.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#BABDEBBA">"Tutorial: Configuring Two-Database Replication with Synchronous Captures"</a></p>
</li>
<li>
<p><a class="olink STRMS168" href="../../server.112/e17069/strms_capture.htm#STRMS168"><span class="italic">Oracle Streams Concepts and Administration</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BABFIHAI"></a><a id="TDPII070"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Change Propagation Between Databases<a id="sthref125"></a><a id="sthref126"></a><a id="sthref127"></a><a id="sthref128"></a></h3>
<p>A <span class="bold">propagation</span> sends messages from one queue to another. You can use Oracle Streams to configure message propagation between two queues in the same database or in different databases. Oracle Streams uses a database link and Oracle Scheduler jobs to send messages. A propagation is always between a <span class="bold">source queue</span> and a <span class="bold">destination queue</span>. In an Oracle Streams replication environment, a propagation typically sends messages that describe database changes (in the form of LCRs) from a source queue in the local database to a destination queue in a remote database.</p>
<p><a href="#BABJJDFF">Figure 4-4</a> shows a propagation.</p>
<div class="figure">
<p class="titleinfigure"><a id="BABJJDFF"></a><a id="TDPII221"></a>Figure 4-4 Propagation</p>
<img width="282" height="156" src="img/tdpii008.gif" alt="Description of Figure 4-4 follows" /><br />
<a id="sthref129" href="img_text/tdpii008.htm">Description of "Figure 4-4 Propagation"</a><br />
<br /></div>
<!-- class="figure" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tdpii_adcont.htm#CHDEAIGJ">"Enabling and Disabling a Propagation"</a></p>
</li>
<li>
<p><a href="tdpii_adcont.htm#CHDJHIIE">"Monitoring Propagations"</a></p>
</li>
<li>
<p><a href="tdpii_common_ii.htm#BGBGIACD">"Tutorial: Creating a Database Link"</a></p>
</li>
<li>
<p><a class="olink ADMIN033" href="../../server.112/e25494/schedover.htm#ADMIN033"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about Oracle Scheduler</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABBAJFE"></a><a id="TDPII071"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Change Apply<a id="sthref130"></a><a id="sthref131"></a></h3>
<p>After database changes have been captured and propagated, they reside in a queue and are ready to be applied to complete the replication process. An <span class="bold">apply process</span> is an optional Oracle Database background process that dequeues logical change records (LCRs) and other types of messages from a specific queue. <span class="bold">Dequeuing</span> is the process of retrieving messages from queues. In a simple Oracle Streams replication environment, an apply process typically applies the changes in the LCRs that it dequeues directly to the database objects in the local database.</p>
<p>An apply process is always associated with a single queue, and it dequeues messages from this queue only. A single apply process either can dequeue messages from the buffered queue or from the persistent queue, but not both. Therefore, if an apply process applies changes that were captured by a capture process, then the apply process must be configured to dequeue LCRs from the buffered queue. However, if an apply process applies changes that were captured by a synchronous capture, then the apply process must be configured to dequeue LCRs from the persistent queue.</p>
<p><a href="#BABHCJAI">Figure 4-5</a> shows how an apply process works.</p>
<div class="figure">
<p class="titleinfigure"><a id="BABHCJAI"></a><a id="TDPII222"></a>Figure 4-5 Apply Process</p>
<img width="231" height="201" src="img/tdpii013.gif" alt="Description of Figure 4-5 follows" /><br />
<a id="sthref132" href="img_text/tdpii013.htm">Description of "Figure 4-5 Apply Process"</a><br />
<br /></div>
<!-- class="figure" -->
<p>When an apply process cannot apply an LCR successfully, it moves the LCR, and all of the other LCRs in the transaction, to a special queue called the <span class="bold">error queue</span>. The error queue contains all of the current apply errors for a database. If there are multiple apply processes in a database, then the error queue contains the apply errors for each apply process. You can correct the condition that caused an error and then reexecute the corresponding transaction in the error queue to apply its changes. For example, you might modify a row in a table to correct the condition that caused an error in a transaction and then reexecute the transaction.</p>
<p><a id="sthref133"></a><a id="sthref134"></a><a id="sthref135"></a>For an apply process to apply changes to a database object, an <span class="bold">instantiation system change number (SCN)</span> must be set for the database object. An instantiation SCN is the SCN for a database object that specifies that only changes that were committed after the SCN at the source database are applied by an apply process. The instantiation SCN for a table assumes that the table is consistent at the source and destination database at the specified SCN. Typically, the instantiation SCN is set automatically when you configure the Oracle Streams replication environment.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
<a id="sthref136"></a><a id="sthref137"></a>An apply process can also pass a message that it dequeues to an <span class="bold">apply handler</span>. An apply handler is either a collection of SQL statements or a user-defined PL/SQL procedure that performs custom processing of the message. Apply handlers are beyond the scope of this guide. See <a class="olink STRMS175" href="../../server.112/e17069/strms_apply.htm#STRMS175"><span class="italic">Oracle Streams Concepts and Administration</span></a> for more information.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tdpii_adcont.htm#CHDIJJGJ">"Managing Apply Processes"</a></p>
</li>
<li>
<p><a href="tdpii_adcont.htm#CHDBJIHG">"Monitoring Apply Processes"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABHHDGG"></a><a id="TDPII072"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Rules for Controlling the Behavior of Capture, Propagation, and Apply<a id="sthref138"></a><a id="sthref139"></a><a id="sthref140"></a><a id="sthref141"></a><a id="sthref142"></a><a id="sthref143"></a><a id="sthref144"></a></h3>
<p>An Oracle Streams replication configuration must identify what to replicate. Capture processes, synchronous captures, propagations, and apply processes are called <span class="bold">Oracle Streams clients</span>. <span class="bold">Rules</span> determine what Oracle Streams clients replicate. You can configure rules for each Oracle Streams client independently, and the rules for different Oracle Streams clients do not need to match.</p>
<p>Rules can be organized into <span class="bold">rule sets</span>, and the behavior of each Oracle Streams client is determined by the rules in the rule sets that are associated with it. You can associate a <span class="bold">positive rule set</span> and a <span class="bold">negative rule set</span> with a capture process, a propagation, and an apply process, but a synchronous capture can only have a positive rule set.</p>
<p>In a replication environment, an Oracle Streams client performs its task if a database change satisfies its rule sets. In general, a change satisfies the rule sets for an Oracle Streams client if <span class="italic">no rules</span> in the negative rule set evaluate to <code>TRUE</code> for the change, and at least one rule in the positive rule set evaluates to <code>TRUE</code> for the change. The negative rule set is always evaluated first.</p>
<p>Specifically, you use rule sets in an Oracle Streams replication environment to do the following:</p>
<ul>
<li>
<p><a id="sthref145"></a><a id="sthref146"></a>Specify the changes that a capture process captures from the redo log or discards. If a change found in the redo log satisfies the rule sets for a capture process, then the capture process captures the change. If a change found in the redo log does not satisfy the rule sets for a capture process, then the capture process discards the change.</p>
</li>
<li>
<p><a id="sthref147"></a><a id="sthref148"></a>Specify the changes that a synchronous capture captures. If a data manipulation language (DML) change satisfies the rule set for a synchronous capture, then the synchronous capture captures the change immediately after the change is committed. If a DML change made to a table does not satisfy the rule set for a synchronous capture, then the synchronous capture does not capture the change.</p>
</li>
<li>
<p><a id="sthref149"></a><a id="sthref150"></a>Specify the changes (encapsulated in LCRs) that a propagation sends from one queue to another or discards. If an LCR in a queue satisfies the rule sets for a propagation, then the propagation sends the LCR. If an LCR in a queue does not satisfy the rule sets for a propagation, then the propagation discards the LCR.</p>
</li>
<li>
<p><a id="sthref151"></a><a id="sthref152"></a>Specify the LCRs that an apply process dequeues or discards. If an LCR in a queue satisfies the rule sets for an apply process, then the apply process dequeues and processes the LCR. If an LCR in a queue does not satisfy the rule sets for an apply process, then the apply process discards the LCR.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STRMS006" href="../../server.112/e17069/strms_rules.htm#STRMS006"><span class="italic">Oracle Streams Concepts and Administration</span></a> for detailed information about rules</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABECEFJ"></a><a id="TDPII073"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Rule-Based Transformations for Nonidentical Copies<a id="sthref153"></a><a id="sthref154"></a><a id="sthref155"></a><a id="sthref156"></a><a id="sthref157"></a></h3>
<p>A <span class="bold">rule-based transformation</span> is an additional configuration option that provides flexibility when a database object is not identical at the different databases. Rule-based transformations modify changes to a database object so that the changes can be applied successfully at each database. Specifically, a rule-based transformation is any modification to a message when a rule in a positive rule set evaluates to <code>TRUE</code>.</p>
<p>For example, suppose a table has five columns at the database where changes originated, but the shared table at a different database only has four of the five columns. When a data manipulation language (DML) operation is performed on the table at the source database, the row changes are captured and formatted as row LCRs. A rule-based transformation can delete the extra column in these row LCRs so that they can be applied successfully at the other database. If the row LCRs are not transformed, then the apply process at the other database will raise errors because the row LCRs have an extra column.</p>
<p>There are two types of rule-based transformations: <span class="bold">declarative</span> and <span class="bold">custom</span>. Declarative rule-based transformations include a set of common transformation scenarios for row changes resulting from DML changes (row LCRs). Custom rule-based transformations require a user-defined PL/SQL function to perform the transformation. This guide discusses only declarative rule-based transformations.</p>
<p>The following declarative rule-based transformations are available:</p>
<ul>
<li>
<p>An add column transformation adds a column to a row LCR.</p>
</li>
<li>
<p>A delete column transformation deletes a column from a row LCR.</p>
</li>
<li>
<p>A keep columns transformation keeps a list of columns in a row LCR, while deleting the columns that are not in the list.</p>
</li>
<li>
<p>A rename column transformation renames a column in a row LCR.</p>
</li>
<li>
<p>A rename schema transformation renames the schema in a row LCR.</p>
</li>
<li>
<p>A rename table transformation renames the table in a row LCR.</p>
</li>
</ul>
<p>When you add one of these declarative rule-based transformations, you specify the rule to associate with the transformation. When the specified rule evaluates to <code>TRUE</code> for a row LCR, Oracle Streams performs the declarative transformation internally on the row&nbsp;LCR. Typically, rules and rule sets are created automatically when you configure your Oracle Streams replication environment.</p>
<p>You can configure multiple declarative rule-based transformations for a single rule, but you can only configure one custom rule-based transformation for a single rule. In addition, you can configure declarative rule-based transformations and a custom rule-based transformation for a single rule.</p>
<p>A transformation can occur at any stage in the Oracle Streams information flow: during capture, propagation, or apply. When a transformation occurs depends on the rule with which the transformation is associated. For example, to perform a transformation during propagation, associate the transformation with a rule in the positive rule set for a propagation.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STRMS106" href="../../server.112/e17069/strms_transform.htm#STRMS106"><span class="italic">Oracle Streams Concepts and Administration</span></a> for detailed information about rule-based transformations</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CIHJCGBA"></a><a id="TDPII173"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Supplemental Logging<a id="sthref158"></a><a id="sthref159"></a><a id="sthref160"></a></h3>
<p><span class="bold">Supplemental logging</span> is the process of adding additional column data to the redo log whenever an operation is performed (such as a row update). A capture process captures this additional information and places it in logical change records (LCRs). Apply processes that apply these LCRs might need this additional information to apply database changes properly.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STREP107" href="../../server.112/e10705/prep_rep.htm#STREP107"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for detailed information about supplemental logging</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABGAACC"></a><a id="TDPII074"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Conflicts and Conflict Resolution<a id="sthref161"></a><a id="sthref162"></a><a id="sthref163"></a><a id="sthref164"></a><a id="sthref165"></a></h3>
<p><span class="bold">Conflicts</span> occur when two different databases that are sharing data in a table modify the same row in the table at nearly the same time. When these changes are captured at one of these databases and sent to the other database, an apply process detects the conflict when it attempts to apply a row LCR to the table. By default, apply errors are placed in the error queue, where they can be resolved manually. To avoid apply errors, you must configure conflict resolution so that apply processes handle conflicts in the best way for your environment.</p>
<p>Oracle Database supplies prebuilt conflict handlers that provide conflict resolution when a conflict results from an <code>UPDATE</code> on a row. These handlers are called <span class="bold">prebuilt update conflict handlers</span>.</p>
<p>When an apply process encounters an update conflict for a row LCR that it has dequeued, it must either apply the row LCR or discard it to keep the data in the two databases consistent. The most common way to resolve update conflicts is to keep the change with the most recent time stamp and discard the older change. See <a href="#CIHIACBB">"Tutorial: Configuring Latest Time Conflict Resolution for a Table"</a> for instructions about configuring latest time conflict resolution for a table.</p>
<p>The following topics discuss how to configure conflict resolution in a particular type of replication environment:</p>
<ul>
<li>
<p><a href="#CIHDBCGD">Tutorial: Configuring Two-Database Replication with Local Capture Processes</a></p>
</li>
<li>
<p><a href="#BABBIBCD">Tutorial: Configuring Hub-and-Spoke Replication with Local Capture Processes</a></p>
</li>
<li>
<p><a href="#BABDEBBA">Tutorial: Configuring Two-Database Replication with Synchronous Captures</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Conflicts are not possible in a replication environment when changes to only one database are captured. In these replication environments, typically the replicas at the other databases are read-only.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CIHIACBB">"Tutorial: Configuring Latest Time Conflict Resolution for a Table"</a></p>
</li>
<li>
<p><a href="tdpii_adcont.htm#CHDCBHGC">"Displaying the Configured Update Conflict Handlers"</a></p>
</li>
<li>
<p><a class="olink STREP001" href="../../server.112/e10705/conflict.htm#STREP001"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for detailed information about conflicts and conflict resolution</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABICHGF"></a><a id="TDPII075"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Tags for Avoiding Change Cycling<a id="sthref166"></a><a id="sthref167"></a><a id="sthref168"></a></h3>
<p><span class="bold">Change cycling</span> means sending a change back to the database where it originated. Typically, change cycling should be avoided because it can result in each database change going through endless loops to the database where it originated. Such loops can result in unintended data in the database and tax the networking and computer resources of an environment. By default, Oracle Streams is designed to avoid change cycling.</p>
<p>A <span class="bold">tag</span> is additional information in a change record. Each redo entry that records a database change and each logical change record (LCR) that encapsulates a database change includes a tag. The data type of the tag is <code>RAW</code>.</p>
<p>By default, change records have the following tag values:</p>
<ul>
<li>
<p>When a user or application generates database changes, the value of the tag is <code>NULL</code> for each change. This default can be changed for a particular database session.</p>
</li>
<li>
<p>When an apply process generates database changes by applying them to database objects, the tag value for each change is the hexadecimal equivalent of <code>'00'</code> (double zero). This default can be changed for a particular apply process.</p>
</li>
</ul>
<p>The tag value in an LCR depends on how the LCR was captured:</p>
<ul>
<li>
<p>An LCR captured by a capture process has the tag value of the redo record that was captured.</p>
</li>
<li>
<p>An LCR captured by a synchronous capture has the tag value of the database session that made the change.</p>
</li>
</ul>
<p>Rules for Oracle Streams clients can include conditions for tag values. For example, the rules for a capture process can determine whether a change in the redo log is captured based on the tag value of the redo record. In an Oracle Streams replication environment, Oracle Streams clients use tags and rules to avoid change cycling.</p>
<p>The following topics discuss how change cycling is avoided in a particular type of replication environment:</p>
<ul>
<li>
<p><a href="#CIHDBCGD">Tutorial: Configuring Two-Database Replication with Local Capture Processes</a></p>
</li>
<li>
<p><a href="#BABBIBCD">Tutorial: Configuring Hub-and-Spoke Replication with Local Capture Processes</a></p>
</li>
<li>
<p><a href="#BABDEBBA">Tutorial: Configuring Two-Database Replication with Synchronous Captures</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
<ul>
<li>
<p>Change cycling is not possible in a replication environment when changes to only one database are captured.</p>
</li>
<li>
<p>You can also use tags to avoid replicating the changes made by a particular session. Use the <a class="olink ARPLS504" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS504"><code>DBMS_STREAMS.SET_TAG</code></a> procedure to set the tag for a session. See <a href="tdpii_adcont.htm#CHDEBFIJ">"Correcting Apply Errors in Database Objects"</a> for an example.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tdpii_adcont.htm#CHDJBAJD">"Managing Apply Errors"</a></p>
</li>
<li>
<p><a class="olink STREP008" href="../../server.112/e10705/rep_tags.htm#STREP008"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for detailed information about tags</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CIHGGCCB"></a><a id="TDPII077"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About the Common Types of Oracle Streams Replication Environments</h3>
<p>Oracle Streams enables you to configure many different types of custom replication environments. However, three types of replication environments are the most common: two-database, hub-and-spoke, and n-way.</p>
<p>The following topics describe these common types of replication environments and help you decide which one is best for you:</p>
<ul>
<li>
<p><a href="#CIHGHCGI">About Two-Database Replication Environments</a></p>
</li>
<li>
<p><a href="#CIHJEIDB">About Hub-And-Spoke Replication Environments</a></p>
</li>
<li>
<p><a href="#CIHEBHDG">About N-Way Replication Environments</a></p>
</li>
</ul>
<a id="CIHGHCGI"></a><a id="TDPII190"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">About Two-Database Replication Environments<a id="sthref169"></a><a id="sthref170"></a></h4>
<p>A <span class="bold">two-database replication environment</span> is one in which only two databases share the replicated database objects. The changes made to replicated database objects at one database are captured and sent directly to the other database, where they are applied. In a two-database replication environment, only one database might allow changes to the database objects, or both databases might allow changes to them.</p>
<p>If only one database allows changes to the replicated database objects, then the other database contains read-only replicas of these database objects. This is a <span class="bold">one-way replication environment</span> and typically has the following basic components:</p>
<ul>
<li>
<p>The first database has a capture process or synchronous capture to capture changes to the replicated database objects.</p>
</li>
<li>
<p>The first database has a propagation that sends the captured changes to the other database.</p>
</li>
<li>
<p>The second database has an apply process to apply changes from the first database.</p>
</li>
<li>
<p>For the best performance, each capture process and apply process has its own queue.</p>
</li>
</ul>
<p><a href="#CIHDICJF">Figure 4-6</a> shows a two-database replication environment configured for one-way replication.</p>
<div class="figure">
<p class="titleinfigure"><a id="CIHDICJF"></a><a id="TDPII223"></a>Figure 4-6 One-Way Replication in a Two-Database Replication Environment</p>
<img width="260" height="92" src="img/tdpii510.gif" alt="Description of Figure 4-6 follows" /><br />
<a id="sthref171" href="img_text/tdpii510.htm">Description of "Figure 4-6 One-Way Replication in a Two-Database Replication Environment"</a><br />
<br /></div>
<!-- class="figure" -->
<p>In a two-database replication environment, both databases can allow changes to the replicated database objects. In this case, both databases capture changes to these database objects and send the changes to the other database, where they are applied. This is a <span class="bold">bi-directional replication environment</span> and typically has the following basic components:</p>
<ul>
<li>
<p>Each database has a capture process or synchronous capture to capture changes to the replicated database objects.</p>
</li>
<li>
<p>Each database has a propagation that sends the captured changes to the other database.</p>
</li>
<li>
<p>Each database has an apply process to apply changes from the other database.</p>
</li>
<li>
<p>For the best performance, each capture process and apply process has its own queue.</p>
</li>
</ul>
<p><a href="#CIHIFIAG">Figure 4-7</a> show a two-database replication environment configured for bi-directional replication.</p>
<div class="figure">
<p class="titleinfigure"><a id="CIHIFIAG"></a><a id="TDPII224"></a>Figure 4-7 Bi-Directional Replication in a Two-Database Replication Environment</p>
<img width="260" height="92" src="img/tdpii511.gif" alt="Description of Figure 4-7 follows" /><br />
<a id="sthref172" href="img_text/tdpii511.htm">Description of "Figure 4-7 Bi-Directional Replication in a Two-Database Replication Environment"</a><br />
<br /></div>
<!-- class="figure" -->
<p>Typically, in a bi-directional replication environment, you should configure conflict resolution to keep the replicated database objects synchronized. You can configure a two-database replication environment using Setup Streams Replication Wizard in Oracle Enterprise Manager or the configuration procedures in the <code>DBMS_STREAMS_ADM</code> package.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CIHDBCGD">"Tutorial: Configuring Two-Database Replication with Local Capture Processes"</a></p>
</li>
<li>
<p><a href="#BABIJCDG">"Tutorial: Configuring Two-Database Replication with a Downstream Capture Process"</a></p>
</li>
<li>
<p><a href="#BABDEBBA">"Tutorial: Configuring Two-Database Replication with Synchronous Captures"</a></p>
</li>
<li>
<p><a href="#BABGAACC">"About Conflicts and Conflict Resolution"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CIHJEIDB"></a><a id="TDPII134"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">About Hub-And-Spoke Replication Environments<a id="sthref173"></a><a id="sthref174"></a></h4>
<p>A <span class="bold">hub-and-spoke replication environment</span> is one in which a central database, or hub, communicates with secondary databases, or spokes. The spokes do not communicate directly with each other. In a hub-and-spoke replication environment, the spokes might or might not allow changes to the replicated database objects.</p>
<p>If the spokes do not allow changes, then they contain read-only replicas of the database objects at the hub. This type of hub-and-spoke replication environment typically has the following basic components:</p>
<ul>
<li>
<p>The hub has a capture process or synchronous capture to capture changes to the replicated database objects.</p>
</li>
<li>
<p>The hub has propagations that send the captured changes to each of the spokes.</p>
</li>
<li>
<p>Each spoke has an apply process to apply changes from the hub.</p>
</li>
<li>
<p>For the best performance, each capture process and apply process has its own queue.</p>
</li>
</ul>
<p><a href="#CIHCDDEC">Figure 4-8</a> shows a hub-and-spoke replication environment with read-only spokes.</p>
<div class="figure">
<p class="titleinfigure"><a id="CIHCDDEC"></a><a id="TDPII225"></a>Figure 4-8 Hub-and-Spoke Replication Environment with Read-Only Spokes</p>
<img width="260" height="357" src="img/tdpii502.gif" alt="Description of Figure 4-8 follows" /><br />
<a id="sthref175" href="img_text/tdpii502.htm">Description of "Figure 4-8 Hub-and-Spoke Replication Environment with Read-Only Spokes"</a><br />
<br /></div>
<!-- class="figure" -->
<p>If the spokes allow changes to the database objects, then typically the changes are captured and sent back to the hub, and the hub replicates the changes with the other spokes. This type of hub-and-spoke replication environment typically has the following basic components:</p>
<ul>
<li>
<p>The hub has a capture process or synchronous capture to capture changes to the replicated database objects.</p>
</li>
<li>
<p>The hub has propagations that send the captured changes to each of the spokes.</p>
</li>
<li>
<p>Each spoke has a capture process or synchronous capture to capture changes to the replicated database objects.</p>
</li>
<li>
<p>Each spoke has a propagation that sends changes made at the spoke back to the hub.</p>
</li>
<li>
<p>Each spoke has an apply process to apply changes from the hub and from the other spokes.</p>
</li>
<li>
<p>The hub has a separate apply process to apply changes from each spoke. A different apply process must apply changes from each spoke.</p>
</li>
<li>
<p>For the best performance, each capture process and apply process has its own queue.</p>
</li>
</ul>
<p><a href="#CIHBEFBE">Figure 4-9</a> shows a hub-and-spoke replication environment with read/write spokes.</p>
<div class="figure">
<p class="titleinfigure"><a id="CIHBEFBE"></a><a id="TDPII226"></a>Figure 4-9 Hub-and-Spoke Replication Environment with Read/Write Spokes</p>
<img width="261" height="357" src="img/tdpii503.gif" alt="Description of Figure 4-9 follows" /><br />
<a id="sthref176" href="img_text/tdpii503.htm">Description of "Figure 4-9 Hub-and-Spoke Replication Environment with Read/Write Spokes"</a><br />
<br /></div>
<!-- class="figure" -->
<p>Typically, in a hub-and-spoke replication environment that allows changes at spoke databases, you should configure conflict resolution to keep the replicated database objects synchronized. Some hub-and-spoke replication environments allow changes to the replicated database objects at some spokes but not at others.</p>
<p>You can configure a hub-and-spoke replication environment using the Setup Streams Replication Wizard in Oracle Enterprise Manager or the configuration procedures in the <code>DBMS_STREAMS_ADM</code> package.</p>
<p>See <a href="tdpii_intro2ii.htm#CFHJAAEA">"When to Replicate Data with Oracle Streams"</a> for information about when hub-and-spoke replication is useful.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#BABBIBCD">"Tutorial: Configuring Hub-and-Spoke Replication with Local Capture Processes"</a></p>
</li>
<li>
<p><a href="#BABGAACC">"About Conflicts and Conflict Resolution"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CIHEBHDG"></a><a id="TDPII135"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">About N-Way Replication Environments<a id="sthref177"></a><a id="sthref178"></a></h4>
<p>An <span class="bold">n-way replication environment</span> is one in which each database communicates directly with each other database in the environment. The changes made to replicated database objects at one database are captured and sent directly to each of the other databases in the environment, where they are applied.</p>
<p>An n-way replication environment typically has the following basic components:</p>
<ul>
<li>
<p>Each database has one or more capture processes or synchronous captures to capture changes to the replicated database objects.</p>
</li>
<li>
<p>Each database has propagations that send the captured changes to each of the other databases.</p>
</li>
<li>
<p>Each database has apply processes that apply changes from each of the other databases. A different apply process must apply changes from each source database.</p>
</li>
<li>
<p>For the best performance, each capture process and apply process has its own queue.</p>
</li>
</ul>
<p><a href="#CIHEAJED">Figure 4-10</a> shows an n-way replication environment.</p>
<div class="figure">
<p class="titleinfigure"><a id="CIHEAJED"></a><a id="TDPII227"></a>Figure 4-10 N-Way Replication Environment</p>
<img width="260" height="225" src="img/tdpii501.gif" alt="Description of Figure 4-10 follows" /><br />
<a id="sthref179" href="img_text/tdpii501.htm">Description of "Figure 4-10 N-Way Replication Environment"</a><br />
<br /></div>
<!-- class="figure" -->
<p><a id="sthref180"></a><a id="sthref181"></a><a id="sthref182"></a>You can configure an n-way replication environment by using the following Oracle-supplied packages:</p>
<ul>
<li>
<p><code>DBMS_STREAMS_ADM</code> can perform most of the configuration actions, including setting up queues, creating capture processes or synchronous captures, creating propagations, creating apply processes, and configuring rules and rule sets for the replication environment.</p>
</li>
<li>
<p><code>DBMS_CAPTURE_ADM</code> can start any capture processes you configured in the replication environment.</p>
</li>
<li>
<p><code>DBMS_APPLY_ADM</code> can configure apply processes, configure conflict resolution, and start apply processes, as well as other configuration tasks.</p>
</li>
</ul>
<p>See <a href="tdpii_intro2ii.htm#CFHJAAEA">"When to Replicate Data with Oracle Streams"</a> for information about when n-way replication is useful.</p>
<p>Typically, in an n-way replication environment, you should configure conflict resolution to keep the replicated database objects synchronized.</p>
<p>Configuring an n-way replication environment is beyond the scope of this guide. See <a class="olink STREX004" href="../../server.112/e12862/repmultdemo.htm#STREX004"><span class="italic">Oracle Streams Extended Examples</span></a> for a detailed example that configures an n-way replication environment.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CIHGFFFF"></a><a id="TDPII187"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Key Oracle Streams Supplied PL/SQL Packages and Data Dictionary Views<a id="sthref183"></a><a id="sthref184"></a></h3>
<p>In addition to Oracle Enterprise Manager, you can use several supplied PL/SQL packages to configure and administer an Oracle Streams replication environment. You can also use several data dictionary views to monitor an Oracle Streams replication environment.</p>
<p>The following topics describe the key Oracle Streams supplied PL/SQL packages and data dictionary views:</p>
<ul>
<li>
<p><a href="#CIHBJIJF">About Key Oracle Streams Supplied PL/SQL Packages</a></p>
</li>
<li>
<p><a href="#CIHCDGJC">About Key Oracle Streams Data Dictionary Views</a></p>
</li>
</ul>
<a id="CIHBJIJF"></a><a id="TDPII188"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">About Key Oracle Streams Supplied PL/SQL Packages</h4>
<p><a href="#CIHCCDCH">Table 4-1</a> describes the supplied PL/SQL packages that are important for configuring and administering an Oracle Streams replication environment.</p>
<div class="tblformal">
<p class="titleintable"><a id="TDPII229"></a><a id="sthref185"></a><a id="CIHCCDCH"></a>Table 4-1 Key Oracle Streams Supplied PL/SQL Packages</p>
<table class="cellalignment1412" title="Key Oracle Streams Supplied PL/SQL Packages" summary="This table lists each package and a description of each package." dir="ltr">
<thead>
<tr class="cellalignment1403">
<th class="cellalignment1413" id="r1c1-t21">Package</th>
<th class="cellalignment1413" id="r1c2-t21">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r2c1-t21" headers="r1c1-t21">
<p><a id="sthref186"></a><a class="olink ARPLS305" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS305"><code>DBMS_STREAMS_ADM</code></a></p>
</td>
<td class="cellalignment1409" headers="r2c1-t21 r1c2-t21">
<p>This package provides an easy way to complete common tasks in an Oracle Streams environment. This package contains procedures that enable you to configure and maintain an Oracle Streams replication environment. This package also provides an administrative interface for adding and removing simple rules for capture processes, synchronous captures, propagations, and apply processes at the table, schema, and database level. This package also contains procedures for creating queues and for managing Oracle Streams metadata, such as data dictionary information.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r3c1-t21" headers="r1c1-t21">
<p><a id="sthref187"></a><a class="olink ARPLS302" href="../../appdev.112/e40758/d_cap_a.htm#ARPLS302"><code>DBMS_CAPTURE_ADM</code></a></p>
</td>
<td class="cellalignment1409" headers="r3c1-t21 r1c2-t21">
<p>This package provides an administrative interface for starting, stopping, and configuring a capture process. It also provides an administrative interface for configuring a synchronous capture. This package also provides administrative procedures that prepare database objects at the source database for instantiation at a destination database.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r4c1-t21" headers="r1c1-t21">
<p><a id="sthref188"></a><a class="olink ARPLS320" href="../../appdev.112/e40758/d_prop_a.htm#ARPLS320"><code>DBMS_PROPAGATION_ADM</code></a></p>
</td>
<td class="cellalignment1409" headers="r4c1-t21 r1c2-t21">
<p>This package provides an administrative interface for starting, stopping, and configuring a propagation.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r5c1-t21" headers="r1c1-t21">
<p><a id="sthref189"></a><a class="olink ARPLS300" href="../../appdev.112/e40758/d_apply.htm#ARPLS300"><code>DBMS_APPLY_ADM</code></a></p>
</td>
<td class="cellalignment1409" headers="r5c1-t21 r1c2-t21">
<p>This package provides an administrative interface for starting, stopping, and configuring an apply process. This package also includes subprograms for configuring conflict detection and resolution and for managing apply errors. This package also includes procedures that enable you to configure apply handlers. This package also provides administrative procedures that set the instantiation SCN for objects at a destination database.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r6c1-t21" headers="r1c1-t21">
<p><a class="olink ARPLS514" href="../../appdev.112/e40758/d_streams_aut.htm#ARPLS514"><code>DBMS_STREAMS_AUTH</code></a></p>
</td>
<td class="cellalignment1409" headers="r6c1-t21 r1c2-t21">
<p>This package provides subprograms for granting privileges to Oracle Streams administrators and revoking privileges from Oracle Streams administrators.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r7c1-t21" headers="r1c1-t21">
<p><a class="olink ARPLS879" href="../../appdev.112/e40758/d_streams_adv.htm#ARPLS879"><code>DBMS_STREAMS_ADVISOR_ADM</code></a></p>
</td>
<td class="cellalignment1409" headers="r7c1-t21 r1c2-t21">
<p>This package provides an interface for gathering information about an Oracle Streams environment and advising database administrators based on the information gathered. This package is part of the Oracle Streams Performance Advisor.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STRMS177" href="../../server.112/e17069/strms_mintro.htm#STRMS177"><span class="italic">Oracle Streams Concepts and Administration</span></a> for more information about these Oracle Streams packages and other Oracle Streams packages</p>
</li>
<li>
<p><a href="#CIHJEIDB">"About Hub-And-Spoke Replication Environments"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CIHCDGJC"></a><a id="TDPII189"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">About Key Oracle Streams Data Dictionary Views</h4>
<p><a href="#CIHJFIAD">Table 4-2</a> describes the data dictionary views that are important for monitoring an Oracle Streams replication environment.</p>
<div class="tblformal">
<p class="titleintable"><a id="TDPII230"></a><a id="sthref190"></a><a id="CIHJFIAD"></a>Table 4-2 Key Oracle Streams Data Dictionary Views</p>
<table class="cellalignment1412" title="Key Oracle Streams Data Dictionary Views" summary="This table lists each data dictionary view and describes each data dictionary view." dir="ltr">
<thead>
<tr class="cellalignment1403">
<th class="cellalignment1413" id="r1c1-t23">Data Dictionary View</th>
<th class="cellalignment1413" id="r1c2-t23">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r2c1-t23" headers="r1c1-t23">
<p><a id="sthref191"></a><a class="olink REFRN20005" href="../../server.112/e40402/statviews_1004.htm#REFRN20005"><code>ALL_APPLY</code></a></p>
<p><a id="sthref192"></a><a class="olink REFRN23005" href="../../server.112/e40402/statviews_3047.htm#REFRN23005"><code>DBA_APPLY</code></a></p>
</td>
<td class="cellalignment1409" headers="r2c1-t23 r1c2-t23">
<p>Displays information about apply processes.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r3c1-t23" headers="r1c1-t23">
<p><a id="sthref193"></a><a class="olink REFRN20006" href="../../server.112/e40402/statviews_1006.htm#REFRN20006"><code>ALL_APPLY_CONFLICT_COLUMNS</code></a></p>
<p><a id="sthref194"></a><a class="olink REFRN23006" href="../../server.112/e40402/statviews_3049.htm#REFRN23006"><code>DBA_APPLY_CONFLICT_COLUMNS</code></a></p>
</td>
<td class="cellalignment1409" headers="r3c1-t23 r1c2-t23">
<p>Displays information about conflict handlers.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r4c1-t23" headers="r1c1-t23">
<p><a id="sthref195"></a><a class="olink REFRN20006" href="../../server.112/e40402/statviews_1006.htm#REFRN20006"><code>ALL_APPLY_ERROR</code></a></p>
<p><a id="sthref196"></a><a class="olink REFRN23006" href="../../server.112/e40402/statviews_3049.htm#REFRN23006"><code>DBA_APPLY_ERROR</code></a></p>
</td>
<td class="cellalignment1409" headers="r4c1-t23 r1c2-t23">
<p>Displays information about the error transactions generated by apply processes.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r5c1-t23" headers="r1c1-t23">
<p><a id="sthref197"></a><a class="olink REFRN20031" href="../../server.112/e40402/statviews_1025.htm#REFRN20031"><code>ALL_CAPTURE</code></a></p>
<p><a id="sthref198"></a><a class="olink REFRN23031" href="../../server.112/e40402/statviews_3097.htm#REFRN23031"><code>DBA_CAPTURE</code></a></p>
</td>
<td class="cellalignment1409" headers="r5c1-t23 r1c2-t23">
<p>Displays information about capture processes.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r6c1-t23" headers="r1c1-t23">
<p><a id="sthref199"></a><a class="olink REFRN20170" href="../../server.112/e40402/statviews_2014.htm#REFRN20170"><code>ALL_PROPAGATION</code></a></p>
<p><a id="sthref200"></a><a class="olink REFRN23170" href="../../server.112/e40402/statviews_4188.htm#REFRN23170"><code>DBA_PROPAGATION</code></a></p>
</td>
<td class="cellalignment1409" headers="r6c1-t23 r1c2-t23">
<p>Displays information about propagations.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r7c1-t23" headers="r1c1-t23">
<p><a id="sthref201"></a><a class="olink REFRN20600" href="../../server.112/e40402/statviews_2077.htm#REFRN20600"><code>ALL_STREAMS_COLUMNS</code></a></p>
<p><a id="sthref202"></a><a class="olink REFRN23600" href="../../server.112/e40402/statviews_5003.htm#REFRN23600"><code>DBA_STREAMS_COLUMNS</code></a></p>
</td>
<td class="cellalignment1409" headers="r7c1-t23 r1c2-t23">
<p>Displays information about the columns that are not supported by synchronous captures and apply processes.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r8c1-t23" headers="r1c1-t23">
<p><a id="sthref203"></a><a class="olink REFRN20475" href="../../server.112/e40402/statviews_2082.htm#REFRN20475"><code>ALL_STREAMS_RULES</code></a></p>
<p><a id="sthref204"></a><a class="olink REFRN23475" href="../../server.112/e40402/statviews_5013.htm#REFRN23475"><code>DBA_STREAMS_RULES</code></a></p>
</td>
<td class="cellalignment1409" headers="r8c1-t23 r1c2-t23">
<p>Displays information about the rules used by capture processes, synchronous captures, propagations, and apply processes.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r9c1-t23" headers="r1c1-t23">
<p><a id="sthref205"></a><a class="olink REFRN20391" href="../../server.112/e40402/statviews_2088.htm#REFRN20391"><code>ALL_STREAMS_UNSUPPORTED</code></a></p>
<p><a id="sthref206"></a><a class="olink REFRN23391" href="../../server.112/e40402/statviews_5028.htm#REFRN23391"><code>DBA_STREAMS_UNSUPPORTED</code></a></p>
</td>
<td class="cellalignment1409" headers="r9c1-t23 r1c2-t23">
<p>Displays information about the database objects that are not supported by capture processes.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r10c1-t23" headers="r1c1-t23">
<p><a id="sthref207"></a><a class="olink REFRN20572" href="../../server.112/e40402/statviews_2097.htm#REFRN20572"><code>ALL_SYNC_CAPTURE</code></a></p>
<p><a id="sthref208"></a><a class="olink REFRN23572" href="../../server.112/e40402/statviews_5037.htm#REFRN23572"><code>DBA_SYNC_CAPTURE</code></a></p>
</td>
<td class="cellalignment1409" headers="r10c1-t23 r1c2-t23">
<p>Displays information about synchronous captures.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r11c1-t23" headers="r1c1-t23">
<p><a id="sthref209"></a><a class="olink REFRN30317" href="../../server.112/e40402/dynviews_1075.htm#REFRN30317"><code>V$BUFFERED_QUEUES</code></a></p>
</td>
<td class="cellalignment1409" headers="r11c1-t23 r1c2-t23">
<p>Displays information about buffered queues and the messages in the buffered queues.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r12c1-t23" headers="r1c1-t23">
<p><a id="sthref210"></a><a class="olink REFRN30352" href="../../server.112/e40402/dynviews_2103.htm#REFRN30352"><code>V$PROPAGATION_RECEIVER</code></a></p>
</td>
<td class="cellalignment1409" headers="r12c1-t23 r1c2-t23">
<p>Displays information about the messages received into buffered queues by propagations.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r13c1-t23" headers="r1c1-t23">
<p><a id="sthref211"></a><a class="olink REFRN30353" href="../../server.112/e40402/dynviews_2104.htm#REFRN30353"><code>V$PROPAGATION_SENDER</code></a></p>
</td>
<td class="cellalignment1409" headers="r13c1-t23 r1c2-t23">
<p>Displays information about the messages sent from buffered queues by propagations.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r14c1-t23" headers="r1c1-t23">
<p><a id="sthref212"></a><a class="olink REFRN30266" href="../../server.112/e40402/dynviews_3077.htm#REFRN30266"><code>V$STREAMS_APPLY_COORDINATOR</code></a></p>
</td>
<td class="cellalignment1409" headers="r14c1-t23 r1c2-t23">
<p>Displays information about apply process coordinators for enabled apply processes.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r15c1-t23" headers="r1c1-t23">
<p><a id="sthref213"></a><a class="olink REFRN30267" href="../../server.112/e40402/dynviews_3078.htm#REFRN30267"><code>V$STREAMS_APPLY_READER</code></a></p>
</td>
<td class="cellalignment1409" headers="r15c1-t23 r1c2-t23">
<p>Displays information about apply process reader servers for enabled apply processes.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r16c1-t23" headers="r1c1-t23">
<p><a id="sthref214"></a><a class="olink REFRN30268" href="../../server.112/e40402/dynviews_3079.htm#REFRN30268"><code>V$STREAMS_APPLY_SERVER</code></a></p>
</td>
<td class="cellalignment1409" headers="r16c1-t23 r1c2-t23">
<p>Displays information about apply process apply servers for enabled apply processes.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r17c1-t23" headers="r1c1-t23">
<p><a id="sthref215"></a><a class="olink REFRN30269" href="../../server.112/e40402/dynviews_3080.htm#REFRN30269"><code>V$STREAMS_CAPTURE</code></a></p>
</td>
<td class="cellalignment1409" headers="r17c1-t23 r1c2-t23">
<p>Displays information about enabled capture processes.</p>
</td>
</tr>
<tr class="cellalignment1403">
<td class="cellalignment1409" id="r18c1-t23" headers="r1c1-t23">
<p><a id="sthref216"></a><a class="olink REFRN30415" href="../../server.112/e40402/dynviews_3084.htm#REFRN30415"><code>V$STREAMS_TRANSACTION</code></a></p>
</td>
<td class="cellalignment1409" headers="r18c1-t23 r1c2-t23">
<p>Displays information about transactions that are being processed by capture processes or apply processes. This view can identify long running transactions and to determine how many logical change records (LCRs) are being processed in each transaction. This view only contains information about LCRs that were captured by a capture process.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STRMS118" href="../../server.112/e17069/strms_monitor.htm#STRMS118"><span class="italic">Oracle Streams Concepts and Administration</span></a> for more information about these Oracle Streams data dictionary views and other Oracle Streams data dictionary views</p>
</li>
<li>
<p><a href="tdpii_adcont.htm#BABBADAC">"Monitoring an Oracle Streams Replication Environment"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABDHIIH"></a><a id="TDPII076"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Preparing for Oracle Streams Replication<a id="sthref217"></a><a id="sthref218"></a><a id="sthref219"></a><a id="sthref220"></a><a id="sthref221"></a><a id="sthref222"></a><a id="sthref223"></a><a id="sthref224"></a><a id="sthref225"></a></h2>
<p>Before configuring Oracle Streams replication, prepare the databases that will participate in the replication environment.</p>
<p class="orderedlisttitle">To prepare for Oracle Streams replication:&nbsp;</p>
<ol>
<li>
<p>Set initialization parameters properly before you configure a replication environment with Oracle Streams:</p>
<ul>
<li>
<p><span class="bold">Global Names:</span> Set the <a class="olink REFRN10065" href="../../server.112/e40402/initparams098.htm#REFRN10065"><code>GLOBAL_NAMES</code></a> initialization parameter to <code>TRUE</code> at each database that will participate in the Oracle Streams replication environment. See <a href="tdpii_common_ii.htm#BGBEEDCD">"Setting the GLOBAL_NAMES Initialization Parameter to TRUE"</a>.</p>
</li>
<li>
<p><span class="bold">Compatibility:</span> To use the latest features of Oracle Streams, it is best to set the <a class="olink REFRN10019" href="../../server.112/e40402/initparams035.htm#REFRN10019"><code>COMPATIBLE</code></a> initialization parameter as high as you can. If possible, then set this parameter to <code>11.2.0</code> or higher.</p>
</li>
<li>
<p><span class="bold">System Global Area (SGA) and the Oracle Streams pool:</span> Ensure that the Oracle Streams pool is large enough to accommodate the Oracle Streams components created for the replication environment. The Oracle Streams pool is part of the System Global Area (SGA). You can manage the Oracle Streams pool by setting the <a class="olink REFRN10285" href="../../server.112/e40402/initparams143.htm#REFRN10285"><code>MEMORY_TARGET</code></a> initialization parameter (Automatic Memory Management), the <a class="olink REFRN10256" href="../../server.112/e40402/initparams236.htm#REFRN10256"><code>SGA_TARGET</code></a> initialization parameter (Automatic Shared Memory Management), or the <a class="olink REFRN10243" href="../../server.112/e40402/initparams255.htm#REFRN10243"><code>STREAMS_POOL_SIZE</code></a> initialization parameter. See <a class="olink STREP202" href="../../server.112/e10705/prep_rep.htm#STREP202"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for more information about the Oracle Streams pool.</p>
<p>The memory requirements for Oracle Streams components are:</p>
<ul>
<li>
<p>Each queue requires at least 250 MB of memory. Each queue must have enough memory to store captured changes.</p>
</li>
<li>
<p>Each capture process parallelism requires at least 15 MB of memory. The <code>parallelism</code> capture process parameter controls the number of processes used by the capture process to capture changes. You might be able to improve capture process performance by adjusting capture process parallelism.</p>
</li>
<li>
<p>Each propagation requires at least 1 MB of memory.</p>
</li>
<li>
<p>Each apply process parallelism requires at least 1 MB of memory. The <code>parallelism</code> apply process parameter controls the number of processes used by the apply process to apply changes. You might be able to improve apply process performance by adjusting apply process parallelism.</p>
</li>
</ul>
</li>
<li>
<p><span class="bold">Processes and Sessions:</span> Oracle Streams capture processes, propagations, and apply processes use processes that run in the background. You might need to increase the value of the <code>PROCESSES</code> and <code>SESSIONS</code> initialization parameters to accommodate these processes.</p>
</li>
</ul>
</li>
<li>
<p><a id="sthref227"></a><a id="sthref228"></a>Review the best practices for Oracle Streams replication environments and follow the best practices when you configure the environment. See <a class="olink STREP150" href="../../server.112/e10705/ptrep_best.htm#STREP150"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about best practices.</p>
<p>Following the best practices ensures that your environment performs optimally and avoids problems. The Setup Streams Replication Wizard in Oracle Enterprise Manager and the configuration procedures in the <code>DBMS_STREAMS_ADM</code> package follow the best practices automatically. However, if you plan to configure an Oracle Streams replication environment without using the wizard or a configuration procedure, then learn about the best practices and follow them whenever possible.</p>
<p>The following are some important best practices to follow during Oracle Streams configuration:</p>
<ul>
<li>
<p>Configure a separate tablespace for the Oracle Streams administrator. The instructions in <a href="tdpii_common_ii.htm#BGBHDJHF">"Tutorial: Configuring an Oracle Streams Administrator"</a> follow this best practice.</p>
</li>
<li>
<p>Use separate queues for capture processes, synchronous captures, and apply processes. For the best performance, these components typically should not share a queue.</p>
</li>
<li>
<p>Use queue-to-queue propagations.</p>
</li>
</ul>
<p>After the Oracle Streams environment is configured, the following are some important best practices to follow for operation of the Oracle Streams environment:</p>
<ul>
<li>
<p>Monitor performance and make adjustments when necessary.</p>
</li>
<li>
<p>Monitor queues for size.</p>
</li>
<li>
<p>Follow the Oracle Streams best practices for backups.</p>
</li>
<li>
<p>Check the alert log for Oracle Streams information.</p>
</li>
<li>
<p>Set capture process parallelism for best performance.</p>
</li>
<li>
<p>Set apply process parallelism for best performance.</p>
</li>
<li>
<p>Check for apply errors and manage them if they occur.</p>
</li>
</ul>
</li>
</ol>
<p>See <a class="olink STREP150" href="../../server.112/e10705/ptrep_best.htm#STREP150"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for detailed information about these best practices, and for information about other Oracle Streams best practices.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#BABEHDDF">"About Oracle Streams Replication"</a></p>
</li>
<li>
<p><a href="tdpii_adcont.htm#CHDHCDDJ">"Administering an Oracle Streams Replication Environment"</a></p>
</li>
<li>
<p><a class="olink ADMQS053" href="../../server.112/e10897/instance.htm#ADMQS053"><span class="italic">Oracle Database 2 Day DBA</span></a></p>
</li>
<li>
<p><a class="olink STREP201" href="../../server.112/e10705/prep_rep.htm#STREP201"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about initialization parameters that are important in an Oracle Streams environment</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CIHFHFFJ"></a><a id="TDPII192"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Configuring Oracle Streams Replication: Examples</h2>
<p>This section uses examples to show you how to configure Oracle Streams replication environments. The examples configure the most common types of Oracle Streams replication environments.</p>
<p>The following are descriptions of the examples:</p>
<ul>
<li>
<p><a href="#CIHDBCGD">Tutorial: Configuring Two-Database Replication with Local Capture Processes</a></p>
<p>This example configures an Oracle Streams replication environment that replicates data manipulation language (DML) changes to all of the tables in the <code>hr</code> schema at two databases. The configuration uses capture processes to capture the changes to the replicated database objects.</p>
<p>The example shows you how to configure the environment for one-way replication or bi-directional replication. With one-way replication, only one database allows changes to the database objects. With bi-directional replication, both databases allow changes to the database objects.</p>
<p>Use this configuration when you want to configure a relatively simple replication environment that only involves two databases. You might configure a one-way replication environment to use a second database for reporting or data analysis. You might configure a two-way replication environment if the data must be read/write at both databases. For example, two-way replication can improve scalability or increase the availability of the data.</p>
<p>See <a href="#CIHGHCGI">"About Two-Database Replication Environments"</a> for more information about two-database replication environments.</p>
</li>
<li>
<p><a href="#BABIJCDG">Tutorial: Configuring Two-Database Replication with a Downstream Capture Process</a></p>
<p>This example configures an Oracle Streams replication environment that replicates DML changes to all of the tables in the <code>hr</code> schema at two databases. The example shows you how to configure the environment for one-way replication, where changes to the replicated database objects are only allowed at one source database. The configuration uses a downstream capture process at a destination database to capture the changes that were made to these database objects at the source database. The database objects are read-only at the destination database.</p>
<p>Use this configuration when you want to offload reporting or data analysis from a primary database to another database. In this example, the capture process runs on the second database to reduce the load on the primary database.</p>
<p>See <a href="#CIHGHCGI">"About Two-Database Replication Environments"</a> for more information about two-database replication environments.</p>
</li>
<li>
<p><a href="#BABBIBCD">Tutorial: Configuring Hub-and-Spoke Replication with Local Capture Processes</a></p>
<p>This example configures an Oracle Streams replication environment that replicates DML changes to all of the tables in the <code>hr</code> schema at three databases. This example configures a hub-and-spoke replication environment with one hub and two spokes. A hub-and-spoke replication environment is one in which a central database, or hub, communicates with secondary databases, or spokes. In this example, the spoke databases allow changes to the replicated database objects. The configuration uses capture processes to capture the changes to the replicated database objects.</p>
<p>Use this configuration when you have a central database that must replicate data with several secondary databases. For example, a business with a central database at headquarters and several secondary databases at sales offices might choose this configuration.</p>
<p>See <a href="#CIHJEIDB">"About Hub-And-Spoke Replication Environments"</a> for more information about hub-and-spoke replication environments.</p>
</li>
<li>
<p><a href="#BABDEBBA">Tutorial: Configuring Two-Database Replication with Synchronous Captures</a></p>
<p>This example configures an Oracle Streams replication environment that replicates DML changes to the <code>employees</code> and <code>departments</code> tables in the <code>hr</code> schema at two databases. This example configures bi-directional replication between the two databases. So, changes to the databases objects are allowed at each database. The configuration uses synchronous captures to capture the changes to the replicated database objects.</p>
<p>Use this configuration when you want to configure a relatively simple replication environment that only involves two databases and a small number of tables. You might also choose to use synchronous captures if you have Oracle Database 11<span class="italic">g</span> Standard Edition. To use capture processes, you must have Oracle Database 11<span class="italic">g</span> Enterprise Edition.</p>
<p>See <a href="#CIHGHCGI">"About Two-Database Replication Environments"</a> for more information about two-database replication environments.</p>
</li>
</ul>
<p>This section also includes an example that configures conflict resolution for a table. See <a href="#CIHIACBB">"Tutorial: Configuring Latest Time Conflict Resolution for a Table"</a>. Use conflict resolution in a replication environment that allows multiple databases to perform DML changes on replicated tables. This example configures latest time conflict resolution. Therefore, when a conflict occurs for a row change to a table, the most recent change is retained, and the older change is discarded. See <a href="#BABGAACC">"About Conflicts and Conflict Resolution"</a> for more information about conflict resolution.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Another common Oracle Streams replication environment is the n-way environment. See <a href="#CIHEBHDG">"About N-Way Replication Environments"</a>.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CIHGGCCB">"About the Common Types of Oracle Streams Replication Environments"</a></p>
</li>
</ul>
</div>
<a id="CIHDBCGD"></a><a id="TDPII181"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Tutorial: Configuring Two-Database Replication with Local Capture Processes<a id="sthref229"></a><a id="sthref230"></a><a id="sthref231"></a></h3>
<p>This example configures an Oracle Streams replication environment that replicates data manipulation language (DML) changes to all of the tables in the <code>hr</code> schema. This example configures a two-database replication environment with local capture processes to capture changes. This example uses the global database names <code>db1.example.com</code> and <code>db2.example.com</code>. However, you can substitute databases in your environment to complete the example. See <a href="#CIHGHCGI">"About Two-Database Replication Environments"</a> for more information about two-database replication environments.</p>
<p>This example uses the Setup Streams Replication Wizard in Oracle Enterprise Manager to configure the two-database replication environment. This wizard is the fastest and simplest way to configure an Oracle Streams environment that replicates one or more schemas. In addition, the wizard follows established best practices for Oracle Streams replication environments.</p>
<p>The database objects being configured for replication might or might not exist at the destination database when you run the wizard. If the database objects do not exist at the destination database, then the wizard instantiates them at the destination database using a Data Pump export/import. During instantiation, the instantiation SCN is set for these database objects. If the database objects exist at the destination database, then the wizard retains the existing database objects and sets the instantiation SCN for them. In this example, the <code>hr</code> schema exists at both the <code>db1.example.com</code> database and the <code>db2.example.com</code> database before the wizard is run.</p>
<p>This example provides instructions for configuring either one-way or bi-directional replication. To configure bi-directional replication, you must complete additional steps and select <span class="bold">Setup Bi-directional replication</span> on the appropriate wizard page.</p>
<p><a href="#CIHFHFDJ">Figure 4-11</a> provides an overview of the environment created in this example. The additional components required for bi-directional replication are shown in gray, and their actions are indicated by dashed lines.</p>
<div class="figure">
<p class="titleinfigure"><a id="CIHFHFDJ"></a><a id="TDPII232"></a>Figure 4-11 Two-Database Replication Environment with Local Capture Processes</p>
<img width="656" height="612" src="img/tdpii509.gif" alt="Description of Figure 4-11 follows" /><br />
<a id="sthref232" href="img_text/tdpii509.htm">Description of "Figure 4-11 Two-Database Replication Environment with Local Capture Processes"</a><br />
<br /></div>
<!-- class="figure" -->
<p class="orderedlisttitle">To configure this two-database replication environment:&nbsp;</p>
<ol>
<li>
<p>Complete the following tasks to prepare for the two-database replication environment:</p>
<ol>
<li>
<p>Configure network connectivity so that the <code>db1.example.com</code> database can communicate with the <code>db2.example.com</code> database.</p>
<p>See <a class="olink ADMQS004" href="../../server.112/e10897/network.htm#ADMQS004"><span class="italic">Oracle Database 2 Day DBA</span></a> for information about configuring network connectivity between databases.</p>
</li>
<li>
<p>Configure an Oracle Streams administrator at each database that will participate in the replication environment. See <a href="tdpii_common_ii.htm#BGBHDJHF">"Tutorial: Configuring an Oracle Streams Administrator"</a> for instructions. This example assumes that the Oracle Streams administrator is <code>strmadmin</code>.</p>
</li>
<li>
<p>Set initialization parameters properly at each database that will participate in the Oracle Streams replication environment. See <a href="#BABDHIIH">"Preparing for Oracle Streams Replication"</a> for instructions.</p>
</li>
<li>
<p>Configure the <code>db1.example.com</code> database to run in <code>ARCHIVELOG</code> mode. For a capture process to capture changes generated at a source database, the source database must be running in <code>ARCHIVELOG</code> mode. See <a class="olink ADMIN008" href="../../server.112/e25494/archredo.htm#ADMIN008"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about configuring a database to run in <code>ARCHIVELOG</code> mode.</p>
</li>
<li>
<p>If you are configuring a bi-directional replication environment, then configure the <code>db2.example.com</code> database to run in <code>ARCHIVELOG</code> mode. If you are configuring a one-way replication environment, then this step is not required, and you can move on to Step <a href="#BABECDFA">2</a>.</p>
</li>
</ol>
</li>
<li>
<p><a id="BABECDFA"></a>In Enterprise Manager, log in to the source database as the Oracle Streams administrator.</p>
<p>In this example, the source database is <code>db1.example.com</code>.</p>
</li>
<li>
<p>Go to the Database Home page for the database instance.</p>
</li>
<li>
<p>Click <span class="bold">Data Movement</span> to open the Data Movement subpage.</p>
</li>
<li>
<p>Click <span class="bold">Setup</span> in the Streams section.</p>
<p>The Streams page appears, showing the setup options.</p>
<img width="909" height="499" src="img/tdpii_setup_streams.gif" alt="Description of tdpii_setup_streams.gif follows" /><br />
<a id="sthref234" href="img_text/tdpii_setup_streams.htm">Description of the illustration tdpii_setup_streams.gif</a><br />
<br /></li>
<li>
<p>Select <span class="bold">Replicate Schemas</span> in Setup Streams Replication.</p>
</li>
<li>
<p><a id="BABCJHGB"></a>In the Host Credentials section, enter the username and password for an administrative user on the host computer system.</p>
</li>
<li>
<p>Click <span class="bold">Continue</span>.</p>
</li>
<li>
<p>On the Object Selection page, select <span class="bold">HR</span> and click <span class="bold">Next</span>.</p>
</li>
<li>
<p>On the Destination Options page, identify the destination database by specifying its host name, port, SID or service name, and Oracle Streams administrator credentials.</p>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
<p>The Replication Options page appears.</p>
<img width="915" height="353" src="img/tdpii_setup_rep_options.gif" alt="Description of tdpii_setup_rep_options.gif follows" /><br />
<a id="sthref235" href="img_text/tdpii_setup_rep_options.htm">Description of the illustration tdpii_setup_rep_options.gif</a><br />
<br /></li>
<li>
<p>Complete the Replication Options page:</p>
<ol>
<li>
<p>In the Directory Path section, leave the directory paths for the source and destination database unchanged if the host user you specified in Step <a href="#BABCJHGB">7</a> can read from and write to the directories and the directories have enough space for a Data Pump export dump file. Otherwise, specify different directory paths, or create directory objects that meet these requirements and specify those.</p>
</li>
<li>
<p>Expand <span class="bold">Advanced Options</span>.</p>
<img width="904" height="596" src="img/tdpii_setup_ro_advanced.gif" alt="Description of tdpii_setup_ro_advanced.gif follows" /><br />
<a id="sthref236" href="img_text/tdpii_setup_ro_advanced.htm">Description of the illustration tdpii_setup_ro_advanced.gif</a><br />
<br /></li>
<li>
<p>In the Options section, ensure that <span class="bold">Capture, Propagate and Apply data manipulation language (DML) changes</span> is selected.</p>
</li>
<li>
<p>If you do not want to replicate DDL changes, then deselect <span class="bold">Capture, Propagate and Apply data definition language (DDL) changes</span>.</p>
</li>
<li>
<p>To configure bi-directional replication, select <span class="bold">Setup Bi-directional replication</span>.</p>
</li>
</ol>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
</li>
<li>
<p>On the Schedule Job page, either select <span class="bold">Immediately</span> or specify a time for the job to run later.</p>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
</li>
<li>
<p>On the Review page, review the configuration information and click <span class="bold">Submit</span>.</p>
</li>
<li>
<p>On the Confirmation page, optionally click the job link to monitor the job.</p>
<p>When the job is running, information about its progress is recorded in the following data dictionary views: <code>DBA_RECOVERABLE_SCRIPT</code>, <code>DBA_RECOVERABLE_SCRIPT_PARAMS</code>, <code>DBA_RECOVERABLE_SCRIPT_BLOCKS</code>, and <code>DBA_RECOVERABLE_SCRIPT_ERRORS</code>. If the job stops because it encounters an error, then see <a class="olink STREP149" href="../../server.112/e10705/man_gen_rep.htm#STREP149"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for instructions about using the <code>RECOVER_OPERATION</code> procedure in the <code>DBMS_STREAMS_ADM</code> package to recover from these errors.</p>
</li>
</ol>
<p>When the job completes successfully, a two-database replication environment with the following characteristics is configured:</p>
<ul>
<li>
<p>At <code>db1.example.com</code>, supplemental logging is configured for the tables in the <code>hr</code> schema.</p>
</li>
<li>
<p>The <code>db1.example.com</code> database has the following components:</p>
<ul>
<li>
<p>A capture process with a system-generated name. The capture process captures DML changes to the <code>hr</code> schema.</p>
</li>
<li>
<p>A queue with a system-generated name. This queue is for the capture process at the database.</p>
</li>
<li>
<p>A propagation with a system-generated name that sends changes from the queue at the <code>db1.example.com</code> database to the queue at the <code>db2.example.com</code> database.</p>
</li>
</ul>
</li>
<li>
<p>The <code>db2.example.com</code> database has the following components:</p>
<ul>
<li>
<p>A queue with a system-generated name that receives the changes sent from the <code>db1.example.com</code> database. This queue is for the apply process at the local database.</p>
</li>
<li>
<p>An apply process with a system-generated name. The apply process dequeues changes from its queue and applies them to the <code>hr</code> schema.</p>
</li>
</ul>
</li>
<li>
<p>If the replication environment is bi-directional, then the following are also configured:</p>
<ul>
<li>
<p>At <code>db2.example.com</code>, supplemental logging for the tables in the <code>hr</code> schema.</p>
</li>
<li>
<p>At <code>db2.example.com</code>, a capture process with a system-generated name. The capture process captures DML changes to the <code>hr</code> schema.</p>
</li>
<li>
<p>At <code>db2.example.com</code>, a queue with a system-generated name. This queue is for the capture process at the database.</p>
</li>
<li>
<p>At <code>db1.example.com</code>, a queue with a system-generated name that receives the changes sent from the <code>db2.example.com</code> database. This queue is for the apply process at the local database.</p>
</li>
<li>
<p>At <code>db1.example.com</code>, an apply process with a system-generated name. The apply process dequeues changes from its queue and applies them to the <code>hr</code> schema.</p>
</li>
</ul>
</li>
<li>
<p><a id="sthref237"></a>If the replication environment is bi-directional, then tags are used to avoid change cycling in the following way:</p>
<ul>
<li>
<p>Each apply process uses an apply tag, and redo records for changes applied by the apply process include the tag. Each apply process uses an apply tag that is unique in the replication environment.</p>
</li>
<li>
<p>Each capture process captures all of the changes to the replicated database objects, regardless of the tag in the redo record. Therefore, each capture process captures the changes applied by the apply processes on its source database.</p>
</li>
<li>
<p>Each propagation sends all changes made to the replicated database objects to the other database in the replication environment, except for changes that originated at the other database. The propagation rules instruct the propagation to discard these changes.</p>
</li>
</ul>
<p>See <a href="#BABICHGF">"About Tags for Avoiding Change Cycling"</a> for more information about how the replication environment avoids change cycling. If you configured one-way replication, then change cycling is not possible because changes are only captured in a single location.</p>
</li>
</ul>
<p class="orderedlisttitle">To check the Oracle Streams replication configuration:&nbsp;</p>
<ol>
<li>
<p>At the <code>db1.example.com</code> database, ensure that the capture process is enabled and that the capture type is local. To do so, follow the instructions in <a href="tdpii_adcont.htm#CHDIFCCD">"Viewing Information About a Capture Process"</a>, and check the Status and Capture Type fields on the Capture subpage.</p>
</li>
<li>
<p>At the <code>db1.example.com</code> database, ensure that the propagation is enabled. To do so, follow the instructions in <a href="tdpii_adcont.htm#CHDGEBHI">"Viewing Information About a Propagation"</a>, and check the Status field on the Propagation subpage.</p>
</li>
<li>
<p>At the <code>db2.example.com</code> database, ensure that the apply process is enabled. To do so, follow the instructions in <a href="tdpii_adcont.htm#CHDIGAED">"Viewing Information About an Apply Process"</a>, and check the Status field on the Apply subpage.</p>
</li>
<li>
<p>If you configured bi-directional replication, then complete the following additional steps:</p>
<ol>
<li>
<p>At the <code>db2.example.com</code> database, ensure that the capture process is enabled and that the capture type is local.</p>
</li>
<li>
<p>At the <code>db2.example.com</code> database, ensure that the propagation is enabled.</p>
</li>
<li>
<p>At the <code>db1.example.com</code> database, ensure that the apply process is enabled.</p>
</li>
</ol>
</li>
</ol>
<p class="orderedlisttitle">To replicate changes:&nbsp;</p>
<ol>
<li>
<p>At a database that captures changes to the <code>hr</code> schema, make DML changes to any table in the <code>hr</code> schema. In this example, the <code>db1.example.com</code> database captures changes to the <code>hr</code> schema, and, if you configured bi-directional replication, then <code>db2.example.com</code> also captures changes to the <code>hr</code> schema.</p>
</li>
<li>
<p>After some time has passed to allow for replication of the changes, use SQL*Plus to query the modified table at the other database to view the DML changes.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
The wizard does not configure the replicated tables to be read only at the destination databases. If one-way replication is configured and they should be read only, then configure privileges at the destination databases accordingly. However, the apply user for the apply process must be able to make DML changes to the replicated database objects. In this example, the apply user is the Oracle Streams administrator. See <a class="olink DBSEG004" href="../../network.112/e36292/authorization.htm#DBSEG004"><span class="italic">Oracle Database Security Guide</span></a> for information about configuring privileges.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CIHJEIDB">"About Hub-And-Spoke Replication Environments"</a></p>
</li>
<li>
<p><a href="tdpii_intro2ii.htm#CFHJAAEA">"When to Replicate Data with Oracle Streams"</a></p>
</li>
<li>
<p><a href="tdpii_adcont.htm#CHDHCDDJ">Chapter 5, "Administering an Oracle Streams Replication Environment"</a></p>
</li>
<li>
<p><a class="olink STREP599" href="../../server.112/e10705/config_simple.htm#STREP599"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for an example that configures this replication environment using the <code>DBMS_STREAMS_ADM</code> supplied PL/SQL package</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABIJCDG"></a><a id="TDPII082"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Tutorial: Configuring Two-Database Replication with a Downstream Capture Process<a id="sthref240"></a><a id="sthref241"></a><a id="sthref242"></a></h3>
<p>This example configures an Oracle Streams replication environment that replicates data manipulation language (DML) changes to all of the tables in the <code>hr</code> schema. This example configures a two-database replication environment with a downstream capture process at the destination database. This example uses the global database names <code>src.example.com</code> and <code>dest.example.com</code>. However, you can substitute databases in your environment to complete the example. See <a href="#CIHGHCGI">"About Two-Database Replication Environments"</a> for more information about two-database replication environments.</p>
<p>In this example, the downstream capture process runs on the destination database <code>dest.example.com</code>. Therefore, the resources required to capture changes are freed at the source database <code>src.example.com</code>. This example configures a real-time downstream capture process, not an archived-log downstream capture process. The advantage of real-time downstream capture is that it reduces the amount of time required to capture the changes made at the source database. The time is reduced because the real-time downstream capture process does not need to wait for the redo log file to be archived before it can capture data from it.</p>
<p>This example assumes that the replicated database objects are used for reporting and analysis at the destination database. Therefore, these database objects are assumed to be read-only at the <code>dest.example.com</code> database.</p>
<p>This example uses the Setup Streams Replication Wizard in Oracle Enterprise Manager to configure the two-database replication environment. This wizard is the fastest and simplest way to configure an Oracle Streams environment that replicates one or more schemas. In addition, the wizard follows established best practices for Oracle Streams replication environments.</p>
<p>The database objects being configured for replication might or might not exist at the destination database when you run the wizard. If the database objects do not exist at the destination database, then the wizard instantiates them at the destination database using a Data Pump export/import. During instantiation, the instantiation SCN is set for these database objects. If the database objects exist at the destination database, then the wizard retains the existing database objects and sets the instantiation SCN for them. In this example, the <code>hr</code> schema exists at both the <code>src.example.com</code> database and the <code>dest.example.com</code> database before the wizard is run.</p>
<p><a href="#CIHHCJEC">Figure 4-12</a> provides an overview of the environment created in this example.</p>
<div class="figure">
<p class="titleinfigure"><a id="CIHHCJEC"></a><a id="TDPII236"></a>Figure 4-12 Two-Database Replication Environment with a Downstream Capture Process</p>
<img width="503" height="489" src="img/tdpii506.gif" alt="Description of Figure 4-12 follows" /><br />
<a id="sthref243" href="img_text/tdpii506.htm">Description of "Figure 4-12 Two-Database Replication Environment with a Downstream Capture Process"</a><br />
<br /></div>
<!-- class="figure" -->
<div class="infobox-note">
<p class="notep1">Note:</p>
Local capture processes provide more flexibility than downstream capture processes in replication environments with different platforms or different versions of Oracle Database. See <a class="olink STRMS129" href="../../server.112/e17069/strms_capture.htm#STRMS129"><span class="italic">Oracle Streams Concepts and Administration</span></a> for more information.</div>
<p class="orderedlisttitle">To configure this two-database replication environment:&nbsp;</p>
<ol>
<li>
<p>Complete the following tasks to prepare for the two-database replication environment:</p>
<ol>
<li>
<p>Configure network connectivity so that the <code>src.example.com</code> database and the <code>dest.example.com</code> database can communicate with each other.</p>
<p>See <a class="olink ADMQS004" href="../../server.112/e10897/network.htm#ADMQS004"><span class="italic">Oracle Database 2 Day DBA</span></a> for information about configuring network connectivity between databases.</p>
</li>
<li>
<p>Configure an Oracle Streams administrator at each database that will participate in the replication environment. See <a href="tdpii_common_ii.htm#BGBHDJHF">"Tutorial: Configuring an Oracle Streams Administrator"</a> for instructions. This example assumes that the Oracle Streams administrator is <code>strmadmin</code>.</p>
</li>
<li>
<p>Set initialization parameters properly at each database that will participate in the Oracle Streams replication environment. See <a href="#BABDHIIH">"Preparing for Oracle Streams Replication"</a> for instructions.</p>
</li>
<li>
<p>Configure both databases to run in <code>ARCHIVELOG</code> mode. For a downstream capture process to capture changes generated at a source database, both the source database and the downstream capture database must be running in <code>ARCHIVELOG</code> mode. In this example, the <code>src.example.com</code> and <code>dest.example.com</code> databases must be running in <code>ARCHIVELOG</code> mode. See <a class="olink ADMIN008" href="../../server.112/e25494/archredo.htm#ADMIN008"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about configuring a database to run in <code>ARCHIVELOG</code> mode.</p>
</li>
<li>
<p>Configure authentication at both databases to support the transfer of redo data.</p>
<p>Redo transport sessions are authenticated using either the Secure Sockets Layer (SSL) protocol or a remote login password file. If the source database has a remote login password file, then copy it to the appropriate directory on the downstream capture database system. The password file must be the same at the source database and the downstream capture database.</p>
<p>In this example, the source database is <code>src.example.com</code> and the downstream capture database is <code>dest.example.com</code>. See <a class="olink SBYDB00424" href="../../server.112/e41134/create_ps.htm#SBYDB00424"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for detailed information about authentication requirements for redo transport.</p>
</li>
</ol>
</li>
<li>
<p><a id="BABJEGIA"></a>Configure initialization parameters at both the source database and the downstream database to support downstream capture.</p>
<p>The initialization parameters must be set properly at both databases for redo transport services to transmit redo data from the online redo log at the source database <code>src.example.com</code> to the standby redo log at the downstream database <code>dest.example.com</code>.</p>
<p>To configure initialization parameters to support downstream capture:</p>
<ol>
<li>
<p>In Enterprise Manager, log in to the source database as the Oracle Streams administrator.</p>
<p>In this example, the source database is <code>src.example.com</code>.</p>
</li>
<li>
<p>Go to the Database Home page for the database instance.</p>
</li>
<li>
<p>Click <span class="bold">Data Movement</span> to open the Data Movement subpage.</p>
</li>
<li>
<p>Click <span class="bold">Setup</span> in the Streams section.</p>
<p>The Streams page appears, showing the setup options.</p>
<img width="909" height="499" src="img/tdpii_setup_streams.gif" alt="Description of tdpii_setup_streams.gif follows" /><br />
<a id="sthref245" href="img_text/tdpii_setup_streams.htm">Description of the illustration tdpii_setup_streams.gif</a><br />
<br /></li>
<li>
<p>Select <span class="bold">Setup Downstream Capture</span>.</p>
</li>
<li>
<p>In the Host Credentials section, enter the username and password for an administrative user on the host computer system.</p>
</li>
<li>
<p>Click <span class="bold">Continue</span>.</p>
<p>The Setup Downstream Capture page appears.</p>
<img width="905" height="780" src="img/tdpii_down.gif" alt="Description of tdpii_down.gif follows" /><br />
<a id="sthref246" href="img_text/tdpii_down.htm">Description of the illustration tdpii_down.gif</a><br />
<br /></li>
<li>
<p>In the Downstream Database Details section, identify the downstream capture database host name, port, and SID or service name, and enter the credentials for the Oracle Streams administrator at the downstream database.</p>
<p>In this example, the downstream capture database is <code>dest.example.com</code>.</p>
</li>
<li>
<p>In the Capture Process Details section, enter <code>capture</code> in the Capture Process Name field and ensure that <span class="bold">Real-Time Downstream Capture</span> is selected.</p>
</li>
<li>
<p>In the Log Details section, enter a location for the archived redo log files on the computer system running the downstream database in the Standby Redo Log File Location field.</p>
<p>Specify either a valid path name for a disk directory or, to use a fast recovery area, specify <code>USE_DB_RECOVERY_FILE_DEST</code>. This location is the local destination for archived redo log files written from the standby redo logs. Log files from a remote source database should be kept separate from local database log files. See <a class="olink BRADV8183" href="../../backup.112/e10642/rcmconfb.htm#BRADV8183"><span class="italic">Oracle Database Backup and Recovery User's Guide</span></a> for information about configuring a fast recovery area.</p>
</li>
<li>
<p>In the Log Details section, ensure that <span class="bold">Configure Log Parameters for Downstream Capture</span> is selected and that <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> parameter in Log Parameter is not already in use at the source database.</p>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
</li>
<li>
<p>On the Schedule Job page, either select <span class="bold">Immediately</span> or specify a time for the job to run later.</p>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
</li>
<li>
<p>On the Confirmation page, optionally click the job link to monitor the job.</p>
</li>
</ol>
<p>When the job completes successfully, downstream capture is configured. Do not proceed until the jobs completes successfully.</p>
</li>
<li>
<p>While still logged in to the source database in Enterprise Manager as the Oracle Streams administrator, go to the Database Home page for the database instance.</p>
</li>
<li>
<p>Click <span class="bold">Data Movement</span> to open the Data Movement subpage.</p>
</li>
<li>
<p>Click <span class="bold">Setup</span> in the Streams section.</p>
<p>The Streams page appears, showing the setup options.</p>
</li>
<li>
<p>Select <span class="bold">Replicate Schemas</span> in Setup Streams Replication.</p>
</li>
<li>
<p><a id="BABEHCCE"></a>In the Host Credentials section, enter the username and password for an administrative user on the host computer system.</p>
</li>
<li>
<p>Click <span class="bold">Continue</span>.</p>
</li>
<li>
<p>On the Object Selection page, select <span class="bold">HR</span> and click <span class="bold">Next</span>.</p>
<p>You might need to click the <span class="bold">Next</span> link to show the HR user.</p>
</li>
<li>
<p>On the Destination Options page, identify the destination database by specifying its host name, port, SID or service name, and Oracle Streams administrator credentials.</p>
<p>In this example, the destination database is <code>dest.example.com</code>.</p>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
<p>The Replication Options page appears.</p>
<img width="915" height="353" src="img/tdpii_setup_rep_options.gif" alt="Description of tdpii_setup_rep_options.gif follows" /><br />
<a id="sthref247" href="img_text/tdpii_setup_rep_options.htm">Description of the illustration tdpii_setup_rep_options.gif</a><br />
<br /></li>
<li>
<p>Complete the Replication Options page:</p>
<ol>
<li>
<p>In the Directory Path section, leave the directory paths for the source and destination database unchanged if the host user you specified in Step <a href="#BABEHCCE">7</a> can read from and write to the directories and the directories have enough space for a Data Pump export dump file. Otherwise, specify different directory paths, or create directory objects that meet these requirements and specify those.</p>
</li>
<li>
<p>Expand <span class="bold">Advanced Options</span>.</p>
<img width="904" height="596" src="img/tdpii_setup_ro_advanced.gif" alt="Description of tdpii_setup_ro_advanced.gif follows" /><br />
<a id="sthref248" href="img_text/tdpii_setup_ro_advanced.htm">Description of the illustration tdpii_setup_ro_advanced.gif</a><br />
<br /></li>
<li>
<p>In the Options section, ensure that <span class="bold">Capture, Propagate and Apply data manipulation language (DML) changes</span> is selected.</p>
</li>
<li>
<p>In the Options section, deselect <span class="bold">Capture, Propagate and Apply data definition language (DDL) changes</span> and ensure that <span class="bold">Setup Bi-directional replication</span> is not selected.</p>
</li>
<li>
<p>In the Capture Process section, select <span class="bold">Downstream Capture</span>.</p>
</li>
<li>
<p>In the Capture Process section, enter the downstream capture database host name, port, and SID or service name, and enter the credentials for the Oracle Streams administrator at the downstream database.</p>
</li>
<li>
<p>In the Capture Name field, enter <code>capture</code>. You configured this downstream capture process in Step <a href="#BABJEGIA">2</a>.</p>
</li>
<li>
<p>In the Apply Name field, enter <code>apply</code>.</p>
</li>
</ol>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
</li>
<li>
<p>On the Schedule Job page, either select <span class="bold">Immediately</span> or specify a time for the job to run later.</p>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
</li>
<li>
<p>On the Review page, review the configuration information and click <span class="bold">Submit</span>.</p>
</li>
<li>
<p>On the Confirmation page, click the job link to monitor the job. Do not proceed to the next step until the job completes successfully.</p>
<p>When the job is running, information about its progress is recorded in the following data dictionary views: <code>DBA_RECOVERABLE_SCRIPT</code>, <code>DBA_RECOVERABLE_SCRIPT_PARAMS</code>, <code>DBA_RECOVERABLE_SCRIPT_BLOCKS</code>, and <code>DBA_RECOVERABLE_SCRIPT_ERRORS</code>. If the job stops because it encounters an error, then see <a class="olink STREP149" href="../../server.112/e10705/man_gen_rep.htm#STREP149"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for instructions about using the <code>RECOVER_OPERATION</code> procedure in the <code>DBMS_STREAMS_ADM</code> package to recover from these errors.</p>
</li>
<li>
<p>In SQL*Plus, connect to the source database <code>src.example.com</code> as an administrative user.</p>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p>Archive the current log file at the source database:</p>
<pre>
ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre>
<p>Archiving the current log file at the source database starts real-time mining of the source database redo log.</p>
</li>
</ol>
<p>When you complete the example, a two-database replication environment with the following characteristics is configured:</p>
<ul>
<li>
<p>At the <code>src.example.com</code> database, supplemental logging is configured for the tables in the <code>hr</code> schema.</p>
</li>
<li>
<p>The <code>dest.example.com</code> database has the following components:</p>
<ul>
<li>
<p>A downstream capture process named <code>capture</code>. The capture process captures changes to the <code>hr</code> schema in the redo log information sent from the source database <code>src.example.com</code>.</p>
</li>
<li>
<p>A queue with a system-generated name. This queue is for the capture process and apply process at the database.</p>
</li>
<li>
<p>An apply process named <code>apply</code>. The apply process applies changes to the <code>hr</code> schema.</p>
</li>
</ul>
</li>
</ul>
<p class="orderedlisttitle">To check the Oracle Streams replication configuration:&nbsp;</p>
<ol>
<li>
<p>At the <code>dest.example.com</code> database, ensure that the capture process is enabled and that the capture type is downstream. To do so, follow the instructions in <a href="tdpii_adcont.htm#CHDIFCCD">"Viewing Information About a Capture Process"</a>, and check the Status and Capture Type fields on the Capture subpage.</p>
<p>If the capture process appears to be waiting for redo data for an inordinately long time, then check the alert log for errors. See <a class="olink STRMS1036" href="../../server.112/e17069/strms_trcapture.htm#STRMS1036"><span class="italic">Oracle Streams Concepts and Administration</span></a> for more information.</p>
</li>
<li>
<p>At the <code>dest.example.com</code> database, ensure that the apply process is enabled. To do so, follow the instructions in <a href="tdpii_adcont.htm#CHDIGAED">"Viewing Information About an Apply Process"</a>, and check Status field on the Apply subpage.</p>
</li>
</ol>
<p class="orderedlisttitle">To replicate changes:&nbsp;</p>
<ol>
<li>
<p>At the <code>src.example.com</code> database, make DML changes to any table in the <code>hr</code> schema, and commit the changes.</p>
</li>
<li>
<p>After some time has passed to allow for replication of the changes, use SQL*Plus to query the modified table at the <code>dest.example.com</code> database to view the DML changes.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
The wizard does not configure the replicated tables to be read only at the destination database. If they should be read only, then configure privileges at the destination database accordingly. However, the apply user for the apply process must be able to make DML changes to the replicated database objects. In this example, the apply user is the Oracle Streams administrator. See <a class="olink DBSEG004" href="../../network.112/e36292/authorization.htm#DBSEG004"><span class="italic">Oracle Database Security Guide</span></a> for information about configuring privileges.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CIHJEIDB">"About Hub-And-Spoke Replication Environments"</a></p>
</li>
<li>
<p><a href="tdpii_intro2ii.htm#CFHJAAEA">"When to Replicate Data with Oracle Streams"</a></p>
</li>
<li>
<p><a href="tdpii_adcont.htm#CHDHCDDJ">Chapter 5, "Administering an Oracle Streams Replication Environment"</a></p>
</li>
<li>
<p><a class="olink STRMS153" href="../../server.112/e17069/strms_capture.htm#STRMS153"><span class="italic">Oracle Streams Concepts and Administration</span></a> for more information about downstream capture processes</p>
</li>
<li>
<p><a class="olink STREP602" href="../../server.112/e10705/config_simple.htm#STREP602"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for an example that configures this replication environment using the <code>DBMS_STREAMS_ADM</code> supplied PL/SQL package</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABBIBCD"></a><a id="TDPII081"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Tutorial: Configuring Hub-and-Spoke Replication with Local Capture Processes<a id="sthref251"></a><a id="sthref252"></a><a id="sthref253"></a></h3>
<p>This example configures an Oracle Streams hub-and-spoke replication environment that replicates data manipulation language (DML) changes to all of the tables in the <code>hr</code> schema. This example uses a capture process at each database to capture these changes. Hub-and-spoke replication means that a central hub database replicates changes with one or more spoke databases. The spoke databases do not communicate with each other directly. In this sample configuration, the hub database sends changes generated at one spoke database to the other spoke database. See <a href="#CIHJEIDB">"About Hub-And-Spoke Replication Environments"</a> for more information about hub-and-spoke replication environments.</p>
<p>This example uses the Setup Streams Replication Wizard in Oracle Enterprise Manager to configure the hub-and-spoke replication environment. This wizard is the fastest and simplest way to configure an Oracle Streams environment that replicates one or more schemas. In addition, the wizard follows established best practices for Oracle Streams replication environments.</p>
<p>In this example, the global name of the hub database is <code>hub.example.com</code>, and the global names of the spoke databases are <code>spoke1.example.com</code> and <code>spoke2.example.com</code>. However, you can substitute databases in your environment to complete the example.</p>
<p>The database objects being configured for replication might or might not exist at the destination databases when you run the wizard. If the database objects do not exist at a destination database, then the wizard instantiates them at the destination database using a Data Pump export/import. During instantiation, the instantiation SCN is set for these database objects. If the database objects exist at a destination database, then the wizard retains the existing database objects and sets the instantiation SCN for them. In this example, the <code>hr</code> schema exists at each database before the wizard is run.</p>
<p><a href="#CIHEFFEH">Figure 4-13</a> provides an overview of the environment created in this example.</p>
<div class="figure">
<p class="titleinfigure"><a id="CIHEFFEH"></a><a id="TDPII240"></a>Figure 4-13 Hub-and-Spoke Environment with Capture Processes and Read/Write Spokes</p>
<img width="668" height="899" src="img/tdpii504.gif" alt="Description of Figure 4-13 follows" /><br />
<a id="sthref254" href="img_text/tdpii504.htm">Description of "Figure 4-13 Hub-and-Spoke Environment with Capture Processes and Read/Write Spokes"</a><br />
<br /></div>
<!-- class="figure" -->
<p class="orderedlisttitle">To configure this hub-and-spoke replication environment with read/write spokes:&nbsp;</p>
<ol>
<li>
<p>Complete the following tasks to prepare for the hub-and-spoke replication environment:</p>
<ol>
<li>
<p>Configure network connectivity so that the following databases can communicate with each other:</p>
<ul>
<li>
<p>The <code>hub.example.com</code> database and the <code>spoke1.example.com</code> database</p>
</li>
<li>
<p>The <code>hub.example.com</code> database and the <code>spoke2.example.com</code> database</p>
</li>
</ul>
<p>See <a class="olink ADMQS004" href="../../server.112/e10897/network.htm#ADMQS004"><span class="italic">Oracle Database 2 Day DBA</span></a> for information about configuring network connectivity between databases.</p>
</li>
<li>
<p>Configure an Oracle Streams administrator at each database that will participate in the replication environment. See <a href="tdpii_common_ii.htm#BGBHDJHF">"Tutorial: Configuring an Oracle Streams Administrator"</a> for instructions. This example assumes that the Oracle Streams administrator is <code>strmadmin</code>.</p>
</li>
<li>
<p>Set initialization parameters properly at each database that will participate in the Oracle Streams replication environment. See <a href="#BABDHIIH">"Preparing for Oracle Streams Replication"</a> for instructions.</p>
</li>
<li>
<p>Configure each source database to run in <code>ARCHIVELOG</code> mode. For a capture process to capture changes generated at a source database, the source database must be running in <code>ARCHIVELOG</code> mode. In this example, all databases must be running in <code>ARCHIVELOG</code> mode. See <a class="olink ADMIN008" href="../../server.112/e25494/archredo.htm#ADMIN008"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about configuring a database to run in <code>ARCHIVELOG</code> mode.</p>
</li>
</ol>
</li>
<li>
<p>In Enterprise Manager, log in to the hub database <code>hub.example.com</code> as the Oracle Streams administrator.</p>
</li>
<li>
<p><a id="BABEFBAE"></a>Go to the Database Home page for the database instance.</p>
</li>
<li>
<p>Click <span class="bold">Data Movement</span> to open the Data Movement subpage.</p>
</li>
<li>
<p>Click <span class="bold">Setup</span> in the Streams section.</p>
<p>The Streams page appears, showing the setup options.</p>
<img width="909" height="499" src="img/tdpii_setup_streams.gif" alt="Description of tdpii_setup_streams.gif follows" /><br />
<a id="sthref256" href="img_text/tdpii_setup_streams.htm">Description of the illustration tdpii_setup_streams.gif</a><br />
<br /></li>
<li>
<p>Select <span class="bold">Replicate Schemas</span> in Setup Streams Replication.</p>
</li>
<li>
<p><a id="BABBGCDH"></a>In the Host Credentials section, enter the username and password for an administrative user on the host computer system.</p>
</li>
<li>
<p>Click <span class="bold">Continue</span>.</p>
</li>
<li>
<p>On the Object Selection page, select <span class="bold">HR</span> and click <span class="bold">Next</span>.</p>
</li>
<li>
<p><a id="BABBFEDJ"></a>On the Destination Options page, identify the spoke database <code>spoke1.example.com</code> by specifying its host name, port, SID or service name, and Oracle Streams administrator credentials.</p>
<p>(When you configure replication with the <code>spoke2.example.com</code> database, identify <code>spoke2.example.com</code>.)</p>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
<p>The Replication Options page appears.</p>
<img width="915" height="353" src="img/tdpii_setup_rep_options.gif" alt="Description of tdpii_setup_rep_options.gif follows" /><br />
<a id="sthref257" href="img_text/tdpii_setup_rep_options.htm">Description of the illustration tdpii_setup_rep_options.gif</a><br />
<br /></li>
<li>
<p><a id="BABHCBGD"></a>Complete the Replication Options page:</p>
<ol>
<li>
<p>In the Directory Path section, leave the directory paths for the source and destination database unchanged if the host user you specified in Step <a href="#BABBGCDH">7</a> can read from and write to the directories and the directories have enough space for a Data Pump export dump file. Otherwise, specify different directory paths, or create directory objects that meet these requirements and specify those.</p>
</li>
<li>
<p>Expand <span class="bold">Advanced Options</span>.</p>
<img width="904" height="596" src="img/tdpii_setup_ro_advanced.gif" alt="Description of tdpii_setup_ro_advanced.gif follows" /><br />
<a id="sthref258" href="img_text/tdpii_setup_ro_advanced.htm">Description of the illustration tdpii_setup_ro_advanced.gif</a><br />
<br /></li>
<li>
<p>In the Options section, ensure that <span class="bold">Capture, Propagate and Apply data manipulation language (DML) changes</span> is selected.</p>
</li>
<li>
<p>If you do not want to replicate DDL changes, then deselect <span class="bold">Capture, Propagate and Apply data definition language (DDL) changes</span>.</p>
</li>
<li>
<p>Select <span class="bold">Setup Bi-directional</span> replication.</p>
</li>
<li>
<p>In the Capture Process section, enter <code>capture_hns</code> in <span class="bold">Capture Name</span>.</p>
</li>
<li>
<p><a id="BABICFAC"></a>In the Propagation Process section, enter <code>propagation_spoke1</code> in <span class="bold">Propagation Name</span>. (When you configure replication with the <code>spoke2.example.com</code> database, enter <code>propagation_spoke2</code>.)</p>
</li>
<li>
<p><a id="BABHHGBF"></a>In the Apply Process section, enter <code>apply_spoke1</code> in <span class="bold">Apply Name</span>. (When you configure replication with the <code>spoke2.example.com</code> database, enter <code>apply_spoke2</code>.)</p>
</li>
</ol>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
</li>
<li>
<p>On the Schedule Job page, either select <span class="bold">Immediately</span> or specify a time for the job to run later.</p>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
</li>
<li>
<p>On the Review page, review the configuration information and click <span class="bold">Submit</span>.</p>
</li>
<li>
<p><a id="BABGGCGH"></a>On the Confirmation page, optionally click the job link to monitor the job.</p>
<p>When the job is running, information about its progress is recorded in the following data dictionary views: <code>DBA_RECOVERABLE_SCRIPT</code>, <code>DBA_RECOVERABLE_SCRIPT_PARAMS</code>, <code>DBA_RECOVERABLE_SCRIPT_BLOCKS</code>, and <code>DBA_RECOVERABLE_SCRIPT_ERRORS</code>. If the job stops because it encounters an error, then see <a class="olink STREP149" href="../../server.112/e10705/man_gen_rep.htm#STREP149"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for instructions about using the <code>RECOVER_OPERATION</code> procedure in the <code>DBMS_STREAMS_ADM</code> package to recover from these errors.</p>
</li>
<li>
<p>While still connected as the Oracle Streams administrator to the <code>hub.example.com</code> database, complete Steps <a href="#BABEFBAE">3</a> to <a href="#BABGGCGH">17</a> again. However, in Step&nbsp;<a href="#BABBFEDJ">10</a>, on the Destination Options page, identify the spoke database <code>spoke2.example.com</code> by specifying its host name, port, SID or service name, and Oracle Streams administrator credentials.</p>
<p>Also, in Step <a href="#BABHCBGD">12</a><a href="#BABICFAC">g</a>, enter <code>propagation_spoke2</code> in <span class="bold">Propagation Name</span>, and in Step <a href="#BABHCBGD">12</a><a href="#BABHHGBF">h</a>, enter <code>apply_spoke2</code> in <span class="bold">Apply Name</span></p>
</li>
</ol>
<p>When you complete the example, a hub-and-spoke replication environment with the following characteristics is configured:</p>
<ul>
<li>
<p>Supplemental logging is configured for the tables in the <code>hr</code> schema at each database.</p>
</li>
<li>
<p>Each database has a capture process named <code>capture_hns</code>. The capture process captures changes to the <code>hr</code> schema at the database.</p>
</li>
<li>
<p>Each database has a queue with a system-generated name. Each queue is for the capture process at the database.</p>
</li>
<li>
<p>The hub database <code>hub.example.com</code> has the following additional components:</p>
<ul>
<li>
<p>An apply process named <code>apply_spoke1</code>. This apply process applies changes to the <code>hr</code> schema that were sent from the <code>spoke1.example.com</code> database.</p>
</li>
<li>
<p>A queue with a system-generated name. This queue is for the <code>apply_spoke1</code> apply process at the database.</p>
</li>
<li>
<p>An apply process named <code>apply_spoke2</code>. This apply process applies changes to the <code>hr</code> schema that were sent from the <code>spoke2.example.com</code> database.</p>
</li>
<li>
<p>A queue with a system-generated name. This queue is for the <code>apply_spoke2</code> apply process at the database.</p>
</li>
<li>
<p>A propagation named <code>propagation_spoke1</code>. This propagation sends changes to the <code>hr</code> schema from a local queue to a queue at the <code>spoke1.example.com</code> database.</p>
</li>
<li>
<p>A propagation named <code>propagation_spoke2</code>. This propagation sends changes to the <code>hr</code> schema from a local queue to a queue at the <code>spoke2.example.com</code> database.</p>
</li>
</ul>
</li>
<li>
<p>The spoke database <code>spoke1.example.com</code> has the following additional components:</p>
<ul>
<li>
<p>An apply process named <code>apply_spoke1</code>. The apply process applies changes to the <code>hr</code> schema that were sent from the <code>hub.example.com</code> database.</p>
</li>
<li>
<p>A queue with a system-generated name. This queue is for the <code>apply_spoke1</code> apply process at the database.</p>
</li>
<li>
<p>A propagation named <code>propagation_spoke1</code>. This propagation sends changes to the <code>hr</code> schema from a local queue to a queue at the <code>hub.example.com</code> database.</p>
</li>
</ul>
</li>
<li>
<p>The spoke database <code>spoke2.example.com</code> has the following additional components:</p>
<ul>
<li>
<p>An apply process named <code>apply_spoke2</code>. The apply process applies changes to the <code>hr</code> schema that were sent from the <code>hub.example.com</code> database.</p>
</li>
<li>
<p>A queue with a system-generated name. This queue is for the <code>apply_spoke2</code> apply process at the database.</p>
</li>
<li>
<p>A propagation named <code>propagation_spoke2</code>. This propagation sends changes to the <code>hr</code> schema from a local queue to a queue at the <code>hub.example.com</code> database.</p>
</li>
</ul>
</li>
<li>
<p><a id="sthref259"></a>Tags are used to avoid change cycling in the following way:</p>
<ul>
<li>
<p>Each apply process uses an apply tag, and redo records for changes applied by the apply process include the tag. Each apply process uses an apply tag that is unique in the replication environment.</p>
</li>
<li>
<p>Each capture process captures all of the changes to the replicated database objects, regardless of the tag in the redo record. Therefore, each capture process captures the changes applied by the apply processes on its source database.</p>
</li>
<li>
<p>Each propagation sends all changes made to the replicated database objects to another database in the replication environment, except for changes that originated at the other database. The propagation rules instruct the propagation to discard these changes.</p>
</li>
</ul>
<p>See <a href="#BABICHGF">"About Tags for Avoiding Change Cycling"</a> and <a class="olink ARPLS878" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS878"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about how the replication environment avoids change cycling.</p>
</li>
</ul>
<p class="orderedlisttitle">To check the Oracle Streams replication configuration:&nbsp;</p>
<ol>
<li>
<p>At each database, ensure that the capture process is enabled and that the capture type is local. To do so, follow the instructions in <a href="tdpii_adcont.htm#CHDIFCCD">"Viewing Information About a Capture Process"</a>, and check the Status and Capture Type fields on the Capture subpage.</p>
</li>
<li>
<p>At each database, ensure that each propagation is enabled. To do so, follow the instructions in <a href="tdpii_adcont.htm#CHDGEBHI">"Viewing Information About a Propagation"</a>, and check the Status field on the Propagation subpage. The hub database should have two propagations, and they should both be enabled. Each spoke database should have one propagation that is enabled.</p>
</li>
<li>
<p>At each database, ensure that each apply process is enabled. To do so, follow the instructions in <a href="tdpii_adcont.htm#CHDIGAED">"Viewing Information About an Apply Process"</a>, and check the Status field on the Apply subpage. The hub database should have two apply processes, and they should both be enabled. Each spoke database should have one apply process that is enabled.</p>
</li>
</ol>
<p class="orderedlisttitle">To replicate changes:&nbsp;</p>
<ol>
<li>
<p>At one of the databases, make DML changes to any table in the <code>hr</code> schema.</p>
</li>
<li>
<p>After some time has passed to allow for replication of the changes, use SQL*Plus to query the modified table at the other databases to view the DML changes.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CIHJEIDB">"About Hub-And-Spoke Replication Environments"</a></p>
</li>
<li>
<p><a href="tdpii_intro2ii.htm#CFHJAAEA">"When to Replicate Data with Oracle Streams"</a></p>
</li>
<li>
<p><a href="tdpii_adcont.htm#CHDHCDDJ">Chapter 5, "Administering an Oracle Streams Replication Environment"</a></p>
</li>
<li>
<p><a class="olink STREP604" href="../../server.112/e10705/config_simple.htm#STREP604"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for an example that configures this replication environment using the <code>DBMS_STREAMS_ADM</code> supplied PL/SQL package</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABDEBBA"></a><a id="TDPII080"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Tutorial: Configuring Two-Database Replication with Synchronous Captures<a id="sthref262"></a><a id="sthref263"></a><a id="sthref264"></a><a id="sthref265"></a><a id="sthref266"></a><a id="sthref267"></a><a id="sthref268"></a></h3>
<p>The example in this topic configures an Oracle Streams replication environment that replicates data manipulation language (DML) changes to two tables in the <code>hr</code> schema. This example uses a synchronous capture at each database to capture these changes. In this example, the global names of the databases in the Oracle Streams replication environment are <code>sync1.example.com</code> and <code>sync2.example.com</code>. However, you can substitute any two databases in your environment to complete the example. See <a href="#CIHGHCGI">"About Two-Database Replication Environments"</a> for more information about two-database replication environments.</p>
<p>Specifically, this example configures a two-database Oracle Streams replication environment that shares the <code>hr.employees</code> and <code>hr.departments</code> tables at the <code>sync1.example.com</code> and <code>sync2.example.com</code> databases. The two databases replicate all of the DML changes to these tables. The <code>hr</code> sample schema is installed by default with Oracle Database.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
A synchronous capture can only capture changes at the table level. It cannot capture changes at the schema or database level. You can configure a synchronous capture using the <a class="olink ARPLS308" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS308"><code>ADD_TABLE_RULES</code></a> and <a class="olink ARPLS329" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS329"><code>ADD_SUBSET_RULES</code></a> procedures in the <a class="olink ARPLS305" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS305"><code>DBMS_STREAMS_ADM</code></a> package.</div>
<p><a href="#CIHHGJHC">Figure 4-14</a> provides an overview of the environment created in this example.</p>
<div class="figure">
<p class="titleinfigure"><a id="CIHHGJHC"></a><a id="TDPII244"></a>Figure 4-14 Two-Database Replication Environment with Synchronous Captures</p>
<img width="506" height="584" src="img/tdpii505.gif" alt="Description of Figure 4-14 follows" /><br />
<a id="sthref269" href="img_text/tdpii505.htm">Description of "Figure 4-14 Two-Database Replication Environment with Synchronous Captures"</a><br />
<br /></div>
<!-- class="figure" -->
<p class="orderedlisttitle">To configure this replication environment with synchronous captures:&nbsp;</p>
<ol>
<li>
<p>Complete the following tasks to prepare for the two-database replication environment:</p>
<ol>
<li>
<p>Configure network connectivity so that the two databases can communicate with each other. See <a class="olink ADMQS004" href="../../server.112/e10897/network.htm#ADMQS004"><span class="italic">Oracle Database 2 Day DBA</span></a> for information about configuring network connectivity between databases.</p>
</li>
<li>
<p>Configure an Oracle Streams administrator at each database that will participate in the replication environment. See <a href="tdpii_common_ii.htm#BGBHDJHF">"Tutorial: Configuring an Oracle Streams Administrator"</a> for instructions. This example assumes that the Oracle Streams administrator is <code>strmadmin</code>.</p>
</li>
<li>
<p>Set initialization parameters properly at each database that will participate in the Oracle Streams replication environment. See <a href="#BABDHIIH">"Preparing for Oracle Streams Replication"</a> for instructions.</p>
</li>
<li>
<p>Ensure that the <code>hr.employees</code> and <code>hr.departments</code> tables exist at the two databases and are consistent at these databases. If the database objects exist at only one database, then you can use export/import to create and populate them at the other database. See <a class="olink SUTIL" href="../e22490/toc.htm"><span class="italic">Oracle Database Utilities</span></a> for information about export/import.</p>
</li>
</ol>
</li>
<li>
<p>Create two <code>ANYDATA</code> queues at each database. For this example, create the following two queues at each database:</p>
<ul>
<li>
<p>A queue named <code>capture_queue</code> owned by the Oracle Streams administrator <code>strmadmin</code>. This queue will be used by the synchronous capture at the database.</p>
</li>
<li>
<p>A queue named <code>apply_queue</code> owned by the Oracle Streams administrator <code>strmadmin</code>. This queue will be used by the apply process at the database.</p>
</li>
</ul>
<p>See <a href="tdpii_common_ii.htm#CHDJHCAI">"Creating an ANYDATA Queue"</a> for instructions.</p>
</li>
<li>
<p><a id="CIHEIGAC"></a>Create a database link from each database to the other database:</p>
<ol>
<li>
<p>Create a database link from the <code>sync1.example.com</code> database to the <code>sync2.example.com</code> database. The database link should be created in the Oracle Streams administrator's schema. Also, the database link should connect to the Oracle Streams administrator at the <code>sync2.example.com</code> database. Both the name and the service name of the database link must be <code>sync2.example.com</code>.</p>
</li>
<li>
<p>Create a database link from the <code>sync2.example.com</code> database to the <code>sync1.example.com</code> database. The database link should be created in the Oracle Streams administrator's schema. Also, the database link should connect to the Oracle Streams administrator at the <code>sync1.example.com</code> database. Both the name and the service name of the database link must be <code>sync1.example.com</code>.</p>
</li>
</ol>
<p>See <a href="tdpii_common_ii.htm#BGBGIACD">"Tutorial: Creating a Database Link"</a> for instructions.</p>
</li>
<li>
<p><a id="sthref271"></a><a id="sthref272"></a><a id="sthref273"></a>Configure an apply process at the <code>sync1.example.com</code> database. This apply process will apply changes to the shared tables that were captured at the <code>sync2.example.com</code> database and propagated to the <code>sync1.example.com</code> database.</p>
<ol>
<li>
<p>Open SQL*Plus and connect to the <code>sync1.example.com</code> database as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p>Create the apply process:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.CREATE_APPLY(
    queue_name     =&gt; 'strmadmin.apply_queue',
    apply_name     =&gt; 'apply_emp_dep',
    apply_captured =&gt; FALSE);
END;
/
</pre>
<p>The <code>apply_captured</code> parameter is set to <code>FALSE</code> because the apply process applies changes in the persistent queue. These are changes that were captured by a synchronous capture. The <code>apply_captured</code> parameter should be set to <code>TRUE</code> only when the apply process applies changes captured by a capture process.</p>
<p>Do not start the apply process.</p>
</li>
<li>
<p>Add a rule to the apply process rule set:</p>
<pre>
BEGIN 
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt; 'hr.employees',
    streams_type    =&gt; 'apply',
    streams_name    =&gt; 'apply_emp_dep',
    queue_name      =&gt; 'strmadmin.apply_queue',
    source_database =&gt; 'sync2.example.com');
END;
/
</pre>
<p>This rule instructs the apply process <code>apply_emp_dep</code> to apply all DML changes to the <code>hr.employees</code> table that appear in the <code>apply_queue</code> queue. The rule also specifies that the apply process applies only changes that were captured at the <code>sync2.example.com</code> source database.</p>
</li>
<li>
<p>Add an additional rule to the apply process rule set:</p>
<pre>
BEGIN 
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt; 'hr.departments',
    streams_type    =&gt; 'apply',
    streams_name    =&gt; 'apply_emp_dep',
    queue_name      =&gt; 'strmadmin.apply_queue',
    source_database =&gt; 'sync2.example.com');
END;
/
</pre>
<p>This rule instructs the apply process <code>apply_emp_dep</code> to apply all DML changes to the <code>hr.departments</code> table that appear in the <code>apply_queue</code> queue. The rule also specifies that the apply process applies only changes that were captured at the <code>sync2.example.com</code> source database.</p>
</li>
</ol>
</li>
<li>
<p>Configure an apply process at the <code>sync2.example.com</code> database. This apply process will apply changes that were captured at the <code>sync1.example.com</code> database and propagated to the <code>sync2.example.com</code> database.</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code>sync2.example.com</code> database as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMIN00102" href="../../server.112/e25494/dba.htm#ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Create the apply process:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.CREATE_APPLY(
    queue_name     =&gt; 'strmadmin.apply_queue',
    apply_name     =&gt; 'apply_emp_dep',
    apply_captured =&gt; FALSE);
END;
/
</pre>
<p>The <code>apply_captured</code> parameter is set to <code>FALSE</code> because the apply process applies changes in the persistent queue. These changes were captured by a synchronous capture. The <code>apply_captured</code> parameter should be set to <code>TRUE</code> only when the apply process applies changes captured by a capture process.</p>
<p>Do not start the apply process.</p>
</li>
<li>
<p>Add a rule to the apply process rule set:</p>
<pre>
BEGIN 
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt; 'hr.employees',
    streams_type    =&gt; 'apply',
    streams_name    =&gt; 'apply_emp_dep',
    queue_name      =&gt; 'strmadmin.apply_queue',
    source_database =&gt; 'sync1.example.com');
END;
/
</pre>
<p>This rule instructs the apply process <code>apply_emp_dep</code> to apply all DML changes that appear in the <code>apply_queue</code> queue to the <code>hr.employees</code> table. The rule also specifies that the apply process applies only changes that were captured at the <code>sync1.example.com</code> source database.</p>
</li>
<li>
<p>Add an additional rule to the apply process rule set:</p>
<pre>
BEGIN 
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt; 'hr.departments',
    streams_type    =&gt; 'apply',
    streams_name    =&gt; 'apply_emp_dep',
    queue_name      =&gt; 'strmadmin.apply_queue',
    source_database =&gt; 'sync1.example.com');
END;
/
</pre>
<p>This rule instructs the apply process <code>apply_emp_dep</code> to apply all DML changes that appear in the <code>apply_queue</code> queue to the <code>hr.departments</code> table. The rule also specifies that the apply process applies only changes that were captured at the <code>sync1.example.com</code> source database.</p>
</li>
</ol>
</li>
<li>
<p><a id="sthref274"></a>Create a propagation to send changes from a queue at the <code>sync1.example.com</code> database to a queue at the <code>sync2.example.com</code> database:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code>sync1.example.com</code> database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Create the propagation that sends changes to the <code>sync2.example.com</code> database:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_PROPAGATION_RULES(
    table_name              =&gt; 'hr.employees',
    streams_name            =&gt; 'send_emp_dep',
    source_queue_name       =&gt; 'strmadmin.capture_queue',
    destination_queue_name  =&gt; 'strmadmin.apply_queue@sync2.example.com',
    source_database         =&gt; 'sync1.example.com',
    queue_to_queue          =&gt; TRUE);
END;
/
</pre>
<p>The <code>ADD_TABLE_PROPAGATION_RULES</code> procedure creates the propagation and its positive rule set. This procedure also adds a rule to the propagation rule set that instructs it to send DML changes to the <code>hr.employees</code> table to the <code>apply_queue</code> queue in the <code>sync2.example.com</code> database.</p>
</li>
<li>
<p>Add an additional rule to the propagation rule set:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_PROPAGATION_RULES(
    table_name              =&gt; 'hr.departments',
    streams_name            =&gt; 'send_emp_dep',
    source_queue_name       =&gt; 'strmadmin.capture_queue',
    destination_queue_name  =&gt; 'strmadmin.apply_queue@sync2.example.com',
    source_database         =&gt; 'sync1.example.com',
    queue_to_queue          =&gt; TRUE);
END;
/
</pre>
<p>The <code>ADD_TABLE_PROPAGATION_RULES</code> procedure adds a rule to the propagation rule set that instructs it to send DML changes to the <code>hr.departments</code> table to the <code>apply_queue</code> queue in the <code>sync2.example.com</code> database.</p>
</li>
</ol>
</li>
<li>
<p>Create a propagation to send changes from a queue at the <code>sync2.example.com</code> database to a queue at the <code>sync1.example.com</code> database:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code>sync2.example.com</code> database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Create the propagation that sends changes to the <code>sync1.example.com</code> database:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_PROPAGATION_RULES(
    table_name              =&gt; 'hr.employees',
    streams_name            =&gt; 'send_emp_dep',
    source_queue_name       =&gt; 'strmadmin.capture_queue',
    destination_queue_name  =&gt; 'strmadmin.apply_queue@sync1.example.com',
    source_database         =&gt; 'sync2.example.com',
    queue_to_queue          =&gt; TRUE);
END;
/
</pre>
<p>The <code>ADD_TABLE_PROPAGATION_RULES</code> procedure creates the propagation and its positive rule set. This procedure also adds a rule to the propagation rule set that instructs it to send DML changes to the <code>hr.employees</code> table to the <code>apply_queue</code> queue in the <code>sync1.example.com</code> database.</p>
</li>
<li>
<p>Add an additional rule to the propagation rule set:</p>
<pre>
BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_PROPAGATION_RULES(
    table_name              =&gt; 'hr.departments',
    streams_name            =&gt; 'send_emp_dep',
    source_queue_name       =&gt; 'strmadmin.capture_queue',
    destination_queue_name  =&gt; 'strmadmin.apply_queue@sync1.example.com',
    source_database         =&gt; 'sync2.example.com',
    queue_to_queue          =&gt; TRUE);
END;
/
</pre>
<p>The <code>ADD_TABLE_PROPAGATION_RULES</code> procedure adds a rule to the propagation rule set that instructs it to send DML changes to the <code>hr.departments</code> table to the <code>apply_queue</code> queue in the <code>sync1.example.com</code> database.</p>
</li>
</ol>
</li>
<li>
<p><a id="CIHFIABB"></a><a id="sthref275"></a>Configure a synchronous capture at the <code>sync1.example.com</code> database:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code>sync1.example.com</code> database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Run the <code>ADD_TABLE_RULES</code> procedure to create the synchronous capture and add a rule to instruct it to capture changes to the <code>hr.employees</code> table:</p>
<pre>
BEGIN 
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name    =&gt; 'hr.employees',
    streams_type  =&gt; 'sync_capture',
    streams_name  =&gt; 'sync_capture',
    queue_name    =&gt; 'strmadmin.capture_queue');
END;
/
</pre></li>
<li>
<p>Add an additional rule to the synchronous capture rule set:</p>
<pre>
BEGIN 
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name    =&gt; 'hr.departments',
    streams_type  =&gt; 'sync_capture',
    streams_name  =&gt; 'sync_capture',
    queue_name    =&gt; 'strmadmin.capture_queue');
END;
/
</pre></li>
</ol>
<p>Running these procedures performs the following actions:</p>
<ul>
<li>
<p>Creates a synchronous capture named <code>sync_capture</code> at the current database. A synchronous capture with the same name must not exist.</p>
</li>
<li>
<p>Enables the synchronous capture. A synchronous capture cannot be disabled.</p>
</li>
<li>
<p>Associates the synchronous capture with an existing queue named <code>capture_queue</code> owned by <code>strmadmin</code>.</p>
</li>
<li>
<p>Creates a positive rule set for synchronous capture <code>sync_capture</code>. The rule set has a system-generated name.</p>
</li>
<li>
<p>Creates a rule that captures DML changes to the <code>hr.employees</code> table and adds the rule to the positive rule set for the synchronous capture. The rule has a system-generated name.</p>
</li>
<li>
<p>Prepares the <code>hr.employees</code> table for instantiation by running the <code>DBMS_CAPTURE_ADM.PREPARE_SYNC_INSTANTIATION</code> function for the table automatically.</p>
</li>
<li>
<p>Creates a rule that captures DML changes to the <code>hr.departments</code> table and adds the rule to the positive rule set for the synchronous capture. The rule has a system-generated name.</p>
</li>
<li>
<p>Prepares the <code>hr.departments</code> table for instantiation by running the <code>DBMS_CAPTURE_ADM.PREPARE_SYNC_INSTANTIATION</code> function for the table automatically.</p>
</li>
</ul>
</li>
<li>
<p>Configure a synchronous capture at the <code>sync2.example.com</code> database:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code>sync2.example.com</code> database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Run the <code>ADD_TABLE_RULES</code> procedure to create the synchronous capture and add a rule to instruct it to capture changes to the <code>hr.employees</code> table:</p>
<pre>
BEGIN 
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name    =&gt; 'hr.employees',
    streams_type  =&gt; 'sync_capture',
    streams_name  =&gt; 'sync_capture',
    queue_name    =&gt; 'strmadmin.capture_queue');
END;
/
</pre></li>
<li>
<p>Add an additional rule to the synchronous capture rule set:</p>
<pre>
BEGIN 
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name    =&gt; 'hr.departments',
    streams_type  =&gt; 'sync_capture',
    streams_name  =&gt; 'sync_capture',
    queue_name    =&gt; 'strmadmin.capture_queue');
END;
/
</pre></li>
</ol>
<p>Step <a href="#CIHFIABB">8</a> describes the actions performed by these procedures at the current database.</p>
</li>
<li>
<p><a id="BEHGEJJI"></a>Set the instantiation SCN for the tables at the <code>sync2.example.com</code> database:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code>sync1.example.com</code> database as the Oracle Streams administrator.</p>
</li>
<li>
<p><a id="sthref276"></a><a id="sthref277"></a>Set the instantiation SCN for the <code>hr.employees</code> table at the <code>sync2.example.com</code> database:</p>
<pre>
DECLARE
  iscn  NUMBER;    -- Variable to hold instantiation SCN value
BEGIN
  iscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER();
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN@sync2.example.com(
    source_object_name    =&gt; 'hr.employees',
    source_database_name  =&gt; 'sync1.example.com',
    instantiation_scn     =&gt; iscn);
END;
/
</pre></li>
<li>
<p>Set the instantiation SCN for the <code>hr.departments</code> table at the <code>sync2.example.com</code> database:</p>
<pre>
DECLARE
  iscn  NUMBER;    -- Variable to hold instantiation SCN value
BEGIN
  iscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER();
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN@sync2.example.com(
    source_object_name    =&gt; 'hr.departments',
    source_database_name  =&gt; 'sync1.example.com',
    instantiation_scn     =&gt; iscn);
END;
/
</pre></li>
</ol>
<p>An instantiation SCN is the lowest SCN for which an apply process can apply changes to a table. Before the apply process can apply changes to the shared tables at the <code>sync2.example.com</code> database, an instantiation SCN must be set for each table.</p>
</li>
<li>
<p>Set the instantiation SCN for the tables at the <code>sync1.example.com</code> database:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code>sync2.example.com</code> database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Set the instantiation SCN for the <code>hr.employees</code> table at the <code>sync1.example.com</code> database:</p>
<pre>
DECLARE
  iscn  NUMBER;    -- Variable to hold instantiation SCN value
BEGIN
  iscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER();
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN@sync1.example.com(
    source_object_name    =&gt; 'hr.employees',
    source_database_name  =&gt; 'sync2.example.com',
    instantiation_scn     =&gt; iscn);
END;
/
</pre></li>
<li>
<p>Set the instantiation SCN for the <code>hr.departments</code> table at the <code>sync2.example.com</code> database:</p>
<pre>
DECLARE
  iscn  NUMBER;    -- Variable to hold instantiation SCN value
BEGIN
  iscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER();
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN@sync1.example.com(
    source_object_name    =&gt; 'hr.departments',
    source_database_name  =&gt; 'sync2.example.com',
    instantiation_scn     =&gt; iscn);
END;
/
</pre></li>
</ol>
</li>
<li>
<p><a id="sthref278"></a>Start the apply process at each database:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code>sync1.example.com</code> database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Start the apply process:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name =&gt; 'apply_emp_dep');
END;
/
</pre></li>
<li>
<p>In SQL*Plus, connect to the <code>sync2.example.com</code> database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Start the apply process:</p>
<pre>
BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name =&gt; 'apply_emp_dep');
END;
/
</pre></li>
</ol>
<p>If you would rather start the apply processes using Enterprise Manager, then see <a href="tdpii_adcont.htm#CHDIIAGC">"Starting and Stopping an Apply Process"</a> for instructions.</p>
</li>
<li>
<p>Configure latest time conflict resolution for the <code>hr.departments</code> and <code>hr.employees</code> tables at the <code>sync1.example.com</code> and <code>sync2.example.com</code> databases. See <a href="#CIHIACBB">"Tutorial: Configuring Latest Time Conflict Resolution for a Table"</a> for instructions.</p>
</li>
</ol>
<p>A two-database replication environment with the following characteristics is configured:</p>
<ul>
<li>
<p>Each database has a synchronous capture named <code>sync_capture</code>. The synchronous capture captures all DML changes to the <code>hr.employees</code> <code>hr.departments</code> tables.</p>
</li>
<li>
<p>Each database has a queue named <code>capture_queue</code>. This queue is for the synchronous capture at the database.</p>
</li>
<li>
<p>Each database has an apply process named <code>apply_emp_dep</code>. The apply process applies all DML changes to the <code>hr.employees</code> table and <code>hr.departments</code> tables.</p>
</li>
<li>
<p>Each database has a queue named <code>apply_queue</code>. This queue is for the apply process at the database.</p>
</li>
<li>
<p>Each database has a propagation named <code>send_emp_dep</code>. The propagation sends changes from the <code>capture_queue</code> in the local database to the <code>apply_queue</code> in the other database. The propagation sends all DML changes to the <code>hr.employees</code> and <code>hr.departments</code> tables.</p>
</li>
<li>
<p><a id="sthref279"></a>Tags are used to avoid change cycling in the following way:</p>
<ul>
<li>
<p>Each apply process uses the default apply tag. The default apply tag is the hexadecimal equivalent of <code>'00'</code> (double zero).</p>
</li>
<li>
<p>Each synchronous capture only captures changes in a session with a <code>NULL</code> tag. Therefore, neither synchronous capture captures the changes that are being applied by the local apply process. The synchronous capture rules instruct the synchronous capture not to capture these changes.</p>
</li>
</ul>
<p>See <a href="#BABICHGF">"About Tags for Avoiding Change Cycling"</a> for more information about how the replication environment avoids change cycling.</p>
</li>
</ul>
<p class="orderedlisttitle">To check the Oracle Streams replication configuration:&nbsp;</p>
<ol>
<li>
<p>At each database, complete the following steps to ensure that synchronous capture is configured:</p>
<ol>
<li>
<p>Start SQL*Plus and connect to the database as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p>Query the <a class="olink REFRN20572" href="../../server.112/e40402/statviews_2097.htm#REFRN20572"><code>ALL_SYNC_CAPTURE</code></a> data dictionary view:</p>
<pre>
SELECT CAPTURE_NAME FROM ALL_SYNC_CAPTURE;
</pre>
<p>Ensure that a synchronous capture named <code>sync_capture</code> exists at each database.</p>
</li>
</ol>
</li>
<li>
<p>At each database, ensure that the propagation is enabled. To do so, follow the instructions in <a href="tdpii_adcont.htm#CHDGEBHI">"Viewing Information About a Propagation"</a>, and check Status on the Propagation subpage.</p>
</li>
<li>
<p>At each database, ensure that the apply process is enabled. To do so, follow the instructions in <a href="tdpii_adcont.htm#CHDIGAED">"Viewing Information About an Apply Process"</a>, and check Status on the Apply subpage.</p>
</li>
</ol>
<p class="orderedlisttitle">To replicate changes:&nbsp;</p>
<ol>
<li>
<p>At one of the databases, make DML changes to the <code>hr.employees</code> table or <code>hr.departments</code> table.</p>
</li>
<li>
<p>After some time has passed to allow for replication of the changes, use SQL*Plus to query the <code>hr.employees</code> or <code>hr.departments</code> table at the other database to view the changes.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#BABJJJDE">"About Change Capture with a Synchronous Capture"</a></p>
</li>
<li>
<p><a href="#CIHJEIDB">"About Hub-And-Spoke Replication Environments"</a></p>
</li>
<li>
<p><a href="tdpii_intro2ii.htm#CFHJAAEA">"When to Replicate Data with Oracle Streams"</a></p>
</li>
<li>
<p><a href="tdpii_adcont.htm#CHDHCDDJ">Chapter 5, "Administering an Oracle Streams Replication Environment"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CIHIACBB"></a><a id="TDPII136"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Tutorial: Configuring Latest Time Conflict Resolution for a Table<a id="sthref282"></a><a id="sthref283"></a><a id="sthref284"></a><a id="sthref285"></a></h3>
<p>Conflict resolution automatically resolves conflicts in a replication environment. See <a href="#BABGAACC">"About Conflicts and Conflict Resolution"</a> for more information about conflict resolution.</p>
<p>The most common way to resolve update conflicts is to keep the change with the most recent time stamp and discard the older change. With this method, when a conflict is detected during apply, the apply process applies the change if the time-stamp column for the change is more recent than the corresponding row in the table. If the time-stamp column in the table is more recent, then the apply process discards the change.</p>
<p>The example in this topic configures latest time conflict resolution for the <code>hr.departments</code> table by completing the following actions:</p>
<ul>
<li>
<p>Adds a <code>time</code> column of the <code>TIMESTAMP</code> <code>WITH</code> <code>TIME</code> <code>ZONE</code> data type to the table</p>
</li>
<li>
<p>Configures a trigger to update the time column in a row with the current time when the row is changed</p>
</li>
<li>
<p>Adds supplemental logging for the columns in the table</p>
</li>
<li>
<p>Runs the <code>SET_UPDATE_CONFLICT_HANDLER</code> procedure in the <code>DBMS_APPLY_ADM</code> package to configure conflict resolution for the table</p>
</li>
</ul>
<p>You can use the steps in this topic to configure conflict resolution for any table. To do so, substitute your schema name for <code>hr</code> and your table name for <code>departments</code>. Also, substitute the columns in your table for the columns in the <code>hr.departments</code> table when you run the <code>SET_UPDATE_CONFLICT_HANDLER</code> procedure.</p>
<p class="orderedlisttitle">To configure latest time conflict resolution for the hr.departments table:&nbsp;</p>
<ol>
<li>
<p><a id="sthref287"></a><a id="sthref288"></a>Add a <code>time</code> column to the table.</p>
<ol>
<li>
<p>In SQL*Plus, connect to the database as an administrative user, such as the Oracle Streams administrator or <code>SYSTEM</code>. Alternatively, you can connect as the user who owns the table to which the time column will be added.</p>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p>Use the <a class="olink SQLRF01001" href="../../server.112/e41084/statements_3001.htm#SQLRF01001"><code>ALTER</code> <code>TABLE</code></a> SQL statement to add the <code>time</code> column to the table. In this example, run the following statement to add the <code>time</code> column to the <code>hr.departments</code> table.</p>
<pre>
ALTER TABLE hr.departments ADD (time TIMESTAMP WITH TIME ZONE);
</pre></li>
</ol>
</li>
<li>
<p><a id="sthref289"></a><a id="sthref290"></a>Create a trigger to update the <code>time</code> column in each master table with the current time when a change occurs.</p>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
Instead of using a trigger to update the <code>time</code> column, an application can populate the <code>time</code> column each time it modifies or inserts a row into a table.</div>
<ol>
<li>
<p>In Oracle Enterprise Manager, log in to the database as an administrative user, such as the Oracle Streams administrator or <code>SYSTEM</code>.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Click <span class="bold">Schema</span> to open the Schema subpage.</p>
</li>
<li>
<p>Click <span class="bold">Triggers</span> in the Programs section.</p>
</li>
<li>
<p>On the Triggers page, click <span class="bold">Create</span>.</p>
<p>The Create Trigger page appears, showing the General subpage.</p>
<img width="752" height="417" src="img/tdpii_create_trigger.gif" alt="Description of tdpii_create_trigger.gif follows" /><br />
<a id="sthref291" href="img_text/tdpii_create_trigger.htm">Description of the illustration tdpii_create_trigger.gif</a><br />
<br /></li>
<li>
<p>Enter the name of the trigger in the Name field. In this example, enter <code>insert_departments_time</code>.</p>
</li>
<li>
<p>Enter the schema that owns the table in the Schema field. In this example, enter <code>hr</code> in the Schema field.</p>
</li>
<li>
<p>Enter the following in the Trigger Body field:</p>
<pre>
BEGIN
   -- Consider time synchronization problems. The previous update to this
   -- row might have originated from a site with a clock time ahead of
   -- the local clock time.
   IF :OLD.TIME IS NULL OR :OLD.TIME &lt; SYSTIMESTAMP THEN
     :NEW.TIME := SYSTIMESTAMP;
   ELSE
     :NEW.TIME := :OLD.TIME + 1 / 86400;
   END IF;
END;
</pre></li>
<li>
<p>Click <span class="bold">Event</span> to open the Event subpage.</p>
</li>
<li>
<p>Ensure that <span class="bold">Table</span> is selected in the Trigger On list.</p>
</li>
<li>
<p>Enter the table name in the form <code><span class="codeinlineitalic">schema.table</span></code> in the Table (Schema.Table) field, or use the flashlight icon to find the database object. In this example, enter <code>hr.departments</code>.</p>
</li>
<li>
<p>Ensure that <span class="bold">Before</span> is selected for Fire Trigger.</p>
</li>
<li>
<p>Select <span class="bold">Insert</span> and <span class="bold">Update of Columns</span> for Event.</p>
<p>The columns in the table appear.</p>
</li>
<li>
<p>Select every column in the table except for the new <code>time</code> column.</p>
</li>
<li>
<p>Click <span class="bold">Advanced</span> to open the Advanced subpage.</p>
</li>
<li>
<p>Select <span class="bold">Trigger for each row</span>.</p>
</li>
<li>
<p>Click <span class="bold">OK</span> to create the trigger.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also use the <a class="olink SQLRF01405" href="../../server.112/e41084/statements_7004.htm#SQLRF01405"><code>CREATE</code> <code>TRIGGER</code></a> SQL statement to create a trigger.</div>
</li>
<li>
<p>In SQL*Plus, connect to the database as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMQS0361" href="../../server.112/e10897/em_manage.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p>Add supplemental logging for the columns in the table:</p>
<pre>
ALTER TABLE hr.departments ADD SUPPLEMENTAL LOG DATA (ALL) COLUMNS;
</pre>
<p>Supplemental logging is required for conflict resolution during apply.</p>
</li>
<li>
<p><a id="CIHHCHEI"></a><a id="sthref292"></a><a id="sthref293"></a>Run the <code>SET_UPDATE_CONFLICT_HANDLER</code> procedure to configure latest time conflict resolution for the table.</p>
<p>For example, run the following procedure to configure latest time conflict resolution for the <code>hr.departments</code> table:</p>
<pre>
DECLARE
  cols  DBMS_UTILITY.NAME_ARRAY;
BEGIN
  cols(1) := 'department_id';
  cols(2) := 'department_name';
  cols(3) := 'manager_id';
  cols(4) := 'location_id';
  cols(5) := 'time';
  DBMS_APPLY_ADM.SET_UPDATE_CONFLICT_HANDLER(
    object_name        =&gt;  'hr.departments',
    method_name        =&gt;  'MAXIMUM',
    resolution_column  =&gt;  'time',
    column_list        =&gt;  cols);
END;
/
</pre>
<p>Include all of the columns in the table in the <code>cols</code> column list.</p>
</li>
<li>
<p>Repeat these steps for any tables that require conflict resolution in your replication environment. You might need to configure conflict resolution for the tables at several databases.</p>
<p>If you are completing an example that configures or extends a replication environment, then configure latest time conflict resolution for the appropriate tables:</p>
<ul>
<li>
<p>For <a href="#CIHDBCGD">"Tutorial: Configuring Two-Database Replication with Local Capture Processes"</a>, configure conflict resolution for all of the tables in the <code>hr</code> schema at the <code>db1.example.com</code> and <code>db2.example.com</code> databases. This schema includes the <code>countries</code>, <code>departments</code>, <code>employees</code>, <code>jobs</code>, <code>job_history</code>, <code>locations</code>, and <code>regions</code> tables.</p>
</li>
<li>
<p>For <a href="#BABBIBCD">"Tutorial: Configuring Hub-and-Spoke Replication with Local Capture Processes"</a>, configure conflict resolution for all of the tables in the <code>hr</code> schema at the <code>hub1.example.com</code>, <code>spoke1.example.com</code>, and <code>spoke2.example.com</code> databases. This schema includes the <code>countries</code>, <code>departments</code>, <code>employees</code>, <code>jobs</code>, <code>job_history</code>, <code>locations</code>, and <code>regions</code> tables.</p>
</li>
<li>
<p>For <a href="#BABDEBBA">"Tutorial: Configuring Two-Database Replication with Synchronous Captures"</a>, configure conflict resolution for the <code>hr.departments</code> and <code>hr.employees</code> tables at the <code>sync1.example.com</code> and <code>sync2.example.com</code> databases.</p>
</li>
<li>
<p>For <a href="tdpii_repextend.htm#CIHCDDIJ">"Tutorial: Adding Database Objects to a Replication Environment"</a>, configure conflict resolution for the <code>oe.orders</code> and <code>oe.order_items</code> tables at the <code>hub.example.com</code>, <code>spoke1.example.com</code>, and <code>spoke2.example.com</code> databases.</p>
</li>
<li>
<p>For <a href="tdpii_repextend.htm#CIHIDHEH">"Tutorial: Adding Databases to a Replication Environment"</a>, configure conflict resolution for all of the tables in the <code>hr</code> schema at the <code>spoke3.example.com</code> database. This schema includes the <code>countries</code>, <code>departments</code>, <code>employees</code>, <code>jobs</code>, <code>job_history</code>, <code>locations</code>, and <code>regions</code> tables.</p>
</li>
</ul>
</li>
</ol>
<p>If you were directed to this section from an example, then go back to the example now.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#BABGAACC">"About Conflicts and Conflict Resolution"</a></p>
</li>
<li>
<p><a href="tdpii_adcont.htm#CHDCBHGC">"Displaying the Configured Update Conflict Handlers"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1402">
<tr>
<td class="cellalignment1409">
<table class="cellalignment1407">
<tr>
<td class="cellalignment1406"><a href="tdpii_distdbs.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1406"><a href="tdpii_adcont.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2007, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1411">
<table class="cellalignment1405">
<tr>
<td class="cellalignment1406"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1406"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1406"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1406"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1406"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1406"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
