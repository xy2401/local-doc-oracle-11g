<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Extending an Oracle Streams Replication Environment</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 033" />
<meta name="dcterms.created" content="2011-07-28T22:40:14Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database 2 Day + Data Replication and Integration Guide" />
<meta name="dcterms.identifier" content="E17516-08" />
<meta name="dcterms.isVersionOf" content="TDPII" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2007, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="tdpii_adcont.htm" title="Previous" type="text/html" />
<link rel="Next" href="tdpii_reppit.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e17516.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">9/14</span> <!-- End Header --><a id="BEBHDEHC"></a><a id="TDPII087"></a>
<h1 class="chapter"><span class="secnum">6</span> Extending an Oracle Streams Replication Environment</h1>
<p><a id="sthref416"></a>This chapter describes extending an Oracle Streams replication environment by adding database objects or databases.</p>
<p>This chapter contains the following sections:</p>
<ul>
<li>
<p><a href="#BEBBEJHG">About Extending an Oracle Streams Replication Environment</a></p>
</li>
<li>
<p><a href="#CIHCDDIJ">Tutorial: Adding Database Objects to a Replication Environment</a></p>
</li>
<li>
<p><a href="#CIHIDHEH">Tutorial: Adding Databases to a Replication Environment</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tdpii_repcont.htm#BABEFAFI">Chapter 4, "Replicating Data Using Oracle Streams"</a></p>
</li>
<li>
<p><a href="tdpii_adcont.htm#CHDHCDDJ">Chapter 5, "Administering an Oracle Streams Replication Environment"</a></p>
</li>
<li>
<p><a href="tdpii_intro2ii.htm#CFHJAAEA">"When to Replicate Data with Oracle Streams"</a></p>
</li>
<li>
<p><a class="olink STRMS" href="../e17069/toc.htm"><span class="italic">Oracle Streams Concepts and Administration</span></a></p>
</li>
<li>
<p><a class="olink STREP" href="../e10705/toc.htm"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a></p>
</li>
</ul>
</div>
<a id="BEBBEJHG"></a><a id="TDPII172"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">About Extending an Oracle Streams Replication Environment</h2>
<p>Sometimes it is necessary to extend an Oracle Streams replication environment when the needs of your organization change. You can extend an Oracle Streams replication environment by adding database objects or databases.</p>
<p>There are two ways to extend an Oracle Streams replication environment:</p>
<ul>
<li>
<p><a href="#BEBDABHB">Use the Setup Streams Replication Wizard or a Single Configuration Procedure</a></p>
</li>
<li>
<p><a href="#BEBBBFEE">Add the Oracle Streams Components Individually in Multiple Steps</a></p>
</li>
</ul>
<p class="subhead2"><a id="BEBDABHB"></a><a id="TDPII275"></a>Use the Setup Streams Replication Wizard or a Single Configuration Procedure<a id="sthref417"></a><a id="sthref418"></a><a id="sthref419"></a><a id="sthref420"></a><a id="sthref421"></a></p>
<p>You can extend an Oracle Streams Replication environment using one of the following methods if the environment satisfies certain conditions:</p>
<ul>
<li>
<p>Run the Setup Streams Replication Wizard in Oracle Enterprise Manager</p>
</li>
<li>
<p>Run one of the following procedures in the <a class="olink ARPLS305" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS305"><code>DBMS_STREAMS_ADM</code></a> package:</p>
<ul>
<li>
<p>The <a class="olink ARPLS825" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS825"><code>MAINTAIN_GLOBAL</code></a> procedure can add a new database to an environment that replicates changes to all of the database objects in the databases.</p>
</li>
<li>
<p>The <a class="olink ARPLS826" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS826"><code>MAINTAIN_SCHEMAS</code></a> procedure can add one or more new schemas to the existing databases in the replication environment, or it can add a new database that replicates schemas that are currently being replicated.</p>
</li>
<li>
<p>The <a class="olink ARPLS863" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS863"><code>MAINTAIN_SIMPLE_TTS</code></a> procedure can add a new simple tablespace to an existing replication environment, or it can add a new database that replicates a simple tablespace that is currently being replicated.</p>
</li>
<li>
<p>The <a class="olink ARPLS827" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS827"><code>MAINTAIN_TABLES</code></a> procedure can add one or more new tables to the existing databases in the replication environment, or it can add a new database that replicates tables that are currently being replicated.</p>
</li>
<li>
<p>The <a class="olink ARPLS864" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS864"><code>MAINTAIN_TTS</code></a> procedure can add a new set of tablespaces to an existing replication environment, or it can add a new database that replicates a set of tablespaces that are currently being replicated.</p>
</li>
</ul>
</li>
</ul>
<p>To use the wizard or one of the procedures to extend an Oracle Streams replication environment, the environment must satisfy the following conditions:</p>
<ul>
<li>
<p>It must be a two-database or hub-and-spoke replication environment that was configured by the Setup Streams Replication Wizard or one of the configuration procedures in the <code>DBMS_STREAMS_ADM</code> package. See <a href="tdpii_repcont.htm#CIHGGCCB">"About the Common Types of Oracle Streams Replication Environments"</a> for information about these types of replication environments.</p>
</li>
<li>
<p>It cannot use a synchronous capture at any database in the Oracle Streams replication environment. See <a href="tdpii_repcont.htm#BABJJJDE">"About Change Capture with a Synchronous Capture"</a> for more information about synchronous capture.</p>
</li>
<li>
<p>If you are adding a database to the environment, then each database that captures changes must use a local capture process. No database can use a downstream capture process. If you are adding one or more database objects to the environment, then the databases can use either local or downstream capture processes. See <a href="tdpii_repcont.htm#BABBFECB">"About Change Capture with a Capture Process"</a> for more information about downstream capture.</p>
</li>
<li>
<p>If you are adding database objects to the replication environment, then the database objects must exist at the database where you run the wizard or at the database specified in the <code>source_database</code> parameter of a configuration procedure.</p>
</li>
</ul>
<p>If your replication environment meets these conditions, then you can use the Setup Streams Replication Wizard or a single procedure to extend the environment.</p>
<p>The following are additional requirements for cases in which the replicated database objects exist at an intended destination database before you run the wizard or procedure:</p>
<ul>
<li>
<p>If you are adding database objects to the replication environment, and one or more of these database objects exist at a database other than the source database, then meet the following requirements:</p>
<ul>
<li>
<p>Before running the wizard or procedure, ensure that the replicated database objects at each destination database are consistent with replicated database objects at the source database.</p>
</li>
<li>
<p>After running the wizard or procedure, ensure that the instantiation SCN is set for each replicated database object at each destination database. See <a class="olink STREP012" href="../../server.112/e10705/instant.htm#STREP012"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about monitoring and setting instantiation SCNs.</p>
</li>
</ul>
</li>
<li>
<p>If you are adding a database to the replication environment, and any of the database objects that are replicated in the current environment exist at the added database, then meet the following requirements:</p>
<ul>
<li>
<p>Before running the wizard or procedure, ensure that the replicated database objects at each database being added are consistent with replicated database objects at the source database.</p>
</li>
<li>
<p>After running the wizard or procedure, ensure that the instantiation SCN is set for each replicated database object at the added database. See <a class="olink STREP012" href="../../server.112/e10705/instant.htm#STREP012"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about monitoring and setting instantiation SCNs.</p>
</li>
</ul>
</li>
</ul>
<p>For instructions about adding to a replication environment using the wizard, see the following topics:</p>
<ul>
<li>
<p><a href="#CIHCDDIJ">Tutorial: Adding Database Objects to a Replication Environment</a></p>
</li>
<li>
<p><a href="#CIHIDHEH">Tutorial: Adding Databases to a Replication Environment</a></p>
</li>
</ul>
<p>For instructions about adding to a replication environment using a single procedure, see <a class="olink STREP613" href="../../server.112/e10705/config_add.htm#STREP613"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a>.</p>
<p class="subhead2"><a id="BEBBBFEE"></a><a id="TDPII276"></a>Add the Oracle Streams Components Individually in Multiple Steps</p>
<p>If you cannot extend the Oracle Streams replication environment by using the Setup Streams Replication Wizard or a configuration procedure in the <code>DBMS_STREAMS_ADM</code> package, then you must complete the configuration steps manually. These steps include adding the necessary rules and Oracle Streams components to the environment, and other configuration steps.</p>
<p>If you must extend the Oracle Streams replication environment manually, then see the instructions in <a class="olink STREP058" href="../../server.112/e10705/config_add.htm#STREP058"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tdpii_repcont.htm#BABEFAFI">Chapter 4, "Replicating Data Using Oracle Streams"</a></p>
</li>
<li>
<p><a href="tdpii_repcont.htm#CIHJEIDB">"About Hub-And-Spoke Replication Environments"</a></p>
</li>
<li>
<p><a class="olink ARPLS878" href="../../appdev.112/e40758/d_streams_adm.htm#ARPLS878"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the procedures in the <code>DBMS_STREAMS_ADM</code> chapter</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CIHCDDIJ"></a><a id="TDPII088"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Tutorial: Adding Database Objects to a Replication Environment<a id="sthref422"></a><a id="sthref423"></a></h2>
<p>This topic includes an example that uses the Setup Streams Replication Wizard in Oracle Enterprise Manager to add tables to an existing hub-and-spoke replication environment. When the example is complete, the Oracle Streams replication environment replicates the changes made to the added tables at the databases in the environment.</p>
<p>Specifically, the example in this topic extends the replication environment configured in <a href="tdpii_repcont.htm#BABBIBCD">"Tutorial: Configuring Hub-and-Spoke Replication with Local Capture Processes"</a>. That configuration has the following characteristics:</p>
<ul>
<li>
<p>The <code>hr</code> schema is replicated at the <code>hub.example.com</code>, <code>spoke1.example.com</code>, and <code>spoke2.example.com</code> databases.</p>
</li>
<li>
<p>The <code>hub.example.com</code> database is the hub database in the hub-and-spoke environment, while the other databases are the spoke databases.</p>
</li>
<li>
<p>The spoke databases allow changes to the replicated schema, and each database has a local capture process to capture these changes.</p>
</li>
<li>
<p>Update conflict handlers are configured for each replicated table at each database to resolve conflicts</p>
</li>
</ul>
<p>This example adds the following tables to the environment:</p>
<ul>
<li>
<p><code>oe.orders</code></p>
</li>
<li>
<p><code>oe.order_items</code></p>
</li>
</ul>
<p>This example uses the tables in the <code>oe</code> sample schema. The <code>oe</code> sample schema is installed by default with Oracle Database.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Before you use the Setup Streams Replication Wizard to extend an Oracle Streams replication environment, ensure that the environment meets the conditions described in <a href="#BEBBEJHG">"About Extending an Oracle Streams Replication Environment"</a>.</div>
<p class="orderedlisttitle">To add database objects to an Oracle Streams replication environment:&nbsp;</p>
<ol>
<li>
<p><a id="BEBBDJEJ"></a>Stop the capture process at the hub database in the hub-and-spoke environment.</p>
<p>In this example, stop the capture process at the <code>hub.example.com</code> database. The replicated database objects can remain open to changes while the capture process is stopped. These changes will be captured when the capture process is restarted.</p>
<ol>
<li>
<p>In Oracle Enterprise Manager, log in to the hub database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Under High Availability, click the number link in <span class="bold">Streams Components</span>.</p>
<p>The Manage Replication page appears, showing the Overview subpage.</p>
</li>
<li>
<p>Click <span class="bold">Streams</span> to open the Streams subpage.</p>
<img width="980" height="436" src="img/tdpii_strrms_strms.gif" alt="Description of tdpii_strrms_strms.gif follows" /><br />
<a id="sthref425" href="img_text/tdpii_strrms_strms.htm">Description of the illustration tdpii_strrms_strms.gif</a><br />
<br /></li>
<li>
<p>Select the capture process to stop. If necessary, use the search tool to find the capture process, and then select it.</p>
</li>
<li>
<p>Select <span class="bold">Disable</span> in Action.</p>
</li>
<li>
<p>Click <span class="bold">Go</span>.</p>
</li>
<li>
<p>Click <span class="bold">Yes</span> on the confirmation page to stop the capture process.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also use the <a class="olink ARPLS548" href="../../appdev.112/e40758/d_cap_a.htm#ARPLS548"><code>DBMS_CAPTURE_ADM.STOP_CAPTURE</code></a> procedure to stop a capture process.</div>
</li>
<li>
<p><a id="CIHJCEDB"></a>While still connected to the hub database as the Oracle Streams administrator in Oracle Enterprise Manager, go to the Database Home page for the database instance.</p>
</li>
<li>
<p>Click <span class="bold">Data Movement</span> to open the Data Movement subpage.</p>
</li>
<li>
<p>Click <span class="bold">Setup</span> in the Streams section.</p>
<p>The Streams page appears, showing the setup options.</p>
</li>
<li>
<p>Select <span class="bold">Replicate Tables</span> in Setup Streams Replication.</p>
</li>
<li>
<p><a id="CIHDBFGI"></a>In the Host Credentials section, enter the username and password for an administrative user on the host computer system.</p>
</li>
<li>
<p>Click <span class="bold">Continue</span>.</p>
</li>
<li>
<p>On the Object Selection page, click <span class="bold">Add</span> to open the Select Table page.</p>
</li>
<li>
<p>Use the search tools to display the <code>oe.orders</code> and <code>oe.order_items</code> tables, and select these tables.</p>
<p>For example, to display these tables, enter <code>oe</code> in the Schema field and click <span class="bold">Go</span>.</p>
</li>
<li>
<p>Click <span class="bold">Select</span>. The Object Selection page displays the <code>oe.orders</code> and <code>oe.order_items</code> tables.</p>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
</li>
<li>
<p><a id="CIHEIHGH"></a>On the Destination Options page, identify the spoke database <code>spoke1.example.com</code> by specifying its host name, port, SID or service name, and Oracle Streams administrator credentials.</p>
<p>(When you configure replication with the <code>spoke2.example.com</code> database, identify <code>spoke2.example.com</code>.)</p>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
</li>
<li>
<p><a id="CIHGCFEG"></a>Complete the Replication Options page:</p>
<ol>
<li>
<p>In the Directory Path section, leave the directory paths for the source and destination database unchanged if the host user you specified in Step <a href="#CIHDBFGI">6</a> can read from and write to the directories and the directories have enough space for a Data Pump export dump file. Otherwise, specify different directory paths, or create directory objects that meet these requirements and specify those.</p>
</li>
<li>
<p>Expand <span class="bold">Advanced Options</span>.</p>
</li>
<li>
<p>In the Options section, ensure that <span class="bold">Capture, Propagate and Apply data manipulation language (DML) changes</span> is selected.</p>
</li>
<li>
<p>If you do not want to replicate DDL changes, then deselect <span class="bold">Capture, Propagate and Apply data definition language (DDL) changes</span>.</p>
</li>
<li>
<p>Select <span class="bold">Setup Bi-directional</span> replication.</p>
</li>
<li>
<p>In the Capture Process section, enter <code>capture_hns</code> in <span class="bold">Capture Name</span>.</p>
</li>
<li>
<p><a id="CIHDHIDI"></a>In the Propagation Process section, enter <code>propagation_spoke1</code> in <span class="bold">Propagation Name</span>. (When you configure replication with the <code>spoke2.example.com</code> database, enter <code>propagation_spoke2</code>.)</p>
</li>
<li>
<p><a id="CIHEFEJJ"></a>In the Apply Process section, enter <code>apply_spoke1</code> in <span class="bold">Apply Name</span>. (When you configure replication with the <code>spoke2.example.com</code> database, enter <code>apply_spoke2</code>.)</p>
</li>
</ol>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
</li>
<li>
<p>On the Schedule Job page, either select <span class="bold">Immediately</span> or specify a time for the job to run later.</p>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
</li>
<li>
<p>On the Review page, review the configuration information and click <span class="bold">Submit</span>.</p>
</li>
<li>
<p><a id="CIHJGCCG"></a>On the Confirmation page, optionally click the job link to monitor the job.</p>
<p>When the job is running, information about its progress is recorded in the following data dictionary views: <code>DBA_RECOVERABLE_SCRIPT</code>, <code>DBA_RECOVERABLE_SCRIPT_PARAMS</code>, <code>DBA_RECOVERABLE_SCRIPT_BLOCKS</code>, and <code>DBA_RECOVERABLE_SCRIPT_ERRORS</code>. If the job stops because it encounters an error, then see <a class="olink STREP149" href="../../server.112/e10705/man_gen_rep.htm#STREP149"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for instructions about using the <code>RECOVER_OPERATION</code> procedure in the <code>DBMS_STREAMS_ADM</code> package to recover from these errors.</p>
</li>
<li>
<p>While still connected as the Oracle Streams administrator to the hub database, complete Steps <a href="#BEBBDJEJ">1</a> to <a href="#CIHJGCCG">19</a> again. However, in Step&nbsp;<a href="#CIHEIHGH">12</a>, on the Destination Options page, identify the spoke database <code>spoke2.example.com</code> by specifying its host name, port, SID or service name, and Oracle Streams administrator credentials.</p>
<p>Also, in Step <a href="#CIHGCFEG">14</a><a href="#CIHDHIDI">g</a>, enter <code>propagation_spoke2</code> in <span class="bold">Propagation Name</span>, and in Step <a href="#CIHGCFEG">14</a><a href="#CIHEFEJJ">h</a>, enter <code>apply_spoke2</code> in <span class="bold">Apply Name</span></p>
</li>
<li>
<p>Set the instantiation SCN for the replicated tables at the spoke databases:</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
This step is required in this example because the replicated tables existed at the spoke databases before the wizard was run. If the replicated tables did not exist at the spoke databases before the wizard was run, then the wizard sets the instantiation SCN for the replicated tables, and this step is not required. Ensure that the data in the shared table is consistent at the source and destination databases when the instantiation SCN is set and that no changes are made to the table at the source database until after the SCN that is used for the instantiation SCN.</div>
<ol>
<li>
<p>In SQL*Plus, connect to the <code>hub.example.com</code> database as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMIN00102" href="../../server.112/e25494/dba.htm#ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Set the instantiation SCN for the <code>oe.orders</code> table at the <code>spoke1.example.com</code> database:</p>
<pre>
DECLARE
  iscn  NUMBER;    -- Variable to hold instantiation SCN value
BEGIN
  iscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER();
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN@spoke1.example.com(
    source_object_name    =&gt; 'oe.orders',
    source_database_name  =&gt; 'hub.example.com',
    instantiation_scn     =&gt; iscn);
END;
/
</pre></li>
<li>
<p>Set the instantiation SCN for the <code>oe.order_items</code> table at the <code>spoke1.example.com</code> database:</p>
<pre>
DECLARE
  iscn  NUMBER;    -- Variable to hold instantiation SCN value
BEGIN
  iscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER();
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN@spoke1.example.com(
    source_object_name    =&gt; 'oe.order_items',
    source_database_name  =&gt; 'hub.example.com',
    instantiation_scn     =&gt; iscn);
END;
/
</pre></li>
<li>
<p>Set the instantiation SCN for the <code>oe.orders</code> table at the <code>spoke2.example.com</code> database:</p>
<pre>
DECLARE
  iscn  NUMBER;    -- Variable to hold instantiation SCN value
BEGIN
  iscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER();
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN@spoke2.example.com(
    source_object_name    =&gt; 'oe.orders',
    source_database_name  =&gt; 'hub.example.com',
    instantiation_scn     =&gt; iscn);
END;
/
</pre></li>
<li>
<p>Set the instantiation SCN for the <code>oe.order_items</code> table at the <code>spoke2.example.com</code> database:</p>
<pre>
DECLARE
  iscn  NUMBER;    -- Variable to hold instantiation SCN value
BEGIN
  iscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER();
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN@spoke2.example.com(
    source_object_name    =&gt; 'oe.order_items',
    source_database_name  =&gt; 'hub.example.com',
    instantiation_scn     =&gt; iscn);
END;
/
</pre></li>
</ol>
</li>
<li>
<p>Configure latest time conflict resolution for the <code>orders</code> and <code>order_items</code> tables in the <code>oe</code> schema at the <code>hub.example.com</code>, <code>spoke1.example.com</code>, and <code>spoke2.example.com</code> databases. See <a href="tdpii_repcont.htm#CIHIACBB">"Tutorial: Configuring Latest Time Conflict Resolution for a Table"</a> for instructions.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tdpii_repcont.htm#BABEFAFI">Chapter 4, "Replicating Data Using Oracle Streams"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CIHIDHEH"></a><a id="TDPII089"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Tutorial: Adding Databases to a Replication Environment<a id="sthref426"></a><a id="sthref427"></a></h2>
<p>This topic includes an example that uses the Setup Streams Replication Wizard in Oracle Enterprise Manager to add a new spoke database to an existing hub-and-spoke replication environment. When the example is complete, the Oracle Streams replication environment replicates the changes made to the schema with the new database.</p>
<p>Specifically, the example in this topic extends the replication environment configured in <a href="tdpii_repcont.htm#BABBIBCD">"Tutorial: Configuring Hub-and-Spoke Replication with Local Capture Processes"</a>. That configuration has the following characteristics:</p>
<ul>
<li>
<p>The <code>hr</code> schema is replicated at the <code>hub.example.com</code>, <code>spoke1.example.com</code>, and <code>spoke2.example.com</code> databases.</p>
</li>
<li>
<p>The <code>hub.example.com</code> database is the hub database in the hub-and-spoke environment, while the other databases are the spoke databases.</p>
</li>
<li>
<p>The spoke databases allow changes to the replicated schema, and each database has a local capture process to capture these changes.</p>
</li>
</ul>
<p>This example adds the <code>spoke3.example.com</code> database to the environment.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Before you use the Setup Streams Replication Wizard to extend an Oracle Streams replication environment, ensure that the environment meets the conditions described in <a href="#BEBBEJHG">"About Extending an Oracle Streams Replication Environment"</a>.</div>
<p class="orderedlisttitle">To add a database to an existing Oracle Streams replication environment:&nbsp;</p>
<ol>
<li>
<p>Complete the following tasks to prepare the environment for the new database:</p>
<ol>
<li>
<p>Configure network connectivity so that the hub database can communicate with the new spoke database. In this example, configure network connectivity so that the <code>hub.example.com</code> database and the <code>spoke3.example.com</code> databases can communicate with each other.</p>
<p>See <a class="olink ADMQS004" href="../../server.112/e10897/network.htm#ADMQS004"><span class="italic">Oracle Database 2 Day DBA</span></a> for information about configuring network connectivity between databases.</p>
</li>
<li>
<p>Configure an Oracle Streams administrator at the new spoke database. In this example, configure an Oracle Streams administrator at the <code>spoke3.example.com</code> database. See <a href="tdpii_common_ii.htm#BGBHDJHF">"Tutorial: Configuring an Oracle Streams Administrator"</a> for instructions. This example assumes that the Oracle Streams administrator is <code>strmadmin</code>.</p>
</li>
<li>
<p>Set initialization parameters properly at the new spoke database. In this example, set initialization parameters properly at the <code>spoke3.example.com</code> database. See <a href="tdpii_repcont.htm#BABDHIIH">"Preparing for Oracle Streams Replication"</a> for instructions.</p>
</li>
<li>
<p>Configure the new spoke database to run in <code>ARCHIVELOG</code> mode. For a capture process to capture changes generated at a source database, the source database must be running in <code>ARCHIVELOG</code> mode. In this example, configure the <code>spoke3.example.com</code> database to run in <code>ARCHIVELOG</code> mode. See <a class="olink ADMIN008" href="../../server.112/e25494/archredo.htm#ADMIN008"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about configuring a database to run in <code>ARCHIVELOG</code> mode.</p>
</li>
</ol>
</li>
<li>
<p><a id="BEBHHCHJ"></a>Stop the capture process at the hub database in the hub-and-spoke environment.</p>
<p>In this example, stop the capture process at the <code>hub.example.com</code> database. The replicated database objects can remain open to changes while the capture process is stopped. These changes will be captured when the capture process is restarted.</p>
<ol>
<li>
<p>In Oracle Enterprise Manager, log in to the hub database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Go to the Database Home page.</p>
</li>
<li>
<p>Under High Availability, click the number link in <span class="bold">Streams Components</span>.</p>
<p>The Manage Replication page appears, showing the Overview subpage.</p>
</li>
<li>
<p>Click <span class="bold">Streams</span> to open the Streams subpage.</p>
<img width="980" height="436" src="img/tdpii_strrms_strms.gif" alt="Description of tdpii_strrms_strms.gif follows" /><br />
<a id="sthref429" href="img_text/tdpii_strrms_strms.htm">Description of the illustration tdpii_strrms_strms.gif</a><br />
<br /></li>
<li>
<p>Select the capture process to stop. If necessary, use the search tool to find the capture process, and then select it.</p>
</li>
<li>
<p>Select <span class="bold">Disable</span> in Action.</p>
</li>
<li>
<p>Click <span class="bold">Go</span>.</p>
</li>
<li>
<p>Click <span class="bold">Yes</span> on the confirmation page to stop the capture process.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can also use the <a class="olink ARPLS548" href="../../appdev.112/e40758/d_cap_a.htm#ARPLS548"><code>DBMS_CAPTURE_ADM.STOP_CAPTURE</code></a> procedure to stop a capture process.</div>
</li>
<li>
<p>While still connected to the hub database as the Oracle Streams administrator in Oracle Enterprise Manager, go to the Database Home page for the database instance.</p>
</li>
<li>
<p>Click <span class="bold">Data Movement</span> to open the Data Movement subpage.</p>
</li>
<li>
<p>Click <span class="bold">Setup</span> in the Streams section.</p>
<p>The Streams page appears, showing the setup options.</p>
</li>
<li>
<p>Select <span class="bold">Replicate Schemas</span> in Setup Streams Replication.</p>
</li>
<li>
<p><a id="CIHHDHGA"></a>In the Host Credentials section, enter the username and password for an administrative user on the host computer system.</p>
</li>
<li>
<p>Click <span class="bold">Continue</span>.</p>
</li>
<li>
<p>On the Object Selection page, select <span class="bold">HR</span> and click <span class="bold">Next</span>.</p>
</li>
<li>
<p><a id="CIHCBDEG"></a>On the Destination Options page, identify the spoke database <code>spoke3.example.com</code> by specifying its host name, port, SID or service name, and Oracle Streams administrator credentials.</p>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
</li>
<li>
<p>Complete the Replication Options page:</p>
<ol>
<li>
<p>In the Directory Path section, leave the directory paths for the source and destination database unchanged if the host user you specified in Step <a href="#CIHHDHGA">7</a> can read from and write to the directories and the directories have enough space for a Data Pump export dump file. Otherwise, specify different directory paths, or create directory objects that meet these requirements and specify those.</p>
</li>
<li>
<p>Expand <span class="bold">Advanced Options</span>.</p>
</li>
<li>
<p>In the Options section, ensure that <span class="bold">Capture, Propagate and Apply data manipulation language (DML) changes</span> is selected.</p>
</li>
<li>
<p>If you do not want to replicate DDL changes, then deselect <span class="bold">Capture, Propagate and Apply data definition language (DDL) changes</span>.</p>
</li>
<li>
<p>Select <span class="bold">Setup Bi-directional</span> replication.</p>
</li>
<li>
<p>In the Capture Process section, enter <code>capture_hns</code> in <span class="bold">Capture Name</span>.</p>
</li>
<li>
<p>In the Propagation Process section, enter <code>propagation_spoke3</code> in <span class="bold">Propagation Name</span>.</p>
</li>
<li>
<p>In the Apply Process section, enter <code>apply_spoke3</code> in <span class="bold">Apply Name</span>.</p>
</li>
</ol>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
</li>
<li>
<p>On the Schedule Job page, either select <span class="bold">Immediately</span> or specify a time for the job to run later.</p>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
</li>
<li>
<p>On the Review page, review the configuration information and click <span class="bold">Submit</span>.</p>
</li>
<li>
<p>On the Confirmation page, optionally click the job link to monitor the job.</p>
<p>When the job is running, information about its progress is recorded in the following data dictionary views: <code>DBA_RECOVERABLE_SCRIPT</code>, <code>DBA_RECOVERABLE_SCRIPT_PARAMS</code>, <code>DBA_RECOVERABLE_SCRIPT_BLOCKS</code>, and <code>DBA_RECOVERABLE_SCRIPT_ERRORS</code>. If the job stops because it encounters an error, then see <a class="olink STREP149" href="../../server.112/e10705/man_gen_rep.htm#STREP149"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for instructions about using the <code>RECOVER_OPERATION</code> procedure in the <code>DBMS_STREAMS_ADM</code> package to recover from these errors.</p>
</li>
<li>
<p>Configure latest time conflict resolution for all of the tables in the <code>hr</code> schema at the <code>spoke3.example.com</code> database. This schema includes the <code>countries</code>, <code>departments</code>, <code>employees</code>, <code>jobs</code>, <code>job_history</code>, <code>locations</code>, and <code>regions</code> tables. <a href="tdpii_repcont.htm#CIHIACBB">"Tutorial: Configuring Latest Time Conflict Resolution for a Table"</a> for instructions.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tdpii_repcont.htm#BABEFAFI">Chapter 4, "Replicating Data Using Oracle Streams"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1402">
<tr>
<td class="cellalignment1409">
<table class="cellalignment1407">
<tr>
<td class="cellalignment1406"><a href="tdpii_adcont.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1406"><a href="tdpii_reppit.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2007, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1411">
<table class="cellalignment1405">
<tr>
<td class="cellalignment1406"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1406"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1406"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1406"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1406"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1406"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
