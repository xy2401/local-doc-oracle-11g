<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Basic Steps to Manage Oracle ACFS Systems</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 047" />
<meta name="dcterms.created" content="2012-02-03T20:20:22Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Automatic Storage Management Administrator's Guide" />
<meta name="dcterms.identifier" content="E18951-03" />
<meta name="dcterms.isVersionOf" content="OSTMG" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2007, 2012,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="ostmg_gloss.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="asmfs_util.htm" title="Previous" type="text/html" />
<link rel="Next" href="asmfs_util002.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e18951.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">27/40</span> <!-- End Header --><a id="CACGCIBC"></a><a id="OSTMG91000"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h1 class="sect1">Basic Steps to Manage Oracle ACFS Systems</h1>
<p><a id="sthref1141"></a>This section provides an outline of the basic steps when managing Oracle ACFS file systems using command-line utilities.</p>
<p>The examples in this section show operating system commands that are run in a Linux environment system. ASMCMD commands manage the volumes, but you can also use SQL*PLus, Oracle ASM Configuration Assistant (ASMCA), and Oracle Enterprise Manager to manage volumes.</p>
<p>This section contains these topics:</p>
<ul>
<li>
<p><a href="#BABDHBEI">Creating an Oracle ACFS File System</a></p>
</li>
<li>
<p><a href="#BABIGHCF">Accessing an Oracle ACFS File System on a Different Node in the Cluster</a></p>
</li>
<li>
<p><a href="#BABBJFCH">Managing Oracle ACFS Snapshots</a></p>
</li>
<li>
<p><a href="#BABBDCAI">Securing Oracle ACFS File Systems</a></p>
</li>
<li>
<p><a href="#BABCBIAH">Encrypting Oracle ACFS File Systems</a></p>
</li>
<li>
<p><a href="#BABEDCJF">Tagging Oracle ACFS File Systems</a></p>
</li>
<li>
<p><a href="#BABEJGJG">Replicating Oracle ACFS File Systems</a></p>
</li>
<li>
<p><a href="#BABCJBBI">Deregistering, Dismounting, and Disabling Volumes and Oracle ACFS File Systems</a></p>
</li>
<li>
<p><a href="#BABGBDFH">Removing an Oracle ACFS File System and a Volume</a></p>
</li>
</ul>
<a id="BABDHBEI"></a><a id="OSTMG94787"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Creating an Oracle ACFS File System</h2>
<p><a id="sthref1142"></a>To create and verify a file system, perform the following steps:</p>
<ol>
<li>
<p>Create an Oracle ASM volume in a mounted disk group with the ASMCMD <code>volcreate</code> command.</p>
<p><a id="sthref1143"></a>The compatibility parameters <code>COMPATIBLE.ASM</code> and <code>COMPATIBLE.ADVM</code> must be set to 11.2 or higher for the disk group to contain an Oracle ADVM volume. To use Oracle ACFS encryption, replication, security, or tagging, the disk group on which the volume is created for the file system must have compatibility attributes for <code>ASM</code> and <code>ADVM</code> set to <code>11.2.0.2</code> . See <a href="asmdiskgrps.htm#CHDCACGC">"Disk Group Compatibility Attributes"</a>.</p>
<p>Start ASMCMD connected to the Oracle ASM instance. You must be a user in the OSASM operating system group. See <a href="asminst.htm#CHDEDIID">"About Privileges for Oracle ASM"</a>.</p>
<p>When configuring Oracle ADVM volume devices within a disk group, Oracle recommends assigning the Oracle Grid Infrastructure user and Oracle ASM administrator roles to users who have root privileges.</p>
<p>To create a volume:</p>
<pre>
ASMCMD [+] &gt; volcreate -G data -s 10G volume1
</pre>
<p><a id="sthref1144"></a><a id="sthref1145"></a>On Linux platforms, the volume name must be less than or equal to eleven alphanumeric characters, starting with an alphabetic character. On AIX platforms, the volume name must be less than or equal to twenty three alphanumeric characters, starting with an alphabetic character. On Windows and Solaris platforms, the volume name must be less than or equal to thirty alphanumeric characters, starting with an alphabetic character.</p>
<p>When creating an Oracle ASM volume, a volume device name is created that includes a unique Oracle ADVM persistent disk group number. The volume device file functions in the same manner as any other disk or logical volume to mount file systems or for applications to use directly.</p>
<p>For information about the <code>volcreate</code> command, see <a href="asm_util007.htm#CIHJJIAG">"volcreate"</a>.</p>
</li>
<li>
<p>Determine the device name of the volume that was created.</p>
<p><a id="sthref1146"></a><a id="sthref1147"></a>You can determine the volume device name with the ASMCMD <code>volinfo</code> command or from the <code>VOLUME_DEVICE</code> column in the <code>V$ASM_VOLUME</code> view.</p>
<p>For example:</p>
<pre>
ASMCMD [+] &gt; volinfo -G data volume1
Diskgroup Name: DATA

         Volume Name: VOLUME1
         Volume Device: /dev/asm/volume1-123
         State: ENABLED
     ... 

SQL&gt; SELECT volume_name, volume_device FROM V$ASM_VOLUME 
     WHERE volume_name ='VOLUME1';

VOLUME_NAME        VOLUME_DEVICE
-----------------  --------------------------------------
VOLUME1            /dev/asm/volume1-123
</pre>
<p>For information about the <code>volinfo</code> command, see <a href="asm_util007.htm#CIHIEJCH">"volinfo"</a>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN30625" href="../../server.112/e40402/dynviews_1036.htm#REFRN30625"><span class="italic">Oracle Database Reference</span></a> for information about the <code>V$ASM_VOLUME</code> view</div>
</li>
<li>
<p>Create a file system with the Oracle ACFS <code>mkfs</code> command.</p>
<p><a id="sthref1148"></a><a id="sthref1149"></a>Create a file system using an existing volume device.</p>
<p>For example:</p>
<pre>
$ /sbin/mkfs -t acfs /dev/asm/volume1-123

mkfs.acfs: version                   = 11.2.0.1.0.0
mkfs.acfs: on-disk version           = 39.0
mkfs.acfs: volume                    = /dev/asm/volume1-123
mkfs.acfs: volume size               = 10737418240
mkfs.acfs: Format complete.
</pre>
<p>See <a href="asmfs_util002.htm#CACGFHAA">"mkfs"</a> (Linux or UNIX) or <a href="asmfs_util005.htm#CACHBIID">"acfsformat"</a> (Windows). The <code>root</code> privilege is not required. The ownership of the volume device file dictates who can run this command.</p>
</li>
<li>
<p>Optionally register the file system with the <code>acfsutil</code> <code>registry</code> command.</p>
<p>For example:</p>
<pre>
$ /sbin/acfsutil registry -a /dev/asm/volume1-123 /u01/app/acfsmounts/myacfs

acfsutil registry: mount point /u01/app/acfsmounts/myacfs successfully added 
  to Oracle Registry
</pre>
<p>See <a href="asmfs_util010.htm#CACGHBHI">"acfsutil registry"</a>. The <code>root</code> or <code>asmadmin</code> privileges are required to modify the registry. The Windows <code>Administrator</code> privilege is equivalent to the <code>root</code> privilege on Linux.</p>
<p><a id="sthref1150"></a><a id="sthref1151"></a>Registering a file system is optional. After registering an Oracle ACFS file system in the cluster mount registry, the file system is mounted automatically on each cluster member listed in the registry entry during the next registry check action. This automatic process runs every 30 seconds and eliminates the requirement to manually mount the file system on each member of the cluster.</p>
<p>Registering an Oracle ACFS file system also causes the file system to be mounted automatically whenever Oracle Clusterware or the system is restarted.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
In an Oracle Grid Infrastructure Clusterware configuration, you can run <code>srvctl</code> <code>add</code> <code>filesystem</code> to automount a file system; this method is required when an Oracle Database home is installed on an Oracle ACFS file system. However, that file system should not be added to the registry. For information about Server Control Utility (SRVCTL), see <a class="olink RACAD005" href="../../rac.112/e41960/srvctladmin.htm#RACAD005"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a>.</div>
<p>For more information, see <a href="asmfilesystem.htm#CACDGDEF">"About the Oracle ACFS Mount Registry"</a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
A file system is not automatically mounted for an Oracle Restart configuration, which is a single-instance (non-clustered) environment.</div>
</li>
<li>
<p>Mount the file system with the Oracle ACFS <code>mount</code> command. You can mount a file system before or after registering the file system. If the file system has been registered, you can wait for the file system to be mounted automatically.</p>
<p><a id="sthref1152"></a><a id="sthref1153"></a>For example:</p>
<pre>
# /bin/mount -t acfs /dev/asm/volume1-123 /u01/app/acfsmounts/myacfs
</pre>
<p>See <a href="asmfs_util002.htm#CACEJAGF">"mount"</a> (Linux or UNIX) or <a href="asmfs_util005.htm#CACFAAJD">"acfsmountvol"</a> (Windows). The <code>root</code> privilege is required to run the <code>mount</code> command and the Windows <code>Administrator</code> privilege is required to run the <code>acfsmountvol</code> command.</p>
<p>After the file system has been mounted, ensure that the permissions are set to allow access to the file system for the appropriate users. For example:</p>
<pre>
# chown -R oracle:dba /u01/app/acfsmounts/myacfs
</pre></li>
<li>
<p>Create a test file in the file system.</p>
<p>The user that creates the test file should be a user that is intended to access the file system. This test ensures that the appropriate user can write to the file system.</p>
<p>For example:</p>
<pre>
$ echo "Oracle ACFS File System" &gt; /u01/app/acfsmounts/myacfs/myfile
</pre></li>
<li>
<p>List the contents of the test file that was created in the file system.</p>
<p>For example:</p>
<pre>
$ cat /u01/app/acfsmounts/myacfs/myfile
Oracle ACFS File System
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABIGHCF"></a><a id="OSTMG94788"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Accessing an Oracle ACFS File System on a Different Node in the Cluster</h2>
<p><a id="sthref1154"></a><a id="sthref1155"></a>If the node is part of a cluster, perform the following steps on node 2 to view the test file you created on node 1.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If the file system has been registered with the Oracle ACFS mount registry, you can skip steps 1 to 3.</div>
<ol>
<li>
<p>Enable the volume that was previously created and enabled on node 1.</p>
<p>Start ASMCMD connected to the Oracle ASM instance. You must be a user in the OSASM operating system group. See <a href="asminst.htm#CHDEDIID">"About Privileges for Oracle ASM"</a>.</p>
<p>For example:</p>
<pre>
ASMCMD [+] &gt; volenable -G data volume1
</pre>
<p>See <a href="asm_util007.htm#CIHECJFA">"volenable"</a>.</p>
</li>
<li>
<p>View information about the volume that you created on node 1.</p>
<p>For example:</p>
<pre>
ASMCMD [+] &gt; volinfo -G data volume1
</pre>
<p>See <a href="asm_util007.htm#CIHIEJCH">"volinfo"</a>.</p>
</li>
<li>
<p>Mount the file system using the Oracle ACFS <code>mount</code> command.</p>
<p>For example:</p>
<pre>
# /bin/mount -t acfs /dev/asm/volume1-123 /u01/app/acfsmounts/myacfs
</pre>
<p>See <a href="asmfs_util002.htm#CACEJAGF">"mount"</a> (Linux or UNIX) or <a href="asmfs_util005.htm#CACFAAJD">"acfsmountvol"</a> (Windows). The <code>root</code> privilege is required run the <code>mount</code> command and the Windows <code>Administrator</code> privilege is required to run the <code>acfsmountvol</code> command.</p>
<p>After the file system has been mounted, ensure that the permissions are set to allow access for the appropriate users.</p>
</li>
<li>
<p>List the contents of the test file you previously created on the file system.</p>
<p>For example:</p>
<pre>
$ cat /u01/app/acfsmounts/myacfs/myfile
Oracle ACFS File System
</pre>
<p>The contents should match the file created previously on node 1.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABBJFCH"></a><a id="OSTMG94789"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Managing Oracle ACFS Snapshots</h2>
<p><a id="sthref1156"></a>To create and verify a snapshot on node 1:</p>
<ol>
<li>
<p>Create snapshot of the new file system created on node 1.</p>
<p>For example:</p>
<pre>
$ /sbin/acfsutil snap create mysnapshot_20090725 /u01/app/acfsmounts/myacfs
</pre>
<p>See <a href="asmfs_util010.htm#CACIBBFE">"acfsutil snap create"</a>.</p>
</li>
<li>
<p>Update the test file in the file system so that it is different than the snapshot.</p>
<p>For example:</p>
<pre>
$ echo "Modifying a file in Oracle ACFS File System" &gt; /u01/app/acfsmounts/myacfs/myfile
</pre></li>
<li>
<p>List the contents of the test file and the snapshot view of the test file.</p>
<p>For example:</p>
<pre>
$ cat /u01/app/acfsmounts/myacfs/myfile

$ cat /u01/app/acfsmounts/myacfs/.ACFS/snaps/mysnapshot_20090725/myfile
</pre>
<p>The contents of the test file and snapshot should be different. If node 1 is in a cluster, then you can perform the same list operation on node 2.</p>
</li>
</ol>
<p>To manage snapshots with Oracle Enterprise Manager, see <a href="asmfs_em.htm#CACHFEFH">"Managing Oracle ACFS Snapshots with Oracle Enterprise Manager"</a>.</p>
</div>
<!-- class="sect2" -->
<a id="BABBDCAI"></a><a id="OSTMG94790"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Securing Oracle ACFS File Systems</h2>
<p><a id="sthref1157"></a><a id="sthref1158"></a>This section discusses the basic operations to manage security for an Oracle ACFS file system on Linux.</p>
<p>The scenario in this section shows how could you use Oracle ACFS security to ensure that only the maintenance user can access medical history files during the maintenance period. Also, Oracle ACFS encryption is also enabled on the same file system.</p>
<p>The scenario in this section assumes you are not planning to use Oracle ACFS replication on the file system. You cannot use Oracle ACFS security with replication.</p>
<p>The disk group on which the volume is created for the file system has compatibility attributes for <code>ASM</code> and <code>ADVM</code> set to <code>11.2.0.3</code> . For information about disk group compatibility, refer to <a href="asmdiskgrps.htm#CHDDIGBJ">"Disk Group Compatibility"</a>.</p>
<p>The basic steps to manage security are:</p>
<ol>
<li>
<p>Initialize security for Oracle ACFS.</p>
<p><a id="sthref1159"></a><a id="sthref1160"></a>Run the <code>acfsutil</code> <code>sec</code> <code>init</code> command to configure storage for security credentials and identify an operating system user as the first security administrator and the operating system security group. The security administrator must belong to the operating system group. This command must be run before any other security command and requires root or Windows <code>Administrator</code> privileges to run.</p>
<p>The <code>acfsutil</code> <code>sec</code> <code>init</code> command is only run once to set up Oracle ACFS security for each cluster and can be run from any node in the cluster. Other security commands can also be run from any node in a cluster. Security administrators are common for all Oracle ACFS file systems in a cluster.</p>
<p>For example, the following command initializes security for a cluster and creates the first security administrator (<code>medHistAdmin1</code>).</p>
<pre>
# /sbin/acfsutil sec init -u medHistAdmin1 -g medHistAdminGrp
</pre>
<p>The <code>medHistAdmin1</code> security administrator must belong to the <code>medHistAdminGrp</code> operating system group. That group is identified as the security group for the security administrators.</p>
<p>When the root user or Windows <code>Administrator</code> user runs the command, the user assigns a temporary security password to the first security administrator. The first security administrator should now change the temporary password with the <code>acfsutil</code> <code>sec</code> <code>admin</code> <code>password</code> command. The valid password format is described in <a href="asmfs_util008.htm#BABIABFA">"acfsutil sec init"</a>.</p>
<pre>
$ /sbin/acfsutil sec admin password
</pre>
<p>Note that all <code>acfsutil</code> <code>sec</code> commands (other than <code>acfsutil</code> <code>sec</code> <code>init</code>) must be run by an Oracle ACFS security administrator and the administrator is prompted for the security administrator's password when each command is run.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
When prompting for the security administrator's password, the following text displays: <code>Realm</code> <code>management</code> <code>password</code>
<p>The password required is the Oracle ACFS security administrator's password, not the operating system password of the user.</p>
</div>
<p>Security administrators are allowed to browse all directories in an Oracle ACFS file system whether they have the underlying operating system permissions and whether any realm checks allow it. This functionality enables a security administrator to check the location of the files when securing them with Oracle ACFS security realms. However, a security administrator cannot view the contents of individual files without the appropriate operating system and security realm permissions.</p>
<p>For more information, refer to <a href="asmfs_util008.htm#BABIABFA">"acfsutil sec init"</a> and <a href="asmfs_util008.htm#BABBIEGG">"acfsutil sec admin password"</a>.</p>
</li>
<li>
<p>Add additional security administrators as necessary.</p>
<p><a id="sthref1161"></a><a id="sthref1162"></a>The first security administrator can add additional security administrators to administer Oracle ACFS security with the <code>acfsutil</code> <code>sec</code> <code>admin</code> <code>add</code> command.</p>
<p>For example, add a new security administrator <code>medHistAdmin2</code>.</p>
<pre>
$ /sbin/acfsutil sec admin add medHistAdmin2
</pre>
<p>The <code>medHistAdmin2</code> user must belong to the operating system group (<code>medHistAdminGrp</code>) identified as the security administrator group with the <code>acfsutil</code> <code>sec</code> <code>init</code> command.</p>
<p>The <code>medHistAdmin2</code> security administrator should change the assigned temporary security password with the <code>acfsutil</code> <code>sec</code> <code>admin</code> <code>password</code> command. The <code>medHistAdmin2</code> administrator can add new security administrators.</p>
<p>For more information, refer to <a href="asmfs_util008.htm#BABFACDF">"acfsutil sec admin add"</a> and <a href="asmfs_util008.htm#BABBIEGG">"acfsutil sec admin password"</a>.</p>
</li>
<li>
<p>Prepare an Oracle ACFS file system for security.</p>
<p><a id="sthref1163"></a><a id="sthref1164"></a>Run the <code>acfsutil</code> <code>sec</code> <code>prepare</code> on an Oracle ACFS file system before adding any security realms.</p>
<p>For example, prepare the Oracle ACFS file system mounted on <code>/acfsmounts/acfs1</code> for Oracle ACFS security.</p>
<pre>
$ /sbin/acfsutil sec prepare -m /acfsmounts/acfs1
</pre>
<p>By default, security is enabled for a file system after running this command. You can explicitly disable or enable security with the <code>acfsutil</code> <code>sec</code> <code>disable</code> or <code>acfsutil</code> <code>sec</code> <code>enable</code> commands. For more information, refer to <a href="asmfs_util008.htm#BABCHHHB">"acfsutil sec disable"</a> and <a href="asmfs_util008.htm#BABHAHGI">"acfsutil sec enable"</a>.</p>
<p>This command automatically creates several security realms, such as the <code>SYSTEM_BackupOperators</code> security realm. Administrators can add users to the <code>SYSTEM_BackupOperators</code> realm which gives those users permissions to make backups of realm-secured files in the Oracle ACFS file system.</p>
<p>For more information, refer to <a href="asmfs_util008.htm#BABEHCAA">"acfsutil sec prepare"</a>.</p>
</li>
<li>
<p>Provide encryption for this file system.</p>
<p><a id="sthref1165"></a><a id="sthref1166"></a>Encrypting the file system is optional, but is enabled in this scenario.</p>
<ol>
<li>
<p>First, run the <code>acfsutil</code> <code>encr</code> <code>init</code> command to initialize encryption and create the storage necessary for the encryption keys. This command must be run one time for each cluster on which encryption is set up.</p>
<p>For example, the following command initializes encryption for a cluster.</p>
<pre>
# /sbin/acfsutil encr init
</pre>
<p>This command must be run before any other encryption command and requires root or administrator privileges to run. For more information, refer to <a href="asmfs_util009.htm#BABGAIGD">"acfsutil encr init"</a>.</p>
</li>
<li>
<p>Next, run the <code>acfsutil</code> <code>encr</code> <code>set</code> command to set encryption for the Oracle ACFS file system.</p>
<p>For example, the following command sets encryption for the file system mounted on the <code>/acfsmounts/acfs1</code> directory.</p>
<pre>
# /sbin/acfsutil encr set -m /acfsmounts/acfs1/
</pre>
<p>The <code>acfsutil</code> <code>encr</code> <code>set</code> command transparently generates a volume encryption key which is stored in the key store that was previously configured with the <code>acfsutil</code> <code>encr</code> <code>init</code> command. This command requires root or administrator privileges to run.</p>
</li>
</ol>
<p>For more information, refer to <a href="asmfs_util009.htm#BABGAIGD">"acfsutil encr init"</a> and <a href="asmfs_util009.htm#BABBGCAH">"acfsutil encr set"</a>.</p>
</li>
<li>
<p>Create a security realm on the file system.</p>
<p><a id="sthref1167"></a><a id="sthref1168"></a>Run the <code>acfsutil</code> <code>sec</code> <code>realm</code> <code>create</code> command to create a security realm for a file system.</p>
<p>For example, create a security realm named <code>medHistRealm</code> which contains medical records files with all files encrypted in the realm.</p>
<pre>
$ /sbin/acfsutil sec realm create medHistRealm -m /acfsmounts/acfs1/ 
                                               -e on -a AES -k 128
</pre>
<p>The <code>-e</code> option specifies that all the files in the realm are encrypted with the <code>AES</code> algorithm and the key length set to 128 bits. The file system must first be prepared for encryption with the <code>acfsutil</code> <code>encr</code> <code>init</code> and <code>acfsutil</code> <code>encr</code> <code>set</code> commands. Note that you do not have to enter the same value for the <code>-k</code> option with <code>acfsutil</code> <code>sec</code> <code>realm</code> <code>create</code> as you have entered with the <code>acfsutil</code> <code>encr</code> <code>set</code> command.</p>
<p>For more information, refer to <a href="asmfs_util008.htm#BABJJCIF">"acfsutil sec realm create"</a>.</p>
</li>
<li>
<p>Create security rules.</p>
<p><a id="sthref1169"></a><a id="sthref1170"></a>Run the <code>acfsutil</code> <code>sec</code> <code>rule</code> <code>create</code> command to creates rules which determine access to the files and directories of a security realm.</p>
<p>For example, create rules that allow the <code>medMaintenance</code> user to access medical records for the time period 10 PM to 2 AM for file maintenance.</p>
<pre>
$ /sbin/acfsutil sec rule create medHistRule1a &ndash;m /acfsmounts/acfs1/
      &ndash;t time 22:00:00,02:00:00 &ndash;o ALLOW

$ /sbin/acfsutil sec rule create medHistRule1b &ndash;m /acfsmounts/acfs1/
      &ndash;t username medMaintenance &ndash;o ALLOW
</pre>
<p>You can edit rules with the <code>acfsutil</code> <code>sec</code> <code>rule</code> <code>edit</code> command.</p>
<p>For more information, refer to <a href="asmfs_util008.htm#BABIIFDA">"acfsutil sec rule create"</a> and <a href="asmfs_util008.htm#BABJIIAJ">"acfsutil sec rule edit"</a>.</p>
</li>
<li>
<p>Create security rule sets and add rules to rule sets.</p>
<p><a id="sthref1171"></a><a id="sthref1172"></a>Run the <code>acfsutil</code> <code>sec</code> <code>ruleset</code> <code>create</code> command to create a rule set to which rules can be added.</p>
<p>For example, create a rule set named <code>medRuleSet1</code> that includes rules for operations on the files and directories of the security <code>medHistRealm</code> realm.</p>
<pre>
$ /sbin/acfsutil sec ruleset create medRuleSet1 &ndash;m /acfsmounts/acfs1/
</pre>
<p>Add the rules to the <code>medRuleSet1</code> rule set.</p>
<pre>
$ /sbin/acfsutil sec ruleset edit medRuleSet1 &ndash;m /acfsmounts/acfs1/ 
           -a medHistRule1a,medHistRule1b -o ALL_TRUE
</pre>
<p>The <code>ALL_TRUE</code> option is the default action, but is added here to emphasize that both rules in each rule set must be true.</p>
<p>For more information, refer to <a href="asmfs_util008.htm#BABDBGBG">"acfsutil sec ruleset create"</a> and <a href="asmfs_util008.htm#BABHFEIA">"acfsutil sec ruleset edit"</a>.</p>
</li>
<li>
<p>Add objects to a security realm.</p>
<p><a id="sthref1173"></a><a id="sthref1174"></a>Run the <code>acfsutil</code> <code>sec</code> <code>realm</code> <code>add</code> command to add objects, such as command rules, rule sets, and files, to a security realm.</p>
<p>For example, add the <code>medRuleSet1</code> rule set and all the files in the <code>/acfsmounts/acfs1/medicalrecords</code> directory to the <code>medHistRealm</code>.</p>
<pre>
$ /sbin/acfsutil sec realm add medHistRealm &ndash;m /acfsmounts/acfs1/ 
        -l ALL:medRuleSet1
        &ndash;f -r /acfsmounts/acfs1/medicalrecords
</pre>
<p>When adding a rule set to a realm, the rule set is added with a command rule, such as <code>ALL:medRuleSet1</code>. Only one rule set can be included with each command rule. To display a list of the command rules, use <code>acfsutil</code> <code>sec</code> <code>info</code> with the <code>-c</code> option. Refer to <a href="asmfs_util008.htm#BABBJJDB">"acfsutil sec info"</a>.</p>
<p>Add backup operators to the <code>SYSTEM_BackupOperators</code> security realm that was automatically created with the <code>acfsutil</code> <code>sec</code> <code>prepare</code> command.</p>
<pre>
$ /sbin/acfsutil sec realm add SYSTEM_BackupOperators &ndash;m /acfsmounts/acfs1/ 
        -G sysBackupGrp
</pre>
<p>Users that belong to the <code>sysBackupGrp</code> operating system group can now make backups of realm-secured files in the Oracle ACFS file system.</p>
<p>For more information, refer to <a href="asmfs_util008.htm#BABJCDBC">"acfsutil sec realm add"</a> and <a href="asmfs_util008.htm#BABFJCHB">"acfsutil sec realm delete"</a>.</p>
</li>
<li>
<p>Display security information.</p>
<p><a id="sthref1175"></a><a id="sthref1176"></a>Run the <code>acfsutil</code> <code>sec</code> <code>info</code> command to display information for a security realm. For example, display security information for the <code>medHistRealm</code> realm.</p>
<pre>
$ /sbin/acfsutil sec info -m /acfsmounts/acfs1/ &ndash;n medHistRealm
</pre>
<p>To display the security realms to which a file or a directory belongs, run the <code>acfsutil</code> <code>sec</code> <code>info</code> <code>file</code> command. For example:</p>
<pre>
$ /sbin/acfsutil sec info file -m /acfsmounts/acfs1/
                               /acfsmounts/acfs1/medicalrecords
</pre>
<p>For more information, refer to <a href="asmfs_util008.htm#BABBJJDB">"acfsutil sec info"</a> and <a href="asmfs_util008.htm#BABDJHJD">"acfsutil sec info file"</a>.</p>
</li>
<li>
<p>Save security metadata as a backup.</p>
<p><a id="sthref1177"></a><a id="sthref1178"></a>Run the <code>acfsutil</code> <code>sec</code> <code>save</code> command to save the security metadata of a file system.</p>
<p>For example, save the security metadata of the <code>/acfsmounts/acfs1</code> file system to the <code>acfs1_backup.xml</code> file.</p>
<pre>
$ /sbin/acfsutil sec save &ndash;m /acfsmounts/acfs1 
                          &ndash;p acfs1_backup.xml
</pre>
<p>The <code>acfs1_backup.xml</code> security metadata backup file is saved in the <code>/acfsmounts/acfs1/.Security/backup/</code> directory. The saved XML file can be loaded with the <code>acfsutil</code> <code>sec</code> <code>load</code> command.</p>
<p>For more information, refer to <a href="asmfs_util008.htm#BABCAACB">"acfsutil sec save"</a> and <a href="asmfs_util008.htm#BABCFBCE">"acfsutil sec load"</a>.</p>
</li>
</ol>
<p>You can run some <code>acfsutil</code> <code>sec</code> commands in a batch file with the <code>acfsutil</code> <code>sec</code> <code>batch</code> command. For example, you could create a batch file that contains a group of <code>acfsutil</code> <code>sec</code> <code>rule</code> and <code>acfsutil</code> <code>sec</code> <code>ruleset</code> commands. For more information, refer to <a href="asmfs_util008.htm#BABHIGIB">"acfsutil sec batch"</a>.</p>
<p>Auditing and diagnostic data for Oracle ACFS security is saved to log files. For more information about Oracle ACFS security, including the log files, refer to <a href="asmfilesystem.htm#CBBBBJAC">"Oracle ACFS Security"</a>.</p>
</div>
<!-- class="sect2" -->
<a id="BABCBIAH"></a><a id="OSTMG94791"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Encrypting Oracle ACFS File Systems</h2>
<p><a id="sthref1179"></a><a id="sthref1180"></a>This section discusses the basic operations to manage encryption on an Oracle ACFS file system on Linux. The examples in this section show a scenario in which the medical history files are encrypted in an Oracle ACFS file system.</p>
<p>The steps in this section assume Oracle ACFS security is not configured for the file system; however, you can use both Oracle ACFS security and encryption on the same file system. If you decide to use both security and encryption, then both encryption and security must be initialized for the cluster containing the file system. After security is initialized on the file system, then an Oracle ACFS security administrator runs <code>acfsutil</code> <code>sec</code> commands to provide encryption for the file system. For information about setting up security with encryption, refer to <a href="#BABBDCAI">"Securing Oracle ACFS File Systems"</a>.</p>
<p>The steps in this section assume you are not planning to use Oracle ACFS replication on the file system. You cannot use Oracle ACFS encryption with replication.</p>
<p>Because the <code>acfsutil</code> <code>encr</code> <code>set</code> and <code>acfsutil</code> <code>encr</code> <code>rekey</code> <code>-v</code> commands modify the encryption key store, you should back up the Oracle Cluster Registry (OCR) after running these commands to ensure there is an OCR backup that contains all of the volume encryption keys (VEKs) for the file system.</p>
<p>The disk group on which the volume is created for the file system has compatibility attributes for <code>ASM</code> and <code>ADVM</code> set to <code>11.2.0.3</code> . For information about disk group compatibility, refer to <a href="asmdiskgrps.htm#CHDDIGBJ">"Disk Group Compatibility"</a>.</p>
<p>The basic steps to manage encryption are:</p>
<ol>
<li>
<p>Initialize encryption.</p>
<p><a id="sthref1181"></a><a id="sthref1182"></a>Run the <code>acfsutil</code> <code>encr</code> <code>init</code> command to initialize encryption and create the storage necessary for the encryption keys. This command must be run one time for each cluster on which encryption is set up.</p>
<p>For example, the following command initializes encryption for a cluster.</p>
<pre>
# /sbin/acfsutil encr init
</pre>
<p>This command must be run before any other encryption command and requires root or administrator privileges to run.</p>
<p>For more information, refer to <a href="asmfs_util009.htm#BABGAIGD">"acfsutil encr init"</a>.</p>
</li>
<li>
<p>Set encryption parameters.</p>
<p><a id="sthref1183"></a><a id="sthref1184"></a>Run the <code>acfsutil</code> <code>encr</code> <code>set</code> command to set the encryption parameters for the entire Oracle ACFS file system.</p>
<p>For example, the following command sets the <code>AES</code> encryption algorithm and a file key length of <code>128</code> for a file system mounted on the <code>/acfsmounts/acfs1</code> directory.</p>
<pre>
# /sbin/acfsutil encr set -a AES -k 128 -m /acfsmounts/acfs1/
</pre>
<p>The <code>acfsutil</code> <code>encr</code> <code>set</code> command also transparently generates a volume encryption key which is stored in the key store that was previously configured with the <code>acfsutil</code> <code>encr</code> <code>init</code> command.</p>
<p>This command requires root or administrator privileges to run.</p>
<p>For more information, refer to <a href="asmfs_util009.htm#BABBGCAH">"acfsutil encr set"</a>.</p>
</li>
<li>
<p>Enable encryption.</p>
<p><a id="sthref1185"></a><a id="sthref1186"></a>Run the <code>acfsutil</code> <code>encr</code> <code>on</code> command to enable encryption for directories and files.</p>
<p>For example, the following command enables encryption recursively on all files in the <code>/acfsmounts/acfs1/medicalrecords</code> directory.</p>
<pre>
# /sbin/acfsutil encr on -r /acfsmounts/acfs1/medicalrecords
                         -m /acfsmounts/acfs1/
</pre>
<p>For users that have appropriate permissions to access files in the <code>/acfsmounts/acfs1/medicalrecords</code> directory, they can still read the decrypted files.</p>
<p>This command can be run by an administrator or the file owner.</p>
<p>For more information, refer to <a href="asmfs_util009.htm#BABEBJBI">"acfsutil encr on"</a>.</p>
</li>
<li>
<p>Display encryption information.</p>
<p><a id="sthref1187"></a><a id="sthref1188"></a>Run the <code>acfsutil</code> <code>encr</code> <code>info</code> command to display encryption information for directories and files.</p>
<pre>
# /sbin/acfsutil encr info -m /acfsmounts/acfs1/ 
                           -r /acfsmounts/acfs1/medicalrecords
</pre>
<p>This command can be run by an administrator or the file owner.</p>
<p>For more information, refer to <a href="asmfs_util009.htm#BABFIDEF">"acfsutil encr info"</a>.</p>
</li>
</ol>
<p>Auditing and diagnostic data for Oracle ACFS encryption is saved to log files. For more information about Oracle ACFS encryption, including the log files, refer to <a href="asmfilesystem.htm#CBBEIEEC">"Oracle ACFS Encryption"</a>.</p>
</div>
<!-- class="sect2" -->
<a id="BABEDCJF"></a><a id="OSTMG94792"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Tagging Oracle ACFS File Systems</h2>
<p><a id="sthref1189"></a><a id="sthref1190"></a>This section discusses the operations to manage tagging on directories and files in an Oracle ACFS file system on Linux.</p>
<p>The disk group on which the volume is created for the file system has compatibility attributes for <code>ASM</code> and <code>ADVM</code> set to <code>11.2.0.3</code> . For information about disk group compatibility, refer to <a href="asmdiskgrps.htm#CHDDIGBJ">"Disk Group Compatibility"</a>.</p>
<p>Oracle ACFS implements tagging with Extended Attributes. There are some requirements for using Extended Attributes; refer to <a href="asmfilesystem.htm#CBBHAEFA">"Oracle ACFS Tagging"</a>.</p>
<p>The steps to manage tagging are:</p>
<ol>
<li>
<p>Specify tag names for directories and files.</p>
<p><a id="sthref1191"></a><a id="sthref1192"></a>Run the <code>acfsutil</code> <code>tag</code> <code>set</code> command to set tags on directories or files. You can use these tags to specify which objects are replicated.</p>
<p>For example, add the <code>comedy</code> and <code>drama</code> tags to the files in the subdirectories of the <code>/acfsmounts/repl_data/films</code> directory.</p>
<pre>
$ /sbin/acfsutil tag set -r comedy /acfsmounts/repl_data/films/comedies

$ /sbin/acfsutil tag set -r drama /acfsmounts/repl_data/films/dramas

$ /sbin/acfsutil tag set -r drama /acfsmounts/repl_data/films/mysteries
</pre>
<p>In this example, the <code>drama</code> tag is purposely used twice and that tag is changed in a later step.</p>
<p>You must have system administrator privileges or be the file owner to run this command.</p>
<p>For more information, refer to <a href="asmfs_util006.htm#BABEIDGI">"acfsutil tag set"</a>.</p>
</li>
<li>
<p>Display tagging information.</p>
<p><a id="sthref1193"></a><a id="sthref1194"></a>Run the <code>acfsutil</code> <code>tag</code> <code>info</code> command to display the tag names for directories or files in Oracle ACFS file systems. Files without tags are not be displayed.</p>
<p>For example, display tagging information for files in the <code>/acfsmounts/repl_data/films</code> directory.</p>
<pre>
$ /sbin/acfsutil tag info -r /acfsmounts/repl_data/films
</pre>
<p>Display tagging information for files with the <code>drama</code> tag in the <code>/acfsmounts/repl_data/films</code> directory.</p>
<pre>
$ /sbin/acfsutil tag info -t drama -r /acfsmounts/repl_data/films
</pre>
<p>You must have system administrator privileges or be the file owner to run this command.</p>
<p>For more information, refer to <a href="asmfs_util006.htm#BABFGHJA">"acfsutil tag info"</a>.</p>
</li>
<li>
<p>Remove and change tag names if necessary.</p>
<p><a id="sthref1195"></a><a id="sthref1196"></a><a id="sthref1197"></a><a id="sthref1198"></a>Run the <code>acfsutil</code> <code>tag</code> <code>unset</code> command to remove tags on directories or files. For example, unset the <code>drama</code> tag on the files in the <code>mysteries</code> subdirectory of the <code>/acfsmounts/repl_data/films</code> directory to apply a different tag to the subdirectory.</p>
<pre>
$ /sbin/acfsutil tag unset -r drama /acfsmounts/repl_data/films/mysteries
</pre>
<p>Add the <code>mystery</code> tag to the files in the <code>mysteries</code> subdirectory of the <code>/acfsmounts/repl_data/films</code> directory.</p>
<pre>
$ /sbin/acfsutil tag set -r mystery /acfsmounts/repl_data/films/mysteries
</pre>
<p>You must have system administrator privileges or be the file owner to run these commands.</p>
<p>For more information, refer to <a href="asmfs_util006.htm#BABIEFDH">"acfsutil tag unset"</a>.</p>
</li>
</ol>
<p>For more information about tagging an Oracle ACFS file system, refer to <a href="asmfilesystem.htm#CBBHAEFA">"Oracle ACFS Tagging"</a>.</p>
</div>
<!-- class="sect2" -->
<a id="BABEJGJG"></a><a id="OSTMG94793"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Replicating Oracle ACFS File Systems</h2>
<p><a id="sthref1199"></a><a id="sthref1200"></a>This section discusses the operations to manage replication on an Oracle ACFS file system on Linux.</p>
<p>The steps in this section assume you are not planning to use Oracle ACFS security or encryption on the file system. You cannot use Oracle ACFS replication with security or encryption.</p>
<p>The disk groups on which volumes are created for the primary and standby file systems must have compatibility attributes for <code>ASM</code> and <code>ADVM</code> set to <code>11.2.0.3</code> . For information about disk group compatibility, refer to <a href="asmdiskgrps.htm#CHDDIGBJ">"Disk Group Compatibility"</a>.</p>
<p>The steps to manage replication are:</p>
<ol>
<li>
<p><a id="sthref1201"></a><a id="sthref1202"></a>Determine the storage capacity necessary for replication on the sites hosting the primary and standby file systems. The primary file system must have a minimum size of 4 GB for each node that is mounting the file system. The standby file system must have a minimum size of 4 GB and should be sized appropriately for the amount of data being replicated and the space necessary for the replication logs sent from the primary file system.</p>
<p>Calculate the replication-related storage requirement for the primary file system, then use the same size requirement for the standby file system. If Oracle ACFS tagging is used to replicate only a subset of the files in the primary file system, then the size requirement for the standby file system is proportional to that subset of the primary file system.</p>
<p>Run the <code>acfsutil</code> <code>info</code> <code>fs</code> command with the <code>-s</code> <code><span class="codeinlineitalic">interval</span></code> option on the node where the primary file system is mounted to display the amount and rate of change to the primary file system for the node. The amount of change includes all user and metadata modifications to the primary file system. This amount approximates the size of replication logs that are generated when recording changes to the file system. Changes are stored in temporary files called replication logs which are kept in a special directory in the primary file system until they can be sent to the standby to be applied. After confirmation is received that the changes contained in a replication log have been successfully applied to the standby file system, the replication logs on the primary file system are deleted.</p>
<p>To approximate the extra storage capacity necessary for the replication logs, determine the following:</p>
<ul>
<li>
<p>The time interval during which the site hosting the primary file system may experience network connectivity problems or slowdowns when accessing the site hosting the standby file system.</p>
</li>
<li>
<p>The time interval during which the site hosting the standby file system may be taken offline for maintenance.</p>
</li>
</ul>
<p>These time intervals are used in calculating the amount and rate of change in storage space. You must account for the time interval when the primary file system cannot send the replication logs over to the standby file system at its usual rate or when standby file systems are inaccessible while undergoing maintenance. The replication logs will accumulate on the site hosting the primary file system and may eventually cause that site to run out of space.</p>
<p>For the following scenario, assume <code>t</code> = 60 minutes is the time interval in your environment that would adequately account for network problems or maintenance on site hosting the standby file system.</p>
<p>Run <code>acfsutil</code> <code>info</code> <code>fs</code> <code>-s</code> <code>900</code> on the primary file system to collect the average rate of change over a 24 hour period with a 15 minute (900 seconds) interval. Note that <code>t/4</code> (60/4) is the value for the sampling interval. Do not exceed a value of <code>t/2</code> for the time interval as you may miss some important peaks.</p>
<pre>
$ /sbin/acfsutil info fs -s 900 /acfsmounts/repl_data
</pre>
<p>With the output, you can determine the average rate of change, the peak rate of change, and how long the peaks last. However, the command displays information only for the node on which the command is run. To collect the total amount of change in the file system the command must be run on every node that is modifying the file system. Note that the maximum number of supported nodes is eight.</p>
<p>The following formula approximates the extra storage capacity needed:</p>
<pre>
Extra storage capacity to hold replication logs = 
    (Number-nodes-on-primary * 1GB) + P
</pre>
<p>where <code>P</code> is the peak amount of change generated across all nodes for time <code>t</code> as reported by the <code>acfsutil</code> <code>info</code> <code>fs</code> <code>&ndash;s</code> output.</p>
<p>In the example, we need to total the changes from four 15-minute intervals to find the total amount of change that could occur in 60 minutes. You may choose to use the single hour that generated the largest amount of change, or you could select the top four 15-minute intervals even if they did not occur together to prepare for the worst-case scenario.</p>
<p>Assume that you have four nodes modifying the primary file system, and that during the measured interval, the peak amount of change reported for the 60 minutes is approximately 20 GB for all nodes. Using the storage capacity formula, 24 GB of excess storage capacity on each site hosting the primary file system is required for storage of the replication logs.</p>
<pre>
Extra storage capacity to hold replication logs = (4 * 1GB per node) + 
 20GB maximum change per hour = 24GB of extra storage capacity
</pre>
<p>Next, check that the network transfer rate is greater than or equal to the rate of change observed during the monitoring period. In the previous example, the peak of 20 GB of changed data per hour is equivalent to a peak rate of change of about 5.5 MB/sec. To keep up with this rate of change, you must ensure that the network can reliably transfer at least this amount of data per second without negatively impacting your existing network workloads.</p>
<p>To estimate your current actual network transfer rate, calculate the elapsed time required to FTP a 1 GB file from the primary file system to the intended standby file system during a period of time when network usage is low. For example, if the 1 GB file transfers in 30 seconds, then your current FTP transfer rate is 33 MB per seconds (1000 MB/30 seconds = 33 MB per second). Because of various delays inherent in the transfers, for planning purposes you should reduce this measured FTP transfer rate by 20%, and then by an additional 5% per node.</p>
<p>In the previous example with 4 nodes, the FTP transfer rate used for planning is:</p>
<pre>
33 MB/sec * (1 &ndash; (0.2) &ndash; (4 * 0.05)) = 33 * (0.6) = ~20MB/sec
</pre>
<p>Because the peak rate of change was only 5.5 MB/second, you can expect the network to be able to handle this additional workload in this example. However, if the network capacity was already close to being fully utilized, you might want to consider increasing network capacity before implementing replication for this file system and workload.</p>
<p>In addition, insure you have sufficient network capacity to allow replication to catch up after times when network problems prevent a primary file system from sending replication logs to the standby file system.</p>
<p>For more information, refer to <a href="asmfs_util010.htm#BABDDAAJ">"acfsutil info fs"</a>.</p>
</li>
<li>
<p>Set up tags, user names, and service names.</p>
<p><a id="sthref1203"></a><a id="sthref1204"></a>When starting replication on an Oracle ACFS file system, first perform the following steps:</p>
<ul>
<li>
<p>Determine the user name and password that the sites hosting the primary and standby file systems use to connect to the remote Oracle ASM instance as the Oracle ASM and DBA administrator. All nodes that have the file system mounted must support this user name and password. The user must have <code>SYSASM</code> and <code>SYSDBA</code> privileges. For example:</p>
<pre>
SQL&gt; CREATE USER primary_admin IDENTIFIED BY primary_passwd;
SQL&gt; GRANT sysasm,sysdba TO primary_admin;
</pre>
<p><a id="sthref1205"></a>Oracle wallets can also be used to manage security credentials.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ASOAG160" href="../../network.112/e40393/asowalet.htm#ASOAG160"><span class="italic">Oracle Database Advanced Security Administrator's Guide</span></a> for information about Oracle wallets</p>
</li>
<li>
<p><a class="olink ADLOB46075" href="../../appdev.112/e18294/adlob_hierarch.htm#ADLOB46075"><span class="italic">Oracle Database SecureFiles and Large Objects Developer's Guide</span></a> for information about wallet management</p>
</li>
<li>
<p><a class="olink NETRF182" href="../../network.112/e10835/sqlnet.htm#NETRF182"><span class="italic">Oracle Database Net Services Reference</span></a> for information about wallet parameters in the <code>SQLNET.ORA</code> file</p>
</li>
</ul>
</div>
</li>
<li>
<p>Determine a unique service name for the replicated file system.</p>
<p><a id="sthref1206"></a>When both the primary and standby file systems are located in different clusters for disaster tolerance, then the service names for the primary and standby file systems can be the same. However, if the both file systems are mounted on the same node, such as a test configuration, then unique service names must be used for the primary and standby file systems. Using unique service names for the primary and standby file systems requires the use of the <code>-c</code> option during replication initialization. Service names are limited to a maximum of 128 bytes.</p>
<div class="infobox-note">
<p class="notep1">Notes:</p>
<ul>
<li>
<p>You must specify a service name other than +ASM because that service name is already in use by the Oracle ASM instance.</p>
</li>
<li>
<p>You must specify a unique service name for each file system that you want to replicate when there are multiple replicated file systems on a node or cluster.</p>
</li>
</ul>
</div>
<p>Using this service name, create a net service alias on the sites hosting the primary and standby file system that connects to the remote site. This alias along with the user name and password are used as the connection string in the replication initialization commands.</p>
<p>For example, the following are examples of connect descriptors with net service aliases for the sites hosting the primary and standby file systems.</p>
<pre>
primary_repl_site=(DESCRIPTION=
  (ADDRESS=(PROTOCOL=tcp)(HOST=primary1.example.com)(PORT=1521))
  (ADDRESS=(PROTOCOL=tcp)(HOST=primary2.example.com)(PORT=1521))
  (CONNECT_DATA=(SERVICE_NAME=primary_service)))

standby_repl_site=(DESCRIPTION=
  (ADDRESS=(PROTOCOL=tcp)(HOST=standby1.example.com)(PORT=1521))
  (CONNECT_DATA=(SERVICE_NAME=standby_service)))
</pre>
<p>If you want to perform replication using a single client access name (SCAN) VIP, you must update the <code>REMOTE_LISTENER</code> initialization parameter in the Oracle ASM instance before initializing replication. You can update the parameter in the initialization file or with the <code>ALTER</code> <code>SYSTEM</code> SQL statement.</p>
<p>For example:</p>
<pre>
SQL&gt; ALTER SYSTEM SET remote_listener='SCAN_NAME:1521' sid='*' scope=both;
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink NETAG002" href="../../network.112/e41945/concepts.htm#NETAG002"><span class="italic">Oracle Database Net Services Administrator's Guide</span></a> for information about connect descriptors</div>
</li>
<li>
<p>Optionally set tags on directories and files to replicate only selected files in an Oracle ACFS file system. You can also add tags to files after replication has already started. For information about the steps to tag files, refer to <a href="#BABEDCJF">"Tagging Oracle ACFS File Systems"</a>.</p>
</li>
</ul>
</li>
<li>
<p>Configure the site hosting the standby file system.</p>
<p><a id="sthref1207"></a>Before replicating an Oracle ACFS file system, configure the site hosting the standby file system by performing the following procedures.</p>
<ul>
<li>
<p>Create a new file system of adequate size to hold the replicated files and associated replication logs from the primary file system. For example: <code>/standby/repl_data</code></p>
</li>
<li>
<p>Mount the file system on one node only.</p>
</li>
<li>
<p>Run the <code>acfsutil</code> <code>repl</code> <code>init</code> <code>standby</code> command. If this command is interrupted for any reason, the user must re-create the file system, mount it on one node only, and rerun the command. This command requires the following configuration information:</p>
<ul>
<li>
<p>The connect string to be used to connect to the site hosting the primary file system. For example:</p>
<p><code>primary_admin/primary_passwd@primary_repl_site</code></p>
<p>The user <code>primary_admin</code> must have <code>SYSASM</code> and <code>SYSDBA</code> privileges.</p>
</li>
<li>
<p>If the standby file system is using a different service name than the primary file system, then the use <code>-c</code> option. This option specifies the service name for the standby file system. For example:</p>
<p><code>standby_repl_service</code></p>
</li>
<li>
<p>The mount point of the standby file system. For example:</p>
<p><code>/standby/repl_data</code></p>
</li>
</ul>
</li>
</ul>
<p>For example, run the following <code>acfsutil</code> <code>repl</code> <code>init</code> <code>standby</code> command on the site hosting the standby file system.</p>
<pre>
$ /sbin/acfsutil repl init standby 
    -p primary_admin/primary_passwd@primary_repl_site
    -c standby_repl_service /standby/repl_data
</pre>
<p>The <code>acfsutil</code> <code>repl</code> <code>init</code> <code>standby</code> command requires root or system administrator privileges to run.</p>
<p>For more information, refer to <a href="asmfs_util007.htm#BABCEDEH">"acfsutil repl init"</a>.</p>
</li>
<li>
<p>Configure the site hosting the primary file system.</p>
<p><a id="sthref1208"></a>After the standby file system has been set up, configure the site hosting the primary file system and start replication by performing the following procedures.</p>
<p>Run the <code>acfsutil</code> <code>repl</code> <code>init</code> <code>primary</code> command. This command requires the following configuration information:</p>
<ul>
<li>
<p>The connect string to be used to connect to the site hosting the standby file system. For example:</p>
<p><code>standby_admin/standby_passwd@standby_repl_site</code></p>
<p>The user <code>standby_admin</code> must have <code>SYSASM</code> and <code>SYSDBA</code> privileges.</p>
</li>
<li>
<p>The mount point of the primary file system. For example: <code>/acfsmounts/repl_data</code></p>
</li>
<li>
<p>If the primary file system is using a different service name than the standby file system, then use the <code>-c</code> option. This option specifies the service name on the site hosting the primary file system. For example:</p>
<p><code>primary_repl_service</code></p>
</li>
<li>
<p>If the mount point is different on the site hosting the standby file system than it is on the site hosting the primary file system, specify the mount point on the standby file system with the <code>-m</code> <code><span class="codeinlineitalic">standby_mount_point</span></code> option. For example:</p>
<p><code>-m /standby/repl_data</code></p>
</li>
</ul>
<p>For example, run the following <code>acfsutil</code> <code>repl</code> <code>init</code> <code>primary</code> command on the site hosting the primary file system.</p>
<pre>
$ /sbin/acfsutil repl init primary 
     -s standby_admin/standby_passwd@standby_repl_site
     -m /standby/repl_data -c primary_repl_service 
     /acfsmounts/repl_data
</pre>
<p>The <code>acfsutil</code> <code>repl</code> <code>init</code> <code>primary</code> command requires root or system administrator privileges to run.</p>
<p>For more information, refer to <a href="asmfs_util007.htm#BABCEDEH">"acfsutil repl init"</a>.</p>
</li>
<li>
<p>Monitor information about replication on the file system.</p>
<p><a id="sthref1209"></a>The <code>acfsutil</code> <code>repl</code> <code>info</code> command displays information about the state of the replication processing on the primary or standby file system.</p>
<p>For example, run the following <code>acfsutil</code> <code>repl</code> <code>info</code> command on the site hosting the primary file system to display configuration information.</p>
<pre>
$ /sbin/acfsutil repl info -c -v /acfsmounts/repl_data
</pre>
<p>You must have system administrator or Oracle ASM administrator privileges to run this command.</p>
<p>For information, refer to <a href="asmfs_util007.htm#BABJCCGH">"acfsutil repl info"</a>.</p>
</li>
<li>
<p>Manage replication background processes.</p>
<p><a id="sthref1210"></a>Run the <code>acfsutil</code> <code>repl</code> <code>bg</code> command to start, stop, or retrieve information about replication background processes.</p>
<p>For example, the following example displays information about the replication processes for the <code>/acfsmounts/repl_data</code> file system.</p>
<pre>
$ /sbin/acfsutil repl bg info /acfsmounts/repl_data
</pre>
<p>You must have system administrator or Oracle ASM administrator privileges to run the <code>acfsutil</code> <code>repl</code> <code>bg</code> <code>info</code> command.</p>
<p>For more information, refer to <a href="asmfs_util007.htm#BABGGAJJ">"acfsutil repl bg"</a>.</p>
</li>
<li>
<p>Pause replication momentarily only if necessary.</p>
<p><a id="sthref1211"></a>Run the <code>acfsutil</code> <code>repl</code> <code>pause</code> to momentarily stop replication. You should run the <code>acfsutil</code> <code>repl</code> <code>resume</code> command soon as possible to resume replication.</p>
<p>For example, the following command pauses replication on the <code>/acfsmounts/repl_data</code> file system.</p>
<pre>
$ /sbin/acfsutil repl pause /acfsmounts/repl_data
</pre>
<p>The following command resumes replication on the <code>/acfsmounts/repl_data</code> file system.</p>
<pre>
$ /sbin/acfsutil repl resume /acfsmounts/repl_data
</pre>
<p>You must have system administrator or Oracle ASM administrator privileges to run these commands.</p>
<p>For more information, refer to <a href="asmfs_util007.htm#BABJCJDE">"acfsutil repl pause"</a> and <a href="asmfs_util007.htm#BABIFBAD">"acfsutil repl resume"</a>.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
On an Oracle ACFS file system <code>df</code> reports space usage by internal metadata plus user files and directories. <code>du</code> only reports the space usage of user files and directories. Depending on the size of the volume and number of the nodes, internal metadata is allocated in varying sizes. Additionally, with replication enabled an internal replication log is allocated for each node that is used to record changes to the file system before exposing the replication log to user space daemons to transport to the standby.</div>
<p>For more information about replicating an Oracle ACFS file system, refer to <a href="asmfilesystem.htm#CBBFJCED">"Oracle ACFS Replication"</a>.</p>
</div>
<!-- class="sect2" -->
<a id="BABCJBBI"></a><a id="OSTMG94794"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Deregistering, Dismounting, and Disabling Volumes and Oracle ACFS File Systems</h2>
<p><a id="sthref1212"></a>This section discusses the operations to deregister or dismount a file system and disable a volume. This section contains these topics:</p>
<ul>
<li>
<p><a href="#BABFAIDF">Deregistering an Oracle ACFS File System</a></p>
</li>
<li>
<p><a href="#BABEHJAF">Dismounting an Oracle ACFS File System</a></p>
</li>
<li>
<p><a href="#BABCFJDG">Disabling a Volume</a></p>
</li>
</ul>
<a id="BABFAIDF"></a><a id="OSTMG94795"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h3 class="sect3">Deregistering an Oracle ACFS File System</h3>
<p><a id="sthref1213"></a><a id="sthref1214"></a>You can deregister an Oracle ACFS file system if you do not want the file system to be automatically mounted.</p>
<p>For example:</p>
<pre>
$ /sbin/acfsutil registry -d /u01/app/acfsmounts/myacfs
</pre>
<p>If you deregister a file system, then you must explicitly mount the file system after Oracle Clusterware or the system is restarted.</p>
<p>For more information about the registry, see <a href="asmfilesystem.htm#CACDGDEF">"About the Oracle ACFS Mount Registry"</a>. For information about <code>acfsutil</code> <code>registry</code>, see <a href="asmfs_util010.htm#CACGHBHI">"acfsutil registry"</a>.</p>
</div>
<!-- class="sect3" -->
<a id="BABEHJAF"></a><a id="OSTMG94796"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h3 class="sect3">Dismounting an Oracle ACFS File System</h3>
<p><a id="sthref1215"></a><a id="sthref1216"></a>You can dismount a file system without deregistering the file system or disabling the volume on which the file system is mounted.</p>
<p>For example, you can dismount a file system and run <code>fsck</code> to check the file system.</p>
<pre>
# /bin/umount /u01/app/acfsmounts/myacfs

# /sbin/fsck -a -v -y -t acfs /dev/asm/volume1-123
</pre>
<p>After you dismount a file system, you must explicitly mount the file system.</p>
<p>Use <code>umount</code> on Linux systems or <code>acfsdismount</code> on Windows systems. For information about the commands to dismount a file system, see <a href="asmfs_util002.htm#CACJFEFD">"umount"</a> or <a href="asmfs_util005.htm#CACGAHJE">"acfsdismount"</a>.</p>
<p>Use <code>fsck</code> on Linux systems or <code>acfschkdsk</code> on Windows systems to check a file system. For information about the commands to check a file system, see <a href="asmfs_util002.htm#CACCHEDH">"fsck"</a> or <a href="asmfs_util005.htm#CACDCIHC">"acfschkdsk"</a>.</p>
</div>
<!-- class="sect3" -->
<a id="BABCFJDG"></a><a id="OSTMG94797"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h3 class="sect3">Disabling a Volume</h3>
<p><a id="sthref1217"></a><a id="sthref1218"></a>To disable a volume, you must first dismount the file system on which the volume is mounted.</p>
<p>For example:</p>
<pre>
# /bin/umount /u01/app/acfsmounts/myacfs
</pre>
<p>After a file system is dismounted, you can disable the volume and remove the volume device file.</p>
<p>For example:</p>
<pre>
ASMCMD&gt; voldisable -G data volume1
</pre>
<p>Dismounting the file system and disabling a volume does not destroy data in the file system. You can enable the volume and mount the file system to access the existing data. For information about <code>voldisable</code> and <code>volenable</code>, see <a href="asm_util007.htm#CIHFCEII">"voldisable"</a> and <a href="asm_util007.htm#CIHECJFA">"volenable"</a>.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BABGBDFH"></a><a id="OSTMG94798"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Removing an Oracle ACFS File System and a Volume</h2>
<p><a id="sthref1219"></a>To permanently remove a volume and Oracle ACFS file system, perform the following steps. These steps destroy the data in the file system.</p>
<ol>
<li>
<p>Deregister the file system with <code>acfsutil</code> <code>registry</code> <code>-d</code>.</p>
<p>For example:</p>
<pre>
$ /sbin/acfsutil registry -d /oracle/acfsmounts/acfs1
acfsutil registry: successfully removed ACFS mount point
   /oracle/acfsmounts/acfs1 from Oracle Registry
</pre>
<p>For information about running <code>acfsutil</code> <code>registry</code>, see <a href="asmfs_util010.htm#CACGHBHI">"acfsutil registry"</a>.</p>
</li>
<li>
<p>Dismount the file system.</p>
<p>For example:</p>
<pre>
# /bin/umount /oracle/acfsmounts/acfs1
</pre>
<p>You must dismount the file system on all nodes of a cluster.</p>
<p>Use <code>umount</code> on Linux systems or <code>acfsdismount</code> on Windows systems. For information about running <code>umount</code> or <code>acfsdismount</code>, see <a href="asmfs_util002.htm#CACJFEFD">"umount"</a> or <a href="asmfs_util005.htm#CACGAHJE">"acfsdismount"</a>.</p>
</li>
<li>
<p>Remove the file system with <code>acfsutil</code> <code>rmfs</code>.</p>
<p>If you were not planning to remove the volume in a later step, this step is necessary to remove the file system. Otherwise, the file system is removed when the volume is deleted.</p>
<p>For example:</p>
<pre>
$ /sbin/acfsutil rmfs /dev/asm/volume1-123
</pre>
<p>For information about running <code>acfsutil</code> <code>rmfs</code>, see <a href="asmfs_util010.htm#CACDJGCE">"acfsutil rmfs"</a>.</p>
</li>
<li>
<p>Optionally you can disable the volume with the ASMCMD <code>voldisable</code> command.</p>
<p>For example:</p>
<pre>
ASMCMD&gt; voldisable -G data volume1
</pre>
<p>For information about running <code>voldisable</code>, see <a href="asm_util007.htm#CIHFCEII">"voldisable"</a>.</p>
</li>
<li>
<p>Delete the volume with the ASMCMD <code>voldelete</code> command.</p>
<p>For example:</p>
<pre>
ASMCMD&gt; voldelete -G data volume1
</pre>
<p>For information about running <code>voldelete</code>, see <a href="asm_util007.htm#CIHDHHJB">"voldelete"</a>.</p>
</li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1536">
<tr>
<td class="cellalignment1543">
<table class="cellalignment1541">
<tr>
<td class="cellalignment1540"><a href="asmfs_util.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1540"><a href="asmfs_util002.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2007, 2012,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1545">
<table class="cellalignment1539">
<tr>
<td class="cellalignment1540"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1540"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1540"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1540"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1540"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1540"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
