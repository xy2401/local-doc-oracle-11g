<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Configuring Rule Sets</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1088" />
<meta name="dcterms.created" content="2016-11-14T16:25:10Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Vault Administrator's Guide" />
<meta name="dcterms.identifier" content="E23090-13" />
<meta name="dcterms.isVersionOf" content="DVADM" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2006, 2016,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="cfrealms.htm" title="Previous" type="text/html" />
<link rel="Next" href="cfcmdaut.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e23090.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">12/31</span> <!-- End Header -->
<div id="DVADM006" class="chapter"><a id="BABIFBBC"></a>
<h1 class="chapter"><span class="secnum">5</span> Configuring Rule Sets</h1>
<p>This chapter contains:</p>
<ul>
<li>
<p><a href="#CHDJJEFI">What Are Rule Sets?</a></p>
</li>
<li>
<p><a href="#CHDGIFGJ">Default Rule Sets</a></p>
</li>
<li>
<p><a href="#CHDDBAJI">Creating a Rule Set</a></p>
</li>
<li>
<p><a href="#CHDGJEBG">Configuring or Editing a Rule Set</a></p>
</li>
<li>
<p><a href="#CHDGIFCE">Creating a Rule to Add to a Rule Set</a></p>
</li>
<li>
<p><a href="#CHDBGBIC">Deleting a Rule Set</a></p>
</li>
<li>
<p><a href="#CHDHEEHA">How Rule Sets Work</a></p>
</li>
<li>
<p><a href="#CHDJCAEH">Tutorial: Creating an Email Alert for Security Violations</a></p>
</li>
<li>
<p><a href="#BABBDGJC">Tutorial: Configuring Two-Person Integrity, or Dual Key Security</a></p>
</li>
<li>
<p><a href="#CHDDJJCH">Guidelines for Designing Rule Sets</a></p>
</li>
<li>
<p><a href="#CHDFFGIG">How Rule Sets Affect Performance</a></p>
</li>
<li>
<p><a href="#BABHJBHC">Related Reports and Data Dictionary Views</a></p>
</li>
</ul>
<a id="CHDJJEFI"></a>
<div id="DVADM70170" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">What Are Rule Sets?</h2>
<p><a id="sthref159"></a>A <span class="bold">rule set</span> is a collection of one or more rules that you can associate with a realm authorization, factor assignment, command rule, or secure application role. The rule set evaluates to true or false based on the evaluation of each rule it contains and the evaluation type (<span class="italic">All True</span> or <span class="italic">Any True</span>). A rule within a rule set is a PL/SQL expression that evaluates to true or false. You can create a rule and add the rule to multiple rule sets.</p>
<p>You can use rule sets to accomplish the following activities:</p>
<ul>
<li>
<p>As a further restriction to realm authorization, to define the conditions under which realm authorization is active</p>
</li>
<li>
<p>To define when to allow a command rule</p>
</li>
<li>
<p>To enable a secure application role</p>
</li>
<li>
<p>To define when to assign the identity of a factor</p>
</li>
</ul>
<p>When you create a rule set, Oracle Database Vault makes it available for selection when you configure the authorization for a realm, command rule, factor, or secure application role.</p>
<p>You can run reports on the rule sets that you create in Oracle Database Vault. See <a href="#BABHJBHC">"Related Reports and Data Dictionary Views"</a> for more information.</p>
<p>This chapter explains how to configure rule sets by using Oracle Database Vault Administrator. To configure rule sets by using the PL/SQL interfaces and packages provided by Oracle Database Vault, refer to the following chapters:</p>
<ul>
<li>
<p><a href="apis_dbms_macadm.htm#CHDHHDGI">Chapter 12, "Using the DBMS_MACADM Package"</a></p>
</li>
<li>
<p><a href="plsql_interfaces.htm#CHDEAEHD">Chapter 15, "Using the Oracle Database Vault PL/SQL&nbsp;Interfaces"</a></p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="CHDGIFGJ"></a>
<div id="DVADM70171" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Default Rule Sets</h2>
<p>Oracle Database Vault <a id="sthref160"></a>provides a set of default rules sets that you can customize for your needs. The default rule sets are as follows:</p>
<ul>
<li>
<p><span class="bold">Allow Sessions:</span> <a id="sthref161"></a>Controls the ability to create a session in the database. This rule set enables you to add rules to control database logins using the CONNECT command rule. The CONNECT command rule is useful to control or limit <code dir="ltr">SYSDBA</code> access to programs that require its use. This rule set is not populated.</p>
</li>
<li>
<p><span class="bold">Allow System Parameters:</span> <a id="sthref162"></a>Controls the ability to set system initialization parameters. For Oracle Database 11<span class="italic">g</span> Release 2 (11.2), the Allow Fine Grained Control of System Parameters rule set replaces this rule set, but it is still supported for backward compatibility. The Allow System Parameters rule set is not associated with any commands, but its rules are still available and can be used with any custom rule set. Oracle recommends that you use the Allow Fine Grained Control of System Parameters rule set.</p>
</li>
<li>
<p><span class="bold">Allow Fine Grained Control of System Parameters:</span> Provides a very flexible, fine-grained control over initialization parameters that manage system security, dump or destination location, backup and restore settings, optimizer settings, PL/SQL debugging, and security parameters. It affects the following initialization parameters, based on the associated rules of this rule set:</p>
<ul>
<li>
<p><span class="bold">Are System Security Parameters Allowed rule:</span> Cannot set <code dir="ltr">O7_DICTIONARY_ACCESSIBILITY</code></p>
</li>
<li>
<p><span class="bold">Are Dump or Dest Parameters Allowed rule:</span> Cannot set the following parameters:</p>
<div class="inftblsimple">
<table class="cellalignment1645" title="Are Dump or Dest Parameters Allowed" summary="List of values, left to right, top to bottom" dir="ltr">
<tbody>
<tr class="cellalignment1639">
<td class="cellalignment1646">&nbsp;</td>
<td class="cellalignment1646"><code dir="ltr">BACKGROUND_DUMP_DEST</code></td>
<td class="cellalignment1646"><code dir="ltr">LOG_ARCHIVE_DEST_STATE_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code></td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646">&nbsp;</td>
<td class="cellalignment1646"><code dir="ltr">CORE_DUMP_DEST</code></td>
<td class="cellalignment1646"><code dir="ltr">LOG_ARCHIVE_DUPLEX_DEST</code></td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646">&nbsp;</td>
<td class="cellalignment1646"><code dir="ltr">DB_CREATE_ONLINE_LOG_DEST</code></td>
<td class="cellalignment1646"><code dir="ltr">LOG_ARCHIVE_FORMAT</code></td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646">&nbsp;</td>
<td class="cellalignment1646"><code dir="ltr">DB_RECOVERY_FILE_DEST</code></td>
<td class="cellalignment1646"><code dir="ltr">LOG_ARCHIVE_LOCAL_FIRST</code></td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646">&nbsp;</td>
<td class="cellalignment1646"><code dir="ltr">DB_RECOVERY_FILE_DEST_SIZE</code></td>
<td class="cellalignment1646"><code dir="ltr">LOG_ARCHIVE_MAX_PROCESSES</code></td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646">&nbsp;</td>
<td class="cellalignment1646"><code dir="ltr">DIAGNOSTIC_DEST</code></td>
<td class="cellalignment1646"><code dir="ltr">LOG_ARCHIVE_MIN_SUCCEED_DEST</code></td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646">&nbsp;</td>
<td class="cellalignment1646"><code dir="ltr">DUMP_DATAFILE</code></td>
<td class="cellalignment1646"><code dir="ltr">LOG_ARCHIVE_TRACE</code></td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646">&nbsp;</td>
<td class="cellalignment1646"><code dir="ltr">LOG_ARCHIVE_CONFIG</code></td>
<td class="cellalignment1646"><code dir="ltr">MAX_DUMP_FILE_SIZE</code></td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646">&nbsp;</td>
<td class="cellalignment1646"><code dir="ltr">LOG_ARCHIVE_DEST</code></td>
<td class="cellalignment1646"><code dir="ltr">STANDBY_ARCHIVE_DEST</code></td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646">&nbsp;</td>
<td class="cellalignment1646"><code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code></td>
<td class="cellalignment1646"><code dir="ltr">USER_DUMP_DEST</code></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblsimple" --></li>
<li>
<p><span class="bold">Are Backup Restore Parameters Allowed rule:</span> Cannot set <code dir="ltr">RECYCLEBIN</code> (but does not prevent disabling the recycle bin)</p>
</li>
<li>
<p><span class="bold">Are Database File Parameters Allowed rule:</span> Can set <code dir="ltr">CONTROL_FILE_RECORD_KEEP_TIME</code>, <code dir="ltr">CONTROL_FILES</code></p>
</li>
<li>
<p><span class="bold">Are Optimizer Parameters Allowed rule:</span> Cannot set <code dir="ltr">OPTIMIZER_SECURE_VIEW_MERGING</code></p>
</li>
<li>
<p><span class="bold">Are PL-SQL Parameters Allowed rule:</span> Cannot set <code dir="ltr">UTL_FILE_DIR</code>, <code dir="ltr">PLSQL_DEBUG</code></p>
</li>
<li>
<p><span class="bold">Are Security Parameters Allowed rule:</span> Cannot set the following:</p>
<div class="inftblsimple">
<table class="cellalignment1645" title="Are Security Parameters Allowed" summary="Are Security Parameters Allowed, left to right, top to bottom" dir="ltr">
<tbody>
<tr class="cellalignment1639">
<td class="cellalignment1646">&nbsp;</td>
<td class="cellalignment1646"><code dir="ltr">AUDIT_SYS_OPERATIONS = FALSE</code></td>
<td class="cellalignment1646"><code dir="ltr">OS_ROLES</code></td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646">&nbsp;</td>
<td class="cellalignment1646"><code dir="ltr">AUDIT_TRAIL = NONE</code> or <code dir="ltr">FALSE</code></td>
<td class="cellalignment1646"><code dir="ltr">REMOTE_OS_ROLES</code></td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646">&nbsp;</td>
<td class="cellalignment1646"><code dir="ltr">AUDIT_SYSLOG_LEVEL</code></td>
<td class="cellalignment1646"><code dir="ltr">SQL92_SECURITY</code></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblsimple" --></li>
</ul>
<p>See <a class="olink REFRN001" href="../../server.112/e40402/initparams_part.htm#REFRN001"><span class="italic">Oracle Database Reference</span></a> for detailed information about initialization parameters.</p>
</li>
<li>
<p><span class="bold">Can Grant VPD Administration:</span> <a id="sthref163"></a>Controls the ability to grant the <code dir="ltr">GRANT EXECUTE</code> or <code dir="ltr">REVOKE EXECUTE</code> privileges on the Oracle Virtual Private Database <code dir="ltr">DBMS_RLS</code> package, with the <code dir="ltr">GRANT</code> and <code dir="ltr">REVOKE</code> statements.</p>
</li>
<li>
<p><span class="bold">Allow Oracle Data Pump Operation:</span> Contains rules that describe each<a id="sthref164"></a> user authorization that was created by the <code dir="ltr">DBMS_MACADM.AUTHORIZE_DATAPUMP_USER</code> procedure. The rule includes the user login account and the level of access the user is allowed: the entire database, a schema within the database, or a table within this schema. When a user attempts to perform an Oracle Data Pump export or import operation, Oracle Database Vault checks the authorizations defined in this rule set. If the user's authorizations are not defined here, then he or she is not permitted to perform the export or import operation.</p>
<p>See <a href="dba.htm#CHDDECIH">"Using Oracle Data Pump in an Oracle Database Vault Environment"</a> for more information.</p>
</li>
<li>
<p><span class="bold">Allow Scheduler Job:</span> Contains rules that describe each<a id="sthref165"></a> user authorization that was created by the <code dir="ltr">DBMS_MACADM.AUTHORIZE_SCHEDULER_USER</code> procedure. If you do not define the user's authorizations here, then he or she still can create a job. But if the user runs a job under another schema, the job will fail when this job accesses Oracle Database Vault-protected objects. The rule includes the user login account and the level of access the user is allowed: the entire database or a schema within the database. When a user attempts to schedule a database job, Oracle Database Vault checks the authorizations defined in this rule set. If the user's authorizations are not defined here, then he or she is not permitted to create the job.</p>
<p>See <a href="dba.htm#CHDICCJG">"Scheduling Database Jobs in an Oracle Database Vault Environment"</a> for more information.</p>
</li>
<li>
<p><span class="bold">Can Maintain Accounts/Profiles:</span> <a id="sthref166"></a>Controls the roles that manage user accounts and profiles, through the <code dir="ltr">CREATE USER</code>, <code dir="ltr">DROP USER</code>, <code dir="ltr">CREATE PROFILE</code>, <code dir="ltr">ALTER PROFILE</code>, or <code dir="ltr">DROP PROFILE</code> statements.</p>
</li>
<li>
<p><span class="bold">Can Maintain Own Account:</span> <a id="sthref167"></a>Allows the accounts with the <code dir="ltr">DV_ACCTMGR</code> role to manage user accounts and profiles with the <code dir="ltr">ALTER USER</code> statement. Also allows individual accounts to change their own password using the <code dir="ltr">ALTER USER</code> statement. See <a href="db_objects.htm#BABDJFCI">"DV_ACCTMGR Database Vault Account Manager Role"</a> for more information about the <code dir="ltr">DV_ACCTMGR</code> role.</p>
</li>
<li>
<p><span class="bold">Disabled:</span> <a id="sthref168"></a><a id="sthref169"></a>Convenience rule set to quickly disable security configurations like realms, command rules, factors, and secure application roles.</p>
</li>
<li>
<p><span class="bold">Enabled:</span> <a id="sthref170"></a><a id="sthref171"></a>Convenience rule set to quickly enable system features.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="CHDDBAJI"></a>
<div id="DVADM70172" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Creating a Rule Set</h2>
<p><a id="sthref172"></a>In general, to create a rule set, you first create the rule set itself, and then you edit the rule set to associate it with one or more rules. You can associate a new rule with the rule set, add existing rules to the rule set, or delete a rule association from the rule set.</p>
<p>See also the following sections:</p>
<ul>
<li>
<p><a href="#CHDDJJCH">"Guidelines for Designing Rule Sets"</a> for advice on designing rule sets</p>
</li>
<li>
<p><a href="plsql_interfaces.htm#CHDECFAD">"Oracle Database Vault PL/SQL Rule Functions"</a> for a set of functions that you can use in rule expressions</p>
</li>
<li>
<p><a href="reports.htm#BABGBBFH">"Rule Set Configuration Issues Report"</a> to check the configuration of the rule sets for your database</p>
</li>
</ul>
<p>To create a rule set:</p>
<ol>
<li>
<p>Log in to Oracle Database Vault Administrator as a user who has been granted the <code dir="ltr">DV_OWNER</code> or <code dir="ltr">DV_ADMIN</code> role.</p>
<p><a href="getting_started.htm#BABJHBBF">"Starting Oracle Database Vault"</a> explains how to log in.</p>
</li>
<li>
<p>In the Administration page, under Database Vault Feature Administration, click <span class="bold">Rule Sets</span>.</p>
</li>
<li>
<p>In the Rule Sets page, click <span class="bold">Create</span>.</p>
</li>
<li>
<p>In the Create Rule Set page, enter the following settings, and then click <span class="bold">OK</span>:</p>
<ul>
<li>
<p><a href="#CHDEAIAD">General</a></p>
</li>
<li>
<p><a href="#CHDEIGIA">Audit Options</a></p>
</li>
<li>
<p><a href="#CHDJJBBA">Error Handling Options</a></p>
</li>
</ul>
</li>
</ol>
<p class="subhead2"><a id="CHDEAIAD"></a><a id="DVADM70173"></a>General</p>
<p>Enter the following settings:</p>
<ul>
<li>
<p><span class="bold">Name:</span> <a id="sthref173"></a>Enter <a id="sthref174"></a><a id="sthref175"></a>a name for the rule set. It can contain up to 90 characters in mixed-case. Spaces are allowed. This attribute is mandatory.</p>
<p>Oracle suggests that you start the name with a verb and complete it with the realm or command rule name to which the rule set is attached. For example:</p>
<pre dir="ltr">
Limit SQL*Plus access
</pre></li>
<li>
<p><span class="bold">Description:</span> Enter a description of the functionality for the rule set. It can have up to 1024 characters in mixed-case. This attribute is optional.</p>
<p>You may want to document the business requirement of the rule set. For example:</p>
<pre dir="ltr">
Rule to limit access to SQL*Plus
</pre></li>
<li>
<p><span class="bold">Status:</span> Select either <span class="bold">Enabled</span> or <span class="bold">Disabled</span> to enable or disable the rule set during run time. Rule sets are enabled by default. This attribute is mandatory.</p>
</li>
<li>
<p><span class="bold">Evaluation Options:</span> <a id="sthref176"></a>If you plan to assign multiple rules to a rule set, select one of the following settings:</p>
<ul>
<li>
<p><span class="bold">All True:</span> Default. All rules in the rule set must evaluate to true for the rule set itself to evaluate to true.</p>
</li>
<li>
<p><span class="bold">Any True:</span> At least one rule in the rule set must evaluate to true for the rule set itself to evaluate to true.</p>
</li>
</ul>
<p>If you want to determine how often a rule set is evaluated when it is accessed by a command rule, then you can use the <code dir="ltr">is_static</code> parameter of the <code dir="ltr">DBMS_MACADM.CREATE_RULE_SET</code> procedure. See <a href="apis_dbms_macadm.htm#BCFGGGJC">"CREATE_RULE_SET Procedure"</a> for more information.</p>
</li>
</ul>
<p class="subhead2"><a id="CHDEIGIA"></a><a id="DVADM70174"></a>Audit Options</p>
<p>Select<a id="sthref177"></a><a id="sthref178"></a> from the following options to generate an audit record for the rule set. Oracle Database Vault writes the audit trail to the <code dir="ltr">DVSYS.AUDIT_TRAIL$</code> system file, described in <a href="audplcy.htm#BGBFCEGE">Appendix A, "Auditing Oracle Database Vault."</a></p>
<p>This attribute is mandatory. The settings are:</p>
<ul>
<li>
<p><span class="bold">Audit Disabled:</span> Does not create an audit record under any circumstances.</p>
</li>
<li>
<p><span class="bold">Audit On Failure:</span> Default. Creates an audit record when the rule set evaluates to false or one of the associated rules contains an invalid PL/SQL expression.</p>
</li>
<li>
<p><span class="bold">Audit On Success or Failure:</span> Creates an audit record whenever a rule set is evaluated.</p>
</li>
</ul>
<p>For additional audit options, see <a href="apis_dbms_macadm.htm#BCFGGGJC">"CREATE_RULE_SET Procedure"</a>.</p>
<p>The Oracle Database Vault audit trail, written to the <code dir="ltr">DVSYS.AUDIT_TRAIL$</code> system table, contains the fields <code dir="ltr">RULE_SET_NAME</code> and <code dir="ltr">RULE_SET_ID</code>. These fields are populated when a rule set is associated with a realm authorization and a command authorization, and the rule set is configured to audit under some circumstances. See <a href="audplcy.htm#BGBFCEGE">Appendix A, "Auditing Oracle Database Vault,"</a> for more information.</p>
<p class="subhead2"><a id="CHDJJBBA"></a><a id="DVADM70175"></a>Error Handling Options</p>
<p><a id="sthref179"></a><a id="sthref180"></a>Enter the following settings to control the messaging to the database session when the rule set evaluates to false or one of the associated rules contains an invalid PL/SQL expression:</p>
<ul>
<li>
<p><span class="bold">Fail Options:</span> Select either <span class="bold">Show Error Message</span> (the default) or <span class="bold">Do Not Show Error Message</span>.</p>
<p><a id="sthref181"></a><a id="sthref182"></a>An advantage of selecting <span class="bold">Do Not Show Error Message</span> and then enabling auditing is that you can track the activities of a potential intruder. The audit report reveals the activities of the intruder, yet the intruder is unaware that you are doing this because he or she does not see any error messages.</p>
</li>
<li>
<p><span class="bold">Fail Code:</span> <a id="sthref183"></a>Enter a number in the ranges of -20000 to -20999 or 20000 to 20999. The error code is displayed with the <span class="bold">Fail Message</span> (created next) when the rule set evaluates to false or one of the associated rules contains an invalid PL/SQL expression. If you omit this setting, then Oracle Database Vault displays the following error code:</p>
<pre dir="ltr">
<a id="sthref184"></a>ORA-01031: Insufficient privileges
</pre></li>
<li>
<p><span class="bold">Fail Message:</span> <a id="sthref185"></a>Enter a message, up to 80 characters in mixed-case, to associate with the fail code you specified under <span class="bold">Fail Code</span>. The error message is displayed when the rule set evaluates to false or one of the associated rules contains an invalid PL/SQL expression. If you do not specify an error message, then Oracle Database Vault displays a generic error message.</p>
</li>
<li>
<p><span class="bold">Custom Event Handler Option:</span> <a id="sthref186"></a><a id="sthref187"></a>Select one of the following options to determine when to run the <span class="bold">Custom Event Handler Logic</span> (created next).</p>
<ul>
<li>
<p><span class="bold">Handler Disabled:</span> Default. Does not run any custom event method.</p>
</li>
<li>
<p><span class="bold">Execute On Failure:</span> Runs the custom event method when the rule set evaluates to false or one of the associated rules contains an invalid PL/SQL expression.</p>
</li>
<li>
<p><span class="bold">Execute On Success:</span> Runs the custom event method when the rule set evaluates to true.</p>
</li>
</ul>
<p>You can create a custom event method to provide special processing outside the standard Oracle Database Vault rule set auditing features. For example, you can use an event handler to initiate a workflow process or send event information to an external system.</p>
</li>
<li>
<p><span class="bold">Custom Event Handler Logic:</span> Enter a PL/SQL expression up to 255 characters in mixed-case. An expression may include any package procedure or standalone procedure. You can create your own expression or use the PL/SQL interfaces described in <a href="plsql_interfaces.htm#CHDEAEHD">Chapter 15, "Using the Oracle Database Vault PL/SQL&nbsp;Interfaces."</a></p>
<p>Write the expression as a fully qualified procedure (such as <code dir="ltr"><span class="codeinlineitalic">schema</span></code>.<code dir="ltr"><span class="codeinlineitalic">procedure_name</span></code>). Do not include complete SQL statements. If you are using application package procedures or standalone procedures, you must provide <code dir="ltr">DVSYS</code> with the <code dir="ltr">EXECUTE</code> privilege on the object. The procedure signature can be in one of the following two forms:</p>
<ul>
<li>
<p><code dir="ltr">PROCEDURE</code> <code dir="ltr"><span class="codeinlineitalic">my_ruleset_handler(</span></code><code dir="ltr"><span class="codeinlineitalic">p_ruleset_name</span></code> <code dir="ltr">IN VARCHAR2,</code> <code dir="ltr"><span class="codeinlineitalic">p_ruleset_rules</span></code> <code dir="ltr">IN BOOLEAN)</code>: Use this form when the name of the rule set and its return value are required in the handler processing.</p>
</li>
<li>
<p><code dir="ltr">PROCEDURE</code> <code dir="ltr"><span class="codeinlineitalic">my_ruleset_handler</span></code>: Use this form when the name of the rule set and its return value are not required in the handler processing.</p>
</li>
</ul>
<p>When you define the expression in the user interface that uses one of these two formats, put the expression in the following form:</p>
<pre dir="ltr">
<span class="italic">myschema</span>.<span class="italic">my_ruleset_handler</span>
</pre></li>
</ul>
<p>After you create a rule set, you are ready to create rules to attach to the rule set. To do so, you edit the new rule set, and then define its rules.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDGJEBG">"Configuring or Editing a Rule Set"</a></p>
</li>
<li>
<p><a href="#CHDGIFCE">"Creating a Rule to Add to a Rule Set"</a></p>
</li>
<li>
<p><a href="dba.htm#CHDEEEFH">"Propagating Oracle Database Vault Policies to Other Databases"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CHDGJEBG"></a>
<div id="DVADM70176" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Configuring or Editing a Rule Set</h2>
<p><a id="sthref188"></a>To configure or edit a rule set:</p>
<ol>
<li>
<p>In the Oracle Database Vault Administration page, select <span class="bold">Rule Sets</span>.</p>
</li>
<li>
<p>In the Rule Set page, select the rule set that you want to edit.</p>
</li>
<li>
<p>Click <span class="bold">Edit</span>.</p>
</li>
<li>
<p>Modify the rule set as necessary, and then click <span class="bold">OK</span>.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDDBAJI">"Creating a Rule Set"</a> to modify the settings created for a new rule set</p>
</li>
<li>
<p><a href="#CHDGIFCE">Creating a Rule to Add to a Rule Set</a> to add or modify rule for the rule set</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CHDGIFCE"></a>
<div id="DVADM70177" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Creating a Rule to Add to a Rule Set</h2>
<p><a id="sthref189"></a>After you create a new rule set, you can associate it with one or more rules. When you create a new rule, it is automatically added to the current rule set. You also can add existing rules to the rule set. Alternatively, you can omit adding rules to the rule set and use it as a template for rule sets you may want to create in the future.</p>
<p>The <a id="sthref190"></a>rule set evaluation depends on the evaluation of its rules using the Evaluation Options (<span class="bold">All True</span> or <span class="bold">Any True</span>). If a rule set is disabled, Oracle Database Vault evaluates the rule set to true without evaluating its rules.</p>
<p>See <a href="#CHDHEEHA">"How Rule Sets Work"</a> for information on how rules are evaluated, how to nest rules, and how to create rules that exclude a particular user, such as a privileged user.</p>
<a id="BABJHDJI"></a>
<div id="DVADM70178" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Creating a New Rule</h3>
<p><a id="sthref191"></a><a id="sthref192"></a>To create and add a rule to a rule set:</p>
<ol>
<li>
<p>In the Oracle Database Vault Administration page, select <span class="bold">Rule Sets</span>.</p>
</li>
<li>
<p>In the Rule Sets page, select the rule set to which you want to create and add a rule, and then select <span class="bold">Edit</span>.</p>
</li>
<li>
<p>In the Edit Rule Set Page, scroll down to Rules Associated To The Rule Set and select <span class="bold">Create</span>.</p>
</li>
<li>
<p>In the Create Rule page, enter the following settings:</p>
<ul>
<li>
<p><span class="bold">Name:</span> <a id="sthref193"></a><a id="sthref194"></a>Enter <a id="sthref195"></a>a name for the rule. Use up to 90 characters in mixed-case.</p>
<p>Oracle suggests that you start the name with a verb and complete the name with the purpose of the rule. For example:</p>
<pre dir="ltr">
Prevent non-admin access to SQL*Plus
</pre>
<p>Because rules do not have a <span class="bold">Description</span> field, make the name explicit but be sure to not exceed over 90 characters.</p>
</li>
<li>
<p><span class="bold">Rule Expression:</span> Enter a PL/SQL expression that fits the following requirements:</p>
<ul>
<li>
<p>It is valid in a SQL <code dir="ltr">WHERE</code> clause.</p>
</li>
<li>
<p>It can be a freestanding and valid PL/SQL Boolean expression such as the following:</p>
<pre dir="ltr">
TO_CHAR(SYSDATE,'HH24') = '12'
</pre></li>
<li>
<p>It must evaluate to a Boolean (<code dir="ltr">TRUE</code> or <code dir="ltr">FALSE</code>) value.</p>
</li>
<li>
<p>It must be no more than 255 characters long.</p>
</li>
<li>
<p>It can contain existing and compiled PL/SQL functions from the current database instance. Ensure that these are fully qualified functions (such as <code dir="ltr"><span class="codeinlineitalic">schema</span></code>. <code dir="ltr"><span class="codeinlineitalic">function_name</span></code>). Do not include complete SQL statements.</p>
<p>If you want to use application package functions or standalone functions, you must grant the <code dir="ltr">DVSYS</code> account the <code dir="ltr">EXECUTE</code> privilege on the function. Doing so reduces the chances of errors when you add new rules.</p>
</li>
<li>
<p>Ensure that the rule works. You can test the syntax by running the following statement in SQL*Plus:</p>
<pre dir="ltr">
SELECT <span class="italic">rule_expression</span> FROM DUAL;
</pre>
<p>For example, suppose you have created the following the rule expression:</p>
<pre dir="ltr">
SYS_CONTEXT('USERENV','SESSION_USER') != 'TSMITH'
</pre>
<p>You could test this expression as follows:</p>
<pre dir="ltr">
SELECT SYS_CONTEXT('USERENV','SESSION_USER') FROM DUAL;
</pre></li>
</ul>
<p>See the following sections for functions that you can use in the rule set expression:</p>
<ul>
<li>
<p><a href="plsql_interfaces.htm#CHDECFAD">"Oracle Database Vault PL/SQL Rule Functions"</a></p>
</li>
<li>
<p><a href="apis_dbms_macadm.htm#CHDHHDGI">Chapter 12, "Using the DBMS_MACADM Package"</a></p>
</li>
<li>
<p><a href="apis_dbms_macutl.htm#CIHIDIDC">Chapter 14, "Using the DBMS_MACUTL Package"</a></p>
</li>
</ul>
<p>For additional examples of expressions, see the rule defined in the rule sets provided with Oracle Database Vault. <a href="#CHDGIFGJ">"Default Rule Sets"</a> lists these rule sets.</p>
</li>
</ul>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
<p>The Edit Rule Set page appears. By default, the new rule is added to the rule set.</p>
</li>
</ol>
<p class="subhead2"><a id="DVADM70179"></a>Editing a Rule</p>
<p><a id="sthref196"></a><a id="sthref197"></a>The changes you make to a rule apply to all rule sets that include the rule.</p>
<p>To edit a rule:</p>
<ol>
<li>
<p>In the Edit Rule Set page, scroll to Rules Associated To The Rule Set.</p>
</li>
<li>
<p>Select the rule you want to edit and click <span class="bold">Edit</span>.</p>
</li>
<li>
<p>In the Edit Rule page, modify the rule as necessary.</p>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
</li>
</ol>
<p class="subhead2"><a id="DVADM70180"></a>Removing a Rule from a Rule Set</p>
<p>Before you remove a rule from a rule set, you can locate the various references to it by querying the rules-related Oracle Database Vault views. See <a href="views.htm#BABIFDGE">Chapter 16, "Oracle Database Vault Data Dictionary Views,"</a> for more information.</p>
<p><a id="sthref198"></a><a id="sthref199"></a>To remove a rule from a rule set:</p>
<ol>
<li>
<p>In the Edit Rule Set page, scroll to Rules Associated To The Rule Set.</p>
</li>
<li>
<p>Select the rule you want to delete and click <span class="bold">Remove</span>.</p>
</li>
<li>
<p>In the Confirmation page, click <span class="bold">Yes</span>.</p>
</li>
</ol>
<p><a id="sthref200"></a><a id="sthref201"></a>After you remove the rule from the rule set, it still exists. If you want, you can associate it with other rule sets. If you want to delete the rule, use the <code dir="ltr">DBMS_MACADM.DELETE_RULE</code> function, described in <a href="apis_dbms_macadm.htm#CHDGJABC">"Rule Set Procedures Within DBMS_MACADM"</a>. For example, to delete the rule Night Shift, log in to SQL*Plus as the Database Vault Owner and enter the following statement:</p>
<pre dir="ltr">
EXEC DBMS_MACADM.DELETE_RULE('Night Shift');
</pre></div>
<!-- class="sect2" -->
<div id="DVADM70181" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref202"></a>
<h3 class="sect2">Adding Existing Rules to a Rule Set</h3>
<p><a id="sthref203"></a><a id="sthref204"></a>To add existing rules to a rule set:</p>
<ol>
<li>
<p>In the Rule Sets page, select the rule set that you want to add rules to, and then select <span class="bold">Edit</span>.</p>
</li>
<li>
<p>Under Rules Associated To The Rule Set, select <span class="bold">Add Existing Rules</span>.</p>
</li>
<li>
<p>In the Add Existing Rules page, select the rules you want, and then click <span class="bold">Move</span> (or <span class="bold">Move All</span>, if you want all of them) to move them to the Selected Rules list.</p>
<p>You can select multiple rules by holding down the <span class="bold">Ctrl</span> key as you click each rule.</p>
</li>
<li>
<p>Click <span class="bold">OK</span>.</p>
</li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDBGBIC"></a>
<div id="DVADM70182" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Deleting a Rule Set</h2>
<p>Before you delete a rule set, you can locate the various references to it by querying the rules-related Oracle Database Vault views. See <a href="views.htm#BABIFDGE">Chapter 16, "Oracle Database Vault Data Dictionary Views,"</a> for more information.</p>
<p><a id="sthref205"></a>To delete a rule set:</p>
<ol>
<li>
<p>If other Database Vault objects, such as command rules, reference the rule set, then remove the reference.</p>
<p>You can delete a rule set only if no other Database Vault objects are referencing it.</p>
</li>
<li>
<p>In the Oracle Database Vault Administration page, select <span class="bold">Rule Sets</span>.</p>
</li>
<li>
<p>In the Rule Set page, select the rule set that you want to remove.</p>
</li>
<li>
<p>Click <span class="bold">Remove</span>.</p>
</li>
<li>
<p>In the Confirmation page, click <span class="bold">Yes</span>.</p>
<p>The rule set is deleted. However, the rules associated with the rule set are not deleted.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CHDHEEHA"></a>
<div id="DVADM70183" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">How Rule Sets Work</h2>
<p>This section describes how rule sets work in the following ways:</p>
<ul>
<li>
<p><a href="#BABDEJAA">How Oracle Database Vault Evaluates Rules</a></p>
</li>
<li>
<p><a href="#BABDEGEE">Nesting Rules Within a Rule Set</a></p>
</li>
<li>
<p><a href="#BABHHHJA">Creating Rules to Apply to Everyone Except One User</a></p>
</li>
</ul>
<a id="BABDEJAA"></a>
<div id="DVADM70184" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">How Oracle Database Vault Evaluates Rules</h3>
<p>Oracle Database Vault <a id="sthref206"></a><a id="sthref207"></a>evaluates the rules within a rule set as a collection of expressions. If you have set <span class="bold">Evaluation Options</span> to <span class="bold">All True</span> and if a rule fails the evaluation, then the evaluation stops at that point, instead of attempting to evaluate the rest of the rules in the rule set. Similarly, if <span class="bold">Evaluation Options</span> is set to <span class="bold">Any True</span> and if a rule evaluates to true, the evaluation stops at that point. If a rule set is disabled, Oracle Database Vault evaluates it to true without evaluating its rules.</p>
</div>
<!-- class="sect2" -->
<a id="BABDEGEE"></a>
<div id="DVADM70186" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Nesting Rules Within a Rule Set</h3>
<p><a id="sthref208"></a><a id="sthref209"></a>You can nest one or more rules within the rule set. For example, suppose you want to create a nested rule, Is Corporate Network During Maintenance, that performs the following two tasks:</p>
<ul>
<li>
<p>It limits table modifications only when the database session originates within the corporate network.</p>
</li>
<li>
<p>It restricts table modifications during the system maintenance window scheduled between 10:00 p.m. and 10:59 p.m.</p>
</li>
</ul>
<p>The rule definition would be as follows:</p>
<pre dir="ltr">
DVF.F$NETWORK = 'Corporate' AND TO_CHAR(SYSDATE,'HH24') between '22' AND '23'
</pre>
<p>You can create it using a factor function. See <a href="plsql_interfaces.htm#CHDJGAIJ">"Oracle Database Vault PL/SQL Factor Functions"</a> for more information. <a href="cfgfact.htm#CIHCDJJA">Chapter 7</a> explains how to create factors.</p>
</div>
<!-- class="sect2" -->
<a id="BABHHHJA"></a>
<div id="DVADM70187" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Creating Rules to Apply to Everyone Except One User</h3>
<p><a id="sthref210"></a>You can also create rules to apply to everyone <span class="italic">except</span> one user (for example, a privileged user). The rule definition for this type of rule can be as follows:</p>
<pre dir="ltr">
SYS_CONTEXT('USERENV','SESSION_USER') = 'SUPERADMIN_USER' OR <span class="italic">additional_rule</span>
</pre>
<p>If the current user is a privileged user, then the system evaluates the rule to true without evaluating <code dir="ltr"><span class="codeinlineitalic">additional_rule</span></code>. If the current user is not a privileged user, then the evaluation of the rule depends on the evaluation of <code dir="ltr"><span class="codeinlineitalic">additional_rule</span></code>.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDJCAEH"></a>
<div id="DVADM50058" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Tutorial: Creating an Email Alert for Security Violations</h2>
<p>This section contains:</p>
<ul>
<li>
<p><a href="#CHDGEHFE">About This Tutorial</a></p>
</li>
<li>
<p><a href="#BABEHEAI">Step 1: Install and Configure the UTL_MAIL PL/SQL Package</a></p>
</li>
<li>
<p><a href="#BABIFEDJ">Step 2: Create an Email Security Alert PL/SQL Procedure</a></p>
</li>
<li>
<p><a href="#BABBJDAG">Step 3: Configure an Access Control List File for Network Services</a></p>
</li>
<li>
<p><a href="#BABEJGIB">Step 4: Create a Rule Set and a Command Rule to Use the Email Security Alert</a></p>
</li>
<li>
<p><a href="#BABHJCEI">Step 5: Test the Email Security Alert</a></p>
</li>
<li>
<p><a href="#BABEIDCA">Step 6: Remove the Components for This Tutorial</a></p>
</li>
</ul>
<a id="CHDGEHFE"></a>
<div id="DVADM71115" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About This Tutorial</h3>
<p>In <a id="sthref211"></a><a id="sthref212"></a><a id="sthref213"></a>the following <a id="sthref214"></a>tutorial, you create an email alert that is sent when a user attempts to alter a table outside a maintenance period. To do this, you must create a rule to set the maintenance period hours, attach this rule to a rule set, and then create a command rule to allow the user to alter the table. You then associate the rule set with this command rule, which then sends the email alert when the user attempts to use the <code dir="ltr">ALTER TABLE</code> SQL statement outside the maintenance period.</p>
</div>
<!-- class="sect2" -->
<a id="BABEHEAI"></a>
<div id="DVADM70188" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Step 1: Install and Configure the UTL_MAIL PL/SQL Package</h3>
<ol>
<li>
<p>Log in to SQL*Plus as <code dir="ltr">SYS</code> using the <code dir="ltr">SYSDBA</code> privilege, and then install the <code dir="ltr">UTL_MAIL</code> package.</p>
<pre dir="ltr">
sqlplus sys as sysdba
Enter password: <span class="italic">password</span>

@$ORACLE_HOME/rdbms/admin/utlmail.sql
@$ORACLE_HOME/rdbms/admin/prvtmail.plb
</pre>
<p>The <code dir="ltr">UTL_MAIL</code> package enables you to manage email. See <a class="olink ARPLS384" href="../../appdev.112/e40758/u_mail.htm#ARPLS384"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about <code dir="ltr">UTL_MAIL</code>. However, be aware that currently, the <code dir="ltr">UTL_MAIL</code> PL/SQL package do not support SSL servers.</p>
</li>
<li>
<p>Check the current value of the <code dir="ltr">SMTP_OUT_SERVER</code> parameter, and make a note of this value so that you can restore it when you complete this tutorial.</p>
<p>For example:</p>
<pre dir="ltr">
SHOW PARAMETER SMTP_OUT_SERVER
</pre>
<p>Output similar to the following appears:</p>
<pre dir="ltr">
NAME                    TYPE              VALUE
----------------------- ----------------- ----------------------------------
SMTP_OUT_SERVER         string            some_value.example.com
</pre></li>
<li>
<p>Issue the following <code dir="ltr">ALTER SYSTEM</code> statement:</p>
<pre dir="ltr">
ALTER SYSTEM SET SMTP_OUT_SERVER="<span class="italic">imap_mail_server.example.com</span>";
</pre>
<p>Replace <code dir="ltr"><span class="codeinlineitalic">imap_mail_server.example.com</span></code> with the name of your SMTP server, which you can find in the account settings in your email tool. Enclose these settings in quotation marks. For example:</p>
<pre dir="ltr">
ALTER SYSTEM SET SMTP_OUT_SERVER="my_imap_mail_server.example.com"
</pre></li>
<li>
<p>Connect as <code dir="ltr">SYS</code> using the <code dir="ltr">SYSOPER</code> privilege and then restart the database.</p>
<pre dir="ltr">
CONNECT SYS/AS SYSOPER
Enter password: <span class="italic">password</span>

SHUTDOWN IMMEDIATE
STARTUP
</pre></li>
<li>
<p>Ensure that the <code dir="ltr">SMTP_OUT_SERVER</code> parameter setting is correct.</p>
<pre dir="ltr">
CONNECT SYS AS SYSDBA
Enter password: <span class="italic">password</span>

SHOW PARAMETER SMTP_OUT_SERVER
</pre>
<p>Output similar to the following appears:</p>
<pre dir="ltr">
NAME                    TYPE              VALUE
----------------------- ----------------- ----------------------------------
SMTP_OUT_SERVER         string            my_imap_mail_server.example.com
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABIFEDJ"></a>
<div id="DVADM70189" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Step 2: Create an Email Security Alert PL/SQL Procedure</h3>
<ol>
<li>
<p>Ensure that you are connected as <code dir="ltr">SYS</code> using the <code dir="ltr">SYSDBA</code> privilege, and then grant the following privileges to a user who has been granted the <code dir="ltr">DV_OWNER</code> role.</p>
<p>(Alternatively, you can select a user who has been granted the <code dir="ltr">DV_ADMIN</code> role, but for this tutorial, you will select a user who has the <code dir="ltr">DV_OWNER</code> role.)</p>
<p>For example:</p>
<pre dir="ltr">
CONNECT SYS AS SYSDBA
Enter password: <span class="italic">password</span>

GRANT CREATE PROCEDURE, DROP ANY PROCEDURE TO lbrown_dvowner;
GRANT EXECUTE ON UTL_TCP TO lbrown_dvowner;
GRANT EXECUTE ON UTL_SMTP TO lbrown_dvowner;
GRANT EXECUTE ON UTL_MAIL TO lbrown_dvowner;
GRANT EXECUTE ON DBMS_NETWORK_ACL_ADMIN TO lbrown_dvowner;
</pre>
<p>The <code dir="ltr">UTL_TCP</code>, <code dir="ltr">UTL_SMTP</code>, <code dir="ltr">UTL_MAIL</code>, and <code dir="ltr">DBMS_NETWORK_ACL_ADMIN</code> PL/SQL packages will be used by the email security alert that you create.</p>
</li>
<li>
<p>Connect to SQL*Plus as the <code dir="ltr">DV_OWNER</code> user.</p>
<p>For example:</p>
<pre dir="ltr">
CONNECT lbrown_dvowner
Enter password: <span class="italic">password</span>
</pre></li>
<li>
<p>Create the following procedure:</p>
<pre dir="ltr">
CREATE OR REPLACE PROCEDURE email_alert AS
msg varchar2(20000) := 'Realm violation occurred for the ALTER TABLE Command Security Policy rule set. The time is: '; 
BEGIN
  msg := msg||to_char(SYSDATE, 'Day DD MON, YYYY HH24:MI:SS'); 
UTL_MAIL.SEND (
    sender      =&gt; '<span class="italic">youremail@example.com</span>',
    recipients  =&gt; '<span class="italic">recipientemail@example.com</span>',
    subject     =&gt; 'Table modification attempted outside maintenance!',
    message     =&gt; msg); 
END email_alert;
/
</pre>
<p>Replace <code dir="ltr"><span class="codeinlineitalic">youremail@example.com</span></code> with your email address, and <code dir="ltr"><span class="codeinlineitalic">recipientemail@example.com</span></code> with the email address of the person you want to receive the notification.</p>
</li>
<li>
<p>Grant the <code dir="ltr">EXECUTE</code> permission on this procedure to <code dir="ltr">DVSYS</code>.</p>
<pre dir="ltr">
GRANT EXECUTE ON email_alert TO DVSYS; 
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABBJDAG"></a>
<div id="DVADM70190" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Step 3: Configure an Access Control List File for Network Services</h3>
<p>Before you can use PL/SQL network utility packages such as <code dir="ltr">UTL_MAIL</code>, you must configure an access control list (ACL) file that enables fine-grained access to external network services. For detailed information about this topic, see <a class="olink DBSEG40012" href="../../network.112/e36292/authorization.htm#DBSEG40012"><span class="italic">Oracle Database Security Guide</span></a>.</p>
<p>To configure an access control list for the email alert:</p>
<ol>
<li>
<p>As the <code dir="ltr">DV_OWNER</code> user, in SQL*Plus, create the following access control list and its privilege definitions.</p>
<pre dir="ltr">
BEGIN
 DBMS_NETWORK_ACL_ADMIN.CREATE_ACL (
  acl          =&gt; 'mail_server_permissions.xml', 
  description  =&gt; 'Enables network permissions for the mail server',
  principal    =&gt; 'LBROWN_DVOWNER',
  is_grant     =&gt; TRUE, 
  privilege    =&gt; 'connect');
END;
/
</pre>
<p>Ensure that you enter your exact user name for the principal setting, in upper-case letters. For this tutorial, enter the name of the Database Vault Owner account (for example, <code dir="ltr">LBROWN_DVOWNER</code>).</p>
</li>
<li>
<p>Assign the access control list to the outgoing SMTP network host for your email server.</p>
<pre dir="ltr">
BEGIN
 DBMS_NETWORK_ACL_ADMIN.ASSIGN_ACL (
  acl         =&gt; 'mail_server_permissions.xml',
  host        =&gt; '<span class="italic">SMTP_OUT_SERVER_setting</span>', 
  lower_port  =&gt; <span class="italic">port</span>); 
END;
/
</pre>
<p>In this example:</p>
<ul>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">SMTP_OUT_SERVER_setting</span></code>: Enter the <code dir="ltr">SMTP_OUT_SERVER</code> setting that you set for the <code dir="ltr">SMTP_OUT_SERVER</code> parameter in <a href="#BABEHEAI">"Step 1: Install and Configure the UTL_MAIL PL/SQL Package"</a>. This setting should match exactly the setting that your email tool specifies for its outgoing server.</p>
</li>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">port</span></code>: Enter the port number that your email tool specifies for its outgoing server. Typically, this setting is 25. Enter this value for both the <code dir="ltr">lower_port</code> and <code dir="ltr">upper_port</code> settings. (Currently, the <code dir="ltr">UTL_MAIL</code> package does not support SSL. If your mail server is an SSL server, then enter 25 for the port number, even if the mail server uses a different port number.)</p>
</li>
</ul>
</li>
<li>
<p>Commit your changes to the database.</p>
<pre dir="ltr">
COMMIT;
</pre></li>
<li>
<p>Test the settings that you have created so far.</p>
<pre dir="ltr">
EXEC EMAIL_ALERT;
COMMIT;
</pre>
<p>SQL*Plus should display a <code dir="ltr">PL/SQL procedure successfully completed</code> message, and in a moment, depending on the speed of your email server, you should receive the email alert.</p>
<p>If you receive an<a id="sthref215"></a> <code dir="ltr">ORA-24247: network access denied by access control list (ACL)</code> error followed by<a id="sthref216"></a> <code dir="ltr">ORA-06512: at</code> <code dir="ltr"><span class="codeinlineitalic">string</span></code><code dir="ltr">line</code> <code dir="ltr"><span class="codeinlineitalic">string</span></code> errors, then check the settings in the access control list file.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABEJGIB"></a>
<div id="DVADM70191" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Step 4: Create a Rule Set and a Command Rule to Use the Email Security Alert</h3>
<ol>
<li>
<p>As the <code dir="ltr">DV_OWNER</code> user, create the following rule set:</p>
<pre dir="ltr">
BEGIN
 DBMS_MACADM.CREATE_RULE_SET(
  rule_set_name    =&gt; 'ALTER TABLE Command Security Policy', 
  description      =&gt; 'This rule set allows ALTER TABLE only during the 
                       maintenance period.', 
  enabled          =&gt; DBMS_MACUTL.G_YES,
  eval_options     =&gt; DBMS_MACUTL.G_RULESET_EVAL_ALL ,
  audit_options    =&gt; DBMS_MACUTL.G_RULESET_AUDIT_FAIL,,
  fail_options     =&gt; DBMS_MACUTL.G_RULESET_FAIL_SILENT,
  fail_message     =&gt; '',
  fail_code        =&gt; NULL,
  handler_options  =&gt; DBMS_MACUTL.G_RULESET_HANDLER_FAIL,
  handler          =&gt; 'dbavowner.email_alert');
END;
/
</pre></li>
<li>
<p>Create a rule similar to the following.</p>
<p>For now, set the rule expression to be during the time you test it. For example, if you want to test it between 2 p.m. and 3 p.m., create the rule as follows:</p>
<pre dir="ltr">
BEGIN
 DBMS_MACADM.CREATE_RULE(
  rule_name  =&gt; 'Restrict Access to Maintenance Period', 
  rule_expr  =&gt; 'TO_CHAR(SYSDATE,''HH24'') BETWEEN ''14'' AND ''15''');
END;
/
</pre>
<p>Ensure that you use two single quotation marks instead of double quotation marks for <code dir="ltr">HH24</code>, <code dir="ltr">14</code>, and <code dir="ltr">15</code>.</p>
<p>You can check the system time on your computer by issuing the following SQL statement:</p>
<pre dir="ltr">
SELECT TO_CHAR(SYSDATE,'HH24') FROM DUAL;
</pre>
<p>Output similar to the following appears:</p>
<pre dir="ltr">
TO
--
14
</pre>
<p>Later on, when you are satisfied that the rule works, you can update it to a time when your site typically performs maintenance work (for example, between 7 p.m. and 10 p.m), as follows:</p>
<pre dir="ltr">
BEGIN
 DBMS_MACADM.UPDATE_RULE(
  rule_name  =&gt; 'Restrict Access to Maintenance Period', 
  rule_expr  =&gt; 'TO_CHAR(SYSDATE,''HH24'') BETWEEN ''19'' AND ''22''');
END;
/
</pre></li>
<li>
<p>Add the Restrict Access to Maintenance Period rule to the ALTER TABLE Command Security Policy rule set.</p>
<pre dir="ltr">
BEGIN
 DBMS_MACADM.ADD_RULE_TO_RULE_SET(
  rule_set_name =&gt; 'ALTER TABLE Command Security Policy', 
  rule_name     =&gt; 'Restrict Access to Maintenance Period'); 
END;
/
</pre></li>
<li>
<p>Create the following command rule:</p>
<pre dir="ltr">
BEGIN
 DBMS_MACADM.CREATE_COMMAND_RULE(
  command         =&gt; 'ALTER TABLE', 
  rule_set_name   =&gt; 'ALTER TABLE Command Security Policy', 
  object_owner    =&gt; 'SCOTT', 
  object_name     =&gt; '%', 
  enabled         =&gt; DBMS_MACUTL.G_YES);
END; 
/
</pre></li>
<li>
<p>Commit these updates to the database.</p>
<pre dir="ltr">
COMMIT;
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABHJCEI"></a>
<div id="DVADM70192" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Step 5: Test the Email Security Alert</h3>
<ol>
<li>
<p>Connect to SQL*Plus as user <code dir="ltr">SCOTT</code>.</p>
<p>For example:</p>
<pre dir="ltr">
CONNECT SCOTT
Enter password: <span class="italic">password</span>
</pre>
<p>If the <code dir="ltr">SCOTT</code> account is locked and expired, then a user with the <code dir="ltr">DV_ACCTMGR</code> role can unlock this account and create a new password as follows:</p>
<pre dir="ltr">
ALTER USER SCOTT ACCOUNT UNLOCK IDENTIFIED BY <span class="italic">password</span>;
</pre>
<p>Replace <code dir="ltr"><span class="codeinlineitalic">password</span></code> with a password that is secure. See <a class="olink DBSEG33223" href="../../network.112/e36292/authentication.htm#DBSEG33223"><span class="italic">Oracle Database Security Guide</span></a> for the minimum requirements for creating passwords.</p>
</li>
<li>
<p>As the user <code dir="ltr">SCOTT</code>, create a test table.</p>
<pre dir="ltr">
CREATE TABLE mytest (col1 number);
</pre></li>
<li>
<p>Change the system time on your computer to a time when the ALTER TABLE Command Security Policy rule set takes place (for example, between 2 p.m. and 3 p.m).</p>
<p><span class="bold">UNIX:</span> Log in as root and use the <code dir="ltr">date</code> command to set the time. For example, assuming the date today is December 14, 2011, you would enter the following:</p>
<pre dir="ltr">
su root
Password: <span class="italic">password</span>

date --set="14 DEC 2011 14:00:00"
</pre>
<p><span class="bold">Windows:</span> Double-click the clock icon, which is typically at the lower right corner of the screen. In the Date and Time Properties window, set the time to 2 p.m., and then click <span class="bold">OK</span>.</p>
</li>
<li>
<p>Try altering the <code dir="ltr">my_test</code> table.</p>
<pre dir="ltr">
ALTER TABLE mytest ADD (col2 number);

Table altered.
</pre>
<p><code dir="ltr">SCOTT</code> should be able to alter the <code dir="ltr">mytest</code> table during this time.</p>
</li>
<li>
<p>Reset the system time to a time outside the Restrict Access to Maintenance Period time.</p>
</li>
<li>
<p>Log in as <code dir="ltr">SCOTT</code> and try altering the <code dir="ltr">my_test</code> table again.</p>
<pre dir="ltr">
CONNECT SCOTT
Enter password: <span class="italic">password</span>

ALTER TABLE mytest ADD (col3 number);
</pre>
<p>The following output should appear:</p>
<pre dir="ltr">
<a id="sthref217"></a>ORA-47400: Command Rule violation for ALTER TABLE on SCOTT.MYTEST
</pre>
<p><code dir="ltr">SCOTT</code> cannot alter the <code dir="ltr">mytest</code> table. In a moment, you should receive an email with the subject header <code dir="ltr">Table modification attempted outside maintenance!</code> and with a message similar to the following:</p>
<pre dir="ltr">
Realm violation occurred for the ALTER TABLE Command Security Policy rule set. The time is: Wednesday 06 MAY, 2009 14:24:25
</pre></li>
<li>
<p>Reset the system time to the correct time.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABEIDCA"></a>
<div id="DVADM70193" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Step 6: Remove the Components for This Tutorial</h3>
<ol>
<li>
<p>Connect to SQL*Plus as the <code dir="ltr">DV_OWNER</code> user, and then in the order shown, drop the Oracle Database Vault rule components.</p>
<pre dir="ltr">
EXEC DBMS_MACADM.DELETE_RULE_FROM_RULE_SET('ALTER TABLE Command Security Policy', 'Restrict Access to Maintenance Period');
EXEC DBMS_MACADM.DELETE_RULE('Restrict Access to Maintenance Period');
EXEC DBMS_MACADM.DELETE_COMMAND_RULE('ALTER TABLE', 'SCOTT', '%');
EXEC DBMS_MACADM.DELETE_RULE_SET('ALTER TABLE Command Security Policy');
</pre></li>
<li>
<p>Drop the <code dir="ltr">email_alert</code> PL/SQL procedure.</p>
<pre dir="ltr">
DROP PROCEDURE email_alert;
</pre></li>
<li>
<p>Remove the access control list.</p>
<pre dir="ltr">
EXEC DBMS_NETWORK_ACL_ADMIN.DROP_ACL ('email_alert_permissions.xml');
</pre></li>
<li>
<p>Connect as user <code dir="ltr">SCOTT</code> and remove the <code dir="ltr">mytest</code> table.</p>
<pre dir="ltr">
CONNECT SCOTT
Enter password: <span class="italic">password</span>

DROP TABLE mytest;
</pre></li>
<li>
<p>Connect as <code dir="ltr">SYS</code> using the <code dir="ltr">SYSDBA</code> privilege and then revoke the <code dir="ltr">EXECUTE</code> privilege on the <code dir="ltr">UTL_TCP</code>, <code dir="ltr">UTL_SMTP</code>, and <code dir="ltr">UTL_MAIL</code> PL/SQL packages from the <code dir="ltr">DV_OWNER</code> user.</p>
<p>For example:</p>
<pre dir="ltr">
REVOKE EXECUTE ON UTL_TCP FROM lbrown_dvowner;
REVOKE EXECUTE ON UTL_SMTP FROM lbrown_dvowner;
REVOKE EXECUTE ON UTL_MAIL FROM lbrown_dvowner;
REVOKE EXECUTE ON DBMS_NETWORK_ACL_ADMIN from lbrown_dvowner;
</pre></li>
<li>
<p>Set the <code dir="ltr">SMTP_OUT_SERVER</code> parameter to its original value.</p>
<p>For example:</p>
<pre dir="ltr">
ALTER SYSTEM SET SMTP_OUT_SERVER="some_value.example.com";
</pre></li>
<li>
<p>Connect as <code dir="ltr">SYS</code> using the <code dir="ltr">SYSOPER</code> privilege and then restart the database.</p>
<pre dir="ltr">
CONNECT SYS/AS SYSOPER
Enter password: <span class="italic">password</span>

SHUTDOWN IMMEDIATE
STARTUP
</pre></li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABBDGJC"></a>
<div id="DVADM70194" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Tutorial: Configuring Two-Person Integrity, or Dual Key Security</h2>
<p>This section contains:</p>
<ul>
<li>
<p><a href="#CHDIBECJ">About This Tutorial</a></p>
</li>
<li>
<p><a href="#BABHHEFA">Step 1: Create Users for This Tutorial</a></p>
</li>
<li>
<p><a href="#BABFDDHB">Step 2: Create a Function to Check if User patch_boss Is Logged In</a></p>
</li>
<li>
<p><a href="#BABHJBGJ">Step 3: Create Rules, a Rule Set, and a Command Rule to Control the Users' Access</a></p>
</li>
<li>
<p><a href="#BABIGCJF">Step 4: Test the Users' Access</a></p>
</li>
<li>
<p><a href="#BABHIGAG">Step 5: Remove the Components for This Tutorial</a></p>
</li>
</ul>
<a id="CHDIBECJ"></a>
<div id="DVADM71116" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About This Tutorial</h3>
<p>In this <a id="sthref218"></a>tutorial, you configure a rule set that defines <a id="sthref219"></a><a id="sthref220"></a>two-person integrity (TPI), also called dual key security, dual key connection, and two-man rule security. In this type of security, two users are required to authorize an action instead of one user. The idea is that one user provides a safety check for the other user before that user can proceed with a task. Two-person integrity provides an additional layer of security for actions that potentially can be dangerous. This type of scenario is often used for tasks such as database patch updates, which is what this tutorial will demonstrate. One user, <code dir="ltr">patch_user</code> must log in to perform a <a id="sthref221"></a>database patch upgrade, but the only way that he can do this is if his manager, <code dir="ltr">patch_boss</code> is already logged in. You will create a function, rules, a rule set, and a command rule to control <code dir="ltr">patch_user</code>'s ability to log in.</p>
</div>
<!-- class="sect2" -->
<a id="BABHHEFA"></a>
<div id="DVADM70195" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Step 1: Create Users for This Tutorial</h3>
<p>You must create the following two users for this tutorial:</p>
<ul>
<li>
<p><code dir="ltr">patch_boss</code> acts in a supervisory role: If <code dir="ltr">patch_boss</code> is not logged in, then the <code dir="ltr">patch_user</code> user cannot log in.</p>
</li>
<li>
<p><code dir="ltr">patch_user</code> is the user who is assigned to perform the patch upgrade. However, for this tutorial, user <code dir="ltr">patch_user</code> does not actually perform a patch upgrade. He only attempts to log in.</p>
</li>
</ul>
<p>To create the users:</p>
<ol>
<li>
<p>Connect to SQL*Plus as a user who has been granted the <code dir="ltr">DV_ACCTMGR</code> role.</p>
<p>For example:</p>
<pre dir="ltr">
CONNECT amalcolm_dvacctmgr
Enter password: <span class="italic">password</span>
</pre></li>
<li>
<p>Create the following users.</p>
<pre dir="ltr">
CREATE USER patch_boss IDENTIFIED BY <span class="italic">password</span>;
CREATE USER patch_user IDENTIFIED BY <span class="italic">password</span>;
</pre>
<p>Replace <code dir="ltr"><span class="codeinlineitalic">password</span></code> with a password that is secure. See <a class="olink DBSEG33223" href="../../network.112/e36292/authentication.htm#DBSEG33223"><span class="italic">Oracle Database Security Guide</span></a> for the minimum requirements for creating passwords.</p>
</li>
<li>
<p>Connect as user <code dir="ltr">SYS</code> with the <code dir="ltr">SYSDBA</code> privilege and grant privileges to the <code dir="ltr">patch_boss</code> and <code dir="ltr">patch_user</code> users.</p>
<pre dir="ltr">
CONNECT SYS AS SYSDBA
Enter password: <span class="italic">password</span>

GRANT CREATE SESSION TO patch_boss, patch_user;
</pre></li>
<li>
<p>Grant the following privileges to the <code dir="ltr">DV_OWNER</code> or <code dir="ltr">DV_ADMIN</code> user.</p>
<p>For example:</p>
<pre dir="ltr">
GRANT CREATE PROCEDURE TO lbrown_dvowner;
GRANT SELECT ON V_$SESSION TO lbrown_dvowner;
</pre>
<p>The <code dir="ltr">V_$SESSION</code> table is the underlying table for the <code dir="ltr">V$SESSION</code> dynamic view.</p>
</li>
</ol>
<p>In a real-world scenario, you also would log in as the <code dir="ltr">DV_OWNER</code> user and grant the <code dir="ltr">DV_PATCH_ADMIN</code> role to user <code dir="ltr">patch_user</code> (but not to <code dir="ltr">patch_boss</code>). But because you are not really going to perform a database patch upgrade in this tutorial, you do not need to grant this role to user <code dir="ltr">patch_user</code>.</p>
</div>
<!-- class="sect2" -->
<a id="BABFDDHB"></a>
<div id="DVADM70196" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Step 2: Create a Function to Check if User patch_boss Is Logged In</h3>
<p>The function that you must create, <code dir="ltr">check_boss_logged_in</code>, does just that: When user <code dir="ltr">patch_user</code> tries to log in to SQL*Plus, it checks if user <code dir="ltr">patch_boss</code> is already logged in by querying the <code dir="ltr">V$SESSION</code> data dictionary view.</p>
<p>To create the <code dir="ltr">check_boss_logged_in</code> function:</p>
<ol>
<li>
<p>As the <code dir="ltr">DV_OWNER</code> or <code dir="ltr">DV_ADMIN</code> user, create the <code dir="ltr">check_boss_logged_in</code> function as follows:</p>
<pre dir="ltr">
CREATE OR REPLACE FUNCTION check_boss_logged_in
return varchar2
authid definer as 
 
v_session_number number := 0;
v_allow varchar2(10)    := 'TRUE';
v_deny varchar2(10)     := 'FALSE';
 
BEGIN
  SELECT COUNT(*) INTO v_session_number
  FROM SYS.V_$SESSION
  WHERE USERNAME = 'PATCH_BOSS'; -- Enter the user name in capital letters.
 
 IF v_session_number &gt; 0
  THEN RETURN v_allow;
 ELSE
  RETURN v_deny;
 END IF;
END check_boss_logged_in;
/
</pre></li>
<li>
<p>Grant the <code dir="ltr">EXECUTE</code> privilege on the <code dir="ltr">check_boss_logged_in</code> function to the <code dir="ltr">DVSYS</code> schema.</p>
<pre dir="ltr">
GRANT EXECUTE ON check_boss_logged_in to DVSYS;
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABHJBGJ"></a>
<div id="DVADM70197" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Step 3: Create Rules, a Rule Set, and a Command Rule to Control the Users' Access</h3>
<p>Next, you must create two rules, a rule set to which you will add them, and a command rule. The rule set triggers the <code dir="ltr">check_boss_logged_in</code> function when user <code dir="ltr">patch_user</code> tries to logs in to the database.</p>
<p>To create the rules and rule set:</p>
<ol>
<li>
<p>Connect as a user who has been granted the <code dir="ltr">DV_OWNER</code> or <code dir="ltr">DV_ADMIN</code> role.</p>
<p>For example:</p>
<pre dir="ltr">
CONNECT lbrown_dvowner
Enter password: <span class="italic">password</span>
</pre></li>
<li>
<p>Create the Check if Boss Is Logged In rule, which checks that the <code dir="ltr">patch_user</code> user is logged in to the database. In the definition, replace <code dir="ltr">lbrown_dvowner</code> with the name of the <code dir="ltr">DVOWNER</code> or <code dir="ltr">DV_ADMIN</code> user who created the <code dir="ltr">check_boss_logged_in</code> function.</p>
<p>If the <code dir="ltr">check_boss_logged_in</code> function returns <code dir="ltr">TRUE</code> (that is, <code dir="ltr">patch_boss</code> is logged in to another session), then <code dir="ltr">patch_user</code> can log in.</p>
<pre dir="ltr">
BEGIN
  DBMS_MACADM.CREATE_RULE(
  rule_name =&gt; 'Check if Boss Is Logged In',
  rule_expr =&gt; 'SYS_CONTEXT(''USERENV'',''SESSION_USER'') = ''PATCH_USER'' and lbrown_dvowner.check_boss_logged_in =  ''TRUE'' ');
END;
/
</pre>
<p>Enter the user name, <code dir="ltr">PATCH_USER</code>, in upper-case letters, which is how the <code dir="ltr">SESSION_USER</code> parameter stores it.</p>
</li>
<li>
<p>Create the Allow Connect for Other Database Users rule, which ensures that the user logged in (<code dir="ltr">patch_user</code>) is not user <code dir="ltr">patch_boss</code>. It also enables all other valid users to log in.</p>
<pre dir="ltr">
BEGIN
 DBMS_MACADM.CREATE_RULE(
  rule_name =&gt; 'Allow Connect for Other Database Users',
  rule_expr =&gt; 'SYS_CONTEXT(''USERENV'',''SESSION_USER'') != ''PATCH_USER''');
END;
/
COMMIT;
</pre></li>
<li>
<p>Create the Dual Connect for Boss and Patch rule set, and then add the two rules to it.</p>
<pre dir="ltr">
BEGIN
     DBMS_MACADM.CREATE_RULE_SET(
     rule_set_name =&gt; 'Dual Connect for Boss and Patch',
     description =&gt; 'Checks if both boss and patch users are logged in.',
     enabled           =&gt; DBMS_MACUTL.G_YES,
     eval_options      =&gt; DBMS_MACUTL.G_RULESET_EVAL_ANY,
     audit_options     =&gt; DBMS_MACUTL.G_RULESET_AUDIT_FAIL,
     fail_options      =&gt; DBMS_MACUTL.G_RULESET_FAIL_SILENT,
     fail_message      =&gt;'',
     fail_code         =&gt; NULL,
     handler_options   =&gt; DBMS_MACUTL.G_RULESET_HANDLER_OFF,
     handler           =&gt; ''
     );
END;
/

BEGIN
     DBMS_MACADM.ADD_RULE_TO_RULE_SET(
     rule_set_name     =&gt; 'Dual Connect for Boss and Patch',
     rule_name         =&gt; 'Check if Boss Is Logged In'
   );
END;
/

BEGIN
     DBMS_MACADM.ADD_RULE_TO_RULE_SET(
     rule_set_name     =&gt; 'Dual Connect for Boss and Patch',
     rule_name         =&gt; 'Allow Connect for Other Database Users'
   );
END;
/
</pre></li>
<li>
<p>Create the following CONNECT command rule, which permits user <code dir="ltr">patch_user</code> to connect to the database only if <code dir="ltr">patch_boss</code> is already logged in.</p>
<pre dir="ltr">
BEGIN
   DBMS_MACADM.CREATE_COMMAND_RULE(
   command             =&gt; 'CONNECT',
    rule_set_name      =&gt; 'Dual Connect for Boss and Patch',
    object_owner       =&gt; '%',
    object_name        =&gt; '%',
    enabled            =&gt; DBMS_MACUTL.G_YES);
END;
/
COMMIT;
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABIGCJF"></a>
<div id="DVADM70198" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Step 4: Test the Users' Access</h3>
<ol>
<li>
<p>Exit SQL*Plus.</p>
<pre dir="ltr">
EXIT
</pre></li>
<li>
<p>Create a second shell, for example:</p>
<pre dir="ltr">
xterm &amp;
</pre></li>
<li>
<p>In the first shell, try to log in as user <code dir="ltr">patch_user</code>.</p>
<pre dir="ltr">
sqlplus patch_user
Enter password: <span class="italic">password</span>

ERROR:
ORA-47400: Command Rule violation for CONNECT on LOGON

Enter user-name:
</pre>
<p>User <code dir="ltr">patch_user</code> cannot log in until user <code dir="ltr">patch_boss</code> is already logged in. (Do not try the <code dir="ltr">Enter user-name</code> prompt yet.)</p>
</li>
<li>
<p>In the second shell, log in as user <code dir="ltr">patch_boss</code>.</p>
<pre dir="ltr">
sqlplus patch_boss
Enter password: <span class="italic">password</span>
Connected. 
</pre>
<p>User <code dir="ltr">patch_boss</code> can log in.</p>
</li>
<li>
<p>Go back to the first shell, and then try logging in as user <code dir="ltr">patch_user</code> again.</p>
<pre dir="ltr">
Enter user_name: patch_user
Enter password: <span class="italic">password</span>
</pre>
<p>This time, user <code dir="ltr">patch_user</code> is deemed a valid user, so now he can log in.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABHIGAG"></a>
<div id="DVADM70199" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Step 5: Remove the Components for This Tutorial</h3>
<ol>
<li>
<p>In the session for the user <code dir="ltr">patch_boss</code>, exit SQL*Plus and then close the shell.</p>
<pre dir="ltr">
EXIT
</pre></li>
<li>
<p>In the first shell, connect the <code dir="ltr">DV_ACCTMGR</code> user and remove the users you created.</p>
<pre dir="ltr">
CONNECT amalcolm_dvacctmgr
Enter password: <span class="italic">password</span>

DROP USER patch_boss;
DROP USER patch_user;
</pre></li>
<li>
<p>Connect as user <code dir="ltr">SYS</code> with the <code dir="ltr">SYSDBA</code> privilege and revoke the privileges that you had granted to the <code dir="ltr">DV_OWNER</code> or <code dir="ltr">DV_ADMIN</code> user.</p>
<pre dir="ltr">
CONNECT SYS AS SYSDBA
Enter password: <span class="italic">password</span>

REVOKE CREATE PROCEDURE FROM lbrown_dvowner;
REVOKE SELECT ON V_$SESSION FROM lbrown_dvowner;
</pre></li>
<li>
<p>Connect as the <code dir="ltr">DV_OWNER</code> or <code dir="ltr">DV_ADMIN</code> user and drop the rules, rule set, and command rule, in the order shown.</p>
<pre dir="ltr">
CONNECT lbrown_dvowner
Enter password: <span class="italic">password</span>

DROP FUNCTION check_boss_logged_in;
EXEC DBMS_MACADM.DELETE_COMMAND_RULE('CONNECT', '%', '%');
EXEC DBMS_MACADM.DELETE_RULE_FROM_RULE_SET('Dual Connect for Boss and Patch', 'Check if Boss Is Logged In');
EXEC DBMS_MACADM.DELETE_RULE_FROM_RULE_SET('Dual Connect for Boss and Patch', 'Allow Connect for Other Database Users');
EXEC DBMS_MACADM.DELETE_RULE('Check if Boss Is Logged In');
EXEC DBMS_MACADM.DELETE_RULE('Allow Connect for Other Database Users');
EXEC DBMS_MACADM.DELETE_RULE_SET('Dual Connect for Boss and Patch');
COMMIT;
</pre></li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDDJJCH"></a>
<div id="DVADM70200" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Guidelines for Designing Rule Sets</h2>
<p>Follow <a id="sthref222"></a><a id="sthref223"></a>these guidelines for designing rule sets:</p>
<ul>
<li>
<p>You can share rules among multiple rule sets. This lets you develop a library of reusable rule expressions. Oracle recommends that you design such rules to be discrete, single-purpose expressions.</p>
</li>
<li>
<p>You <a id="sthref224"></a>can design a rule set so that its evaluation is static, that is, it is evaluated only once during a user session. Alternatively, it can be evaluated each time the associated command rule accesses the rule set. If the rule set is evaluated only once, then the evaluated value is reused throughout the user session each time the command rule accesses the rule set. Using static evaluation is useful in cases where the rule set must be accessed multiple times but the conditions on which the rule set depend do not change during that session. An example would be a SELECT command rule associated with a rule set when the same <code dir="ltr">SELECT</code> statement occurs multiple times and if the evaluated value is acceptable to use again, rather than evaluating the rule set each time the <code dir="ltr">SELECT</code> occurs.</p>
<p>To control the static evaluation of the rule set, set the <code dir="ltr">is_static</code> parameter of the <code dir="ltr">CREATE_RULE_SET</code> or <code dir="ltr">UPDATE_RULE_SET</code> procedures of the <code dir="ltr">DBMS_MACADM</code> PL/SQL package. See <a href="apis_dbms_macadm.htm#CHDGJABC">"Rule Set Procedures Within DBMS_MACADM"</a> for more information.</p>
</li>
<li>
<p>Use Oracle Database Vault factors in your rule expressions to provide reusability and trust in the values used by your rule expressions. Factors can provide contextual information to use in your rules expressions.</p>
</li>
<li>
<p>You can use custom event handlers to extend Oracle Database Vault security policies to integrate external systems for error handling or alerting. Using Oracle utility packages such as <code dir="ltr">UTL_TCP</code>, <code dir="ltr">UTL_HTTP</code>, <code dir="ltr">UTL_MAIL</code>, <code dir="ltr">UTL_SMTP</code>, or <code dir="ltr">DBMS_AQ</code> can help you to achieve this type of integration.</p>
</li>
<li>
<p>Test rule sets thoroughly for various accounts and scenarios either on a test database or on a test realm or command rule for nonsensitive data before you apply them to realms and command rules that protect sensitive data. You can test rule expressions directly with the following SQL statement:</p>
<pre dir="ltr">
SQL&gt; SELECT SYSDATE from DUAL where <span class="italic">rule expression</span>
</pre></li>
<li>
<p>You can nest rule expressions inside a single rule. This helps to achieve more complex situations where you would need a logical <code dir="ltr">AND</code> for a subset of rules and a logical <code dir="ltr">OR</code> with the rest of the rules. See the definition for the Is Corporate Network During Maintenance rule set under <a href="#CHDJCAEH">"Tutorial: Creating an Email Alert for Security Violations"</a> for an example.</p>
</li>
<li>
<p>You cannot use invoker's rights procedures with rule expressions. Only use definer's rights procedures with rule expressions.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="CHDFFGIG"></a>
<div id="DVADM70201" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">How Rule Sets Affect Performance</h2>
<p><a id="sthref225"></a><a id="sthref226"></a>In general, the more rules and more complex the rules, the more performance overhead the performance for execution of certain operations governed by these rule sets. For example, if you have a very large number of rules in a rule set governing a <code dir="ltr">SELECT</code> statement, performance could degrade significantly.</p>
<p>If you have rule sets that require many rules, performance improves if you move all the rules to logic defined in a single PL/SQL standalone or package function. However, if a rule is used by other rule sets, there is little performance effect on your system.</p>
<p>If possible, <a id="sthref227"></a>consider setting the rule set to use static evaluation, assuming this is compatible with the associated command rule's usage. See <a href="#CHDDJJCH">"Guidelines for Designing Rule Sets"</a> for more information.</p>
<p>You can check system performance by running tools such as <a id="sthref228"></a>Oracle Enterprise Manager (including <a id="sthref229"></a>Oracle Enterprise Manager Database Control, which is installed by default with Oracle Database), <a id="sthref230"></a><code dir="ltr">Statspack</code>, and <a id="sthref231"></a><code dir="ltr">TKPROF</code>. For more information about Oracle Enterprise Manager, see the Oracle Enterprise Manager documentation set. For information about Database Control, refer to its online Help. <a class="olink PFGRF" href="../e41573/toc.htm"><span class="italic">Oracle Database Performance Tuning Guide</span></a> describes the <code dir="ltr">Statspack</code> and <code dir="ltr">TKPROF</code> utilities.</p>
</div>
<!-- class="sect1" -->
<a id="BABHJBHC"></a>
<div id="DVADM70202" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Related Reports and Data Dictionary Views</h2>
<p><a href="#BABBJDEI">Table 5-1</a> <a id="sthref232"></a><a id="sthref233"></a>lists Oracle Database Vault reports that are useful for analyzing rule sets and the rules within them. See <a href="reports.htm#BABDCICF">Chapter 18, "Oracle Database Vault Reports,"</a> for information about how to run these reports.</p>
<div id="DVADM70203" class="tblhruleformal">
<p class="titleintable"><a id="sthref234"></a><a id="BABBJDEI"></a>Table 5-1 Reports Related to Rule Sets</p>
<table class="cellalignment1647" title="Reports Related to Rule Sets" summary="rule set reports" dir="ltr">
<thead>
<tr class="cellalignment1639">
<th class="cellalignment1648" id="r1c1-t6">Report</th>
<th class="cellalignment1648" id="r1c2-t6">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1639">
<td class="cellalignment1646" id="r2c1-t6" headers="r1c1-t6">
<p><a href="reports.htm#BABGBBFH">"Rule Set Configuration Issues Report"</a></p>
</td>
<td class="cellalignment1646" headers="r2c1-t6 r1c2-t6">
<p>Lists rule sets that have no rules defined or enabled</p>
</td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646" id="r3c1-t6" headers="r1c1-t6">
<p><a href="reports.htm#BABJAAFD">"Secure Application Configuration Issues Report"</a></p>
</td>
<td class="cellalignment1646" headers="r3c1-t6 r1c2-t6">
<p>Lists secure application roles that have incomplete or disabled rule sets</p>
</td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646" id="r4c1-t6" headers="r1c1-t6">
<p><a href="reports.htm#BABJGDCF">"Command Rule Configuration Issues Report"</a></p>
</td>
<td class="cellalignment1646" headers="r4c1-t6 r1c2-t6">
<p>Lists rule sets that are incomplete or disabled</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<p><a href="#BABIFDJJ">Table 5-2</a> lists <a id="sthref235"></a><a id="sthref236"></a>data dictionary views that provide information about existing rules and rule sets.</p>
<div id="DVADM70204" class="tblhruleformal">
<p class="titleintable"><a id="sthref237"></a><a id="BABIFDJJ"></a>Table 5-2 Data Dictionary Views Used for Rules and Rule Sets</p>
<table class="cellalignment1647" title="Data Dictionary Views Used for Rules and Rule Sets" summary="Rule Set Data Dictionary Views" dir="ltr">
<thead>
<tr class="cellalignment1639">
<th class="cellalignment1648" id="r1c1-t7">Data Dictionary View</th>
<th class="cellalignment1648" id="r1c2-t7">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1639">
<td class="cellalignment1646" id="r2c1-t7" headers="r1c1-t7">
<p><a href="views.htm#BABBAIHI">"DVSYS.DBA_DV_RULE View"</a></p>
</td>
<td class="cellalignment1646" headers="r2c1-t7 r1c2-t7">
<p>Lists the rules that have been defined</p>
</td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646" id="r3c1-t7" headers="r1c1-t7">
<p><a href="views.htm#BABIDJIF">"DVSYS.DBA_DV_RULE_SET View"</a></p>
</td>
<td class="cellalignment1646" headers="r3c1-t7 r1c2-t7">
<p>Lists the rules sets that have been created</p>
</td>
</tr>
<tr class="cellalignment1639">
<td class="cellalignment1646" id="r4c1-t7" headers="r1c1-t7">
<p><a href="views.htm#BABFBEIA">"DVSYS.DBA_DV_RULE_SET_RULE View"</a></p>
</td>
<td class="cellalignment1646" headers="r4c1-t7 r1c2-t7">
<p>Lists rules that are associated with existing rule sets</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1638">
<tr>
<td class="cellalignment1646">
<table class="cellalignment1643">
<tr>
<td class="cellalignment1642"><a href="cfrealms.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1642"><a href="cfcmdaut.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2006, 2016,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1650">
<table class="cellalignment1641">
<tr>
<td class="cellalignment1642"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1642"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1642"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1642"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1642"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1642"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
