<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Gathering Optimizer Statistics for Upgrading Oracle Database</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1023" />
<meta name="dcterms.created" content="2014-06-16T13:33:36Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Upgrade Guide" />
<meta name="dcterms.identifier" content="E23633-11" />
<meta name="dcterms.isVersionOf" content="UPGRD" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="changes.htm" title="Previous" type="text/html" />
<link rel="Next" href="index.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e23633.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">12/13</span> <!-- End Header -->
<div id="UPGRD104" class="appendix"><a id="BEIDEAGD"></a>
<h1 class="appendix"><span class="secnum">B</span> Gathering Optimizer Statistics for Upgrading Oracle Database</h1>
<p>Oracle provides scripts that <a id="sthref436"></a><a id="sthref437"></a><a id="sthref438"></a><a id="sthref439"></a>collect optimizer statistics for dictionary objects in Oracle Database. By running these scripts before performing the actual database upgrade, you can decrease the amount of downtime incurred during the database upgrade.</p>
<p>This process should be tested on a test database just like any other aspect of the upgrade. Also, some schemas referenced in these scripts might not exist if some database components have not been installed.</p>
<p>This appendix contains the following topics:</p>
<ul>
<li>
<p><a href="#CHDBFAJH">Collecting Statistics for System Component Schemas</a></p>
</li>
<li>
<p><a href="#CHDFEAHC">Creating a Statistics Table</a></p>
</li>
</ul>
<a id="CHDBFAJH"></a>
<div id="UPGRD12615" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Collecting Statistics for <a id="sthref440"></a><a id="sthref441"></a><a id="sthref442"></a>System Component Schemas</h2>
<p>If you are using Oracle9<span class="italic">i</span> Release 2 (9.2), then you should use the <code>DBMS_STATS.GATHER_SCHEMA_STATS</code> procedure to gather statistics. The following sample script uses this procedure to collect statistics for system component schemas.</p>
<p>To run this script, connect to the database <code>AS SYSDBA</code> using SQL*Plus.</p>
<pre>
spool gdict

grant analyze any to sys;

exec dbms_stats.gather_schema_stats('WMSYS',options=&gt;'GATHER', -
estimate_percent =&gt; DBMS_STATS.AUTO_SAMPLE_SIZE, -
method_opt =&gt; 'FOR ALL COLUMNS SIZE AUTO', cascade =&gt; TRUE);

exec dbms_stats.gather_schema_stats('MDSYS',options=&gt;'GATHER', -
estimate_percent =&gt; DBMS_STATS.AUTO_SAMPLE_SIZE, -
method_opt =&gt; 'FOR ALL COLUMNS SIZE AUTO', cascade =&gt; TRUE);

exec dbms_stats.gather_schema_stats('CTXSYS',options=&gt;'GATHER', -
estimate_percent =&gt; DBMS_STATS.AUTO_SAMPLE_SIZE, -
method_opt =&gt; 'FOR ALL COLUMNS SIZE AUTO', cascade =&gt; TRUE);

exec dbms_stats.gather_schema_stats('XDB',options=&gt;'GATHER', -
estimate_percent =&gt; DBMS_STATS.AUTO_SAMPLE_SIZE, -
method_opt =&gt; 'FOR ALL COLUMNS SIZE AUTO', cascade =&gt; TRUE);

exec dbms_stats.gather_schema_stats('WKSYS',options=&gt;'GATHER', -
estimate_percent =&gt; DBMS_STATS.AUTO_SAMPLE_SIZE, -
method_opt =&gt; 'FOR ALL COLUMNS SIZE AUTO', cascade =&gt; TRUE);

exec dbms_stats.gather_schema_stats('LBACSYS',options=&gt;'GATHER', -
estimate_percent =&gt; DBMS_STATS.AUTO_SAMPLE_SIZE, -
method_opt =&gt; 'FOR ALL COLUMNS SIZE AUTO', cascade =&gt; TRUE);

exec dbms_stats.gather_schema_stats('ORDSYS',options=&gt;'GATHER', -
estimate_percent =&gt; DBMS_STATS.AUTO_SAMPLE_SIZE, -
method_opt =&gt; 'FOR ALL COLUMNS SIZE AUTO', cascade =&gt; TRUE);

exec dbms_stats.gather_schema_stats('ORDPLUGINS',options=&gt;'GATHER', -
estimate_percent =&gt; DBMS_STATS.AUTO_SAMPLE_SIZE, -
method_opt =&gt; 'FOR ALL COLUMNS SIZE AUTO', cascade =&gt; TRUE);

exec dbms_stats.gather_schema_stats('SI_INFORMTN_SCHEMA',-
options=&gt;'GATHER', estimate_percent =&gt; DBMS_STATS.AUTO_SAMPLE_SIZE, -
method_opt =&gt; 'FOR ALL COLUMNS SIZE AUTO', cascade =&gt; TRUE);

exec dbms_stats.gather_schema_stats('OUTLN',options=&gt;'GATHER', -
estimate_percent =&gt; DBMS_STATS.AUTO_SAMPLE_SIZE, -
method_opt =&gt; 'FOR ALL COLUMNS SIZE AUTO', cascade =&gt; TRUE);

exec dbms_stats.gather_schema_stats('DBSNMP',options=&gt;'GATHER', -
estimate_percent =&gt; DBMS_STATS.AUTO_SAMPLE_SIZE, -
method_opt =&gt; 'FOR ALL COLUMNS SIZE AUTO', cascade =&gt; TRUE);

exec dbms_stats.gather_schema_stats('SYSTEM',options=&gt;'GATHER', -
estimate_percent =&gt; DBMS_STATS.AUTO_SAMPLE_SIZE, -
method_opt =&gt; 'FOR ALL COLUMNS SIZE AUTO', cascade =&gt; TRUE);

exec dbms_stats.gather_schema_stats('SYS',options=&gt;'GATHER', -
estimate_percent =&gt; DBMS_STATS.AUTO_SAMPLE_SIZE, -
method_opt =&gt; 'FOR ALL COLUMNS SIZE AUTO', cascade =&gt; TRUE);

spool off
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
The statistics collection might give errors if a particular component schema does not exist in the database. This can happen if a component is not installed or if it is invalid.</div>
</div>
<!-- class="sect1" -->
<a id="CHDFEAHC"></a>
<div id="UPGRD12616" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Creating a Statistics Table<a id="sthref443"></a><a id="sthref444"></a></h2>
<p>This script creates the table, <code>dictstattab</code>, and exports the statistics for the RDBMS component schemas into it. The export returns an error if a particular component schema does not exist in the database. This can happen if a component is not installed or if it is invalid.</p>
<p>This script is useful when you want to import the statistics back into the database. For example, the following PL/SQL subprograms import the statistics for the <code>SYS</code> schema after deleting the existing statistics:</p>
<pre>
EXEC <a id="sthref445"></a><a id="sthref446"></a>DBMS_STATS.DELETE_SCHEMA_STATS('SYS');
EXEC DBMS_STATS.IMPORT_SCHEMA_STATS('SYS','dictstattab');
</pre>
<p>To run the following script, connect to the database <code>AS SYSDBA</code> using SQL*Plus.</p>
<pre>
spool sdict

grant analyze any to sys;

exec dbms_stats.create_stat_table('SYS','dictstattab');

exec dbms_stats.export_schema_stats('WMSYS','dictstattab',statown =&gt; 'SYS');
exec dbms_stats.export_schema_stats('MDSYS','dictstattab',statown =&gt; 'SYS');
exec dbms_stats.export_schema_stats('CTXSYS','dictstattab',statown =&gt; 'SYS');
exec dbms_stats.export_schema_stats('XDB','dictstattab',statown =&gt; 'SYS');
exec dbms_stats.export_schema_stats('WKSYS','dictstattab',statown =&gt; 'SYS');
exec dbms_stats.export_schema_stats('LBACSYS','dictstattab',statown =&gt; 'SYS');
exec dbms_stats.export_schema_stats('ORDSYS','dictstattab',statown =&gt; 'SYS');
exec dbms_stats.export_schema_stats('ORDPLUGINS','dictstattab',statown =&gt; 'SYS');
exec dbms_stats.export_schema_stats('SI_INFORMTN_SCHEMA','dictstattab',statown =&gt; 'SYS');
exec dbms_stats.export_schema_stats('OUTLN','dictstattab',statown =&gt; 'SYS');
exec dbms_stats.export_schema_stats('DBSNMP','dictstattab',statown =&gt; 'SYS');
exec dbms_stats.export_schema_stats('SYSTEM','dictstattab',statown =&gt; 'SYS');
exec dbms_stats.export_schema_stats('SYS','dictstattab',statown =&gt; 'SYS');

spool off
</pre></div>
<!-- class="sect1" --></div>
<!-- class="appendix" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1653">
<tr>
<td class="cellalignment1660">
<table class="cellalignment1658">
<tr>
<td class="cellalignment1657"><a href="changes.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1657"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1662">
<table class="cellalignment1656">
<tr>
<td class="cellalignment1657"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1657"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1657"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1657"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1657"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1657"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
