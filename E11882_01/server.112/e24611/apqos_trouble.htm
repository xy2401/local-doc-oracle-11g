<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Troubleshooting Oracle Database QoS Management</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 050" />
<meta name="dcterms.created" content="2012-05-15T11:19:32Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Quality of Service Management User's Guide" />
<meta name="dcterms.identifier" content="E24611-02" />
<meta name="dcterms.isVersionOf" content="APQOS" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2010, 2012,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="apqos_admin.htm" title="Previous" type="text/html" />
<link rel="Next" href="glossary.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e24611.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">10/12</span> <!-- End Header --><a id="APQOS194"></a><a id="sthref729"></a>
<h1 class="chapter"><span class="secnum">5</span> Troubleshooting Oracle Database QoS Management</h1>
<p><a id="sthref730"></a>This chapter describes some problems you might encounter when using Oracle Database QoS Management and how you can resolve them. This chapter also describes how to locate the trace or log files for Oracle Database QoS Management.</p>
<p>This chapter contains the following sections:</p>
<ul>
<li>
<p><a href="#CIACAFJD">Common Problems</a></p>
</li>
<li>
<p><a href="#CIABHJFJ">Locating Log or Trace Files</a></p>
</li>
<li>
<p><a href="#CIAJGHCF">Enabling Tracing</a></p>
</li>
</ul>
<a id="CIACAFJD"></a><a id="APQOS195"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Common Problems</h2>
<p>After the initial configuration, Oracle Database Quality of Service Management is an automated system. As a result, most of the problems you might encounter are related to configuring Oracle Database QoS Management. The following sections illustrate the most common problems, and how to resolve them:</p>
<ul>
<li>
<p><a href="#CIAGEJFB">Cannot Enable Oracle Database Quality of Service Management</a></p>
</li>
<li>
<p><a href="#CIAJJGCA">Cannot Enable Oracle Database QoS Management for a Database</a></p>
</li>
<li>
<p><a href="#CIABIJAF">Oracle Database Resource Manager Not Enabled and Resource Plan Errors</a></p>
</li>
<li>
<p><a href="#CIAJHADH">Do Not Have Access to a Server Pool</a></p>
</li>
<li>
<p><a href="#CIAIBDHB">Server Pool Is Marked As Unmanageable</a></p>
</li>
<li>
<p><a href="#CIAEGEDE">Metrics Are Missing For a Performance Class</a></p>
</li>
<li>
<p><a href="#CIAGCHBI">Oracle Database QoS Management is not Generating Recommendations</a></p>
</li>
<li>
<p><a href="#CIADBDCH">Recently Added Server was Placed in the Wrong Server Pool</a></p>
</li>
</ul>
<a id="CIAGEJFB"></a><a id="APQOS305"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Cannot Enable Oracle Database Quality of Service Management</h3>
<p><a id="sthref731"></a><a id="sthref732"></a>Before you can enable Oracle Database QoS Management within a cluster, you must first create a Policy Set. To create a Policy Set, use the Create Policy Set link on the Oracle Enterprise Manager Database Control Cluster Administration page.</p>
</div>
<!-- class="sect2" -->
<a id="CIAJJGCA"></a><a id="APQOS306"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Cannot Enable Oracle Database QoS Management for a Database</h3>
<p><a id="sthref733"></a><a id="sthref734"></a><a id="sthref735"></a>For a database to be managed by Oracle Database QoS Management, the database must be compliant, enabled, and <a id="sthref736"></a><a id="sthref737"></a><a id="sthref738"></a><a id="sthref739"></a><a id="sthref740"></a>Oracle Database QoS Management must be able to access APPQOSSYS database user:</p>
<ul>
<li>
<p>A <span class="italic">compliant</span> database is an Oracle RAC database that is running Oracle Database release 11.2.0.2 or greater and is configured to run in a Policy-managed deployment.</p>
</li>
<li>
<p>For a database to be <span class="italic">enabled</span>, Oracle Database QoS Management must be able to connect to the database. The connection is configured when you select the <span class="bold">Enable Quality of Service Management</span> link in the Oracle Enterprise Manager Database Control Database Availability page. When you select this link, you are prompted for the cluster credentials and the password for the APPQOSSYS account in the database. By default the APPQOSSYS account is expired. When you submit a password, the account is unlocked.</p>
</li>
<li>
<p>If the password for the APPQOSSYS user is changed through other methods or the account is locked, then Oracle Database QoS Management is disabled for this database until this condition is corrected by selecting the <span class="bold">Enable Quality of Service Management</span> link again.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CIABIJAF"></a><a id="APQOS196"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Oracle Database Resource Manager Not Enabled and Resource Plan Errors</h3>
<p><a id="sthref741"></a><a id="sthref742"></a><a id="sthref743"></a><a id="sthref744"></a><a id="sthref745"></a>Oracle Database QoS Management installs a special Oracle Database Resource Manager plan whenever a database is enabled for management by Oracle Database QoS Management. Oracle Database QoS Management requires this resource plan to move Performance Classes to different levels of CPU scheduling. No other plan can be active while Oracle Database QoS Management is enabled on this database. If a resource plan is not enabled for the Oracle RAC database, then an error results when trying to enable the database for management by Oracle Database QoS Management. After a resource plan is enabled, then enabling the database for management by Oracle Database QoS Management succeeds.</p>
</div>
<!-- class="sect2" -->
<a id="CIAJHADH"></a><a id="APQOS197"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Do Not Have Access to a Server Pool</h3>
<div class="infobox-note">
<p class="notep1">Caution:</p>
By default, any named user may create a server pool. To restrict the operating system users that have this privilege, Oracle strongly recommends that you add specific users to the CRS Administrators list. See <a class="olink CWADD91105" href="../../rac.112/e41959/admin.htm#CWADD91105"><span class="italic">Oracle Clusterware Administration and Deployment Guide</span></a> for more information about adding users to the CRS Administrators list.</div>
<p><a id="sthref746"></a><a id="sthref747"></a><a id="sthref748"></a><a id="sthref749"></a><a id="sthref750"></a><a id="sthref751"></a><a id="sthref752"></a><a id="sthref753"></a>Server pools are a new Oracle Clusterware entity beginning in Oracle Grid Infrastructure 11<span class="italic">g</span> release 2. Server pools can be managed separately from the database by configuring special operating system groups. By default, the user that installed Oracle Grid Infrastructure for a cluster can perform operations on server pools. If you use a separate operating system for the Oracle Database installation, then execute permissions on a server pool must be granted to the database software owner before a database can be deployed in that server pool. To grant this permission, you must use the CRSCTL utility to modify the server pool ACL attribute. A database administrator can also create server pools using Server Control (SRVCTL) or Oracle Enterprise Manager.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink CWADD91700" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=CWADD91700"><span class="italic">Oracle Clusterware Administration and Deployment Guide</span></a> for information about <code>crsctl</code> commands</div>
</div>
<!-- class="sect2" -->
<a id="CIAIBDHB"></a><a id="APQOS307"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Server Pool Is Marked As Unmanageable</h3>
<p><a id="sthref754"></a><a id="sthref755"></a><a id="sthref756"></a><a id="sthref757"></a><a id="sthref758"></a><a id="sthref759"></a><a id="sthref760"></a>A server pool is marked as unmanageable if Oracle Database QoS Management is not able to properly measure or predict the performance of Performance Classes deployed in that server pool. A server pool can be considered unmanageable under the following conditions in Oracle Database 11<span class="italic">g</span> release 2 (11.2.0.2):</p>
<ol>
<li>
<p>The servers in the server pool have different physical CPU counts.</p>
</li>
<li>
<p>The CPU count for every database instance could not be retrieved.</p>
</li>
<li>
<p>The sum of the configured CPU counts for all database instances on a server is greater than its physical CPU count.</p>
</li>
<li>
<p>Singleton services are deployed in a server pool with a maximum size larger than one.</p>
</li>
<li>
<p>Oracle Database QoS Management is unable to collect the metrics for all Performance Classes, or the metrics collected do not contain valid data.</p>
</li>
<li>
<p>The server pool has a database that is not enabled for Oracle Database QoS Management.</p>
</li>
</ol>
<p>If a server is added to a server pool, then Oracle starts up instances and services on the new server for the policy-managed databases in the server pool. When an instance is started on the new server, Oracle checks the SPFILE of the existing instances for the <code>CPU_COUNT</code> setting, and uses this value for the new instance. By default, if there is no setting for <code>CPU_COUNT</code> in the SPFILE, then the instances on the new server will be started with <code>CPU_COUNT</code> set to the number of physical CPUs of the server. This is not a supported configuration and will result in the server pool being marked as unmanageable. Also, if you modify the <code>CPU_COUNT</code> parameter but do not store the change in the SPFILE, then the <code>CPU_COUNT</code> parameter might be set to the wrong value on the newly started instance resulting in a configuration violation.</p>
<p>Make sure the databases and database instances that you want to be managed by Oracle Database QoS Management conform to the requirements documented in <a href="wlm_strats.htm#BABDDCJH">"Supported Database Configurations"</a>.</p>
</div>
<!-- class="sect2" -->
<a id="CIAEGEDE"></a><a id="APQOS308"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Metrics Are Missing For a Performance Class</h3>
<p><a id="sthref761"></a><a id="sthref762"></a><a id="sthref763"></a><a id="sthref764"></a>Metrics are captured by Oracle Database QoS Management by querying the managed <a id="sthref765"></a><a id="sthref766"></a><a id="sthref767"></a>database instances in the cluster. Metrics are not be displayed under the following circumstances:</p>
<ol>
<li>
<p>The database requests (work being done) do not match the classifiers defined for a specific Performance Class and "No demand" is displayed.</p>
</li>
<li>
<p>A more general classifier of a Performance Class is evaluated first. As a result, the Performance Class with the more specific classifier is shown as having "No demand". For example, if the <code>sales_pc</code> Performance Class uses the classifier <code>service=Sales</code> and the <code>sales_search</code> Performance Class uses the classifier (<code>s</code><code>ervice=Sales and action=Search)</code>, then, if the <code>sales_pc</code> Performance Class was listed first in the Edit Policy Set Performance Class Order screen, then any work request that uses the <code>sales</code> service would be placed in the <code>sales_pc</code> Performance Class, including those that are performing the <code>Search</code> action. The <code>sales_search</code> Performance Class does not generate any metrics and "No demand" is displayed for that Performance Class.</p>
</li>
<li>
<p>The database instance is over-utilized and the metrics query reaches the time out limit and "Incomplete data" is displayed.</p>
</li>
<li>
<p>The database is not producing mutually consistent data for the Performance Class and "Nonconforming data" is displayed. For example a Performance Class that is classifying database requests that exceed one second will cause this response.</p>
</li>
<li>
<p>The metrics collected through the query do not pass the sanity verification checks performed by Oracle Database QoS Management and "Nonconforming data" is displayed.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CIAGCHBI"></a><a id="APQOS198"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Oracle Database QoS Management is not Generating Recommendations</h3>
<p><a id="sthref768"></a><a id="sthref769"></a>Recommendations are generated once a minute when logged into the Oracle Database QoS Management Dashboard (the Dashboard). Recommendations do not appear on the Dashboard in the following cases:</p>
<ol>
<li>
<p>Oracle Database QoS Management is disabled.</p>
</li>
<li>
<p>An action is in progress implementing a recommendation.</p>
</li>
<li>
<p>During the first minute of enabling Oracle Database QoS Management, or when submitting a Policy Set or activating a Policy Set.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CIADBDCH"></a><a id="APQOS199"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Recently Added Server was Placed in the Wrong Server Pool</h3>
<p><a id="sthref770"></a><a id="sthref771"></a><a id="sthref772"></a>Servers are moved within a cluster by Oracle Clusterware, or as directed by an administrator. When a new server joins the cluster, Oracle Clusterware places the server in a server pool according to the placement algorithm and the state of the server pool attributes of Min, Max and Importance. See the <a class="olink CWADD" href="../../rac.112/e41959/toc.htm"><span class="italic">Oracle Clusterware Administration and Deployment Guide</span></a> for a complete description of this placement process.</p>
</div>
<!-- class="sect2" -->
<a id="APQOS347"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref773"></a>
<h3 class="sect2">RMI Port Conflict Detected</h3>
<p><a id="sthref774"></a><a id="sthref775"></a><a id="sthref776"></a><a id="sthref777"></a><a id="sthref778"></a><a id="sthref779"></a>When you install Oracle Grid Infrastructure for a cluster, the default port for the Oracle Application Server Containers for J2EE (OC4J) resource is set to 23792. This can cause a port conflict with Java Remote Method Invocation (RMI). You should set the <code>OC4J_PORT</code> environment variable in your environment to the number of an available port, then restart the OC4J resource using the following commands:</p>
<pre>
srvctl modify oc4j -p <span class="italic">port</span>
srvctl stop oc4j
srvctl start oc4j
</pre></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CIABHJFJ"></a><a id="APQOS200"></a>
<div class="sect1">
<h2 class="sect1">Locating Log or Trace Files</h2>
<p><a id="sthref780"></a><a id="sthref781"></a><a id="sthref782"></a><a id="sthref783"></a>The log files for Oracle Database QoS Management are located in the Oracle Grid Infrastructure home directory:</p>
<ul>
<li>
<p>The Oracle Database QoS Management server operations log file is located at <code><span class="codeinlineitalic">Grid_home</span></code><code>/oc4j/j2ee/home/log/dbwlm/auditing/log.xml</code></p>
</li>
<li>
<p>The Oracle Database QoS Management server trace log file is located at <code><span class="codeinlineitalic">Grid_home</span></code><code>/oc4j/j2ee/home/log/dbwlm/logging/log.xml</code></p>
</li>
<li>
<p>The OC4J standard out log file and the trace file for the Server Manager (SRVM) component of Oracle Clusterware is located at <code><span class="codeinlineitalic">Grid_home</span></code><code>/oc4j/j2ee/home/log/oc4j_</code><code><span class="codeinlineitalic">&lt;timestamp&gt;</span></code><code>.out</code></p>
</li>
<li>
<p>The OC4J standard error log file is located at <code><span class="codeinlineitalic">Grid_home</span></code><code>/oc4j/j2ee/home/log/oc4j_</code><code><span class="codeinlineitalic">&lt;timestamp&gt;</span></code><code>.err</code></p>
</li>
<li>
<p>The start and stop log file for the DBWLM component of Oracle Database QoS Management is located at <code><span class="codeinlineitalic">Grid_home</span></code><code>/oc4j/j2ee/home/log/dbwlm.log</code></p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="CIAJGHCF"></a><a id="APQOS201"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Enabling Tracing</h2>
<p><a id="sthref784"></a><a id="sthref785"></a>A default level of tracing is set at installation time. Finer-grained tracing may be enabled under the direction of Oracle Support.</p>
</div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1710">
<tr>
<td class="cellalignment1717">
<table class="cellalignment1715">
<tr>
<td class="cellalignment1714"><a href="apqos_admin.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1714"><a href="glossary.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2010, 2012,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1719">
<table class="cellalignment1713">
<tr>
<td class="cellalignment1714"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1714"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1714"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1714"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1714"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1714"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
