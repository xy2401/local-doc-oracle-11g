<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Supported Workloads and Strategies</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 050" />
<meta name="dcterms.created" content="2012-05-15T11:19:30Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Quality of Service Management User's Guide" />
<meta name="dcterms.identifier" content="E24611-02" />
<meta name="dcterms.isVersionOf" content="APQOS" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2010, 2012,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="apqos_intro.htm" title="Previous" type="text/html" />
<link rel="Next" href="install_config.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e24611.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">7/12</span> <!-- End Header --><a id="APQOS142"></a><a id="sthref208"></a>
<h1 class="chapter"><span class="secnum">2</span> Supported Workloads and Strategies</h1>
<p>This chapter discusses the different ways that you can use Oracle Database Quality of Service Management (Oracle Database QoS Management) to manage the workload on your system and the best practices for configuring your system to effectively use Oracle Database QoS Management.</p>
<p>This chapter contains the following sections:</p>
<ul>
<li>
<p><a href="#BABEBIDF">Supported Configurations for Oracle Database QoS Management</a></p>
</li>
<li>
<p><a href="#BABIDCEB">Strategies for Creating Classifiers for Performance Classes</a></p>
</li>
<li>
<p><a href="#BABFJADE">Configuration Strategies for Effective Resource Management</a></p>
</li>
<li>
<p><a href="#BABJCJJG">Sample Implementation of Oracle Database QoS Management</a></p>
</li>
<li>
<p><a href="#BABDBCHH">Creating Oracle Database QoS Management Performance Policies for the Demo System</a></p>
</li>
<li>
<p><a href="#BABIAABD">Managing Service Levels with Oracle Database QoS Management</a></p>
</li>
</ul>
<a id="BABEBIDF"></a><a id="APQOS339"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Supported Configurations for Oracle Database QoS Management</h2>
<p><a id="sthref209"></a><a id="sthref210"></a><a id="sthref211"></a><a id="sthref212"></a>To use Oracle Database QoS Management, your system must meet certain requirements. Also, your applications and database connections must conform to certain standards. If you do not use a supported configuration, then Oracle Database QoS Management reports a configuration violation and is disabled.</p>
<p>The following section discuss the configuration requirements for using Oracle Database QoS Management:</p>
<ul>
<li>
<p><a href="#BABEGFJE">Supported Server Pool Configurations</a></p>
</li>
<li>
<p><a href="#BABDDCJH">Supported Database Configurations</a></p>
</li>
<li>
<p><a href="#BABDEIHA">Supported Service Configurations</a></p>
</li>
<li>
<p><a href="#BABEGIFD">Supported Workload and Objective Types</a></p>
</li>
</ul>
<a id="BABEGFJE"></a><a id="APQOS340"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Supported Server Pool Configurations</h3>
<p>Oracle Database QoS Management <a id="sthref213"></a><a id="sthref214"></a><a id="sthref215"></a>requires that your cluster and databases use server pools. Databases in the Generic pool cannot be managed by Oracle Database QoS Management and are not visible in the user interface. Servers in the Free pool can be used to provide additional resources to managed server pools.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
By default, any named user may create a server pool. To restrict the operating system users that have this privilege, Oracle strongly recommends that you add specific users to the CRS Administrators list. See <a class="olink CWADD91105" href="../../rac.112/e41959/admin.htm#CWADD91105"><span class="italic">Oracle Clusterware Administration and Deployment Guide</span></a> for more information about adding users to the CRS Administrators list.</div>
<p><a id="sthref216"></a><a id="sthref217"></a><a id="sthref218"></a>Before Oracle Database QoS Management can manage the resources for your cluster, you must mark server pools as managed in your Performance Policy. If a server pool is not managed by Oracle Database QoS Management, then the server pool is not visible to the Oracle Database QoS Management server. Any workloads or resources in the unmarked server pools are not managed by Oracle Database QoS Management.</p>
<p><a id="sthref219"></a><a id="sthref220"></a><a id="sthref221"></a><a id="sthref222"></a><a id="sthref223"></a>You can select server pools to be managed by Oracle Database QoS Management even if they do not contain any database instances, or have a current size of zero. This enables you to preconfigure a server pool for management by Oracle Database QoS Management before the workload is started. Also, if you configure a server pool to have a minimum size of zero, then Oracle Database QoS Management can remove the servers from that server pool to provide resources for higher priority workloads. In this case, even though there are no resources within the server pool for Oracle Database QoS Management to manage, the server pool any workloads that run in that server pool are still monitored and, and if possible, resources are allocated to that server pool to support the workloads.</p>
</div>
<!-- class="sect2" -->
<a id="BABDDCJH"></a><a id="APQOS341"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Supported Database Configurations</h3>
<p><a id="sthref224"></a><a id="sthref225"></a><a id="sthref226"></a><a id="sthref227"></a><a id="sthref228"></a><a id="sthref229"></a>Oracle Database QoS Management only works with Oracle RAC databases of release 11.2.0.2 or higher. The databases must be configured as policy-managed databases that run in server pools. The underlying server pools used by the database instances must be marked as managed by Oracle Database QoS Management.</p>
<p>Database services <a id="sthref230"></a><a id="sthref231"></a><a id="sthref232"></a><a id="sthref233"></a><a id="sthref234"></a><a id="sthref235"></a>should be created as <code>UNIFORM</code> services, meaning the service is offered by every available instance running in the specified server pool. If your application requires a <code>SINGLETON</code> service, then, to use Oracle Database QoS Management, the service must run in a server pool that has a maximum size of one. If you use a <code>SINGLETON</code> service in a server pool that has a maximum size greater than one, then Oracle Database QoS Management reports a configuration violation.</p>
<p><a id="sthref236"></a><a id="sthref237"></a><a id="sthref238"></a><a id="sthref239"></a><a id="sthref240"></a><a id="sthref241"></a>Oracle Database QoS Management supports multiple databases sharing a server pool. If you have multiple databases using the same server pool, then every database that uses the server pool must have Oracle Database QoS Management enabled. Oracle Database QoS Management also supports Oracle RAC One Node databases (sometimes referred to as <span class="italic">singleton databases</span>), but these databases must use server pools that have a maximum size of one.</p>
<p><a id="sthref242"></a><a id="sthref243"></a><a id="sthref244"></a><a id="sthref245"></a><a id="sthref246"></a>When you create a database, the default value of the <code>CPU_COUNT</code> initialization parameter for the database instance is set to the value of the number of physical CPUs on each node that the instance runs on. If you have multiple database instances on the same node, then you must adjust the value of <code>CPU_COUNT</code> for each instance so that the sum of <code>CPU_COUNT</code> for each instance that runs on the node is equal to or less than the physical number of CPUs on that node. Also, the value of <code>CPU_COUNT</code> must be the same for every instance of a database. For example, for the <code>sales</code> database, you cannot have <code>CPU_COUNT</code> set to four for the <code>sales1</code> instance and <code>CPU_COUNT</code> set to two for the <code>sales2</code> instance if both instances are in the same server pool.</p>
</div>
<!-- class="sect2" -->
<a id="BABDEIHA"></a><a id="APQOS342"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Supported Service Configurations</h3>
<p><a id="sthref247"></a><a id="sthref248"></a><a id="sthref249"></a><a id="sthref250"></a><a id="sthref251"></a><a id="sthref252"></a><a id="sthref253"></a>Database services that are managed by Oracle Clusterware are required for Oracle Database QoS Management. All workloads managed by Oracle Database QoS Management must connect to the database using a database service that is managed by Oracle Clusterware. You cannot use the default database service; the default database service is not managed by Oracle Clusterware.</p>
<p><a id="sthref254"></a><a id="sthref255"></a><a id="sthref256"></a><a id="sthref257"></a><a id="sthref258"></a>The services used to connect to the database should be <code>UNIFORM</code>. If your application requires a <code>SINGLETON</code> service, then, to use Oracle Database QoS Management, the service must run in a server pool that has a maximum size of one.</p>
<p><a id="sthref259"></a><a id="sthref260"></a><a id="sthref261"></a><a id="sthref262"></a><a id="sthref263"></a>The Oracle RAC high availability framework monitors the database and its services and sends event notifications using fast application notification (FAN). Oracle Clusterware and Oracle Net Services provide load balancing for services according to rules specified in the service configuration. These rules are:</p>
<ul>
<li>
<p><a id="sthref264"></a><a id="sthref265"></a><a id="sthref266"></a><a id="sthref267"></a>The <span class="bold">connection load balancing goal</span>: Connections are routed to an instance using the current workload for that instance and the type of connection (<code>LONG</code> or <code>SHORT</code>) to determine which instance can provide the best performance. For Oracle Database QoS Management, the connection load balancing goal should be set to <code>LONG</code>, so that if a new server is allocated to a server pool for a service, new connections will migrate faster to the new server. By migrating connections more quickly to a new server, the workload is balanced faster across all the available instances and the response times for workloads improve at a faster rate.</p>
</li>
<li>
<p><a id="sthref268"></a><a id="sthref269"></a><a id="sthref270"></a><a id="sthref271"></a><a id="sthref272"></a><a id="sthref273"></a><a id="sthref274"></a><a id="sthref275"></a>The <span class="bold">run-time connection load balancing goal</span>: The load balancing advisory data is used to determine which instance best meets the goal specified for the service. The two goals are <code>SERVICE_TIME</code>, for which load balancing advisory data is based on elapsed time for work done in the instance, and <code>THROUGHPUT</code>, for which the load balancing advisory data is based on the rate that work is completed in the instance. For Oracle Database QoS Management, the run-time connection load balancing goal should be set to <code>SERVICE_TIME</code> for all database services that use server pools except optionally those with a maximum size of one.</p>
</li>
</ul>
<p><a id="sthref276"></a><a id="sthref277"></a>Run-time connection load balancing sends advice to connection pools on how to balance connection requests across instances in an Oracle RAC database. The load balancing advisory also provides advice about how to direct incoming work to the instances that provide the optimal quality of service for that work. This minimizes the need to relocate the work later.</p>
<p><a id="sthref278"></a><a id="sthref279"></a><a id="sthref280"></a><a id="sthref281"></a><a id="sthref282"></a>To configure the load balancing goals for a service, use the Server Control (SRVCTL) utility, as shown in the following example, or use Enterprise Manager:</p>
<pre>
srvctl modify service -d <span class="italic">db_name</span> -s <span class="italic">service_name</span> -B SERVICE_TIME -j LONG
</pre></div>
<!-- class="sect2" -->
<a id="BABEGIFD"></a><a id="APQOS343"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Supported Workload and Objective Types</h3>
<p><a id="sthref283"></a><a id="sthref284"></a><a id="sthref285"></a><a id="sthref286"></a><a id="sthref287"></a><a id="sthref288"></a><a id="sthref289"></a>In the initial release of Oracle Database QoS Management, only online transaction processing (OLTP) workloads are supported. The only supported Performance Objective is average response time for database requests. Oracle Database QoS Management is designed to manage open workloads, or a workload in which demand is independent of the response time.</p>
<p><a id="sthref290"></a><a id="sthref291"></a><a id="sthref292"></a><a id="sthref293"></a><a id="sthref294"></a>The database requests for your application workload must have an average response time of less than one second, and preferably, an average response time of less than 0.5 seconds. Each database request within a Performance Class should be homogenous with respect to resource usage. If a subset of the database requests in a workload use significantly more resources than the other requests, then you should create a new Performance Class to contain the database requests that require more resources. See <a href="apqos_intro.htm#CHDFHEGE">"Deciding to Create New Performance Classes"</a>.</p>
<p><a id="sthref295"></a><a id="sthref296"></a><a id="sthref297"></a><a id="sthref298"></a>Oracle Database QoS Management does not support workloads that involve parallel queries. By default, parallel queries run on all available instances of the database, regardless of which service was used to connect to the database. This means that the workload is not contained, or restrained to running on only those instances that offer the service. For a similar reason, Oracle Database QoS Management does not support workloads that involve a significant amount of database requests involving queries to GV$ views.</p>
<p><a id="sthref299"></a><a id="sthref300"></a><a id="sthref301"></a><a id="sthref302"></a><a id="sthref303"></a><a id="sthref304"></a>For a workload to be managed by Oracle Database QoS Management, the database connections must use a database service that is managed by Oracle Clusterware. <a id="sthref305"></a><a id="sthref306"></a><a id="sthref307"></a><a id="sthref308"></a><a id="sthref309"></a><a id="sthref310"></a>The client or application that initiates the connection must be a JDBC (thick or thin) client, or an OCI client. Workloads that use a bequeath connection to the database are not managed by Oracle Database QoS Management.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABIDCEB"></a><a id="APQOS344"></a>
<div class="sect1">
<h2 class="sect1">Strategies for Creating Classifiers for Performance Classes</h2>
<p><a id="sthref311"></a><a id="sthref312"></a><a id="sthref313"></a><a id="sthref314"></a>Currently, the only workloads that Oracle Database QoS Management manages are OLTP database workloads. To manage the workload for a database, the incoming work requests must be assigned to a Performance Class. Workload is mapped to a Performance Class using classifiers.</p>
<p><a id="sthref315"></a><a id="sthref316"></a><a id="sthref317"></a><a id="sthref318"></a><a id="sthref319"></a>In multi-tier environments, a request from a client is routed to different database sessions by the middle tier or through load balancing, making the tracking of a client across database sessions difficult. Classifiers use session attributes to identify work requests. The attributes used are service name, user name, module, action, and program. See <a href="apqos_intro.htm#CHDIJAJD">"Using Additional Filters for Classifying Work Requests"</a>.</p>
<p><a id="sthref320"></a><a id="sthref321"></a>Each classifier must specify one or more service names. If a classifier specifies multiple service names, then when matching the connection data to a Performance Class, the service names are evaluated using an <code>OR</code> operation. This means that if any one of the service names specified in the classifier matches the service name in the work request, then the comparison evaluates to <code>TRUE</code>.</p>
<p><a id="sthref322"></a><a id="sthref323"></a><a id="sthref324"></a><a id="sthref325"></a><a id="sthref326"></a><a id="sthref327"></a><a id="sthref328"></a><a id="sthref329"></a><a id="sthref330"></a>To set the <code>MODULE</code> and <code>ACTION</code> attributes, use the <code>OCIAttrSet()</code> call. Use the default namespace, <code>USERENV</code>, for the application context.</p>
<p><a id="sthref331"></a><a id="sthref332"></a><a id="sthref333"></a><a id="sthref334"></a><a id="sthref335"></a><a id="sthref336"></a><a id="sthref337"></a>You can also optionally include the <a href="glossary.htm#BGBHEGJF"><span class="xrefglossterm">UserName</span></a> and <a href="glossary.htm#BGBCCCFA"><span class="xrefglossterm">program name</span></a> in the classifier. The user name is the name of the database user to which the session connects. The program attribute is the name of the client program used to log in to the server.</p>
<p><a id="sthref338"></a><a id="sthref339"></a><a id="sthref340"></a><a id="sthref341"></a>If the classifier for a Performance Class specifies multiple attributes, then the session attributes are combined using an <code>AND</code> operation. This means that if all of the attribute values specified in the classifier match the session attribute values in the work request, then the comparison evaluates to <code>TRUE</code>. If you have more than one classifier that uses similar attribute values, then place the classifier with the most fine-grained conditions first. See <a href="apqos_intro.htm#CHDICBHH">"Applying Classifiers to Work Requests"</a>.</p>
<p>For example, consider the following classifiers:</p>
<ul>
<li>
<p><code>create_invoice_taxes_pc</code> that specifies the <code>sales_cart</code> service, the <code>ORDER</code> module, and the <code>CALCULATE TAX</code> action</p>
</li>
<li>
<p><code>create_invoice_pc</code>, which specifies the <code>sales_cart</code> service and the <code>ORDER</code> module</p>
</li>
</ul>
<p>The <code>create_invoice_taxes_pc</code> classifier should be evaluated before the <code>create_invoice_pc</code> classifier. If a work request uses the <code>sales_cart</code> service, and is performing the <code>CALCULATE TAX</code> action in the <code>ORDER</code> module, then the work request is assigned to the <code>create_invoice_taxes_pc</code>. If the work request does not have the matching values for all the attributes, then the work request is compared to the next classifier, for <code>create_invoice_pc</code>. If you evaluate the <code>create_invoice_pc</code> classifier first, then any work request that uses the <code>sales_cart</code> service and the <code>ORDER</code> module will be assigned to the <code>create_invoice_pc</code> Performance Class, regardless of what action the work request performs.</p>
<p><a id="sthref342"></a><a id="sthref343"></a><a id="sthref344"></a><a id="sthref345"></a>You can create up to 47 Performance Classes for a cluster. If you have more than 47 services for your cluster, then use more than one service name within classifiers. Once a match is found for a classifier, Oracle Database QoS Management assigns a tag to the matching work request. The tag is based on the classifier that evaluates to <code>TRUE</code>. See <a href="apqos_intro.htm#CHDGIFCC">"Performance Class Tags"</a>.</p>
</div>
<!-- class="sect1" -->
<a id="BABFJADE"></a><a id="APQOS144"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Configuration Strategies for Effective Resource Management</h2>
<p><a id="sthref346"></a><a id="sthref347"></a><a id="sthref348"></a>This section discusses key configuration recommendations and requirements for systems that are managed by Oracle Database QoS Management. The topics included in this section are:</p>
<ul>
<li>
<p><a href="#BABJDGHD">About Resource Bottlenecks</a></p>
</li>
<li>
<p><a href="#BABEHIFB">CPU Resource Bottlenecks</a></p>
</li>
<li>
<p><a href="#BABCFHEB">Configuration Recommendations for Global Cache Resource Bottlenecks</a></p>
</li>
<li>
<p><a href="#BABFCFDF">Configuration Recommendations for I/O Resource Bottlenecks</a></p>
</li>
<li>
<p><a href="#BABEAJAH">Configuration Recommendations for Other Types of Bottlenecks</a></p>
</li>
</ul>
<a id="BABJDGHD"></a><a id="APQOS145"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">About Resource Bottlenecks</h3>
<p><a id="sthref349"></a><a id="sthref350"></a><a id="sthref351"></a>Oracle Database QoS Management measures use and wait times for CPU, Global Cache, I/O, and other resources to determine where a bottleneck is located. The target Performance Class and its bottle-necked resource are identified on the Oracle Database QoS Management Dashboard (the Dashboard), however, only the CPU resource is actively managed in this release. The following sections describe how Oracle Database QoS Management responds to bottlenecks in each resource type and what configuration strategies are recommended.</p>
</div>
<!-- class="sect2" -->
<a id="BABEHIFB"></a><a id="APQOS276"></a>
<div class="sect2">
<h3 class="sect2">CPU Resource Bottlenecks</h3>
<p><a id="sthref352"></a><a id="sthref353"></a><a id="sthref354"></a><a id="sthref355"></a>A CPU resource bottleneck is detected when there are excessive wait times on the collection of CPU queues running that workload. Oracle Database QoS Management offers recommendations you can implement to relieve the bottleneck.</p>
<p>One solution to this type of bottleneck is to increase the number of opportunities for the workload to run on the CPU. Oracle Database QoS Management implements this solution by assigning the workload to a consumer group that has more CPU shares across the server pool.</p>
<p>Another solution is to provide more CPU resources. If you have multiple instances sharing the CPU resources for each server in the server pool, and you have implemented instance caging, then Oracle Database QoS Management can suggest altering the CPU counts for the instances in the server pool; this solution gives more CPU resources to the workloads that are not meeting performance expectations by taking CPU resources away from an instance that is of lower rank or has the headroom to contribute the resources.</p>
<p>If there is a CPU resource bottleneck that cannot be relieved by adjusting the CPU counts between instances, then Oracle Database QoS Management can recommend moving a new server into the server pool. The server can come from the Free pool, from a less-stressed server pool, or from a server pool that hosts a less critical workload.</p>
</div>
<!-- class="sect2" -->
<a id="BABCFHEB"></a><a id="APQOS277"></a>
<div class="sect2">
<h3 class="sect2">Configuration Recommendations for Global Cache Resource Bottlenecks</h3>
<p><a id="sthref356"></a><a id="sthref357"></a><a id="sthref358"></a><a id="sthref359"></a>A Global Cache resource bottleneck is detected when there is excessive data block movement between database instances. This is usually caused by an application that is not configured properly or is not able to scale horizontally. Configuring the application to run in a server pool with a maximum size of one or partitioning the data can usually relieve the bottleneck.</p>
<p>Oracle Database QoS Management cannot perform either of these actions in this release and does not provide a recommendation that can be implemented for this type of bottleneck.</p>
</div>
<!-- class="sect2" -->
<a id="BABFCFDF"></a><a id="APQOS278"></a>
<div class="sect2">
<h3 class="sect2">Configuration Recommendations for I/O Resource Bottlenecks</h3>
<p><a id="sthref360"></a><a id="sthref361"></a><a id="sthref362"></a><a id="sthref363"></a><a id="sthref364"></a>An I/O resource bottleneck is detected when there are excessive wait times on the storage subsystem. This type of bottleneck is typically caused by either too few disk spindles or not enough network bandwidth on the storage interconnect. To resolve this bottleneck, spread the database files across a higher number of disks, or configure a separate network interface card (NIC) for a dedicated storage interconnect.</p>
<p>Oracle Database QoS Management cannot resolve this type of bottleneck in this release and does not provide a recommendation that can be implemented.</p>
</div>
<!-- class="sect2" -->
<a id="BABEAJAH"></a><a id="APQOS279"></a>
<div class="sect2">
<h3 class="sect2">Configuration Recommendations for Other Types of Bottlenecks</h3>
<p><a id="sthref365"></a><a id="sthref366"></a><a id="sthref367"></a><a id="sthref368"></a><a id="sthref369"></a><a id="sthref370"></a><a id="sthref371"></a><a id="sthref372"></a><a id="sthref373"></a>The last resource type used to categorize bottlenecks, Other, is used for all other wait times. These database wait times are usually caused by SQL performance issues that result from an application that is not optimized, waiting on latches, and so on. These bottlenecks can be investigated using Oracle Database tuning tools such as Automatic Workload Repository (AWR) and Automatic Database Diagnostic Monitor (ADDM).</p>
<p>Resolving these types of bottlenecks are outside the scope of the run-time system management provided by Oracle Database QoS Management and Oracle Database QoS Management does not provide any recommendations that can be implemented</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABJCJJG"></a><a id="APQOS143"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Sample Implementation of Oracle Database QoS Management</h2>
<p>This section describes a sample implementation of Oracle Database QoS Management. The process by which Oracle Database QoS Management manages performance is described. This section contains the following topics:</p>
<ul>
<li>
<p><a href="#BABCBBJB">Description of the Demo System</a></p>
</li>
<li>
<p><a href="#BABIDHIC">Description of the System Workload</a></p>
</li>
<li>
<p><a href="#BABBIJIA">Initial Oracle Database QoS Management Configuration</a></p>
</li>
</ul>
<a id="BABCBBJB"></a><a id="APQOS273"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Description of the Demo System</h3>
<p>The sample implementation uses a four-node cluster running on Linux. The nodes are named <code>test_rac1</code> to <code>test_rac4</code>. In normal operation, each node does the following:</p>
<div class="inftblinformal">
<table class="cellalignment1722" title="Demo System Node Configuration" summary="Explains the primary function of each node in the cluster." dir="ltr">
<thead>
<tr class="cellalignment1711">
<th class="cellalignment1723" id="r1c1-t3">Node</th>
<th class="cellalignment1723" id="r1c2-t3">Purpose</th>
<th class="cellalignment1723" id="r1c3-t3">Services</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1711">
<td class="cellalignment1717" id="r2c1-t3" headers="r1c1-t3">test_rac1</td>
<td class="cellalignment1717" headers="r2c1-t3 r1c2-t3">Runs Oracle Grid Infrastructure for a cluster and the first database instance for the <code>backoffice</code> database</td>
<td class="cellalignment1717" headers="r2c1-t3 r1c3-t3">HR and ERP</td>
</tr>
<tr class="cellalignment1711">
<td class="cellalignment1717" id="r3c1-t3" headers="r1c1-t3">test_rac2</td>
<td class="cellalignment1717" headers="r3c1-t3 r1c2-t3">Runs Oracle Grid Infrastructure for a cluster and the second database instance for the <code>backoffice</code> database</td>
<td class="cellalignment1717" headers="r3c1-t3 r1c3-t3">HR and ERP</td>
</tr>
<tr class="cellalignment1711">
<td class="cellalignment1717" id="r4c1-t3" headers="r1c1-t3">test_rac3</td>
<td class="cellalignment1717" headers="r4c1-t3 r1c2-t3">Runs Oracle Grid Infrastructure for a cluster and the first database instance for the <code>online</code> database</td>
<td class="cellalignment1717" headers="r4c1-t3 r1c3-t3">Sales and Sales_Cart</td>
</tr>
<tr class="cellalignment1711">
<td class="cellalignment1717" id="r5c1-t3" headers="r1c1-t3">test_rac4</td>
<td class="cellalignment1717" headers="r5c1-t3 r1c2-t3">Runs Oracle Grid Infrastructure for a cluster and the second database instance for the <code>online</code> database</td>
<td class="cellalignment1717" headers="r5c1-t3 r1c3-t3">Sales and Sales_Cart</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p>The cluster is logically divided into two server pools with the following constraints:</p>
<div class="inftblinformal">
<table class="cellalignment1722" summary="Server pool settings for demo system" dir="ltr">
<thead>
<tr class="cellalignment1711">
<th class="cellalignment1723" id="r1c1-t4">Name</th>
<th class="cellalignment1723" id="r1c2-t4">Min Size</th>
<th class="cellalignment1723" id="r1c3-t4">Max Size</th>
<th class="cellalignment1723" id="r1c4-t4">Current Size</th>
<th class="cellalignment1723" id="r1c5-t4">Importance</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1711">
<td class="cellalignment1717" id="r2c1-t4" headers="r1c1-t4">backoffice</td>
<td class="cellalignment1717" headers="r2c1-t4 r1c2-t4">1</td>
<td class="cellalignment1717" headers="r2c1-t4 r1c3-t4">-1</td>
<td class="cellalignment1717" headers="r2c1-t4 r1c4-t4">2</td>
<td class="cellalignment1717" headers="r2c1-t4 r1c5-t4">1</td>
</tr>
<tr class="cellalignment1711">
<td class="cellalignment1717" id="r3c1-t4" headers="r1c1-t4">online</td>
<td class="cellalignment1717" headers="r3c1-t4 r1c2-t4">1</td>
<td class="cellalignment1717" headers="r3c1-t4 r1c3-t4">-1</td>
<td class="cellalignment1717" headers="r3c1-t4 r1c4-t4">2</td>
<td class="cellalignment1717" headers="r3c1-t4 r1c5-t4">2</td>
</tr>
<tr class="cellalignment1711">
<td class="cellalignment1717" id="r4c1-t4" headers="r1c1-t4">Free</td>
<td class="cellalignment1717" headers="r4c1-t4 r1c2-t4">0</td>
<td class="cellalignment1717" headers="r4c1-t4 r1c3-t4">-1</td>
<td class="cellalignment1717" headers="r4c1-t4 r1c4-t4">0</td>
<td class="cellalignment1717" headers="r4c1-t4 r1c5-t4">0</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p><a id="sthref374"></a>The server pool constraints as shown here guarantee that at least one server is allocated to each of the server pools (and the databases that run in those server pools) and the remaining servers can be shared on a demand basis to manage service levels. The <code>online</code> server pool hosts the most critical workloads, because it has the highest value for Importance. If a server failure occurs, then maintaining the minimum size for the <code>online</code> server pool takes priority over maintaining the minimum size of the other server pools.</p>
</div>
<!-- class="sect2" -->
<a id="BABIDHIC"></a><a id="APQOS274"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Description of the System Workload</h3>
<p><a id="sthref375"></a>This release of Oracle Database QoS Management focuses on managing OLTP workloads, which are the type most likely to have an <a href="glossary.htm#BGBBGHJE"><span class="xrefglossterm">open workload</span></a> (workloads for which demand remains constant even as system performance degrades) and be vulnerable to outages due to workload surges. For this demonstration, we assume there is a combination of internal and external workloads hosted in the same cluster so the resources can be shared.</p>
<p>There are four types of workloads demonstrated for this demo system, as illustrated in <a href="#BEIEHCDD">Figure 2-1</a>:</p>
<ul>
<li>
<p>An ERP application based on J2EE that connects to the database instances in the <code>backoffice</code> server pool using the <code>ERP</code> service</p>
</li>
<li>
<p>An internal HR application based on Oracle C Interface (OCI) that connects to the database instances in the <code>backoffice</code> server pool using the <code>HR</code> service</p>
</li>
<li>
<p>An external Sales application based on J2EE that connects to the database instances in the <code>online</code> server pool using the <code>Sales</code> service</p>
</li>
<li>
<p>An external Sales checkout application (Sales Cart) based on J2EE that connects to database instances through a specific database user in the <code>online</code> server pool using the <code>Sales</code> service</p>
</li>
</ul>
<div class="figure">
<p class="titleinfigure"><a id="BEIEHCDD"></a><a id="APQOS345"></a>Figure 2-1 Illustration of a Sample Workload</p>
<img width="507" height="389" src="img/apqos001.gif" alt="Description of Figure 2-1 follows" /><br />
<a id="sthref376" href="img_text/apqos001.htm">Description of "Figure 2-1 Illustration of a Sample Workload"</a><br />
<br /></div>
<!-- class="figure" -->
<p>By using two server pools the workloads and their dependent databases are logically separated but can readily share resources between them.</p>
</div>
<!-- class="sect2" -->
<a id="BABBIJIA"></a><a id="APQOS275"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Initial Oracle Database QoS Management Configuration</h3>
<p><a id="sthref377"></a><a id="sthref378"></a>At first, there is no Oracle Database QoS Management configured for this system. Using Oracle Enterprise Manager Database Control, there are two configuration workflows to complete to enable Oracle Database QoS Management for the cluster. The first workflow configures each database for Oracle Database QoS Management and the second workflow configures and enables Oracle Database QoS Management for the cluster.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="install_config.htm#CBDDDFBE">"Enabling Oracle Database QoS Management"</a> for details on enabling Oracle Database QoS Management</div>
<p><a id="sthref379"></a><a id="sthref380"></a><a id="sthref381"></a><a id="sthref382"></a>After you create a default Policy Set, using the database services that are discovered automatically, Oracle Database QoS Management can be fine-tuned to align the workloads with their respective service-level agreements or objectives.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABDBCHH"></a><a id="APQOS280"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Creating Oracle Database QoS Management Performance Policies for the Demo System</h2>
<p><a id="sthref383"></a><a id="sthref384"></a>In this section, the sample implementation of Oracle Database QoS Management is further evolved to include creating and activating Performance Policies and refining them with additional Performance Classes.</p>
<p><a id="sthref385"></a><a id="sthref386"></a><a id="sthref387"></a><a id="sthref388"></a><a id="sthref389"></a><a id="sthref390"></a>Because the default Performance Policy is created by discovering the database services in measure-only mode, the default Performance Policy can initially be activated to test how all of the workloads perform in the cluster. The Dashboard displays both the resource use and wait times that comprise the average response time for each Performance Class during different periods of demand. These numbers can serve to help understand the minimum response times achievable with the allocated resources</p>
<p><a id="sthref391"></a><a id="sthref392"></a><a id="sthref393"></a><a id="sthref394"></a><a id="sthref395"></a>If your workloads peak at different times on a regular basis or your service-level agreements (SLAs) are variable based upon time, day of week, and so on, then create additional measure-only Performance Policies that change the size of the server pools to evaluate the minimum resources required for your workloads. In this demonstration, for the Sales application, the workload that uses the <code>online</code> server pool requires a minimum of two servers. The <code>backoffice</code> server pool requires only one server to satisfy the workload requests. If both server pools currently contain two servers, then you can enable the <code>online</code> server pool to take a server from the <code>backoffice</code> server pool, if needed, by setting the minimum size of the <code>backoffice</code> server pool to one. You would use a server pool directive override in the "Business Hours" Performance Policy to specify the minimum size of one for the <code>backoffice</code> server pool.</p>
<p><a id="sthref396"></a><a id="sthref397"></a><a id="sthref398"></a>You could interpret the minimum size of a server pool as the number of servers <span class="italic">owned</span> by that server pool. If the sum of the minimum sizes of all the server pools in the cluster is less than the number of servers in the cluster, then the extra servers are referred to as <span class="italic">floaters</span>, which are shared by all server pools. For example, if your cluster has 15 servers, three server pools, and a minimum size of four for each server pool, then your system has three floaters.</p>
<p><a id="sthref399"></a><a id="sthref400"></a><a id="sthref401"></a><a id="sthref402"></a><a id="sthref403"></a>After the Performance Policies have been run in measure-only mode, Performance Objectives can be added to each Performance Class. The Performance Objectives can be ranked based upon how critical the maintenance of that Performance Objective is to your business. Performance Objectives should be set to maximize <a href="glossary.htm#BGBIDBAH"><span class="xrefglossterm">headroom</span></a> above the observed response times but below the response times required to meet SLAs. Maintaining at least 50% headroom is a good starting point to support trading off resources should a Performance Class experience a workload surge. For example, if a Performance Class has an average response time of two milliseconds (ms), then the Performance Objective could be set to three ms: two ms response time and an additional one ms which corresponds to the 50% headroom.</p>
<p><a id="sthref404"></a>Although service-based classifiers can provide for easy configuration, you might want to define more than one Performance Objective for a service. For example, the <code>sales</code> service can contain many different workloads, such as Browse Products, Add Customer Account, Sales Cart and Browse Orders. Because the Sales Cart workload generates revenue, you might want this workload to have a shorter response time than the other workloads. You must create a separate Performance Class and associated classifiers to specify specific Performance Objectives for the different workloads.</p>
<p><a id="sthref405"></a><a id="sthref406"></a><a id="sthref407"></a><a id="sthref408"></a><a id="sthref409"></a><a id="sthref410"></a><a id="sthref411"></a>On the Define Classifier page in the Policy Set wizard, a sales cart performance classifier can be defined by entering <code>sales</code> as the Service Name and if the application can set <code>MODULE</code> or <code>ACTION</code>, enter an appropriate value, otherwise configure a separate <code>USERNAME</code> from the middle tier. As soon as this new Performance Class is defined, the Performance Class appears automatically in all of the Performance Policies in measure-only mode. The new Performance Class is given the lowest rank by default. Use these values initially to test the performance of your system. After the average performance levels can be determined, a Performance Objective and rank for this Performance Class can be set within each Performance Policy.</p>
</div>
<!-- class="sect1" -->
<a id="BABIAABD"></a><a id="APQOS281"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Managing Service Levels with Oracle Database QoS Management</h2>
<p>The implementation of Oracle Database QoS Management is completed by actively managing the service levels, which means responding to alerts, reviewing and implementing recommendations, and tracking results. This section describes the actions you would perform on the demo system.</p>
<p><a id="sthref412"></a><a id="sthref413"></a><a id="sthref414"></a><a id="sthref415"></a><a id="sthref416"></a><a id="sthref417"></a><a id="sthref418"></a><a id="sthref419"></a>After all the workloads run and the Dashboard displays the performance of the demo system, you need to be alerted should a workload surge or failure cause a Performance Objective to stop being met. The Performance Satisfaction Metric (PSM) normalizes all of the objectives and provides a quick way to observe the health of the system. By observing the PSM Trend indicator you can see how well a Performance Class is meeting its objective over the last five minutes, and problems can be observed. Performance Objective violations produce recommendations that state how resources should be reallocated to relieve the bottleneck. Details and projections are available for further analysis of the bottleneck and possible solutions. If the recommendation is an action that can be implemented by Oracle Database QoS Management, then an <span class="bold">Implement</span> button is displayed.</p>
<p><a id="sthref420"></a><a id="sthref421"></a><a id="sthref422"></a><a id="sthref423"></a>Performance Objective violations of short duration are tolerated in most SLAs. Therefore, Enterprise Manager alerts can be configured by Performance Class specifying the duration of continuous violation. These alerts are configured on the Database alert page, but can be defined for all Performance Classes in the cluster.</p>
<p><a id="sthref424"></a><a id="sthref425"></a><a id="sthref426"></a><a id="sthref427"></a><a id="sthref428"></a>An audit log of policy changes, violations and actions is available in the Oracle Grid Infrastructure home in the <code>oc4j/j2ee/home/log/dbwlm/auditing</code> directory on the server that hosts the Oracle Database QoS Management server. To determine which server is hosting the Oracle Database QoS Management server (the OC4J container), enter the following command at the operating system prompt:</p>
<pre>
srvctl status oc4j
</pre></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1710">
<tr>
<td class="cellalignment1717">
<table class="cellalignment1715">
<tr>
<td class="cellalignment1714"><a href="apqos_intro.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1714"><a href="install_config.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2010, 2012,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1719">
<table class="cellalignment1713">
<tr>
<td class="cellalignment1714"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1714"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1714"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1714"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1714"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1714"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
