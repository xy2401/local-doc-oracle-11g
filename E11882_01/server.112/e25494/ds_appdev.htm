<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Developing Applications for a Distributed Database System</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1055" />
<meta name="dcterms.created" content="2015-05-05T8:27:39Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Administrator's Guide" />
<meta name="dcterms.identifier" content="E25494-07" />
<meta name="dcterms.isVersionOf" content="ADMIN" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2001, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="ds_admin.htm" title="Previous" type="text/html" />
<link rel="Next" href="ds_txns.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e25494.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">44/49</span> <!-- End Header -->
<div id="ADMIN030" class="chapter"><a id="g1011074"></a> <a id="i1007516"></a>
<h1 class="chapter"><span class="secnum">33</span> Developing Applications for a Distributed Database System</h1>
<p><a id="sthref3572"></a><a id="sthref3573"></a><a id="sthref3574"></a>In this chapter:</p>
<ul>
<li>
<p><a href="#i1007562">Managing the Distribution of Application Data</a></p>
</li>
<li>
<p><a href="#i1007573">Controlling Connections Established by Database Links</a></p>
</li>
<li>
<p><a href="#i1007612">Maintaining Referential Integrity in a Distributed System</a></p>
</li>
<li>
<p><a href="#i1007640">Tuning Distributed Queries</a></p>
</li>
<li>
<p><a href="#i1007937">Handling Errors in Remote Procedures</a></p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADFNS" href="../../appdev.112/e41502/toc.htm"><span class="italic">Oracle Database Advanced Application Developer's Guide</span></a> for more information about application development in an Oracle Database environment</div>
</li>
</ul>
<a id="i1007562"></a>
<div id="ADMIN12193" class="sect1">
<h2 class="sect1">Managing the Distribution of Application Data<a id="sthref3575"></a></h2>
<p><a id="sthref3576"></a>In a distributed database environment, coordinate with the database administrator to determine the best location for the data. Some issues to consider are:</p>
<ul>
<li>
<p>Number of transactions posted from each location</p>
</li>
<li>
<p>Amount of data (portion of table) used by each node</p>
</li>
<li>
<p>Performance characteristics and reliability of the network</p>
</li>
<li>
<p>Speed of various nodes, capacities of disks</p>
</li>
<li>
<p>Importance of a node or link when it is unavailable</p>
</li>
<li>
<p>Need for referential integrity among tables</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="i1007573"></a>
<div id="ADMIN12194" class="sect1">
<h2 class="sect1">Controlling Connections Established by Database Links<a id="sthref3577"></a></h2>
<p><a id="sthref3578"></a>When a global object name is referenced in a SQL statement or remote procedure call, database links establish a connection to a session in the remote database on behalf of the local user. The remote connection and session are only created if the connection has not already been established previously for the local user session.</p>
<p>The connections and sessions established to remote databases persist for the duration of the local user's session, unless the application or user explicitly terminates them. Note that when you issue a <code dir="ltr">SELECT</code> statement across a database link, a transaction lock is placed on the undo segments. To rerelease the segment, you must issue a <code dir="ltr">COMMIT</code> or <code dir="ltr">ROLLBACK</code> statement.</p>
<p>Terminating remote connections established using database links is useful for disconnecting high cost connections that are no longer required by the application.<a id="sthref3579"></a><a id="sthref3580"></a> You can terminate a remote connection and session using the <code dir="ltr">ALTER SESSION</code> statement with the <code dir="ltr">CLOSE DATABASE LINK</code> clause. For example, assume you issue the following transactions:<a id="sthref3581"></a><a id="sthref3582"></a><a id="sthref3583"></a></p>
<pre dir="ltr">
SELECT * FROM emp@sales;
COMMIT;
</pre>
<p>The following statement terminates the session in the remote database pointed to by the <code dir="ltr">sales</code> database link:</p>
<pre dir="ltr">
ALTER SESSION CLOSE DATABASE LINK sales;<a id="sthref3584"></a><a id="sthref3585"></a>
</pre>
<p>To close a database link connection in your user session, you must have the <code dir="ltr">ALTER SESSION</code> system privilege.<a id="sthref3586"></a></p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Before closing a database link, first close all cursors that use the link and then end your current transaction if it uses the link.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF00901" href="../../server.112/e41084/statements_2013.htm#SQLRF00901"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information about the <code dir="ltr">ALTER SESSION</code> statement</div>
</div>
<!-- class="sect1" -->
<a id="i1007612"></a>
<div id="ADMIN12195" class="sect1">
<h2 class="sect1">Maintaining Referential Integrity in a Distributed System<a id="sthref3587"></a><a id="sthref3588"></a></h2>
<p><a id="sthref3589"></a><a id="sthref3590"></a>If a part of a distributed statement fails, for example, due to an integrity constraint violation, the database returns error number <code dir="ltr">ORA-02055</code>. Subsequent statements or procedure calls return error number <code dir="ltr">ORA-02067</code> until a <code dir="ltr">ROLLBACK</code> or <code dir="ltr">ROLLBACK TO SAVEPOINT</code> is issued.<a id="sthref3591"></a><a id="sthref3592"></a><a id="sthref3593"></a><a id="sthref3594"></a><a id="sthref3595"></a><a id="sthref3596"></a><a id="sthref3597"></a></p>
<p>Design your application to check for any returned error messages that indicate that a portion of the distributed update has failed. If you detect a failure, you should roll back the entire transaction before allowing the application to proceed.<a id="sthref3598"></a><a id="sthref3599"></a></p>
<p>The database does not permit <a id="sthref3600"></a>declarative referential integrity constraints to be defined across nodes of a distributed system. In other words, a declarative referential integrity constraint on one table cannot specify a foreign key that references a primary or unique key of a remote table. Nevertheless, you can maintain parent/child table relationships across nodes using triggers.</p>
<p>If you decide to define referential integrity across the nodes of a distributed database using triggers, be aware that network failures can limit the accessibility of not only the parent table, but also the child table. For example, assume that the child table is in the <code dir="ltr">sales</code> database and the parent table is in the <code dir="ltr">hq</code> database. If the network connection between the two databases fails, some DML statements against the child table (those that insert rows into the child table or update a foreign key value in the child table) cannot proceed because the referential integrity triggers must have access to the parent table in the <code dir="ltr">hq</code> database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink LNPLS020" href="../../appdev.112/e25519/triggers.htm#LNPLS020"><span class="italic">Oracle Database PL/SQL Language Reference</span></a> for more information about using triggers to enforce referential integrity</div>
</div>
<!-- class="sect1" -->
<a id="i1007640"></a>
<div id="ADMIN12196" class="sect1">
<h2 class="sect1">Tuning Distributed Queries</h2>
<p><a id="sthref3601"></a><a id="sthref3602"></a><a id="sthref3603"></a><a id="sthref3604"></a>The local Oracle Database server breaks the distributed query into a corresponding number of remote queries, which it then sends to the remote nodes for execution. The remote nodes execute the queries and send the results back to the local node. The local node then performs any necessary post-processing and returns the results to the user or application.</p>
<p>You have several options for designing your application to optimize query processing. This section contains the following topics:</p>
<ul>
<li>
<p><a href="#i1007670">Using Collocated Inline Views</a></p>
</li>
<li>
<p><a href="#i1007699">Using Cost-Based Optimization</a></p>
</li>
<li>
<p><a href="#i1007812">Using Hints</a></p>
</li>
<li>
<p><a href="#i1007865">Analyzing the Execution Plan</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
SQL management objects, such as SQL profiles, SQL plan baselines, and SQL patches, and stored outlines might not always work as expected if your query references remote tables with database links. For example, for SQL plan management, when Oracle uses a SQL plan baseline for the query, the parts of the query that are remotely executed might use a different plan than when the SQL plan baseline was created.</div>
<a id="i1007670"></a>
<div id="ADMIN12197" class="sect2">
<h3 class="sect2">Using Collocated Inline Views</h3>
<p><a id="sthref3605"></a><a id="sthref3606"></a>The <a id="sthref3607"></a>most effective way of optimizing distributed queries is to access the remote databases as little as possible and to retrieve only the required data.</p>
<p>For example, assume you reference five remote tables from two different remote databases in a distributed query and have a complex filter (for example, <code dir="ltr">WHERE</code> <code dir="ltr">r1.salary</code> + <code dir="ltr">r2.salary</code> &gt; <code dir="ltr">50000</code>). You can improve the performance of the query by rewriting the query to access the remote databases once and to apply the filter at the remote site. This rewrite causes less data to be transferred to the query execution site.</p>
<p>Rewriting your query to access the remote database once is achieved by using collocated inline views. The following terms need to be defined:</p>
<ul>
<li>
<p><span class="bold">Collocated</span></p>
<p>Two or more tables located in the same database.</p>
</li>
<li>
<p><span class="bold">Inline view</span></p>
<p>A <code dir="ltr">SELECT</code> statement that is substituted for a table in a parent <code dir="ltr">SELECT</code> statement. The embedded <code dir="ltr">SELECT</code> statement, shown within the parentheses is an example of an inline view:</p>
<pre dir="ltr">
SELECT e.empno,e.ename,d.deptno,d.dname
   FROM (SELECT empno, ename from
         emp@orc1.world) e, dept d;
</pre></li>
<li>
<p><span class="bold">Collocated inline view</span></p>
<p>An inline view that selects data from multiple tables from a single database only. It reduces the amount of times that the remote database is accessed, improving the performance of a distributed query.</p>
</li>
</ul>
<p>Oracle recommends that you form your distributed query using collocated inline views to increase the performance of your distributed query. Oracle Database cost-based optimization can transparently rewrite many of your distributed queries to take advantage of the performance gains offered by collocated inline views.</p>
</div>
<!-- class="sect2" -->
<a id="i1007699"></a>
<div id="ADMIN12198" class="sect2">
<h3 class="sect2">Using Cost-Based Optimization<a id="sthref3608"></a><a id="sthref3609"></a><a id="sthref3610"></a></h3>
<p><a id="sthref3611"></a><a id="sthref3612"></a>In <a id="sthref3613"></a>addition to rewriting your queries with collocated inline views, the cost-based optimization method optimizes distributed queries according to the gathered statistics of the referenced tables and the computations performed by the optimizer.</p>
<p>For example, cost-based optimization analyzes the following query. The example assumes that table statistics are available. Note that it analyzes the query inside a <code dir="ltr">CREATE TABLE</code> statement:</p>
<pre dir="ltr">
CREATE TABLE AS (
                 SELECT l.a, l.b, r1.c, r1.d, r1.e, r2.b, r2.c
                 FROM local l, remote1 r1, remote2 r2 
                    WHERE l.c = r.c 
                    AND r1.c = r2.c 
                    AND r.e &gt; 300
                );
</pre>
<p>and rewrites it as:</p>
<pre dir="ltr">
CREATE TABLE AS (
                 SELECT l.a, l.b, v.c, v.d, v.e
                 FROM (
                        SELECT r1.c, r1.d, r1.e, r2.b, r2.c
                         FROM remote1 r1, remote2 r2
                         WHERE r1.c = r2.c 
                         AND r1.e &gt; 300
                      ) v, local l
                 WHERE l.c = r1.c
                );
</pre>
<p>The alias <code dir="ltr">v</code> is assigned to the inline view, which can then be referenced as a table in the preceding <code dir="ltr">SELECT</code> statement. Creating a collocated inline view reduces the amount of queries performed at a remote site, thereby reducing costly network traffic.</p>
<a id="i1007727"></a>
<div id="ADMIN12199" class="sect3">
<h4 class="sect3">How Does Cost-Based Optimization Work?</h4>
<p>The main task of optimization is to rewrite a distributed query to use collocated inline views. This optimization is performed in three steps:</p>
<ol>
<li>
<p>All mergeable views are merged.</p>
</li>
<li>
<p>Optimizer performs collocated query block test.</p>
</li>
<li>
<p>Optimizer rewrites query using collocated inline views.</p>
</li>
</ol>
<p>After the query is rewritten, it is executed and the data set is returned to the user.</p>
<p>While cost-based optimization is performed transparently to the user, it cannot improve the performance of several distributed query scenarios. Specifically, if your distributed query contains any of the following, cost-based optimization is not effective:</p>
<ul>
<li>
<p>Aggregates</p>
</li>
<li>
<p>Subqueries</p>
</li>
<li>
<p>Complex SQL</p>
</li>
</ul>
<p>If your distributed query contains one of these elements, see <a href="#i1007812">"Using Hints"</a> to learn how you can modify your query and use hints to improve the performance of your distributed query.</p>
</div>
<!-- class="sect3" -->
<div id="ADMIN12200" class="sect3"><a id="sthref3614"></a>
<h4 class="sect3">Setting Up Cost-Based Optimization</h4>
<p>After you have set up your system to use cost-based optimization to improve the performance of distributed queries, the operation is transparent to the user. In other words, the optimization occurs automatically when the query is issued.</p>
<p>You must complete the following tasks to set up your system to take advantage of cost-based optimization:</p>
<ul>
<li>
<p><a href="#i1007756">Setting Up the Environment</a></p>
</li>
<li>
<p><a href="#i1007775">Analyzing Tables</a></p>
</li>
</ul>
<a id="i1007756"></a>
<div id="ADMIN12201" class="sect4">
<h5 class="sect4">Setting Up the Environment</h5>
<p>Set the <code dir="ltr">OPTIMIZER_MODE</code> initialization parameter to establish the default behavior for choosing an optimization approach for the instance. You can set this parameter by:</p>
<ul>
<li>
<p>Modifying the <code dir="ltr">OPTIMIZER_MODE</code> parameter in the initialization parameter file</p>
</li>
<li>
<p>Setting it at session level by issuing an <code dir="ltr">ALTER SESSION</code> statement</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink PFGRF001" href="../../server.112/e41573/optimops.htm#PFGRF001"><span class="italic">Oracle Database Performance Tuning Guide</span></a> for information on setting the <code dir="ltr">OPTIMIZER_MODE</code> initialization parameter in the parameter file and for configuring your system to use a cost-based optimization method</div>
</div>
<!-- class="sect4" -->
<a id="i1007775"></a>
<div id="ADMIN12202" class="sect4">
<h5 class="sect4"><a id="sthref3615"></a><a id="sthref3616"></a><a id="sthref3617"></a><a id="sthref3618"></a>Analyzing Tables</h5>
<p>For cost-based optimization to select the most efficient path for a distributed query, you must provide accurate statistics for the tables involved. You do this using the <code dir="ltr">DBMS_STATS</code> package.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You must connect locally with respect to the tables when executing the <code dir="ltr">DBMS_STATS</code> procedure.
<p>You must first connect to the remote site and then execute a <code dir="ltr">DBMS_STATS</code> procedure.</p>
</div>
<p>The following <code dir="ltr">DBMS_STATS</code> procedures enable the gathering of certain classes of optimizer statistics:</p>
<ul>
<li>
<p><code dir="ltr">GATHER_INDEX_STATS</code></p>
</li>
<li>
<p><code dir="ltr">GATHER_TABLE_STATS</code></p>
</li>
<li>
<p><code dir="ltr">GATHER_SCHEMA_STATS</code></p>
</li>
<li>
<p><code dir="ltr">GATHER_DATABASE_STATS</code></p>
</li>
</ul>
<p>For example, assume that distributed transactions routinely access the <code dir="ltr">scott.dept</code> table. To ensure that the cost-based optimizer is still picking the best plan, execute the following:</p>
<pre dir="ltr">
BEGIN
   DBMS_STATS.GATHER_TABLE_STATS ('scott', 'dept');
END;
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink PFGRF003" href="../../server.112/e41573/stats.htm#PFGRF003"><span class="italic">Oracle Database Performance Tuning Guide</span></a> for information about generating statistics</p>
</li>
<li>
<p><a class="olink ARPLS059" href="../../appdev.112/e40758/d_stats.htm#ARPLS059"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for additional information on using the <code dir="ltr">DBMS_STATS</code> package</p>
</li>
</ul>
</div>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1007812"></a>
<div id="ADMIN12203" class="sect2">
<h3 class="sect2">Using Hints<a id="sthref3619"></a><a id="sthref3620"></a></h3>
<p><a id="sthref3621"></a><a id="sthref3622"></a>If a <a id="sthref3623"></a>statement is not sufficiently optimized, then you can use hints to extend the capability of cost-based optimization. Specifically, if you write your own query to use collocated inline views, instruct the cost-based optimizer not to rewrite your distributed query.</p>
<p>Additionally, if you have special knowledge about the database environment (such as statistics, load, network and CPU limitations, distributed queries, and so forth), you can specify a hint to guide cost-based optimization. For example, if you have written your own optimized query using collocated inline views that are based on your knowledge of the database environment, specify the <code dir="ltr">NO_MERGE</code> hint to prevent the optimizer from rewriting your query.</p>
<p>This technique is especially helpful if your distributed query contains an aggregate, subquery, or complex SQL. Because this type of distributed query cannot be rewritten by the optimizer, specifying <code dir="ltr">NO_MERGE</code> causes the optimizer to skip the steps described in <a href="#i1007727">"How Does Cost-Based Optimization Work?"</a>.</p>
<p>The <code dir="ltr">DRIVING_SITE</code> hint lets you define a remote site to act as the query execution site. In this way, the query executes on the remote site, which then returns the data to the local site. This hint is especially helpful when the remote site contains the majority of the data.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink PFGRF005" href="../../server.112/e41573/hintsref.htm#PFGRF005"><span class="italic">Oracle Database Performance Tuning Guide</span></a> for more information about using hints</div>
<div id="ADMIN12204" class="sect3"><a id="sthref3624"></a>
<h4 class="sect3">Using the <a id="sthref3625"></a><a id="sthref3626"></a>NO_MERGE Hint</h4>
<p>The <code dir="ltr">NO_MERGE</code> hint prevents the database from merging an inline view into a potentially non-collocated SQL statement (see <a href="#i1007812">"Using Hints"</a>). This hint is embedded in the <code dir="ltr">SELECT</code> statement and can appear either at the beginning of the <code dir="ltr">SELECT</code> statement with the inline view as an argument or in the query block that defines the inline view.</p>
<pre dir="ltr">
/* with argument */

SELECT /*+NO_MERGE(v)*/ t1.x, v.avg_y
   FROM t1, (SELECT x, AVG(y) AS avg_y FROM t2 GROUP BY x) v,
   WHERE t1.x = v.x AND t1.y = 1;

/* in query block */

SELECT t1.x, v.avg_y
   FROM t1, (SELECT /*+NO_MERGE*/ x, AVG(y) AS avg_y FROM t2 GROUP BY x) v,
   WHERE t1.x = v.x AND t1.y = 1;
</pre>
<p>Typically, you use this hint when you have developed an optimized query based on your knowledge of your database environment.</p>
</div>
<!-- class="sect3" -->
<div id="ADMIN12205" class="sect3"><a id="sthref3627"></a>
<h4 class="sect3"><a id="sthref3628"></a><a id="sthref3629"></a>Using the DRIVING_SITE Hint</h4>
<p>The <code dir="ltr">DRIVING_SITE</code> hint lets you specify the site where the query execution is performed. It is best to let cost-based optimization determine where the execution should be performed, but if you prefer to override the optimizer, you can specify the execution site manually.</p>
<p>Following is an example of a <code dir="ltr">SELECT</code> statement with a <code dir="ltr">DRIVING_SITE</code> hint:</p>
<pre dir="ltr">
SELECT /*+DRIVING_SITE(dept)*/ * FROM emp, dept@remote.com
   WHERE emp.deptno = dept.deptno;
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1007865"></a>
<div id="ADMIN12206" class="sect2">
<h3 class="sect2">Analyzing the Execution Plan</h3>
<p><a id="sthref3630"></a>An <a id="sthref3631"></a>important aspect to tuning distributed queries is analyzing the execution plan. The feedback that you receive from your analysis is an important element to testing and verifying your database. Verification becomes especially important when you want to compare plans. For example, comparing the execution plan for a distributed query optimized by cost-based optimization to a plan for a query manually optimized using hints, collocated inline views, and other techniques.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink PFGRF009" href="../../server.112/e41573/ex_plan.htm#PFGRF009"><span class="italic">Oracle Database Performance Tuning Guide</span></a> for detailed information about execution plans, the <code dir="ltr">EXPLAIN PLAN</code> statement, and how to interpret the results</div>
<div id="ADMIN12208" class="sect3"><a id="sthref3632"></a>
<h4 class="sect3">Generating the Execution Plan</h4>
<p>After you have prepared the database to store the execution plan, you are ready to view the plan for a specified query. Instead of directly executing a SQL statement, append the statement to the <code dir="ltr">EXPLAIN PLAN FOR</code> clause. For example, you can execute the following:</p>
<pre dir="ltr">
EXPLAIN PLAN FOR
   SELECT d.dname 
   FROM dept d
      WHERE d.deptno 
      IN (SELECT deptno 
          FROM emp@orc2.world
          GROUP BY deptno
          HAVING COUNT (deptno) &gt;3
          )
/
</pre></div>
<!-- class="sect3" -->
<div id="ADMIN12209" class="sect3"><a id="sthref3633"></a>
<h4 class="sect3">Viewing the Execution Plan</h4>
<p>After you have executed the preceding SQL statement, the execution plan is stored temporarily in the <code dir="ltr">PLAN_TABLE</code>. To view the results of the execution plan, execute the following script:</p>
<pre dir="ltr">
@utlxpls.sql
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code dir="ltr">utlxpls.sql</code> can be found in the <code dir="ltr">$ORACLE_HOME/rdbms/admin</code> directory.</div>
<p>Executing the <code dir="ltr">utlxpls.sql</code> script displays the execution plan for the <code dir="ltr">SELECT</code> statement that you specified. The results are formatted as follows:</p>
<pre dir="ltr">
Plan Table
-------------------------------------------------------------------------------
| Operation                 |  Name    |  Rows | Bytes|  Cost  | Pstart| Pstop |
-------------------------------------------------------------------------------
| SELECT STATEMENT          |          |       |      |        |       |      |
|  NESTED LOOPS             |          |       |      |        |       |      |
|   VIEW                    |          |       |      |        |       |      |
|    REMOTE                 |          |       |      |        |       |      |
|   TABLE ACCESS BY INDEX RO|DEPT      |       |      |        |       |      |
|    INDEX UNIQUE SCAN      |PK_DEPT   |       |      |        |       |      |
-------------------------------------------------------------------------------
</pre>
<p>If you are manually optimizing distributed queries by writing your own collocated inline views or using hints, it is best to generate an execution plan before and after your manual optimization. With both execution plans, you can compare the effectiveness of your manual optimization and make changes as necessary to improve the performance of the distributed query.</p>
<p>To view the SQL statement that will be executed at the remote site, execute the following select statement:</p>
<pre dir="ltr">
SELECT OTHER 
FROM PLAN_TABLE 
   WHERE operation = 'REMOTE';
</pre>
<p>Following is sample output:</p>
<pre dir="ltr">
SELECT DISTINCT "A1"."DEPTNO" FROM "EMP" "A1" 
   GROUP BY "A1"."DEPTNO" HAVING COUNT("A1"."DEPTNO")&gt;3
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you are having difficulty viewing the entire contents of the <code dir="ltr">OTHER</code> column, execute the following SQL*Plus command:
<pre dir="ltr">
SET LONG 9999999 
</pre></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1007937"></a>
<div id="ADMIN12210" class="sect1">
<h2 class="sect1">Handling Errors in Remote Procedures</h2>
<p><a id="sthref3634"></a><a id="sthref3635"></a><a id="sthref3636"></a>When the database executes a procedure locally or at a remote location, four types of exceptions can occur:</p>
<ul>
<li>
<p>PL/SQL user-defined exceptions, which must be declared using the keyword <code dir="ltr"><a id="sthref3637"></a>EXCEPTION</code></p>
</li>
<li>
<p>PL/SQL predefined exceptions such as <a id="sthref3638"></a>the <code dir="ltr">NO_DATA_FOUND</code> keyword</p>
</li>
<li>
<p>SQL errors such as <code dir="ltr">ORA-00900</code> and <code dir="ltr">ORA-02015</code></p>
</li>
<li>
<p>Application exceptions generated using the <a id="sthref3639"></a><a id="sthref3640"></a><code dir="ltr">RAISE_APPLICATION_ERROR</code>() procedure</p>
</li>
</ul>
<p>When using local procedures, you can trap these messages by writing an <a id="sthref3641"></a><a id="sthref3642"></a>exception handler such as the following</p>
<pre dir="ltr">
BEGIN
  ...
EXCEPTION
   WHEN ZERO_DIVIDE THEN
   /* ... handle the exception */
END;
</pre>
<p>Notice that the <code dir="ltr">WHEN</code> clause requires an exception name. If the exception does not have a name, for example, exceptions generated with <code dir="ltr">RAISE_APPLICATION_ERROR</code>, you can assign one using <a id="sthref3643"></a><a id="sthref3644"></a><a id="sthref3645"></a><code dir="ltr">PRAGMA_EXCEPTION_INIT</code>. For example:</p>
<pre dir="ltr">
DECLARE
  null_salary EXCEPTION;
  PRAGMA EXCEPTION_INIT(null_salary, -20101);
BEGIN
  ...
  RAISE_APPLICATION_ERROR(-20101, 'salary is missing');
...
EXCEPTION
  WHEN null_salary THEN
  ...
END;
</pre>
<p>When calling a remote procedure, exceptions can be handled by an exception handler in the local procedure. The remote procedure must return an error number to the local, calling procedure, which then handles the exception as shown in the previous example. Note that PL/SQL user-defined exceptions always return <code dir="ltr">ORA-06510</code> to the local procedure.</p>
<p>Therefore, it is not possible to distinguish between two different <a id="sthref3646"></a>user-defined exceptions based on the error number. All other remote exceptions can be handled in the same manner as local exceptions<a id="sthref3647"></a><a id="sthref3648"></a>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink LNPLS008" href="../../appdev.112/e25519/subprograms.htm#LNPLS008"><span class="italic">Oracle Database PL/SQL Language Reference</span></a> for more information about PL/SQL procedures</div>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1326">
<tr>
<td class="cellalignment1335">
<table class="cellalignment1331">
<tr>
<td class="cellalignment1330"><a href="ds_admin.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1330"><a href="ds_txns.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2001, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1337">
<table class="cellalignment1329">
<tr>
<td class="cellalignment1330"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1330"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1330"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1330"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1330"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1330"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
