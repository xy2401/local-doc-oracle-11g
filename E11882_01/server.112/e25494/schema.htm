<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Managing Space for Schema Objects</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1055" />
<meta name="dcterms.created" content="2015-05-05T8:27:35Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Administrator's Guide" />
<meta name="dcterms.identifier" content="E25494-07" />
<meta name="dcterms.isVersionOf" content="ADMIN" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2001, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="general.htm" title="Previous" type="text/html" />
<link rel="Next" href="tables.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e25494.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">28/49</span> <!-- End Header -->
<div id="ADMIN014" class="chapter"><a id="g1019613"></a> <a id="i1008740"></a>
<h1 class="chapter"><span class="secnum">19</span> Managing Space for Schema Objects</h1>
<p>In this chapter:</p>
<ul>
<li>
<p><a href="#CHDHEHDB">Managing Tablespace Alerts</a></p>
</li>
<li>
<p><a href="#i1006574">Managing Resumable Space Allocation</a></p>
</li>
<li>
<p><a href="#i1006922">Reclaiming Wasted Space</a></p>
</li>
<li>
<p><a href="#CFHBJHDG">Dropping Unused Object Storage</a></p>
</li>
<li>
<p><a href="#i1009496">Understanding Space Usage of Data Types</a></p>
</li>
<li>
<p><a href="#i1008797">Displaying Information About Space Usage for Schema Objects</a></p>
</li>
<li>
<p><a href="#CHDFDCAH">Capacity Planning for Database Objects</a></p>
</li>
</ul>
<a id="CHDHEHDB"></a>
<div id="ADMIN10120" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Managing Tablespace Alerts</h2>
<p>Oracle Database provides proactive help in managing disk space for tablespaces by alerting you when available space is running low. Two alert thresholds are defined by default: <span class="bold">warning</span> and <span class="bold">critical</span>. The warning threshold is the limit at which space is beginning to run low. The critical threshold is a serious limit that warrants your immediate attention. The database issues alerts at both thresholds.</p>
<p>There are two ways to specify alert thresholds for both locally managed and dictionary managed tablespaces:</p>
<ul>
<li>
<p>By percent full</p>
<p>For both warning and critical thresholds, when space used becomes greater than or equal to a percent of total space, an alert is issued.</p>
</li>
<li>
<p>By free space remaining (in kilobytes (KB))</p>
<p>For both warning and critical thresholds, when remaining space falls below an amount in KB, an alert is issued. Free-space-remaining thresholds are more useful for very large tablespaces.</p>
</li>
</ul>
<p>Alerts for locally managed tablespaces are server-generated. For dictionary managed tablespaces, Enterprise Manager provides this functionality. See <a href="monitoring.htm#CIHCAGAJ">"Monitoring Database Operations with Server-Generated Alerts"</a> for more information.</p>
<p>New tablespaces are assigned alert thresholds as follows:</p>
<ul>
<li>
<p><span class="bold">Locally managed tablespace</span>&mdash;When you create a new locally managed tablespace, it is assigned the default threshold values defined for the database. A newly created database has a default of 85% full for the warning threshold and 97% full for the critical threshold. Defaults for free space remaining thresholds for a new database are both zero (disabled). You can change these database defaults, as described later in this section.</p>
</li>
<li>
<p><a id="sthref2002"></a><span class="bold">Dictionary managed tablespace</span>&mdash;When you create a new dictionary managed tablespace, it is assigned the threshold values that Enterprise Manager lists for "All others" in the metrics categories "Tablespace Free Space (MB) (dictionary managed)" and "Tablespace Space Used (%) (dictionary managed)." You change these values on the Metric and Policy Settings page.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
In a database that is upgraded from version 9.x or earlier to 10.x, database defaults for all locally managed tablespace alert thresholds are set to zero. This setting effectively disables the alert mechanism to avoid excessive alerts in a newly migrated database.</div>
<div id="ADMIN11567" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref2003"></a>
<h3 class="sect2">Setting Alert Thresh<a id="sthref2004"></a><a id="sthref2005"></a>olds</h3>
<p>For each tablespace, you can set just percent-full thresholds, just free-space-remaining thresholds, or both types of thresholds simultaneously. Setting either type of threshold to zero disables it.</p>
<p>The ideal setting for the warning threshold is one that issues an alert early enough for you to resolve the problem before it becomes critical. The critical threshold should be one that issues an alert still early enough so that you can take immediate action to avoid loss of service.</p>
<p class="itemizedlisttitle">To set alert threshold values for locally managed tablespaces:&nbsp;</p>
<ul>
<li>
<p>Do one of the following:</p>
<ul>
<li>
<p>Use the Tablespaces page of Enterprise Manager.</p>
<p>See <a class="olink ADMQS12069" href="../../server.112/e10897/storage.htm#ADMQS12069"><span class="italic">Oracle Database 2 Day DBA</span></a> for instructions.</p>
</li>
<li>
<p>Use the <code dir="ltr">DBMS_SERVER_ALERT.SET_THRESHOLD</code> package procedure.</p>
<p>See <a class="olink ARPLS016" href="../../appdev.112/e40758/d_server_alert.htm#ARPLS016"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for details.</p>
</li>
</ul>
</li>
</ul>
<p class="itemizedlisttitle">To set alert threshold values for dictionary managed tablespaces:&nbsp;</p>
<ul>
<li>
<p>Use the Tablespaces page of Enterprise Manager.</p>
<p>See <a class="olink ADMQS12069" href="../../server.112/e10897/storage.htm#ADMQS12069"><span class="italic">Oracle Database 2 Day DBA</span></a> for instructions.</p>
</li>
</ul>
<p class="subhead2"><a id="ADMIN12621"></a>Example&mdash;Locally Managed Tablespace</p>
<p>The following example sets the free-space-remaining thresholds in the <code dir="ltr">USERS</code> tablespace to 10 MB (warning) and 2 MB (critical), and disables the percent-full thresholds.</p>
<pre dir="ltr">
BEGIN
DBMS_SERVER_ALERT.SET_THRESHOLD(
   metrics_id              =&gt; DBMS_SERVER_ALERT.TABLESPACE_BYT_FREE,
   warning_operator        =&gt; DBMS_SERVER_ALERT.OPERATOR_LE,
   warning_value           =&gt; '10240',
   critical_operator       =&gt; DBMS_SERVER_ALERT.OPERATOR_LE,
   critical_value          =&gt; '2048',
   observation_period      =&gt; 1,
   consecutive_occurrences =&gt; 1,
   instance_name           =&gt; NULL,
   object_type             =&gt; DBMS_SERVER_ALERT.OBJECT_TYPE_TABLESPACE,
   object_name             =&gt; 'USERS');

DBMS_SERVER_ALERT.SET_THRESHOLD(
   metrics_id              =&gt; DBMS_SERVER_ALERT.TABLESPACE_PCT_FULL,
   warning_operator        =&gt; DBMS_SERVER_ALERT.OPERATOR_GT,
   warning_value           =&gt; '0',
   critical_operator       =&gt; DBMS_SERVER_ALERT.OPERATOR_GT,
   critical_value          =&gt; '0',
   observation_period      =&gt; 1,
   consecutive_occurrences =&gt; 1,
   instance_name           =&gt; NULL,
   object_type             =&gt; DBMS_SERVER_ALERT.OBJECT_TYPE_TABLESPACE,
   object_name             =&gt; 'USERS');
END;
/
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
When setting nonzero values for percent-full thresholds, use the greater-than-or-equal-to operator, <code dir="ltr">OPERATOR_GE</code>.</div>
<p class="subhead2"><a id="ADMIN12622"></a>Restoring a Tablespace to Database Default Thresholds</p>
<p>After explicitly setting values for locally managed tablespace alert thresholds, you can cause the values to revert to the database defaults by setting them to <code dir="ltr">NULL</code> with <code dir="ltr">DBMS_SERVER_ALERT.SET_THRESHOLD</code>.</p>
<p class="subhead2"><a id="ADMIN12623"></a>Modifying Database Default Thresholds</p>
<p>To modify database default thresholds for locally managed tablespaces, invoke <code dir="ltr">DBMS_SERVER_ALERT.SET_THRESHOLD</code> as shown in the previous example, but set <code dir="ltr">object_name</code> to <code dir="ltr">NULL</code>. All tablespaces that use the database default are then switched to the new default.</p>
</div>
<!-- class="sect2" -->
<div id="ADMIN11568" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref2008"></a>
<h3 class="sect2">Viewing A<a id="sthref2009"></a><a id="sthref2010"></a>lerts</h3>
<p>You view alerts by accessing the home page of Enterprise Manager Database Control.</p>
<img width="787" height="292" src="img/alerts_tablespace_full.gif" alt="Description of alerts_tablespace_full.gif follows" /><br />
<a id="sthref2011" href="img_text/alerts_tablespace_full.htm">Description of the illustration alerts_tablespace_full.gif</a><br />
<br />
<p>You can also view alerts for locally managed tablespaces with the <code dir="ltr">DBA_OUTSTANDING_ALERTS</code> view. See <a href="monitoring.htm#manprocViewingAlertData23">"Server-Generated Alerts Data Dictionary Views"</a> for more information.</p>
</div>
<!-- class="sect2" -->
<div id="ADMIN11569" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref2012"></a>
<h3 class="sect2">Limitations</h3>
<p>Threshold-based alerts have the following limitations:</p>
<ul>
<li>
<p>Alerts are not issued for locally managed tablespaces that are offline or in read-only mode. However, the database reactivates the alert system for such tablespaces after they become read/write or available.</p>
</li>
<li>
<p>When you take a tablespace offline or put it in read-only mode, you should disable the alerts for the tablespace by setting the thresholds to zero. You can then reenable the alerts by resetting the thresholds when the tablespace is once again online and in read/write mode.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="monitoring.htm#CIHCAGAJ">"Monitoring Database Operations with Server-Generated Alerts"</a> for additional information on server-generated alerts in general</p>
</li>
<li>
<p><a class="olink ARPLS016" href="../../appdev.112/e40758/d_server_alert.htm#ARPLS016"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information on the procedures of the <code dir="ltr">DBMS_SERVER_ALERT</code> package and how to use them</p>
</li>
<li>
<p><a href="#i1006922">"Reclaiming Wasted Space"</a> for various ways to reclaim space that is no longer being used in the tablespace</p>
</li>
<li>
<p><a href="tables.htm#i1011357">"Purging Objects in the Recycle Bin"</a> for information on reclaiming recycle bin space</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006574"></a>
<div id="ADMIN11581" class="sect1">
<h2 class="sect1">Managing Resumable Space Allocation<a id="sthref2013"></a></h2>
<p>Oracle Database provides a means for suspending, and later resuming, the execution of large database operations in the event of space allocation failures. Therefore, you can take corrective action instead of the Oracle Database server returning an error to the user. After the error condition is corrected, the suspended operation automatically resumes. This feature is called <span class="bold">resumable space allocation</span>. The statements that are affected are called resumable statements.</p>
<p>This section contains the following topics:</p>
<ul>
<li>
<p><a href="#i1006595">Resumable Space Allocation Overview</a></p>
</li>
<li>
<p><a href="#i1006676">Enabling and Disabling Resumable Space Allocation</a></p>
</li>
<li>
<p><a href="#i1006746">Detecting Suspended Statements</a></p>
</li>
<li>
<p><a href="#CHDBCEFJ">Operation-Suspended Alert</a></p>
</li>
<li>
<p><a href="#i1006839">Resumable Space Allocation Example: Registering an AFTER SUSPEND Trigger</a></p>
</li>
</ul>
<a id="i1006595"></a>
<div id="ADMIN11582" class="sect2">
<h3 class="sect2">Resumable Space Allocation Overview</h3>
<p>This section provides an overview of resumable space allocation. It describes how resumable space allocation works, and specifically defines qualifying statements and error conditions.</p>
<div id="ADMIN11583" class="sect3"><a id="sthref2014"></a>
<h4 class="sect3">How Resumable Space Allocation Works<a id="sthref2015"></a></h4>
<p>The following is an overview of how resumable space allocation works. Details are contained in later sections.</p>
<ol>
<li>
<p>A statement executes in resumable mode only if its session has been enabled for resumable space allocation by one of the following actions:</p>
<ul>
<li>
<p>The <code dir="ltr">ALTER SESSION ENABLE RESUMABLE</code> statement is issued in the session before the statement executes when the <code dir="ltr"><a id="sthref2016"></a>RESUMABLE_TIMEOUT</code> initialization parameter is set to a nonzero value.</p>
</li>
<li>
<p>The <code dir="ltr">ALTER SESSION ENABLE RESUMABLE TIMEOUT</code> <code dir="ltr"><span class="codeinlineitalic">timeout_value</span></code> statement is issued in the session before the statement executes, and the <code dir="ltr"><span class="codeinlineitalic">timeout_value</span></code> is a nonzero value.</p>
</li>
</ul>
</li>
<li>
<p>A resumable statement is suspended when one of the following conditions occur (these conditions result in corresponding errors being signalled for non-resumable statements):</p>
<ul>
<li>
<p>Out of space condition</p>
</li>
<li>
<p>Maximum extents reached condition</p>
</li>
<li>
<p>Space quota exceeded condition.</p>
</li>
</ul>
</li>
<li>
<p>When the execution of a resumable statement is suspended, there are mechanisms to perform user supplied operations, log errors, and query the status of the statement execution. When a resumable statement is suspended the following actions are taken:</p>
<ul>
<li>
<p>The error is reported in the alert log.</p>
</li>
<li>
<p>The system issues the Resumable Session Suspended alert.</p>
</li>
<li>
<p>If the user registered a trigger on the <code dir="ltr">AFTER SUSPEND</code> system event, the user trigger is executed. A user supplied PL/SQL procedure can access the error message data using the <code dir="ltr">DBMS_RESUMABLE</code> package and the <code dir="ltr">DBA_</code> or <code dir="ltr">USER_RESUMABLE</code> view.</p>
</li>
</ul>
</li>
<li>
<p>Suspending a statement automatically results in suspending the transaction. Thus all transactional resources are held through a statement suspend and resume.</p>
</li>
<li>
<p>When the error condition is resolved (for example, as a result of user intervention or perhaps sort space released by other queries), the suspended statement automatically resumes execution and the Resumable Session Suspended alert is cleared.</p>
</li>
<li>
<p>A suspended statement can be forced to throw the exception using the <code dir="ltr">DBMS_RESUMABLE.ABORT()</code> procedure. This procedure can be called by a DBA, or by the user who issued the statement.</p>
</li>
<li>
<p>A suspension time out interval, specified by the <code dir="ltr">RESUMABLE_TIMEOUT</code> initialization parameter or by the timeout value in the <code dir="ltr">ALTER</code> <code dir="ltr">SESSION</code> <code dir="ltr">ENABLE</code> <code dir="ltr">RESUMABLE</code> <code dir="ltr">TIMEOUT</code> statement, is associated with resumable statements. A resumable statement that is suspended for the timeout interval wakes up and returns the exception to the user if the error condition is not resolved within the timeout interval.</p>
</li>
<li>
<p>A resumable statement can be suspended and resumed multiple times during execution.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<div id="ADMIN11584" class="sect3"><a id="sthref2017"></a>
<h4 class="sect3">What Operations are Resumable?<a id="sthref2018"></a></h4>
<p>The following operations are resumable:</p>
<ul>
<li>
<p>Queries</p>
<p><code dir="ltr">SELECT</code> statements that run out of temporary space (for sort areas) are candidates for resumable execution. When using OCI, the calls <code dir="ltr">OCIStmtExecute()</code> and <code dir="ltr">OCIStmtFetch()</code> are candidates.</p>
</li>
<li>
<p>DML</p>
<p><code dir="ltr">INSERT</code>, <code dir="ltr">UPDATE</code>, and <code dir="ltr">DELETE</code> statements are candidates. The interface used to execute them does not matter; it can be OCI, SQLJ, PL/SQL, or another interface. Also, <code dir="ltr">INSERT INTO...SELECT</code> from external tables can be resumable.</p>
</li>
<li>
<p>Import/Export</p>
<p>As for SQL*Loader, a command line parameter controls whether statements are resumable after recoverable errors.</p>
</li>
<li>
<p>DDL</p>
<p>The following statements are candidates for resumable execution:</p>
<ul>
<li>
<p><code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> ... <code dir="ltr">AS</code> <code dir="ltr">SELECT</code></p>
</li>
<li>
<p><code dir="ltr">CREATE</code> <code dir="ltr">INDEX</code></p>
</li>
<li>
<p><code dir="ltr">ALTER</code> <code dir="ltr">INDEX</code> ... <code dir="ltr">REBUILD</code></p>
</li>
<li>
<p><code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> ... <code dir="ltr">MOVE</code> <code dir="ltr">PARTITION</code></p>
</li>
<li>
<p><code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> ... <code dir="ltr">SPLIT</code> <code dir="ltr">PARTITION</code></p>
</li>
<li>
<p><code dir="ltr">ALTER</code> <code dir="ltr">INDEX</code> ... <code dir="ltr">REBUILD</code> <code dir="ltr">PARTITION</code></p>
</li>
<li>
<p><code dir="ltr">ALTER</code> <code dir="ltr">INDEX</code> ... <code dir="ltr">SPLIT</code> <code dir="ltr">PARTITION</code></p>
</li>
<li>
<p><code dir="ltr">CREATE</code> <code dir="ltr">MATERIALIZED</code> <code dir="ltr">VIEW</code></p>
</li>
<li>
<p><code dir="ltr">CREATE</code> <code dir="ltr">MATERIALIZED</code> <code dir="ltr">VIEW</code> <code dir="ltr">LOG</code></p>
</li>
</ul>
</li>
</ul>
</div>
<!-- class="sect3" -->
<div id="ADMIN11585" class="sect3"><a id="sthref2019"></a>
<h4 class="sect3">What Errors are Correctable?<a id="sthref2020"></a></h4>
<p>There are three classes of correctable errors:</p>
<ul>
<li>
<p>Out of space condition</p>
<p>The operation cannot acquire any more extents for a table/index/temporary segment/undo segment/cluster/LOB/table partition/index partition in a tablespace. For example, the following errors fall in this category:</p>
<pre dir="ltr">
ORA-01653 unable to extend table ... in tablespace ...
ORA-01654 unable to extend index ... in tablespace ...
</pre></li>
<li>
<p>Maximum extents reached condition</p>
<p>The number of extents in a table/index/temporary segment/undo segment/cluster/LOB/table partition/index partition equals the maximum extents defined on the object. For example, the following errors fall in this category:</p>
<pre dir="ltr">
ORA-01631 max # extents ... reached in table ...
ORA-01632 max # extents ... reached in index ...
</pre></li>
<li>
<p>Space quota exceeded condition</p>
<p>The user has exceeded his assigned space quota in the tablespace. Specifically, this is noted by the following error:</p>
<pre dir="ltr">
ORA-01536 space quote exceeded for tablespace <span class="italic">string</span> 
</pre></li>
</ul>
</div>
<!-- class="sect3" -->
<div id="ADMIN11586" class="sect3"><a id="sthref2021"></a>
<h4 class="sect3">Resumable Space Allocation and Distributed Operations<a id="sthref2022"></a><a id="sthref2023"></a></h4>
<p>In a distributed environment, if a user enables or disables resumable space allocation, or a DBA alters the <code dir="ltr">RESUMABLE_TIMEOUT</code> initialization parameter, then the local instance is affected. <code dir="ltr">RESUMABLE</code> cannot be enabled remotely. In a distributed transaction, sessions on remote instances are suspended only if the remote instance has already enabled <code dir="ltr">RESUMABLE</code> on the instance or sessions at its site.</p>
</div>
<!-- class="sect3" -->
<div id="ADMIN11587" class="sect3"><a id="sthref2024"></a>
<h4 class="sect3">Parallel Execution and Resumable Space Allocation<a id="sthref2025"></a><a id="sthref2026"></a></h4>
<p>In parallel execution, if one of the parallel execution server processes encounters a correctable error, that server process suspends its execution. Other parallel execution server processes will continue executing their respective tasks, until either they encounter an error or are blocked (directly or indirectly) by the suspended server process. When the correctable error is resolved, the suspended process resumes execution and the parallel operation continues execution. If the suspended operation is terminated, the parallel operation aborts, throwing the error to the user.</p>
<p>Different parallel execution server processes may encounter one or more correctable errors. This may result in firing an <code dir="ltr">AFTER SUSPEND</code> trigger multiple times, in parallel. Also, if a parallel execution server process encounters a non-correctable error while another parallel execution server process is suspended, the suspended statement is immediately aborted.</p>
<p>For parallel execution, every parallel execution coordinator and server process has its own entry in the <code dir="ltr">DBA</code>_ or <code dir="ltr">USER_RESUMABLE</code> view.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1006676"></a>
<div id="ADMIN11588" class="sect2">
<h3 class="sect2">Enabling and Disabling Resumable Space Allocation<a id="sthref2027"></a><a id="sthref2028"></a></h3>
<p>Resumable space allocation is only possible when statements are executed within a session that has resumable mode enabled.</p>
<p>Resumable space allocation is enabled for a session when the <code dir="ltr">ALTER SESSION ENABLE RESUMABLE</code> statement is executed, and the <code dir="ltr">RESUMABLE_TIMEOUT</code> initialization parameter is set to a non-zero value for the session. When the <code dir="ltr">RESUMABLE_TIMEOUT</code> initialization parameter is set at the system level, it is the default for an <code dir="ltr">ALTER SESSION ENABLE RESUMABLE</code> statement that does not specify a timeout value. When an <code dir="ltr">ALTER SESSION ENABLE RESUMABLE</code> statement specifies a timeout value, it overrides the system default.</p>
<p>Resumable space allocation is disabled for a session in all of the following cases when the <code dir="ltr">ALTER SESSION ENABLE RESUMABLE</code> statement is executed</p>
<ul>
<li>
<p>The session does not execute an <code dir="ltr">ALTER SESSION ENABLE RESUMABLE</code> statement.</p>
</li>
<li>
<p>The session executes an <code dir="ltr">ALTER SESSION DISABLE RESUMABLE</code> statement.</p>
</li>
<li>
<p>The session executes an <code dir="ltr">ALTER SESSION ENABLE RESUMABLE</code> statement, and the timeout value is zero.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Because suspended statements can hold up some system resources, users must be granted the <code dir="ltr">RESUMABLE</code> system privilege before they are allowed to enable resumable space allocation and execute resumable statements.</div>
<a id="i1007794"></a>
<div id="ADMIN11589" class="sect3">
<h4 class="sect3">Setting the <a id="sthref2029"></a>RESUMABLE_TIMEOUT Initialization Parameter</h4>
<p>You can specify a default system wide timeout interval by setting the <code dir="ltr">RESUMABLE_TIMEOUT</code> initialization parameter. For example, the following setting of the <code dir="ltr">RESUMABLE_TIMEOUT</code> parameter in the initialization parameter file sets the timeout period to 1 hour:</p>
<pre dir="ltr">
RESUMABLE_TIMEOUT  = 3600
</pre>
<p>If this parameter is set to 0, then resumable space allocation is disabled even for sessions that run an <code dir="ltr">ALTER SESSION ENABLE RESUMABLE</code> statement without a timeout value.</p>
<p>You can also use the <code dir="ltr">ALTER SYSTEM SET</code> statement to change the value of this parameter at the system level. For example, the following statement disables resumable space allocation for all sessions that run an <code dir="ltr">ALTER SESSION ENABLE RESUMABLE</code> statement without a timeout value:</p>
<pre dir="ltr">
ALTER SYSTEM SET RESUMABLE_TIMEOUT=0;
</pre></div>
<!-- class="sect3" -->
<div id="ADMIN11590" class="sect3"><a id="sthref2030"></a>
<h4 class="sect3">Using <a id="sthref2031"></a>ALTER SESSION to Enable and Disable Resumable Space Allocation</h4>
<p>Within a session, a user can issue the <code dir="ltr">ALTER SESSION SET</code> statement to set the <code dir="ltr">RESUMABLE_TIMEOUT</code> initialization parameter and enable resumable space allocation, change a timeout value, or to disable resumable mode.</p>
<p>A user can enable resumable mode for a session with the default system <code dir="ltr">RESUMABLE_TIMEOUT</code> value using the following SQL statement:</p>
<pre dir="ltr">
ALTER SESSION ENABLE RESUMABLE;
</pre>
<p>To disable resumable mode, a user issues the following statement:</p>
<pre dir="ltr">
ALTER SESSION DISABLE RESUMABLE;
</pre>
<p>The default for a new session is resumable mode disabled.</p>
<p>The user can also specify a timeout interval, and can provide a name used to identify a resumable statement. These are discussed separately in following sections.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#i1006726">"Using a LOGON Trigger to Set Default Resumable Mode"</a></div>
<div id="ADMIN11591" class="sect4"><a id="sthref2032"></a>
<h5 class="sect4">Specifying a Timeout <a id="sthref2033"></a>Interval</h5>
<p>A timeout period, after which a suspended statement will error if no intervention has taken place, can be specified when resumable mode is enabled. The following statement specifies that resumable transactions will time out and error after 3600 seconds:</p>
<pre dir="ltr">
ALTER SESSION ENABLE RESUMABLE TIMEOUT 3600;
</pre>
<p>The value of <code dir="ltr">TIMEOUT</code> remains in effect until it is changed by another <code dir="ltr">ALTER SESSION ENABLE RESUMABLE</code> statement, it is changed by another means, or the session ends. If the <code dir="ltr">RESUMABLE_TIMEOUT</code> initialization parameter is not set, then the default timeout interval when using the <code dir="ltr">ENABLE RESUMABLE TIMEOUT</code> clause to enable resumable mode is 7200 seconds.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#i1007794">"Setting the RESUMABLE_TIMEOUT Initialization Parameter"</a> for other methods of changing the timeout interval for resumable space allocation</div>
</div>
<!-- class="sect4" -->
<div id="ADMIN11592" class="sect4"><a id="sthref2034"></a>
<h5 class="sect4">Naming Resumable Statements<a id="sthref2035"></a></h5>
<p>Resumable statements can be identified by name. The following statement assigns a name to resumable statements:</p>
<pre dir="ltr">
ALTER SESSION ENABLE RESUMABLE TIMEOUT 3600 NAME 'insert into table';
</pre>
<p>The <code dir="ltr">NAME</code> value remains in effect until it is changed by another <code dir="ltr">ALTER SESSION ENABLE RESUMABLE</code> statement, or the session ends. The default value for <code dir="ltr">NAME</code> is '<code dir="ltr">User</code> <code dir="ltr"><span class="codeinlineitalic">username</span></code>(<code dir="ltr"><span class="codeinlineitalic">userid</span></code>), <code dir="ltr">Session</code> <code dir="ltr"><span class="codeinlineitalic">sessionid</span></code>, <code dir="ltr">Instance</code> <code dir="ltr"><span class="codeinlineitalic">instanceid</span></code>'.</p>
<p>The name of the statement is used to identify the resumable statement in the <code dir="ltr">DBA_RESUMABLE</code> and <code dir="ltr">USER_RESUMABLE</code> views.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1006726"></a>
<div id="ADMIN11593" class="sect2">
<h3 class="sect2">Using a LOGON Trigger to Set Default Resumable Mode<a id="sthref2036"></a><a id="sthref2037"></a></h3>
<p>Another method of setting default resumable mode, other than setting the <code dir="ltr">RESUMABLE_TIMEOUT</code> initialization parameter, is that you can register a database level <code dir="ltr">LOGON</code> trigger to alter a user's session to enable resumable and set a timeout interval.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If there are multiple triggers registered that change default mode and timeout for resumable statements, the result will be unspecified because Oracle Database does not guarantee the order of trigger invocation.</div>
</div>
<!-- class="sect2" -->
<a id="i1006746"></a>
<div id="ADMIN11594" class="sect2">
<h3 class="sect2">Detecting Suspended Statements<a id="sthref2038"></a></h3>
<p>When a resumable statement is suspended, the error is not raised to the client. In order for corrective action to be taken, Oracle Database provides alternative methods for notifying users of the error and for providing information about the circumstances.</p>
<div id="ADMIN11595" class="sect3"><a id="sthref2039"></a>
<h4 class="sect3">Notifying Users: The AFTER SUSPEND System Event and Trigger</h4>
<p>When a resumable statement encounter a correctable error, the system internally generates the <code dir="ltr"><a id="sthref2040"></a>AFTER SUSPEND</code> system event. Users can register triggers for this event at both the database and schema level. If a user registers a trigger to handle this system event, the trigger is executed after a SQL statement has been suspended.</p>
<p>SQL statements executed within a <code dir="ltr"><a id="sthref2041"></a>AFTER SUSPEND</code> trigger are always non-resumable and are always autonomous. Transactions started within the trigger use the <code dir="ltr">SYSTEM</code> rollback segment. These conditions are imposed to overcome deadlocks and reduce the chance of the trigger experiencing the same error condition as the statement.</p>
<p>Users can use the <code dir="ltr"><a id="sthref2042"></a><a id="sthref2043"></a>USER_RESUMABLE</code> or <code dir="ltr"><a id="sthref2044"></a><a id="sthref2045"></a>DBA_RESUMABLE</code> views, or the <code dir="ltr">DBMS_RESUMABLE.<a id="sthref2046"></a>SPACE_ERROR_INFO</code> function, within triggers to get information about the resumable statements.</p>
<p>Triggers can also call the <code dir="ltr">DBMS_RESUMABLE</code> package to terminate suspended statements and modify resumable timeout values. In the following example, the default system timeout is changed<a id="sthref2047"></a> by creating a system wide <code dir="ltr">AFTER SUSPEND</code> trigger that calls <code dir="ltr">DBMS_RESUMABLE</code> to set the timeout to 3 hours:</p>
<pre dir="ltr">
CREATE OR REPLACE TRIGGER resumable_default_timeout
AFTER SUSPEND
ON DATABASE
BEGIN
   DBMS_RESUMABLE.SET_TIMEOUT(10800);
END;
/
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink LNPLS020" href="../../appdev.112/e25519/triggers.htm#LNPLS020"><span class="italic">Oracle Database PL/SQL Language Reference</span></a> for information about triggers and system events</div>
</div>
<!-- class="sect3" -->
<div id="ADMIN11596" class="sect3"><a id="sthref2048"></a>
<h4 class="sect3">Using Views to Obtain Information About Suspended Statements</h4>
<p>The following views can be queried to obtain information about the status of resumable statements:</p>
<div class="inftblruleinformal">
<table class="cellalignment1333" title="Viewing Information About Resumable Statements" summary="Column 1 contains the names of views that contain information about suspended statements. Column 2 describes each view." dir="ltr">
<thead>
<tr class="cellalignment1327">
<th class="cellalignment1334" id="r1c1-t10">View</th>
<th class="cellalignment1334" id="r1c2-t10">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r2c1-t10" headers="r1c1-t10"><code dir="ltr">DBA_RESUMABLE</code>
<p><code dir="ltr">USER_RESUMABLE</code></p>
</td>
<td class="cellalignment1335" headers="r2c1-t10 r1c2-t10">These views contain rows for all currently executing or suspended resumable statements. They can be used by a DBA, <code dir="ltr">AFTER SUSPEND</code> trigger, or another session to monitor the progress of, or obtain specific information about, resumable statements.</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r3c1-t10" headers="r1c1-t10"><code dir="ltr">V$SESSION_WAIT</code></td>
<td class="cellalignment1335" headers="r3c1-t10 r1c2-t10">When a statement is suspended the session invoking the statement is put into a wait state. A row is inserted into this view for the session with the <code dir="ltr">EVENT</code> column containing "statement suspended, wait error to be cleared".</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblruleinformal" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN" href="../e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a> for specific information about the columns contained in these views</div>
</div>
<!-- class="sect3" -->
<div id="ADMIN11597" class="sect3"><a id="sthref2049"></a>
<h4 class="sect3">Using the <a id="sthref2050"></a><a id="sthref2051"></a>DBMS_RESUMABLE Package</h4>
<p>The <code dir="ltr">DBMS_RESUMABLE</code> package helps control resumable space allocation. The following procedures can be invoked:</p>
<div class="inftblruleinformal">
<table class="cellalignment1333" title="DBMS_RESUMABLE Procedures" summary="Column 1 contains the names of procedures in the DBMS_RESUMABLE package. Column 2 describes the procedures." dir="ltr">
<thead>
<tr class="cellalignment1327">
<th class="cellalignment1334" id="r1c1-t12">Procedure</th>
<th class="cellalignment1334" id="r1c2-t12">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r2c1-t12" headers="r1c1-t12"><code dir="ltr">ABORT(sessionID)</code></td>
<td class="cellalignment1335" headers="r2c1-t12 r1c2-t12">This procedure aborts a suspended resumable statement. The parameter <code dir="ltr">sessionID</code> is the session ID in which the statement is executing. For parallel DML/DDL, <code dir="ltr">sessionID</code> is any session ID which participates in the parallel DML/DDL.
<p>Oracle Database guarantees that the <code dir="ltr">ABORT</code> operation always succeeds. It may be called either inside or outside of the <code dir="ltr">AFTER SUSPEND</code> trigger.</p>
<p>The caller of <code dir="ltr">ABORT</code> must be the owner of the session with <code dir="ltr">sessionID</code>, have <code dir="ltr">ALTER SYSTEM</code> privilege, or have DBA privileges.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r3c1-t12" headers="r1c1-t12"><code dir="ltr">GET_SESSION_TIMEOUT(sessionID)</code></td>
<td class="cellalignment1335" headers="r3c1-t12 r1c2-t12">This function returns the current timeout value of resumable space allocation for the session with <code dir="ltr">sessionID</code>. This returned timeout is in seconds. If the session does not exist, this function returns -1.</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r4c1-t12" headers="r1c1-t12"><code dir="ltr">SET_SESSION_TIMEOUT(sessionID, timeout)</code></td>
<td class="cellalignment1335" headers="r4c1-t12 r1c2-t12">This procedure sets the timeout interval of resumable space allocation for the session with <code dir="ltr">sessionID</code>. The parameter <code dir="ltr">timeout</code> is in seconds. The new <code dir="ltr">timeout</code> setting will applies to the session immediately. If the session does not exist, no action is taken.</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r5c1-t12" headers="r1c1-t12"><code dir="ltr">GET_TIMEOUT()</code></td>
<td class="cellalignment1335" headers="r5c1-t12 r1c2-t12">This function returns the current <code dir="ltr">timeout</code> value of resumable space allocation for the current session. The returned value is in seconds.</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r6c1-t12" headers="r1c1-t12"><code dir="ltr">SET_TIMEOUT(timeout)</code></td>
<td class="cellalignment1335" headers="r6c1-t12 r1c2-t12">This procedure sets a <code dir="ltr">timeout</code> value for resumable space allocation for the current session. The parameter <code dir="ltr">timeout</code> is in seconds. The new timeout setting applies to the session immediately.</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblruleinformal" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS143" href="../../appdev.112/e40758/d_resuma.htm#ARPLS143"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for details about the <code dir="ltr">DBMS_RESUMABLE</code> package.</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDBCEFJ"></a>
<div id="ADMIN11598" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Operation-Suspended Alert</h3>
<p>When a resumable session is suspended, an operation-suspended alert is issued on the object that needs allocation of resource for the operation to complete. Once the resource is allocated and the operation completes, the operation-suspended alert is cleared. See <a href="#CHDHEHDB">"Managing Tablespace Alerts"</a> for more information on system-generated alerts.</p>
</div>
<!-- class="sect2" -->
<a id="i1006839"></a>
<div id="ADMIN11599" class="sect2">
<h3 class="sect2"><a id="sthref2052"></a><a id="sthref2053"></a>Resumable Space Allocation Example: Registering an AFTER SUSPEND Trigger</h3>
<p>In the following example, a system wide <code dir="ltr">AFTER SUSPEND</code> trigger is created and registered as user <code dir="ltr">SYS</code> at the database level. Whenever a resumable statement is suspended in any session, this trigger can have either of two effects:</p>
<ul>
<li>
<p>If an undo segment has reached its space limit, then a message is sent to the DBA and the statement is aborted.</p>
</li>
<li>
<p>If any other recoverable error has occurred, the timeout interval is reset to 8 hours.</p>
</li>
</ul>
<p>Here are the statements for this example:</p>
<pre dir="ltr">
CREATE OR REPLACE TRIGGER resumable_default
AFTER SUSPEND
ON DATABASE
DECLARE
   /* declare transaction in this trigger is autonomous */
   /* this is not required because transactions within a trigger
      are always autonomous */
   PRAGMA AUTONOMOUS_TRANSACTION;
   cur_sid           NUMBER;
   cur_inst          NUMBER;
   errno             NUMBER;
   err_type          VARCHAR2;
   object_owner      VARCHAR2;
   object_type       VARCHAR2;
   table_space_name  VARCHAR2;
   object_name       VARCHAR2;
   sub_object_name   VARCHAR2;
   error_txt         VARCHAR2;
   msg_body          VARCHAR2;
   ret_value         BOOLEAN;
   mail_conn         UTL_SMTP.CONNECTION;
BEGIN
   -- Get session ID
   SELECT DISTINCT(SID) INTO cur_SID FROM V$MYSTAT;

   -- Get instance number
   cur_inst := userenv('instance');

   -- Get space error information
   ret_value := 
   DBMS_RESUMABLE.SPACE_ERROR_INFO(err_type,object_type,object_owner,
        table_space_name,object_name, sub_object_name);
   /*
   -- If the error is related to undo segments, log error, send email
   -- to DBA, and abort the statement. Otherwise, set timeout to 8 hours.
   -- 
   -- sys.rbs_error is a table which is to be
   -- created by a DBA manually and defined as
   -- (sql_text VARCHAR2(1000), error_msg VARCHAR2(4000),
   -- suspend_time DATE)
   */

   IF OBJECT_TYPE = 'UNDO SEGMENT' THEN
       /* LOG ERROR */
       INSERT INTO sys.rbs_error (
           SELECT SQL_TEXT, ERROR_MSG, SUSPEND_TIME
           FROM DBMS_RESUMABLE
           WHERE SESSION_ID = cur_sid AND INSTANCE_ID = cur_inst
        );
       SELECT ERROR_MSG INTO error_txt FROM DBMS_RESUMABLE 
           WHERE SESSION_ID = cur_sid and INSTANCE_ID = cur_inst;

        -- Send email to receipient through UTL_SMTP package
        msg_body:='Subject: Space Error Occurred

                   Space limit reached for undo segment ' || object_name || 
                   on ' || TO_CHAR(SYSDATE, 'Month dd, YYYY, HH:MIam') ||
                   '. Error message was ' || error_txt;

        mail_conn := UTL_SMTP.OPEN_CONNECTION('localhost', 25);
        UTL_SMTP.HELO(mail_conn, 'localhost');
        UTL_SMTP.MAIL(mail_conn, 'sender@localhost');
        UTL_SMTP.RCPT(mail_conn, 'recipient@localhost');
        UTL_SMTP.DATA(mail_conn, msg_body);
        UTL_SMTP.QUIT(mail_conn);

        -- Abort the statement
        DBMS_RESUMABLE.ABORT(cur_sid);
    ELSE
        -- Set timeout to 8 hours
        DBMS_RESUMABLE.SET_TIMEOUT(28800);
    END IF;

    /* commit autonomous transaction */
    COMMIT;   
END;
/
</pre></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006922"></a>
<div id="ADMIN01401" class="sect1">
<h2 class="sect1">Reclaiming Wasted Space<a id="sthref2054"></a><a id="sthref2055"></a><a id="sthref2056"></a><a id="sthref2057"></a><a id="sthref2058"></a><a id="sthref2059"></a><a id="sthref2060"></a></h2>
<p>This section explains how to reclaim wasted space, and also introduces the Segment Advisor, which is the Oracle Database component that identifies segments that have space available for reclamation. The following topics are covered:</p>
<ul>
<li>
<p><a href="#CBBIEGGC">Understanding Reclaimable Unused Space</a></p>
</li>
<li>
<p><a href="#CHDHBHAB">Using the Segment Advisor</a></p>
</li>
<li>
<p><a href="#CBBBIADA">Shrinking Database Segments Online</a></p>
</li>
<li>
<p><a href="#CBBBCHJI">Deallocating Unused Space</a></p>
</li>
</ul>
<a id="CBBIEGGC"></a>
<div id="ADMIN11600" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Understanding Reclaimable Unused Space</h3>
<p>Over time, updates and deletes on objects within a tablespace can create pockets of empty space that individually are not large enough to be reused for new data. This type of empty space is referred to as fragmented free space.</p>
<p>Objects with fragmented free space can result in much wasted space, and can impact database performance. The preferred way to defragment and reclaim this space is to perform an <span class="bold">online segment shrink</span>. This process consolidates fragmented free space below the high water mark and compacts the segment. After compaction, the high water mark is moved, resulting in new free space above the high water mark. That space above the high water mark is then deallocated. The segment remains available for queries and DML during most of the operation, and no extra disk space need be allocated.</p>
<p>You use the <span class="bold">Segment Advisor</span> to identify segments that would benefit from online segment shrink. Only segments in locally managed tablespaces with automatic segment space management (ASSM) are eligible. Other restrictions on segment type exist. For more information, see <a href="#CBBBIADA">"Shrinking Database Segments Online"</a>.</p>
<p>If a table with reclaimable space is not eligible for online segment shrink, or if you want to make changes to logical or physical attributes of the table while reclaiming space, then you can use <span class="bold">online table redefinition</span> as an alternative to segment shrink. Online redefinition is also referred to as <span class="bold">reorganization</span>. Unlike online segment shrink, it requires extra disk space to be allocated. See <a href="tables.htm#i1006754">"Redefining Tables Online"</a> for more information.</p>
</div>
<!-- class="sect2" -->
<a id="CHDHBHAB"></a>
<div id="ADMIN11601" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Using the Segment Advisor<a id="sthref2061"></a></h3>
<p>The Segment Advisor identifies segments that have space available for reclamation. It performs its analysis by examining usage and growth statistics in the Automatic Workload Repository (AWR), and by sampling the data in the segment. It is configured to run during maintenance windows as an automated maintenance task, and you can also run it on demand (manually). The Segment Advisor automated maintenance task is known as the Automatic Segment Advisor.</p>
<p>The Segment Advisor generates the following types of advice:</p>
<ul>
<li>
<p>If the Segment Advisor determines that an object has a significant amount of free space, it recommends online segment shrink. If the object is a table that is not eligible for shrinking, as in the case of a table in a tablespace without automatic segment space management, the Segment Advisor recommends online table redefinition.</p>
</li>
<li>
<p>If the Segment Advisor determines that a table could benefit from compression with the OLTP compression method, it makes a recommendation to that effect. (Automatic Segment Advisor only. See <a href="#CBBDDBJH">"Automatic Segment Advisor"</a>.)</p>
</li>
<li>
<p>If the Segment Advisor encounters a table with row chaining above a certain threshold, it records that fact that the table has an excess of chained rows.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The Segment Advisor flags only the type of row chaining that results from updates that increase row length.</div>
</li>
</ul>
<p>If you receive a space management alert, or if you decide that you want to reclaim space, you should start with the Segment Advisor.</p>
<p><span class="bold">To use the Segment Advisor</span>:</p>
<ol>
<li>
<p>Check the results of the Automatic Segment Advisor.</p>
<p>To understand the Automatic Segment Advisor, see <a href="#CBBDDBJH">"Automatic Segment Advisor"</a>, later in this section. For details on how to view results, see <a href="#CBBJHIGH">"Viewing Segment Advisor Results"</a>.</p>
</li>
<li>
<p>(Optional) Obtain updated results on individual segments by rerunning the Segment Advisor manually.</p>
<p>See <a href="#CBBBJFGC">"Running the Segment Advisor Manually"</a>, later in this section.</p>
</li>
</ol>
<a id="CBBDDBJH"></a>
<div id="ADMIN11602" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Automatic Segment Advisor</h4>
<p>The Automatic Segment Advisor is an automated maintenance task that is configured to run during all maintenance windows.</p>
<p>The Automatic Segment Advisor does not analyze every database object. Instead, it examines database statistics, samples segment data, and then selects the following objects to analyze:</p>
<ul>
<li>
<p>Tablespaces that have exceeded a critical or warning space threshold</p>
</li>
<li>
<p>Segments that have the most activity</p>
</li>
<li>
<p>Segments that have the highest growth rate</p>
</li>
</ul>
<p>In addition, the Automatic Segment Advisor evaluates tables that are at least 10MB and that have at least three indexes to determine the amount of space saved if the tables are compressed with the OLTP compression method.</p>
<p>If an object is selected for analysis but the maintenance window expires before the Segment Advisor can process the object, the object is included in the next Automatic Segment Advisor run.</p>
<p>You cannot change the set of tablespaces and segments that the Automatic Segment Advisor selects for analysis. You can, however, enable or disable the Automatic Segment Advisor task, change the times during which the Automatic Segment Advisor is scheduled to run, or adjust automated maintenance task system resource utilization. See <a href="#CBBJICHA">"Configuring the Automatic Segment Advisor"</a> for more information.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CBBJHIGH">"Viewing Segment Advisor Results"</a></p>
</li>
<li>
<p><a href="tasks.htm#BABJIJFC">Chapter 26, "Managing Automated Database Maintenance Tasks"</a></p>
</li>
<li>
<p><a href="tables.htm#CJAGFBFG">"Consider Using Table Compression"</a> for more information on OLTP compression</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CBBBJFGC"></a>
<div id="ADMIN11603" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Running the Se<a id="sthref2062"></a>gment Advisor Manually</h4>
<p>You can manually run the Segment Advisor at any time with Enterprise Manager or with PL/SQL package procedure calls. Reasons to manually run the Segment Advisor include the following:</p>
<ul>
<li>
<p>You want to analyze a tablespace or segment that was not selected by the Automatic Segment Advisor.</p>
</li>
<li>
<p>You want to repeat the analysis of an individual tablespace or segment to get more up-to-date recommendations.</p>
</li>
</ul>
<p>You can request advice from the Segment Advisor at three levels:</p>
<ul>
<li>
<p><span class="bold">Segment level</span>&mdash;Advice is generated for a single segment, such as an unpartitioned table, a partition or subpartition of a partitioned table, an index, or a LOB column.</p>
</li>
<li>
<p><span class="bold">Object level</span>&mdash;Advice is generated for an entire object, such as a table or index. If the object is partitioned, advice is generated on all the partitions of the object. In addition, if you run Segment Advisor manually from Enterprise Manager, you can request advice on the object's dependent objects, such as indexes and LOB segments for a table.</p>
</li>
<li>
<p><span class="bold">Tablespace level</span>&mdash;Advice is generated for every segment in a tablespace.</p>
</li>
</ul>
<p>The <code dir="ltr">OBJECT_TYPE</code> column of <a href="#BABHCCCE">Table 19-2</a> shows the types of objects for which you can request advice.</p>
<div id="ADMIN11604" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref2063"></a>
<h5 class="sect4">Running the Segmen<a id="sthref2064"></a>t Advisor Manually with Enterprise Manager</h5>
<p>You must have the <code dir="ltr">OEM_ADVISOR</code> role to run the Segment Advisor manually with Enterprise Manager. There are two ways to run the Segment Advisor:</p>
<ul>
<li>
<p>Using the Segment Advisor Wizard</p>
<p>This method enables you to request advice at the tablespace level or object level. At the object level, you can request advice on tables, indexes, table partitions, and index partitions.</p>
</li>
<li>
<p>Using the Run Segment Advisor command on a schema object page.</p>
<p>For example, if you display a list of tables on the Tables page (accessible from the Schema page), you can select a table and then select the <span class="bold">Run Segment Advisor</span> command from the Actions menu.</p>
<div id="ADMIN13049" class="figure">
<p class="titleinfigure"><a id="CBBGDAJJ"></a>Figure 19-1 Tables page</p>
<img width="714" height="473" src="img/run_segment_advisor_command.gif" alt="Description of Figure 19-1 follows" /><br />
<a id="sthref2065" href="img_text/run_segment_advisor_command.htm">Description of "Figure 19-1 Tables page"</a><br />
<br /></div>
<!-- class="figure" -->
<p>This method enables you to include the schema object's dependent objects in the Segment Advisor run. For example, if you select a table and select the <span class="bold">Run Segment Advisor</span> command, Enterprise Manager displays the table's dependent objects, such as partitions, index segments, LOB segments, and so on. You can then select dependent objects to include in the run.</p>
</li>
</ul>
<p>In both cases, Enterprise Manager creates the Segment Advisor task as an Oracle Database Scheduler job. You can schedule the job to run immediately, or can take advantage of advanced scheduling features offered by the Scheduler.</p>
<p><span class="bold">To run the Segment Advisor manually with the Segment Advisor Wizard:</span></p>
<ol>
<li>
<p>From the database Home page, under Related Links, click <span class="bold">Advisor Central</span>.</p>
<p>The Advisor Central page appears. (See <a href="#CBBEFIGG">Figure 19-2</a>.)</p>
</li>
<li>
<p>Under Advisors, click <span class="bold">Segment Advisor</span>.</p>
<p>The first page of the Segment Advisor wizard appears.</p>
</li>
<li>
<p>Follow the wizard steps to schedule the Segment Advisor job, and then click <span class="bold">Submit</span> on the final wizard page.</p>
<p>The Advisor Central page reappears, with the new Segment Advisor job at the top of the list under the Results heading. The job status is <code dir="ltr">SCHEDULED</code> or <code dir="ltr">RUNNING</code>. (If you do not see your job, use the search fields above the list to display it.)</p>
</li>
<li>
<p>Check the status of the job. If it is not <code dir="ltr">COMPLETED</code>, click the <span class="bold">Refresh</span> button at the top of the page repeatedly. (Do not use your browser's Refresh icon.)</p>
<p>When the job status changes to <code dir="ltr">COMPLETED</code>, select the job by clicking in the <span class="bold">Select</span> column, and then click <span class="bold">View Result</span>.</p>
<div id="ADMIN13050" class="figure">
<p class="titleinfigure"><a id="CBBEFIGG"></a>Figure 19-2 Advisor Central page</p>
<img width="728" height="426" src="img/advisor_central.gif" alt="Description of Figure 19-2 follows" /><br />
<a id="sthref2066" href="img_text/advisor_central.htm">Description of "Figure 19-2 Advisor Central page"</a><br />
<br /></div>
<!-- class="figure" --></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="scheduse.htm#g1046708">Chapter 29, "Scheduling Jobs with Oracle Scheduler"</a> for more information about the advanced scheduling features of the Scheduler.</div>
</div>
<!-- class="sect4" -->
<div id="ADMIN11605" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref2067"></a>
<h5 class="sect4">Running the Segm<a id="sthref2068"></a>ent Advisor Manually with PL/SQL</h5>
<p>You can also run the Segment Advisor with the <code dir="ltr">DBMS_ADVISOR</code> package. You use package procedures to create a Segment Advisor task, set task arguments, and then execute the task. You must have the <code dir="ltr">ADVISOR</code> privilege. <a href="#CBBBIDCB">Table 19-1</a> shows the procedures that are relevant for the Segment Advisor. See <a class="olink ARPLS350" href="../../appdev.112/e40758/d_advis.htm#ARPLS350"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more details on these procedures.</p>
<div id="ADMIN13051" class="tblhruleformalwide">
<p class="titleintable"><a id="sthref2069"></a><a id="CBBBIDCB"></a>Table 19-1 DBMS_ADVISOR package procedures relevant to the Segment Advisor</p>
<table class="cellalignment1333" title="DBMS_ADVISOR package procedures relevant to the Segment Advisor" summary="This table contains four rows, one for each procedure in the DBMS_ADVISOR package that is relevant for the Segment Advisor. Each row contains the procedure name and description." dir="ltr">
<thead>
<tr class="cellalignment1327">
<th class="cellalignment1334" id="r1c1-t17">Package Procedure Name</th>
<th class="cellalignment1334" id="r1c2-t17">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r2c1-t17" headers="r1c1-t17">
<p><code dir="ltr">CREATE_TASK</code></p>
</td>
<td class="cellalignment1335" headers="r2c1-t17 r1c2-t17">
<p>Use this procedure to create the Segment Advisor task. Specify 'Segment Advisor' as the value of the <code dir="ltr">ADVISOR_NAME</code> parameter.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r3c1-t17" headers="r1c1-t17">
<p><code dir="ltr">CREATE_OBJECT</code></p>
</td>
<td class="cellalignment1335" headers="r3c1-t17 r1c2-t17">
<p>Use this procedure to identify the target object for segment space advice. The parameter values of this procedure depend upon the object type. <a href="#BABHCCCE">Table 19-2</a> lists the parameter values for each type of object.</p>
<p>Note: To request advice on an IOT overflow segment, use an object type of <code dir="ltr">TABLE</code>, <code dir="ltr">TABLE</code> <code dir="ltr">PARTITION</code>, or <code dir="ltr">TABLE</code> <code dir="ltr">SUBPARTITION</code>. Use the following query to find the overflow segment for an IOT and to determine the overflow segment table name to use with <code dir="ltr">CREATE_OBJECT</code>:</p>
<pre dir="ltr">
select table_name, iot_name, iot_type from dba_tables;
</pre></td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r4c1-t17" headers="r1c1-t17">
<p><code dir="ltr">SET_TASK_PARAMETER</code></p>
</td>
<td class="cellalignment1335" headers="r4c1-t17 r1c2-t17">
<p>Use this procedure to describe the segment advice that you need. <a href="#BABBHDBI">Table 19-3</a> shows the relevant input parameters of this procedure. Parameters not listed here are not used by the Segment Advisor.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r5c1-t17" headers="r1c1-t17">
<p><code dir="ltr">EXECUTE_TASK</code></p>
</td>
<td class="cellalignment1335" headers="r5c1-t17 r1c2-t17">
<p>Use this procedure to execute the Segment Advisor task.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformalwide" -->
<div id="ADMIN13052" class="tblhruleformalwide">
<p class="titleintable"><a id="sthref2070"></a><a id="BABHCCCE"></a>Table 19-2 Input for DBMS_ADVISOR.CREATE_OBJECT</p>
<table class="cellalignment1333" title="Input for DBMS_ADVISOR.CREATE_OBJECT" summary="Column 1 contains the values for the OBJECT_TYPE parameter. The following 4 columns list the corresponding ATTR1, ATTR2, ATTR3, and ATTR4 values." dir="ltr">
<thead>
<tr class="cellalignment1327">
<th class="cellalignment1334" id="r1c1-t18" colspan="5">Input Parameter</th>
</tr>
<tr class="cellalignment1327">
<th class="cellalignment1334" id="r2c1-t18" headers="r1c1-t18">OBJECT_TYPE</th>
<th class="cellalignment1334" id="r2c2-t18" headers="r2c1-t18 r1c1-t18">ATTR1</th>
<th class="cellalignment1334" id="r2c3-t18" headers="r2c1-t18 r1c1-t18">ATTR2</th>
<th class="cellalignment1334" id="r2c4-t18" headers="r2c1-t18 r1c1-t18">ATTR3</th>
<th class="cellalignment1334" id="r2c5-t18" headers="r2c1-t18 r1c1-t18">ATTR4</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r3c1-t18" headers="r1c1-t18 r2c1-t18">
<p><code dir="ltr">TABLESPACE</code></p>
</td>
<td class="cellalignment1335" headers="r3c1-t18 r1c1-t18 r2c2-t18">
<p><code dir="ltr"><span class="codeinlineitalic">tablespace name</span></code></p>
</td>
<td class="cellalignment1335" headers="r3c1-t18 r1c1-t18 r2c3-t18">
<p><code dir="ltr">NULL</code></p>
</td>
<td class="cellalignment1335" headers="r3c1-t18 r1c1-t18 r2c4-t18">
<p><code dir="ltr">NULL</code></p>
</td>
<td class="cellalignment1335" headers="r3c1-t18 r1c1-t18 r2c5-t18">
<p>Unused. Specify <code dir="ltr">NULL</code>.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r4c1-t18" headers="r1c1-t18 r2c1-t18">
<p><code dir="ltr">TABLE</code></p>
</td>
<td class="cellalignment1335" headers="r4c1-t18 r1c1-t18 r2c2-t18">
<p><code dir="ltr"><span class="codeinlineitalic">schema name</span></code></p>
</td>
<td class="cellalignment1335" headers="r4c1-t18 r1c1-t18 r2c3-t18">
<p><code dir="ltr"><span class="codeinlineitalic">table name</span></code></p>
</td>
<td class="cellalignment1335" headers="r4c1-t18 r1c1-t18 r2c4-t18">
<p><code dir="ltr">NULL</code></p>
</td>
<td class="cellalignment1335" headers="r4c1-t18 r1c1-t18 r2c5-t18">
<p>Unused. Specify <code dir="ltr">NULL</code>.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r5c1-t18" headers="r1c1-t18 r2c1-t18">
<p><code dir="ltr">INDEX</code></p>
</td>
<td class="cellalignment1335" headers="r5c1-t18 r1c1-t18 r2c2-t18">
<p><code dir="ltr"><span class="codeinlineitalic">schema name</span></code></p>
</td>
<td class="cellalignment1335" headers="r5c1-t18 r1c1-t18 r2c3-t18">
<p><code dir="ltr"><span class="codeinlineitalic">index name</span></code></p>
</td>
<td class="cellalignment1335" headers="r5c1-t18 r1c1-t18 r2c4-t18">
<p><code dir="ltr">NULL</code></p>
</td>
<td class="cellalignment1335" headers="r5c1-t18 r1c1-t18 r2c5-t18">
<p>Unused. Specify <code dir="ltr">NULL</code>.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r6c1-t18" headers="r1c1-t18 r2c1-t18">
<p><code dir="ltr">TABLE PARTITION</code></p>
</td>
<td class="cellalignment1335" headers="r6c1-t18 r1c1-t18 r2c2-t18">
<p><code dir="ltr"><span class="codeinlineitalic">schema name</span></code></p>
</td>
<td class="cellalignment1335" headers="r6c1-t18 r1c1-t18 r2c3-t18">
<p><code dir="ltr"><span class="codeinlineitalic">table name</span></code></p>
</td>
<td class="cellalignment1335" headers="r6c1-t18 r1c1-t18 r2c4-t18">
<p><code dir="ltr"><span class="codeinlineitalic">table partition name</span></code></p>
</td>
<td class="cellalignment1335" headers="r6c1-t18 r1c1-t18 r2c5-t18">
<p>Unused. Specify <code dir="ltr">NULL</code>.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r7c1-t18" headers="r1c1-t18 r2c1-t18">
<p><code dir="ltr">INDEX PARTITION</code></p>
</td>
<td class="cellalignment1335" headers="r7c1-t18 r1c1-t18 r2c2-t18">
<p><code dir="ltr"><span class="codeinlineitalic">schema name</span></code></p>
</td>
<td class="cellalignment1335" headers="r7c1-t18 r1c1-t18 r2c3-t18">
<p><code dir="ltr"><span class="codeinlineitalic">index name</span></code></p>
</td>
<td class="cellalignment1335" headers="r7c1-t18 r1c1-t18 r2c4-t18">
<p><code dir="ltr"><span class="codeinlineitalic">index partition name</span></code></p>
</td>
<td class="cellalignment1335" headers="r7c1-t18 r1c1-t18 r2c5-t18">
<p>Unused. Specify <code dir="ltr">NULL</code>.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r8c1-t18" headers="r1c1-t18 r2c1-t18">
<p><code dir="ltr">TABLE SUBPARTITION</code></p>
</td>
<td class="cellalignment1335" headers="r8c1-t18 r1c1-t18 r2c2-t18">
<p><code dir="ltr"><span class="codeinlineitalic">schema name</span></code></p>
</td>
<td class="cellalignment1335" headers="r8c1-t18 r1c1-t18 r2c3-t18">
<p><code dir="ltr"><span class="codeinlineitalic">table name</span></code></p>
</td>
<td class="cellalignment1335" headers="r8c1-t18 r1c1-t18 r2c4-t18">
<p><code dir="ltr"><span class="codeinlineitalic">table subpartition name</span></code></p>
</td>
<td class="cellalignment1335" headers="r8c1-t18 r1c1-t18 r2c5-t18">
<p>Unused. Specify <code dir="ltr">NULL</code>.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r9c1-t18" headers="r1c1-t18 r2c1-t18">
<p><code dir="ltr">INDEX SUBPARTITION</code></p>
</td>
<td class="cellalignment1335" headers="r9c1-t18 r1c1-t18 r2c2-t18">
<p><code dir="ltr"><span class="codeinlineitalic">schema name</span></code></p>
</td>
<td class="cellalignment1335" headers="r9c1-t18 r1c1-t18 r2c3-t18">
<p><code dir="ltr"><span class="codeinlineitalic">index name</span></code></p>
</td>
<td class="cellalignment1335" headers="r9c1-t18 r1c1-t18 r2c4-t18">
<p><code dir="ltr"><span class="codeinlineitalic">index subpartition name</span></code></p>
</td>
<td class="cellalignment1335" headers="r9c1-t18 r1c1-t18 r2c5-t18">
<p>Unused. Specify <code dir="ltr">NULL</code>.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r10c1-t18" headers="r1c1-t18 r2c1-t18">
<p><code dir="ltr">LOB</code></p>
</td>
<td class="cellalignment1335" headers="r10c1-t18 r1c1-t18 r2c2-t18">
<p><code dir="ltr"><span class="codeinlineitalic">schema name</span></code></p>
</td>
<td class="cellalignment1335" headers="r10c1-t18 r1c1-t18 r2c3-t18">
<p><code dir="ltr"><span class="codeinlineitalic">segment name</span></code></p>
</td>
<td class="cellalignment1335" headers="r10c1-t18 r1c1-t18 r2c4-t18">
<p><code dir="ltr">NULL</code></p>
</td>
<td class="cellalignment1335" headers="r10c1-t18 r1c1-t18 r2c5-t18">
<p>Unused. Specify <code dir="ltr">NULL</code>.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r11c1-t18" headers="r1c1-t18 r2c1-t18">
<p><code dir="ltr">LOB PARTITION</code></p>
</td>
<td class="cellalignment1335" headers="r11c1-t18 r1c1-t18 r2c2-t18">
<p><code dir="ltr"><span class="codeinlineitalic">schema name</span></code></p>
</td>
<td class="cellalignment1335" headers="r11c1-t18 r1c1-t18 r2c3-t18">
<p><code dir="ltr"><span class="codeinlineitalic">segment name</span></code></p>
</td>
<td class="cellalignment1335" headers="r11c1-t18 r1c1-t18 r2c4-t18">
<p><code dir="ltr"><span class="codeinlineitalic">lob partition name</span></code></p>
</td>
<td class="cellalignment1335" headers="r11c1-t18 r1c1-t18 r2c5-t18">
<p>Unused. Specify <code dir="ltr">NULL</code>.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r12c1-t18" headers="r1c1-t18 r2c1-t18">
<p><code dir="ltr">LOB SUBPARTITION</code></p>
</td>
<td class="cellalignment1335" headers="r12c1-t18 r1c1-t18 r2c2-t18">
<p><code dir="ltr"><span class="codeinlineitalic">schema name</span></code></p>
</td>
<td class="cellalignment1335" headers="r12c1-t18 r1c1-t18 r2c3-t18">
<p><code dir="ltr"><span class="codeinlineitalic">segment name</span></code></p>
</td>
<td class="cellalignment1335" headers="r12c1-t18 r1c1-t18 r2c4-t18">
<p><code dir="ltr"><span class="codeinlineitalic">lob subpartition name</span></code></p>
</td>
<td class="cellalignment1335" headers="r12c1-t18 r1c1-t18 r2c5-t18">
<p>Unused. Specify <code dir="ltr">NULL</code>.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformalwide" -->
<div id="ADMIN13053" class="tblhruleformalwide">
<p class="titleintable"><a id="sthref2071"></a><a id="BABBHDBI"></a>Table 19-3 Input for DBMS_ADVISOR.SET_TASK_PARAMETER</p>
<table class="cellalignment1333" title="Input for DBMS_ADVISOR.SET_TASK_PARAMETER" summary="Column 1 lists the input parameters for the DBMS_ADVISOR.SET_TASK_PARMETER procedure. Column 2 describes te procedure, column 3 specifies possible values, and column 4 lists the default value." dir="ltr">
<thead>
<tr class="cellalignment1327">
<th class="cellalignment1334" id="r1c1-t19">Input Parameter</th>
<th class="cellalignment1334" id="r1c2-t19">Description</th>
<th class="cellalignment1334" id="r1c3-t19">Possible Values</th>
<th class="cellalignment1334" id="r1c4-t19">Default Value</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r2c1-t19" headers="r1c1-t19">
<p><code dir="ltr">time_limit</code></p>
</td>
<td class="cellalignment1335" headers="r2c1-t19 r1c2-t19">
<p>The time limit for the Segment Advisor run, specified in seconds.</p>
</td>
<td class="cellalignment1335" headers="r2c1-t19 r1c3-t19">
<p>Any number of seconds</p>
</td>
<td class="cellalignment1335" headers="r2c1-t19 r1c4-t19">
<p><code dir="ltr">UNLIMITED</code></p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r3c1-t19" headers="r1c1-t19">
<p><code dir="ltr">recommend_all</code></p>
</td>
<td class="cellalignment1335" headers="r3c1-t19 r1c2-t19">
<p>Whether the Segment Advisor should generate findings for all segments.</p>
</td>
<td class="cellalignment1335" headers="r3c1-t19 r1c3-t19">
<p><code dir="ltr">TRUE</code>: Findings are generated on all segments specified, whether or not space reclamation is recommended.</p>
<p><code dir="ltr">FALSE</code>: Findings are generated only for those objects that generate recommendations for space reclamation.</p>
</td>
<td class="cellalignment1335" headers="r3c1-t19 r1c4-t19">
<p><code dir="ltr">TRUE</code></p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformalwide" -->
<p><a id="ADMIN12624"></a><span class="subhead3">Example&nbsp;</span>The example that follows shows how to use the <code dir="ltr">DBMS_ADVISOR</code> procedures to run the Segment Advisor for the sample table <code dir="ltr">hr.employees</code>. The user executing these package procedures must have the <code dir="ltr">EXECUTE</code> object privilege on the package or the <code dir="ltr">ADVISOR</code> system privilege.</p>
<p>Note that passing an object type of <code dir="ltr">TABLE</code> to <code dir="ltr">DBMS_ADVISOR.CREATE_OBJECT</code> amounts to an object level request. If the table is not partitioned, the table segment is analyzed (without any dependent segments like index or LOB segments). If the table is partitioned, the Segment Advisor analyzes all table partitions and generates separate findings and recommendations for each.</p>
<pre dir="ltr">
variable id number;
begin
  declare
  name varchar2(100);
  descr varchar2(500);
  obj_id number;
  begin
  name:='Manual_Employees';
  descr:='Segment Advisor Example';

  dbms_advisor.create_task (
    advisor_name     =&gt; 'Segment Advisor',
    task_id          =&gt; :id,
    task_name        =&gt; name,
    task_desc        =&gt; descr);

  dbms_advisor.create_object (
    task_name        =&gt; name,
    object_type      =&gt; 'TABLE',
    attr1            =&gt; 'HR',
    attr2            =&gt; 'EMPLOYEES',
    attr3            =&gt; NULL,
    attr4            =&gt; NULL,
    attr5            =&gt; NULL,
    object_id        =&gt; obj_id);

  dbms_advisor.set_task_parameter(
    task_name        =&gt; name,
    parameter        =&gt; 'recommend_all',
    value            =&gt; 'TRUE');

  dbms_advisor.execute_task(name);
  end;
end; 
/
</pre></div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="CBBJHIGH"></a>
<div id="ADMIN11606" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Viewing Segment Ad<a id="sthref2072"></a>visor Results</h4>
<p>The Segment Advisor creates several types of results: recommendations, findings, actions, and objects. You can view results in the following ways:</p>
<ul>
<li>
<p>With Enterprise Manager</p>
</li>
<li>
<p>By querying the <code dir="ltr">DBA_ADVISOR_*</code> views</p>
</li>
<li>
<p>By calling the <code dir="ltr">DBMS_SPACE.ASA_RECOMMENDATIONS</code> procedure</p>
</li>
</ul>
<p>Table <a href="#CBBJFCDI">Table 19-4</a> describes the various result types and their associated <code dir="ltr">DBA_ADVISOR_*</code> views.</p>
<div id="ADMIN13054" class="tblformalwide">
<p class="titleintable"><a id="sthref2073"></a><a id="CBBJFCDI"></a>Table 19-4 Segment Advisor Result Types</p>
<table class="cellalignment1333" title=" Segment Advisor Result Types" summary="This table shows the types of Segment Advisor results and the view associated with each. It has four rows (for four types of results, and two columns (Result type and view)." dir="ltr">
<thead>
<tr class="cellalignment1327">
<th class="cellalignment1334" id="r1c1-t20">Result Type</th>
<th class="cellalignment1334" id="r1c2-t20">Associated View</th>
<th class="cellalignment1334" id="r1c3-t20">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r2c1-t20" headers="r1c1-t20">
<p>Recommendations</p>
</td>
<td class="cellalignment1335" headers="r2c1-t20 r1c2-t20">
<p><code dir="ltr">DBA_ADVISOR_RECOMMENDATIONS</code></p>
</td>
<td class="cellalignment1335" headers="r2c1-t20 r1c3-t20">
<p>If a segment would benefit from a segment shrink, reorganization, or compression, the Segment Advisor generates a recommendation for the segment. <a href="#BABGGBHI">Table 19-5</a> shows examples of generated findings and recommendations.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r3c1-t20" headers="r1c1-t20">
<p>Findings</p>
</td>
<td class="cellalignment1335" headers="r3c1-t20 r1c2-t20">
<p><code dir="ltr">DBA_ADVISOR_FINDINGS</code></p>
</td>
<td class="cellalignment1335" headers="r3c1-t20 r1c3-t20">
<p>Findings are a report of what the Segment Advisor observed in analyzed segments. Findings include space used and free space statistics for each analyzed segment. Not all findings result in a recommendation. (There may be only a few recommendations, but there could be many findings.) When running the Segment Advisor manually with PL/SQL, if you specify <code dir="ltr">'TRUE'</code> for <code dir="ltr">recommend_all</code> in the <code dir="ltr">SET_TASK_PARAMETER</code> procedure, then the Segment Advisor generates a finding for each segment that qualifies for analysis, whether or not a recommendation is made for that segment. For row chaining advice, the Automatic Segment Advisor generates findings only, and not recommendations. If the Automatic Segment Advisor has no space reclamation recommendations to make, it does not generate findings. However, the Automatic Segment Advisor may generate findings for tables that could benefit from OLTP compression.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r4c1-t20" headers="r1c1-t20">
<p>Actions</p>
</td>
<td class="cellalignment1335" headers="r4c1-t20 r1c2-t20">
<p><code dir="ltr">DBA_ADVISOR_ACTIONS</code></p>
</td>
<td class="cellalignment1335" headers="r4c1-t20 r1c3-t20">
<p>Every recommendation is associated with a suggested action to perform: either segment shrink, online redefinition (reorganization), or compression. The <code dir="ltr">DBA_ADVISOR_ACTIONS</code> view provides either the SQL that you can use to perform a segment shrink or table compression, or a suggestion to reorganize the object.</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r5c1-t20" headers="r1c1-t20">
<p>Objects</p>
</td>
<td class="cellalignment1335" headers="r5c1-t20 r1c2-t20">
<p><code dir="ltr">DBA_ADVISOR_OBJECTS</code></p>
</td>
<td class="cellalignment1335" headers="r5c1-t20 r1c3-t20">
<p>All findings, recommendations, and actions are associated with an object. If the Segment Advisor analyzes multiple segments, as with a tablespace or partitioned table, then one entry is created in the <code dir="ltr">DBA_ADVISOR_OBJECTS</code> view for each analyzed segment. <a href="#BABHCCCE">Table 19-2</a> defines the columns in this view to query for information on the analyzed segments. You can correlate the objects in this view with the objects in the findings, recommendations, and actions views.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformalwide" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink REFRN" href="../e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a> for details on the <code dir="ltr">DBA_ADVISOR_*</code> views.</p>
</li>
<li>
<p><a class="olink ARPLS056" href="../../appdev.112/e40758/d_space.htm#ARPLS056"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for details on the <code dir="ltr">DBMS_SPACE.ASA_RECOMMENDATIONS</code> function.</p>
</li>
</ul>
</div>
<div id="ADMIN11607" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref2074"></a>
<h5 class="sect4">Viewing Segment Advisor Results with Enterprise Manager</h5>
<p>With Oracle Enterprise Manager, you can view Segment Advisor results for both Automatic Segment Advisor runs and manual Segment Advisor runs. You can view the following types of results:</p>
<ul>
<li>
<p>All recommendations (multiple automatic and manual Segment Advisor runs)</p>
</li>
<li>
<p>Recommendations from the last Automatic Segment Advisor run</p>
</li>
<li>
<p>Recommendations from a specific run</p>
</li>
<li>
<p>Row chaining findings</p>
</li>
</ul>
<p>You can also view a list of the segments that were analyzed by the last Automatic Segment Advisor run.</p>
<p><span class="bold">To view Segment Advisor results with Enterprise Manager&mdash;All runs:</span></p>
<ol>
<li>
<p>On the database Home page, under the Space Summary heading, click the numeric link next to the title <span class="bold">Segment Advisor Recommendations</span>.</p>
<img width="328" height="121" src="img/space_summary_seg_advisor.gif" alt="Description of space_summary_seg_advisor.gif follows" /><br />
<a id="sthref2075" href="img_text/space_summary_seg_advisor.htm">Description of the illustration space_summary_seg_advisor.gif</a><br />
<br />
<p>The Segment Advisor Recommendations page appears. Recommendations are organized by tablespace.</p>
<div id="ADMIN13055" class="figure">
<p class="titleinfigure"><a id="CBBJECHE"></a>Figure 19-3 Segment Advisor Recommendations page</p>
<img width="746" height="317" src="img/segadv_recommendations.gif" alt="Description of Figure 19-3 follows" /><br />
<a id="sthref2076" href="img_text/segadv_recommendations.htm">Description of "Figure 19-3 Segment Advisor Recommendations page"</a><br />
<br /></div>
<!-- class="figure" --></li>
<li>
<p>If any recommendations are present, select a tablespace, and then click <span class="bold">Recommendation Details</span>.</p>
<p>The Recommendation Details page appears. You can initiate the recommended activity from this page (shrink or reorganize).</p>
<div id="ADMIN13056" class="figure">
<p class="titleinfigure"><a id="CBBIBDGB"></a>Figure 19-4 Recommendation Details page</p>
<img width="783" height="349" src="img/segadv_recommend_details.gif" alt="Description of Figure 19-4 follows" /><br />
<a id="sthref2077" href="img_text/segadv_recommend_details.htm">Description of "Figure 19-4 Recommendation Details page"</a><br />
<br /></div>
<!-- class="figure" -->
<div class="infobox-note">
<p class="notep1">Note:</p>
Dependent objects, such as LOBs, are not supported using the provided <span class="bold">Shrink</span> option. Instead, use Segment Advisor to confirm reclaimable space, but perform the shrink operation manually.</div>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
The list entries are sorted in descending order by reclaimable space. You can click column headings to change the sort order or to change from ascending to descending order.</div>
</li>
</ol>
<p><span class="bold">To view Segment Advisor results with Enterprise Manager&mdash;Last Automatic Segment Advisor run:</span></p>
<ol>
<li>
<p>On the database Home page, under the Space Summary heading, click the numeric link next to the title <span class="bold">Segment Advisor Recommendations</span>.</p>
<p>The Segment Advisor Recommendations page appears. (See <a href="#CBBJECHE">Figure 19-3</a>.)</p>
</li>
<li>
<p>In the View list, select <span class="bold">Recommendations from Last Automatic Run</span>.</p>
</li>
<li>
<p>If any recommendations are present, select a tablespace and click <span class="bold">Recommendation Details</span>.</p>
<p>The Recommendation Details page appears. (See <a href="#CBBIBDGB">Figure 19-4</a>.) You can initiate the recommended activity from this page (shrink or reorganize).</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Dependent objects, such as LOBs, are not supported using the provided <span class="bold">Shrink</span> option. Instead, use Segment Advisor to confirm reclaimable space, but perform the shrink operation manually.</div>
</li>
</ol>
<p><span class="bold">To view Segment Advisor results with Enterprise Manager&mdash;Specific run:</span></p>
<ol>
<li>
<p>Start at the Advisor Central page.</p>
<p>If you ran the Segment Advisor with the Enterprise Manager wizard, the Advisor Central page appears after you submit the Segment Advisor task. Otherwise, to get to this page, on the Database Home page, under Related Links, click <span class="bold">Advisor Central</span>.</p>
</li>
<li>
<p>Check that your task appears in the list under the Results heading. If it does not, complete these steps (See <a href="#CBBEFIGG">Figure 19-2</a>):</p>
<ol>
<li>
<p>In the Search section of the page, under Advisor Tasks, select <span class="bold">Segment Advisor</span> in the Advisory Type list.</p>
</li>
<li>
<p>In the Advisor Runs list, select <span class="bold">All</span> or the desired time period.</p>
</li>
<li>
<p>(Optional) Enter a task name.</p>
</li>
<li>
<p>Click <span class="bold">Go</span>.</p>
<p>Your Segment Advisor task appears in the Results section.</p>
</li>
</ol>
</li>
<li>
<p>Check the status of the job. If it is not <code dir="ltr">COMPLETED</code>, click the <span class="bold">Refresh</span> button at the top of the page until your task status shows <code dir="ltr">COMPLETED</code>. (Do not use your browser's refresh icon.)</p>
</li>
<li>
<p>Click the task name.</p>
<p>The Segment Advisor Task page appears, with recommendations organized by tablespace.</p>
</li>
<li>
<p>Select a tablespace in the list, and then click <span class="bold">Recommendation Details</span>.</p>
<p>The Recommendation Details page appears. (See <a href="#CBBIBDGB">Figure 19-4</a>.) You can initiate the recommended activity from this page (shrink or reorganize).</p>
</li>
</ol>
<p><span class="bold">To view row chaining findings:</span></p>
<ol>
<li>
<p>On the database Home page, under the Space Summary heading, click the numeric link next to the title <span class="bold">Segment Advisor Recommendations</span>.</p>
<p>The Segment Advisor Recommendations page appears. (See <a href="#CBBJECHE">Figure 19-3</a>.)</p>
</li>
<li>
<p>Under the Related Links heading, click <span class="bold">Chained Row Analysis</span>.</p>
<p>The Chained Row Analysis page appears, showing all segments that have chained rows, with a chained rows percentage for each.</p>
</li>
</ol>
</div>
<!-- class="sect4" -->
<div id="ADMIN11608" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref2078"></a>
<h5 class="sect4">Viewing Segment Advisor Results by Querying the DBA_ADVISOR_* Views</h5>
<p>The headings of <a href="#BABGGBHI">Table 19-5</a> show the columns in the <code dir="ltr">DBA_ADVISOR_*</code> views that contain output from the Segment Advisor. See <a class="olink REFRN23320" href="../../server.112/e40402/statviews_3025.htm#REFRN23320"><span class="italic">Oracle Database Reference</span></a> for a description of these views. The table contents summarize the possible outcomes. In addition, <a href="#BABHCCCE">Table 19-2</a> defines the columns in the <code dir="ltr">DBA_ADVISOR_OBJECTS</code> view that contain information on the analyzed segments.</p>
<p>Before querying the <code dir="ltr">DBA_ADVISOR_*</code> views, you can check that the Segment Advisor task is complete by querying the <code dir="ltr">STATUS</code> column in <code dir="ltr">DBA_ADVISOR_TASKS</code>.</p>
<pre dir="ltr">
select task_name, status from dba_advisor_tasks
   where owner = 'STEVE' and advisor_name = 'Segment Advisor';
 
TASK_NAME                      STATUS
------------------------------ -----------
Manual Employees               COMPLETED
</pre>
<p>The following example shows how to query the <code dir="ltr">DBA_ADVISOR_*</code> views to retrieve findings from all Segment Advisor runs submitted by user <code dir="ltr">STEVE</code>:</p>
<pre dir="ltr">
select af.task_name, ao.attr2 segname, ao.attr3 partition, ao.type, af.message 
  from dba_advisor_findings af, dba_advisor_objects ao
  where ao.task_id = af.task_id
  and ao.object_id = af.object_id
  and ao.owner = 'STEVE';
</pre>
<pre dir="ltr">

TASK_NAME          SEGNAME      PARTITION       TYPE             MESSAGE
------------------ ------------ --------------- ---------------- --------------------------
Manual_Employees   EMPLOYEES                    TABLE            The free space in the obje
                                                                 ct is less than 10MB.
 
Manual_Salestable4 SALESTABLE4  SALESTABLE4_P1  TABLE PARTITION  Perform shrink, estimated
                                                                 savings is 74444154 bytes.
 
Manual_Salestable4 SALESTABLE4  SALESTABLE4_P2  TABLE PARTITION  The free space in the obje
                                                                 ct is less than 10MB.
</pre>
<div id="ADMIN13057" class="tblhruleformalwidemax">
<p class="titleintable"><a id="sthref2079"></a><a id="BABGGBHI"></a>Table 19-5 Segment Advisor Outcomes: Summary</p>
<table class="cellalignment1333" title="Segment Advisor Outcomes: Summary" summary="This table summarizes possible outcomes of the Segment advisor. It shows the related values of columns in some of the Segment Advisor views." dir="ltr">
<thead>
<tr class="cellalignment1327">
<th class="cellalignment1334" id="r1c1-t25">MESSAGE column of DBA_ADVISOR_FINDINGS</th>
<th class="cellalignment1334" id="r1c2-t25">MORE_INFO column of DBA_ADVISOR_FINDINGS</th>
<th class="cellalignment1334" id="r1c3-t25">BENEFIT_TYPE column of DBA_ADVISOR_RECOMMENDATIONS</th>
<th class="cellalignment1334" id="r1c4-t25">ATTR1 column of DBA_ADVISOR_ACTIONS</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r2c1-t25" headers="r1c1-t25">
<p>Insufficient information to make a recommendation.</p>
</td>
<td class="cellalignment1335" headers="r2c1-t25 r1c2-t25">
<p>-</p>
</td>
<td class="cellalignment1335" headers="r2c1-t25 r1c3-t25">
<p>-</p>
</td>
<td class="cellalignment1335" headers="r2c1-t25 r1c4-t25">
<p>-</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r3c1-t25" headers="r1c1-t25">
<p>The free space in the object is less than 10MB.</p>
</td>
<td class="cellalignment1335" headers="r3c1-t25 r1c2-t25">
<p>Allocated Space:<span class="italic">xxx</span>: Used Space:<span class="italic">xxx</span>: Reclaimable Space :<span class="italic">xxx</span></p>
</td>
<td class="cellalignment1335" headers="r3c1-t25 r1c3-t25">
<p>-</p>
</td>
<td class="cellalignment1335" headers="r3c1-t25 r1c4-t25">
<p>-</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r4c1-t25" headers="r1c1-t25">
<p>The object has some free space but cannot be shrunk because...</p>
</td>
<td class="cellalignment1335" headers="r4c1-t25 r1c2-t25">
<p>Allocated Space:<span class="italic">xxx</span>: Used Space:<span class="italic">xxx</span>: Reclaimable Space :<span class="italic">xxx</span></p>
</td>
<td class="cellalignment1335" headers="r4c1-t25 r1c3-t25">
<p>-</p>
</td>
<td class="cellalignment1335" headers="r4c1-t25 r1c4-t25">
<p>-</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r5c1-t25" headers="r1c1-t25">
<p>The free space in the object is less than the size of the last extent.</p>
</td>
<td class="cellalignment1335" headers="r5c1-t25 r1c2-t25">
<p>Allocated Space:<span class="italic">xxx</span>: Used Space:<span class="italic">xxx</span>: Reclaimable Space :<span class="italic">xxx</span></p>
</td>
<td class="cellalignment1335" headers="r5c1-t25 r1c3-t25">
<p>-</p>
</td>
<td class="cellalignment1335" headers="r5c1-t25 r1c4-t25">
<p>-</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r6c1-t25" headers="r1c1-t25">
<p>Perform shrink, estimated savings is <span class="italic">xxx</span> bytes.</p>
</td>
<td class="cellalignment1335" headers="r6c1-t25 r1c2-t25">
<p>Allocated Space:<span class="italic">xxx</span>: Used Space:<span class="italic">xxx</span>: Reclaimable Space :<span class="italic">xxx</span></p>
</td>
<td class="cellalignment1335" headers="r6c1-t25 r1c3-t25">
<p>Perform shrink, estimated savings is <span class="italic">xxx</span> bytes.</p>
</td>
<td class="cellalignment1335" headers="r6c1-t25 r1c4-t25">
<p>The command to execute. For example: <code dir="ltr">ALTER</code> <code dir="ltr"><span class="codeinlineitalic">object</span></code> <code dir="ltr">SHRINK SPACE</code>;)</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r7c1-t25" headers="r1c1-t25">
<p>Enable row movement of the table <span class="italic">schema</span>.<span class="italic">table</span> and perform shrink, estimated savings is <span class="italic">xxx</span> bytes.</p>
</td>
<td class="cellalignment1335" headers="r7c1-t25 r1c2-t25">
<p>Allocated Space:<span class="italic">xxx</span>: Used Space:<span class="italic">xxx</span>: Reclaimable Space :<span class="italic">xxx</span></p>
</td>
<td class="cellalignment1335" headers="r7c1-t25 r1c3-t25">
<p>Enable row movement of the table <span class="italic">schema</span>.<span class="italic">table</span> and perform shrink, estimated savings is <span class="italic">xxx</span> bytes</p>
</td>
<td class="cellalignment1335" headers="r7c1-t25 r1c4-t25">
<p>The command to execute. For example: <code dir="ltr">ALTER</code> <code dir="ltr"><span class="codeinlineitalic">object</span></code> <code dir="ltr">SHRINK SPACE</code>;)</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r8c1-t25" headers="r1c1-t25">
<p>Perform re-org on the object <span class="italic">object</span>, estimated savings is <span class="italic">xxx</span> bytes.</p>
<p>(Note: This finding is for objects with reclaimable space that are not eligible for online segment shrink.)</p>
</td>
<td class="cellalignment1335" headers="r8c1-t25 r1c2-t25">
<p>Allocated Space:<span class="italic">xxx</span>: Used Space:<span class="italic">xxx</span>: Reclaimable Space :<span class="italic">xxx</span></p>
</td>
<td class="cellalignment1335" headers="r8c1-t25 r1c3-t25">
<p>Perform re-org on the object <span class="italic">object</span>, estimated savings is <span class="italic">xxx</span> bytes.</p>
</td>
<td class="cellalignment1335" headers="r8c1-t25 r1c4-t25">
<p>Perform reorg</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r9c1-t25" headers="r1c1-t25">
<p>The object has chained rows that can be removed by re-org.</p>
</td>
<td class="cellalignment1335" headers="r9c1-t25 r1c2-t25">
<p><span class="italic">xx</span> percent chained rows can be removed by re-org.</p>
</td>
<td class="cellalignment1335" headers="r9c1-t25 r1c3-t25">
<p>-</p>
</td>
<td class="cellalignment1335" headers="r9c1-t25 r1c4-t25">
<p>-</p>
</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r10c1-t25" headers="r1c1-t25">
<p>Compress object <span class="italic">object_name</span>, estimated savings is <span class="italic">xxx</span> bytes.</p>
<p>(This outcome is generated by the Automatic Segment Advisor only)</p>
</td>
<td class="cellalignment1335" headers="r10c1-t25 r1c2-t25">
<p>Compress object <span class="italic">object_name</span>, estimated savings is <span class="italic">xxx</span> bytes.</p>
</td>
<td class="cellalignment1335" headers="r10c1-t25 r1c3-t25">
<p>-</p>
</td>
<td class="cellalignment1335" headers="r10c1-t25 r1c4-t25">
<p>The command to execute. For example: <code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> <code dir="ltr">T1</code> <code dir="ltr">COMPRESS</code> <code dir="ltr">FOR</code> <code dir="ltr">OLTP</code></p>
<p>For this finding, see also the <code dir="ltr">ATTR2</code> column of <code dir="ltr">DBA_ADVISOR_ACTIONS</code>.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformalwidemax" --></div>
<!-- class="sect4" -->
<div id="ADMIN11609" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref2080"></a>
<h5 class="sect4">Viewing Segment Advisor Results with DBMS_SPACE.ASA_RECOMMENDATIONS</h5>
<p>The <code dir="ltr">ASA_RECOMMENDATIONS</code> procedure in the <code dir="ltr">DBMS_SPACE</code> package returns a nested table object that contains findings or recommendations for Automatic Segment Advisor runs and, optionally, manual Segment Advisor runs. Calling this procedure may be easier than working with the <code dir="ltr">DBA_ADVISOR_*</code> views, because the procedure performs all the required joins for you and returns information in an easily consumable format.</p>
<p>The following query returns recommendations by the most recent run of the Auto Segment Advisor, with the suggested command to run to follow the recommendations:</p>
<pre dir="ltr">
select tablespace_name, segment_name, segment_type, partition_name,
recommendations, c1 from
table(dbms_space.asa_recommendations('FALSE', 'FALSE', 'FALSE'));


TABLESPACE_NAME                SEGMENT_NAME                   SEGMENT_TYPE
------------------------------ ------------------------------ --------------
PARTITION_NAME
------------------------------
RECOMMENDATIONS
-----------------------------------------------------------------------------
C1
-----------------------------------------------------------------------------
TVMDS_ASSM                     ORDERS1                        TABLE PARTITION
ORDERS1_P2
Perform shrink, estimated savings is 57666422 bytes.
alter table "STEVE"."ORDERS1" modify partition "ORDERS1_P2" shrink space
 
TVMDS_ASSM                     ORDERS1                        TABLE PARTITION
ORDERS1_P1
Perform shrink, estimated savings is 45083514 bytes.
alter table "STEVE"."ORDERS1" modify partition "ORDERS1_P1" shrink space
 
TVMDS_ASSM_NEW                 ORDERS_NEW                     TABLE
 
Perform shrink, estimated savings is 155398992 bytes.
alter table "STEVE"."ORDERS_NEW" shrink space
 
TVMDS_ASSM_NEW                 ORDERS_NEW_INDEX               INDEX
 
Perform shrink, estimated savings is 102759445 bytes.
alter index "STEVE"."ORDERS_NEW_INDEX" shrink space
</pre>
<p>See <a class="olink ARPLS056" href="../../appdev.112/e40758/d_space.htm#ARPLS056"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for details on <code dir="ltr">DBMS_SPACE.ASA_RECOMMENDATIONS</code>.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="CBBJICHA"></a>
<div id="ADMIN11610" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Configuring the Aut<a id="sthref2081"></a>omatic Segment Advisor</h4>
<p>The Automatic Segment Advisor is an automated maintenance task. As such, you can use Enterprise Manager or PL/SQL package procedure calls to modify when (and if) this task runs. You can also control the resources allotted to it by modifying the appropriate resource plans.</p>
<p>You can call PL/SQL package procedures to make these changes, but the easier way to is to use Enterprise Manager.</p>
<p><span class="bold">To configure the Automatic Segment Advisor task with Enterprise Manager:</span></p>
<ol>
<li>
<p>Log in to Enterprise Manager as user <code dir="ltr">SYSTEM.</code></p>
</li>
<li>
<p>On the Database Home page, under the Space Summary heading, click the numeric link next to the label <span class="bold">Segment Advisor Recommendations</span>.</p>
<img width="328" height="121" src="img/space_summary_seg_advisor.gif" alt="Description of space_summary_seg_advisor.gif follows" /><br />
<a id="sthref2082" href="img_text/space_summary_seg_advisor.htm">Description of the illustration space_summary_seg_advisor.gif</a><br />
<br />
<p>The Segment Advisor Recommendations page appears.</p>
</li>
<li>
<p>Under the Related Links heading, click the link entitled <span class="bold">Automated Maintenance Tasks</span>.</p>
<p>The Automated Maintenance Tasks page appears.</p>
</li>
<li>
<p>Click <span class="bold">Configure</span>.</p>
<p>The Automated Maintenance Tasks Configuration page appears.</p>
<img width="697" height="428" src="img/edit_job_seg_advisor.gif" alt="Description of edit_job_seg_advisor.gif follows" /><br />
<a id="sthref2083" href="img_text/edit_job_seg_advisor.htm">Description of the illustration edit_job_seg_advisor.gif</a><br />
<br /></li>
<li>
<p>To completely disable the Automatic Segment Advisor, under Task Settings, select <span class="bold">Disabled</span> next to the Segment Advisor label, and then click <span class="bold">Apply</span>.</p>
</li>
<li>
<p>To disable the Automatic Segment Advisor for specific maintenance windows, clear the desired check boxes under the Segment Advisor column, and then click <span class="bold">Apply</span>.</p>
</li>
<li>
<p>To modify the start and end times and durations of maintenance windows, click <span class="bold">Edit Window Group</span>.</p>
<p>The Edit Window Group page appears. Click the name of a maintenance window, and then click <span class="bold">Edit</span> to change the window's schedule.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="tasks.htm#BABJIJFC">Chapter 26, "Managing Automated Database Maintenance Tasks"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<div id="ADMIN11611" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref2084"></a>
<h4 class="sect3">Viewing Aut<a id="sthref2085"></a>omatic Segment Advisor Information</h4>
<p>The following views display information specific to the Automatic Segment Advisor. For details, see <a class="olink REFRN" href="../e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a>.</p>
<div class="inftblruleinformal">
<table class="cellalignment1333" title="Views for Segment Advisor" summary="This table contains two rows, describing the views DBA_AUTO_SEGADV_SUMMARY and DBA_AUTO_SEGADV_CTL." dir="ltr">
<thead>
<tr class="cellalignment1327">
<th class="cellalignment1334" id="r1c1-t27">View</th>
<th class="cellalignment1334" id="r1c2-t27">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r2c1-t27" headers="r1c1-t27"><code dir="ltr">DBA_AUTO_SEGADV_SUMMARY</code></td>
<td class="cellalignment1335" headers="r2c1-t27 r1c2-t27">Each row of this view summarizes one Automatic Segment Advisor run. Fields include number of tablespaces and segments processed, and number of recommendations made.</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r3c1-t27" headers="r1c1-t27"><code dir="ltr">DBA_AUTO_SEGADV_CTL</code></td>
<td class="cellalignment1335" headers="r3c1-t27 r1c2-t27">Contains control information that the Automatic Segment Advisor uses to select and process segments. Each row contains information on a single object (tablespace or segment), including whether the object has been processed, and if so, the task ID under which it was processed and the reason for selecting it.</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblruleinformal" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CBBBIADA"></a>
<div id="ADMIN10161" class="sect2">
<h3 class="sect2">Shrinking Database Segments<a id="sthref2086"></a><a id="sthref2087"></a><a id="sthref2088"></a><a id="sthref2089"></a><a id="sthref2090"></a> Online</h3>
<p>You use online segment shrink to reclaim fragmented free space below the high water mark in an Oracle Database segment. The benefits of segment shrink are these:</p>
<ul>
<li>
<p>Compaction of data leads to better cache utilization, which in turn leads to better online transaction processing (OLTP) performance.</p>
</li>
<li>
<p>The compacted data requires fewer blocks to be scanned in full table scans, which in turns leads to better decision support system (DSS) performance.</p>
</li>
</ul>
<p>Segment shrink is an online, in-place operation. DML operations and queries can be issued during the data movement phase of segment shrink. Concurrent DML operations are blocked for a short time at the end of the shrink operation, when the space is deallocated. Indexes are maintained during the shrink operation and remain usable after the operation is complete. Segment shrink does not require extra disk space to be allocated.</p>
<p>Segment shrink reclaims unused space both above and below the high water mark. In contrast, space deallocation reclaims unused space only above the high water mark. In shrink operations, by default, the database compacts the segment, adjusts the high water mark, and releases the reclaimed space.</p>
<p>Segment shrink requires that rows be moved to new locations. Therefore, you must first enable row movement in the object you want to shrink and disable any rowid-based triggers defined on the object. You enable row movement in a table with the <code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> ... <code dir="ltr">ENABLE</code> <code dir="ltr">ROW</code> <code dir="ltr">MOVEMENT</code> command.</p>
<p>Shrink operations can be performed only on segments in locally managed tablespaces with automatic segment space management (ASSM). Within an ASSM tablespace, all segment types are eligible for online segment shrink except these:</p>
<ul>
<li>
<p>IOT mapping tables</p>
</li>
<li>
<p>Tables with rowid based materialized views</p>
</li>
<li>
<p>Tables with function-based indexes</p>
</li>
<li>
<p><code dir="ltr">SECUREFILE</code> LOBs</p>
</li>
<li>
<p>Compressed tables</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Shrinking database segments online might cause dependent database objects to become invalid. See <a href="general.htm#BABJAIFA">"About Object Dependencies and Object Invalidation"</a>.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF01001" href="../../server.112/e41084/statements_3001.htm#SQLRF01001"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information on the <code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> command.</div>
<p class="subhead2"><a id="ADMIN12625"></a>Invoking Online Segment Shrink</p>
<p>Before invoking online segment shrink, view the findings and recommendations of the Segment Advisor. For more information, see <a href="#CHDHBHAB">"Using the Segment Advisor"</a>.</p>
<p>You invoke online segment shrink with Oracle Enterprise Manager or with SQL commands in SQL*Plus. The remainder of this section discusses the command line method.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can invoke segment shrink directly from the Recommendation Details page in Enterprise Manager. (See <a href="#CBBIBDGB">Figure 19-4</a>.) Or, to invoke segment shrink for an individual table in Enterprise Manager, display the table on the Tables page, select the table, and then click <span class="bold">Shrink Segment</span> in the Actions list. (See <a href="#CBBGDAJJ">Figure 19-1</a>.) Perform a similar operation in Enterprise Manager to shrink indexes, materialized views, and so on.</div>
<p>You can shrink space in a table, index-organized table, index, partition, subpartition, materialized view, or materialized view log. You do this using <code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code>, <code dir="ltr">ALTER</code> <code dir="ltr">INDEX</code>, <code dir="ltr">ALTER</code> <code dir="ltr">MATERIALIZED</code> <code dir="ltr">VIEW</code>, or <code dir="ltr">ALTER</code> <code dir="ltr">MATERIALIZED</code> <code dir="ltr">VIEW</code> <code dir="ltr">LOG</code> statement with the <code dir="ltr">SHRINK SPACE</code> clause.</p>
<p>Two optional clauses let you control how the shrink operation proceeds:</p>
<ul>
<li>
<p>The <code dir="ltr">COMPACT</code> clause lets you divide the shrink segment operation into two phases. When you specify <code dir="ltr">COMPACT</code>, Oracle Database defragments the segment space and compacts the table rows but postpones the resetting of the high water mark and the deallocation of the space until a future time. This option is useful if you have long-running queries that might span the operation and attempt to read from blocks that have been reclaimed. The defragmentation and compaction results are saved to disk, so the data movement does not have to be redone during the second phase. You can reissue the <code dir="ltr">SHRINK SPACE</code> clause without the <code dir="ltr">COMPACT</code> clause during off-peak hours to complete the second phase.</p>
</li>
<li>
<p>The <code dir="ltr">CASCADE</code> clause extends the segment shrink operation to all dependent segments of the object. For example, if you specify <code dir="ltr">CASCADE</code> when shrinking a table segment, all indexes of the table will also be shrunk. (You need not specify <code dir="ltr">CASCADE</code> to shrink the partitions of a partitioned table.) To see a list of dependent segments of a given object, you can run the <code dir="ltr">OBJECT_DEPENDENT_SEGMENTS</code> procedure of the <code dir="ltr">DBMS_SPACE</code> package.</p>
</li>
</ul>
<p>As with other DDL operations, segment shrink causes subsequent SQL statements to be reparsed because of invalidation of cursors unless you specify the <code dir="ltr">COMPACT</code> clause.</p>
<p class="subhead2"><a id="ADMIN12626"></a>Examples</p>
<p>Shrink a table and all of its dependent segments (including <code dir="ltr">BASICFILE</code> LOB segments):</p>
<pre dir="ltr">
ALTER TABLE employees SHRINK SPACE CASCADE;
</pre>
<p>Shrink a <code dir="ltr">BASICFILE</code> LOB segment only:</p>
<pre dir="ltr">
ALTER TABLE employees MODIFY LOB (perf_review) (SHRINK SPACE);
</pre>
<p>Shrink a single partition of a partitioned table:</p>
<pre dir="ltr">
ALTER TABLE customers MODIFY PARTITION cust_P1 SHRINK SPACE;
</pre>
<p>Shrink an IOT index segment and the overflow segment:</p>
<pre dir="ltr">
ALTER TABLE cities SHRINK SPACE CASCADE;
</pre>
<p>Shrink an IOT overflow segment only:</p>
<pre dir="ltr">
ALTER TABLE cities OVERFLOW SHRINK SPACE;
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SQLRF" href="../e41084/toc.htm"><span class="italic">Oracle Database SQL Language Reference</span></a> for the syntax and restrictions of the <code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code>, <code dir="ltr">ALTER</code> <code dir="ltr">INDEX</code>, <code dir="ltr">ALTER</code> <code dir="ltr">MATERIALIZED</code> <code dir="ltr">VIEW</code>, and <code dir="ltr">ALTER</code> <code dir="ltr">MATERIALIZED</code> <code dir="ltr">VIEW</code> <code dir="ltr">LOG</code> statements with the <code dir="ltr">SHRINK SPACE</code> clause</p>
</li>
<li>
<p><a class="olink ADLOB" href="../../appdev.112/e18294/toc.htm"><span class="italic">Oracle Database SecureFiles and Large Objects Developer's Guide</span></a> for more information about LOB segments</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CBBBCHJI"></a>
<div id="ADMIN11612" class="sect2">
<h3 class="sect2">Dealloca<a id="sthref2091"></a>ting Unused Space</h3>
<p>When you deallocate unused space, the database frees the unused space at the unused (high water mark) end of the database segment and makes the space available for other segments in the tablespace.</p>
<p>Prior to deallocation, you can run the <code dir="ltr">UNUSED_SPACE</code> procedure of the <a id="sthref2092"></a><a id="sthref2093"></a><a id="sthref2094"></a><code dir="ltr">DBMS_SPACE</code> package, which returns information about the position of the high water mark and the amount of unused space in a segment. For segments in locally managed tablespaces with automatic segment space management, use the <code dir="ltr">SPACE_USAGE</code> procedure for more accurate information on unused space.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS056" href="../../appdev.112/e40758/d_space.htm#ARPLS056"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> contains the description of the <code dir="ltr">DBMS_SPACE</code> package</div>
<p>The following statements deallocate unused space<a id="sthref2095"></a><a id="sthref2096"></a> in a segment (table, index or cluster):</p>
<pre dir="ltr">
ALTER TABLE <span class="italic">table</span> DEALLOCATE UNUSED KEEP <span class="italic">integer</span>;
ALTER INDEX <span class="italic">index</span> DEALLOCATE UNUSED KEEP <span class="italic">integer</span>;
ALTER CLUSTER <span class="italic">cluster</span> DEALLOCATE UNUSED KEEP <span class="italic">integer</span>;
</pre>
<p>The <code dir="ltr">KEEP</code> clause is optional and lets you specify the amount of space retained in the segment. You can verify that the deallocated space is freed by examining the <code dir="ltr">DBA_FREE_SPACE</code> view.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SQLRF" href="../e41084/toc.htm"><span class="italic">Oracle Database SQL Language Reference</span></a> for details on the syntax and semantics of deallocating unused space</p>
</li>
<li>
<p><a class="olink REFRN23076" href="../../server.112/e40402/statviews_3194.htm#REFRN23076"><span class="italic">Oracle Database Reference</span></a> for more information about the <code dir="ltr">DBA_FREE_SPACE</code> view</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CFHBJHDG"></a>
<div id="ADMIN13457" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Dropping Unused Object Storage<a id="sthref2097"></a><a id="sthref2098"></a><a id="sthref2099"></a></h2>
<p>Beginning with Oracle Database 11<span class="italic">g</span> release 2 (11.2.0.2), the <code dir="ltr">DBMS_SPACE_ADMIN</code> package includes the <code dir="ltr">DROP_EMPTY_SEGMENTS</code> procedure, which enables you to drop segments for empty tables and partitions that have been migrated from previous releases. This includes segments of dependent objects of the table, such as index segments, where possible.</p>
<p>The following example drops empty segments from every table in the database.</p>
<pre dir="ltr">
BEGIN
  DBMS_SPACE_ADMIN.DROP_EMPTY_SEGMENTS();
END;
</pre>
<p>The following drops empty segments from the <code dir="ltr">HR.EMPLOYEES</code> table, including dependent objects.</p>
<pre dir="ltr">
BEGIN
  DBMS_SPACE_ADMIN.DROP_EMPTY_SEGMENTS(
    schema_name  =&gt; 'HR',
    table_name   =&gt; 'EMPLOYEES');
END;
</pre>
<p>This procedure requires 11.2 compatibility level.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
See <a class="olink ARPLS057" href="../../appdev.112/e40758/d_spadmn.htm#ARPLS057"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for details about this procedure</div>
</div>
<!-- class="sect1" -->
<a id="i1009496"></a>
<div id="ADMIN11613" class="sect1">
<h2 class="sect1">Understanding Space Usage of Data Types<a id="sthref2100"></a></h2>
<p>When creating tables and other data structures, you must know how much space they will require. Each data type has different space requirements. The <a class="olink LNPLS003" href="../../appdev.112/e25519/datatypes.htm#LNPLS003"><span class="italic">Oracle Database PL/SQL Language Reference</span></a> and <a class="olink SQLRF002" href="../../server.112/e41084/sql_elements.htm#SQLRF002"><span class="italic">Oracle Database SQL Language Reference</span></a> contain extensive descriptions of data types and their space requirements.</p>
</div>
<!-- class="sect1" -->
<a id="i1008797"></a>
<div id="ADMIN11614" class="sect1">
<h2 class="sect1">Displaying Information About Space Usage for Schema Objects</h2>
<p><a id="sthref2101"></a>Oracle Database provides data dictionary views and PL/SQL packages that allow you to display information about the space usage of schema objects. Views and packages that are unique to a particular schema object are described in the chapter of this book associated with that object. This section describes views and packages that are generic in nature and apply to multiple schema objects.</p>
<a id="i1008802"></a>
<div id="ADMIN11615" class="sect2">
<h3 class="sect2">Using PL/SQL Packages to Display Information About Schema Object Space Usage</h3>
<p>These <code dir="ltr">DBMS_SPACE</code> subprograms provide information about schema objects:</p>
<div class="inftblruleinformal">
<table class="cellalignment1333" title="Obtaining Information About Schema Objects" summary="Column 1 contains the names of PL/SQL packages that display information about schema object space usage. Column 2 describes each package." dir="ltr">
<thead>
<tr class="cellalignment1327">
<th class="cellalignment1334" id="r1c1-t35">Package and Procedure/Function</th>
<th class="cellalignment1334" id="r1c2-t35">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r2c1-t35" headers="r1c1-t35"><a id="sthref2102"></a><code dir="ltr">DBMS_SPACE.UNUSED_SPACE</code></td>
<td class="cellalignment1335" headers="r2c1-t35 r1c2-t35"><a id="sthref2103"></a><a id="sthref2104"></a>Returns information about unused space in an object (table, index, or cluster).</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r3c1-t35" headers="r1c1-t35"><a id="sthref2105"></a><code dir="ltr">DBMS_SPACE.FREE_BLOCKS</code></td>
<td class="cellalignment1335" headers="r3c1-t35 r1c2-t35">Returns information about free data blocks in an object (table, index, or cluster) whose segment free space is managed by free lists (segment space management is <code dir="ltr">MANUAL</code>).</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r4c1-t35" headers="r1c1-t35"><a id="sthref2106"></a><code dir="ltr">DBMS_SPACE.SPACE_USAGE</code></td>
<td class="cellalignment1335" headers="r4c1-t35 r1c2-t35">Returns information about free data blocks in an object (table, index, or cluster) whose segment space management is <code dir="ltr">AUTO</code>.</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblruleinformal" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS056" href="../../appdev.112/e40758/d_space.htm#ARPLS056"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for a description of the <code dir="ltr">DBMS_SPACE</code> package</div>
<p class="subhead2"><a id="ADMIN12627"></a>Example: Using <a id="sthref2107"></a>DBMS_SPACE.UNUSED_SPACE</p>
<p>The following SQL*Plus example uses the <code dir="ltr">DBMS_SPACE</code> package to obtain unused space information.</p>
<pre dir="ltr">
SQL&gt; VARIABLE total_blocks NUMBER
SQL&gt; VARIABLE total_bytes NUMBER
SQL&gt; VARIABLE unused_blocks NUMBER
SQL&gt; VARIABLE unused_bytes NUMBER
SQL&gt; VARIABLE lastextf NUMBER
SQL&gt; VARIABLE last_extb NUMBER
SQL&gt; VARIABLE lastusedblock NUMBER
SQL&gt; exec DBMS_SPACE.UNUSED_SPACE('SCOTT', 'EMP', 'TABLE', :total_blocks, -
&gt;    :total_bytes,:unused_blocks, :unused_bytes, :lastextf, -
&gt;    :last_extb, :lastusedblock);

PL/SQL procedure successfully completed.

SQL&gt; PRINT

TOTAL_BLOCKS
------------
           5

TOTAL_BYTES
-----------
      10240

...

LASTUSEDBLOCK
-------------
            3
</pre></div>
<!-- class="sect2" -->
<div id="ADMIN11616" class="sect2"><a id="sthref2108"></a>
<h3 class="sect2">Schema Objects Space Usage Data Dictionary Views<a id="sthref2109"></a><a id="sthref2110"></a></h3>
<p>These views display information about space usage in schema objects:</p>
<div class="inftblruleinformal">
<table class="cellalignment1333" title="Viewing Information About Schema Object Space Use" summary="Column 1 contains the names of views, column 2 describes each view." dir="ltr">
<thead>
<tr class="cellalignment1327">
<th class="cellalignment1334" id="r1c1-t37">View</th>
<th class="cellalignment1334" id="r1c2-t37">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r2c1-t37" headers="r1c1-t37"><code dir="ltr">DBA_SEGMENTS</code>
<p><code dir="ltr">USER_SEGMENTS</code></p>
</td>
<td class="cellalignment1335" headers="r2c1-t37 r1c2-t37"><span class="bold"><a id="sthref2111"></a></span>DBA view describes storage allocated for all database segments. User view describes storage allocated for segments for the current user.</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r3c1-t37" headers="r1c1-t37"><code dir="ltr">DBA_EXTENTS</code>
<p><code dir="ltr">USER_EXTENTS</code></p>
</td>
<td class="cellalignment1335" headers="r3c1-t37 r1c2-t37"><span class="bold"><a id="sthref2112"></a></span>DBA view describes extents comprising all segments in the database. User view describes extents comprising segments for the current user.</td>
</tr>
<tr class="cellalignment1327">
<td class="cellalignment1335" id="r4c1-t37" headers="r1c1-t37"><code dir="ltr">DBA_FREE_SPACE</code>
<p><code dir="ltr">USER_FREE_SPACE</code></p>
</td>
<td class="cellalignment1335" headers="r4c1-t37 r1c2-t37">DBA view lists free extents in all tablespaces. User view shows free space information for tablespaces for which the user has quota.</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblruleinformal" -->
<p>The following sections contain examples of using some of these views.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN" href="../e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a> for a complete description of data dictionary views</div>
<div id="ADMIN11617" class="sect3"><a id="sthref2113"></a>
<h4 class="sect3">Example 1: Displaying Segment Information</h4>
<p><a id="sthref2114"></a>The following query returns the name and size of each index segment in schema <code dir="ltr">hr</code>:</p>
<pre dir="ltr">
SELECT SEGMENT_NAME, TABLESPACE_NAME, BYTES, BLOCKS, EXTENTS
    FROM DBA_SEGMENTS
    WHERE SEGMENT_TYPE = 'INDEX'
    AND OWNER='HR'
    ORDER BY SEGMENT_NAME;
</pre>
<p>The query output is:</p>
<pre dir="ltr">
SEGMENT_NAME              TABLESPACE_NAME    BYTES BLOCKS EXTENTS
------------------------- --------------- -------- ------ -------
COUNTRY_C_ID_PK           EXAMPLE            65536     32       1
DEPT_ID_PK                EXAMPLE            65536     32       1
DEPT_LOCATION_IX          EXAMPLE            65536     32       1
EMP_DEPARTMENT_IX         EXAMPLE            65536     32       1
EMP_EMAIL_UK              EXAMPLE            65536     32       1
EMP_EMP_ID_PK             EXAMPLE            65536     32       1
EMP_JOB_IX                EXAMPLE            65536     32       1
EMP_MANAGER_IX            EXAMPLE            65536     32       1
EMP_NAME_IX               EXAMPLE            65536     32       1
JHIST_DEPARTMENT_IX       EXAMPLE            65536     32       1
JHIST_EMPLOYEE_IX         EXAMPLE            65536     32       1
JHIST_EMP_ID_ST_DATE_PK   EXAMPLE            65536     32       1
JHIST_JOB_IX              EXAMPLE            65536     32       1
JOB_ID_PK                 EXAMPLE            65536     32       1
LOC_CITY_IX               EXAMPLE            65536     32       1
LOC_COUNTRY_IX            EXAMPLE            65536     32       1
LOC_ID_PK                 EXAMPLE            65536     32       1
LOC_STATE_PROVINCE_IX     EXAMPLE            65536     32       1
REG_ID_PK                 EXAMPLE            65536     32       1

19 rows selected.
</pre></div>
<!-- class="sect3" -->
<div id="ADMIN11618" class="sect3"><a id="sthref2115"></a>
<h4 class="sect3">Example 2: Displaying Extent Information</h4>
<p>Information about the currently allocated extents in a database is stored in the <code dir="ltr">DBA_EXTENTS</code> data dictionary view. For example, the following query identifies the extents allocated to each index segment in the <code dir="ltr">hr</code> schema and the size of each of those extents:</p>
<pre dir="ltr">
SELECT SEGMENT_NAME, SEGMENT_TYPE, TABLESPACE_NAME, EXTENT_ID, BYTES, BLOCKS
    FROM DBA_EXTENTS
    WHERE SEGMENT_TYPE = 'INDEX'
    AND OWNER='HR'
    ORDER BY SEGMENT_NAME;
</pre>
<p>The query output is:</p>
<pre dir="ltr">
SEGMENT_NAME              SEGMENT_TYPE TABLESPACE_NAME EXTENT_ID    BYTES BLOCKS
------------------------- ------------ --------------- --------- -------- ------
COUNTRY_C_ID_PK           INDEX        EXAMPLE                 0    65536     32
DEPT_ID_PK                INDEX        EXAMPLE                 0    65536     32
DEPT_LOCATION_IX          INDEX        EXAMPLE                 0    65536     32
EMP_DEPARTMENT_IX         INDEX        EXAMPLE                 0    65536     32
EMP_EMAIL_UK              INDEX        EXAMPLE                 0    65536     32
EMP_EMP_ID_PK             INDEX        EXAMPLE                 0    65536     32
EMP_JOB_IX                INDEX        EXAMPLE                 0    65536     32
EMP_MANAGER_IX            INDEX        EXAMPLE                 0    65536     32
EMP_NAME_IX               INDEX        EXAMPLE                 0    65536     32
JHIST_DEPARTMENT_IX       INDEX        EXAMPLE                 0    65536     32
JHIST_EMPLOYEE_IX         INDEX        EXAMPLE                 0    65536     32
JHIST_EMP_ID_ST_DATE_PK   INDEX        EXAMPLE                 0    65536     32
JHIST_JOB_IX              INDEX        EXAMPLE                 0    65536     32
JOB_ID_PK                 INDEX        EXAMPLE                 0    65536     32
LOC_CITY_IX               INDEX        EXAMPLE                 0    65536     32
LOC_COUNTRY_IX            INDEX        EXAMPLE                 0    65536     32
LOC_ID_PK                 INDEX        EXAMPLE                 0    65536     32
LOC_STATE_PROVINCE_IX     INDEX        EXAMPLE                 0    65536     32
REG_ID_PK                 INDEX        EXAMPLE                 0    65536     32

19 rows selected.
</pre>
<p>For the <code dir="ltr">hr</code> schema, no segment has multiple extents allocated to it.</p>
</div>
<!-- class="sect3" -->
<div id="ADMIN11619" class="sect3"><a id="sthref2116"></a>
<h4 class="sect3">Example 3: Displaying the Free Space (Extents) in a Tablespace</h4>
<p><a id="sthref2117"></a><a id="sthref2118"></a>Information about the free extents (extents not allocated to any segment) in a database is stored in the <code dir="ltr">DBA_FREE_SPACE</code> data dictionary view. For example, the following query reveals the amount of free space available as free extents in the <code dir="ltr">SMUNDO</code> tablespace:</p>
<pre dir="ltr">
SELECT TABLESPACE_NAME, FILE_ID, BYTES, BLOCKS
    FROM DBA_FREE_SPACE
    WHERE TABLESPACE_NAME='SMUNDO';
</pre>
<p>The query output is:</p>
<pre dir="ltr">
TABLESPACE_NAME  FILE_ID    BYTES BLOCKS
--------------- -------- -------- ------
SMUNDO                 3    65536     32
SMUNDO                 3    65536     32
SMUNDO                 3    65536     32
SMUNDO                 3    65536     32
SMUNDO                 3    65536     32
SMUNDO                 3    65536     32
SMUNDO                 3   131072     64
SMUNDO                 3   131072     64
SMUNDO                 3    65536     32
SMUNDO                 3  3407872   1664

10 rows selected.
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDFDCAH"></a>
<div id="ADMIN11621" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Capacity Planning for Database Objects <a id="sthref2119"></a></h2>
<p>Oracle Database provides two ways to plan capacity for database objects:</p>
<ul>
<li>
<p>With Enterprise Manager</p>
</li>
<li>
<p>With the <code dir="ltr">DBMS_SPACE</code> PL/SQL package</p>
</li>
</ul>
<p>This section discusses the PL/SQL method. See Enterprise Manager online help and <a class="olink ADMQS" href="../e10897/toc.htm"><span class="italic">Oracle Database 2 Day DBA</span></a> for details on capacity planning with Enterprise Manager.</p>
<p>Three procedures in the <code dir="ltr">DBMS_SPACE</code> package enable you to predict the size of new objects and monitor the size of existing database objects. This section discusses those procedures and contains the following sections:</p>
<ul>
<li>
<p><a href="#CHDJFIIE">Estimating the Space Use of a Table</a></p>
</li>
<li>
<p><a href="#CFHICIDC">Estimating the Space Use of an Index</a></p>
</li>
<li>
<p><a href="#CFHGCBDG">Obtaining Object Growth Trends</a></p>
</li>
</ul>
<a id="CHDJFIIE"></a>
<div id="ADMIN11622" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Estimating the Space Use of a Table <a id="sthref2120"></a><a id="sthref2121"></a></h3>
<p>The size of a database table can vary greatly depending on tablespace storage attributes, tablespace block size, and many other factors. The <code dir="ltr">CREATE_TABLE_COST</code> procedure of the <code dir="ltr">DBMS_SPACE</code> package lets you estimate the space use cost of creating a table. See <a class="olink ARPLS056" href="../../appdev.112/e40758/d_space.htm#ARPLS056"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for details on the parameters of this procedure.</p>
<p>The procedure has two variants. The first variant uses average row size to estimate size. The second variant uses column information to estimate table size. Both variants require as input the following values:</p>
<ul>
<li>
<p><code dir="ltr">TABLESPACE_NAME</code>: The tablespace in which the object will be created. The default is the <code dir="ltr">SYSTEM</code> tablespace.</p>
</li>
<li>
<p><code dir="ltr">ROW_COUNT</code>: The anticipated number of rows in the table.</p>
</li>
<li>
<p><code dir="ltr">PCT_FREE</code>: The percentage of free space you want to reserve in each block for future expansion of existing rows due to updates.</p>
</li>
</ul>
<p>In addition, the first variant also requires as input a value for <code dir="ltr">AVG_ROW_SIZE</code>, which is the anticipated average row size in bytes.</p>
<p>The second variant also requires for each anticipated column values for <code dir="ltr">COLINFOS</code>, which is an object type comprising the attributes <code dir="ltr">COL_TYPE</code> (the data type of the column) and <code dir="ltr">COL_SIZE</code> (the number of characters or bytes in the column).</p>
<p>The procedure returns two values:</p>
<ul>
<li>
<p><code dir="ltr">USED_BYTES</code>: The actual bytes used by the data, including overhead for block metadata, <code dir="ltr">PCT_FREE</code> space, and so forth.</p>
</li>
<li>
<p><code dir="ltr">ALLOC_BYTES</code>: The amount of space anticipated to be allocated for the object taking into account the tablespace extent characteristics.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Beginning with release 11.2.0.2 of Oracle Database, the default size of the first extent of any new segment for a partitioned table is 8 MB instead of 64 KB. This helps improve performance of inserts and queries on partitioned tables. Although partitioned tables will start with a larger initial size, once sufficient data is inserted, the space consumption will be the same as in previous releases. You can override this default by setting the <code dir="ltr">INITIAL</code> size in the storage clause for the table. This new default only applies to table partitions and LOB partitions.</div>
</div>
<!-- class="sect2" -->
<a id="CFHICIDC"></a>
<div id="ADMIN13458" class="sect2">
<h3 class="sect2">Estimating the Space Use of an Index <a id="sthref2122"></a></h3>
<p>The <code dir="ltr">CREATE_INDEX_COST</code> procedure of the <code dir="ltr">DBMS_SPACE</code> package lets you estimate the space use cost of creating an index on an existing table.</p>
<p>The procedure requires as input the following values:</p>
<ul>
<li>
<p><code dir="ltr">DDL</code>: The <code dir="ltr">CREATE INDEX</code> statement that would create the index. The table specified in this DDL statement must be an existing table.</p>
</li>
<li>
<p>[Optional] <code dir="ltr">PLAN_TABLE</code>: The name of the plan table to use. The default is <code dir="ltr">NULL</code>.</p>
</li>
</ul>
<p>The results returned by this procedure depend on statistics gathered on the segment. Therefore, be sure to obtain statistics shortly before executing this procedure. In the absence of recent statistics, the procedure does not issue an error, but it may return inappropriate results. The procedure returns the following values:</p>
<ul>
<li>
<p><code dir="ltr">USED_BYTES</code>: The number of bytes representing the actual index data.</p>
</li>
<li>
<p><code dir="ltr">ALLOC_BYTES</code>: The amount of space allocated for the index in the tablespace.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CFHGCBDG"></a>
<div id="ADMIN13459" class="sect2">
<h3 class="sect2">Obtaining Object Growth Trends <a id="sthref2123"></a><a id="sthref2124"></a></h3>
<p>The <code dir="ltr">OBJECT_GROWTH_TREND</code> function of the <code dir="ltr">DBMS_SPACE</code> package produces a table of one or more rows, where each row describes the space use of the object at a specific time. The function retrieves the space use totals from the Automatic Workload Repository or computes current space use and combines it with historic space use changes retrieved from Automatic Workload Repository. See <a class="olink ARPLS68110" href="../../appdev.112/e40758/d_space.htm#ARPLS68110"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for detailed information on the parameters of this function.</p>
<p>The function requires as input the following values:</p>
<ul>
<li>
<p><code dir="ltr">OBJECT_OWNER</code>: The owner of the object.</p>
</li>
<li>
<p><code dir="ltr">OBJECT_NAME</code>: The name of the object.</p>
</li>
<li>
<p><code dir="ltr">PARTITION_NAME</code>: The name of the table or index partition, is relevant. Specify <code dir="ltr">NULL</code> otherwise.</p>
</li>
<li>
<p><code dir="ltr">OBJECT_TYPE</code>: The type of the object.</p>
</li>
<li>
<p><code dir="ltr">START_TIME</code>: A <code dir="ltr">TIMESTAMP</code> value indicating the beginning of the growth trend analysis.</p>
</li>
<li>
<p><code dir="ltr">END_TIME</code>: A <code dir="ltr">TIMESTAMP</code> value indicating the end of the growth trend analysis. The default is "<code dir="ltr">NOW</code>".</p>
</li>
<li>
<p><code dir="ltr">INTERVAL</code>: The length in minutes of the reporting interval during which the function should retrieve space use information.</p>
</li>
<li>
<p><code dir="ltr">SKIP_INTERPOLATED</code>: Determines whether the function should omit values based on recorded statistics before and after the <code dir="ltr">INTERVAL</code> ('<code dir="ltr">YES</code>') or not ('<code dir="ltr">NO</code>'). This setting is useful when the result table will be displayed as a table rather than a chart, because you can see more clearly how the actual recording interval relates to the requested reporting interval.</p>
</li>
</ul>
<p>The function returns a table, each of row of which provides space use information on the object for one interval. If the return table is very large, the results are pipelined so that another application can consume the information as it is being produced. The output table has the following columns:</p>
<ul>
<li>
<p><code dir="ltr">TIMEPOINT</code>: A <code dir="ltr">TIMESTAMP</code> value indicating the time of the reporting interval.</p>
<p>Records are not produced for values of <code dir="ltr">TIME</code> that precede the oldest recorded statistics for the object.</p>
</li>
<li>
<p><code dir="ltr">SPACE_USAGE</code>: The number of bytes actually being used by the object data.</p>
</li>
<li>
<p><code dir="ltr">SPACE_ALLOC</code>: The number of bytes allocated to the object in the tablespace at that time.</p>
</li>
<li>
<p><code dir="ltr">QUALITY</code>: A value indicating how well the requested reporting interval matches the actual recording of statistics. This information is useful because there is no guaranteed reporting interval for object size use statistics, and the actual reporting interval varies over time and from object to object.</p>
<p>The values of the <code dir="ltr">QUALITY</code> column are:</p>
</li>
<li>
<ul>
<li>
<p><code dir="ltr">GOOD</code>: The value whenever the value of <code dir="ltr">TIME</code> is based on recorded statistics with a recorded timestamp within 10% of the <code dir="ltr">INTERVAL</code> specified in the input parameters.</p>
</li>
<li>
<p><code dir="ltr">INTERPOLATED</code>: The value did not meet the criteria for <code dir="ltr">GOOD</code>, but was based on recorded statistics before and after the value of <code dir="ltr">TIME</code>. Current in-memory statistics can be collected across all instances in a cluster and treated as the "recorded" value for the present time.</p>
</li>
<li>
<p><code dir="ltr">PROJECTION</code>: The value of <code dir="ltr">TIME</code> is in the future as of the time the table was produced. In an Oracle Real Application Clusters environment, the rules for recording statistics allow each instance to choose independently which objects will be selected.</p>
</li>
</ul>
<p>The output returned by this function is an aggregation of values recorded across all instances in an Oracle RAC environment. Each value can be computed from a combination of <code dir="ltr">GOOD</code> and <code dir="ltr">INTERPOLATED</code> values. The aggregate value returned is marked <code dir="ltr">GOOD</code> if at least 80% of that value was derived from <code dir="ltr">GOOD</code> instance values.</p>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1326">
<tr>
<td class="cellalignment1335">
<table class="cellalignment1331">
<tr>
<td class="cellalignment1330"><a href="general.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1330"><a href="tables.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2001, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1337">
<table class="cellalignment1329">
<tr>
<td class="cellalignment1330"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1330"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1330"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1330"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1330"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1330"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
