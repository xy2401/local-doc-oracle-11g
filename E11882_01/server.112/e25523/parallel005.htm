<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Tuning General Parameters for Parallel Execution</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 037" />
<meta name="dcterms.created" content="2011-09-27T4:11:54Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database VLDB and Partitioning Guide" />
<meta name="dcterms.identifier" content="E25523-01" />
<meta name="dcterms.isVersionOf" content="VLDBG" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2008, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="parallel004.htm" title="Previous" type="text/html" />
<link rel="Next" href="parallel006.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e25523.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">22/27</span> <!-- End Header --><a id="i1007962"></a><a id="VLDBG1481"></a>
<div class="sect1">
<h1 class="sect1">Tuning General Parameters for Parallel Execution</h1>
<p><a id="sthref1113"></a>This section discusses the following topics:</p>
<ul>
<li>
<p><a href="#i1007977">Parameters Establishing Resource Limits for Parallel Operations</a></p>
</li>
<li>
<p><a href="#i1008241">Parameters Affecting Resource Consumption</a></p>
</li>
<li>
<p><a href="#i1008458">Parameters Related to I/O</a></p>
</li>
</ul>
<a id="i1007977"></a><a id="VLDBG1482"></a>
<div class="sect2">
<h2 class="sect2">Parameters Establishing Resource Limits for Parallel Operations</h2>
<p><a id="sthref1114"></a>You can set initialization parameters to determine resource limits. The parameters that establish resource limits are discussed in the following topics:</p>
<ul>
<li>
<p><a href="#CIHHGECI">PARALLEL_FORCE_LOCAL</a></p>
</li>
<li>
<p><a href="#CIHHJFFC">PARALLEL_MAX_SERVERS</a></p>
</li>
<li>
<p><a href="#i1008224">PARALLEL_MIN_PERCENT</a></p>
</li>
<li>
<p><a href="#i1008068">PARALLEL_MIN_SERVERS</a></p>
</li>
<li>
<p><a href="#BEIFFDDG">PARALLEL_MIN_TIME_THRESHOLD</a></p>
</li>
<li>
<p><a href="#CIHJEGFI">PARALLEL_SERVERS_TARGET</a></p>
</li>
<li>
<p><a href="#i1008076">SHARED_POOL_SIZE</a></p>
</li>
<li>
<p><a href="#BEIJEEDA">Computing Additional Memory Requirements for Message Buffers</a></p>
</li>
<li>
<p><a href="#BEIEBCAF">Adjusting Memory After Processing Begins</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN" href="../e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a> for information about initialization parameters</div>
<a id="CIHHGECI"></a><a id="VLDBG1485"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h3 class="sect3">PARALLEL_FORCE_LOCAL</h3>
<p><a id="sthref1115"></a><a id="sthref1116"></a>This parameter specifies whether a SQL statement executed in parallel is restricted to a single instance in an Oracle RAC environment. By setting this parameter to <code>TRUE</code>, you restrict the scope of the parallel server processed to the single Oracle RAC instance where the query coordinator is running.</p>
<p>The recommended value for the <code>PARALLEL_FORCE_LOCAL</code> parameter is <code>FALSE</code>.</p>
</div>
<!-- class="sect3" -->
<a id="CIHHJFFC"></a><a id="VLDBG1486"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h3 class="sect3">PARALLEL_MAX_SERVERS</h3>
<p><a id="sthref1117"></a><a id="sthref1118"></a><a id="sthref1119"></a><a id="sthref1120"></a>The default value is:</p>
<pre>
PARALLEL_THREADS_PER_CPU x CPU_COUNT x concurrent_parallel_users x 5
</pre>
<p>In the formula, the value assigned to <code><span class="codeinlineitalic">concurrent_parallel_users</span></code> running at the default degree of parallelism on an instance is dependent on the memory management setting. If automatic memory management is disabled (manual mode), then the value of <code><span class="codeinlineitalic">concurrent_parallel_users</span></code> is 1. If PGA automatic memory management is enabled, then the value of <code><span class="codeinlineitalic">concurrent_parallel_users</span></code> is 2. If global memory management or SGA memory target is used in addition to PGA automatic memory management, then the value of <code><span class="codeinlineitalic">concurrent_parallel_users</span></code> is 4.</p>
<p>The preceding formula might not be sufficient for parallel queries on tables with higher degree of parallelism (DOP) attributes. For users who expect to run queries of higher DOP, set the value to the following:</p>
<pre>
2 x DOP x NUMBER_OF_CONCURRENT_USERS
</pre>
<p>For example, setting the value to 64 enables you to run four parallel queries simultaneously, if each query is using two slave sets with a DOP of <code>8</code> for each set.</p>
<a id="BEIGJDHB"></a><a id="VLDBG1487"></a>
<div class="sect4">
<h4 class="sect4">When Users Have Too Many Processes</h4>
<p><a id="sthref1121"></a>When concurrent users have too many query server processes, memory contention (paging), I/O contention, or excessive context switching can occur. This contention can reduce system throughput to a level lower than if parallel execution were not used. Increase the <code>PARALLEL_MAX_SERVERS</code> value only if the system has sufficient memory and I/O bandwidth for the resulting load.</p>
<p>You can use performance monitoring tools of the operating system to determine how much memory, swap space and I/O bandwidth are free. Look at the run queue lengths for both your CPUs and disks, and the service time for I/O operations on the system. Verify that the system has sufficient swap space to add more processes. Limiting the total number of query server processes might restrict the number of concurrent users who can execute parallel operations, but system throughput tends to remain stable.</p>
</div>
<!-- class="sect4" -->
<a id="BEIEHEBJ"></a><a id="VLDBG1488"></a>
<div class="sect4">
<h4 class="sect4">Limiting the Number of Resources for a User using a Consumer Group</h4>
<p><a id="sthref1122"></a><a id="sthref1123"></a>You can limit the amount of parallelism available to a given user by establishing a resource consumer group for the user. Do this to limit the number of sessions, concurrent logons, and the number of parallel processes that any one user or group of users can have.</p>
<p>Each query server process working on a parallel execution statement is logged on with a session ID. Each process counts against the user's limit of concurrent sessions. For example, to limit a user to 10 parallel execution processes, set the user's limit to 11. One process is for the parallel execution coordinator and the other 10 consist of two sets of query servers. This would allow one session for the parallel execution coordinator and 10 sessions for the parallel execution processes.</p>
<p>See <a class="olink ADMIN" href="../e25494/toc.htm"><span class="italic">Oracle Database Administrator's Guide</span></a> for more information about managing resources with user profiles and <a class="olink RACAD" href="../../rac.112/e41960/toc.htm"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for more information about querying <code>GV$</code> views.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="i1008224"></a><a id="VLDBG1489"></a>
<div class="sect3">
<h3 class="sect3">PARALLEL_MIN_PERCENT</h3>
<p><a id="sthref1124"></a><a id="sthref1125"></a>This parameter enables users to wait for an acceptable DOP, depending on the application in use. The recommended value for the <code>PARALLEL_MIN_PERCENT</code> parameter is 0 (zero).</p>
<p>Setting this parameter to values other than 0 (zero) causes Oracle Database to return an error when the requested DOP cannot be satisfied by the system at a given time. For example, if you set <code>PARALLEL_MIN_PERCENT</code> to 50, which translates to 50 percent, and the DOP is reduced by 50 percent or greater because of the adaptive algorithm or because of a resource limitation, then Oracle Database returns <code>ORA-12827</code>. For example:</p>
<pre>
SELECT /*+ FULL(e) PARALLEL(e, 8) */ d.department_id, SUM(SALARY)
FROM employees e, departments d WHERE e.department_id = d.department_id
GROUP BY d.department_id ORDER BY d.department_id; 
</pre>
<p>Oracle Database responds with this message:</p>
<pre>
ORA-12827: insufficient parallel query slaves available
</pre></div>
<!-- class="sect3" -->
<a id="i1008068"></a><a id="VLDBG1490"></a>
<div class="sect3">
<h3 class="sect3">PARALLEL_MIN_SERVERS</h3>
<p><a id="sthref1126"></a><a id="sthref1127"></a>This parameter specifies the number of processes to be started in a single instance that are reserved for parallel operations. The syntax is:</p>
<pre>
PARALLEL_MIN_SERVERS=<span class="italic">n</span> 
</pre>
<p>The <span class="italic">n</span> variable is the number of processes you want to start and reserve for parallel operations.</p>
<p>Setting <code>PARALLEL_MIN_SERVERS</code> balances the startup cost against memory usage. Processes started using <code>PARALLEL_MIN_SERVERS</code> do not exit until the database is shut down. This way, when a query is issued, the processes are likely to be available.</p>
</div>
<!-- class="sect3" -->
<a id="BEIFFDDG"></a><a id="VLDBG14093"></a>
<div class="sect3">
<h3 class="sect3">PARALLEL_MIN_TIME_THRESHOLD</h3>
<p><a id="sthref1128"></a><a id="sthref1129"></a>This parameter specifies the minimum execution time a statement should have before the statement is considered for automatic degree of parallelism. By default, this is set to 10 seconds. Automatic degree of parallelism is only enabled if <code>PARALLEL_DEGREE_POLICY</code> is set to <code>AUTO</code> or <code>LIMITED</code>. The syntax is:</p>
<pre>
PARALLEL_MIN_TIME_THRESHOLD = { AUTO | integer }
</pre>
<p>The default is <code>AUTO</code>.</p>
</div>
<!-- class="sect3" -->
<a id="CIHJEGFI"></a><a id="VLDBG1491"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h3 class="sect3">PARALLEL_SERVERS_TARGET</h3>
<p><a id="sthref1130"></a><a id="sthref1131"></a>This parameter specifies the number of parallel server processes allowed to run parallel statements before statement queuing is used. The default value is:</p>
<pre>
PARALLEL_THREADS_PER_CPU * CPU_COUNT * concurrent_parallel_users * 2
</pre>
<p>In the formula, the value assigned to <code><span class="codeinlineitalic">concurrent_parallel_users</span></code> running at the default degree of parallelism on an instance is dependent on the memory management setting. If automatic memory management is disabled (manual mode), then the value of <code><span class="codeinlineitalic">concurrent_parallel_users</span></code> is 1. If PGA automatic memory management is enabled, then the value of <code><span class="codeinlineitalic">concurrent_parallel_users</span></code> is 2. If global memory management or SGA memory target is used in addition to PGA automatic memory management, then the value of <code><span class="codeinlineitalic">concurrent_parallel_users</span></code> is 4.</p>
<p>When <code>PARALLEL_DEGREE_POLICY</code> is set to <code>AUTO</code>, statements that require parallel execution are queued if the number of parallel processes currently in use on the system equals or is greater than <code>PARALLEL_SERVERS_TARGET</code>. This is not the maximum number of parallel server processes allowed on a system (that is controlled by <code>PARALLEL_MAX_SERVERS</code>). However, <code>PARALLEL_SERVERS_TARGET</code> and parallel statement queuing is used to ensure that each statement that requires parallel execution is allocated the necessary parallel server resources and the system is not flooded with too many parallel server processes.</p>
</div>
<!-- class="sect3" -->
<a id="i1008076"></a><a id="VLDBG1492"></a>
<div class="sect3">
<h3 class="sect3">SHARED_POOL_SIZE</h3>
<p><a id="sthref1132"></a><a id="sthref1133"></a>Parallel execution requires memory resources in addition to those required by serial SQL execution. Additional memory is used for communication and passing data between query server processes and the query coordinator.</p>
<p>Oracle Database allocates memory for query server processes from the shared pool. Tune the shared pool as follows:</p>
<ul>
<li>
<p>Allow for other clients of the shared pool, such as shared cursors and stored procedures.</p>
</li>
<li>
<p>Remember that larger values improve performance in multiuser systems, but smaller values use less memory.</p>
</li>
<li>
<p>You can then monitor the number of buffers used by parallel execution and compare the <code>shared</code> <code>pool</code> <code>PX</code> <code>msg</code> <code>pool</code> to the current high water mark reported in output from the view <code>V$PX_PROCESS_SYSSTAT</code>.</p>
<div class="infobox-note">
<p class="notep1"><span class="bold">Note</span>:</p>
If you do not have enough memory available, error message 12853 occurs (insufficient memory for PX buffers: current <span class="italic">string</span>K, max needed <span class="italic">string</span>K). This is caused by having insufficient SGA memory available for PX buffers. You must reconfigure the SGA to have at least (<code>MAX</code> - <code>CURRENT</code>) bytes of additional memory.</div>
</li>
</ul>
<p>By default, Oracle Database allocates parallel execution buffers from the shared pool.</p>
<p>If Oracle Database displays the following error on startup, you should reduce the value for <code>SHARED_POOL_SIZE</code> low enough so your database starts:</p>
<pre>
ORA-27102: out of memory 
SVR4 Error: 12: Not enough space 
</pre>
<p>After reducing the value of <code>SHARED_POOL_SIZE</code>, you might see the error:</p>
<pre>
ORA-04031: unable to allocate 16084 bytes of shared memory 
   ("SHARED pool","unknown object","SHARED pool heap","PX msg pool") 
</pre>
<p>If so, execute the following query to determine why Oracle Database could not allocate the 16,084 bytes:</p>
<pre>
SELECT NAME, SUM(BYTES) FROM V$SGASTAT WHERE POOL='SHARED POOL' 
  GROUP BY ROLLUP (NAME); 
</pre>
<p>Your output should resemble the following:</p>
<pre>
NAME                       SUM(BYTES) 
-------------------------- ---------- 
PX msg pool                   1474572 
free memory                    562132
                              2036704 
</pre>
<p>If you specify <code>SHARED_POOL_SIZE</code> and the amount of memory you specify to reserve is bigger than the pool, Oracle Database does not allocate all the memory it can get. Instead, it leaves some space. When the query runs, Oracle Database tries to get what it needs. Oracle Database uses the 560 KB and needs another 16 KB when it fails. The error does not report the cumulative amount that is needed. The best way of determining how much more memory is needed is to use the formulas in <a href="#i1008125">"Adding Memory for Message Buffers"</a>.</p>
<p>To resolve the problem in the current example, increase the value for <code>SHARED_POOL_SIZE</code>. As shown in the sample output, the <code>SHARED_POOL_SIZE</code> is about 2 MB. Depending on the amount of memory available, you could increase the value of <code>SHARED_POOL_SIZE</code> to 4 MB and attempt to start your database. If Oracle Database continues to display an <code>ORA-4031</code> message, gradually increase the value for <code>SHARED_POOL_SIZE</code> until startup is successful.</p>
</div>
<!-- class="sect3" -->
<a id="BEIJEEDA"></a><a id="VLDBG1493"></a>
<div class="sect3">
<h3 class="sect3">Computing Additional Memory Requirements for Message Buffers</h3>
<p>After you determine the initial setting for the shared pool, you must calculate additional memory requirements for message buffers and determine how much additional space you need for cursors.</p>
<a id="i1008125"></a><a id="VLDBG1494"></a>
<div class="sect4">
<h4 class="sect4">Adding Memory for Message Buffers</h4>
<p>You must increase the value for the <code>SHARED_POOL_SIZE</code> parameter to accommodate message buffers. The message buffers allow query server processes to communicate with each other.</p>
<p>Oracle Database uses a fixed number of buffers for each virtual connection between producer query servers and consumer query servers. Connections increase as the square of the DOP increases. For this reason, the maximum amount of memory used by parallel execution is bound by the highest DOP allowed on your system. You can control this value by using either the <code>PARALLEL_MAX_SERVERS</code> parameter or by using policies and profiles.</p>
<p>To calculate the amount of memory required, use one of the following formulas:</p>
<ul>
<li>
<p>For SMP systems:</p>
<pre>
mem in bytes = (3 x size x users x groups x connections)
</pre></li>
<li>
<p>For Oracle Real Application Clusters and MPP systems:</p>
<pre>
mem in bytes = ((3 x local) + (2 x remote)) x (size x users x groups) 
  / instances
</pre></li>
</ul>
<p>Each instance uses the memory computed by the formula.</p>
<p>The terms are:</p>
<ul>
<li>
<p><code>SIZE</code> = <code>PARALLEL_EXECUTION_MESSAGE_SIZE</code></p>
</li>
<li>
<p><code>USERS</code> = the number of concurrent parallel execution users that you expect to have running with the optimal DOP</p>
</li>
<li>
<p><code>GROUPS</code> = the number of query server process groups used for each query</p>
<p>A simple SQL statement requires only one group. However, if your queries involve subqueries which are processed in parallel, then Oracle Database uses an additional group of query server processes.</p>
</li>
<li>
<p><code>CONNECTIONS</code> = (DOP<sup>2</sup> + 2 x DOP)</p>
<p>If your system is a cluster or MPP, then you should account for the number of instances because this increases the DOP. In other words, using a DOP of 4 on a two-instance cluster results in a DOP of 8. A value of <code>PARALLEL_MAX_SERVERS</code> times the number of instances divided by four is a conservative estimate to use as a starting point.</p>
</li>
<li>
<p><code>LOCAL</code> = <code>CONNECTIONS</code>/<code>INSTANCES</code></p>
</li>
<li>
<p><code>REMOTE</code> = <code>CONNECTIONS</code> - <code>LOCAL</code></p>
</li>
</ul>
<p>Add this amount to your original setting for the shared pool. However, before setting a value for either of these memory structures, you must also consider additional memory for cursors, as explained in the following section.</p>
</div>
<!-- class="sect4" -->
<a id="VLDBG1495"></a>
<div class="sect4"><a id="sthref1134"></a>
<h4 class="sect4">Calculating Additional Memory for Cursors</h4>
<p>Parallel execution plans consume more space in the SQL area than serial execution plans. You should regularly monitor shared pool resource use to ensure that the memory used by both messages and cursors can accommodate your system's processing requirements.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="BEIEBCAF"></a><a id="VLDBG1496"></a>
<div class="sect3">
<h3 class="sect3">Adjusting Memory After Processing Begins</h3>
<p>The formulas in this section are just starting points. Whether you are using automated or manual tuning, you should monitor usage on an on-going basis to ensure the size of memory is not too large or too small. To ensure the correct memory size, tune the shared pool using the following query:</p>
<pre>
SELECT POOL, NAME, SUM(BYTES) FROM V$SGASTAT WHERE POOL LIKE '%pool%'
  GROUP BY ROLLUP (POOL, NAME);
</pre>
<p>Your output should resemble the following:</p>
<pre>
POOL        NAME                       SUM(BYTES) 
----------- -------------------------- ---------- 
shared pool Checkpoint queue                38496 
shared pool KGFF heap                        1964 
shared pool KGK heap                         4372 
shared pool KQLS heap                     1134432 
shared pool LRMPD SGA Table                 23856 
shared pool PLS non-lib hp                   2096 
shared pool PX subheap                     186828 
shared pool SYSTEM PARAMETERS               55756 
shared pool State objects                 3907808 
shared pool character set memory            30260 
shared pool db_block_buffers               200000 
shared pool db_block_hash_buckets           33132 
shared pool db_files                       122984 
shared pool db_handles                      52416 
shared pool dictionary cache               198216 
shared pool dlm shared memory             5387924 
shared pool event statistics per sess      264768 
shared pool fixed allocation callback        1376 
shared pool free memory                  26329104 
shared pool gc_*                            64000 
shared pool latch nowait fails or sle       34944 
shared pool library cache                 2176808 
shared pool log_buffer                      24576 
shared pool log_checkpoint_timeout          24700 
shared pool long op statistics array        30240 
shared pool message pool freequeue         116232 
shared pool miscellaneous                  267624 
shared pool processes                       76896 
shared pool session param values            41424 
shared pool sessions                       170016 
shared pool sql area                      9549116 
shared pool table columns                  148104 
shared pool trace_buffers_per_process     1476320 
shared pool transactions                    18480 
shared pool trigger inform                  24684 
shared pool                              52248968 
                                         90641768 
</pre>
<p>Evaluate the memory used as shown in your output, and alter the setting for <code>SHARED_POOL_SIZE</code> based on your processing needs.</p>
<p>To obtain more memory usage statistics, execute the following query:</p>
<pre>
SELECT * FROM V$PX_PROCESS_SYSSTAT WHERE STATISTIC LIKE 'Buffers%';
</pre>
<p>Your output should resemble the following:</p>
<pre>
STATISTIC                           VALUE 
-------------------                 ----- 
Buffers Allocated                   23225 
Buffers Freed                       23225 
Buffers Current                         0 
Buffers HWM                          3620 
</pre>
<p>The amount of memory used appears in the <code>Buffers</code> <code>Current</code> and <code>Buffers</code> <code>HWM</code> statistics. Calculate a value in bytes by multiplying the number of buffers by the value for <code>PARALLEL_EXECUTION_MESSAGE_SIZE</code>. Compare the high water mark to the parallel execution message pool size to determine if you allocated too much memory. For example, in the first output, the value for large pool as shown in <code>px</code> <code>msg</code> <code>pool</code> is 38,092,812 or 38 MB. The <code>Buffers</code> <code>HWM</code> from the second output is 3,620, which when multiplied by a parallel execution message size of 4,096 is 14,827,520, or approximately 15 MB. In this case, the high water mark has reached approximately 40 percent of its capacity.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1008241"></a><a id="VLDBG1497"></a>
<div class="sect2">
<h2 class="sect2">Parameters Affecting Resource Consumption</h2>
<p><a id="sthref1135"></a>Before considering the following section, you should read the descriptions of the <code>MEMORY_TARGET</code> an<a id="sthref1136"></a><a id="sthref1137"></a><a id="sthref1138"></a><a id="sthref1139"></a>d <code>MEMORY_MAX_TARGET</code> initialization parameters in <a class="olink PFGRF" href="../e41573/toc.htm"><span class="italic">Oracle Database Performance Tuning Guide</span></a> and <a class="olink ADMIN11233" href="../../server.112/e25494/memory.htm#ADMIN11233"><span class="italic">Oracle Database Administrator's Guide</span></a> for details. The <code>PGA_AGGREGATE_TARGET</code> initialization parameter need not be set as <code>MEMORY_TARGET</code> autotunes the SGA and PGA components.</p>
<p>The first group of parameters discussed in this section affects memory and resource consumption for all parallel operations, in particular, for parallel execution. These parameters are:</p>
<ul>
<li>
<p><a href="#i1008273">PGA_AGGREGATE_TARGET</a></p>
</li>
<li>
<p><a href="#i1008295">PARALLEL_EXECUTION_MESSAGE_SIZE</a></p>
</li>
</ul>
<p>A second subset of parameters are discussed in <a href="#BEIBHICH">"Parameters Affecting Resource Consumption for Parallel DML and Parallel DDL"</a>.</p>
<p>To control resource consumption, <a id="sthref1140"></a><a id="sthref1141"></a>you should configure <a id="sthref1142"></a>memory at two levels:</p>
<ul>
<li>
<p>At the database level, so the system uses an appropriate amount of memory from the operating system.</p>
</li>
<li>
<p>At the operating system level for consistency.</p>
<p>On some platforms, you might need to set operating system parameters that control the total amount of virtual memory available, totalled across all processes.</p>
</li>
</ul>
<p>A large percentage of the memory used in data warehousing operations (compared to OLTP) is more dynamic. This memory comes from Process Global Area (PGA), and both the size of process memory and the number of processes can vary greatly. Use the <code>PGA_AGGREGATE_TARGET</code> initialization parameter to control both the process memory and the number of processes in such cases. Explicitly setting <code>PGA_AGGREGATE_TARGET</code> along with <code>MEMORY_TARGET</code> ensures that autotuning still occurs but <code>PGA_AGGREGATE_TARGET</code> is not tuned below the specified value.</p>
<a id="i1008273"></a><a id="VLDBG1498"></a>
<div class="sect3">
<h3 class="sect3"><a id="sthref1143"></a><a id="sthref1144"></a>PGA_AGGREGATE_TARGET</h3>
<p>You can simplify and improve the way PGA memory is allocated by enabling automatic PGA memory management. In this mode, Oracle Database dynamically adjusts the size of the portion of the PGA memory dedicated to work areas, based on an overall PGA memory target explicitly set by the DBA. To enable automatic PGA memory management, you must set the initialization parameter <code>PGA_AGGREGATE_TARGET</code>. For new installations, <code>PGA_AGGREGATE_TARGET</code> and <code>SGA_TARGET</code> are set automatically by the database configuration assistant (DBCA), and <code>MEMORY_TARGET</code> is zero. That is, automatic memory management is disabled. You can enable it in Oracle Enterprise Manager on the Memory Parameters page. Therefore, automatic tuning of the aggregate PGA is enabled by default. However, the aggregate PGA does not grow unless you enable automatic memory management by setting <code>MEMORY_TARGET</code> to a nonzero value.</p>
<p>See <a class="olink PFGRF" href="../e41573/toc.htm"><span class="italic">Oracle Database Performance Tuning Guide</span></a> for descriptions of how to use <code>PGA_AGGREGATE_TARGET</code> in different scenarios.</p>
<a id="VLDBG1499"></a>
<div class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref1145"></a>
<h4 class="sect4">HASH_AREA_SIZE</h4>
<p><code>HASH_AREA_SIZE</code> has been deprecated and you should use <code>PGA_AGGREGATE_TARGET</code> instead.</p>
</div>
<!-- class="sect4" -->
<a id="i1008291"></a><a id="VLDBG1500"></a>
<div class="sect4">
<h4 class="sect4"><a id="sthref1146"></a>SORT_AREA_SIZE</h4>
<p><code>SORT_AREA_SIZE</code> has been deprecated and you should use <code>PGA_AGGREGATE_TARGET</code> instead.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="i1008295"></a><a id="VLDBG1501"></a>
<div class="sect3">
<h3 class="sect3"><a id="sthref1147"></a><a id="sthref1148"></a>PARALLEL_EXECUTION_MESSAGE_SIZE</h3>
<p>The <code>PARALLEL_EXECUTION_MESSAGE_SIZE</code> parameter specifies the size of the buffer used for parallel execution messages. The default value is operating system-specific, but is typically 16 K. This value should be adequate for most applications.</p>
</div>
<!-- class="sect3" -->
<a id="BEIBHICH"></a><a id="VLDBG1502"></a>
<div class="sect3">
<h3 class="sect3">Parameters Affecting Resource Consumption for Parallel DML and Parallel DDL</h3>
<p>The parameters that affect parallel DML and parallel DDL resource consumption are:</p>
<ul>
<li>
<p><a href="#i1008331">TRANSACTIONS</a></p>
</li>
<li>
<p><a href="#i1008341">FAST_START_PARALLEL_ROLLBACK</a></p>
</li>
<li>
<p><a href="#i1008352">DML_LOCKS</a></p>
</li>
</ul>
<p><a id="sthref1149"></a>Parallel insert, update, and delete operations require more resources than serial DML operations. Similarly, <code><a id="sthref1150"></a>PARALLEL</code> <code>CREATE</code> <code>TABLE</code> ... <code>AS</code> <code>SELECT</code> and <code><a id="sthref1151"></a>PARALLEL</code> <code>CREATE</code> <code>INDEX</code> can require more resources. For this reason, you may need to increase the value of several additional initialization parameters. These parameters do <span class="italic">not</span> affect resources for queries.</p>
<a id="i1008331"></a><a id="VLDBG1503"></a>
<div class="sect4">
<h4 class="sect4">TRANSACTIONS</h4>
<p>For parallel DML and DDL, each query server process starts a transaction. The parallel execution coordinator uses the <a id="sthref1152"></a>two-phase commit protocol to commit transactions; therefore, the number of transactions being processed increases by the DOP. Consequently, you might need to increase the value of the <code><a id="sthref1153"></a><a id="sthref1154"></a>TRANSACTIONS</code> initialization parameter.</p>
<p>The <code>TRANSACTIONS</code> parameter specifies the maximum number of concurrent transactions. The default assumes no parallelism. For example, if you have a DOP of 20, you have 20 more new server transactions (or 40, if you have two server sets) and 1 coordinator transaction. In this case, you should increase <code>TRANSACTIONS</code> by 21 (or 41) if the transactions are running in the same instance. If you do not set this parameter, Oracle Database sets it to a value equal to 1.1 x <code>SESSIONS</code>. This discussion does not apply if you are using server-managed undo.</p>
</div>
<!-- class="sect4" -->
<a id="i1008341"></a><a id="VLDBG1504"></a>
<div class="sect4">
<h4 class="sect4">FAST_START_PARALLEL_ROLLBACK</h4>
<p>If a system fails when there are uncommitted parallel DML or DDL transactions, you can speed up transaction recovery during startup by using the <code><a id="sthref1155"></a><a id="sthref1156"></a>FAST_START_PARALLEL_ROLLBACK</code> parameter.</p>
<p>This parameter controls the DOP used when recovering terminated transactions. Terminated transactions are transactions that are active before a system failure. By default, the DOP is chosen to be at most two times the value of the <code>CPU_COUNT</code> parameter.</p>
<p>If the default DOP is insufficient, set the parameter to <code>HIGH</code>. This gives a maximum DOP of at most four times the value of the <code>CPU_COUNT</code> parameter. This feature is available by default.</p>
</div>
<!-- class="sect4" -->
<a id="i1008352"></a><a id="VLDBG1505"></a>
<div class="sect4">
<h4 class="sect4">DML_LOCKS</h4>
<p>This parameter specifies the maximum number of DML locks. Its value should equal the total number of locks on all tables referenced by all users. A parallel DML operation's lock requirement is very different from serial DML. Parallel DML holds many more locks, so you should increase the value of the <code>DML_LOCKS</code> parameter by equal amounts.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Parallel DML operations are not performed when the table lock of the target table is disabled.</div>
<p><a href="#CACCBCJH">Table 8-4</a> shows the types of locks acquired by coordinator and parallel execution server processes for different types of parallel DML statements. Using this information, you can determine the value required for these parameters.</p>
<div class="tblformal">
<p class="titleintable"><a id="VLDBG1506"></a><a id="sthref1157"></a><a id="CACCBCJH"></a>Table 8-4 Locks Acquired by Parallel DML Statements</p>
<table class="cellalignment1838" title="Locks Acquired by Parallel DML Statements" summary="Locks Acquired by Parallel DML Statements" dir="ltr">
<thead>
<tr class="cellalignment1829">
<th class="cellalignment1836" id="r1c1-t19">Type of Statement</th>
<th class="cellalignment1836" id="r1c2-t19">Coordinator Process Acquires:</th>
<th class="cellalignment1836" id="r1c3-t19">Each Parallel Execution Server Acquires:</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1829">
<td class="cellalignment1837" id="r2c1-t19" headers="r1c1-t19">
<p>Parallel <code>UPDATE</code> or <code>DELETE</code> into partitioned table; <code>WHERE</code> clause pruned to a subset of partitions or subpartitions</p>
</td>
<td class="cellalignment1837" headers="r2c1-t19 r1c2-t19">
<p>1 table lock SX</p>
<p>1 partition lock X for each pruned partition or subpartition</p>
</td>
<td class="cellalignment1837" headers="r2c1-t19 r1c3-t19">
<p>1 table lock SX</p>
<p>1 partition lock <code>NULL</code> for each pruned partition or subpartition owned by the query server process</p>
<p>1 partition-wait lock S for each pruned partition or subpartition owned by the query server process</p>
</td>
</tr>
<tr class="cellalignment1829">
<td class="cellalignment1837" id="r3c1-t19" headers="r1c1-t19">
<p>Parallel row-migrating <code>UPDATE</code> into partitioned table; <code>WHERE</code> clause pruned to a subset of partitions or subpartitions</p>
</td>
<td class="cellalignment1837" headers="r3c1-t19 r1c2-t19">
<p>1 table lock SX</p>
<p>1 partition X lock for each pruned partition or subpartition</p>
<p>1 partition lock SX for all other partitions or subpartitions</p>
</td>
<td class="cellalignment1837" headers="r3c1-t19 r1c3-t19">
<p>1 table lock SX</p>
<p>1 partition lock <code>NULL</code> for each pruned partition or subpartition owned by the query server process</p>
<p>1 partition-wait lock S for each pruned partition owned by the query server process</p>
<p>1 partition lock SX for all other partitions or subpartitions</p>
</td>
</tr>
<tr class="cellalignment1829">
<td class="cellalignment1837" id="r4c1-t19" headers="r1c1-t19">
<p>Parallel <code>UPDATE</code>, <code>MERGE</code>, <code>DELETE</code>, or <code>INSERT</code> into partitioned table</p>
</td>
<td class="cellalignment1837" headers="r4c1-t19 r1c2-t19">
<p>1 table lock SX</p>
<p>Partition locks X for all partitions or subpartitions</p>
</td>
<td class="cellalignment1837" headers="r4c1-t19 r1c3-t19">
<p>1 table lock SX</p>
<p>1 partition lock <code>NULL</code> for each partition or subpartition</p>
<p>1 partition-wait lock S for each partition or subpartition</p>
</td>
</tr>
<tr class="cellalignment1829">
<td class="cellalignment1837" id="r5c1-t19" headers="r1c1-t19">
<p>Parallel <code>INSERT</code> into partitioned table; destination table with partition or subpartition clause</p>
</td>
<td class="cellalignment1837" headers="r5c1-t19 r1c2-t19">
<p>1 table lock SX</p>
<p>1 partition lock X for each specified partition or subpartition</p>
</td>
<td class="cellalignment1837" headers="r5c1-t19 r1c3-t19">
<p>1 table lock SX</p>
<p>1 partition lock <code>NULL</code> for each specified partition or subpartition</p>
<p>1 partition-wait lock S for each specified partition or subpartition</p>
</td>
</tr>
<tr class="cellalignment1829">
<td class="cellalignment1837" id="r6c1-t19" headers="r1c1-t19">
<p>Parallel <code>INSERT</code> into nonpartitioned table</p>
</td>
<td class="cellalignment1837" headers="r6c1-t19 r1c2-t19">
<p>1 table lock X</p>
</td>
<td class="cellalignment1837" headers="r6c1-t19 r1c3-t19">
<p>None</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<div class="infobox-note">
<p class="notep1">Note:</p>
Table, partition, and partition-wait DML locks all appear as TM locks in the <code>V$LOCK</code> view.</div>
<p>Consider a table with 600 partitions running with a DOP of 100. Assume all partitions are involved in a parallel <code>UPDATE</code> or <code>DELETE</code> statement with no row-migrations.</p>
<p>The coordinator acquires:</p>
<ul>
<li>
<p>1 table lock SX</p>
</li>
<li>
<p>600 partition locks X</p>
</li>
</ul>
<p>Total server processes acquire:</p>
<ul>
<li>
<p>100 table locks SX</p>
</li>
<li>
<p>600 partition locks NULL</p>
</li>
<li>
<p>600 partition-wait locks S</p>
</li>
</ul>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1008458"></a><a id="VLDBG1507"></a>
<div class="sect2">
<h2 class="sect2">Parameters Related to I/O</h2>
<p>The parameters that affect I/O are:</p>
<ul>
<li>
<p><a href="#i1008479">DB_CACHE_SIZE</a></p>
</li>
<li>
<p><a href="#i1008483">DB_BLOCK_SIZE</a></p>
</li>
<li>
<p><a href="#i1008489">DB_FILE_MULTIBLOCK_READ_COUNT</a></p>
</li>
<li>
<p><a href="#i1008495">DISK_ASYNCH_IO and TAPE_ASYNCH_IO</a></p>
</li>
</ul>
<p><a id="sthref1158"></a>These parameters also affect the optimizer, which ensures optimal performance for parallel execution of I/O operations.</p>
<a id="i1008479"></a><a id="VLDBG1508"></a>
<div class="sect3">
<h3 class="sect3"><a id="sthref1159"></a><a id="sthref1160"></a>DB_CACHE_SIZE</h3>
<p>When you perform parallel update, merge, and delete operations, the buffer cache behavior is very similar to any OLTP system running a high volume of updates.</p>
</div>
<!-- class="sect3" -->
<a id="i1008483"></a><a id="VLDBG1509"></a>
<div class="sect3">
<h3 class="sect3"><a id="sthref1161"></a><a id="sthref1162"></a>DB_BLOCK_SIZE</h3>
<p>The recommended value for this parameter is 8 KB or 16 KB.</p>
<p>Set the database block size when you create the database. If you are creating a new database, use a large block size such as 8 KB or 16 KB.</p>
</div>
<!-- class="sect3" -->
<a id="i1008489"></a><a id="VLDBG1510"></a>
<div class="sect3">
<h3 class="sect3"><a id="sthref1163"></a><a id="sthref1164"></a>DB_FILE_MULTIBLOCK_READ_COUNT</h3>
<p>This parameter determines how many database blocks are read with a single operating system <code>READ</code> call. In this release, the default value of this parameter is a value that corresponds to the maximum I/O size that can be performed efficiently. The maximum I/O size value is platform-dependent and is 1 MB for most platforms. If you set <code>DB_FILE_MULTIBLOCK_READ_COUNT</code> to an excessively high value, your operating system lowers the value to the highest allowable level when you start your database.</p>
</div>
<!-- class="sect3" -->
<a id="i1008495"></a><a id="VLDBG1511"></a>
<div class="sect3">
<h3 class="sect3"><a id="sthref1165"></a><a id="sthref1166"></a>DISK_ASYNCH_IO and <a id="sthref1167"></a><a id="sthref1168"></a><a id="sthref1169"></a><a id="sthref1170"></a>TAPE_ASYNCH_IO</h3>
<p>The recommended value for both of these parameters is <code>TRUE</code>.</p>
<p>These parameters enable or disable the operating system's asynchronous I/O facility. They allow query server processes to overlap I/O requests with processing when performing table scans. If the operating system supports asynchronous I/O, leave these parameters at the default value of <code>TRUE</code>. <a href="#i1008503">Figure 8-6</a> illustrates how asynchronous read works.</p>
<div class="figure">
<p class="titleinfigure"><a id="i1008503"></a><a id="VLDBG1512"></a>Figure 8-6 Asynchronous Read</p>
<img width="435" height="239" src="img/vldbg016.gif" alt="Description of Figure 8-6 follows" /><br />
<a id="sthref1171" href="img_text/vldbg016.htm">Description of "Figure 8-6 Asynchronous Read"</a><br />
<br /></div>
<!-- class="figure" -->
<p>Asynchronous operations are currently supported for parallel table scans, hash joins, sorts, and serial table scans. However, this feature can require operating system-specific configuration and may not be supported on all platforms.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1828">
<tr>
<td class="cellalignment1837">
<table class="cellalignment1833">
<tr>
<td class="cellalignment1832"><a href="parallel004.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1832"><a href="parallel006.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2008, 2011,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1840">
<table class="cellalignment1831">
<tr>
<td class="cellalignment1832"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1832"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1832"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1832"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1832"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1832"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
