<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Integrity Constraints</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 070" />
<meta name="dcterms.created" content="2013-07-04T23:23:15Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Data Warehousing Guide" />
<meta name="dcterms.identifier" content="E25554-02" />
<meta name="dcterms.isVersionOf" content="DWHSG" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2001, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="indexes.htm" title="Previous" type="text/html" />
<link rel="Next" href="basicmv.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e25554.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">15/35</span> <!-- End Header --><a id="g1007841"></a><a id="DWHSG007"></a><a id="i1006394"></a>
<h1 class="chapter"><span class="secnum">8</span> Integrity Constraints</h1>
<p>This chapter describes integrity constraints. It contains the following topics:</p>
<ul>
<li>
<p><a href="#i1006194">Why Integrity Constraints are Useful in a Data Warehouse</a></p>
</li>
<li>
<p><a href="#i1006220">Overview of Constraint States</a></p>
</li>
<li>
<p><a href="#i1006232">Typical Data Warehouse Integrity Constraints</a></p>
</li>
</ul>
<a id="i1006194"></a><a id="DWHSG8151"></a>
<div class="sect1">
<h2 class="sect1">Why Integrity Constraints are Useful in a Data Warehouse</h2>
<p><a id="sthref129"></a><a id="sthref130"></a>Integrity constraints provide a mechanism for ensuring that data conforms to guidelines specified by the database administrator. The most common types of constraints include:</p>
<ul>
<li>
<p><code>UNIQUE</code> constraints</p>
<p>To ensure that a given column is unique</p>
</li>
<li>
<p><code>NOT</code> <code>NULL</code> constraints</p>
<p>To ensure that no null values are allowed</p>
</li>
<li>
<p><code>FOREIGN</code> <code>KEY</code> constraints</p>
<p>To ensure that two keys share a primary key to foreign key relationship</p>
</li>
</ul>
<p>Constraints can be used for these purposes in a data warehouse:</p>
<ul>
<li>
<p>Data cleanliness</p>
<p>Constraints verify that the data in the data warehouse conforms to a basic level of data consistency and correctness, preventing the introduction of dirty data.</p>
</li>
<li>
<p>Query optimization</p>
<p>The Oracle Database utilizes constraints when optimizing SQL queries. Although constraints can be useful in many aspects of query optimization, constraints are particularly important for query rewrite of materialized views.</p>
</li>
</ul>
<p>Unlike data in many relational database environments, data in a data warehouse is typically added or modified under controlled circumstances during the extraction, transformation, and loading (<a id="sthref131"></a>ETL) process. Multiple users normally do not update the data warehouse directly, as they do in an OLTP system.</p>
<div class="infoboxnotealso">
<p class="notep1"><span class="bold">See Also</span>:</p>
<a href="ettover.htm#g1006465">Chapter 12, "Overview of Extraction, Transformation, and Loading"</a></div>
</div>
<!-- class="sect1" -->
<a id="i1006220"></a><a id="DWHSG8152"></a>
<div class="sect1">
<h2 class="sect1">Overview of Constraint States</h2>
<p>To understand how bes<a id="sthref132"></a>t to use constraints in a data warehouse, you should first understand the basic purposes of constraints. Some of these purposes are:</p>
<ul>
<li>
<p>Enforcement</p>
<p>In order to use a constraint for enforcement, the constraint must be in the <code>ENABLE</code> state. An enabled constraint ensures that all data modifications upon a given table (or tables) satisfy the conditions of the constraints. Data modification operations which produce data that violates the constraint fail with a constraint violation error.</p>
</li>
<li>
<p>Validation</p>
<p>To use a constraint for validation, the constraint must be in the <code>VALIDATE</code> state. If the constraint is validated, then all data that currently resides in the table satisfies the constraint.</p>
<p>Note that validation is independent of enforcement. Although the typical constraint in an operational system is both enabled and validated, any constraint could be validated but not enabled or vice versa (enabled but not validated). These latter two cases are useful for data warehouses.</p>
</li>
<li>
<p>Belief</p>
<p>In some cases, you will know that the conditions for a given constraint are true, so you do not need to validate or enforce the constraint. However, you may wish for the constraint to be present anyway to improve query optimization and performance. When you use a constraint in this way, it is called a belief or <code>RELY</code> constraint, and the constraint must be in the <code>RELY</code> state. The <code>RELY</code> state provides you with a mechanism for telling Oracle that a given constraint is believed to be true.</p>
<p>Note that the <code>RELY</code> state only affects constraints that have not been validated.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="i1006232"></a><a id="DWHSG8153"></a>
<div class="sect1">
<h2 class="sect1">Typical Data Warehouse Integrity Constraints</h2>
<p>This section assumes that you are familiar with the typical use of constraints. That is, constraints that are both enabled and validated. For data warehousing, many users have discovered that such constraints may be prohibitively costly to build and maintain. The topics discussed are:</p>
<ul>
<li>
<p><a href="#i1006259">UNIQUE Constraints in a Data Warehouse</a></p>
</li>
<li>
<p><a href="#i1006284">FOREIGN KEY Constraints in a Data Warehouse</a></p>
</li>
<li>
<p><a href="#i1006300">RELY Constraints</a></p>
</li>
<li>
<p><a href="#BGBDGJCJ">NOT NULL Constraints</a></p>
</li>
<li>
<p><a href="#i1006314">Integrity Constraints and Parallelism</a></p>
</li>
<li>
<p><a href="#i1006317">Integrity Constraints and Partitioning</a></p>
</li>
<li>
<p><a href="#CHDGHICH">View Constraints</a></p>
</li>
</ul>
<a id="i1006259"></a><a id="DWHSG8154"></a>
<div class="sect2">
<h3 class="sect2">UNIQUE Constraints in a Data Warehouse</h3>
<p><a id="sthref133"></a><a id="sthref134"></a>A <code>UNIQUE</code> constraint is typically enforced using a <code>UNIQUE</code> index. However, in a data warehouse whose tables can be extremely large, creating a unique index can be costly both in processing time and in disk space.</p>
<p>Suppose that a data warehouse contains a table <code>sales</code>, which includes a column <code>sales_id</code>. <code>sales_id</code> uniquely identifies a single sales transaction, and the data warehouse administrator must ensure that this column is unique within the data warehouse.</p>
<p>One way to create the constraint is as follows:</p>
<pre>
ALTER TABLE sales ADD CONSTRAINT sales_uk
UNIQUE (prod_id, cust_id, promo_id, channel_id, time_id);
</pre>
<p>By default, this constraint is both enabled and validated. Oracle implicitly creates a unique index on <code>sales_id</code> to support this constraint. However, this index can be problematic in a data warehouse for three reasons:</p>
<ul>
<li>
<p>The unique index can be very large, because the <code>sales</code> table can easily have millions or even billions of rows.</p>
</li>
<li>
<p>The unique index is rarely used for query execution. Most data warehousing queries do not have predicates on unique keys, so creating this index will probably not improve performance.</p>
</li>
<li>
<p>If <code>sales</code> is partitioned along a column other than <code>sales_id</code>, the unique index must be global. This can detrimentally affect all maintenance operations on the <code>sales</code> table.</p>
</li>
</ul>
<p>A unique index is required for unique constraints to ensure that each individual row modified in the <code>sales</code> table satisfies the <code>UNIQUE</code> constraint.</p>
<p>For data warehousing tables, an alternative mechanism for unique constraints is illustrated in the following statement:</p>
<pre>
ALTER TABLE sales ADD CONSTRAINT sales_uk
UNIQUE (prod_id, cust_id, promo_id, channel_id, time_id) DISABLE VALIDATE;
</pre>
<p>This statement creates a unique constraint, but, because the constraint is disabled, a unique index is not required. This approach can be advantageous for many data warehousing environments because the constraint now ensures uniqueness without the cost of a unique index.</p>
<p>However, there are trade-offs for the data warehouse administrator to consider with <code>DISABLE</code> <code>VALIDATE</code> constraints. Because this constraint is disabled, no DML statements that modify the unique column are permitted against the <code>sales</code> table. You can use one of two strategies for modifying this table in the presence of a constraint:</p>
<ul>
<li>
<p>Use DDL to add data to this table (such as exchanging partitions). See the example in <a href="refresh.htm#g1018554">Chapter 16, "Maintaining the Data Warehouse"</a>.</p>
</li>
<li>
<p>Before modifying this table, drop the constraint. Then, make all necessary data modifications. Finally, re-create the disabled constraint. Re-creating the constraint is more efficient than re-creating an enabled constraint. However, this approach does not guarantee that data added to the <code>sales</code> table while the constraint has been dropped is unique.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="i1006284"></a><a id="DWHSG8155"></a>
<div class="sect2">
<h3 class="sect2">FOREIGN KEY Constraints in a Data Warehouse</h3>
<p><a id="sthref135"></a><a id="sthref136"></a>In a star schema data warehouse, <code>FOREIGN</code> <code>KEY</code> constraints validate the relationship between the fact table and the dimension tables. A sample constraint might be:</p>
<pre>
ALTER TABLE sales ADD CONSTRAINT sales_time_fk
FOREIGN KEY (time_id) REFERENCES times (time_id)
ENABLE VALIDATE;
</pre>
<p>However, in some situations, you may choose to use a different state for the <code>FOREIGN</code> <code>KEY</code> constraints, in particular, the <code>ENABLE NOVALIDATE</code> state. A data warehouse administrator might use an <code>ENABLE NOVALIDATE</code> constraint when either:</p>
<ul>
<li>
<p>The tables contain data that currently disobeys the constraint, but the data warehouse administrator wishes to create a constraint for future enforcement.</p>
</li>
<li>
<p>An enforced constraint is required immediately.</p>
</li>
</ul>
<p>Suppose that the data warehouse loaded new data into the fact tables every day, but refreshed the dimension tables only on the weekend. During the week, the dimension tables and fact tables may in fact disobey the <code>FOREIGN</code> <code>KEY</code> constraints. Nevertheless, the data warehouse administrator might wish to maintain the enforcement of this constraint to prevent any changes that might affect the <code>FOREIGN</code> <code>KEY</code> constraint outside of the ETL process. Thus, you can create the <code>FOREIGN</code> <code>KEY</code> constraints every night, after performing the ETL process, as shown in the following:</p>
<pre>
ALTER TABLE sales ADD CONSTRAINT sales_time_fk
FOREIGN KEY (time_id) REFERENCES times (time_id)
ENABLE NOVALIDATE;
</pre>
<p><code>ENABLE</code> <code>NOVALIDATE</code> can quickly create an enforced constraint, even when the constraint is believed to be true. Suppose that the ETL process verifies that a <code>FOREIGN</code> <code>KEY</code> constraint is true. Rather than have the database re-verify this <code>FOREIGN</code> <code>KEY</code> constraint, which would require time and database resources, the data warehouse administrator could instead create a <code>FOREIGN</code> <code>KEY</code> constraint using <code>ENABLE</code> <code>NOVALIDATE</code>.</p>
</div>
<!-- class="sect2" -->
<a id="i1006300"></a><a id="DWHSG8156"></a>
<div class="sect2">
<h3 class="sect2">RELY Constraints</h3>
<p><a id="sthref137"></a><a id="sthref138"></a>The ETL process commonly verifies that certain constraints are true. For example, it can validate all of the foreign keys in the data coming into the fact table. This means that you can trust it to provide clean data, instead of implementing constraints in the data warehouse. You create a <code>RELY</code> constraint as follows:</p>
<pre>
ALTER TABLE sales ADD CONSTRAINT sales_time_fk
FOREIGN KEY (time_id) REFERENCES times (time_id) 
RELY DISABLE NOVALIDATE;
</pre>
<p>This statement assumes that the primary key is in the <code>RELY</code> state. <code>RELY</code> constraints, even though they are not used for data validation, can:</p>
<ul>
<li>
<p>Enable more sophisticated query rewrites for materialized views. See <a href="qrbasic.htm#g1045551">Chapter 18, "Basic Query Rewrite"</a> for further details.</p>
</li>
<li>
<p>Enable other data warehousing tools to retrieve information regarding constraints directly from the Oracle data dictionary.</p>
</li>
</ul>
<p>Creating a <code>RELY</code> constraint is inexpensive and does not impose any overhead during DML or load. Because the constraint is not being validated, no data processing is necessary to create it.</p>
</div>
<!-- class="sect2" -->
<a id="BGBDGJCJ"></a><a id="DWHSG8157"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">NOT NULL Constraints</h3>
<p>When using query rewrite, you should consider whether <code>NOT</code> <code>NULL</code> constraints are required. The primary situation where you will need to use them is for join back query rewrite. See <a href="qradv.htm#g1045552">Chapter 19, "Advanced Query Rewrite"</a> for further information regarding <code>NOT</code> <code>NULL</code> constraints when using query rewrite.</p>
</div>
<!-- class="sect2" -->
<a id="i1006314"></a><a id="DWHSG8158"></a>
<div class="sect2">
<h3 class="sect2">Integrity Constraints and Parallelism</h3>
<p>All constraints can be validated in parallel. When validating constraints on very large tables, parallelism is often necessary to meet performance goals. The degree of parallelism for a given constraint operation is determined by the default degree of parallelism of the underlying table.</p>
</div>
<!-- class="sect2" -->
<a id="i1006317"></a><a id="DWHSG8159"></a>
<div class="sect2">
<h3 class="sect2">Integrity Constraints and Partitioning</h3>
<p><a id="sthref139"></a>You can create and maintain constraints before you partition the data. Later chapters discuss the significance of partitioning for data warehousing. Partitioning can improve constraint management just as it does to management of many other operations. For example, <a href="refresh.htm#g1018554">Chapter 16, "Maintaining the Data Warehouse"</a> provides a scenario creating <code>UNIQUE</code> and <code>FOREIGN</code> <code>KEY</code> constraints on a separate staging table, and these constraints are maintained during the<a id="sthref140"></a> <code>EXCHANGE</code> <code>PARTITION</code> statement.</p>
</div>
<!-- class="sect2" -->
<a id="CHDGHICH"></a><a id="DWHSG8160"></a>
<div class="sect2">
<h3 class="sect2">View Constraints</h3>
<p>You can <a id="sthref141"></a><a id="sthref142"></a>create constraints on views. The only type of constraint supported on a view is a <code>RELY</code> constraint.</p>
<p>This type of constraint is useful when queries typically access views instead of base tables, and the database administrator thus needs to define the data relationships between views rather than tables.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="basicmv.htm#g1028195">Chapter 9, "Basic Materialized Views"</a> and <a href="qrbasic.htm#g1045551">Chapter 18, "Basic Query Rewrite"</a></div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1371">
<tr>
<td class="cellalignment1378">
<table class="cellalignment1376">
<tr>
<td class="cellalignment1375"><a href="indexes.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1375"><a href="basicmv.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2001, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1380">
<table class="cellalignment1374">
<tr>
<td class="cellalignment1375"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1375"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1375"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1375"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1375"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1375"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
