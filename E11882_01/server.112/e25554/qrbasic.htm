<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Basic Query Rewrite</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 070" />
<meta name="dcterms.created" content="2013-07-04T23:23:20Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Data Warehousing Guide" />
<meta name="dcterms.identifier" content="E25554-02" />
<meta name="dcterms.isVersionOf" content="DWHSG" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2001, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="part5.htm" title="Previous" type="text/html" />
<link rel="Next" href="qradv.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e25554.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">27/35</span> <!-- End Header --><a id="g1045551"></a><a id="DWHSG018"></a><a id="i1008297"></a>
<h1 class="chapter"><span class="secnum">18</span> Basic Query Rewrite</h1>
<p>This chapter discusses query rewrite in Oracle, and contains:</p>
<ul>
<li>
<p><a href="#i1006201">Overview of Query Rewrite</a></p>
</li>
<li>
<p><a href="#CHDCGGID">Ensuring that Query Rewrite Takes Effect</a></p>
</li>
<li>
<p><a href="#CIHDIEDI">Example of Query Rewrite</a></p>
</li>
</ul>
<a id="i1006201"></a><a id="DWHSG0181"></a>
<div class="sect1">
<h2 class="sect1">Overview of Query Rewrite</h2>
<p>When base tables contain large amount of data, it is expensive and time-consuming to compute the required aggregates or to compute joins between these tables. In such cases, queries can take minutes or even hours. Because materialized views contain already precomputed aggregates and joins, Oracle Database employs an extremely powerful process called query rewrite to quickly answer the query using materialized views.</p>
<p>One of the major benefits of creating and maintaining materialized views is the ability to take advantage of query rewrite, which transforms a SQL statement expressed in terms of tables or views into a statement accessing one or more materialized views that are defined on the detail tables. The transformation is transparent to the end user or application, requiring no intervention and no reference to the materialized view in the SQL statement. Because query rewrite is transparent, materialized views can be added or dropped just like indexes without invalidating the SQL in the application code.</p>
<p>A query undergoes several checks to determine whether it is a candidate for query rewrite. If the query fails any of the checks, then the query is applied to the detail tables rather than the materialized view. This can be costly in terms of response time and processing power.</p>
<p>The <a id="sthref843"></a>optimizer uses two different methods to recognize when to rewrite a query in terms of a materialized view. The first method is based on matching the SQL text of the query with the SQL text of the materialized view definition. If the first method fails, the optimizer uses the more general method in which it compares joins, selections, data columns, grouping columns, and aggregate functions between the query and materialized views.</p>
<p>Query rewrite operates on queries and subqueries in the following types of SQL statements:</p>
<ul>
<li>
<p><code>SELECT</code></p>
</li>
<li>
<p><code>CREATE</code> <code>TABLE</code> &hellip; <code>AS</code> <code>SELECT</code></p>
</li>
<li>
<p><code>INSERT</code> <code>INTO</code> &hellip; <code>SELECT</code></p>
</li>
</ul>
<p>It also operates on subqueries in the set operators <code>UNION</code>, <code>UNION</code> <code>ALL</code>, <code>INTERSECT</code>, and <code>MINUS</code>, and subqueries in DML statements such as <code>INSERT</code>, <code>DELETE</code>, and <code>UPDATE</code>.</p>
<p>Dimensions, constraints, and rewrite integrity levels affect whether or not a given query is rewritten to use one or more materialized views. Additionally, query rewrite can be enabled or disabled by <code>REWRITE</code> and <code>NOREWRITE</code> hints and the <code>QUERY_REWRITE_ENABLED</code> session parameter.</p>
<p>The <code>DBMS_MVIEW.EXPLAIN_REWRITE</code> procedure advises whether query rewrite is possible on a query and, if so, which materialized views are used. It also explains why a query cannot be rewritten.</p>
<a id="i1006240"></a><a id="DWHSG8494"></a>
<div class="sect2">
<h3 class="sect2">When Does Oracle Rewrite a Query?</h3>
<p><a id="sthref844"></a>A query is rewritten only when a certain number of conditions are met:</p>
<ul>
<li>
<p>Query rewrite must be enabled for the session.</p>
</li>
<li>
<p>A materialized view must be enabled for query rewrite.</p>
</li>
<li>
<p>The rewrite integrity level should allow the use of the materialized view. For example, if a materialized view is not fresh and query rewrite integrity is set to <code>ENFORCED</code>, then the materialized view is not used.</p>
</li>
<li>
<p>Either all or part of the results requested by the query must be obtainable from the precomputed result stored in the materialized view or views.</p>
</li>
</ul>
<p>To test these conditions, the optimizer may depend on some of the data relationships declared by the user using constraints and dimensions, among others, hierarchies, referential integrity, and uniqueness of key data, and so on.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDCGGID"></a><a id="DWHSG0182"></a>
<div class="sect1">
<h2 class="sect1">Ensuring that Query Rewrite Takes Effect</h2>
<p><a id="sthref845"></a>You must follow several conditions to enable query rewrite:</p>
<ol>
<li>
<p>Individual materialized views must have the <code>ENABLE</code> <code>QUERY</code> <code>REWRITE</code> clause.</p>
</li>
<li>
<p>The session parameter <code>QUERY_REWRITE_ENABLED</code> must be set to <code>TRUE</code> (the default) or <code>FORCE</code>.</p>
</li>
<li>
<p>Cost-based optimization must be used by setting the initialization parameter <code>OPTIMIZER_MODE</code> to <code>ALL_ROWS</code>, <code>FIRST_ROWS</code>, or <code>FIRST_ROWS_</code><code><span class="codeinlineitalic">n</span></code>.</p>
</li>
</ol>
<p>If step 1 has not been completed, a materialized view is never eligible for query rewrite. You can specify <code>ENABLE</code> <code>QUERY</code> <code>REWRITE</code> either with the <code>ALTER</code> <code>MATERIALIZED</code> <code>VIEW</code> statement or when the materialized view is created, as illustrated in the following:</p>
<pre>
CREATE MATERIALIZED VIEW join_sales_time_product_mv
ENABLE QUERY REWRITE AS
SELECT p.prod_id, p.prod_name, t.time_id, t.week_ending_day,
       s.channel_id, s.promo_id, s.cust_id, s.amount_sold
FROM   sales s, products p, times t
WHERE  s.time_id=t.time_id  AND s.prod_id = p.prod_id;
</pre>
<p><a id="sthref846"></a><a id="sthref847"></a><a id="sthref848"></a><a id="sthref849"></a><a id="sthref850"></a><a id="sthref851"></a><a id="sthref852"></a><a id="sthref853"></a><a id="sthref854"></a><a id="sthref855"></a><a id="sthref856"></a><a id="sthref857"></a><a id="sthref858"></a>The <code>NOREWRITE</code> hint disables query rewrite in a SQL statement, overriding the <code>QUERY_REWRITE_ENABLED</code> parameter, and the <code>REWRITE</code> hint (when used with <code>mv_name</code>) restricts the eligible materialized views to those named in the hint.</p>
<p>You can use the <code>DBMS_ADVISOR.TUNE_MVIEW</code> procedure to optimize a <code>CREATE</code> <code>MATERIALIZED</code> <code>VIEW</code> statement to enable general <code>QUERY</code> <code>REWRITE</code>.</p>
<a id="DWHSG01821"></a>
<div class="sect2"><a id="sthref859"></a>
<h3 class="sect2">Initialization Parameters for Query Rewrite</h3>
<p><a id="sthref860"></a><a id="sthref861"></a><a id="sthref862"></a>The following three initialization parameter settings control query rewrite behavior:</p>
<ul>
<li>
<p><code><a id="sthref863"></a><a id="sthref864"></a>OPTIMIZER_MODE</code> = <code>ALL_ROWS</code> (default), <code>FIRST_ROWS</code>, or <code>FIRST_ROWS_</code><code><span class="codeinlineitalic">n</span></code></p>
<p>With <code>OPTIMIZER_MODE</code> set to <code>FIRST_ROWS</code>, the optimizer uses a mix of costs and heuristics to find a best plan for fast delivery of the first few rows. When set to <code>FIRST_ROWS_</code><code><span class="codeinlineitalic">n</span></code>, the optimizer uses a cost-based approach and optimizes with a goal of best response time to return the first <code><span class="codeinlineitalic">n</span></code> rows (where n = 1, 10, 100, 1000).</p>
</li>
<li>
<p><code><a id="sthref865"></a><a id="sthref866"></a>QUERY_REWRITE_ENABLED</code> = <code>TRUE</code> (default), <code>FALSE</code>, or <code>FORCE</code></p>
<p>This option enables the query rewrite feature of the optimizer, enabling the optimizer to utilize materialized views to enhance performance. If set to <code>FALSE</code>, this option disables the query rewrite feature of the optimizer and directs the optimizer not to rewrite queries using materialized views even when the estimated query cost of the unrewritten query is lower.</p>
<p>If set to <code>FORCE</code>, this option enables the query rewrite feature of the optimizer and directs the optimizer to rewrite queries using materialized views even when the estimated query cost of the unrewritten query is lower.</p>
</li>
<li>
<p><code>Q<a id="sthref867"></a><a id="sthref868"></a>UERY_REWRITE_INTEGRITY</code></p>
<p>This parameter is optional, but must be set to <code>STALE_TOLERATED</code>, <code>TRUSTED</code>, or <code>ENFORCED</code> (the default) if it is specified (see <a href="#i1017301">"Accuracy of Query Rewrite"</a>).</p>
<p>By default, the integrity level is set to <code>ENFORCED</code>. In this mode, all constraints must be validated. Therefore, if you use <code>ENABLE</code> <code>NOVALIDATE</code> <code>RELY</code>, certain types of query rewrite might not work. To enable query rewrite in this environment (where constraints have not been validated), you should set the integrity level to a lower level of granularity such as <code>TRUSTED</code> or <code>STALE_TOLERATED</code>.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="DWHSG8495"></a>
<div class="sect2"><a id="sthref869"></a>
<h3 class="sect2">Controlling Query Rewrite</h3>
<p><a id="sthref870"></a>A materialized view is only eligible for query rewrite if the <code>ENABLE</code> <code>QUERY</code> <code>REWRITE</code> clause has been specified, either initially when the materialized view was first created or subsequently with an <code>ALTER</code> <code>MATERIALIZED</code> <code>VIEW</code> statement.</p>
<p>You can set the session parameters described previously for all sessions using the <code>ALTER</code> <code>SYSTEM</code> <code>SET</code> statement or in the initialization file. For a given user's session, <code>ALTER</code> <code>SESSION</code> can be used to disable or enable query rewrite for that session only. An example is the following:</p>
<pre>
ALTER SESSION SET QUERY_REWRITE_ENABLED = TRUE;
</pre>
<p>You can set the level of query rewrite for a session, thus allowing different users to work at different integrity levels. The possible statements are:</p>
<pre>
ALTER SESSION SET QUERY_REWRITE_INTEGRITY = STALE_TOLERATED;
ALTER SESSION SET QUERY_REWRITE_INTEGRITY = TRUSTED;
ALTER SESSION SET QUERY_REWRITE_INTEGRITY = ENFORCED;
</pre></div>
<!-- class="sect2" -->
<a id="i1017301"></a><a id="DWHSG8496"></a>
<div class="sect2">
<h3 class="sect2">Accuracy of Query Rewrite</h3>
<p><a id="sthref871"></a>Query rewrite offers three levels of rewrite integrity that are controlled by the session parameter <code>QUERY_REWRITE_INTEGRITY</code>, which can either be set in your parameter file or controlled using an <code>ALTER</code> <code>SYSTEM</code> or <code>ALTER</code> <code>SESSION</code> statement. The three values are as follows:</p>
<ul>
<li>
<p><code>ENFORCED<a id="sthref872"></a></code></p>
<p>This is the default mode. The optimizer only uses fresh data from the materialized views and only use those relationships that are based on <code>ENABLED</code> <code>VALIDATED</code> primary, unique, or foreign key constraints.</p>
</li>
<li>
<p><code><a id="sthref873"></a>TRUSTED</code></p>
<p>In <code>TRUSTED</code> mode, the optimizer trusts that the relationships declared in dimensions and <code>RELY</code> constraints are correct. In this mode, the optimizer also uses prebuilt materialized views or materialized views based on views, and it uses relationships that are not enforced as well as those that are enforced. It also trusts declared but not <code>ENABLED</code> <code>VALIDATED</code> primary or unique key constraints and data relationships specified using dimensions. This mode offers greater query rewrite capabilities but also creates the risk of incorrect results if any of the trusted relationships you have declared are incorrect.</p>
</li>
<li>
<p><code><a id="sthref874"></a>STALE_TOLERATED</code></p>
<p>In <code>STALE_TOLERATED</code> mode, the optimizer uses materialized views that are valid but contain stale data as well as those that contain fresh data. This mode offers the maximum rewrite capability but creates the risk of generating inaccurate results.</p>
</li>
</ul>
<p>If rewrite integrity is set to the safest level, <code>ENFORCED</code>, the optimizer uses only enforced primary key constraints and referential integrity constraints to ensure that the results of the query are the same as the results when accessing the detail tables directly. If the rewrite integrity is set to levels other than <code>ENFORCED</code>, there are several situations where the output with rewrite can be different from that without it:</p>
<ul>
<li>
<p>A materialized view can be out of synchronization with the master copy of the data. This generally happens because the materialized view refresh procedure is pending following bulk load or DML operations to one or more detail tables of a materialized view. At some data warehouse sites, this situation is desirable because it is not uncommon for some materialized views to be refreshed at certain time intervals.</p>
</li>
<li>
<p>The relationships implied by the dimension objects are invalid. For example, values at a certain level in a hierarchy do not roll up to exactly one parent value.</p>
</li>
<li>
<p>The values stored in a prebuilt materialized view table might be incorrect.</p>
</li>
<li>
<p>A wrong answer can occur because of bad data relationships defined by unenforced table or view constraints.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="DWHSG01813"></a>
<div class="sect2"><a id="sthref875"></a>
<h3 class="sect2">Privileges for Enabling Query Rewrite</h3>
<p>Use of a materialized view is based not on privileges the user has on that materialized view, but on the privileges the user has on detail tables or views in the query.</p>
<p><span class="italic"><a id="sthref876"></a><a id="sthref877"></a><a id="sthref878"></a><a id="sthref879"></a></span>The system privilege <code>GRANT</code> <code>QUERY</code> <code>REWRITE</code> lets you enable materialized views in your own schema for query rewrite only if all tables directly referenced by the materialized view are in that schema. The <code>GRANT</code> <code>GLOBAL</code> <code>QUERY</code> <code>REWRITE</code> privilege enables you to enable materialized views for query rewrite even if the materialized view references objects in other schemas. Alternatively, you can use the <code>QUERY</code> <code>REWRITE</code> object privilege on tables and views outside your schema.</p>
<p>The privileges for using materialized views for query rewrite are similar to those for definer's rights procedures.</p>
</div>
<!-- class="sect2" -->
<a id="DWHSG8497"></a>
<div class="sect2"><a id="sthref880"></a>
<h3 class="sect2">Sample Schema and Materialized Views</h3>
<p>The following sections use the <code>sh</code> sample schema and a few materialized views to illustrate how the optimizer uses data relationships to rewrite queries.</p>
<p>The query rewrite examples in this chapter mainly refer to the following materialized views. These materialized views do not necessarily represent the most efficient implementation for the <code>sh</code> schema. Instead, they are a base for demonstrating rewrite capabilities. Further examples demonstrating specific functionality can be found throughout this chapter.</p>
<p>The following materialized views contain joins and aggregates:</p>
<pre>
CREATE MATERIALIZED VIEW sum_sales_pscat_week_mv
ENABLE QUERY REWRITE AS
SELECT p.prod_subcategory, t.week_ending_day,
       SUM(s.amount_sold) AS sum_amount_sold
FROM   sales s, products p, times t
WHERE  s.time_id=t.time_id  AND s.prod_id=p.prod_id
GROUP BY p.prod_subcategory, t.week_ending_day;

CREATE MATERIALIZED VIEW sum_sales_prod_week_mv
ENABLE QUERY REWRITE AS
SELECT p.prod_id, t.week_ending_day, s.cust_id,
       SUM(s.amount_sold) AS sum_amount_sold
FROM   sales s, products p, times t
WHERE  s.time_id=t.time_id AND s.prod_id=p.prod_id
GROUP BY p.prod_id, t.week_ending_day, s.cust_id;

CREATE MATERIALIZED VIEW sum_sales_pscat_month_city_mv
ENABLE QUERY REWRITE AS
SELECT p.prod_subcategory, t.calendar_month_desc, c.cust_city,
       SUM(s.amount_sold) AS sum_amount_sold,
       COUNT(s.amount_sold) AS count_amount_sold
FROM   sales s, products p, times t, customers c
WHERE  s.time_id=t.time_id AND s.prod_id=p.prod_id AND s.cust_id=c.cust_id 
GROUP BY p.prod_subcategory, t.calendar_month_desc, c.cust_city;
</pre>
<p>The following materialized views contain joins only:</p>
<pre>
CREATE MATERIALIZED VIEW join_sales_time_product_mv
ENABLE QUERY REWRITE AS
SELECT p.prod_id, p.prod_name, t.time_id, t.week_ending_day,
       s.channel_id, s.promo_id, s.cust_id, s.amount_sold
FROM   sales s, products p, times t
WHERE  s.time_id=t.time_id AND s.prod_id = p.prod_id;

CREATE MATERIALIZED VIEW join_sales_time_product_oj_mv
ENABLE QUERY REWRITE AS
SELECT p.prod_id, p.prod_name, t.time_id, t.week_ending_day,
       s.channel_id, s.promo_id, s.cust_id, s.amount_sold
FROM   sales s, products p, times t
WHERE  s.time_id=t.time_id AND s.prod_id=p.prod_id(+);
</pre>
<p>Although it is not a strict requirement, it is highly recommended that you collect statistics on the materialized views so that the optimizer can determine whether to rewrite the queries. You can do this either on a per-object base or for all newly created objects without statistics. The following is an example of a per-object base, shown for <code>join_sales_time_product_mv</code>:</p>
<pre>
EXECUTE DBMS_STATS.GATHER_TABLE_STATS ( -
   'SH','JOIN_SALES_TIME_PRODUCT_MV', estimate_percent   =&gt; 20, -
    block_sample   =&gt; TRUE, cascade   =&gt; TRUE);
</pre>
<p>The following illustrates a statistics collection for all newly created objects without statistics:</p>
<pre>
EXECUTE DBMS_STATS.GATHER_SCHEMA_STATS ( 'SH', -
   options            =&gt; 'GATHER EMPTY', -
   estimate_percent   =&gt;  20, block_sample  =&gt;  TRUE, -
   cascade            =&gt;  TRUE);
</pre></div>
<!-- class="sect2" -->
<a id="DWHSG8498"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref881"></a>
<h3 class="sect2">How to Verify Query Rewrite Occurred</h3>
<p>Because query rewrite occurs transparently, special steps have to be taken to verify that a query has been rewritten. Of course, if the query runs faster, this should indicate that rewrite has occurred, but that is not proof. Therefore, to confirm that query rewrite does occur, use the <code>EXPLAIN</code> <code>PLAN</code> statement or the <code>DBMS_MVIEW.EXPLAIN_REWRITE</code> procedure. See <a href="qradv.htm#i1007733">"Verifying that Query Rewrite has Occurred"</a> for further information.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CIHDIEDI"></a><a id="DWHSG0184"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Example of Query Rewrite</h2>
<p>Consider the following materialized view, <code>cal_month_sales_mv</code>, which provides an aggregation of the dollar amount sold in every month:</p>
<pre>
CREATE MATERIALIZED VIEW cal_month_sales_mv
ENABLE QUERY REWRITE AS
SELECT t.calendar_month_desc, SUM(s.amount_sold) AS dollars
FROM sales s, times t WHERE s.time_id = t.time_id
GROUP BY t.calendar_month_desc;
</pre>
<p>Let us say that, in a typical month, the number of sales in the store is around one million. So this materialized aggregate view has the precomputed aggregates for the dollar amount sold for each month. Now consider the following query, which asks for the sum of the amount sold at the store for each calendar month:</p>
<pre>
SELECT t.calendar_month_desc, SUM(s.amount_sold)
FROM sales s, times t WHERE s.time_id = t.time_id
GROUP BY t.calendar_month_desc;
</pre>
<p>In the absence of the previous materialized view and query rewrite feature, Oracle will have to access the <code>sales</code> table directly and compute the sum of the amount sold to return the results. This involves reading many million rows from the <code>sales</code> table which will invariably increase the query response time due to the disk access. The join in the query will also further slow down the query response as the join needs to be computed on many million rows. In the presence of the materialized view <code>cal_month_sales_mv</code>, query rewrite will transparently rewrite the previous query into the following query:</p>
<pre>
SELECT calendar_month, dollars
FROM cal_month_sales_mv;
</pre>
<p>Because there are only a few dozens rows in the materialized view <code>cal_month_sales_mv</code> and no joins, Oracle Database returns the results instantly. This simple example illustrates the power of query rewrite with materialized views!</p>
</div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1371">
<tr>
<td class="cellalignment1378">
<table class="cellalignment1376">
<tr>
<td class="cellalignment1375"><a href="part5.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1375"><a href="qradv.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2001, 2013,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1380">
<table class="cellalignment1374">
<tr>
<td class="cellalignment1375"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1375"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1375"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1375"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1375"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1375"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
