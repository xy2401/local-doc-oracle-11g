<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Switchover and Failover Operations</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1071" />
<meta name="dcterms.created" content="2015-11-24T12:57:37Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Data Guard Broker" />
<meta name="dcterms.identifier" content="E40771-07" />
<meta name="dcterms.isVersionOf" content="DGBKR" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="dbresource.htm" title="Previous" type="text/html" />
<link rel="Next" href="cli.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e40771.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">12/20</span> <!-- End Header -->
<script  >
<!-- // <![CDATA[
window.name='sofo'
// ]]> -->
</script> <script  >
// <![CDATA[
function footdisplay(footnum,footnote) {
    var msg = window.open('', 'NewWindow' + footnum,
        'directories=no,height=120,location=no,menubar=no,resizable=yes,' +
        'scrollbars=yes,status=no,toolbar=no,width=598');
    msg.document.open('text/html');
    msg.document.write('<!DOCTYPE html ');
    msg.document.write('PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" ');

    msg.document.write('"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">');
    msg.document.write('<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>');
    msg.document.write('Footnote&nbsp; ' + footnum);
    msg.document.write('<\/title><meta http-equiv="Content-Type" ');
    msg.document.write('content="text/html; charset=utf-8" />');
    msg.document.write('');
    msg.document.write('<style> <![CDATA[ ');
    msg.document.write('h1 {text-align: center; font-size: 14pt;}');
    msg.document.write('fieldset {border: none;}');
    msg.document.write('form {text-align: center;}');
    msg.document.write(' ]]\u003e <\/style>');
    msg.document.write('<\/head><body><h1>Footnote&nbsp; ' + footnum + '<\/h1><p>');
    msg.document.write(footnote);
    msg.document.write('<\/p><form action="" method="post"><fieldset>');
    msg.document.write('<input type="button" value="OK" ');
    msg.document.write('onclick="window.close();" />');
    msg.document.write('<\/fieldset><\/form><\/body><\/html>');
    msg.document.close();
    msg.focus();
}
// ]]>
</script> <noscript>
<p>The script content on this page is for navigation purposes only and does not alter the content in any way.</p>
</noscript>
<div id="DGBKR330" class="chapter"><a id="i1005572"></a>
<h1 class="chapter"><span class="secnum">5</span> Switchover and Failover Operations</h1>
<p>This chapter describes how the broker m<a id="sthref428"></a><a id="sthref429"></a><a id="sthref430"></a><a id="sthref431"></a>anages databases during switchover and failover. It contains the following topics:</p>
<ul>
<li>
<p><a href="#BCGIAFFJ">Overview of Switchover and Failover in a Broker Environment</a></p>
</li>
<li>
<p><a href="#BCGIEFCF">Choosing a Target Standby Database</a></p>
</li>
<li>
<p><a href="#BCGFBHJI">Switchover</a></p>
</li>
<li>
<p><a href="#BCGBFFIH">Manual Failover</a></p>
</li>
<li>
<p><a href="#i1027843">Fast-Start Failover</a></p>
</li>
<li>
<p><a href="#CHDBHJIB">Database Client Considerations</a></p>
</li>
</ul>
<a id="BCGIAFFJ"></a>
<div id="DGBKR3401" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">5.1</span> Overview of Switchover and Failover in a Broker Environment</h2>
<p>An Oracle database operates in one of two roles: primary or standby. Data Guard helps you change the role of a database using either a switchover or a failover:</p>
<ul>
<li>
<p>A <span class="bold">s<a id="sthref432"></a>witchover</span> is a role reversal between the primary database and one of its standby databases. A switchover guarantees no data loss and is typically done for planned maintenance of the primary system. During a switchover, the primary database transitions to a standby role, and the standby database transitions to the primary role.</p>
</li>
<li>
<p>A <span class="bold">f<a id="sthref433"></a>ailover</span> is done when the primary database (all instances of an Oracle RAC primary database) fails or has become unreachable and one of the standby databases is transitioned to take over the primary role. Failover may or may not result in data loss depending on the protection mode in effect at the time of the failover.</p>
</li>
</ul>
<p>Without the broker, you perform role transitions by issuing a series of SQL statements (as described in <a class="olink SBYDB" href="../e41134/toc.htm"><span class="italic">Oracle Data Guard Concepts and Administration</span></a>). The broker simplifies switchovers and failovers by allowing you to invoke them using a single key click in Oracle Enterprise Manager or a single command in the DGMGRL command-line interface (referred to in this documentation as <a id="sthref434"></a><span class="italic">manual</span> failover). Moreover, you can enable fast-start failover to fail over automatically when the conditions for fast-start failover are met. When <a id="sthref435"></a>fast-start failover is enabled, the broker determines if a failover is necessary and initiates the failover to the specified target standby database automatically, with no need for DBA intervention.</p>
<p>Fast-start failover allows you to increase availability with less need for manual intervention, thereby reducing management costs. Manual failover gives you control over exactly when a failover occurs and to which target standby database. Regardless of the method you choose, the broker coordinates the role transition on all databases in the configuration.</p>
</div>
<!-- class="sect1" -->
<a id="BCGIEFCF"></a>
<div id="DGBKR3310" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">5.2</span> Choosing a Target Standby Database</h2>
<p>There are many factors to take into consideration when <a id="sthref436"></a><a id="sthref437"></a><a id="sthref438"></a><a id="sthref439"></a>selecting a standby database to be the next primary database after a switchover or a failover. You need to consider all of the options at the time you are building your Data Guard configuration, including factors such as the characteristics of physical standbys versus logical standbys versus snapshot standbys, the network latency to your standby database sites, the computing capabilities at a future primary database site, and so on.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
A snapshot standby cannot be the target of a switchover or fast-start failover operation. You can, however, perform a manual failover to a snapshot standby.</div>
<p>For switchovers, understanding all of the factors can simplify the choice of which standby database to consider as your new primary database. In disaster situations where a failover is necessary, you may be more limited in which standby database is the best one to pick up the failed primary database's activities. The following sections provide guidelines to help you choose a target standby database.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
For fast-start failover, you must pre-select the target standby database that will be used. <a href="#i1027843">Section 5.5</a> provides more information about fast-start failover.</div>
<div id="DGBKR3402" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref440"></a>
<h3 class="sect2"><span class="secnum">5.2.1</span> Choosing a Target Standby Database for Switchover</h3>
<p>When performing a switchover in a configuration whose standby databases are all of the same type (all physical or all logical standby databases), choose the standby database that has the least amount of unapplied redo. By choosing the standby database with the least amount of unapplied redo, you can minimize the overall time it takes to complete the switchover operation. For example:</p>
<ul>
<li>
<p>Using DGMGRL, you can do this by examining the Apply Lag row of the <code >SHOW DATABASE</code> output for each standby database in the configuration.</p>
</li>
<li>
<p>Using Enterprise Manager, you can view the value of the <code dir="ltr">ApplyLag</code> column for each standby database in the <code dir="ltr">Standby</code> <code dir="ltr">Databases</code> section of the Data Guard Overview Page.</p>
</li>
</ul>
<p>If the configuration contains both physical and logical standby databases, consider choosing a physical standby database (that has the least amount of unapplied redo) to be the target standby database. A switchover to a physical standby database is preferable because all databases in the configuration will be available as standby databases to the new primary database after the switchover operation completes. Whereas a switchover to a logical standby database will invalidate and disable all of the physical and snapshot standby databases in the configuration. You will then need to re-create the physical standby databases from a copy of the new primary database before you can reenable them.</p>
<p>You cannot perform a switchover to a snapshot standby database unless you first convert it back to a physical standby database.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If the Data Guard configuration is operating in maximum protection mode, the broker does not allow a switchover to occur to a logical standby database. The configuration must be operating in either maximum availability mode or maximum performance mode in order to be able to switch over to a logical standby database.</div>
</div>
<!-- class="sect2" -->
<div id="DGBKR3403" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref441"></a>
<h3 class="sect2"><span class="secnum">5.2.2</span> Choosing a Target Standby Database for Failover</h3>
<p>When performing a failover in a configuration whose standbys are all of the same type, choose the standby database that has the smallest transport lag. Doing so can minimize the amount of data loss and in some cases, incur no data loss at all.</p>
<p>If the configuration contains physical, snapshot, and logical standby databases, consider choosing a physical standby database as the target standby database. A failover to a physical standby database is preferable because it is likely that all standby databases in the configuration will still be available as standby databases to the new primary database after the failover operation completes.</p>
<p>You may failover to a snapshot standby database. However failing over to a snapshot standby database will require more time because the broker must first convert it back to a physical standby database. After the conversion, the broker will start Redo Apply to apply accumulated redo data, before failing the database over to the primary role. Because the broker performs the failover after converting the snapshot standby database to a physical standby database, it is likely that all standby databases in the configuration will still be available as standby databases to the new primary database after the failover operation completes.</p>
<p>A failover to a logical standby database requires that all physical and snapshot standby databases be re-created from a copy of the new primary database after the failover completes. In addition, a logical standby database may contain only a subset of the data present in the primary database. (For example, if the <code dir="ltr">DBMS_LOGSTDBY.SKIP</code> procedure was used to specify which database operations done on the primary database will not be applied to the logical standby database.)</p>
<p>However, there may be exceptions to the recommendation to choose a physical standby database as the target standby database. For example, if all your physical standbys are also unavailable, then failing over to a logical standby is your only choice.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BCGFBHJI"></a>
<div id="DGBKR335" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">5.3</span> S<a id="sthref442"></a>witchover</h2>
<p>Y<a id="sthref443"></a><a id="sthref444"></a><a id="sthref445"></a><a id="sthref446"></a>ou can switch a database from the primary role to the standby role, as well as from standby to primary. This is known as a database switchover, because the standby database that you specify becomes the primary database, and the original primary database becomes a standby database, with no loss of data.</p>
<p>Whenever possible, you should switch over to a physical standby database:</p>
<ul>
<li>
<p>If the <a id="sthref447"></a><a id="sthref448"></a>switchover transitions a physical standby database to the primary role, then:</p>
<ul>
<li>
<p>The original primary database will be switched to a physical standby role.</p>
</li>
<li>
<p>The online redo log files will be continuously archived from the new primary database to all standby databases in the configuration.</p>
</li>
<li>
<p>The original primary database will be restarted as a part of the switchover operation. Note that the new primary database does not need to be restarted.</p>
<p>Standby databases not involved in the switchover (known as bystander standby databases)<a id="sthref449"></a> continue operating in the state they were in before the switchover occurred and will automatically begin applying redo data received from the new primary database.</p>
</li>
</ul>
</li>
<li>
<p>If the <a id="sthref450"></a><a id="sthref451"></a>switchover transitions a logical standby database to the primary role, then:</p>
<ul>
<li>
<p>The original primary database will be switched to a logical standby role.</p>
</li>
<li>
<p>Neither the primary database nor the logical standby database needs to be restarted after the switchover completes.</p>
<p>Other logical standby bystander databases in the broker configuration will remain viable after the switchover. There is no need to restart any databases. All physical and snapshot standby databases will be disabled and must be re-created from a copy of the new primary database after a switchover to a logical standby database.</p>
</li>
</ul>
<p>Switchover to a logical standby database is disallowed when the configuration is operating in maximum protection mode.</p>
<div class="infoboxnotewarn">
<p class="notep1">WARNING:</p>
<p class="warnsp">Switching over to a logical standby database results in the snapshot and physical standby databases in the broker configuration being disabled by the broker, making these databases no longer viable as standby databases. <a href="#CHDEHEEF">Section 5.4.3</a> describes how to restore their viability as standby databases.</p>
<p class="warnsp">If you intend to switch back to the original primary database relatively soon, you may allow the physical and snapshot standbys to remain disabled. Once you have completed the switchover back to the original primary, you may then reenable the physical and snapshot standby databases since they are still viable standbys for the original primary database.</p>
</div>
</li>
</ul>
<a id="i1013063"></a>
<div id="DGBKR340" class="sect2">
<h3 class="sect2"><span class="secnum">5.3.1</span> B<a id="sthref452"></a><a id="sthref453"></a><a id="sthref454"></a>efore You Perform a Switchover Operation</h3>
<p>Consider the following points before you begin a switchover:</p>
<ul>
<li>
<p>When you start a switchover, the broker verifies that at least one standby database, including the primary database that is about to be transitioned to the standby role, is configured to support the overall protection mode (maximum protection, maximum availability, or maximum performance) after the switchover is completed.</p>
</li>
<li>
<p><a id="sthref455"></a><a id="sthref456"></a>Prepare the primary database in advance for its possible future role as a standby database in the context of the overall protection mode (see <a href="dbresource.htm#i1026456">Section 4.6</a>). Such preparation includes:</p>
<ul>
<li>
<p>Ensuring that standby redo log files are configured on the primary database.</p>
</li>
<li>
<p>Presetting database properties related to redo transport services, such as <code dir="ltr">LogXptMode</code>, <code dir="ltr">NetTimeout</code>, <code dir="ltr">StandbyArchiveLocation</code>, and <code dir="ltr">AlternateLocation</code>. For more details about managing redo transport services using database properties, see <a href="dbresource.htm#i1025959">Section 4.4</a>.</p>
</li>
<li>
<p>Presetting database properties related to Redo Apply services, such as <code dir="ltr">DelayMins</code>. For more details about managing Redo Apply services using properties, see <a href="dbresource.htm#i1024829">Section 4.5</a>.</p>
</li>
<li>
<p>For each temporary table, verifying that temporary files associated with that table on the primary database also exist on the standby database.</p>
</li>
</ul>
<p>Note that the broker does not use the properties to set up redo transport services and Redo Apply services until you actually switch over the primary database to the standby role. Thus, the validity of the values of these properties is not verified until after the switchover. Once you set these properties, their values persist through role changes during switchover and failover.</p>
</li>
<li>
<p>Before performing a switchover to a physical standby database that is in real-time query mode, consider bringing all instances of that standby database to the mounted but not open state to achieve the fastest possible role transition and to cleanly terminate any user sessions connected to the physical standby database prior to the role transition.</p>
</li>
<li>
<p>If fast-start failover is enabled in either maximum availability or maximum performance mode, a switchover can be performed only to the pre-specified target standby database and only if the standby database is synchronized with the primary database. For information about enabling fast-start failover, see <a href="#CHDDFFEC">Section 5.5.2</a>.</p>
</li>
</ul>
<p>After a switchover completes, the broker preserves the overall Data Guard protection mode as part of the switchover process by keeping the protection mode at the same protection level (maximum protection, maximum availability, or maximum performance) it was at before the switchover. Also, the network transmission mode (<code dir="ltr">SYNC</code> or <code dir="ltr">ASYNC</code>) for transporting redo to other bystander standby databases does not change after a switchover. Apply services on all other bystander standby databases automatically begin applying redo data received from the new primary database.</p>
<p>If there are physical or snapshot standby databases in the configuration and the switchover occurs to a logical standby database, you need to re-create those databases from a copy of the new primary database and then reenable those databases, as described in <a href="#CHDEHEEF">Section 5.4.3</a>.</p>
</div>
<!-- class="sect2" -->
<div id="DGBKR3404" class="sect2"><a id="sthref457"></a>
<h3 class="sect2"><span class="secnum">5.3.2</span> S<a id="sthref458"></a><a id="sthref459"></a>tarting a Switchover</h3>
<p>The act of switching roles should be a well-planned activity. The primary and standby databases involved in the switchover should have as small a redo lag as possible. <a class="olink SBYDB00600" href="../../server.112/e41134/role_management.htm#SBYDB00600"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> provides information about setting up the databases in preparation of a switchover.</p>
<p>To start a switchover using Enterprise Manager, select the standby database that you want to change to the primary role and click <span class="bold">Switchover</span>. When using DGMGRL, you need to issue only one <code dir="ltr">SWITCHOVER</code> command to specify the name of the standby database that you want to change into the primary role.</p>
<p>The broker controls the rest of the switchover, as described in <a href="#i1010398">Section 5.3.3</a>.</p>
</div>
<!-- class="sect2" -->
<a id="i1010398"></a>
<div id="DGBKR350" class="sect2">
<h3 class="sect2"><span class="secnum">5.3.3</span> Ho<a id="sthref460"></a>w the Broker Performs a Switchover</h3>
<p>Once you start the switchover, the broker:</p>
<ol>
<li>
<p>Verifies that the primary and the target standby databases are in the following states:</p>
<ol>
<li>
<p>The primary database is enabled and is in the <code dir="ltr">TRANSPORT-ON</code> state.</p>
</li>
<li>
<p>The target standby database is enabled and is in the <code dir="ltr">APPLY-ON</code> state.</p>
</li>
</ol>
<p>The broker allows the switchover to proceed as long as there are no errors for the primary database and the standby database that you selected to participate in the switchover operation. Errors occurring for any other bystander standby databases will not impede the switchover.</p>
</li>
<li>
<p>Shuts down all instances except one, if required.</p>
<p>If you are switching over to a physical standby database, the broker shuts down all but one instance on the current primary database. No instances will be shut down on the target physical standby database.</p>
<p>No instances will be shut down if switching over to a logical standby database. You cannot switch over to a snapshot standby database.</p>
</li>
<li>
<p>Switches roles between the p<a id="sthref461"></a><a id="sthref462"></a>rimary and standby databases.</p>
<p>The broker first converts the original primary database to run in the standby role. Then, the broker transitions the target standby database to the primary role. If any errors occur during either conversion, the broker stops the switchover. See <a href="troubleshooting.htm#i1009813">Section 9.3, "Troubleshooting Problems During a Switchover Operation"</a> for more information.</p>
</li>
<li>
<p>Updates the broker configuration file to record the change in roles.</p>
<p>Because the configuration file profiles all database objects in the configuration, this ensures that each database will run in the correct role and state should it be restarted later for any reason.</p>
</li>
<li>
<p>Restarts the new standby (former primary) database if the switchover occurs to a physical standby database, and Redo Apply begins applying redo data from the new primary database. If this is an Oracle RAC physical standby database, the broker directs Oracle Clusterware to restart the instances that were shut down prior to the switchover. In a configuration operating in maximum protection mode, the new primary database will also be restarted.</p>
</li>
<li>
<p>The new primary database is opened in read/write mode and redo transport services are started.</p>
<p>If the former physical standby database was running with real-time query enabled, the new physical standby database will run with real-time query enabled.</p>
</li>
</ol>
<p>The broker verifies the state and status of the databases to ensure that the switchover transitioned the databases to their new role correctly. Bystander s<a id="sthref463"></a><a id="sthref464"></a>tandby databases that are not disabled by the broker after the switchover will continue operating in the state they were in before the switchover. <a id="sthref465"></a><a id="sthref466"></a>Redo Apply and <a id="sthref467"></a>SQL Apply on all other bystander standby databases automatically begin applying redo data received from the new primary database.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BCGBFFIH"></a>
<div id="DGBKR360" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">5.4</span> Manual F<a id="sthref468"></a><a id="sthref469"></a><a id="sthref470"></a><a id="sthref471"></a><a id="sthref472"></a>ailover</h2>
<p>You can convert a standby database to a primary database when the original primary database fails and there is no possibility of recovering the primary database in a timely manner. This is known as a <span class="glossaryterm">manual failover</span>. There may or may not be data loss depending upon whether your primary and target standby databases were synchronized at the time of the primary database failure. The word <span class="italic">manual</span> is used to contrast this type of failover with a fast-start failover (described in <a href="#i1027843">Section 5.5</a>).</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can perform a manual failover even if fast-start failover is enabled. See <a href="#BCGBEFHB">Section 5.5.2.4</a> for more information.</div>
<p>The following sections describe how to perform manual failovers:</p>
<ul>
<li>
<p><a href="#CHDDIEAC">Section 5.4.1, "Complete and Immediate Manual Failovers"</a></p>
</li>
<li>
<p><a href="#CHDHAHJB">Section 5.4.2, "Performing a Manual Failover Operation"</a></p>
</li>
<li>
<p><a href="#CHDEHEEF">Section 5.4.3, "Reenabling Disabled Databases After a Role Change"</a></p>
</li>
</ul>
<a id="CHDDIEAC"></a>
<div id="DGBKR3405" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.4.1</span> Complete and Immediate Manual Failovers</h3>
<p>Using Enterprise Manager or DGMGRL, you can perform either a <span class="italic">complete</span> (recommended) or an <span class="italic">immediate</span> failover:</p>
<ul>
<li>
<p>A <a id="sthref473"></a><a id="sthref474"></a><a id="sthref475"></a><span class="italic">complete</span> failover is the recommended and default failover option. It automatically recovers the maximum amount of redo data for the protection mode the configuration is operating in. A complete failover also attempts to avoid disabling any standby databases that were not the target of the failover, so that they may continue serving as standby databases to the new primary database.</p>
<p>Whether or not standby databases that were not the target of failover (bystander standby databases) are disabled depends upon how much redo data they have applied relative to the failover target and the standby type of the failover target:</p>
<ul>
<li>
<p>If the failover target is a physical or snapshot standby database, the original primary database must be reinstated or re-created in order to be a standby database for the new primary database. In addition, some standby databases may be disabled by the broker during the failover if the broker detects that they have applied redo beyond where the new primary database had applied. Any standby database that was disabled by the broker must be reinstated or re-created, as described in <a href="#CHDEHEEF">Section 5.4.3</a>, before it can be a standby database for the new primary database.</p>
<p>Note that if failover was performed on a snapshot standby database, the old primary must be either reinstated or re-created as a physical standby database.</p>
</li>
<li>
<p>If the failover target is a logical standby database, the original primary database and all physical and snapshot standby databases in the configuration will be disabled. The primary database can be reinstated if it had flashback database enabled. The physical and snapshot standby databases will have to be re-created from a copy of the new primary database. See <a href="#CHDEHEEF">Section 5.4.3</a> for more information.</p>
</li>
</ul>
<p>If the primary database can be mounted, it may be possible to flush any unsent redo data from the primary database to the target standby database using the <code dir="ltr">ALTER SYSTEM FLUSH REDO</code> SQL statement. If this operation is successful, a zero data loss failover may be possible even if the primary database is not in a zero data loss protection mode. See <a class="olink SBYDB00625" href="../../server.112/e41134/role_management.htm#SBYDB00625"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for more information on using the <code dir="ltr">ALTER SYSTEM FLUSH REDO</code> statement.</p>
<p>During a complete failover, the broker performs the failover steps described in <a href="#BCGFEHHF">Section 5.4.2.1</a>.</p>
</li>
<li>
<p>An <span class="italic"><a id="sthref476"></a><a id="sthref477"></a><a id="sthref478"></a>immediate</span> failover is the fastest type of failover. However, no additional data is applied on the standby database once you invoke the failover. Another consequence of immediate failover is that all other databases in the configuration are disabled and must be reinstated or re-created before they can serve as standby databases for the new primary database. <a href="#CHDEHEEF">Section 5.4.3</a> describes how to do this. During an immediate failover, the broker performs the failover steps described in <a href="#BCGJGEFC">Section 5.4.2.2</a>.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
Always try to perform a complete failover first unless redo apply has stopped at the failover target due to an <code dir="ltr">ORA-752</code> or <code dir="ltr">ORA-600</code> <code dir="ltr">[3020]</code> error. If one of these errors has occurred, follow the guidelines in "Resolving ORA-752 or ORA-600 [3020] During Standby Recovery" in My Oracle Support Note 1265884.1 before proceeding. This support note is available at <code dir="ltr"><a href="http://support.oracle.com">http://support.oracle.com</a></code>.
<p>An immediate failover should only be performed when a complete failover is unsuccessful or in the case just noted above. A complete failover can occur without any data loss, depending on the destination attributes of redo transport services, but an immediate failover usually results in some data loss.</p>
</div>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CHDHAHJB"></a>
<div id="DGBKR370" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.4.2</span> <a id="sthref479"></a><a id="sthref480"></a><a id="sthref481"></a>Performing a Manual Failover Operation</h3>
<p>After determining that there is no possibility of recovering the primary database in a timely manner, ensure that the primary database is shut down and then begin the failover operation.</p>
<p>The steps in this section describe how to perform a manual failover. Depending on the failover and the types of standby databases involved, some of the databases may need to be reinstated or re-created. The instructions guide you through the appropriate steps for each type of situation.</p>
<dl>
<dd><a id="DGBKR3654"></a><a id="sthref482"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Determine which of the available standby databases is the best target for the failover.</dt>
<dd>
<p>Follow the guidelines described in <a href="#BCGIEFCF">Section 5.2, "Choosing a Target Standby Database"</a>.</p>
</dd>
<dd><a id="DGBKR3655"></a><a id="sthref483"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Start the failover.</dt>
<dd>
<p>Using Enterprise Manager or DGMGRL, perform either a <span class="italic">complete</span> (recommended) or an <span class="italic">immediate</span> failover.</p>
<p><span class="bold">Manual Failover Using Enterprise Manager:</span></p>
<p>On the Data Guard Overview Page in Enterprise Manager, select the standby database that you want to change to the primary role and click <span class="bold">Failover</span>. Then, on the Failover Confirmation Page, click <span class="bold">Yes</span> to invoke the default Complete failover option.</p>
<p><span class="bold">Manual Failover Using DGMGRL:</span></p>
<p>On the target standby database, issue the <code dir="ltr">FAILOVER</code> command to perform a failover, specifying the name of the standby database that you want to become the primary database:</p>
<pre dir="ltr">
DGMGRL&gt; FAILOVER TO <span class="italic">database-name</span>;
</pre>
<p>Specify the optional <code dir="ltr">IMMEDIATE</code> clause to perform an immediate failover if any of the the following conditions are true:</p>
<ul>
<li>
<p>An <code dir="ltr">ORA-752</code> error has occurred at the standby database</p>
</li>
<li>
<p>An <code dir="ltr">ORA-600</code> <code dir="ltr">[3020]</code> error has occurred at the standby database and Oracle support has determined that it was caused by a lost write at the primary database</p>
</li>
<li>
<p>A complete failover is not possible</p>
</li>
</ul>
<pre dir="ltr">
DGMGRL&gt; FAILOVER TO database-name IMMEDIATE;
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="dgmgrl.htm#i92589">FAILOVER</a></p>
</li>
</ul>
</div>
<p>If the target is a snapshot standby database, the broker first converts the database to a physical standby database. If performing a complete failover, all accumulated redo data will be applied before changing the role of the database to primary. If performing an immediate failover, the role of the database will be changed to primary without applying any accumulated redo data.</p>
<p>No instances will be shut down if failing over to a physical or logical standby database.</p>
</dd>
<dd><a id="DGBKR3656"></a><a id="sthref484"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Reset the protection mode.</dt>
<dd>
<p>After a <a id="sthref485"></a><a id="sthref486"></a>manual failover (complete or immediate), the overall Data Guard protection mode is handled as follows:</p>
<ul>
<li>
<p>If the protection mode was at maximum protection, it is reset to maximum performance. You can upgrade the protection mode later, if necessary, as described in <a href="dbresource.htm#i1026470">Section 4.6.1</a>.</p>
</li>
<li>
<p>If the protection mode was at maximum availability or maximum performance, it remains unchanged.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you perform a manual failover when fast-start failover is enabled:
<ul>
<li>
<p>The failover can only be performed to the pre-selected target standby database.</p>
</li>
<li>
<p>The broker preserves the protection mode that was in effect prior to the failover.</p>
</li>
</ul>
</div>
</dd>
<dd><a id="DGBKR3657"></a><a id="sthref487"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Re-establish a disaster-recovery configuration.</dt>
<dd>
<p>To maintain a viable disaster-recovery solution in the event of another disaster, you may need to perform the additional steps described in <a href="#CHDEHEEF">Section 5.4.3</a> to:</p>
<ul>
<li>
<p>Reinstate the original primary database to act as a standby database in the new configuration.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
Do not attempt to reinstate the old primary database if an <code dir="ltr">ORA-752</code> or <code dir="ltr">ORA-600</code> <code dir="ltr">[3020]</code> error has occurred at the failover target, because doing so may lead to data loss. Instead, the old primary database must be re-created as a standby from a backup of the new primary using the procedure described in <a href="#CHDIEECD">Section 5.4.3.2</a>.</div>
</li>
<li>
<p>Reinstate or re-create standby databases in the configuration that were disabled by the broker.</p>
<p>After a complete failover finishes, any bystander standby database that is not viable as a standby for the new primary database will be disabled by the broker. This can happen for either of the following reasons:</p>
<ul>
<li>
<p>A bystander standby database has applied more redo data than the new primary database itself had applied when it was a standby database. The standby database must be re-created or reinstated before it can serve as a standby for the new primary database.</p>
</li>
<li>
<p>The failover was to a logical standby database. The broker disables all of the physical and snapshot standby databases in the configuration. They must be re-created before they can serve as standby to the new primary database.</p>
</li>
</ul>
</li>
</ul>
</dd>
</dl>
<a id="BCGFEHHF"></a>
<div id="DGBKR375" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.4.2.1</span> <a id="sthref488"></a><a id="sthref489"></a>How the Broker Performs a Complete Failover Operation</h4>
<p>Once you start a complete failover, the broker:</p>
<ol>
<li>
<p>Verifies that the target standby database is enabled. If the database is not enabled, you will not be able to perform a failover to this database.</p>
</li>
<li>
<p>Waits for the target standby database to finish applying any unapplied redo data before stopping Redo Apply (if the target is a physical standby database) or SQL Apply (if the target is a logical standby database).</p>
<p>If the target is a snapshot standby database, the broker first converts the database back to a physical standby and then starts Redo Apply to apply all the accumulated redo before completing the failover and opening the database as a primary database.</p>
</li>
<li>
<p>Transitions the target standby database into the primary database role, as follows:</p>
<ol>
<li>
<p>Changes the role of the database from standby to primary.</p>
</li>
<li>
<p>Opens the new primary database in read/write mode.</p>
</li>
<li>
<p>Determines whether or not any standby databases that did not participate in the failover operation have applied redo data beyond the new primary database, and thus need to be disabled.</p>
<p>If a bystander standby database is not disabled by the broker during this failover, it will remain in the state it was in before the failover. For example, if a physical standby database was in the <code dir="ltr">APPLY-OFF</code> state, it will remain in the <code dir="ltr">APPLY-OFF</code> state.</p>
<p>By default, the broker always determines whether bystander standby databases will be viable standby databases for the new primary when performing a complete failover. If you want the broker to skip this viability check of bystander standby databases during a complete failover, thus decreasing the overall failover time, set the <code dir="ltr">BystandersFollowRoleChange</code> configuration property to <code dir="ltr">NONE</code>.</p>
<p>When this property is set to <code dir="ltr">NONE</code>, the broker will disable all bystander standby databases without checking whether they have applied more redo data than the new primary database. You will have to reinstate or re-create (see <a href="#CHDEHEEF">Section 5.4.3</a>) the standby databases after failover has completed. The <code dir="ltr">SHOW CONFIGURATION</code> command will show you which databases can be reinstated and which databases must be re-created. Use the <code dir="ltr">SHOW CONFIGURATION BystandersFollowRoleChange</code> command to see the value of this property. The default value is <code dir="ltr">ALL</code>.</p>
<p>This property also affects whether the broker skips viability checks of bystander standby databases when a fast-start failover occurs.</p>
</li>
<li>
<p>Starts redo transport services to begin transmitting redo data to all bystander standby databases that were not disabled.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Bystander standby databases<a id="sthref490"></a> may be disabled by the broker during the failover, and they must be reinstated or re-created before they can serve as standby databases to the new primary database. Oracle recommends configuring <a id="sthref491"></a><a id="sthref492"></a><a id="sthref493"></a>Flashback Database on every database so that if failover occurs to a physical standby database, you can more easily reinstate any disabled standby databases. If failover occurs to a logical standby database, all physical and snapshot standby databases will be disabled by the broker. In this case, Flashback Database cannot be used to reinstate databases. They must be re-created from a copy of the new primary database. Logical standby databases that are disabled during failover can be reinstated.</div>
</li>
</ol>
</li>
<li>
<p>If the failover target database is an Oracle RAC physical or snapshot standby database, the broker directs Oracle Clusterware to restart all instances that may have been shut down prior to the failover.</p>
</li>
</ol>
<p>The broker allows the failover to proceed as long as there are no errors for the standby database that you selected to participate in the failover. Errors occurring for any bystander standby databases will not stop the failover. If you initiated a complete failover and it fails, you might need to use immediate failover.</p>
</div>
<!-- class="sect3" -->
<a id="BCGJGEFC"></a>
<div id="DGBKR380" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.4.2.2</span> <a id="sthref494"></a>How the Broker Performs an Immediate Failover Operation</h4>
<p>Once you start an immediate failover, the broker:</p>
<ol>
<li>
<p>Verifies that the target standby database is enabled. If the standby database is not enabled for management by the broker, then the failover cannot occur.</p>
</li>
<li>
<p>Stops Redo Apply or SQL Apply on the standby database immediately, without waiting until all available redo data has been applied. This may result in data loss.</p>
</li>
<li>
<p>Transitions the target standby database into the primary role, opens the new primary database in read/write mode, and starts redo transport services.</p>
<p>After an immediate failover completes, all the standby databases in the configuration, regardless of their type, are disabled. They may be reinstated if Flashback Database is enabled on those databases. Otherwise, they must be re-created from a copy of the new primary database.</p>
</li>
</ol>
<p>The broker allows a complete failover to proceed as long as there are no errors present on the standby database that you selected to participate in the failover.</p>
<p>The broker allows an immediate failover to proceed even if there are errors present on the standby database that you selected to participate in the failover.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDEHEEF"></a>
<div id="DGBKR385" class="sect2"><!-- infolevel="all" infotype="General" --><a id="i1010215"></a>
<h3 class="sect2"><span class="secnum">5.4.3</span> Reenabling Disabled D<a id="sthref495"></a><a id="sthref496"></a>atabases After a Role Change</h3>
<p>To restore your original disaster-recovery solution after switchover to a logical standby database or after failover to any standby database, you may need to perform additional steps.</p>
<p>Databases that have been disabled after a role transition are not <span class="italic">removed</span> from the broker configuration, but they are no longer managed by the broker.</p>
<p>To reenable broker management of these databases, you must reinstate or re-create the databases using one of the following procedures:</p>
<ul>
<li>
<p>If a database can be reinstated, the database will show the following status:</p>
<pre dir="ltr">
ORA-16661<a id="sthref497"></a><a id="sthref498"></a><a id="sthref499"></a><a id="sthref500"></a>: the standby database needs to be reinstated
</pre>
<p>Reinstate the database using the DGMGRL <code dir="ltr">REINSTATE DATABASE</code> command or the reinstate option in Enterprise Manager, as described in <a href="#CHDCIBIG">Section 5.4.3.1, "How to Reinstate a Database"</a>.<a id="sthref501"></a><a id="sthref502"></a><a id="sthref503"></a> The broker automatically reenables the database as part of reinstating it.</p>
</li>
<li>
<p>If a database must be re-created from a copy of the new primary database, it will have the following status:</p>
<pre dir="ltr">
ORA-16795<a id="sthref504"></a><a id="sthref505"></a><a id="sthref506"></a>: the standby database needs to be re-created
</pre>
<p>Re-create the standby database from a copy of the primary database and then reenable it. The procedures for creating a standby database are documented in <a class="olink SBYDB00200" href="../../server.112/e41134/create_ps.htm#SBYDB00200"><span class="italic">Oracle Data Guard Concepts and Administration</span></a>. See <a href="#CHDIEECD">Section 5.4.3.2, "How to Re-create and Reenable a Disabled Database"</a> for more information.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Any database that was disabled while multiple role changes were performed cannot be reinstated. You must re-create the database manually from a copy of the current primary database and then reenable the database in the broker configuration.</div>
<p>Whether you reinstate or re-create a database depends on if you performed a switchover or failover and on the type of standby database that was the target of the operation. Note that role changes to logical and snapshot standby databases will always result in physical standby database bystanders being disabled. They cannot be reinstated. They must be re-created from a copy of the new primary database.</p>
<p>The following sections describe how to reinstate or reenable a database.</p>
<a id="CHDCIBIG"></a>
<div id="DGBKR3406" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.4.3.1</span> H<a id="sthref507"></a>ow to Reinstate a Database</h4>
<p>You can use the broker's reinstate capability to make the failed primary database a viable standby database for the new primary. This can be done regardless of whether the failover was done to a physical, logical, or snapshot standby database.</p>
<p>You can also reinstate bystander standby databases that were disabled during a failover operation.</p>
<p>Databases that can be reinstated will have the following status value:</p>
<pre dir="ltr">
<a id="sthref508"></a><a id="sthref509"></a>ORA-16661: the standby database needs to be reinstated
</pre>
<p>For the <code dir="ltr">REINSTATE</code> command to succeed, <a id="sthref510"></a><a id="sthref511"></a>Flashback Database must have been enabled on the database prior to the failover and there must be sufficient <a id="sthref512"></a><a id="sthref513"></a><a id="sthref514"></a>flashback logs on that database. In addition, the database to be reinstated and the new primary database must have network connectivity.</p>
<p>To reinstate a database:</p>
<ol>
<li>
<p>Restart the database to the mounted state</p>
</li>
<li>
<p>Connect to the new primary database</p>
</li>
<li>
<p>Use Enterprise Manager or DGMGRL to reinstate the database</p>
</li>
</ol>
<p>The broker reinstates a failed primary database as a standby database of the same type (physical or logical standby database) as the old standby database. The only exception to this is failovers to snapshot standby databases. In such cases, the failed primary database is reinstated as a physical standby database.</p>
<p>The broker reinstates bystander standby databases that were disabled during a failover as standby databases to the new primary database.</p>
<p><span class="bold">Reinstatement Using Enterprise Manager</span><a id="sthref515"></a></p>
<p>On the Data Guard Overview page, click the <code dir="ltr">Database must be reinstated</code> link. This brings up the General Properties page that provides a Reinstate button. After you click the Reinstate button, Enterprise Manager begins reinstating the database.</p>
<p>When the process is complete, the database will be enabled as a standby database to the new primary database, and Enterprise Manager displays the Data Guard Overview page.</p>
<p><span class="bold">Reinstatement Using DGMGRL<a id="sthref516"></a><a id="sthref517"></a></span></p>
<p>Issue the following command while connected to any database in the broker configuration, except the database that is to be reinstated:</p>
<pre dir="ltr">
DGMGRL&gt; REINSTATE DATABASE <span class="italic">db_unique_name</span>;
</pre>
<p>The newly reinstated standby database will begin serving as a standby database to the new primary database. If reinstatement of a database fails, its status changes to <code dir="ltr">ORA-16795: the standby database needs to be re-created</code>. You must then re-create it from a copy of the new primary database and reenable it as described in <a href="#CHDIEECD">Section 5.4.3.2</a>.</p>
</div>
<!-- class="sect3" -->
<a id="CHDIEECD"></a>
<div id="DGBKR3407" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.4.3.2</span> How to Re-create and Reenable a Disabled Database</h4>
<p>If you performed a failover or switchover that requires you to re-create the failed primary database or standby databases that were disabled during the role transition, follow the procedures in the <a class="olink SBYDB" href="../e41134/toc.htm"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> chapters, "Creating a Physical Standby Database" and "Creating a Logical Standby Database."</p>
<p>Note that if you are re-creating the old primary database, it must be created as the standby type of the old standby database. For example, if the old standby was a physical or snapshot standby, then the old primary must be re-created as a physical standby.</p>
<p>After the database has been re-created, enable broker management of the re-created standby database by using the DGMGRL <code dir="ltr">ENABLE DATABASE</code> command.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1027843"></a>
<div id="DGBKR390" class="sect1">
<h2 class="sect1"><span class="secnum">5.5</span> Fast-Start F<a id="sthref518"></a><a id="sthref519"></a><a id="sthref520"></a><a id="sthref521"></a><a id="sthref522"></a>ailover</h2>
<p><a id="sthref523"></a><span class="bold">Fast-start failover</span> allows the broker to automatically fail over to a previously chosen standby database in the event of loss of the primary database. Fast-start failover quickly and reliably fails over the target standby database to the primary database role, without requiring you to perform any manual steps to invoke the failover. Fast-start failover can be used only in a broker configuration and can be configured only through DGMGRL or Enterprise Manager.</p>
<p>Either maximum availability mode or maximum performance mode can be used with fast-start failover. Maximum availability mode provides an automatic failover environment guaranteed to lose no data. Maximum performance mode provides an automatic failover environment guaranteed to lose no more than the amount of data (in seconds) specified by the <code dir="ltr">FastStartFailoverLagLimit</code> configuration property. This property indicates the maximum amount of data loss that is permissible in order for an automatic failover to occur. It is only used when fast-start failover is enabled and the configuration is operating in maximum performance mode.</p>
<p>Once fast-start failover is enabled, the broker will ensure that fast-start failover is only possible when the configured data loss guarantee can be upheld. If the configured data loss guarantee cannot be upheld, redo generation on the primary database will be stalled. To avoid a prolonged stall, either the observer or target standby database may allow the primary database to continue redo generation after first recording that a fast-start failover cannot happen.</p>
<p>The broker will restore the ability to automatically failover once the configured data loss guarantee is restored. For a configuration that is operating in maximum availability mode, this occurs once the target standby database has received all missing redo data. For a configuration that is operating in maximum performance mode, this occurs once the target standby database's redo applied point is no longer lagging the primary database's redo generation point by the value specified by the <code dir="ltr">FastStartFailoverLagLimit</code> configuration property.</p>
<p>This section describes how to enable fast-start failover and an <span class="glossaryterm"><a id="sthref524"></a><a id="sthref525"></a>observer</span> site that monitors the fast-start failover environment. The observer is a separate OCI client-side component that runs on a different computer from the primary and standby databases and monitors the availability of the primary database. The observer is described in more detail in <a href="#BCGHBJJI">Section 5.5.7</a>.</p>
<p>Once the observer is started, no further user interaction is required. If both the observer and designated standby database lose connectivity with the primary database for longer than the number of seconds specified by the <code dir="ltr">FastStartFailoverThreshold</code> configuration property, the observer will initiate a fast-start failover to the standby database. In addition, the primary database will shut down if it perceives a loss of connectivity for a period longer than <code dir="ltr">FastStartFailoverThreshold</code> seconds, if the <code dir="ltr">FastStartFailoverPmyShutdown</code> configuration property is set to <code dir="ltr">TRUE</code>. After the failover completes, the former primary database is automatically reinstated as a standby database when a connection to it is reestablished, if the <code dir="ltr">FastStartFailoverAutoReinstate</code> configuration property is set to <code dir="ltr">TRUE</code>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
When a fast-start failover occurs because either a user configurable fast-start failover condition is detected or an application initiates a fast-start failover by calling the <code dir="ltr">DBMS_DG.INITIATE_FS_FAILOVER</code> function, the former primary database is always shut down and never automatically reinstated. This is true regardless of the settings for the <code dir="ltr">FastStartFailoverPmyShutdown</code> and <code dir="ltr">FastStartFailoverAutoReinstate</code> configuration properties. See <a href="#CHDDFFEC">Section 5.5.2</a> for more information.</div>
<p><a href="#BCGIAIIF">Figure 5-1</a> shows the relationships between the primary database, target standby database, and the observer during fast-start failover:</p>
<ul>
<li>
<p><span class="bold">Before Fast-Start Failover:</span> Data Guard is operating in a steady state, with the primary database transmitting redo data to the target standby database and the observer monitoring the state of the entire configuration.</p>
</li>
<li>
<p><span class="bold">FastStart Failover Ensues:</span> Disaster strikes the primary database and its network connections to both the observer and the target standby database are lost. Upon detecting the break in communication, the observer attempts to reestablish a connection with the primary database for the amount of time defined by the <code dir="ltr">FastStartFailoverThreshold</code> property before initiating a fast-start failover. If the observer is unable to regain a connection to the primary database within the specified time, and the target standby database is ready for fast-start failover, then fast-start failover ensues.</p>
</li>
<li>
<p><span class="bold">After Fast-Start Failover:</span> The fast-start failover has completed and the target standby database is running in the primary database role. After the former primary database has been repaired, the observer reestablishes its connection to that database and reinstates it as a new standby database. The new primary database starts transmitting redo data to the new standby database.</p>
</li>
</ul>
<div id="DGBKR3541" class="figure">
<p class="titleinfigure"><a id="BCGIAIIF"></a>Figure 5-1 Relationship of Primary and Standby Databases and the Observer</p>
<img width="660" height="396" src="img/dgbkr004.gif" alt="Description of Figure 5-1 follows" /><br />
<a id="sthref526" href="img_text/dgbkr004.htm">Description of ''Figure 5-1 Relationship of Primary and Standby Databases and the Observer''</a><br />
<br /></div>
<!-- class="figure" -->
<p>The following sections describe these topics:</p>
<ul>
<li>
<p><a href="#BCGFFFBG">Prerequisites for Enabling Fast-Start Failover</a></p>
</li>
<li>
<p><a href="#CHDDFFEC">Enabling Fast-Start Failover</a></p>
</li>
<li>
<p><a href="#BCGJCEBI">Viewing Fast-Start Failover Configuration Statistics and Status</a></p>
</li>
<li>
<p><a href="#BCGJEGAF">Disabling Fast-Start Failover</a></p>
</li>
<li>
<p><a href="#BCGHEAHA">Performance Considerations for Fast-Start Failover</a></p>
</li>
<li>
<p><a href="#BCGHBJJI">Managing the Observer</a></p>
</li>
<li>
<p><a href="#CHDIBEBC">Reinstating the Former Primary Database in the Broker Configuration</a></p>
</li>
<li>
<p><a href="#CHDJCDDB">Shutting Down Databases In a Fast-Start Failover Environment</a></p>
</li>
</ul>
<a id="BCGFFFBG"></a>
<div id="DGBKR391" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.5.1</span> Prerequisites for Enabling Fast-Start Failover</h3>
<p>The following p<a id="sthref527"></a><a id="sthref528"></a><a id="sthref529"></a>rerequisites must be met before the broker allows you to enable fast-start failover:</p>
<ul>
<li>
<p>Ensure the broker configuration is operating in either m<a id="sthref530"></a><a id="sthref531"></a>aximum availability mode or maximum performance mode.</p>
<p>See <a href="dbresource.htm#i1026470">Section 4.6.1</a> for information about configuring the protection mode, standby redo logs, and the <code dir="ltr">LogXptMode</code> property.</p>
</li>
<li>
<p>Ensure that the standby database you choose to be the target of fast-start failover has its <code dir="ltr">LogXptMode</code> property set to <code dir="ltr">SYNC</code> if you wish to enable fast-start failover in maximum availability mode, or to <code dir="ltr">ASYNC</code> if you wish to enable fast-start failover in maximum performance mode. The current primary database must have its <code dir="ltr">LogXptMode</code> property set accordingly and must have standby redo logs configured.</p>
</li>
<li>
<p>Enable Flashback Database and set up a fast recovery area on both the primary database and the target standby database.</p>
<p>See <a class="olink BRADV" href="../../backup.112/e10642/toc.htm"><span class="italic">Oracle Database Backup and Recovery User's Guide</span></a>.</p>
</li>
<li>
<p>Install the DGMGRL command-line interface on the observer computer as described in <a href="install.htm#BABFFICD">Section 2.1</a>.</p>
</li>
<li>
<p>Configure the <code dir="ltr">TNSNAMES.ORA</code> file on the observer system so that the observer is able to connect to the primary database and the pre-selected target standby database.</p>
</li>
<li>
<p>Create static service names so that the observer can automatically restart a database as part of reinstatement. See <a href="install.htm#BABECEJC">Section 2.2, "Prerequisites"</a> for more information.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CHDDFFEC"></a>
<div id="DGBKR392" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.5.2</span> Enabling Fast-Start Failover</h3>
<p>You can enable fast-start failover from any site while connected to any database in the broker configuration. Enabling fast-start failover does not trigger a failover. Instead, it allows the observer that is monitoring the configuration to initiate a fast-start failover should conditions warrant a failover.</p>
<p>Perform the following steps to enable fast-start failover and start the observer. The steps assume that you are connected as <code dir="ltr">SYS</code> and that a primary and standby database are already set up in a broker configuration.</p>
<dl>
<dd><a id="DGBKR3658"></a><a id="sthref532"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Determine which of the available standby databases is the best target for the failover.</dt>
<dd>
<p>Follow the guidelines described in <a href="#BCGIEFCF">Section 5.2, "Choosing a Target Standby Database"</a>.</p>
</dd>
<dd><a id="DGBKR3659"></a><a id="BCGCHJJG"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Specify the target standby database with the F<a id="sthref533"></a><a id="sthref534"></a><a id="sthref535"></a>astStartFailoverTarget configuration property.<a id="sthref536"></a><a id="sthref537"></a></dt>
<dd>
<p>You can specify only one target standby database when setting the <code dir="ltr">FastStartFailoverTarget</code> configuration property on the current primary database:</p>
<ul>
<li>
<p>If there is only one standby database in the configuration, you can skip this step and continue with Step 3. When enabling fast-start failover, the broker automatically sets the <code dir="ltr">FastStartFailoverTarget</code> property on the primary and standby databases to point to each other as their respective target during a failover.</p>
</li>
<li>
<p>If there is more than one standby database in the configuration, you must explicitly set the <code dir="ltr">FastStartFailoverTarget</code> property on the primary database to select a target standby database. When enabling fast-start failover, the broker verifies that the property indicates an existing standby, and then reciprocally sets the standby database's <code dir="ltr">FastStartFailoverTarget</code> property to the primary database.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
To change the <code dir="ltr">FastStartFailoverTarget</code> property to point to a different standby database, disable fast-start failover, set the <code dir="ltr">FastStartFailoverTarget</code> property, and reenable fast-start failover.</div>
</li>
</ul>
<p>See <a href="dbpropref.htm#BABECDBC">Section 8.3.10, "FastStartFailoverTarget"</a> for more information about this property.</p>
</dd>
<dd><a id="DGBKR3660"></a><a id="sthref538"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Determine the protection mode you want</dt>
<dd>
<p>Fast-start failover can be enabled for either maximum availability mode or maximum performance mode. If you cannot tolerate any loss of data, then ensure that the configuration protection mode is set to maximum availability. To do this, the <code dir="ltr">LogXptMode</code> database property for both the primary and target standby database must be set to <code dir="ltr">SYNC</code>. Then set the configuration protection mode to maximum availability. For example:</p>
<pre dir="ltr">
DGMGRL&gt; EDIT DATABASE 'North_Sales' SET PROPERTY LogXptMode=SYNC;
DGMGRL&gt; EDIT DATABASE 'South_Sales' SET PROPERTY LogXptMode=SYNC;
DGMGRL&gt; EDIT CONFIGURATION SET PROTECTION MODE AS MaxAvailability;
</pre>
<p>If you are more concerned about the performance of the primary database than a minimal loss of data, consider enabling fast-start failover when the configuration protection mode is set to maximum performance. In this mode you will need to consider how much data loss is acceptable in terms of seconds and set the <code dir="ltr">FastStartFailoverLagLimit</code> configuration property accordingly. This property specifies the amount of data, in seconds, that the target standby database can lag behind the primary database in terms of redo applied. If the standby database's redo applied point is within that many seconds of the primary database's redo generation point, a fast-start failover will be allowed. The <code dir="ltr">FastStartFailoverLagLimit</code> configuration property is only used by the broker when enabling fast-start failover for configurations operating in maximum performance mode. The default value is 30 seconds and the lowest possible value is 10 seconds.</p>
<p>In addition to setting the configuration protection mode to maximum performance, you will also need to ensure that the <code dir="ltr">LogXptMode</code> database property for both the primary and target standby database is set to <code dir="ltr">ASYNC</code>. For example:</p>
<pre dir="ltr">
DGMGRL&gt; EDIT DATABASE 'North_Sales' SET PROPERTY LogXptMode=ASYNC;
DGMGRL&gt; EDIT DATABASE 'South_Sales' SET PROPERTY LogXptMode=ASYNC;
DGMGRL&gt; EDIT CONFIGURATION SET PROTECTION MODE AS MaxPerformance;
DGMGRL&gt; EDIT CONFIGURATION SET PROPERTY FastStartFailoverLagLimit=45;
</pre></dd>
<dd><a id="DGBKR3661"></a><a id="BCGBFBBD"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Set the FastStartFailoverThreshold configuration property.</dt>
<dd>
<p>Fast-start failover will occur if both the observer and the target standby database lose connection to the primary database for the period of time specified by the <code dir="ltr">FastStartFailoverThreshold</code> configuration property.</p>
<p>Set the <a id="sthref539"></a><a id="sthref540"></a><a id="sthref541"></a><code dir="ltr">FastStartFailoverThreshold</code> property to specify the number of seconds you want the observer and target standby database to wait (after detecting the primary database is unavailable) before initiating a failover. For example:</p>
<pre dir="ltr">
DGMGRL&gt; EDIT CONFIGURATION SET PROPERTY FastStartFailoverThreshold = 45;
</pre>
<p>The default value for the <code dir="ltr">FastStartFailoverThreshold</code> property is 30 seconds and the lowest possible value is 6 seconds. If you have an Oracle RAC primary database, consider specifying a higher value to minimize the possibility of a false failover in the event of an instance failure.</p>
<p>The time interval starts when the observer first loses its connection to the primary database. If the observer is unable to regain a connection to the primary database within the specified time, then the observer begins a fast-start failover provided the standby database is ready to fail over. Although the default value of 30 seconds is typically adequate for detecting outages and failures on most configurations, you can adjust failover sensitivity with this property to decrease the probability of false failovers in a temporarily unstable environment.</p>
<p>If the <code dir="ltr">FastStartFailoverPmyShutdown</code> configuration property is set to <code dir="ltr">TRUE</code>, the primary database will shut down after <code dir="ltr">FastStartFailoverThreshold</code> seconds has elapsed if redo generation has been stalled and the primary database is unable to reestablish connectivity with either the observer or target standby database.</p>
<p>Note that the <code dir="ltr">FastStartFailoverThreshold</code> property can be changed even when fast-start failover is enabled.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="dbpropref.htm#BABEHDDC">Section 8.1.8</a> for reference information about the <code dir="ltr">FastStartFailoverThreshold</code> property</div>
</dd>
<dd><a id="DGBKR3662"></a><a id="sthref542"></a></dd>
<dt class="seghead">Step 5&nbsp;&nbsp;&nbsp;Set other database properties (optional).</dt>
<dd>
<p>You can optionally set the database properties described in the following table:</p>
<div class="inftblinformal">
<table class="cellalignment1489" title="Properties for Fast-Start Failover" summary="Properties that can be optionally set to tune fast-start failover." dir="ltr">
<thead>
<tr class="cellalignment1478">
<th class="cellalignment1490" id="r1c1-t16">Property Name</th>
<th class="cellalignment1490" id="r1c2-t16">Description</th>
<th class="cellalignment1490" id="r1c3-t16">Default Value</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r2c1-t16" headers="r1c1-t16"><code dir="ltr">FastStartFailoverPmyShutdown</code></td>
<td class="cellalignment1484" headers="r2c1-t16 r1c2-t16">This configuration property causes the primary database to shut down if fast-start failover is enabled and <code dir="ltr">V$DATABASE.FS_FAILOVER_STATUS</code> indicates the primary has been <code dir="ltr">STALLED</code> for longer than <code dir="ltr">FastStartFailoverThreshold</code> seconds. A value of <code dir="ltr">TRUE</code> helps to ensure that an isolated primary database cannot satisfy user queries.
<p>This property cannot be used to prevent the primary database from shutting down if a fast-start failover occurred because a user configuration condition was detected or was requested by an application by calling the <code dir="ltr">DBMS_DG.INITIATE_FS_FAILOVER</code> function.</p>
</td>
<td class="cellalignment1484" headers="r2c1-t16 r1c3-t16"><code dir="ltr">TRUE</code></td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r3c1-t16" headers="r1c1-t16"><code dir="ltr">FastStartFailoverLagLimit</code></td>
<td class="cellalignment1484" headers="r3c1-t16 r1c2-t16">This configuration property establishes an acceptable limit, in seconds, that the standby is allowed to fall behind the primary in terms of redo applied, beyond which a fast-start failover will not be allowed. The lowest possible value is 10 seconds.
<p>This property is used when fast-start failover is enabled and the configuration is operating in maximum performance mode.</p>
</td>
<td class="cellalignment1484" headers="r3c1-t16 r1c3-t16">30 seconds</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r4c1-t16" headers="r1c1-t16"><code dir="ltr">FastStartFailoverAutoReinstate</code></td>
<td class="cellalignment1484" headers="r4c1-t16 r1c2-t16">This configuration property causes the former primary database to be automatically reinstated if a fast-start failover was initiated because the primary database was either isolated or had crashed. To prevent automatic reinstatement of the former primary database in these cases, set this configuration property to <code dir="ltr">FALSE</code>. The broker never automatically reinstates the former primary database if a fast-start failover was initiated because a user configuration condition was detected or was requested by an application calling the <code dir="ltr">DBMS_DG.INITIATE_FS_FAILOVER</code> function.</td>
<td class="cellalignment1484" headers="r4c1-t16 r1c3-t16"><code dir="ltr">TRUE</code></td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r5c1-t16" headers="r1c1-t16"><code dir="ltr">ObserverConnectIdentifier</code></td>
<td class="cellalignment1484" headers="r5c1-t16 r1c2-t16">This database property is used to specify how the observer should connect to and monitor the primary and standby database. Set this property for the primary and target standby database if you want the observer to use a different connect identifier than that used to ship redo data (that is, the connect identifier specified by the <code dir="ltr">DGConnectIdentifier</code> property).</td>
<td class="cellalignment1484" headers="r5c1-t16 r1c3-t16">Observer uses the value of the <code dir="ltr">DGConnectIdentifier</code> property to connect to and monitor the primary and target standby databases.</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" --></dd>
<dd><a id="DGBKR3663"></a><a id="sthref543"></a></dd>
<dt class="seghead">Step 6&nbsp;&nbsp;&nbsp;Enable additional fast-start failover conditions (optional)</dt>
<dd>
<p>By default, a fast-start failover is done when both the observer and the standby cannot reach the primary after the configured time threshold (<code dir="ltr">FastStartFailoverThreshold</code>) has passed.</p>
<p>You can optionally indicate the database health conditions that should cause fast-start failover to occur. These conditions are described in the following table:</p>
<div class="inftblinformal">
<table class="cellalignment1489" title="Health Conditions for FSFO" summary="Description of health conditions for FSFO" dir="ltr">
<thead>
<tr class="cellalignment1478">
<th class="cellalignment1490" id="r1c1-t17">Health Condition</th>
<th class="cellalignment1490" id="r1c2-t17">Description</th>
<th class="cellalignment1490" id="r1c3-t17">Enabled by Default</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r2c1-t17" headers="r1c1-t17">Datafile Offline</td>
<td class="cellalignment1484" headers="r2c1-t17 r1c2-t17">A datafile is offline because of a write error.</td>
<td class="cellalignment1484" headers="r2c1-t17 r1c3-t17">Yes</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r3c1-t17" headers="r1c1-t17">Corrupted Dictionary</td>
<td class="cellalignment1484" headers="r3c1-t17 r1c2-t17">Dictionary corruption of a critical database object. Currently, this state can be detected only when the database is open</td>
<td class="cellalignment1484" headers="r3c1-t17 r1c3-t17">Yes</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r4c1-t17" headers="r1c1-t17">Corrupted Controlfile</td>
<td class="cellalignment1484" headers="r4c1-t17 r1c2-t17">Controlfile is permanently damaged because of a disk failure.</td>
<td class="cellalignment1484" headers="r4c1-t17 r1c3-t17">Yes</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r5c1-t17" headers="r1c1-t17">Inaccessible Logfile</td>
<td class="cellalignment1484" headers="r5c1-t17 r1c2-t17">LGWR is unable to write to any member of the log group because on an I/O error</td>
<td class="cellalignment1484" headers="r5c1-t17 r1c3-t17">No</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r6c1-t17" headers="r1c1-t17">Stuck Archiver</td>
<td class="cellalignment1484" headers="r6c1-t17 r1c2-t17">Archiver is unable to archive a redo log because the device is full or unavailable.</td>
<td class="cellalignment1484" headers="r6c1-t17 r1c3-t17">No</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p>In Oracle RAC configurations, the Inaccessible Logfile and Stuck Archiver health conditions may only be applicable to a single instance. Careful consideration should be given before enabling fast-start failover for either of these conditions because doing so will supersede availability options provided by Oracle Clusterware.</p>
<p>You can also specify errors raised by the Oracle server (ORA errors) as conditions for which fast-start failover should occur.</p>
<p>You can specify particular conditions for which a fast-start failover should occur using either Oracle Enterprise Manager or the DGMGRL <code dir="ltr">ENABLE FAST_START FAILOVER CONDITION</code> and <code dir="ltr">DISABLE FAST_START FAILOVER CONDITION</code> commands.</p>
</dd>
<dd><a id="DGBKR3664"></a><a id="sthref544"></a></dd>
<dt class="seghead">Step 7&nbsp;&nbsp;&nbsp;Enabl<a id="sthref545"></a><a id="sthref546"></a>e fast-start failover.</dt>
<dd>
<p>Use the Enterprise Manager Fast-Start Failover wizard or the DGMGRL <code dir="ltr">ENABLE FAST_START FAILOVER</code> command to enable fast-start failover. To enable fast-start failover, both the primary and target standby databases must be running and have connectivity, and satisfy all of the prerequisite conditions listed in <a href="#BCGFFFBG">Section 5.5.1</a>.</p>
<p><span class="bold">Enable Fast-Start Failover Using Enterprise Manager</span></p>
<p>To enable fast-start failover in Enterprise Manager, use the Fast-Start Failover wizard. On the Data Guard Overview Page next to the "Fast-Start Failover" status field, click <code dir="ltr">Disabled</code> to invoke the Fast-Start Failover Page. Then, on the Fast-Start Failover Change Mode Page, click <code dir="ltr">Enabled</code>. Enterprise Manager will start the observer. Then, on the Fast-Start Failover Configure Page, select the standby database that should be the target of a failover. See <a href="#BCGIEFCF">Section 5.2, "Choosing a Target Standby Database"</a> for helpful advice. This page will not allow you to alter the protection mode. Rather, fast-start failover will be enabled in accordance with the current protection mode. If the currently configured mode is maximum protection, Enterprise Manager will downgrade the mode to maximum availability.</p>
<p><span class="bold">Enable Fast-Start Failover Using DGMGRL</span></p>
<p>To enable fast-start failover with DGMGRL, issue the <code dir="ltr">ENABLE FAST_START FAILOVER</code> command while connected to any database in the broker configuration, including on the observer computer. For example:</p>
<pre dir="ltr">
DGMGRL&gt; ENABLE FAST_START FAILOVER;
Enabled.
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="dgmgrl.htm#BABDFHEE">ENABLE FAST_START FAILOVER</a></p>
</li>
<li>
<p><a href="cli.htm#BABEIIHD">Section 6.6, "Scenario 5: Enabling Fast-Start Failover and Starting the Observer"</a></p>
</li>
</ul>
</div>
<div class="infobox-note">
<p class="notep1">Note:</p>
Administration at the target standby site should be as comprehensive as that at the primary site because the standby database may assume the primary role without prior notice. Staff support, hardware and software, security (both software and site), network connections, and bandwidth should be equivalent at both sites.</div>
</dd>
<dd><a id="DGBKR3665"></a><a id="BCGJIDBC"></a></dd>
<dt class="seghead">Step 8&nbsp;&nbsp;&nbsp;Start the Observer.</dt>
<dd>
<p>The primary database must be running in order to start the observer.</p>
<p>You can start the observer before or after you enable fast-start failover. If fast-start failover is already enabled, the observer immediately begins monitoring the status and connections to the primary and target standby databases. If fast-start failover is not already enabled, the observer waits until fast-start failover gets enabled and then begins monitoring.</p>
<p><span class="bold">Starting the Observer Using Enterprise Manager</span></p>
<p>If the Enterprise Manager agent is installed on the observer computer, it automatically starts the observer when you enable fast-start failover through Enterprise Manager. If the agent is not present, you must start the observer manually using the following instructions for the DGMGRL command-line interface.</p>
<p><span class="bold">Starting the Observer Using DGMGRL</span></p>
<p>To start the observer with DGMGRL, issue the following command on the observer computer:</p>
<pre dir="ltr">
DGMGRL&gt; START OBSERVER;
</pre>
<p>The observer is a continuously executing process that is created when the <code dir="ltr">START OBSERVER</code> command is issued. Thus, the command-line prompt on the observer computer does not return until you issue the <code dir="ltr">STOP OBSERVER</code> command from another DGMGRL session. To issue commands and interact with the broker configuration, you must connect through another DGMGRL client session.</p>
<p>See the <a href="dgmgrl.htm#BABJECGA">START OBSERVER</a> command for more information.</p>
</dd>
<dd><a id="DGBKR3666"></a><a id="sthref547"></a></dd>
<dt class="seghead">Step 9&nbsp;&nbsp;&nbsp;Verif<a id="sthref548"></a><a id="sthref549"></a><a id="sthref550"></a>y the fast-start failover environment.</dt>
<dd>
<p>To verify the readiness of the fast-start failover configuration, issue the DGMGRL <code dir="ltr">SHOW CONFIGURATION VERBOSE</code> command or the <code dir="ltr">SHOW FAST_START FAILOVER</code> command on the primary database. For example:</p>
<pre dir="ltr">
DGMGRL&gt; SHOW FAST_START FAILOVER;
 
Fast-Start Failover: ENABLED
 Threshold:           60 seconds
 Target:              South_Sales
 Observer:            observer.example.com
 Lag Limit:           30 seconds (not in use)
 Shutdown Primary:    TRUE
 Auto-reinstate:      TRUE
 
Configurable Failover Conditions
 Health Conditions:
   Corrupted Controlfile          YES
   Corrupted Dictionary           YES
   Inaccessible Logfile            NO
   Stuck Archiver                  NO
   Datafile Offline               YES
 
 Oracle Error Conditions:
   (none)
</pre>
<p>The following sections provide more information about the fast-start failover environment:</p>
<ul>
<li>
<p><a href="#BCGHEJFH">When Fast-Start Failover Is Enabled and the Observer Is Running</a></p>
</li>
<li>
<p><a href="#BCGEFICG">Restrictions When Fast-Start Failover is Enabled</a></p>
</li>
<li>
<p><a href="#BCGEGABB">Shutting Down the Primary Database When Fast-Start Failover Is Enabled</a></p>
</li>
<li>
<p><a href="#BCGBEFHB">Performing Manual Role Changes When Fast-Start Failover Is Enabled</a></p>
</li>
</ul>
</dd>
</dl>
<a id="BCGHEJFH"></a>
<div id="DGBKR3408" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.5.2.1</span> When Fast-Start Failover Is Enabled and the O<a id="sthref551"></a><a id="sthref552"></a>bserver Is Running</h4>
<p>Once you enable fast-start failover and start the observer, the observer continuously monitors the environment to ensure the primary database is available. This section lists the steps the observer takes to determine if a fast-start failover is needed and then to perform one, if necessary.</p>
<dl>
<dd><a id="DGBKR3667"></a><a id="sthref553"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Monitor the environment to ensure the primary database is available.<a id="sthref554"></a><a id="sthref555"></a><a id="sthref556"></a></dt>
<dd>
<p>The observer waits the number of seconds specified by the <code dir="ltr">FastStartFailoverThreshold</code> configuration property before attempting a fast-start failover when the primary database has crashed or has lost connectivity with the observer, as in the following situations:</p>
<ul>
<li>
<p>The primary database loses its connections with both the observer and target standby database</p>
</li>
<li>
<p>I<a id="sthref557"></a><a id="sthref558"></a><a id="sthref559"></a>nstance failures</p>
<p>If a single-instance primary database (either Oracle RAC or non-Oracle RAC), or if all instances of an Oracle RAC primary database fail, the observer attempts a fast-start failover.</p>
</li>
<li>
<p><a id="sthref560"></a><a id="sthref561"></a><a id="sthref562"></a><a id="sthref563"></a>Shutdown abort</p>
<p>If a single-instance primary database (either Oracle RAC or non-Oracle RAC), or if all instances of an Oracle RAC primary database are shut down with the <code dir="ltr">ABORT</code> option, the observer attempts a fast-start failover. Fast-start failover will not be attempted for the other types of database shutdown (<code dir="ltr">NORMAL</code>, <code dir="ltr">IMMEDIATE</code>, <code dir="ltr">TRANSACTIONAL</code>).</p>
</li>
</ul>
<p>The observer never waits for the threshold to expire to perform a fast-start failover in the following situations:</p>
<ul>
<li>
<p>User-configurable condition</p>
<p>If the observer determines that any of the user-configurable conditions has been detected, the observer attempts a fast-start failover.</p>
</li>
<li>
<p>Application calls to <code dir="ltr">DBMS_DG.INITIATE_FS_FAILOVER</code></p>
<p>If an application has called this function and it has received a status of <code dir="ltr">SUCCESS</code>, the observer attempts a fast-start failover.</p>
</li>
</ul>
</dd>
<dd><a id="DGBKR3668"></a><a id="sthref564"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Reconnect within the time specified by FastStartFailoverThreshold.</dt>
<dd>
<p>If the observer detects an availability problem with the primary database, the observer typically attempts to reconnect to the primary database within the time specified by the <code dir="ltr">FastStartFailoverThreshold</code> configuration property. The <code dir="ltr">FastStartFailoverThreshold</code> time interval starts when the observer first detects there might be a failure with the primary database.</p>
<p>The time interval specified by the <code dir="ltr">FastStartFailoverThreshold</code> property is ignored if the observer detects that a user-configurable condition has occurred or if a fast-start failover has been requested by the <code dir="ltr">DBMS_DG.INITIATE_FS_FAILOVER</code> function.</p>
<p>If the primary database is an Oracle <a id="sthref565"></a>Real Application Clusters (Oracle RAC)<a id="sthref566"></a><a id="sthref567"></a> database, the observer will attempt to connect to one of the remaining primary instances. Fast-start failover will not occur unless all instances comprising the Oracle RAC primary database are perceived to have failed. The observer uses the value specified by either the <code dir="ltr">DGConnectIdentifier</code> or <code dir="ltr">ObserverConnectIdentifier</code> database properties to connect to the primary and fast-start failover target standby databases. The value specified for either of these properties should allow the observer to connect to any instance of an Oracle RAC database.</p>
</dd>
<dd><a id="DGBKR3669"></a><a id="sthref568"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Verify the target standby database is ready for failover.</dt>
<dd>
<p>If fast-start failover is initiated, the observer verifies the target standby database is ready to fail over to the primary database role.</p>
<p>Fast-start failover <span class="italic">cannot</span> occur if:</p>
<ul>
<li>
<p>Fast-start failover is no longer enabled</p>
</li>
<li>
<p>The observer cannot connect to the target standby database</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#BCGGADHF">Section 5.5.7.3, "What Happens if the Observer Fails?"</a> if the observer is not running</div>
</li>
<li>
<p>The observer and the target standby database are inconsistent with regard to the current state of the broker configuration</p>
</li>
<li>
<p>The observer is not running</p>
</li>
<li>
<p>If the protection mode is maximum availability and the target standby database was not synchronized with the primary database at the time the primary database failed</p>
</li>
<li>
<p>If the protection mode is maximum performance and the apply point of the target standby database lags the redo generation point of the primary database by more than the amount specified by the <code dir="ltr">FastStartFailoverLagLimit</code> configuration property at the time the primary database failed</p>
</li>
<li>
<p>The target standby database has contact with the primary database</p>
</li>
<li>
<p>The <code dir="ltr">FS_FAILOVER_STATUS</code> column in the <code dir="ltr">V$DATABASE</code> view for the target standby database displays a reason why fast-start failover cannot occur</p>
</li>
<li>
<p>A manual failover is already in progress. See <a href="#BCGBFFIH">Section 5.4</a> for complete information about manual failovers.</p>
</li>
<li>
<p>The primary database was shut down without using the <code dir="ltr">ABORT</code> option</p>
</li>
</ul>
</dd>
<dd><a id="DGBKR3670"></a><a id="sthref569"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Initiate a fast-start failover.</dt>
<dd>
<p>If the target standby database is ready for failover, the observer immediately directs the target standby database to fail over to the primary database role. If failover is not possible for some reason, the observer will continue checking whether the standby database is ready to fail over. But it will also continue trying to reconnect to the primary database indefinitely. If it reconnects to the primary database before the standby agrees to fail over, the observer will stop attempting to initiate a fast-start failover.</p>
</dd>
<dd><a id="DGBKR3671"></a><a id="sthref570"></a></dd>
<dt class="seghead">Step 5&nbsp;&nbsp;&nbsp;Reinstate the former primary database as a new standby database.</dt>
<dd>
<p>After the fast-start failover completes successfully, the observer will attempt to reinstate the former primary database as a new standby database when a connection to the former primary database is reestablished, and the <code dir="ltr">FastStartFailoverAutoReinstate</code> configuration property is set to <code dir="ltr">TRUE</code>. If the <code dir="ltr">FastStartFailoverPmyShutdown</code> configuration property is set to <code dir="ltr">TRUE</code>, the former primary database will have been automatically shut down and must be manually restarted before the observer can attempt to reinstate it.</p>
<p>Note that these properties only affect whether primary shutdown and automatic reinstatement are performed if a fast-start failover occurs because the primary crashed or was isolated from the observer and target standby database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDIBEBC">Section 5.5.8</a> for more information about reinstatement</div>
</dd>
</dl>
</div>
<!-- class="sect3" -->
<a id="BCGEFICG"></a>
<div id="DGBKR393" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.5.2.2</span> Restrictions When Fast-Start Failover is Enabled</h4>
<p>When fast-start failover is enabled, you cannot:</p>
<ul>
<li>
<p>Change:</p>
<ul>
<li>
<p>The configuration protection mode</p>
</li>
<li>
<p>The <a href="dbpropref.htm#i87097">LogXptMode</a> database property on the primary or target standby databases</p>
</li>
<li>
<p>The <a href="dbpropref.htm#BABECDBC">FastStartFailoverTarget</a> configuration property on the primary or target standby databases</p>
</li>
</ul>
</li>
<li>
<p>Disable or delete:</p>
<ul>
<li>
<p>The broker configuration</p>
</li>
<li>
<p>The standby database that is the target of fast-start failover</p>
</li>
</ul>
</li>
<li>
<p>Perform a manual failover:</p>
<ul>
<li>
<p>Unless the conditions listed in <a href="#BCGBEFHB">Section 5.5.2.4</a> have been met</p>
</li>
<li>
<p>To a standby database that is not configured as the fast-start failover target</p>
</li>
</ul>
<p>To determine if the configuration is ready for fast-start failover to occur, issue the DGMGRL <code dir="ltr">SHOW DATABASE &lt;target-standby-database&gt;</code> command, or query the <a id="sthref571"></a><a id="sthref572"></a><a id="sthref573"></a><code dir="ltr">V$DATABASE</code> view on either the primary or target standby databases. The column value for <code dir="ltr">V$DATABASE.FS_FAILOVER_STATUS</code> will be <code dir="ltr">SYNCHRONIZED</code> in a configuration operating in maximum availability mode, and it will be <code dir="ltr">TARGET UNDER LAG LIMIT</code> in a configuration operating in maximum performance mode when ready to fast-start failover. The <code dir="ltr">FS_FAILOVER_OBSERVER_PRESENT</code> column displays <code dir="ltr">YES</code> for the target standby database.</p>
</li>
<li>
<p>Perform a switchover to a standby database that is not configured as the fast-start failover target</p>
</li>
<li>
<p>Perform a switchover to the target standby database in a configuration operating in maximum availability mode, unless the standby database is synchronized with the primary database</p>
</li>
<li>
<p>Perform a switchover to the target standby database in a configuration operating in maximum performance mode, unless the standby database is within the lag limit of the primary database</p>
</li>
<li>
<p>Attempt to open the primary database, or the following error may be returned:</p>
<pre dir="ltr">
ORA-16649: possible failover to another database prevents this database from being opened
</pre>
<p>This error may return if the fast-start failover validity check fails or does not complete in under two minutes.</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<a id="BCGEGABB"></a>
<div id="DGBKR3409" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.5.2.3</span> Shutting Down the Primary Database When Fast-Start Failover Is Enabled<a id="sthref574"></a><a id="sthref575"></a><a id="sthref576"></a><a id="sthref577"></a></h4>
<p>Fast-start failover will not be triggered if the primary or standby database is shut down normally (using <code dir="ltr">SHUTDOWN NORMAL</code>, <code dir="ltr">SHUTDOWN IMMEDIATE</code>, or <code dir="ltr">SHUTDOWN TRANSACTIONAL</code>). A normal shutdown will prevent fast-start failover until the primary database and standby database are connected and communicating again.</p>
</div>
<!-- class="sect3" -->
<a id="BCGBEFHB"></a>
<div id="DGBKR3410" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.5.2.4</span> Performing <a id="sthref578"></a><a id="sthref579"></a>M<a id="sthref580"></a><a id="sthref581"></a><a id="sthref582"></a>anual Role Changes When Fast-Start Failover Is Enabled</h4>
<p>If fast-start failover is enabled you can still perform a switchover or a manual failover as long as the following conditions are met:</p>
<ul>
<li>
<p>The role change is directed to the same standby database that was specified with the <code dir="ltr">FastStartFailoverTarget</code> configuration property.</p>
</li>
<li>
<p>The target standby database is synchronized with the primary database if it is a configuration operating in maximum availability mode, or the target standby database is within the lag limit if it is a configuration operating in maximum performance mode.</p>
</li>
<li>
<p>For manual failover, the observer is started and communicating with the target standby database. You must ensure that the primary database is shut down prior to performing a manual failover.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can disable fast-start failover if necessary, by using the <code dir="ltr">FORCE</code> option. See <a href="#BCGJEGAF">Section 5.5.5, "Disabling Fast-Start Failover"</a>.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#BCGFBHJI">Section 5.3</a> and <a href="#BCGBFFIH">Section 5.4</a> for more information about switchovers and manual failovers, respectively</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CEGDDGJH"></a>
<div id="DGBKR3411" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.5.3</span> Directing a Fast-Start Failover From an Application</h3>
<p>You can use the <code dir="ltr">DBMS_DG</code> PL/SQL package to allow an application to direct a fast-start failover when it encounters specific conditions. When a serious condition uniquely known to the application is detected, it may call the <code dir="ltr">DBMS_DG.INITIATE_FS_FAILOVER</code> function, thus alerting either the primary or fast-start failover target standby database that it wants a fast-start failover to occur immediately. The database on which the procedure was called notifies the observer of this. The observer immediately initiates a fast-start failover, as long as the standby database is in a valid fast-start failover state ("observed" and either "synchronized" or "within lag") to accept a failover. Once the observer has initiated a fast-start failover, the primary database shuts down automatically. The observer does not attempt to reinstate the former primary database.</p>
<p>If the configuration is not failable, the <code dir="ltr">DBMS_DG.INITIATE_FS_FAILOVER</code> function returns an <code dir="ltr">ORA</code> error number (it does not signal an exception) informing the caller that a fast-start failover could not be performed.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The application should use caution when calling this function because the observer will initiate failover, if at all possible.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS920" href="../../appdev.112/e40758/d_dg.htm#ARPLS920"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code dir="ltr">DBMS_DG</code> package</div>
</div>
<!-- class="sect2" -->
<a id="BCGJCEBI"></a>
<div id="DGBKR3412" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.5.4</span> Viewing Fast-Start Failover Configuration Statistics and Status</h3>
<p>To verify the observer is started and the configuration is ready for fast-start failover, you can issue the DGMGRL <code dir="ltr">SHOW DATABASE &lt;target-standby-database&gt;</code> command or query the <code dir="ltr">V$DATABASE</code> view on the target standby database.</p>
<p>You can also query the <code dir="ltr">V$FS_FAILOVER_STATS</code> view to display statistics about fast-start failover occurring on the system.</p>
<p>The rest of this section provides examples of using DGMGRL <code dir="ltr">SHOW</code> commands to display fast-start failover information and includes sections describing the following views:</p>
<ul>
<li>
<p><a href="#CHDIGBDF">V$DATABASE View</a></p>
</li>
<li>
<p><a href="#CHDDJIGD">V$FS_FAILOVER_STATS View</a></p>
</li>
</ul>
<dl>
<dd><a id="DGBKR3672"></a><a id="sthref583"></a></dd>
<dt class="seghead">Example 1&nbsp;&nbsp;&nbsp;SHOW FAST-START FAILOVER<a id="sthref584"></a></dt>
<dd>
<p>The DGMGRL <code dir="ltr">SHOW FAST-START FAILOVER</code> command displays all the fast-start failover related information. For example:</p>
<pre dir="ltr">
DGMGRL&gt; SHOW FAST_START FAILOVER;
 
Fast-Start Failover: ENABLED
 Threshold:           60 seconds
 Target:              South_Sales
 Observer:            observer.example.com
 Lag Limit:           30 seconds (not in use)
 Shutdown Primary:    TRUE
 Auto-reinstate:      TRUE
 
Configurable Failover Conditions
 Health Conditions:
   Corrupted Controlfile          YES
   Corrupted Dictionary           YES
   Inaccessible Logfile            NO
   Stuck Archiver                  NO
   Datafile Offline               YES
 
 Oracle Error Conditions:
   (none)
</pre></dd>
<dd><a id="DGBKR3673"></a><a id="sthref585"></a></dd>
<dt class="seghead">Example 2&nbsp;&nbsp;&nbsp;SHOW CONFIGURATION VERBOSE<a id="sthref586"></a></dt>
<dd>
<p>The following example shows the fast-start failover information for the DRSolution configuration:</p>
<pre dir="ltr">
DGMGRL&gt; SHOW CONFIGURATION VERBOSE;
 
Configuration - DRSolution
 
  Protection Mode: MaxAvailability
  Databases:
    North_Sales  - Primary database
    South_Sales  - (*) Physical standby database
 
  (*) Fast-Start Failover target
 
  Properties:
    FastStartFailoverThreshold      = '60'
    OperationTimeout                = '30'
    FastStartFailoverLagLimit       = '30'
    CommunicationTimeout            = '180'
    FastStartFailoverAutoReinstate  = 'TRUE'
    FastStartFailoverPmyShutdown    = 'TRUE'
    BystandersFollowRoleChange      = 'ALL'
 
Fast-Start Failover: ENABLED
 
  Threshold:        180 seconds
  Target:           South_Sales
  Observer:         observer.example.com
  Lag Limit:        30 seconds (not in use)
  Shutdown Primary: TRUE
  Auto-reinstate:   TRUE
 
Configuration Status:
SUCCESS
</pre></dd>
</dl>
<a id="CHDIGBDF"></a>
<div id="DGBKR3413" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.5.4.1</span> V$DATABASE View</h4>
<p>You can query the <code dir="ltr">V$DATABASE</code> view <a id="sthref587"></a><a id="sthref588"></a>to verify that the observer is started and the configuration is ready for fast-start failover. When querying the <code dir="ltr">V$DATABASE<a id="sthref589"></a><a id="sthref590"></a></code> view, pay special attention to the following:</p>
<ul>
<li>
<p>The <code dir="ltr">FS_FAILOVER_STATUS</code> column, which can contain the values described in <a href="#CHDIDBGI">Table 5-1</a>. Note that if the <code dir="ltr">V$DATABASE.FS_FAILOVER_STATUS</code> column has a value of <code dir="ltr">DISABLED</code>, then any values returned for the remaining columns related to fast-start failover (<code dir="ltr">V$DATABASE.FS_FAILOVER_*</code>) become irrelevant.</p>
</li>
<li>
<p>The <code dir="ltr">FS_FAILOVER_OBSERVER_PRESENT</code> column, which indicates whether the observer is running and actively pinging the database.</p>
</li>
</ul>
<div id="DGBKR3542" class="tblformal">
<p class="titleintable"><a id="sthref591"></a><a id="CHDIDBGI"></a>Table 5-1 FS_FAILOVER_STATUS Column of the V$DATABASE View</p>
<table class="cellalignment1491" title="FS_FAILOVER_STATUS Column of the V$DATABASE View" summary="Lists the values for the FS_FAILOVER_STATUS column of the V$DATABASE view." dir="ltr">
<thead>
<tr class="cellalignment1478">
<th class="cellalignment1490" id="r1c1-t26">Column Value</th>
<th class="cellalignment1490" id="r1c2-t26">Description</th>
<th class="cellalignment1490" id="r1c3-t26">Fast-Start Failover ...</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r2c1-t26" headers="r1c1-t26">
<p><code dir="ltr">BYSTANDER</code></p>
</td>
<td class="cellalignment1484" headers="r2c1-t26 r1c2-t26">
<p>Fast-start failover is enabled, but this standby database is not the target of the fast-start failover. The database cannot provide fast-start failover status information.</p>
</td>
<td class="cellalignment1484" headers="r2c1-t26 r1c3-t26">
<p>Is enabled</p>
</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r3c1-t26" headers="r1c1-t26">
<p><code dir="ltr">DISABLED</code></p>
</td>
<td class="cellalignment1484" headers="r3c1-t26 r1c2-t26">
<p>Fast-start failover is disabled.</p>
</td>
<td class="cellalignment1484" headers="r3c1-t26 r1c3-t26">
<p>Is not possible</p>
</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r4c1-t26" headers="r1c1-t26">
<p><code dir="ltr">LOADING DICTIONARY</code></p>
</td>
<td class="cellalignment1484" headers="r4c1-t26 r1c2-t26">
<p>Displays only on a logical standby database that has not yet completed loading a copy of the primary database's data dictionary.</p>
</td>
<td class="cellalignment1484" headers="r4c1-t26 r1c3-t26">
<p>Is not possible</p>
</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r5c1-t26" headers="r1c1-t26">
<p><code dir="ltr">PRIMARY UNOBSERVED</code></p>
</td>
<td class="cellalignment1484" headers="r5c1-t26 r1c2-t26">
<p>Displays only on the target standby database when it is <code dir="ltr">SYNCHRONIZED</code> with or is <code dir="ltr">TARGET UNDER LAG LIMIT</code> of the primary database, has connectivity to the observer, but the primary database does not have a connection to the observer.</p>
</td>
<td class="cellalignment1484" headers="r5c1-t26 r1c3-t26">
<p>Is not possible</p>
</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r6c1-t26" headers="r1c1-t26">
<p><code dir="ltr">REINSTATE FAILED</code></p>
</td>
<td class="cellalignment1484" headers="r6c1-t26 r1c2-t26">
<p>Reinstatement of the failed primary database as a new standby database failed. See <a href="troubleshooting.htm#i1009720">Section 9.1</a> for details about the broker's <a id="sthref592"></a><a id="sthref593"></a><a id="sthref594"></a><code dir="ltr">drc*</code> log files.</p>
</td>
<td class="cellalignment1484" headers="r6c1-t26 r1c3-t26">
<p>Has completed</p>
</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r7c1-t26" headers="r1c1-t26">
<p><code dir="ltr">REINSTATE REQUIRED</code></p>
</td>
<td class="cellalignment1484" headers="r7c1-t26 r1c2-t26">
<p>The failed primary database requires reinstatement as a new standby database to the new primary. The observer automatically starts the reinstatement process. <code dir="ltr">REINSTATE REQUIRED</code> is present only after fast-start failover has occurred and shows on both the new primary database and the database undergoing reinstatement. This is cleared on both when the reinstatement has been completed.</p>
</td>
<td class="cellalignment1484" headers="r7c1-t26 r1c3-t26">
<p>Has completed</p>
</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r8c1-t26" headers="r1c1-t26">
<p><code dir="ltr">STALLED</code></p>
</td>
<td class="cellalignment1484" headers="r8c1-t26 r1c2-t26">
<p>Displays on the primary database after loss of connectivity to the target standby database and the change to the <code dir="ltr">UNSYNCHRONIZED</code> state (maximum availability mode) or to the <code dir="ltr">TARGET OVER LAG LIMIT</code> state (maximum performance mode) cannot be confirmed by either the target standby database or the observer. Note that the value of the <code dir="ltr">FastStartFailoverPmyShutdown</code> configuration property must be <code dir="ltr">FALSE</code> for the primary to stall indefinitely under these conditions. With a value of <code dir="ltr">TRUE</code> for this property, the primary will shut down after being stalled for the number of seconds specified by the <code dir="ltr">FastStartFailoverThreshold</code> property.</p>
<p>It shuts down or stalls because it is likely a failover has occurred.</p>
<p><span class="bold">Note</span>: this state also occurs on the primary during startup when fast-start failover is possible and neither the target standby database nor the observer are present to confirm it is okay to continue opening the database.</p>
</td>
<td class="cellalignment1484" headers="r8c1-t26 r1c3-t26">
<p>Is possible</p>
</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r9c1-t26" headers="r1c1-t26">
<p><code dir="ltr">TARGET OVER LAG LIMIT</code></p>
</td>
<td class="cellalignment1484" headers="r9c1-t26 r1c2-t26">
<p>Displays if the standby database's redo applied point lags the primary database's redo generation point by more than the number of seconds specified by the <code dir="ltr">FastStartFailoverLagLimit</code> configuration property and the configuration is operating in maximum performance mode.</p>
</td>
<td class="cellalignment1484" headers="r9c1-t26 r1c3-t26">
<p>Is not possible</p>
</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r10c1-t26" headers="r1c1-t26">
<p><code dir="ltr">TARGET UNDER LAG LIMIT</code></p>
</td>
<td class="cellalignment1484" headers="r10c1-t26 r1c2-t26">
<p>Displays if the standby database's redo applied point does not lag the primary database's redo generation point by more than the number of seconds specified by the <code dir="ltr">FastStartFailoverLagLimit</code> configuration property and the configuration is operating in maximum performance mode.</p>
</td>
<td class="cellalignment1484" headers="r10c1-t26 r1c3-t26">
<p>Is possible</p>
</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r11c1-t26" headers="r1c1-t26">
<p><code dir="ltr">SUSPENDED</code></p>
</td>
<td class="cellalignment1484" headers="r11c1-t26 r1c2-t26">
<p>Displays only on the target standby database when either the primary or target standby database was shut down in a controlled fashion (using the <code dir="ltr">NORMAL</code>, <code dir="ltr">IMMEDIATE</code>, or <code dir="ltr">TRANSACTIONAL</code>, options, but not the <code dir="ltr">ABORT</code> option). Fast-start failover is inhibited in this case. <code dir="ltr">SUSPENDED</code> is cleared when connectivity with the primary database is restored.</p>
</td>
<td class="cellalignment1484" headers="r11c1-t26 r1c3-t26">
<p>Is not possible</p>
</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r12c1-t26" headers="r1c1-t26">
<p><code dir="ltr">SYNCHRONIZED</code></p>
</td>
<td class="cellalignment1484" headers="r12c1-t26 r1c2-t26">
<p>Displays when the primary and target standby databases are synchronized and the configuration is operating in maximum availability mode.</p>
</td>
<td class="cellalignment1484" headers="r12c1-t26 r1c3-t26">
<p>Is possible if the target standby database displays <code dir="ltr">SYNCHRONIZED</code> and the <code dir="ltr">FS_FAILOVER_OBSERVER_PRESENT</code> column displays <code dir="ltr">YES</code></p>
</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r13c1-t26" headers="r1c1-t26">
<p><code dir="ltr">UNSYNCHRONIZED</code></p>
</td>
<td class="cellalignment1484" headers="r13c1-t26 r1c2-t26">
<p>Displays when the target standby database does not have all of the primary database redo data and the configuration is operating in maximum availability mode.</p>
</td>
<td class="cellalignment1484" headers="r13c1-t26 r1c3-t26">
<p>Is not possible</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" --></div>
<!-- class="sect3" -->
<a id="CHDDJIGD"></a>
<div id="DGBKR3414" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.5.4.2</span> V$FS_FAILOVER_STATS View<a id="sthref595"></a></h4>
<p>Because fast-start failovers are fully automated and can occur at any time, it is useful to query this view on the primary database to display statistics about fast-start failovers that have occurred on the system, including:</p>
<ul>
<li>
<p><code dir="ltr">LAST_FAILOVER_TIME</code> that shows the timestamp of last fast-start failover</p>
</li>
<li>
<p><code dir="ltr">LAST_FAILOVER_REASON</code> that shows the reason for the last fast-start failover</p>
</li>
</ul>
<p>The following is an example of querying the <code dir="ltr">V$FS_FAILOVER_STATS</code> view:</p>
<pre dir="ltr">
SQL&gt; SELECT LAST_FAILOVER_TIME, LAST_FAILOVER_REASON FROM V$FS_FAILOVER_STATS;
 
LAST_FAILOVER_TIME
--------------------
LAST_FAILOVER_REASON
------------------------------------------------------------------------------------------------------------------------------------
02/13/2007 16:53:10
Primary Disconnected
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BCGJEGAF"></a>
<div id="DGBKR3390" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.5.5</span> Disabling Fast-Start Failover</h3>
<p>Disablin<a id="sthref596"></a><a id="sthref597"></a>g fast-start failover prevents the observer from initiating a failover to the target standby database. In this case, manual failover may still be possible. See <a href="#BCGBFFIH">Section 5.4</a> for information about manual failover.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Disabling fast-start failover does not stop the observer. To stop the observer, see <a href="#BCGEDBFA">Section 5.5.7.4, "Stopping the Observer"</a>.</div>
<p>To disable fast-start failover, use the Fast-S<a id="sthref598"></a>tart Failover wizard in Enterprise Manager or the DGMGRL <code dir="ltr"><a id="sthref599"></a><a id="sthref600"></a>DISABLE FAST_START FAILOVER</code> <code dir="ltr">[FORCE]</code> command. The <code dir="ltr">FORCE</code> option disables fast-start failover on the database to which you are connected even when errors occur. Whether or not you need the <code dir="ltr">FORCE</code> option depends mostly on if the primary and target standby database have network connectivity:</p>
<ul>
<li>
<p>If the primary and target standby database have network connectivity, and the database to which you are connected has network connectivity with the primary database, the <code dir="ltr">FORCE</code> option has no effect. Simply use <code dir="ltr">DISABLE FAST_START FAILOVER</code>. This method will disable fast-start failover on all databases in the broker configuration.</p>
<p>If errors occur during the disable operation, the broker returns an error message and stops the disable operation.</p>
</li>
<li>
<p>If the primary and target standby databases do not have network connectivity or if the database to which you are connected does not have network connectivity with the primary database, consider using <code dir="ltr">DISABLE FAST_START FAILOVER</code> <span class="italic">with</span> the <code dir="ltr">F<a id="sthref601"></a>ORCE</code> option.</p>
<p>The broker may not be able to d<a id="sthref602"></a><a id="sthref603"></a><a id="sthref604"></a>isable fast-start failover on all databases in the broker configuration when you issue the <code dir="ltr">DISABLE FAST_START FAILOVER FORCE</code> command. As a result, there is no guarantee that the observer will not perform a fast-start failover to the target standby database if the observer determines that conditions warrant a failover. The following list indicates the extent to which fast-start failover is disabled in the broker configuration when the <code dir="ltr">DISABLE FAST_START FAILOVER FORCE</code> command is issued on the primary database, target standby database, and a standby database that is not the fast-start failover target.</p>
<p>If you issue this command on:</p>
<ul>
<li>
<p>The target standby database when it does not have connectivity with the primary database, fast-start failover is disabled only on the target standby database. In this case, the observer cannot perform a fast-start failover even if conditions warrant a failover. Disabling fast-start failover with the <code dir="ltr">FORCE</code> option when connected to the target standby database guarantees that fast-start failover will not occur.</p>
<p>When the primary database and the target standby database regain network connectivity, the broker will disable fast-start failover for the entire broker configuration.</p>
</li>
<li>
<p>The primary database, it attempts to disable fast-start failover on as many databases in the configuration with which it has a network connection. If the primary database does not have connectivity with the target standby database, fast-start failover remains enabled on the target standby database and the observer may still attempt a fast-start failover if conditions warrant a failover.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
This action may result in two databases in the configuration simultaneously assuming the primary database role should fast-start failover occur. For this reason, you should first issue this command on the target standby database.</div>
</li>
<li>
<p>Another standby database that does not have connectivity with the primary database, fast-start failover is disabled for this database. Because fast-start failover was not disabled on the target standby database, the observer may still attempt a fast-start failover to the target standby database should conditions warrant a failover.</p>
<p>When the primary database and the (non-target) standby database regain network connectivity, the broker will propagate its current fast-start failover setting (<code dir="ltr">ENABLED</code> or <code dir="ltr">DISABLED</code>) to the non-target standby.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
When you are experiencing network disconnections and you issue the <code dir="ltr">DISABLE FAST_START FAILOVER FORCE</code> command on the primary database or a standby database that does not have connectivity with the primary database, fast-start failover may not be disabled for all databases in the broker configuration. As a result the observer may still initiate fast-start failover to the target standby database, if conditions warrant a failover. This may result in two databases in the configuration simultaneously assuming the primary database role.</div>
</li>
</ul>
</li>
</ul>
<p class="subhead2"><a id="BCGIEAEF"></a><a id="DGBKR3543"></a>Conditions Requiring the FORCE Option</p>
<p>Disabling fast-start failover without the <code dir="ltr">FORCE</code> option can succeed only if the database on which the command is issued has a network connection with the primary database and if the primary database and target standby database have a network connection. This is the recommended method for disabling fast-start failover.</p>
<p>However, there may be situations in which you must disable fast-start failover when the primary database and the target standby database do not have a network connection, or the database on which you issued the disable fast-start failover command does not have a network connection to the primary database. In cases where there is a lost network connection, be aware that the observer may attempt a fast-start failover to the target standby database if conditions warrant a failover.The <code dir="ltr">FORCE</code> option may be the preferred method for disabling fast-start failover when:</p>
<ul>
<li>
<p>A network outage isolates the primary database from the observer and the target standby database before conditions exist that warrant a failover.</p>
<p>In this case, the primary database stalls and prevents any further transactions from committing because a fast-start failover may have occurred while it was isolated. If you expect the network to be disconnected for a long time and you need to make the primary database available, first confirm that a fast-start failover has not occurred to the target standby database. Then, disable fast-start failover with the <code dir="ltr">FORCE</code> option on the primary database.If possible, confirm that fast-start failover has not occurred to the target standby database prior to disabling fast-start failover with the <code dir="ltr">FORCE</code> option on the primary database.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
This action may result in two databases in the configuration simultaneously assuming the primary database role. This can be avoided by first disabling fast-start failover with the <code dir="ltr">FORCE</code> option on the target standby.</div>
</li>
<li>
<p>You want to conduct a <a id="sthref605"></a><a id="sthref606"></a><a id="sthref607"></a>manual failover to any standby database in the configuration (for example, because a failure occurred on the primary database at a time when the primary and target standby database were not ready to failover).</p>
<p>In this case fast-start failover cannot occur because the databases are not ready to failover. You cannot perform a manual failover to the target standby database for the same reason. To proceed, you must first disable fast-start failover using the <code dir="ltr">FORCE</code> option, and then perform a manual failover.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
This action will result in loss of data and the possibility of two databases in the configuration simultaneously assuming the primary database role. This can be avoided by first disabling fast-start failover with the <code dir="ltr">FORCE</code> option on the target standby.</div>
</li>
<li>
<p>A fast-start failover to the target standby database fails.</p>
<p>If the failover fails for any reason, it could leave the target standby database inoperable, regardless of whether the target standby database is ready to failover. If there is another standby database that is available for failover, you can perform a manual failover to that standby database after you first disable fast-start failover using the <code dir="ltr">FORCE</code> option on that standby database.</p>
</li>
<li>
<p>You want to prevent fast-start failover from occurring because the primary database will resume service soon.</p>
<p>In this case, disable fast-start failover using the <code dir="ltr">FORCE</code> option on the target standby database. Once the primary database regains connectivity with the target standby database, fast-start failover will be disabled for all the databases in the configuration.</p>
</li>
</ul>
<p><span class="bold">Disabling Fast-Start Failover Using Enterprise Manager</span></p>
<p>Click <span class="bold">Disable</span> in the Fast-Start Failover wizard. Then, click <span class="bold">Continue</span> to proceed to the next page. See the Enterprise Manager online Help system for more information.</p>
<p><span class="bold">Disabling Fast-Start Failover Using DGMGRL</span></p>
<p>Issue the <code dir="ltr">DISABLE FAST_START FAILOVER</code> command or the <code dir="ltr">DISABLE FAST_START FAILOVER</code> <code dir="ltr">FORCE</code> command. See the <a href="dgmgrl.htm#BABGIAAB">"DISABLE FAST_START FAILOVER"</a> command in <a href="dgmgrl.htm#g1019606">Chapter 7</a> for more information.</p>
</div>
<!-- class="sect2" -->
<a id="BCGHEAHA"></a>
<div id="DGBKR396" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.5.6</span> Performance Considerations for Fast-Start Failover</h3>
<p>Consider the following recommendations to obtain better performance when using fast-start failover:</p>
<ul>
<li>
<p>The failover time is dependent upon whether the target standby database (physical or logical standby database) has applied all of the redo data it has received from the primary database.</p>
</li>
<li>
<p>Enabling fast-start failover in a configuration operating in maximum performance mode provides better overall performance on the primary database because redo data is sent asynchronously to the target standby database. Note that this does not guarantee no data will be lost.</p>
</li>
<li>
<p>Fast-start failover is faster when you take steps to optimize recovery so that the application of redo data to the standby database is kept up to date with the primary database's rate of redo application. To optimize the log apply rate:</p>
<ul>
<li>
<p>Do not configure the <code dir="ltr">DelayMins</code> database property to delay applying archived redo log files to the standby database (see <a href="dbresource.htm#i1024829">Section 4.5</a> for more information).</p>
</li>
<li>
<p>See <a class="olink SBYDB" href="../e41134/toc.htm"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for information about tuning the log apply rate for a physical standby database.</p>
</li>
<li>
<p>See the <span class="italic">Oracle Maximum Availability Architecture</span> white papers at:</p>
<p><code dir="ltr"><a href="http://www.oracle.com/goto/maa/">http://www.oracle.com/goto/maa</a></code></p>
</li>
</ul>
</li>
<li>
<p>When setting the <code dir="ltr">FastStartFailoverLagLimit</code> configuration property, consider these tradeoffs between performance and potential data-loss:</p>
<ul>
<li>
<p>A low lag limit will minimize data loss but may impact the performance of the primary database.</p>
</li>
<li>
<p>A high lag limit may lead to more data loss but may lessen the performance impact of the primary database.</p>
</li>
</ul>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="BCGHBJJI"></a>
<div id="DGBKR394" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.5.7</span> Managing the Observer</h3>
<p>The observer is integrated in the DGMGRL client-side component of the broker and typically runs on a different computer from the primary or standby databases and from the computer where you manage the broker configuration. The observer continuously monitors the fast-start failover environment to ensure the primary database is available (described in <a href="#BCGHEJFH">Section 5.5.2.1</a>). The observer's main purpose is to enhance high availability and <span class="italic">lights out</span> computing by reducing the human intervention required by the manual failover process that can add minutes or hours to downtime.</p>
<p>You can manage the observer through either the Data Guard Overview pages in Oracle Enterprise Manager or using DGMGRL commands. <a href="#BCGDGADE">Figure 5-2</a> shows the observer monitoring a fast-start failover configuration.</p>
<div id="DGBKR3544" class="figure">
<p class="titleinfigure"><a id="BCGDGADE"></a>Figure 5-2 The Observer in the Fast-Start Failover Environment</p>
<img width="477" height="243" src="img/dgbkr007.gif" alt="Description of Figure 5-2 follows" /><br />
<a id="sthref608" href="img_text/dgbkr007.htm">Description of ''Figure 5-2 The Observer in the Fast-Start Failover Environment''</a><br />
<br /></div>
<!-- class="figure" -->
<p>The following sections provide information about managing the observer:</p>
<ul>
<li>
<p><a href="#BCGFFFHB">Installing and Starting the Observer</a></p>
</li>
<li>
<p><a href="#CHDHAIAB">Viewing Information About the Observer</a></p>
</li>
<li>
<p><a href="#BCGGADHF">What Happens if the Observer Fails?</a></p>
</li>
<li>
<p><a href="#BCGEDBFA">Stopping the Observer</a></p>
</li>
<li>
<p><a href="#BCGCGHBB">Moving the Observer to Another Computer</a></p>
</li>
<li>
<p><a href="#BCGHFEIC">How the Observer Maintains Fast-Start Failover Configuration Information</a></p>
</li>
</ul>
<a id="BCGFFFHB"></a>
<div id="DGBKR3415" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.5.7.1</span> Installing and Starting the Observer</h4>
<p>The observer should be installed and run on a computer system that is separate from the primary and standby systems. Installing and starting the observer is an integral part of using fast-start failover and is described in detail in these sections:</p>
<ul>
<li>
<p><a href="install.htm#BABFFICD">Section 2.1</a> describes installing Oracle Database Enterprise Edition or Oracle Personal Edition on the observer system.</p>
</li>
<li>
<p><a href="#CHDDFFEC">Section 5.5.2</a> describes how to start the observer as a part of the step-by-step process to enable fast-start failover. Examples of starting the observer using DGMGRL are included in <a href="cli.htm#BABEIIHD">Section 6.6</a>.</p>
</li>
</ul>
<p>There can be only one observer monitoring the broker configuration. If you attempt to start another one, the broker returns the following error message:</p>
<pre dir="ltr">
ORA-16647: could not start more than one observer
</pre>
<p>To start the observer, you must be able to log in to DGMGRL with an account that has the SYSDBA privilege. The observer is an OCI client that connects to the primary and target standby databases using the same <code dir="ltr">SYS</code> credentials you used when you connected to the Data Guard configuration with DGMGRL.</p>
<p>The observer and DGMGRL must be running the same Oracle Database release. For example, if DGMGRL is running on an Oracle Database release 2 (11.2.0.4) system, then the observer must be running on 11.2.0.4 also.</p>
</div>
<!-- class="sect3" -->
<a id="CHDHAIAB"></a>
<div id="DGBKR3416" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.5.7.2</span> Viewing Information About the Observer</h4>
<p>You can find information about the observer by querying the following columns in the <code dir="ltr">V$DATABASE</code> view:</p>
<ul>
<li>
<p><code dir="ltr">FS_FAILOVER_OBSERVER_HOST</code><a id="sthref609"></a><a id="sthref610"></a><a id="sthref611"></a> shows the name of the computer on which the observer is running</p>
</li>
<li>
<p><code dir="ltr">FS_FAILOVER_OBSERVER_PRESENT</code><a id="sthref612"></a><a id="sthref613"></a><a id="sthref614"></a><a id="sthref615"></a> shows whether or not the observer is connected to the local database</p>
</li>
</ul>
<div id="DGBKR3545" class="tblhruleformal">
<p class="titleintable"><a id="sthref616"></a><a id="sthref617"></a>Table 5-2 FS_FAILOVER_OBSERVER_PRESENT Column of the V$DATABASE View</p>
<table class="cellalignment1489" title="FS_FAILOVER_OBSERVER_PRESENT Column of the V$DATABASE View" summary="Describes the possible values for the FS_FAILOVER_OBSERVER_PRESENT column in the V$DATABASE view." dir="ltr">
<thead>
<tr class="cellalignment1478">
<th class="cellalignment1490" id="r1c1-t32">Column Value<a id="sthref618" href="#sthref618" onclick='footdisplay(1,"This value is consistent across instances in an Oracle Real Applications Clusters (Oracle RAC) environment. That is, if the observer is connected to any instance in the Oracle RAC, all instances will show a value of \u003ccode dir=\"ltr\"\u003eYES\u003c/code\u003e.")'><sup class="tablefootnote">Foot&nbsp;1&nbsp;</sup></a></th>
<th class="cellalignment1490" id="r1c2-t32">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r2c1-t32" headers="r1c1-t32">
<p><code dir="ltr">YES</code></p>
</td>
<td class="cellalignment1484" headers="r2c1-t32 r1c2-t32">
<p>Observer is currently connected to the local database</p>
</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r3c1-t32" headers="r1c1-t32">
<p><code dir="ltr">NO</code></p>
</td>
<td class="cellalignment1484" headers="r3c1-t32 r1c2-t32">
<p>Observer is not connected to the local database</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;1&nbsp;</sup>This value is consistent across instances in an Oracle Real Applications Clusters (Oracle RAC) environment. That is, if the observer is connected to any instance in the Oracle RAC, all instances will show a value of <code dir="ltr">YES</code>.</p>
<p>For example, to determine if fast-start failover can occur, the <code dir="ltr">FS_FAILOVER_STATUS</code> column displays either <code dir="ltr">SYNCHRONIZED</code> or <code dir="ltr">TARGET UNDER LAG LIMIT</code> and the <code dir="ltr">FS_FAILOVER_OBSERVER_PRESENT</code> column displays <code dir="ltr">YES</code> for the target standby database. For example:</p>
<div class="inftblinformal">
<table class="cellalignment1489" title="V$DATABASE Column Values When Fast-Start Failover Can Occur" summary="Provides an example of the FS_FAILOVER_STATUS column and the FS_FAILOVER OBSERVER_PRESENT column when connectivity between the primary database and observer is broken." dir="ltr">
<thead>
<tr class="cellalignment1478">
<th class="cellalignment1490" id="r1c1-t33">Database</th>
<th class="cellalignment1490" id="r1c2-t33"><code dir="ltr"><span class="codeinlinebold">FS_FAILOVER_STATUS</span></code></th>
<th class="cellalignment1490" id="r1c3-t33">Protection Mode</th>
<th class="cellalignment1490" id="r1c4-t33"><code dir="ltr"><span class="codeinlinebold">FS_FAILOVER_OBSERVER_PRESENT</span></code></th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r2c1-t33" headers="r1c1-t33">Primary</td>
<td class="cellalignment1484" headers="r2c1-t33 r1c2-t33"><code dir="ltr">SYNCHRONIZED</code></td>
<td class="cellalignment1484" headers="r2c1-t33 r1c3-t33">Maximum Availability</td>
<td class="cellalignment1484" headers="r2c1-t33 r1c4-t33"><code dir="ltr">YES</code></td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r3c1-t33" headers="r1c1-t33">Standby</td>
<td class="cellalignment1484" headers="r3c1-t33 r1c2-t33"><code dir="ltr">SYNCHRONIZED</code></td>
<td class="cellalignment1484" headers="r3c1-t33 r1c3-t33">Maximum Availability</td>
<td class="cellalignment1484" headers="r3c1-t33 r1c4-t33"><code dir="ltr">YES</code></td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r4c1-t33" headers="r1c1-t33">Primary</td>
<td class="cellalignment1484" headers="r4c1-t33 r1c2-t33"><code dir="ltr">TARGET UNDER LAG LIMIT</code></td>
<td class="cellalignment1484" headers="r4c1-t33 r1c3-t33">Maximum Performance</td>
<td class="cellalignment1484" headers="r4c1-t33 r1c4-t33"><code dir="ltr">YES</code></td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r5c1-t33" headers="r1c1-t33">Standby</td>
<td class="cellalignment1484" headers="r5c1-t33 r1c2-t33"><code dir="ltr">TARGET UNDER LAG LIMIT</code></td>
<td class="cellalignment1484" headers="r5c1-t33 r1c3-t33">Maximum Performance</td>
<td class="cellalignment1484" headers="r5c1-t33 r1c4-t33"><code dir="ltr">YES</code></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p>In the following example, assume the network between the primary database and the observer has failed. In this case, the <code dir="ltr">FS_FAILOVER_STATUS</code> and <code dir="ltr">FS_FAILOVER_OBSERVER_PRESENT</code> columns will appear as shown in the following table and fast-start failover will not occur:</p>
<div class="inftblinformal">
<table class="cellalignment1489" title="V$DATABASE Column Values When the Network Has Failed" summary="Provides an example of the FS_FAILOVER_STATUS column and the FS_FAILOVER OBSERVER_PRESENT column when connectivity between the primary database and observer is broken." dir="ltr">
<thead>
<tr class="cellalignment1478">
<th class="cellalignment1490" id="r1c1-t34">Database</th>
<th class="cellalignment1490" id="r1c2-t34"><code dir="ltr"><span class="codeinlinebold">FS_FAILOVER_STATUS</span></code></th>
<th class="cellalignment1490" id="r1c3-t34"><code dir="ltr"><span class="codeinlinebold">FS_FAILOVER_OBSERVER_PRESENT</span></code></th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r2c1-t34" headers="r1c1-t34">Primary</td>
<td class="cellalignment1484" headers="r2c1-t34 r1c2-t34"><code dir="ltr">SYNCHRONIZED</code></td>
<td class="cellalignment1484" headers="r2c1-t34 r1c3-t34"><code dir="ltr">NO</code></td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r3c1-t34" headers="r1c1-t34">Standby</td>
<td class="cellalignment1484" headers="r3c1-t34 r1c2-t34"><code dir="ltr">PRIMARY UNOBSERVED</code></td>
<td class="cellalignment1484" headers="r3c1-t34 r1c3-t34"><code dir="ltr">YES</code></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" --></div>
<!-- class="sect3" -->
<a id="BCGGADHF"></a>
<div id="DGBKR3417" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.5.7.3</span> What Happens if the Observer Fails?</h4>
<p>If the primary and target standby databases stay connected but the connection to the observer is lost, then the broker reports that the configuration is not observed<a id="sthref619"></a><a id="sthref620"></a><a id="sthref621"></a><a id="sthref622"></a><a id="sthref623"></a>. The configuration and database status report that the observer is not running and return one of the following status messages:</p>
<pre dir="ltr">
ORA-16658: unobserved fast-start failover configuration
ORA-16820: fast-start failover observer is no longer observing this database
</pre>
<p>While the configuration is in the unobserved state, fast-start failover cannot happen. Therefore, the primary database can continue processing transactions, even if the target standby database fails. The configuration status returns the <code dir="ltr">SUCCESS</code> status after the observer reestablishes its connection to the primary database, which then notifies the target standby database.</p>
<p class="subhead1"><a id="sthref624"></a>Making the Observer Highly Available</p>
<p>Oracle Enterprise Manager Cloud Control (Cloud Control) supports automatic restart of the observer on the same host if it detects that the observer process has failed. This automatic restart ability is activated whenever fast-start failover is enabled.</p>
<p>Cloud Control also supports automatic restart of the observer on an alternate host if the first host fails. Refer to the Cloud Control online help for information about how to designate an alternate observer host.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#BCGJCEBI">Section 5.5.4, "Viewing Fast-Start Failover Configuration Statistics and Status"</a></div>
</div>
<!-- class="sect3" -->
<a id="BCGEDBFA"></a>
<div id="DGBKR3418" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.5.7.4</span> Stopping the Observer</h4>
<p>You may want to stop the observer when you no longer want to use fast-start failover (see <a href="#BCGJEGAF">Section 5.5.5, "Disabling Fast-Start Failover"</a>) or if you want to move the observer to a different host machine (see <a href="#BCGCGHBB">Section 5.5.7.5, "Moving the Observer to Another Computer"</a>).</p>
<p>To stop the observer when fast-start failover <span class="italic">is enabled</span>, the primary database and target standby database must be connected and communicating with each other. Stopping the observer does not disable fast-start failover. However, fast-start failover cannot occur when the target standby database is in the unobserved state.</p>
<p>To stop the observer when fast-start failover <span class="italic">is enabled</span>, but the primary and standby are isolated from each other, you must first disable fast-start failover by using the <code dir="ltr">FORCE</code> option, and then stop the observer. (See <a href="#BCGJEGAF">Section 5.5.5, "Disabling Fast-Start Failover"</a> for important considerations when using the <code dir="ltr">FORCE</code> option.)</p>
<p>To stop the observer when fast-start failover <span class="italic">is not enabled</span>, the primary database must be running.You can stop the observer while connected to any database in the broker configuration that has network connectivity to the primary database, as follows:</p>
<ul>
<li>
<p>Using Enterprise Manager</p>
<p>Choose the <span class="bold">Stop Observer</span> option on the first page of the fast-start failover wizard and click <span class="bold">Continue</span> at the bottom of the page. See the Enterprise Manager online help system for more information.</p>
</li>
<li>
<p>Using DGMGRL</p>
<p>Issue the following command:</p>
<pre dir="ltr">
DGMGRL&gt; STOP OBSERVER;
</pre>
<p>See the <a href="dgmgrl.htm#BABIAHGE">STOP OBSERVER</a> command for more information.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The observer does not stop immediately when you issue the <code dir="ltr">STOP OBSERVER</code> command. After the broker receives the <code dir="ltr">STOP OBSERVER</code> request, the request is passed to the observer the next time the observer contacts the broker, and the observer then stops itself.</div>
</li>
</ul>
</div>
<!-- class="sect3" -->
<a id="BCGCGHBB"></a>
<div id="DGBKR3419" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.5.7.5</span> Moving the Observer to Another Computer</h4>
<p>To move the observer to another computer:</p>
<ol>
<li>
<p>Stop the observer from any computer system in the broker configuration, as described in <a href="#BCGEDBFA">Section 5.5.7.4</a>.</p>
</li>
<li>
<p>Start the observer on the new computer system, as described in Step <a href="#BCGJIDBC">8</a> of <a href="#CHDDFFEC">Section 5.5.2</a>.</p>
</li>
</ol>
<p>There is no need to disable fast-start failover when you move the observer.</p>
</div>
<!-- class="sect3" -->
<a id="BCGHFEIC"></a>
<div id="DGBKR3420" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.5.7.6</span> H<a id="sthref625"></a><a id="sthref626"></a>ow the O<a id="sthref627"></a><a id="sthref628"></a><a id="sthref629"></a>bserver Maintains Fast-Start Failover Configuration Information</h4>
<p>The observer persistently maintains information about the fast-start failover configuration in a binary file created in the working directory where you started the observer. By default, the observer creates this file in the current working directory when it is started and names the file <code dir="ltr">fsfo.dat</code>. This file contains connect identifiers to both the primary and the target standby databases.</p>
<p>Ensure this file cannot be read by unauthorized users.</p>
<p>Once the observer is started, you cannot change the file's name and location. However, you can change the name or the location of the file if you start the observer using the DGMGRL <code dir="ltr">START OBSERVER</code> command and include the <code dir="ltr">FILE</code> qualifier. See the <a href="dgmgrl.htm#BABJECGA">START OBSERVER</a> command for more information.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If the observer is stopped abnormally (for example, by typing <code dir="ltr">CTRL/C</code>), restart it and reference the existing <code dir="ltr">fsfo.dat</code> file with the <code dir="ltr">FILE</code> qualifier.</div>
<p>If you want to use one Oracle home to start multiple observers, with each observer monitoring a different fast-start failover configuration, use the <code dir="ltr">FILE</code> qualifier to specify a unique observer configuration file location for each configuration to be monitored. If you want to capture any logging generated by the observer, use the <code dir="ltr">LOGFILE</code> option and ensure that file name is unique as well. For example:</p>
<pre dir="ltr">
% dgmgrl -logfile $ORACLE_HOME/rdbms/log/config1.log
DGMGRL&gt; CONNECT /@primary1;
DGMGRL&gt; START OBSERVER FILE=$ORACLE_HOME/dbs/config1.dat;
 
% dgmgrl -logfile $ORACLE_HOME/rdbms/log/config2.log
DGMGRL&gt; CONNECT /@primary2;
DGMGRL&gt; START OBSERVER FILE=$ORACLE_HOME/dbs/config2.dat;
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDIBEBC"></a>
<div id="DGBKR395" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.5.8</span> Reinstating the Former Primary Database in the Broker Configuration</h3>
<p>If a fast-start failover was initiated because the primary database had crashed or lost connectivity with the observer and target standby database, the observer automatically attempts to <span class="italic">reinstate</span> the former primary database as a standby database, if the <code dir="ltr">FastStartFailoverAutoReinstate</code> configuration property is set to <code dir="ltr">TRUE</code>. <span class="bold">R<a id="sthref630"></a><a id="sthref631"></a><a id="sthref632"></a><a id="sthref633"></a>einstatement</span> restores high availability to the broker configuration so that, in the event of a failure of the new primary database, another fast-start failover can occur. The reinstated database acts as the fast-start failover target for the new primary database, making a subsequent fast-start failover possible. The new standby database is a viable target of a failover when it begins receiving redo data received from the new primary database.</p>
<p>To allow the observer to automatically reinstate the former primary database, the database must be started and mounted, but it cannot be opened. The observer will restart the former primary database to the mounted state if it is open, prior to reinstating the database. The broker reinstates the database as a standby database of the same type as the former standby database of the new primary database.</p>
<p>If the former primary database cannot be reinstated automatically, you can manually reinstate it using either the DGMGRL <code dir="ltr">REINSTATE</code> command or Enterprise Manager. Step-by-step instructions for manual reinstatement are described in <a href="#CHDEHEEF">Section 5.4.3</a>.</p>
<div id="DGBKR3421" class="sect3"><a id="sthref634"></a>
<h4 class="sect3"><span class="secnum">5.5.8.1</span> Requirements</h4>
<p>Reinstatement is supported only after failover in a broker configuration. It also requires Flashback Database to be enabled on both the primary and target standby databases. <a href="#BCGFFFBG">Section 5.5.1</a> provides complete information about all of the fast-start failover and reinstatement requirements.</p>
</div>
<!-- class="sect3" -->
<div id="DGBKR3422" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref635"></a>
<h4 class="sect3"><span class="secnum">5.5.8.2</span> Restrictions on Reinstatement</h4>
<p>The broker cannot automatically reinstate the former primary database if:</p>
<ul>
<li>
<p>A fast-start failover occurred because a user-configurable condition was detected or was requested by an application by calling the <code dir="ltr">DBMS_DG.INITIATE_FS_FAILOVER</code> function.</p>
</li>
<li>
<p><code dir="ltr">FastStartFailoverAutoReinstate</code> is set to <code dir="ltr">FALSE</code></p>
</li>
<li>
<p>Another failover or switchover occurred <span class="italic">after</span> the fast-start failover completed but <span class="italic">before</span> the former primary database restarted</p>
</li>
<li>
<p>Fast-start failover was disabled</p>
</li>
<li>
<p>The observer cannot connect to the former primary database</p>
</li>
<li>
<p>The former primary database cannot connect to the new primary database</p>
</li>
<li>
<p>The former primary database and the new primary database are not configured in the same fast-start failover environment</p>
</li>
<li>
<p>The former primary database was disabled because of a manual failover when fast-start failover was disabled</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Standby databases that are disabled during switchover, manual failover, or fast-start failover will not be automatically reinstated.</div>
</li>
</ul>
<p>If automatic reinstatement fails, the broker will log errors and the former primary database will remain in the mounted state. At this point, you can either:</p>
<ul>
<li>
<p>Disable fast-start failover (described in <a href="#BCGJEGAF">Section 5.5.5</a>) and attempt to open the former primary database</p>
</li>
<li>
<p>Manually reinstate the former primary database, as described in <a href="#CHDEHEEF">Section 5.4.3</a></p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<a id="BCGICEGC"></a>
<div id="DGBKR3423" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.5.8.3</span> How the Broker Handles a Failed Reinstatement</h4>
<p>If a failure occurs once a reinstatement operation (automatic or manual) is underway, the broker logs the appropriate information in the broker configuration files and <a id="sthref636"></a><a id="sthref637"></a><a id="sthref638"></a>broker log files. The former primary database is disabled. Most in-progress failures cannot be restarted (for example, archived redo log file corruption on the primary database). You must manually re-create the database as a standby database and then reenable it.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDIEECD">Section 5.4.3.2, "How to Re-create and Reenable a Disabled Database"</a></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDJCDDB"></a>
<div id="DGBKR3424" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.5.9</span> Shutting Down Databases In a Fast-Start Failover Environment</h3>
<p>Perform the following steps if you need to <a id="sthref639"></a><a id="sthref640"></a><a id="sthref641"></a><a id="sthref642"></a>shut down the primary or standby databases:</p>
<ol>
<li>
<p>Stop the o<a id="sthref643"></a>bserver and wait for the <code dir="ltr">F<a id="sthref644"></a><a id="sthref645"></a>S_FAILOVER_OBSERVER_PRESENT</code> column in the <code dir="ltr">V$DATABASE</code> fixed view to contain the value "<code dir="ltr">NO</code>" for both the primary and target standby databases. This ensures that a fast-start failover will not occur while you are shutting down the primary database.</p>
</li>
<li>
<p>Shut down the primary database and the target standby database using either DGMGRL <code dir="ltr">SHUTDOWN</code> command or the SQL*Plus <code dir="ltr">SHUTDOWN</code> statement.</p>
</li>
</ol>
<p>When <a id="sthref646"></a><a id="sthref647"></a><a id="sthref648"></a>restarting the databases, you may restart them in any order. When both databases have been restarted, you may restart the observer.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDBHJIB"></a>
<div id="DGBKR3425" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">5.6</span> Database Client Considerations</h2>
<p>This section describes the event notification and database connection failover support that is available to database clients when a broker-managed failover occurs.</p>
<p>After a failover, the broker publishes Fast Application Notification (FAN) events. These FAN events can be used in the following ways:</p>
<ul>
<li>
<p>Applications can use FAN without programmatic changes if they use one of these Oracle integrated database clients: Oracle Database JDBC, Oracle Database Oracle Call Interface (OCI), and Oracle Data Provider for .NET ( ODP.NET). These clients can be configured for Fast Connection Failover (FCF) to automatically connect to a new primary database after a failover.</p>
</li>
<li>
<p>JAVA applications can use FAN programmatically by using the JDBC FAN application programming interface to subscribe to FAN events and to execute event handling actions upon the receipt of an event.</p>
</li>
<li>
<p>FAN server-side callouts can be configured on the database tier.</p>
</li>
</ul>
<p>FAN events are published using Oracle Notification Services (ONS) and Oracle Streams Advanced Queuing (AQ).</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
A single-instance database must be registered with Oracle Restart in order to publish FAN events via ONS.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink RACAD7128" href="../../rac.112/e41960/hafeats.htm#RACAD7128"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for more information about configuring FAN, FCF, and ONS on an Oracle Real Application Clusters (Oracle RAC) database</p>
</li>
<li>
<p><a class="olink ADMIN12721" href="../../server.112/e25494/restart.htm#ADMIN12721"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about configuring Oracle Restart, FAN, FCF, and ONS on a single-instance database</p>
</li>
</ul>
</div>
<div id="DGBKR3546" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref649"></a>
<h3 class="sect2"><span class="secnum">5.6.1</span> Data Guard Specific FAN and FCF Configuration Requirements</h3>
<p>This section describes configuration requirements that must be met in order to publish and properly handle FAN events generated as the result of a broker-managed failover.</p>
<p>These requirements are supplemental to those described in the documents previously referenced and in the following client-specific guides:</p>
<ul>
<li>
<p><a class="olink JJDBC" href="../../java.112/e16548/toc.htm"><span class="italic">Oracle Database JDBC Developer's Guide</span></a></p>
</li>
<li>
<p><a class="olink LNOCI" href="../../appdev.112/e10646/toc.htm"><span class="italic">Oracle Call Interface Programmer's Guide</span></a></p>
</li>
<li>
<p><a class="olink ODPNT" href="../../win.112/e23174/toc.htm"><span class="italic">Oracle Data Provider for .NET Developer's Guide</span></a></p>
</li>
</ul>
<div id="DGBKR3547" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref650"></a>
<h4 class="sect3"><span class="secnum">5.6.1.1</span> Oracle Net Configuration Requirements</h4>
<p>For FCF to occur, a client must be able to locate the new primary database after a failover. This section describes how to configure an Oracle Net connect descriptor that meets this requirement.</p>
<p>The connect descriptor can be configured in one of two ways:</p>
<ol>
<li>
<p>Configure the connect descriptor for connect-time failover. Add the primary database and each standby database to the address list. Set the <code dir="ltr">CONNECT_TIMEOUT</code> parameter to a small value to minimize the delay experienced if a network address is not available. Increase the value of this parameter if resource contention causes connection timeouts to occur during normal operation.</p>
<p>For example:</p>
<pre dir="ltr">
sales =
          (DESCRIPTION= 
            (FAILOVER=ON)
            (CONNECT_TIMEOUT=5)
            (ADDRESS_LIST=
              (ADDRESS=(HOST=boston-scan)(PORT=1521))
              (ADDRESS=(HOST=dallas-scan)(PORT=1521)))
            (CONNECT_DATA=(SERVICE_NAME=sales)))
</pre></li>
<li>
<p>Configure the connect descriptor with a single network name that is registered with a global naming service such as DNS or LDAP. Create a trigger based on the <code dir="ltr">DB_ROLE_CHANGE</code> system event that changes the network address associated with the network name to the network address of the new primary database after a failover.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink LNPLS20141" href="../../appdev.112/e25519/triggers.htm#LNPLS20141"><span class="italic">Oracle Database PL/SQL Language Reference</span></a> for more information about the <code dir="ltr">DB_ROLE_CHANGE</code> system event</p>
</li>
</ul>
</div>
</li>
</ol>
<p>The connect descriptor must contain the <code dir="ltr">SERVICE_NAME</code> parameter in either case.</p>
</div>
<!-- class="sect3" -->
<div id="DGBKR3548" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref651"></a>
<h4 class="sect3"><span class="secnum">5.6.1.2</span> Database Service Configuration Requirements</h4>
<div class="infobox-note">
<p class="notep1">Note:</p>
The examples shown in this section do not necessarily show the specific attributes you might need to use in your own environment. The required attributes vary depending on your configuration (including whether your environment is Oracle RAC-based or single-instance). Refer to the appropriate Oracle RAC or Oracle Restart documentation for further information.</div>
<p>Database services can be configured to be active in specific database roles on Oracle RAC databases and on single-instance databases managed by Oracle Restart. The broker interacts with Oracle Clusterware or Oracle Restart to ensure that the appropriate database services are active and that the appropriate FAN events are published after a role change.</p>
<p>FAN events are always published through ONS. However, the event notifying a failover is only published for database services that have been configured to be active while the database is in the primary role on the new primary database. Services can also be configured so that FAN events are published through AQ. You must explicitly enable FAN event publication through AQ if you have either OCI or ODP.NET clients because that is the FAN event notification mechanism that those clients use.</p>
<p>Services that must be active in any given database role (primary, physical standby, logical standby, or snapshot standby) must be configured with the SRVCTL utility explicitly on each database where the service must be active. In the following example commands, a service named <code dir="ltr">PAYROLL</code> is configured to be active in the <code dir="ltr">PRIMARY</code> role (<code dir="ltr">-l</code> option) on the primary database <code dir="ltr">NORTH</code>. The service is then configured to be active in the <code dir="ltr">PRIMARY</code> role on the standby database <code dir="ltr">SOUTH</code>, so that it will be active on that database after a role transition. FAN event notification through AQ is also enabled.</p>
<p>Execute the following on primary database <code dir="ltr">NORTH</code>:</p>
<pre dir="ltr">
srvctl add service &ndash;d NORTH &ndash;s PAYROLL &ndash;l PRIMARY -q TRUE -e SELECT -m BASIC -w 10 -z 150
</pre>
<p>Execute the following on standby database <code dir="ltr">SOUTH</code>:</p>
<pre dir="ltr">
srvctl add service &ndash;d SOUTH &ndash;s PAYROLL &ndash;l PRIMARY -q TRUE -e SELECT -m BASIC -w 10 -z 150
</pre>
<p>Services that are to be active while the database is in the physical standby role must also be created and started on the current primary database regardless of whether the service will be started on that database or not. This is to ensure that the service definition gets propagated to the physical standby database via the redo stream and thus allows for the service to be started on the physical standby database. The service can be started on the physical standby only after the redo generated by starting the service has been applied. It is important that the following SRVCTL add service options are specified and have the same values on all the databases:</p>
<div class="inftblhruleinformal">
<table class="cellalignment1489" title="SRVCTL Options in Broker" summary="SRVCTL Options in Broker" dir="ltr">
<thead>
<tr class="cellalignment1478">
<th class="cellalignment1490" id="r1c1-t44">Option</th>
<th class="cellalignment1490" id="r1c2-t44">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r2c1-t44" headers="r1c1-t44">-B</td>
<td class="cellalignment1484" headers="r2c1-t44 r1c2-t44">Goal for load balancing advisory</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r3c1-t44" headers="r1c1-t44">-x</td>
<td class="cellalignment1484" headers="r3c1-t44 r1c2-t44">Indicates whether distributed transaction processing should be enabled</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r4c1-t44" headers="r1c1-t44">-q</td>
<td class="cellalignment1484" headers="r4c1-t44 r1c2-t44">Indicates whether AQ HA notifications should be enabled</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r5c1-t44" headers="r1c1-t44">-m</td>
<td class="cellalignment1484" headers="r5c1-t44 r1c2-t44">Failover method</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r6c1-t44" headers="r1c1-t44">-e</td>
<td class="cellalignment1484" headers="r6c1-t44 r1c2-t44">Failover type</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r7c1-t44" headers="r1c1-t44">-z</td>
<td class="cellalignment1484" headers="r7c1-t44 r1c2-t44">Failover retries</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r8c1-t44" headers="r1c1-t44">-w</td>
<td class="cellalignment1484" headers="r8c1-t44 r1c2-t44">Failover delay</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r9c1-t44" headers="r1c1-t44">-j</td>
<td class="cellalignment1484" headers="r9c1-t44 r1c2-t44">Goal for connection load balancing</td>
</tr>
<tr class="cellalignment1478">
<td class="cellalignment1484" id="r10c1-t44" headers="r1c1-t44">-t</td>
<td class="cellalignment1484" headers="r10c1-t44 r1c2-t44">Edition name</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblhruleinformal" -->
<p>If all the databases do not have the same values, SRVCTL attempts to override the values, which will fail on the physical standby database because it is open read-only. In the following example, a service named <code dir="ltr">sales</code> is configured to be active in the <code dir="ltr">PHYSICAL_STANDBY</code> role (<code dir="ltr">-l</code> option) on the primary database <code dir="ltr">NORTH</code>. It is then started and stopped on the primary database. It could optionally also be removed from the primary database if there is no intention to ever run this service on the current primary database. It is then configured to be active in the <code dir="ltr">PHYSICAL_STANDBY</code> role on the physical standby database <code dir="ltr">SOUTH</code>.</p>
<p>Execute the following on primary database <code dir="ltr">NORTH</code>:</p>
<pre dir="ltr">
srvctl add service -d NORTH -s sales -l PHYSICAL_STANDBY -q TRUE -e SELECT -m BASIC -w 10 -z 150
srvctl start service &ndash;d NORTH &ndash;s sales
srvctl stop service &ndash;d NORTH &ndash;s sales
</pre>
<p>Execute the following on the physical standby database <code dir="ltr">SOUTH</code>:</p>
<pre dir="ltr">
srvctl add service -d SOUTH -s sales -l PHYSICAL_STANDBY -q TRUE -e SELECT -m BASIC -w 10 -z 150
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If the service has been configured to start automatically (<code dir="ltr">-y AUTOMATIC</code>), the service will automatically start only after a database role change.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p>For single-instance databases managed by Oracle Restart, see <a class="olink ADMIN12927" href="../../server.112/e25494/restart.htm#ADMIN12927"><span class="italic">Oracle Database Administrator's Guide</span></a> for more information about configuring database services with the SRVCTL utility</p>
</li>
<li>
<p>For Oracle RAC databases, see <a class="olink RACAD7737" href="../../rac.112/e41960/srvctladmin.htm#RACAD7737"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for more information about configuring database services with the SRVCTL utility</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<div id="DGBKR3549" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref652"></a>
<h4 class="sect3"><span class="secnum">5.6.1.3</span> ONS Configuration Requirements</h4>
<p>If a client-side ONS configuration is used, the client-side ONS configuration file must specify the hostname and port of the ONS daemon(s) of the primary database and each standby database.</p>
<p>If the client uses remote ONS subscription, the client must specify the hostname and port of the ONS daemon(s) of the primary database and each standby database.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1477">
<tr>
<td class="cellalignment1484">
<table class="cellalignment1482">
<tr>
<td class="cellalignment1481"><a href="dbresource.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1481"><a href="cli.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1486">
<table class="cellalignment1480">
<tr>
<td class="cellalignment1481"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1481"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1481"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1481"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1481"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1481"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
</body>
</html>
