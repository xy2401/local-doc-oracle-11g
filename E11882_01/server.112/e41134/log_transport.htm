<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Redo Transport Services</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 748" />
<meta name="dcterms.created" content="2014-02-25T8:43:1Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Data Guard Concepts and Administration" />
<meta name="dcterms.identifier" content="E41134-03" />
<meta name="dcterms.isVersionOf" content="SBYDB" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="protection.htm" title="Previous" type="text/html" />
<link rel="Next" href="log_apply.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e41134.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">14/34</span> <!-- End Header -->
<div id="SBYDB00400" class="chapter"><a id="g1296022"></a> <a id="i1148216"></a>
<h1 class="chapter"><span class="secnum">6</span> Redo Transport Services</h1>
<p><a id="sthref324"></a>This chapter describes how to configure and monitor Oracle redo transport services. The following topics are discussed:</p>
<ul>
<li>
<p><a href="#i1182869">Introduction to Redo Transport Services</a></p>
</li>
<li>
<p><a href="#BABDJJDA">Configuring Redo Transport Services</a></p>
</li>
<li>
<p><a href="#BEHBIGHF">Cascaded Redo Transport Destinations</a></p>
</li>
<li>
<p><a href="#BABDGGID">Monitoring Redo Transport Services</a></p>
</li>
<li>
<p><a href="#BABEBHHB">Tuning Redo Transport</a></p>
</li>
</ul>
<a id="i1182869"></a>
<div id="SBYDB4745" class="sect1">
<h2 class="sect1"><span class="secnum">6.1</span> Introduction to Redo Transport Services</h2>
<p><span class="bold">Redo transport services</span> performs the automated transfer of redo data between Oracle databases. The following redo transport destinations are supported:</p>
<ul>
<li>
<p>Oracle Data Guard standby databases</p>
<p>This guide describes how to create and manage standby databases.</p>
</li>
<li>
<p>Archive Log repository</p>
<p>This destination type is used for temporary offsite storage of archived redo log files. An archive log repository consists of an Oracle database instance and a physical standby control file. An archive log repository does not contain datafiles, so it cannot support role transitions.</p>
<p>The procedure used to create an archive log repository is identical to the procedure used to create a physical standby database, except for the copying of datafiles.</p>
</li>
<li>
<p>Oracle Streams downstream capture databases</p>
<p>See <a class="olink STRMS" href="../e17069/toc.htm"><span class="italic">Oracle Streams Concepts and Administration</span></a> for more information about Oracle Streams downstream capture databases.</p>
</li>
<li>
<p>Oracle Change Data Capture staging databases</p>
<p>See <a class="olink WBDOD" href="../../owb.112/e10582/toc.htm"><span class="italic">Oracle Warehouse Builder Sources and Targets Guide</span></a> for more information about Oracle Change Data Capture staging databases.</p>
</li>
</ul>
<p>An Oracle database can send redo data to up to thirty redo transport destinations. Each redo transport destination is individually configured to receive redo data via one of two redo transport modes:</p>
<ul>
<li>
<p>Synchronous</p>
<p>The synchronous redo transport mode transmits redo data synchronously with respect to transaction commitment. A transaction cannot commit until all redo generated by that transaction has been successfully sent to every enabled redo transport destination that uses the synchronous redo transport mode.</p>
<p>Note that although there is no limit on the distance between a primary database and a <code>SYNC</code> redo transport destination, transaction commit latency increases as network latency increases between a primary database and a <code>SYNC</code> redo transport destination.</p>
<p>This transport mode is used by the Maximum Protection and Maximum Availability data protection modes described in <a href="protection.htm#CHDEDGIF">Chapter 5, "Data Guard Protection Modes"</a>.</p>
</li>
<li>
<p>Asynchronous</p>
<p>The asynchronous redo transport mode transmits redo data asynchronously with respect to transaction commitment. A transaction can commit without waiting for the redo generated by that transaction to be successfully sent to any redo transport destination that uses the asynchronous redo transport mode.</p>
<p>This transport mode is used by the Maximum Performance data protection mode described in <a href="protection.htm#CHDEDGIF">Chapter 5, "Data Guard Protection Modes"</a>.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="BABDJJDA"></a>
<div id="SBYDB4746" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">6.2</span> Configuring Redo Transport Services</h2>
<p>This section describes how to configure<a id="sthref325"></a> redo transport services. The following topics are discussed:</p>
<ul>
<li>
<p><a href="#BABJEIFI">Redo Transport Security</a></p>
</li>
<li>
<p><a href="#BABCEEAI">Configuring an Oracle Database to Send Redo Data</a></p>
</li>
<li>
<p><a href="#BABHIDDA">Configuring an Oracle Database to Receive Redo Data</a></p>
</li>
</ul>
<p>The section is written at a level of detail that assumes that the reader has a thorough understanding of the following topics, which are described in the <a class="olink ADMIN" href="../e25494/toc.htm"><span class="italic">Oracle Database Administrator's Guide</span></a>, <a class="olink BRADV" href="../../backup.112/e10642/toc.htm"><span class="italic">Oracle Database Backup and Recovery User's Guide</span></a>, and <a class="olink NETAG" href="../../network.112/e41945/toc.htm"><span class="italic">Oracle Database Net Services Administrator's Guide</span></a>:</p>
<ul>
<li>
<p>Database administrator authentication</p>
</li>
<li>
<p>Database initialization parameters</p>
</li>
<li>
<p>Managing a redo log</p>
</li>
<li>
<p>Managing archived redo logs</p>
</li>
<li>
<p>Fast recovery areas</p>
</li>
<li>
<p>Oracle Net Configuration</p>
</li>
</ul>
<a id="BABJEIFI"></a>
<div id="SBYDB00523" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">6.2.1</span> Redo Transport Security</h3>
<p>Redo transport uses Oracle Net sessions to transport redo data. These redo transport sessions are authenticated<a id="sthref326"></a> using either the Secure Socket Layer (SSL) protocol or a remote login password file.</p>
<div id="SBYDB4747" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref327"></a>
<h4 class="sect3"><span class="secnum">6.2.1.1</span> Redo Transport Authentication Using SSL</h4>
<p>Secure Sockets Layer<a id="sthref328"></a> (SSL) is an industry standard protocol for securing network connections. SSL uses RSA public key cryptography and symmetric key cryptography to provide authentication, encryption, and data integrity. SSL is automatically used for redo transport authentication between two Oracle databases if:</p>
<ul>
<li>
<p>The databases are members of the same Oracle Internet Directory (OID) enterprise domain and that domain allows the use of current user database links.</p>
</li>
<li>
<p>The <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code>, and <code>FAL_SERVER</code> database initialization parameters that correspond to the databases use Oracle Net connect descriptors configured for SSL.</p>
</li>
<li>
<p>Each database has an Oracle wallet or a supported hardware security module that contains a user certificate with a distinguished name (DN) that matches the DN in the OID entry for the database.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ASOAG070" href="../../network.112/e40393/asossl.htm#ASOAG070"><span class="italic">Oracle Database Advanced Security Administrator's Guide</span></a> for more information about configuring SSL Authentication</p>
</li>
<li>
<p><a class="olink DBIMI130" href="../../network.112/e10744/adminste.htm#DBIMI130"><span class="italic">Oracle Database Enterprise User Security Administrator's Guide</span></a> for more information about administering enterprise domains</p>
</li>
<li>
<p><a class="olink OIDAG" href="http://www.oracle.com/pls/topic/lookup?ctx=db112&amp;id=OIDAG"><span class="italic">Oracle Fusion Middleware Administrator's Guide for Oracle Internet Directory</span></a> for information about administering Oracle Internet Directory</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<div id="SBYDB4748" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref329"></a>
<h4 class="sect3"><span class="secnum">6.2.1.2</span> Redo Transport Authentication Using a Password File</h4>
<p>If the SSL authentication requirements are not met, each database must use a remote login password<a id="sthref330"></a> file. In a Data Guard configuration, all physical and snapshot standby databases must use a copy of the password file from the primary database, and that copy must be refreshed whenever the <code>SYSOPER</code> or <code>SYSDBA</code> privilege is granted or revoked, and after the password of any user with these privileges is changed.</p>
<p>When a password file is used for redo transport authentication, the password of the user account used for redo transport authentication is compared between the database initiating a redo transport session and the target database. The password must be the same at both databases to create a redo transport session.</p>
<p>By default, the password of the <code>SYS</code> user is used to authenticate redo transport sessions when a password file is used. The <code>REDO_TRANSPORT_USER</code> database initialization parameter can be used to select a different user password for redo transport authentication by setting this parameter to the name of any user who has been granted the <code>SYSOPER</code> privilege. For administrative ease, Oracle recommends that the <code>REDO_TRANSPORT_USER</code> parameter be set to the same value on the redo source database and at each redo transport destination.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMIN001" href="../../server.112/e25494/dba.htm#ADMIN001"><span class="italic">Oracle Database Administrator's Guide</span></a> for more information creating and maintaining remote login password files</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BABCEEAI"></a>
<div id="SBYDB4749" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">6.2.2</span> Configuring an Oracle Database to Send Redo Data</h3>
<p>This section describes how to configure an Oracle database to send redo data<a id="sthref331"></a> to a redo transport destination.</p>
<p>The <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> database initialization parameter (where <code><span class="codeinlineitalic">n</span></code> is an integer from 1 to 31) is used to specify the location of a local archive redo log or to specify a redo transport destination. This section describes the latter use of this parameter.</p>
<p>There is a <code>LOG_ARCHIVE_DEST_STATE_</code><code><span class="codeinlineitalic">n</span></code> database initialization parameter (where <code><span class="codeinlineitalic">n</span></code> is an integer from 1 to 31) that corresponds to each <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> parameter. This parameter is used to enable or disable the corresponding redo destination. <a href="#BABGFCHH">Table 6-1</a> shows the valid values that can be assigned to this parameter.</p>
<div id="SBYDB5028" class="tblruleformal">
<p class="titleintable"><a id="sthref332"></a><a id="BABGFCHH"></a>Table 6-1 LOG_ARCHIVE_DEST_STATE_n Initialization Parameter Values</p>
<table class="cellalignment1823" title="LOG_ARCHIVE_DEST_STATE_n Initialization Parameter Values" summary="Describes the LOG_ARCHIVE_DEST_STATE_n parameter attributes: ENABLE, DEFER, ALTERNATE, and RESET." dir="ltr">
<thead>
<tr class="cellalignment1814">
<th class="cellalignment1824" id="r1c1-t4">Value</th>
<th class="cellalignment1824" id="r1c2-t4">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r2c1-t4" headers="r1c1-t4">
<p><code><a id="sthref333"></a><a id="sthref334"></a>ENABLE</code></p>
</td>
<td class="cellalignment1820" headers="r2c1-t4 r1c2-t4">
<p><a id="sthref335"></a><a id="sthref336"></a>Redo transport services can transmit redo data to this destination. This is the default.</p>
</td>
</tr>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r3c1-t4" headers="r1c1-t4">
<p><code><a id="sthref337"></a><a id="sthref338"></a>DEFER</code></p>
</td>
<td class="cellalignment1820" headers="r3c1-t4 r1c2-t4">
<p><a id="sthref339"></a><a id="sthref340"></a>Redo transport services will not transmit redo data to this destination.</p>
</td>
</tr>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r4c1-t4" headers="r1c1-t4">
<p><code><a id="sthref341"></a><a id="sthref342"></a>ALTERNATE</code></p>
</td>
<td class="cellalignment1820" headers="r4c1-t4 r1c2-t4">
<p>This destination will become enabled if communication to its associated destination fails.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblruleformal" -->
<p>A redo transport destination is configured by setting the <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> parameter to a character string that includes one or more attributes. This section briefly describes the most commonly used attributes. See <a href="log_arch_dest_param.htm#g1017491">Chapter 15</a> for a full description of all <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> parameter attributes.</p>
<p>The <code>SERVICE</code> attribute, which is a mandatory attribute for a redo transport destination, must be the first attribute specified in the attribute list. The SERVICE attribute is used to specify the Oracle Net service name used to connect to the redo transport destination. The service name must be resolvable through an Oracle Net naming method to an Oracle Net connect descriptor that matches the Oracle Net listener(s) at the redo transport destination. The connect descriptor must specify that a dedicated server connection be used, unless that is the default connection type for the redo transport destination.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink NETAG" href="../../network.112/e41945/toc.htm"><span class="italic">Oracle Database Net Services Administrator's Guide</span></a> for information about Oracle Net service names, connect descriptors, listeners, and network security</div>
<p>The <code>SYNC</code> attribute is used to specify that the synchronous redo transport mode be used to send redo data to a redo transport destination.</p>
<p>The <code>ASYNC</code> attribute is used to specify that the asynchronous redo transport mode be used to send redo data to a redo transport destination. The asynchronous redo transport mode will be used if neither the <code>SYNC</code> nor the <code>ASYNC</code> attribute is specified.</p>
<p>The <code>NET_TIMEOUT</code> attribute is used to specify how long the <code>LGWR</code> process will block waiting for an acknowledgement that redo data has been successfully received by a destination that uses the synchronous redo transport mode. If an acknowledgement is not received within <code>NET_TIMEOUT</code> seconds, the redo transport connection is terminated and an error is logged.</p>
<p>Oracle recommends that the <code>NET_TIMEOUT</code> attribute be specified whenever the synchronous redo transport mode is used, so that the maximum duration of a redo source database stall caused by a redo transport fault can be precisely controlled. See <a href="#BABIHAEB">Section 6.4.2</a> for information about monitoring synchronous redo transport mode response time.</p>
<p>The <code>AFFIRM</code> attribute is used to specify that redo received from a redo source database is not acknowledged until it has been written to the standby redo log. The <code>NOAFFIRM</code> attribute is used to specify that received redo is acknowledged without waiting for received redo to be written to the standby redo log.</p>
<p>The <code>DB_UNIQUE_NAME</code> attribute is used to specify the <code>DB_UNIQUE_NAME</code> of a redo transport destination. The <code>DB_UNIQUE_NAME</code> attribute must be specified if the <code>LOG_ARCHIVE_CONFIG</code> database initialization parameter has been defined and its value includes a <code>DG_CONFIG</code> list.</p>
<p>If the <code>DB_UNIQUE_NAME</code> attribute is specified, its value must match one of the <code>DB_UNIQUE_NAME</code> values in the <code>DG_CONFIG</code> list. It must also match the value of the <code>DB_UNIQUE_NAME</code> database initialization parameter at the redo transport destination. If either match fails, an error is logged and redo transport will not be possible to that destination.</p>
<p>The <code>VALID_FOR</code> attribute is used to specify when redo transport services transmits redo data to a redo transport destination. Oracle recommends that the <code>VALID_FOR</code> attribute be specified for each redo transport destination at every site in a Data Guard configuration so that redo transport services will continue to send redo data to all standby databases after a role transition, regardless of which standby database assumes the primary role.</p>
<p>The <code>REOPEN</code> attribute is used to specify the minimum number of seconds between automatic reconnect attempts to a redo transport destination that is inactive because of a previous error.</p>
<p>The <code>COMPRESSION</code> attribute is used to specify that redo data is transmitted to a redo transport destination in compressed form. Redo transport compression can significantly improve redo transport performance on network links with low bandwidth and high latency.</p>
<p>Redo transport compression is a feature of the Oracle Advanced Compression option. You must purchase a license for this option before using the redo transport compression feature.</p>
<p>The following example uses all of the <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> attributes described in this section. A <code>DB_UNIQUE_NAME</code> has been specified for both destinations, as has the use of compression. If a redo transport fault occurs at either destination, redo transport will attempt to reconnect to that destination, but not more frequently than once every 60 seconds.</p>
<pre>
DB_UNIQUE_NAME=BOSTON
LOG_ARCHIVE_CONFIG='DG_CONFIG=(BOSTON,CHICAGO,HARTFORD)' 
LOG_ARCHIVE_DEST_2='SERVICE=CHICAGO ASYNC NOAFFIRM VALID_FOR=(ONLINE_LOGFILE, 
PRIMARY_ROLE) REOPEN=60 COMPRESSION=ENABLE  DB_UNIQUE_NAME=CHICAGO' 
LOG_ARCHIVE_DEST_STATE_2='ENABLE' 
LOG_ARCHIVE_DEST_3='SERVICE=HARTFORD SYNC AFFIRM NET_TIMEOUT=30 
VALID_FOR=(ONLINE_LOGFILE,PRIMARY_ROLE) REOPEN=60 COMPRESSION=ENABLE   
DB_UNIQUE_NAME=HARTFORD' 
LOG_ARCHIVE_DEST_STATE_3='ENABLE'
</pre>
<div id="SBYDB4750" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref343"></a>
<h4 class="sect3"><span class="secnum">6.2.2.1</span> Viewing Attributes With V$ARCHIVE_DEST</h4>
<p>The <code>V$ARCHIVE_DEST</code> view can be queried to see the current settings and status for each redo transport destination.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BABHIDDA"></a>
<div id="SBYDB4751" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">6.2.3</span> Configuring an Oracle Database to Receive Redo Data</h3>
<p>This section describes how to configure a redo transport destination to receive<a id="sthref344"></a> and to archive redo data from a redo source database.</p>
<p>The following topics are discussed:</p>
<ul>
<li>
<p><a href="#BABCBEGJ">Creating and Managing a Standby Redo Log</a></p>
</li>
<li>
<p><a href="#BABEAJBG">Configuring Standby Redo Log Archival</a></p>
</li>
<li>
<p><a href="#CIHCFBEI">Cases Where Redo Is Written Directly To an Archived Redo Log File</a></p>
</li>
</ul>
<a id="BABCBEGJ"></a>
<div id="SBYDB4752" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">6.2.3.1</span> Creating and Managing a Standby Redo Log</h4>
<p>The synchronous and asynchronous redo transport modes require that a redo transport destination have a standby redo log. A standby redo log<a id="sthref345"></a> is used to store redo received from another Oracle database. Standby redo logs are structurally identical to redo logs, and are created and managed using the same SQL statements used to create and manage redo logs.</p>
<p>Redo received from another Oracle database via redo transport is written to the current standby redo log group by an RFS foreground process. When a log switch occurs on the redo source database, incoming redo is then written to the next standby redo log group, and the previously used standby redo log group is archived by an ARCn foreground process.</p>
<p>The process of sequentially filling and then archiving redo log file groups at a redo source database is mirrored at each redo transport destination by the sequential filling and archiving of standby redo log groups.</p>
<p>Each standby redo log file must be at least as large as the largest redo log file in the redo log of the redo source database. For administrative ease, Oracle recommends that all redo log files in the redo log at the redo source database and the standby redo log at a redo transport destination be of the same size.</p>
<p>The standby redo log must have at least one more redo log group than the redo log at the redo source database, for each redo thread at the redo source database. At the redo source database, query the <code>V$LOG</code> view to determine how many redo log groups are in the redo log at the redo source database and query the <code>V$THREAD</code> view to determine how many redo threads exist at the redo source database.</p>
<p>Perform the following query on a redo source database to determine the size of each log file and the number of log groups in the redo log:</p>
<pre>
SQL&gt; SELECT GROUP#, BYTES FROM V$LOG;
</pre>
<p>Perform the following query on a redo destination database to determine the size of each log file and the number of log groups in the standby redo log:</p>
<pre>
SQL&gt; SELECT GROUP#, BYTES FROM V$STANDBY_LOG;
</pre>
<p>Oracle recommends that a standby redo log be created on the primary database in a Data Guard configuration so that it is immediately ready to receive redo data following a switchover to the standby role.</p>
<p>The <code>ALTER DATABASE ADD STANDBY LOGFILE</code> SQL statement is used to create a standby redo log and to add standby redo log groups to an existing standby redo log.</p>
<p>For example, assume that the redo log on the redo source database has two redo log groups and that each of those contain one 500 MB redo log file. In this case, the standby redo log should have at least 3 standby redo log groups to satisfy the requirement that a standby redo log must have at least one more redo log group than the redo log at the redo source database.</p>
<p>The following SQL statements might be used to create a standby redo log that is appropriate for the previous scenario:</p>
<pre>
SQL&gt; ALTER DATABASE ADD STANDBY LOGFILE ('/oracle/dbs/slog1.rdo') SIZE 500M;
 
SQL&gt; ALTER DATABASE ADD STANDBY LOGFILE ('/oracle/dbs/slog2.rdo') SIZE 500M;
 
SQL&gt; ALTER DATABASE ADD STANDBY LOGFILE ('/oracle/dbs/slog3.rdo') SIZE 500M;
</pre>
<p>If the redo source database is an Oracle Real Applications Cluster (Oracle RAC) or Oracle One Node database, query the <code>V$LOG</code> view at the redo source database to determine how many redo threads exist and specify the corresponding thread numbers when adding redo log groups to the standby redo log.</p>
<p>For example, the following SQL statements might be used to create a standby redo log at a database that is to receive redo from a redo source database that has two redo threads:</p>
<pre>
SQL&gt; ALTER DATABASE ADD STANDBY LOGFILE THREAD 1 SIZE 500M;
SQL&gt; ALTER DATABASE ADD STANDBY LOGFILE THREAD 1 SIZE 500M;
SQL&gt; ALTER DATABASE ADD STANDBY LOGFILE THREAD 1 SIZE 500M;
SQL&gt; ALTER DATABASE ADD STANDBY LOGFILE THREAD 2 SIZE 500M;
SQL&gt; ALTER DATABASE ADD STANDBY LOGFILE THREAD 2 SIZE 500M;
SQL&gt; ALTER DATABASE ADD STANDBY LOGFILE THREAD 2 SIZE 500M;
</pre>
<div class="infobox-note">
<p class="notep1">Caution:</p>
Whenever a redo log group is added to a primary database, a log group must also be added to the standby redo log of each standby database in the configuration. Otherwise, the standby database may become unsynchronized after a primary log switch, which could temporarily prevent a zero data loss failover or cause a primary database operating in maximum protection mode to shut down.</div>
</div>
<!-- class="sect3" -->
<a id="BABEAJBG"></a>
<div id="SBYDB4753" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">6.2.3.2</span> Configuring Standby Redo Log Archival</h4>
<p>This section describes how to configure<a id="sthref346"></a><a id="sthref347"></a> standby redo log archival.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ADMIN" href="../e25494/toc.htm"><span class="italic">Oracle Database Administrator's Guide</span></a> for more information about managing archived redo logs</p>
</li>
<li>
<p><a class="olink BRADV" href="../../backup.112/e10642/toc.htm"><span class="italic">Oracle Database Backup and Recovery User's Guide</span></a> for more information about fast recovery areas</p>
</li>
</ul>
</div>
<div id="SBYDB5112" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref348"></a>
<h5 class="sect4"><span class="secnum">6.2.3.2.1</span> Enable Archiving</h5>
<p>If archiving is not enabled, issue the following statements to put the database in <code>ARCHIVELOG</code> mode and to enable automatic archiving:</p>
<pre>
SQL&gt; SHUTDOWN IMMEDIATE;
SQL&gt; STARTUP MOUNT;
SQL&gt; ALTER DATABASE ARCHIVELOG;
</pre>
<p>Note that the database must be in <code>ARCHIVELOG</code> mode for standby redo log archival to be performed.</p>
</div>
<!-- class="sect4" -->
<div id="SBYDB4754" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref349"></a>
<h5 class="sect4"><span class="secnum">6.2.3.2.2</span> Standby Redo Log Archival to a fast recovery area</h5>
<p>Take the following steps to set up standby redo log archival to a <a id="sthref350"></a><a id="sthref351"></a>fast recovery area:</p>
<ol>
<li>
<p>Set the <code>LOCATION</code> attribute of a <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> parameter to <code>USE_DB_RECOVERY_FILE_DEST</code>.</p>
</li>
<li>
<p>Set the <code>VALID_FOR</code> attribute of the same <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> parameter to a value that allows standby redo log archival.</p>
</li>
</ol>
<p>The following are some sample parameter values that might be used to configure a physical standby database to archive its standby redo log to the fast recovery area:</p>
<pre>
LOG_ARCHIVE_DEST_2 = 'LOCATION=USE_DB_RECOVERY_FILE_DEST
VALID_FOR=(STANDBY_LOGFILE,STANDBY_ROLE)'
LOG_ARCHIVE_DEST_STATE_2=ENABLE
</pre>
<p>Oracle recommends the use of a fast recovery area, because it simplifies the management of archived redo log files.</p>
</div>
<!-- class="sect4" -->
<div id="SBYDB4755" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref352"></a>
<h5 class="sect4"><span class="secnum">6.2.3.2.3</span> Standby Redo Log Archival to a Local FIle System Location</h5>
<p>Take the following steps to set up standby redo log archival to a local file system<a id="sthref353"></a><a id="sthref354"></a> location:</p>
<ol>
<li>
<p>Set the <code>LOCATION</code> attribute of a <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> parameter to a valid pathname.</p>
</li>
<li>
<p>Set the <code>VALID_FOR</code> attribute of the same <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> parameter to a value that allows standby redo log archival.</p>
</li>
</ol>
<p>The following are some sample parameter values that might be used to configure a physical standby database to archive its standby redo log to a local file system location:</p>
<pre>
LOG_ARCHIVE_DEST_2 = 'LOCATION = /disk2/archive
VALID_FOR=(STANDBY_LOGFILE,STANDBY_ROLE)'
LOG_ARCHIVE_DEST_STATE_2=ENABLE
</pre></div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="CIHCFBEI"></a>
<div id="SBYDB5113" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">6.2.3.3</span> Cases Where Redo Is Written Directly To an Archived Redo Log File</h4>
<p>Redo received by a standby database is written directly to an archived redo log file if a standby redo log group is not available or if the redo was sent to resolve a redo gap. When this occurs, redo is written to the location specified by the <code>LOCATION</code> attribute of one <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> parameter that is valid for archiving redo received from another database. The <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> parameter that is used for this purpose is determined when the standby database is mounted, and this choice is reevaluated each time a <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> parameter is modified.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BEHBIGHF"></a>
<div id="SBYDB5122" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">6.3</span> Cascaded Redo Transport Destinations<a id="sthref355"></a><a id="sthref356"></a></h2>
<div class="infobox-note">
<p class="notep1">Note:</p>
To use the Oracle Data Guard cascading redo transport destination feature described in this section, you should be using Oracle Database 11<span class="italic">g</span> Release 2 (11.2.0.2) or higher. Releases prior to 11.2.0.2 have several limitations for this feature that are not present in release 11.2.0.2 and higher.</div>
<p>A cascaded redo transport destination receives primary database redo indirectly from a standby database rather than directly from a primary database.</p>
<p>A standby database that cascades primary database redo to one or more cascaded destinations is known as a cascading standby database.</p>
<p>Cascading offloads the overhead associated with performing redo transport from a primary database to a cascading standby database.</p>
<p>A cascading standby database can cascade primary database redo to up to 30 cascaded destinations, each of which can be a physical, logical, or snapshot standby database.</p>
<p>Primary database redo is written to the standby redo log as it is received at a cascading standby database. The redo is not immediately cascaded however. It is cascaded after the standby redo log file that it was written to has been archived locally. A cascaded destination will therefore always have a greater redo transport lag, with respect to the primary database, than the cascading standby database.</p>
<p>Cascading has the following restrictions:<a id="sthref357"></a><a id="sthref358"></a></p>
<ul>
<li>
<p>A physical standby database is the only standby database type that can cascade redo</p>
</li>
<li>
<p>The Data Guard broker does not support cascaded destinations</p>
</li>
</ul>
<p>The rest of this section contains the following information:</p>
<ul>
<li>
<p><a href="#BEHDGBFH">Configuring a Cascaded Destination</a></p>
</li>
<li>
<p><a href="#BEHJFEDH">Data Protection Considerations</a></p>
</li>
<li>
<p><a href="#BEHHICCH">Cascading Scenarios</a></p>
</li>
</ul>
<a id="BEHDGBFH"></a>
<div id="SBYDB5123" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">6.3.1</span> Configuring a Cascaded Destination</h3>
<p>Perform the following steps to configure a cascaded destination:</p>
<ol>
<li>
<p>Select a physical standby database to configure as a cascading standby database.</p>
</li>
<li>
<p>On the cascading standby database, configure the <code>FAL_SERVER</code> attribute with the Oracle Net alias of the primary database or of a standby database that receives redo directly from the primary database.</p>
</li>
<li>
<p>On the cascading standby database, configure a <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> database initialization parameter for the cascaded destination. Configure the <code>SERVICE</code> attribute of this destination with the Oracle Net alias of the cascaded destination, and the <code>VALID</code> attribute to be valid for archival of the standby redo log while in the standby role.</p>
<p>If the <code>SYNC</code> or <code>ASYNC</code> redo transport attributes are specified, they are ignored.</p>
</li>
<li>
<p>At the cascaded destination, configure the <code>FAL_SERVER</code> database initialization parameter with the Oracle Net alias of the cascading standby database or of another standby database that is directly connected to the primary database. Although it is also possible to specify the primary database, this would defeat the purpose of cascading, which is to reduce the redo transport overhead on the primary database.</p>
</li>
<li>
<p><a href="#BEHHDCCI">Example 6-1</a> shows some of the database initialization parameters used by the members of a Data Guard configuration that includes a primary database named <code>boston</code> that sends redo to a local physical standby database named <code>boston2</code>, which then cascades primary database redo to a remote physical standby database named <code>denver</code>.</p>
<p>Note that a <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> database initialization parameter could also be configured on database <code>boston</code> that is valid for standby redo log archival to database <code>denver</code> when database <code>boston</code> is in the standby role. This would allow redo cascading to database <code>denver</code> to continue if a switchover is performed between database <code>boston</code> and database <code>boston2</code>.</p>
</li>
</ol>
<div id="SBYDB5124" class="example">
<p class="titleinexample"><a id="BEHHDCCI"></a>Example 6-1 Some of the Initialization Parameters Used When Cascading Redo</p>
<p><span class="bold">Primary</span> <span class="bold">Database</span></p>
<pre>
DB_UNIQUE_NAME=boston
 
FAL_SERVER=boston2
 
LOG_ARCHIVE_CONFIG='DG_CONFIG=(boston,boston2,denver)'
 
LOG_ARCHIVE_DEST_1='LOCATION=USE_DB_RECOVERY_FILE_DEST
VALID_FOR=(ALL_LOGFILES,ALL_ROLES) DB_UNIQUE_NAME=boston'
 
LOG_ARCHIVE_DEST_2='SERVICE=boston2 SYNC
VALID_FOR=(ONLINE_LOGFILES,PRIMARY_ROLE) DB_UNIQUE_NAME=boston2'
</pre>
<p><span class="bold">Cascading Physical Standby Database</span></p>
<pre>
DB_UNIQUE_NAME=boston2
 
FAL_SERVER=boston
 
LOG_ARCHIVE_CONFIG= 'DG_CONFIG=(boston,boston2,denver)'
 
LOG_ARCHIVE_DEST_1='LOCATION= USE_DB_RECOVERY_FILE_DEST
VALID_FOR=(ALL_LOGFILES,ALL_ROLES) DB_UNIQUE_NAME=boston2'
 
LOG_ARCHIVE_DEST_2= 'SERVICE=denver
VALID_FOR=(STANDBY_LOGFILES,STANDBY_ROLE) DB_UNIQUE_NAME=denver'
 
</pre>
<p><span class="bold">Cascaded Physical Standby Database</span></p>
<pre>
DB_UNIQUE_NAME=denver
 
FAL_SERVER=boston2
 
LOG_ARCHIVE_CONFIG='DG_CONFIG=(boston,boston2,denver)'
 
LOG_ARCHIVE_DEST_1='LOCATION= USE_DB_RECOVERY_FILE_DEST
VALID_FOR=(ALL_LOGFILES,ALL_ROLES) DB_UNIQUE_NAME=denver'
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<a id="BEHJFEDH"></a>
<div id="SBYDB5125" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">6.3.2</span> Data Protection Considerations<a id="sthref359"></a></h3>
<p>Oracle recommends that a standby database primarily intended for disaster recovery purposes receive redo data directly from the primary database. This will result in the highest level of data protection. A cascaded standby database can be used as a second line of defense, but by definition it will always have received less primary database redo than a standby database that is receiving redo directly from the primary.</p>
</div>
<!-- class="sect2" -->
<a id="BEHHICCH"></a>
<div id="SBYDB5126" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">6.3.3</span> Cascading Scenarios</h3>
<p>This section describes two typical cascading scenarios</p>
<ul>
<li>
<p><a href="#BEHFGAFJ">Cascading to a Physical Standby</a></p>
</li>
<li>
<p><a href="#BEHCIGCH">Cascading to Multiple Physical Standbys</a></p>
</li>
</ul>
<a id="BEHFGAFJ"></a>
<div id="SBYDB5127" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">6.3.3.1</span> Cascading to a Physical Standby</h4>
<p>In this scenario, you have a mission-critical primary database. This database has stringent performance and data protection requirements, so you have decided to deploy a local physical standby database to provide zero data loss protection and a remote, cascaded physical standby database to protect against regional disasters at the primary and local standby database sites.</p>
<p>You can achieve the objectives described above by performing the following steps:</p>
<ol>
<li>
<p>Create a physical standby database at a local site.</p>
</li>
<li>
<p>Create a physical standby database at a site that is sufficiently remote to provide protection against a regional disasters at the primary and local standby database sites.</p>
</li>
<li>
<p>Configure the local standby database as a <code>SYNC</code> redo transport destination of the primary database.</p>
</li>
<li>
<p>Configure the remote physical standby database as a cascaded destination of the local standby database.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="BEHCIGCH"></a>
<div id="SBYDB5128" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">6.3.3.2</span> Cascading to Multiple Physical Standbys</h4>
<p>In this scenario, you have a primary database in North America and you wish to deploy three replicas of this database in Europe to support read-only reporting applications. For cost and performance reasons, you do not wish to maintain network links from North America to each of your European sites.</p>
<p>You can achieve the objectives described above by performing the following steps:</p>
<ol>
<li>
<p>Create a network link between your North American site and one of your European sites.</p>
</li>
<li>
<p>Create a physical standby database at each of your European sites.</p>
</li>
<li>
<p>Open your physical standby databases in real-time query mode, as described in <a href="manage_ps.htm#i1017111">Section 9.2</a>.</p>
</li>
<li>
<p>Configure the physical standby database at the European endpoint of your transatlantic network link to cascade redo to your other European standby databases.</p>
</li>
<li>
<p>Configure the physical standby database at the European endpoint of your transatlantic network link as a cascaded destination of your primary database.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABDGGID"></a>
<div id="SBYDB4756" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">6.4</span> Monitoring Redo Transport Services</h2>
<p>This section discusses the following topics:</p>
<ul>
<li>
<p><a href="#BABBGDDF">Monitoring Redo Transport Status</a></p>
</li>
<li>
<p><a href="#BABIHAEB">Monitoring Synchronous Redo Transport Response Time</a></p>
</li>
<li>
<p><a href="#BABBFCDE">Redo Gap Detection and Resolution</a></p>
</li>
<li>
<p><a href="#BABBAGAD">Redo Transport Services Wait Events</a></p>
</li>
</ul>
<a id="BABBGDDF"></a>
<div id="SBYDB4757" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">6.4.1</span> Monitoring Redo Transport Status</h3>
<p>This section describes the steps used to monitor redo transport status<a id="sthref360"></a> on a redo source database.</p>
<dl>
<dd><a id="SBYDB5165"></a><a id="sthref361"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Determine the most recently archived redo log file.</dt>
<dd>
<p>Perform the following query on the redo source database to determine the most recently archived sequence number for each thread:</p>
<pre>
SQL&gt; SELECT MAX(SEQUENCE#), THREAD# FROM V$ARCHIVED_LOG -
&gt; WHERE RESETLOGS_CHANGE# = (SELECT MAX(RESETLOGS_CHANGE#) FROM V$ARCHIVED_LOG) -
&gt; GROUP BY THREAD#;
</pre></dd>
<dd><a id="SBYDB5166"></a><a id="sthref362"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Determine the most recently archived redo log file at each redo transport destination.</dt>
<dd>
<p>Perform the following query on the redo source database to determine the most recently archived redo log file at each redo transport destination:</p>
<pre>
SQL&gt; SELECT DESTINATION, STATUS, ARCHIVED_THREAD#, ARCHIVED_SEQ# -
&gt; FROM V$ARCHIVE_DEST_STATUS -
&gt; WHERE STATUS &lt;&gt; 'DEFERRED' AND STATUS &lt;&gt; 'INACTIVE';
 
DESTINATION         STATUS  ARCHIVED_THREAD#  ARCHIVED_SEQ#
------------------  ------  ----------------  -------------
/private1/prmy/lad   VALID                 1            947
standby1             VALID                 1            947
</pre>
<p>The most recently archived redo log file should be the same for each destination. If it is not, a status other than VALID may identify an error encountered during the archival operation to that destination.</p>
</dd>
<dd><a id="SBYDB5167"></a><a id="sthref363"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Find out if archived redo log files have been received at a redo transport destination.</dt>
<dd>
<p>A query can be performed at a redo source database to find out if an archived redo log file has been received at a particular redo transport destination. Each destination has an ID number associated with it. You can query the <code>DEST_ID</code> column of the <code>V$ARCHIVE_DEST</code> view on a database to identify each destination's ID number.</p>
<p>Assume that destination 1 points to the local archived redo log and that destination 2 points to a redo transport destination. Perform the following query at the redo source database to find out if any log files are missing at the redo transport destination:</p>
<pre>
SQL&gt; SELECT LOCAL.THREAD#, LOCAL.SEQUENCE# FROM -
&gt; (SELECT THREAD#, SEQUENCE# FROM V$ARCHIVED_LOG WHERE DEST_ID=1) -
&gt; LOCAL WHERE -
&gt; LOCAL.SEQUENCE# NOT IN -
&gt; (SELECT SEQUENCE# FROM V$ARCHIVED_LOG WHERE DEST_ID=2 AND -
&gt; THREAD# = LOCAL.THREAD#);
 
THREAD#    SEQUENCE#
---------  ---------
  1        12
  1        13
  1        14
</pre></dd>
<dd><a id="SBYDB5168"></a><a id="sthref364"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Trace the progression of redo transmitted to a redo transport destination.</dt>
<dd>
<p>Set the <code>LOG_ARCHIVE_TRACE</code> database initialization parameter at a redo source database and at each redo transport destination to trace redo transport progress. See <a href="trace.htm#g638947">Appendix F</a> for complete details and examples.</p>
</dd>
</dl>
</div>
<!-- class="sect2" -->
<a id="BABIHAEB"></a>
<div id="SBYDB00546" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">6.4.2</span> Monitoring Synchronous Redo Transport Response Time</h3>
<p>The <code>V$REDO_DEST_RESP_HISTOGRAM</code> view<a id="sthref365"></a> contains response time data for each redo transport destination. This response time data is maintained for redo transport messages sent via the synchronous redo transport mode.</p>
<p>The data for each destination consists of a series of rows, with one row for each response time. To simplify record keeping, response times are rounded up to the nearest whole second for response times less than 300 seconds. Response times greater than 300 seconds are round up to 600, 1200, 2400, 4800, or 9600 seconds.</p>
<p>Each row contains four columns: <code>FREQUENCY</code>, <code>DURATION</code>, <code>DEST_ID</code>, and <code>TIME</code>.</p>
<p>The <code>FREQUENCY</code> column contains the number of times that a given response time has been observed. The <code>DURATION</code> column corresponds to the response time. The <code>DEST_ID</code> column identifies the destination. The <code>TIME</code> column contains a timestamp taken when the row was last updated.</p>
<p>The response time data in this view is useful for identifying synchronous redo transport mode performance issues that can affect transaction throughput on a redo source database. It is also useful for tuning the <code>NET_TIMEOUT</code> attribute.</p>
<p>The next three examples show example queries for destination 2, which corresponds to the <code>LOG_ARCHIVE_DEST_2</code> parameter. To display response time data for a different destination, simply change the <code>DEST_ID</code> in the query.</p>
<p>Perform the following query on a redo source database to display the response time histogram for destination 2:</p>
<pre>
SQL&gt; SELECT FREQUENCY, DURATION FROM -
&gt; V$REDO_DEST_RESP_HISTOGRAM WHERE DEST_ID=2 AND FREQUENCY&gt;1;
</pre>
<p>Perform the following query on a redo source database to display the slowest response time for destination 2:</p>
<pre>
SQL&gt; SELECT max(DURATION) FROM V$REDO_DEST_RESP_HISTOGRAM -
&gt; WHERE DEST_ID=2 AND FREQUENCY&gt;1;
</pre>
<p>Perform the following query on a redo source database to display the fastest response time for destination 2:</p>
<pre>
SQL&gt; SELECT min( DURATION) FROM V$REDO_DEST_RESP_HISTOGRAM -
&gt; WHERE DEST_ID=2 AND FREQUENCY&gt;1;
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
The highest observed response time for a destination cannot exceed the highest specified <code>NET_TIMEOUT</code> value specified for that destination, because synchronous redo transport mode sessions are terminated if a redo transport destination does not respond to a redo transport message within <code>NET_TIMEOUT</code> seconds.</div>
</div>
<!-- class="sect2" -->
<a id="BABBFCDE"></a>
<div id="SBYDB00718" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">6.4.3</span> Redo Gap Detection and Resolution</h3>
<p>A redo gap<a id="sthref366"></a> occurs whenever redo transmission is interrupted. When redo transmission resumes, redo transport services<a id="sthref367"></a> automatically detects the redo gap and resolves it by sending the missing redo to the destination.</p>
<p>The time needed to resolve a redo gap is directly proportional to the size of the gap and inversely proportional to the effective throughput of the network link between the redo source database and the redo transport destination. Redo transport services has two options that may reduce redo gap resolution<a id="sthref368"></a> time when low performance network links are used:</p>
<ul>
<li>
<p>Redo Transport Compression</p>
<p>The <code>COMPRESSION</code> attribute of the <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> parameter is used to specify that redo data be compressed before transmission to the destination.</p>
</li>
<li>
<p>Parallel Redo Transport Network Sessions</p>
<p>The <code>MAX_CONNECTIONS</code> attribute of the <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> parameter can be used to specify that more than one network session be used to send the redo needed to resolve a redo gap.</p>
</li>
</ul>
<p>See <a href="log_arch_dest_param.htm#g1017491">Chapter 15, "LOG_ARCHIVE_DEST_n Parameter Attributes"</a> for more information about the <code>COMPRESSION</code> and <code>MAX_CONNECTIONS</code> attributes.</p>
<a id="BABIDDDC"></a>
<div id="SBYDB4758" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">6.4.3.1</span> Manual Gap Resolution</h4>
<p>In some situations, gap resolution cannot be performed automatically and it must be performed<a id="sthref369"></a> manually. For example, redo gap resolution must be performed manually on a logical standby database if the primary database is unavailable.</p>
<p>Perform the following query at the physical standby database to determine if there is redo gap on a physical standby database:</p>
<pre>
SQL&gt; SELECT * FROM V$ARCHIVE_GAP;

    THREAD# LOW_SEQUENCE# HIGH_SEQUENCE#
-----------  -------------  --------------
          1              7              10
</pre>
<p>The output from the previous example indicates that the physical standby database is currently missing log files from sequence 7 to sequence 10 for thread 1.</p>
<p>Perform the following query on the primary database to locate the archived redo log files on the primary database (assuming the local archive destination on the primary database is <code>LOG_ARCHIVE_DEST_1</code>):</p>
<pre>
SQL&gt; SELECT NAME FROM V$ARCHIVED_LOG WHERE THREAD#=1 AND -
&gt; DEST_ID=1 AND SEQUENCE# BETWEEN 7 AND 10;

NAME
--------------------------------------------------------------------------------
/primary/thread1_dest/arcr_1_7.arc 
/primary/thread1_dest/arcr_1_8.arc 
/primary/thread1_dest/arcr_1_9.arc
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
This query may return consecutive sequences for a given thread. In that case, there is no actual gap, but the associated thread was disabled and enabled within the time period of generating these two archived logs. The query also does not identify the gap that may exist at the tail end for a given thread. For instance, if the primary database has generated archived logs up to sequence 100 for thread 1, and the latest archived log that the logical standby database has received for the given thread is the one associated with sequence 77, this query will not return any rows, although we have a gap for the archived logs associated with sequences 78 to 100.</div>
<p>Copy these log files to the physical standby database and register them using the <code>ALTER DATABASE REGISTER LOGFILE</code>. For example:</p>
<pre>
SQL&gt; ALTER DATABASE REGISTER LOGFILE -
&gt; '/physical_standby1/thread1_dest/arcr_1_7.arc';

SQL&gt; ALTER DATABASE REGISTER LOGFILE -
&gt; '/physical_standby1/thread1_dest/arcr_1_8.arc';

SQL&gt; ALTER DATABASE REGISTER LOGFILE -
&gt; '/physical_standby1/thread1_dest/arcr_1_9.arc';
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code>V$ARCHIVE_GAP</code> view on a physical standby database only returns the gap that is currently blocking Redo Apply from continuing. After resolving the gap, query the <code>V$ARCHIVE_GAP</code> view again on the physical standby database to determine if there is another gap sequence. Repeat this process until there are no more gaps.</div>
<p>To determine if there is a redo gap on a logical standby database, query the <code>DBA_LOGSTDBY_LOG</code> view on the logical standby database. For example, the following query indicates there is a gap in the sequence of archived redo log files because it displays two files for THREAD 1 on the logical standby database. (If there are no gaps, the query will show only one file for each thread.) The output shows that the highest registered file is sequence number 10, but there is a gap at the file shown as sequence number 6:</p>
<pre>
SQL&gt; COLUMN FILE_NAME FORMAT a55
SQL&gt; SELECT THREAD#, SEQUENCE#, FILE_NAME FROM DBA_LOGSTDBY_LOG L -
&gt; WHERE NEXT_CHANGE# NOT IN -
&gt; (SELECT FIRST_CHANGE# FROM DBA_LOGSTDBY_LOG WHERE L.THREAD# = THREAD#) -
&gt; ORDER BY THREAD#, SEQUENCE#;
 
   THREAD#  SEQUENCE# FILE_NAME
---------- ---------- -----------------------------------------------
         1          6 /disk1/oracle/dbs/log-1292880008_6.arc
         1         10 /disk1/oracle/dbs/log-1292880008_10.arc
</pre>
<p>Copy the missing log files, with sequence numbers 7, 8, and 9, to the logical standby system and register them using the <code>ALTER DATABASE REGISTER LOGICAL LOGFILE</code> statement. For example:</p>
<pre>
SQL&gt; ALTER DATABASE REGISTER LOGICAL LOGFILE -
&gt; '/disk1/oracle/dbs/log-1292880008_7.arc'; 

SQL&gt; ALTER DATABASE REGISTER LOGICAL LOGFILE -
&gt; '/disk1/oracle/dbs/log-1292880008_8.arc';

SQL&gt; ALTER DATABASE REGISTER LOGICAL LOGFILE -
&gt; '/disk1/oracle/dbs/log-1292880008_9.arc';
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
A query based on the <code>DBA_LOGSTDBY_LOG</code> view on a logical standby database, as specified above, only returns the gap that is currently blocking SQL Apply from continuing. After resolving the gap, query the <code>DBA_LOGSTDBY_LOG</code> view again on the logical standby database to determine if there is another gap sequence. Repeat this process until there are no more gaps.</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BABBAGAD"></a>
<div id="SBYDB4759" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">6.4.4</span> Redo Transport Services Wait Events</h3>
<p><a href="#BABHDCCD">Table 6-2</a> lists several of the Oracle wait events used to track redo transport wait time on a redo source database. These wait events<a id="sthref370"></a><a id="sthref371"></a> are found in the <code>V$SYSTEM_EVENT</code> dynamic performance view.</p>
<p>For a complete list of the Oracle wait events used by redo transport, see the Oracle Data Guard Redo Transport and Network Best Practices white paper on the Oracle Maximum Availability Architecture (MAA) home page at:</p>
<p><code><a href="http://www.oracle.com/goto/maa/">http://www.oracle.com/goto/maa</a></code></p>
<div id="SBYDB5029" class="tblhruleformal">
<p class="titleintable"><a id="sthref372"></a><a id="BABHDCCD"></a>Table 6-2 Redo Transport Wait Events</p>
<table class="cellalignment1823" title="Redo Transport Wait Events" summary="Redo Transport Wait Events" dir="ltr">
<thead>
<tr class="cellalignment1814">
<th class="cellalignment1824" id="r1c1-t13">Wait Event</th>
<th class="cellalignment1824" id="r1c2-t13">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r2c1-t13" headers="r1c1-t13">
<p>LNS wait on ATTACH</p>
</td>
<td class="cellalignment1820" headers="r2c1-t13 r1c2-t13">
<p>Total time spent waiting for redo transport sessions to be established to all <code>ASYNC</code> and <code>SYNC</code> redo transport destinations</p>
</td>
</tr>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r3c1-t13" headers="r1c1-t13">
<p>LNS wait on SENDREQ</p>
</td>
<td class="cellalignment1820" headers="r3c1-t13 r1c2-t13">
<p>Total time spent waiting for redo data to be written to all <code>ASYNC</code> and <code>SYNC</code> redo transport destinations</p>
</td>
</tr>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r4c1-t13" headers="r1c1-t13">
<p>LNS wait on DETACH</p>
</td>
<td class="cellalignment1820" headers="r4c1-t13 r1c2-t13">
<p>Total time spent waiting for redo transport connections to be terminated to all <code>ASYNC</code> and <code>SYNC</code> redo transport destinations</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABEBHHB"></a>
<div id="SBYDB4760" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">6.5</span> Tuning Redo Transport</h2>
<p>The Oracle Data Guard Redo Transport and Network Configuration Best Practices white paper describes how to optimize redo transport for best performance. This paper is available on the Oracle Maximum Availability Architecture (MAA) home page at:</p>
<p><code><a href="http://www.oracle.com/goto/maa/">http://www.oracle.com/goto/maa</a></code></p>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1813">
<tr>
<td class="cellalignment1820">
<table class="cellalignment1818">
<tr>
<td class="cellalignment1817"><a href="protection.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1817"><a href="log_apply.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1822">
<table class="cellalignment1816">
<tr>
<td class="cellalignment1817"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1817"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1817"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1817"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1817"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1817"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
