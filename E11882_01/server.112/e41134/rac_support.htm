<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Data Guard and Oracle Real Application Clusters</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 748" />
<meta name="dcterms.created" content="2014-02-25T8:43:2Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Data Guard Concepts and Administration" />
<meta name="dcterms.identifier" content="E41134-03" />
<meta name="dcterms.isVersionOf" content="SBYDB" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="data_support.htm" title="Previous" type="text/html" />
<link rel="Next" href="rcmbackp.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e41134.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">31/34</span> <!-- End Header -->
<div id="SBYDB01700" class="appendix"><a id="g652033"></a> <a id="i641721"></a>
<h1 class="appendix"><span class="secnum">D</span> Data Guard and Oracle Real Application Clusters</h1>
<p>An Oracle Data Guard configuration can consist of any combination of single-instance and Oracle Real Application Clusters (Oracle RAC) multiple-instance databases. This chapter summarizes the configuration requirements and considerations that apply when using Oracle Data Guard with Oracle RAC databases. It contains the following sections:</p>
<ul>
<li>
<p><a href="#i635645">Configuring Standby Databases in an Oracle RAC Environment</a></p>
</li>
<li>
<p><a href="#i635649">Configuration Considerations in an Oracle RAC Environment</a></p>
</li>
<li>
<p><a href="#i636168">Troubleshooting</a></p>
</li>
</ul>
<a id="i635645"></a>
<div id="SBYDB4960" class="sect1">
<h2 class="sect1"><span class="secnum">D.1</span> Configuring Standby Databases in an Oracle RAC Environment</h2>
<p><a id="sthref1410"></a>You can configure a standby database to protect a primary database using <a id="sthref1411"></a>Oracle RAC. The following table describes the possible combinations of instances in the primary and standby databases:</p>
<div class="inftblruleinformal">
<table class="cellalignment1823" title="Primary and Standby Database Instance Configurations in a RAC" summary="Describes all possible combinations of single-instance and Real Application Clusters multi-instance databases in a Data Guard configuration." dir="ltr">
<thead>
<tr class="cellalignment1814">
<th class="cellalignment1824" id="r1c1-t2"><span class="bold">Instance Combinations</span></th>
<th class="cellalignment1824" id="r1c2-t2">Single-Instance Standby Database</th>
<th class="cellalignment1824" id="r1c3-t2">Multi-Instance Standby Database</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r2c1-t2" headers="r1c1-t2"><span class="bold">Single-instance primary database</span></td>
<td class="cellalignment1820" headers="r2c1-t2 r1c2-t2">Yes</td>
<td class="cellalignment1820" headers="r2c1-t2 r1c3-t2">Yes</td>
</tr>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r3c1-t2" headers="r1c1-t2"><span class="bold">Multi-instance primary database</span></td>
<td class="cellalignment1820" headers="r3c1-t2 r1c2-t2">Yes</td>
<td class="cellalignment1820" headers="r3c1-t2 r1c3-t2">Yes</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblruleinformal" -->
<p>In each scenario, each instance of the primary database transmits its redo data to an instance of the standby database.</p>
<div id="SBYDB4961" class="sect2"><a id="sthref1412"></a>
<h3 class="sect2"><span class="secnum">D.1.1</span> Setting Up a Multi-Instance Primary with a Single-Instance Standby</h3>
<p><a href="#i635256">Figure D-1</a> illustrates an Oracle RAC database with two primary database instances (a multi-instance primary database) transmitting redo data to a single-instance standby database.</p>
<div id="SBYDB5098" class="figure">
<p class="titleinfigure"><a id="i635256"></a>Figure D-1 Transmitting Redo Data from a Multi-Instance Primary Database</p>
<img width="591" height="408" src="img/sbydb056.gif" alt="Description of Figure D-1 follows" /><br />
<a id="sthref1413" href="img_text/sbydb056.htm">Description of "Figure D-1 Transmitting Redo Data from a Multi-Instance Primary Database"</a><br />
<br /></div>
<!-- class="figure" -->
<p>In this case, Instance 1 of the primary database archives redo data to local archived redo log files 1, 2, 3, 4, 5 and transmits the redo data to the standby database destination, while Instance 2 archives redo data to local archived redo log files 32, 33, 34, 35, 36 and transmits the redo data to the same standby database destination. The standby database automatically determines the correct order in which to apply the archived redo log files.</p>
<p class="subhead1"><a id="SBYDB5099"></a>To set up a <a id="sthref1414"></a><a id="sthref1415"></a>primary database in an Oracle RAC environment</p>
<p>Follow the instructions in <a href="create_ps.htm#g88234">Chapter 3</a> (for physical standby database creation) or <a href="create_ls.htm#g105412">Chapter 4</a> (for logical standby database creation) to configure each primary instance.</p>
<p class="subhead1"><a id="SBYDB5100"></a>To set up a single instance standby database</p>
<p>Follow the instructions in <a href="create_ps.htm#g88234">Chapter 3</a> (for physical standby database creation) or <a href="create_ls.htm#g105412">Chapter 4</a> (for logical standby database creation) to define the <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> and <code>LOG_ARCHIVE_FORMAT</code> parameters to specify the location of the archived redo log files and standby redo log files.</p>
</div>
<!-- class="sect2" -->
<div id="SBYDB4962" class="sect2"><a id="sthref1416"></a>
<h3 class="sect2"><span class="secnum">D.1.2</span> Setting Up Oracle RAC Primary and Standby Databases</h3>
<p><a id="i637663"></a>This section describes how to configure an Oracle RAC primary database to send redo data to an Oracle RAC standby database.</p>
<div id="SBYDB4963" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1417"></a>
<h4 class="sect3"><span class="secnum">D.1.2.1</span> Configuring an Oracle RAC Standby Database to Receive Redo Data</h4>
<p>Perform the following steps to configure an Oracle RAC standby database to receive redo data from a primary database:</p>
<ol>
<li>
<p>Create a standby redo log on the standby database. The redo log files in the standby redo log must reside in a location that can be accessed by all of the standby database instances, such as on a cluster file system or Oracle ASM instance. See <a href="log_transport.htm#BABCBEGJ">Section 6.2.3.1</a> for more information about creating a standby redo log.</p>
</li>
<li>
<p>Configure standby redo log archival on each standby database instance. The standby redo log must be archived to a location that can be accessed by all of the standby database instances, and every standby database instance must be configured to archive the standby redo log to the same location. See <a href="log_transport.htm#BABEAJBG">Section 6.2.3.2</a> for more information about configuring standby redo log archival.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<div id="SBYDB4964" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1418"></a>
<h4 class="sect3"><span class="secnum">D.1.2.2</span> Configuring an Oracle RAC Primary Database to Send Redo Data</h4>
<p>Configure each instance of the Oracle RAC primary database to send its redo data to the Oracle RAC standby database. <a href="log_transport.htm#BABCEEAI">Section 6.2.2</a> describes how to configure an Oracle database instance to send redo data to another database.</p>
<p>Oracle recommends the following best practices when configuring an Oracle RAC primary database to send redo data to an Oracle RAC standby database:</p>
<ol>
<li>
<p>Use the same <code>LOG_ARCHIVE_DEST_n</code> parameter on each primary database instance to send redo data to a given standby database.</p>
</li>
<li>
<p>Set the <code>SERVICE</code> attribute of each <code>LOG_ARCHIVE_DEST_n</code> parameter that corresponds to a given standby database to the same net service name.</p>
</li>
<li>
<p>The net service name should resolve to an Oracle Net connect descriptor that contains an address list, and that address list should contain connection data for each standby database instance.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i635649"></a>
<div id="SBYDB4965" class="sect1">
<h2 class="sect1"><span class="secnum">D.2</span> Configuration Considerations in an Oracle RAC Environment</h2>
<p>This section contains the Data Guard configuration information that is specific to Oracle RAC environments. It contains the following topics:</p>
<ul>
<li>
<p><a href="#i635201">Format for Archived Redo Log Filenames</a></p>
</li>
<li>
<p><a href="#i635213">Data Protection Modes</a></p>
</li>
<li>
<p><a href="#i635222">Role Transitions</a></p>
</li>
</ul>
<a id="i635201"></a>
<div id="SBYDB4966" class="sect2">
<h3 class="sect2"><span class="secnum">D.2.1</span> Format for Archived Redo Log Filenames</h3>
<p>The format for archived redo log filenames is in the form of log_%<span class="variable">parameter</span>, where %<span class="variable">parameter</span> can include one or more of the parameters in <a href="#g649139">Table D-1</a>.</p>
<div id="SBYDB5101" class="tblformal">
<p class="titleintable"><a id="sthref1419"></a><a id="g649139"></a>Table D-1 Directives for the LOG_ARCHIVE_FORMAT Initialization Parameter</p>
<table class="cellalignment1825" title="Directives for the LOG_ARCHIVE_FORMAT Initialization Parameter" summary="Describes the log_%parameter directives you set on the LOG_ARCHIVE_FORMAT initialization parameter to format archived redo log filenames." dir="ltr">
<thead>
<tr class="cellalignment1814">
<th class="cellalignment1824" id="r1c1-t3">Directives</th>
<th class="cellalignment1824" id="r1c2-t3">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r2c1-t3" headers="r1c1-t3">
<p><code>%a</code></p>
</td>
<td class="cellalignment1820" headers="r2c1-t3 r1c2-t3">
<p>Database activation ID.</p>
</td>
</tr>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r3c1-t3" headers="r1c1-t3">
<p><code>%A</code></p>
</td>
<td class="cellalignment1820" headers="r3c1-t3 r1c2-t3">
<p>Database activation ID, zero filled.</p>
</td>
</tr>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r4c1-t3" headers="r1c1-t3">
<p><code>%d</code></p>
</td>
<td class="cellalignment1820" headers="r4c1-t3 r1c2-t3">
<p>Database ID.</p>
</td>
</tr>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r5c1-t3" headers="r1c1-t3">
<p><code>%D</code></p>
</td>
<td class="cellalignment1820" headers="r5c1-t3 r1c2-t3">
<p>Database ID, zero filled.</p>
</td>
</tr>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r6c1-t3" headers="r1c1-t3">
<p><code>%t</code></p>
</td>
<td class="cellalignment1820" headers="r6c1-t3 r1c2-t3">
<p>Instance thread number.</p>
</td>
</tr>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r7c1-t3" headers="r1c1-t3">
<p><code>%T</code></p>
</td>
<td class="cellalignment1820" headers="r7c1-t3 r1c2-t3">
<p>Instance thread number, zero filled.</p>
</td>
</tr>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r8c1-t3" headers="r1c1-t3">
<p><code>%s</code></p>
</td>
<td class="cellalignment1820" headers="r8c1-t3 r1c2-t3">
<p>Log file sequence number.</p>
</td>
</tr>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r9c1-t3" headers="r1c1-t3">
<p><code>%S</code></p>
</td>
<td class="cellalignment1820" headers="r9c1-t3 r1c2-t3">
<p>Log file sequence number, zero filled.</p>
</td>
</tr>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r10c1-t3" headers="r1c1-t3">
<p><code>%r</code></p>
</td>
<td class="cellalignment1820" headers="r10c1-t3 r1c2-t3">
<p>Resetlogs ID.</p>
</td>
</tr>
<tr class="cellalignment1814">
<td class="cellalignment1820" id="r11c1-t3" headers="r1c1-t3">
<p><code>%R</code></p>
</td>
<td class="cellalignment1820" headers="r11c1-t3 r1c2-t3">
<p>Resetlogs ID, zero filled.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p>For example:</p>
<pre>
LOG_ARCHIVE_FORMAT = log%d_%t_%s_%r.arc
</pre>
<p>The thread parameters %t or %T are mandatory for Oracle RAC to uniquely identify the archived redo log files with the <code>LOG_ARCHIVE_FORMAT</code> parameter.</p>
</div>
<!-- class="sect2" -->
<a id="i635213"></a>
<div id="SBYDB4967" class="sect2">
<h3 class="sect2"><span class="secnum">D.2.2</span> Data Protection Modes</h3>
<p>If any instance of an Oracle RAC primary database loses connectivity with a standby database, all other primary database instances stop sending redo to the standby database for the number of seconds specified on the <code>LOG_ARCHIVE_DEST_</code><code><span class="codeinlineitalic">n</span></code> <code>REOPEN</code> attribute, after which all primary database instances attempt to reconnect to the standby database.</p>
<p>The following list describes the behavior of the protection modes in Oracle RAC environments:</p>
<ul>
<li>
<p>Maximum protection configuration</p>
<p>If a lo<a id="sthref1420"></a><a id="sthref1421"></a>st destination is the <span class="italic">last</span> participating <code>SYNC</code> destination, the instance loses connectivity and will be shut down. Other instances in an Oracle RAC configuration that still have connectivity to the standby destinations will recover the lost instance and continue sending to their standby destinations. Only when every instance in an Oracle RAC configuration loses connectivity to the last standby destination will the primary database be shut down.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="i635222"></a>
<div id="SBYDB4968" class="sect2">
<h3 class="sect2"><span class="secnum">D.2.3</span> Role Transitions</h3>
<p>This section contains information about switchovers.</p>
<a id="i641732"></a>
<div id="SBYDB4969" class="sect3">
<h4 class="sect3"><span class="secnum">D.2.3.1</span> Switchovers</h4>
<p>For an Oracle RAC database, only one primary instance can be active during a switchover when the target database is a physical standby. Therefore, before a switchover to a physical standby database, shut down all but one primary instance. After the switchover completes, restart the instances that were shut down during the switchover. This limitation does not exist when performing a switchover to a logical standby database.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The SQL <code>ALTER DATABASE</code> statement used to perform the switchover automatically creates redo log files if they do not already exist. Because this can significantly increase the time required to complete the <code>COMMIT</code> operation, Oracle recommends that you manually add redo log files when creating physical standby databases.</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i636168"></a>
<div id="SBYDB4971" class="sect1">
<h2 class="sect1"><span class="secnum">D.3</span> Troubleshooting</h2>
<p>This section provides help troubleshooting problems with Oracle RAC.</p>
<a id="i636145"></a>
<div id="SBYDB4972" class="sect2">
<h3 class="sect2"><span class="secnum">D.3.1</span> Switchover Fails in an Oracle RAC Configuration</h3>
<p>When your database is using Oracle RAC, active instances prevent a switchover from being performed. When other instances are active, an attempt to switch over fails with the following error message:</p>
<pre>
SQL&gt; ALTER DATABASE COMMIT TO SWITCHOVER TO STANDBY; 
<a id="sthref1422"></a><a id="sthref1423"></a>
ALTER DATABASE COMMIT TO SWITCHOVER TO STANDBY * 
ORA-01105: mount is incompatible with mounts by other instances 
</pre>
<p>Action: Query the <code>GV$INSTANCE</code> view as follows to determine which instances are causing the problem: <a id="sthref1424"></a><a id="sthref1425"></a></p>
<pre>
SQL&gt; SELECT INSTANCE_NAME, HOST_NAME FROM GV$INSTANCE - 
&gt; WHERE INST_ID &lt;&gt; (SELECT INSTANCE_NUMBER FROM V$INSTANCE);

INSTANCE_NAME HOST_NAME 
------------- --------- 
INST2         standby2 
</pre>
<p>In the previous example, the identified instance must be manually shut down before the switchover can proceed. You can connect to the identified instance from your instance and issue the <code>SHUTDOWN</code> statement remotely, for example:</p>
<pre>
SQL&gt; CONNECT SYS@standby2 AS SYSDBA
Enter Password:
SQL&gt; SHUTDOWN;
SQL&gt; EXIT
</pre></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="appendix" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1813">
<tr>
<td class="cellalignment1820">
<table class="cellalignment1818">
<tr>
<td class="cellalignment1817"><a href="data_support.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1817"><a href="rcmbackp.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1822">
<table class="cellalignment1816">
<tr>
<td class="cellalignment1817"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1817"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1817"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1817"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1817"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1817"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
