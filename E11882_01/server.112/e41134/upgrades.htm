<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Upgrading and Downgrading Databases in a Data Guard Configuration</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 748" />
<meta name="dcterms.created" content="2014-02-25T8:43:2Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Data Guard Concepts and Administration" />
<meta name="dcterms.identifier" content="E41134-03" />
<meta name="dcterms.isVersionOf" content="SBYDB" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="troubleshooting.htm" title="Previous" type="text/html" />
<link rel="Next" href="data_support.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e41134.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">29/34</span> <!-- End Header -->
<div id="SBYDB1200" class="appendix"><a id="CHDEGEBB"></a>
<h1 class="appendix"><span class="secnum">B</span> Upgrading and Downgrading Databases in a Data Guard Configuratio<a id="sthref1326"></a><a id="sthref1327"></a>n</h1>
<p>The procedures in this appendix describe how to upgrade and downgrade an Oracle database when a physical or logical standby database is present in the Data Guard configuration.</p>
<p>This appendix contains the following topics:</p>
<ul>
<li>
<p><a href="#CHDHHHHA">Before You Upgrade the Oracle Database Software</a></p>
</li>
<li>
<p><a href="#CHDBJAGG">Upgrading Oracle Database with a Physical Standby Database in Place</a></p>
</li>
<li>
<p><a href="#CHDGJIIA">Upgrading Oracle Database with a Logical Standby Database in Place</a></p>
</li>
<li>
<p><a href="#CIHJIICA">Modifying the COMPATIBLE Initialization Parameter After Upgrading</a></p>
</li>
<li>
<p><a href="#CIHCCHEE">Downgrading Oracle Database with No Logical Standby in Place</a></p>
</li>
<li>
<p><a href="#CIHBCHDF">Downgrading Oracle Database with a Logical Standby in Place</a></p>
</li>
</ul>
<a id="CHDHHHHA"></a>
<div id="SBYDB4931" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">B.1</span> Before You <a id="sthref1328"></a><a id="sthref1329"></a>Upgrade the Oracle Database Software</h2>
<p>Consider the following points before beginning to upgrade your Oracle Database software:</p>
<ul>
<li>
<p>If you are using the Data Guard broker to manage your configuration, follow the instructions in the <a class="olink DGBKR1200" href="../../server.112/e40771/upgrade_appx.htm#DGBKR1200"><span class="italic">Oracle Data Guard Broker</span></a> manual for information about removing or disabling the broker configuration.</p>
</li>
<li>
<p>The procedures in this appendix are to be used in conjunction with the ones contained in the <a class="olink UPGRD" href="../e23633/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a> for 11<span class="italic">g</span> Release 2 (11.2).</p>
</li>
<li>
<p>Check for nologging operations. If nologging operations have been performed then you must update the standby database. See <a href="scenarios.htm#i1015738">Section 13.4, "Recovering After the NOLOGGING Clause Is Specified"</a> for details.</p>
</li>
<li>
<p>Make note of any tablespaces or datafiles that need recovery due to <code>OFFLINE IMMEDIATE</code>. Tablespaces or datafiles should be recovered and either online or offline prior to upgrading.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="CHDBJAGG"></a>
<div id="SBYDB4932" class="sect1">
<h2 class="sect1"><span class="secnum">B.2</span> Upgrading Oracle Database with a Physical Standby Database<a id="sthref1330"></a> in Place</h2>
<p>Perform the following steps to upgrade to Oracle Database 11<span class="italic">g</span> Release 2 (11.2) when a physical standby database is present in the configuration:</p>
<ol>
<li>
<p>Review and perform the steps listed in the "Preparing to Upgrade" chapter of the <a class="olink UPGRD" href="../e23633/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a>.</p>
</li>
<li>
<p>Install the new release of the Oracle software into a new Oracle home on the physical standby database and primary database systems, as described in the <a class="olink UPGRD" href="../e23633/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a>.</p>
</li>
<li>
<p>Shut down the primary database.</p>
</li>
<li>
<p>Shut down the physical standby database(s).</p>
</li>
<li>
<p>Stop all listeners, agents, and other processes running in the Oracle homes that are to be upgraded. Perform this step on all nodes in an Oracle Real Application Clusters (Oracle RAC) environment.</p>
</li>
<li>
<p>If Oracle Automatic Storage Management (Oracle ASM) is in use, shut down all databases that use Oracle ASM, and then shut down all Oracle ASM instance(s).</p>
</li>
<li>
<p>In the new Oracle home, restart all listeners, agents, and other processes that were stopped in step 5.</p>
</li>
<li>
<p>Mount the physical standby database(s) on the new Oracle home (upgraded version). See <a href="create_ps.htm#i57454">Section 3.2.6</a> for information on how to start a physical standby database.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The standby database(s) should not be opened until the primary database upgrade is completed.</div>
</li>
<li>
<p>Start Redo Apply on the physical standby database(s). See <a href="create_ps.htm#i57454">Section 3.2.6</a> for information on how to start Redo Apply.</p>
</li>
<li>
<p>Upgrade the primary database as described in the <a class="olink UPGRD" href="../e23633/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a>. Note that the physical standby database(s) will be upgraded when the redo generated by the primary database as it is upgraded is applied.</p>
</li>
<li>
<p>Open the upgraded primary database.</p>
</li>
<li>
<p>If Active Data Guard was being used prior to the upgrade, then refer to <a href="manage_ps.htm#CHDGJEFF">Section 9.2.1</a> for information about how to reenable it after upgrading.</p>
</li>
<li>
<p>Optionally, modify the <code>COMPATIBLE</code> initialization parameter, following the procedure described in <a href="#CIHJIICA">Section B.4</a>.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CHDGJIIA"></a>
<div id="SBYDB4933" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">B.3</span> Upgrading Oracle Database with a Logical Standby Database<a id="sthref1331"></a> in Place</h2>
<div class="infobox-note">
<p class="notep1">Note:</p>
This appendix describes the traditional method for upgrading your Oracle Database software with a logical standby database in place. A second method in <a href="rollup.htm#BABGHIGF">Chapter 12, "Using SQL Apply to Upgrade the Oracle Database"</a> describes how to upgrade with a logical standby database in place in a rolling fashion to minimize downtime. Use the steps from only one method to perform the complete upgrade. Do not attempt to use both methods or to combine the steps from the two methods as you perform the upgrade process.
<p>The procedure described in this section assumes that the primary database is running in <code>MAXIMUM PERFORMANCE</code> data protection mode.</p>
</div>
<p>Perform the following steps to upgrade to Oracle Database 11<span class="italic">g</span> Release 2 (11.2) when a logical standby database is present in the configuration:</p>
<ol>
<li>
<p>Review and perform the steps listed in the "Preparing to Upgrade" chapter of the <a class="olink UPGRD" href="../e23633/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a>.</p>
</li>
<li>
<p>Set the data protection mode to <code>MAXIMUM PERFORMANCE</code> at the primary database, if needed:</p>
<pre>
SQL&gt; ALTER DATABASE SET STANDBY DATABASE TO MAXIMIZE PERFORMANCE;
</pre></li>
<li>
<p>On the primary database, stop all user activity and defer the remote archival destination associated with the logical standby database (for this procedure, it is assumed that <code>LOG_ARCHIVE_DEST_2</code> is associated with the logical standby database):</p>
<pre>
SQL&gt; ALTER SYSTEM SET LOG_ARCHIVE_DEST_STATE_2=DEFER SCOPE=BOTH;
SQL&gt; ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre></li>
<li>
<p>Stop SQL Apply on the logical standby database:</p>
<pre>
SQL&gt; ALTER DATABASE STOP LOGICAL STANDBY APPLY;
</pre></li>
<li>
<p>On the primary database install the newer release of the Oracle software as described in the <a class="olink UPGRD" href="../e23633/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a>.</p>
</li>
<li>
<p>On the logical standby database, install the newer release of the Oracle software as described in <a class="olink UPGRD" href="../e23633/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Steps 5 and 6 can be performed concurrently (in other words, the primary and the standby databases can be upgraded concurrently) to reduce downtime during the upgrade procedure.</div>
</li>
<li>
<p>On the upgraded logical standby database, restart SQL Apply. If you are using Oracle RAC, start up the other standby database instances:</p>
<pre>
SQL&gt; ALTER DATABASE START LOGICAL STANDBY APPLY IMMEDIATE;
</pre></li>
<li>
<p>Open the upgraded primary database and allow users to connect. If you are using Oracle RAC, start up the other primary database instances.</p>
<p>Also, enable archiving to the upgraded logical standby database, as follows:</p>
<pre>
SQL&gt; ALTER SYSTEM SET LOG_ARCHIVE_DEST_STATE_2=ENABLE;
</pre></li>
<li>
<p>Optionally, reset to the original data protection mode if you changed it in Step 2.</p>
</li>
<li>
<p>Optionally, modify the <code>COMPATIBLE</code> initialization parameter, following the procedure described in <a href="#CIHJIICA">Section B.4</a>.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CIHJIICA"></a>
<div id="SBYDB5129" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">B.4</span> Modifying the COMPATIBLE Initialization Parameter After Upgrading</h2>
<p>When you upgrade to a new release of Oracle Database, certain new features might make your database incompatible with your previous release. Oracle Database enables you to control the compatibility of your database with the <code>COMPATIBLE</code> initialization<a id="sthref1332"></a><a id="sthref1333"></a> parameter.</p>
<p>After the upgrade is complete, you can increase the setting of the <code>COMPATIBLE</code> initialization parameter to the maximum level for the new Oracle Database release. When you are certain that you no longer need the ability to downgrade your database back to its original version, set the <code>COMPATIBLE</code> initialization parameter based on the compatibility level you want for your new database.</p>
<p>In a Data Guard configuration, if you decide to increase the setting of the <code>COMPATIBLE</code> initialization parameter after upgrading, then it is important that you perform the following steps in the order shown (note that the standby database should have a <code>COMPATIBLE</code> setting equal to, or higher than, the primary):</p>
<ol>
<li>
<p>Increase the value of the <code>COMPATIBLE</code> initialization parameter on all standby databases in the configuration first, as follows:</p>
<ol>
<li>
<p>Ensure that apply is current on the standby database(s).</p>
</li>
<li>
<p>On one instance of each standby database, execute the following SQL statement:</p>
<pre>
ALTER SYSTEM SET COMPATIBLE=&lt;<span class="italic">value</span>&gt; SCOPE=SPFILE;
</pre></li>
<li>
<p>If Redo Apply or SQL Apply is running, then stop them.</p>
</li>
<li>
<p>Restart all instances of the standby database(s).</p>
</li>
<li>
<p>If you previously stopped Redo Apply or SQL Apply, then restart them.</p>
</li>
</ol>
</li>
<li>
<p>Increase the value of the <code>COMPATIBLE</code> initialization parameter on the primary database, as follows:</p>
<ol>
<li>
<p>On one instance of the primary database, execute the following SQL statement:</p>
<pre>
ALTER SYSTEM SET COMPATIBLE=&lt;<span class="italic">value</span>&gt; SCOPE=SPFILE;
</pre></li>
<li>
<p>Restart all instances of the primary database.</p>
</li>
</ol>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink UPGRD12472" href="../../server.112/e23633/intro.htm#UPGRD12472"><span class="italic">Oracle Database Upgrade Guide</span></a> for more information about compatibility settings</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CIHCCHEE"></a>
<div id="SBYDB5132" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">B.5</span> Downgrading Oracle Database with No Logical Standby in Place</h2>
<p>Perform the following steps to downgrade Oracle Database in a Data Guard configuration that does <span class="italic">not</span> contain a logical standby database:</p>
<ol>
<li>
<p>Ensure that all physical standby databases are mounted, but not open.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The standby database(s) should not be opened until all redo generated by the downgrade of the primary database has been applied.</div>
</li>
<li>
<p>Start Redo Apply, in real-time apply mode, on the physical standby database(s).</p>
</li>
<li>
<p>Downgrade the primary database using the procedure described in <a class="olink UPGRD007" href="../../server.112/e23633/downgrade.htm#UPGRD007"><span class="italic">Oracle Database Upgrade Guide</span></a>, keeping the following in mind:</p>
<ul>
<li>
<p>At each step of the downgrade procedure where a script is executed, execute the script only at the primary database. Do not perform the next downgrade step until all redo generated by the execution of the script at the primary database has been applied to each physical standby database.</p>
</li>
<li>
<p>At each step of the downgrade procedure where an action other than running a script is performed, perform the step at the primary database first and then at each physical standby database. Do not perform the next downgrade step at the primary database until the action has been performed at each physical standby database.</p>
</li>
</ul>
</li>
<li>
<p>If it becomes necessary to perform a failover during a downgrade, perform the failover and then continue with the downgrade procedure at the new primary database.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CIHBCHDF"></a>
<div id="SBYDB5133" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">B.6</span> Downgrading Oracle Database with a Logical Standby in Place<a id="sthref1334"></a></h2>
<p>Perform the following steps to downgrade Oracle Database in a Data Guard configuration that contains a logical standby database or a mixture of logical and physical standby databases.</p>
<ol>
<li>
<p>Issue the following command at the primary database (database P, for the sake of this discussion) before you downgrade it:</p>
<pre>
SQL&gt; ALTER DATABASE COMMIT TO SWITCHOVER TO LOGICAL STANDBY;
</pre>
<p>Database P is no longer in the primary database role.</p>
</li>
<li>
<p>Wait for <span class="italic">all</span> standby databases in the configuration to finish applying all available redo. To determine whether each standby database has finished applying all available redo, run the following query at each standby database:</p>
<pre>
SQL&gt; SELECT SWITCHOVER_STATUS FROM V$DATABASE;
 
SWITCHOVER_STATUS
-----------------
TO PRIMARY
</pre>
<p>Do not continue on to step 3 until the query returns a value of <code>TO PRIMARY</code> for all standby databases in the configuration.</p>
</li>
<li>
<p>Downgrade the logical standby databases using the procedures described in <a class="olink UPGRD007" href="../../server.112/e23633/downgrade.htm#UPGRD007"><span class="italic">Oracle Database Upgrade Guide</span></a>, keeping the following in mind:</p>
<ul>
<li>
<p>At each step of the downgrade procedure where a script is executed, execute the script only at the logical standby databases. Do not perform the next downgrade step until all redo generated by executing the script at the logical standby database that was most recently in the primary role (database P) has been applied to each physical standby database.</p>
</li>
<li>
<p>At each step of the downgrade procedure where an action other than running a script is performed, first perform the step at the logical standby database that was most recently in the primary role (database P), and then perform the step at each physical standby database. Do not perform the next downgrade step at the logical standby database that was most recently in the primary role (database P) until the action has been performed at each physical standby database.</p>
</li>
</ul>
</li>
<li>
<p>After the logical standby that was most recently in the primary role (database P) has been successfully downgraded, open it, and issue the following command:</p>
<pre>
SQL&gt; ALTER DATABASE ACTIVATE LOGICAL STANDBY DATABASE;
</pre>
<p>Database P is now back in the primary role.</p>
</li>
<li>
<p>At each of the logical standby databases in the configuration, issue the following command (note that the command requires that a database link back to the primary exist in all of the logical standby databases):</p>
<pre>
SQL&gt; ALTER DATABASE START LOGICAL STANDBY APPLY IMMEDIATE NEW PRIMARY
<span class="italic">prim_db_link</span>;
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink UPGRD" href="../e23633/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a></div>
</div>
<!-- class="sect1" --></div>
<!-- class="appendix" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1813">
<tr>
<td class="cellalignment1820">
<table class="cellalignment1818">
<tr>
<td class="cellalignment1817"><a href="troubleshooting.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1817"><a href="data_support.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1822">
<table class="cellalignment1816">
<tr>
<td class="cellalignment1817"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1817"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1817"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1817"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1817"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1817"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
