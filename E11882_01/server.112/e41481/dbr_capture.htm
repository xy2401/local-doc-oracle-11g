<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Capturing a Database Workload</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 740" />
<meta name="dcterms.created" content="2014-06-16T16:24:49Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Real Application Testing User's Guide" />
<meta name="dcterms.identifier" content="E41481-03" />
<meta name="dcterms.isVersionOf" content="RATUG" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2008, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="dbr_intro.htm" title="Previous" type="text/html" />
<link rel="Next" href="dbr_preprocess.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e41481.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">14/23</span> <!-- End Header -->
<div id="RATUG109" class="chapter"><a id="CACICAAC"></a>
<h1 class="chapter"><span class="secnum">9</span> Capturing a Database Workload</h1>
<p>This chapter describes how to capture a database workload on the production system. The first step in using <a id="sthref148"></a>Database Replay is to capture the production workload. For more information about how capturing a database workload fits within the Database Replay architecture, see <a href="dbr_intro.htm#CCHFFJAE">"Workload Capture"</a>.</p>
<p>This chapter contains the following sections:</p>
<ul>
<li>
<p><a href="#CACBJJIC">Prerequisites for Capturing a Database Workload</a></p>
</li>
<li>
<p><a href="#CACCGCFB">Workload Capture Options</a></p>
</li>
<li>
<p><a href="#CACCBADG">Workload Capture Restrictions</a></p>
</li>
<li>
<p><a href="#CACJDJAH">Enabling and Disabling the Workload Capture Feature</a></p>
</li>
<li>
<p><a href="#CACJFHGF">Enterprise Manager Privileges and Roles</a></p>
</li>
<li>
<p><a href="#CACGDCEA">Capturing a Database Workload Using Enterprise Manager</a></p>
</li>
<li>
<p><a href="#BABFBAIH">Capturing Workloads from Multiple Databases Concurrently</a></p>
</li>
<li>
<p><a href="#CACFJBIE">Monitoring a Workload Capture Using Enterprise Manager</a></p>
</li>
<li>
<p><a href="#CFHEEFBJ">Importing a Workload External to Enterprise Manager</a></p>
</li>
<li>
<p><a href="#CFHHAHBI">Creating Subsets from an Existing Workload</a></p>
</li>
<li>
<p><a href="#CFHGBJFH">Copying or Moving a Workload to a New Location</a></p>
</li>
<li>
<p><a href="#CACBCJAE">Capturing a Database Workload Using APIs</a></p>
</li>
<li>
<p><a href="#CACHJHJB">Monitoring Workload Capture Using Views</a></p>
</li>
</ul>
<a id="CACBJJIC"></a>
<div id="RATUG110" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">9.1</span> Prerequisites for Capturing a Database Workload</h2>
<p>Before starting a <a id="sthref149"></a>workload capture, you should have a strategy in place to restore the database on the test system. Before a workload can be replayed, the logical state of the application data on the replay system should be similar to that of the capture system when replay begins. To accomplish this, consider using one of the following methods:</p>
<ul>
<li>
<p>Recovery Manager (RMAN) <code>DUPLICATE</code> command</p>
</li>
<li>
<p>Snapshot standby</p>
</li>
<li>
<p>Data Pump Import and Export</p>
</li>
</ul>
<p>This will allow you to restore the database on the replay system to the application state as of the workload capture start time.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink BRADV010" href="../../backup.112/e10642/rcmdupdb.htm#BRADV010"><span class="italic">Oracle Database Backup and Recovery User's Guide</span></a> for information about duplicating a database using RMAN</p>
</li>
<li>
<p><a class="olink SBYDB00700" href="../../server.112/e41134/manage_ps.htm#SBYDB00700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for information about managing snapshot standby databases</p>
</li>
<li>
<p><a class="olink SUTIL100" href="../../server.112/e22490/dp_overview.htm#SUTIL100"><span class="italic">Oracle Database Utilities</span></a> for information about using Data Pump</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CACCGCFB"></a>
<div id="RATUG111" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">9.2</span> Workload Capture Options</h2>
<p>Proper planning before workload capture is required to ensure that the capture will be accurate and useful when replayed in another environment.</p>
<p>Before capturing a database workload, carefully consider the following <a id="sthref150"></a>options:</p>
<ul>
<li>
<p><a href="#CACHGFGI">Restarting the Database</a></p>
</li>
<li>
<p><a href="#CACHIAAA">Using Filters with Workload Capture</a></p>
</li>
<li>
<p><a href="#CACBCAJE">Setting Up the Capture Directory</a></p>
</li>
</ul>
<a id="CACHGFGI"></a>
<div id="RATUG112" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">9.2.1</span> Restarting the Database</h3>
<p>While this step is not required, Oracle recommends that the database be <a id="sthref151"></a>restarted before capturing the workload to ensure that ongoing and dependent transactions are allowed to be completed or rolled back before the capture begins. If the database is not restarted before the capture begins, transactions that are in progress or have yet to be committed will not be fully captured in the workload. Ongoing transactions will thus not be replayed properly, because only the part of the transaction whose calls were captured will be replayed. This may result in undesired replay divergence when the workload is replayed. Any subsequent transactions with dependencies on the incomplete transactions may also generate errors during replay. On a busy system, it is normal to see some replay divergence, but the replay can still be used to perform meaningful analysis of a system change if the diverged calls do not make up a significant portion of the replay in terms of DB time and other such key attributes.</p>
<p>Before restarting the database, determine an appropriate time to shut down the production database before the workload capture when it is the least disruptive. For example, you may want to capture a workload that begins at 8:00 a.m. However, to avoid service interruption during normal business hours, you may not want to restart the database during this time. In this case, you should consider starting the workload capture at an earlier time, so that the database can be restarted at a time that is less disruptive.</p>
<p>Once the database is restarted, it is important to start the workload capture before any user sessions reconnect and start issuing any workload. Otherwise, transactions performed by these user sessions will not be replayed properly in subsequent database replays, because only the part of the transaction whose calls were executed after the workload capture is started will be replayed. To avoid this problem, consider restarting the database in <code>RESTRICTED</code> mode using <code>STARTUP RESTRICT</code>, which will only allow the <code>SYS</code> user to login and start the workload capture. By default, once the workload capture begins, any database instance that are in <code>RESTRICTED</code> mode will automatically switch to <code>UNRESTRICTED</code> mode, and normal operations can continue while the workload is being captured.</p>
<p>Only one workload capture can be performed at any given time. If you have a Oracle Real Application Clusters (Oracle RAC) configuration, workload capture is performed for the entire database. To enable a clean state before starting to capture the workload, all the instances need to be restarted.</p>
<p class="subhead2"><a id="RATUG255"></a>To restart all instances in a Oracle RAC configuration before workload capture:</p>
<ol>
<li>
<p>Shut down all the instances.</p>
</li>
<li>
<p>Restart one of the instances.</p>
</li>
<li>
<p>Start workload capture.</p>
</li>
<li>
<p>Restart the rest of the instances.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ADMIN11146" href="../../server.112/e25494/start.htm#ADMIN11146"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about restricting access to an instance at startup</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CACHIAAA"></a>
<div id="RATUG113" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">9.2.2</span> Using Filters with Workload Capture</h3>
<p>By default, all user sessions are recorded during workload capture. You can use <a id="sthref152"></a>workload filters to specify which user sessions to include in or exclude from the workload during workload capture. There are two types of workload filters: inclusion filters and exclusion filters. You can use either inclusion filters or exclusion filters in a workload capture, but not both.</p>
<p><a id="sthref153"></a>Inclusion filters enable you to specify user sessions that will be captured in the workload. This is useful if you want to capture only a subset of the database workload.</p>
<p><a id="sthref154"></a>Exclusion filters enable you to specify user sessions that will not be captured in the workload. This is useful if you want to filter out session types that do not need to captured in the workload, such as those that monitor the infrastructure&mdash;like Oracle Enterprise Manager (EM) or Statspack&mdash;or other such processes that are already running on the test system. For example, if the system where the workload will be replayed is running EM, replaying captured EM sessions on the system will result in duplication of workload. In this case, you may want to use exclusion filters to filter out EM sessions.</p>
</div>
<!-- class="sect2" -->
<a id="CACBCAJE"></a>
<div id="RATUG114" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">9.2.3</span> Setting Up the Capture Directory</h3>
<p>Determine the location and set up a <a id="sthref155"></a>directory where the captured workload will be stored. Before starting the workload capture, ensure that the directory is empty and has ample disk space to store the workload. If the directory runs out of disk space during a workload capture, the capture will stop. To estimate the amount of disk space that is required, you can run a test capture on your workload for a short duration (such as a few minutes) to extrapolate how much space you will need for a full capture. To avoid potential performance issues, you should also ensure that the target replay directory is mounted on a separate file system.</p>
<p>For Oracle RAC, consider using a shared file system. Alternatively, you can set up one capture directory path that resolves to separate physical directories on each instance, but you will need to consolidate the files created in each of these directories into a single directory. The entire content of the local capture directories on each instance (not only the capture files) must be copied to the shared directory before it can be used for preprocessing or data masking. For example, assume that you are:</p>
<ul>
<li>
<p>Running a Oracle RAC environment in Linux with two database instances named <code>host1</code> and <code>host2</code></p>
</li>
<li>
<p>Using a capture directory object named <code>CAPDIR</code> that resolves to <code>/$ORACLE_HOME/rdbms/capture</code> on both instances</p>
</li>
<li>
<p>Using a shared directory that resides in <code>/nfs/rac_capture</code></p>
</li>
</ul>
<p>You will need to login into each host and run the following command:</p>
<pre>
cp -r /$ORACLE_HOME/rdbms/capture/* /nfs/rac_capture
</pre>
<p>After this is done for both instances, the <code>/nfs/rac_capture</code> shared directory is ready to be preprocessed or masked.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CACCBADG"></a>
<div id="RATUG115" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">9.3</span> Workload Capture Restrictions</h2>
<p><a id="sthref156"></a>Certain types of user sessions and client requests may sometimes be captured in a workload, but they are not supported by Database Replay. Capturing these session and request types in a workload may result in errors during workload replay.</p>
<p>The following types of user sessions and client requests are not supported by Database Replay:</p>
<ul>
<li>
<p>Direct path load of data from external files using utilities such as SQL*Loader</p>
</li>
<li>
<p>Non-PL/SQL based Advanced Queuing (AQ)</p>
</li>
<li>
<p>Flashback queries</p>
</li>
<li>
<p>Oracle Call Interface (OCI) based object navigations</p>
</li>
<li>
<p>Non SQL-based object access</p>
</li>
<li>
<p>Distributed transactions</p>
<p>Any distributed transactions that are captured will be replayed as local transactions.</p>
</li>
<li>
<p>XA transactions</p>
<p>XA transactions are not captured or replayed. All local transactions are captured.</p>
</li>
<li>
<p><code>JAVA_XA</code> transactions</p>
<p>If the workload uses the <code>JAVA_XA</code> package, <code>JAVA_XA</code> function and procedure calls are captured as normal PL/SQL workload. To avoid problems during workload replay, consider dropping the <code>JAVA_XA</code> package on the replay system to enable the replay to complete successfully.</p>
</li>
<li>
<p>Database Resident Connection Pooling (DRCP)</p>
</li>
<li>
<p>Workloads using OUT binds</p>
</li>
<li>
<p>Multi-threaded Server (MTS) and shared server sessions with synchronization mode set to <code>OBJECT_ID</code></p>
</li>
<li>
<p>Migrated sessions</p>
<p>The workload is captured for migrated sessions. However, user logins or session migration operations are not captured. Without a valid user login or session migration, the replay may cause errors because the workload may be replayed by a wrong user.</p>
</li>
</ul>
<p>Typically, Database Replay refrains from capturing these types of non-supported user sessions and client requests. Even when they are captured, Database Replay will not replay them. Therefore, it is usually not necessary to manually filter out non-supported user sessions and client requests. In cases where they are captured and found to cause errors during replay, consider using workload capture filters to exclude them from the workload.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CACHIAAA">"Using Filters with Workload Capture"</a> for information about using workload capture filters</p>
</li>
<li>
<p><a href="dbr_replay.htm#BABIFBHG">"Using Filters with Workload Replay"</a> for information about using workload replay filters</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CACJDJAH"></a>
<div id="RATUG116" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">9.4</span> Enabling and Disabling the Workload Capture Feature</h2>
<p>Database Replay supports capturing a database workload on a system running Oracle Database 10<span class="italic">g</span> Release 2 that can be used to test database upgrades to Oracle Database 11<span class="italic">g</span> and subsequent releases. By default, the workload capture feature is not enabled in Oracle Database 10<span class="italic">g</span> Release 2 (10.2). You can enable or disable this feature by specifying the <code>PRE_11G_ENABLE_CAPTURE</code> initialization parameter.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
It is only necessary to enable the workload capture feature if you are capturing a database workload on a system running Oracle Database 10<span class="italic">g</span> Release 2.
<p>If you are capturing a database workload on a system running Oracle Database 11<span class="italic">g</span> Release 1 or a later release, it is not necessary to enable the workload capture feature because it is enabled by default. Furthermore, the <code>PRE_11G_ENABLE_CAPTURE</code> initialization parameter is only valid with Oracle Database 10<span class="italic">g</span> Release 2 (10.2) and cannot be used with subsequent releases.</p>
</div>
<p>To enable the workload capture feature on a system running Oracle Database 10<span class="italic">g</span> Release 2, run the <code>wrrenbl.sql</code> script at the SQL prompt:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/wrrenbl.sql
</pre>
<p>The <code>wrrenbl.sql</code> script calls the <code>ALTER SYSTEM</code> SQL statement to set the <code>PRE_11G_ENABLE_CAPTURE</code> initialization parameter to <code>TRUE</code>. If a server parameter file (spfile) is being used, the <code>PRE_11G_ENABLE_CAPTURE</code> initialization parameter will be modified for the currently running instance and recorded in the spfile, so that the new setting will persist when the database is restarted. If a spfile is not being used, the <code>PRE_11G_ENABLE_CAPTURE</code> initialization parameter will only be modified for the currently running instance, and the new setting will not persist when the database is restarted. To make the setting persistent without using a spfile, you will need to manually specify the parameter in the initialization parameter file (<code>init.ora</code>).</p>
<p>To disable workload capture, run the <code>wrrdsbl.sql</code> script at the SQL prompt:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/wrrdsbl.sql
</pre>
<p>The <code>wrrdsbl.sql</code> script calls the <code>ALTER SYSTEM</code> SQL statement to set the <code>PRE_11G_ENABLE_CAPTURE</code> initialization parameter to <code>FALSE</code>. If a server parameter file (spfile) is being used, the <code>PRE_11G_ENABLE_CAPTURE</code> initialization parameter will be modified for the currently running instance and also recorded in the spfile, so that the new setting will persist when the database is restarted. If a spfile is not being used, the <code>PRE_11G_ENABLE_CAPTURE</code> initialization parameter will only be modified for the currently running instance, and the new setting will not persist when the database is restarted. To make the setting persistent without using a spfile, you will need to manually specify the parameter in the initialization parameter file (<code>init.ora</code>).</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code>PRE_11G_ENABLE_CAPTURE</code> initialization parameter can only be used with Oracle Database 10<span class="italic">g</span> Release 2 (10.2). This parameter is not valid in subsequent releases. After upgrading the database, you will need to remove the parameter from the server parameter file (spfile) or the initialization parameter file (<code>init.ora</code>); otherwise, the database will fail to start up.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink REFRN001" href="../../server.112/e40402/initparams_part.htm#REFRN001"><span class="italic">Oracle Database Reference</span></a> for more information about the <code>PRE_11G_ENABLE_CAPTURE</code> initialization parameter</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CACJFHGF"></a>
<div id="RATUG4206" class="sect1">
<h2 class="sect1"><span class="secnum">9.5</span> Enterprise Manager Privileges and Roles</h2>
<p>The Database Replay resource type privileges enable you to view or operate any Database Replay entities. Additionally, you need the target operator privilege for the target from which the workload was captured to access the entities associated with the workload. For a target that does not exist anymore, the Enterprise Manager user who owns the entities or the Enterprise Manager super user can still access the entities.</p>
<p>The two security roles discussed in the following sections make it easier to grant or revoke privileges related to Database Replay entities.</p>
<div id="RATUG4207" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref157"></a>
<h3 class="sect2"><span class="secnum">9.5.1</span> Database Replay Viewer Role</h3>
<p>Users who have the Database Replay Viewer role can view any Database Replay entity. By default, no Enterprise Manager user is granted this role. However, the EM_ALL_VIEWER role includes this role by default.</p>
<p>The Database Replay Viewer role consists of the following privilege:</p>
<ul>
<li>
<p>Database Replay Viewer (resource type privilege)</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<div id="RATUG4208" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref158"></a>
<h3 class="sect2"><span class="secnum">9.5.2</span> Database Replay Operator Role</h3>
<p>The Database Replay Operator role includes the Database Replay Viewer role and thus its privileges. Users who have the Database Replay Operator role can also edit and delete any Database Replay entity. By default, no Enterprise Manager user is granted this role. However, the EM_ALL_OPERATOR role includes this role by default.</p>
<p>The Database Replay Operator role consists of the following privileges:</p>
<ul>
<li>
<p>Database Replay Operator (resource type privilege)</p>
</li>
<li>
<p>Create new Named Credential (resource type privilege)</p>
</li>
<li>
<p>Create new job (resource type privilege)</p>
</li>
<li>
<p>Connect to any viewable target (target type privilege)</p>
</li>
<li>
<p>Execute Command Anywhere (target type privilege)</p>
</li>
</ul>
<p>To capture or replay a workload on a database target, an Enterprise Manager user needs all the privileges granted by the Database Replay Operator role plus the target operator privilege for the database target.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CACGDCEA"></a>
<div id="RATUG117" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">9.6</span> Capturing a Database Workload Using Enterprise Manager</h2>
<p>This section describes how to <a id="sthref159"></a>capture a database workload using Enterprise Manager. The primary tool for capturing database workloads is Oracle Enterprise Manager.</p>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
If Oracle Enterprise Manager is unavailable, you can capture database workloads using APIs, as described in <a href="#CACBCJAE">"Capturing a Database Workload Using APIs"</a>.</div>
<p class="subhead2"><a id="RATUG256"></a>To capture a database workload using Enterprise Manager:</p>
<ol>
<li>
<p>From the Enterprise menu of the Enterprise Manager Cloud Control console, select <span class="bold">Quality Management</span>, then <span class="bold">Database Replay</span>.</p>
<p>If the Database Login page appears, log in as a user with administrator privileges.</p>
<p>The Database Replay page appears.</p>
<img width="884" height="413" src="img/dbr.gif" alt="Description of dbr.gif follows" /><br />
<a id="sthref160" href="img_text/dbr.htm">Description of the illustration dbr.gif</a><br />
<br /></li>
<li>
<p>From the Database Replay page, click the <span class="bold">Captured Workloads</span> tab, then click <span class="bold">Create</span> in the toolbar.</p>
<p>The Create Capture: Plan Environment page appears.</p>
<img width="773" height="274" src="img/dbr_capture_plan_env.gif" alt="Description of dbr_capture_plan_env.gif follows" /><br />
<a id="sthref161" href="img_text/dbr_capture_plan_env.htm">Description of the illustration dbr_capture_plan_env.gif</a><br />
<br /></li>
<li>
<p>Verify that you have met both prerequisites described on this page, then enable both checkboxes and click <span class="bold">Next</span>.</p>
<p>The Create Capture: Database page appears.</p>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
For information about the prerequisites, see <a href="#CACBJJIC">"Prerequisites for Capturing a Database Workload"</a>.</div>
<img width="769" height="346" src="img/dbr_capture_databases.gif" alt="Description of dbr_capture_databases.gif follows" /><br />
<a id="sthref162" href="img_text/dbr_capture_databases.htm">Description of the illustration dbr_capture_databases.gif</a><br />
<br /></li>
<li>
<p>Click <span class="bold">Add</span>.</p>
<p>The Add pop-up appears.</p>
</li>
<li>
<p>Provide a capture name, provide an optional description, then click the Target Database search icon.</p>
<p>The Search and Select: Targets pop-up appears.</p>
<img width="562" height="516" src="img/dbr_capture_select_db.gif" alt="Description of dbr_capture_select_db.gif follows" /><br />
<a id="sthref163" href="img_text/dbr_capture_select_db.htm">Description of the illustration dbr_capture_select_db.gif</a><br />
<br /></li>
<li>
<p>Choose a target database from the list, then click <span class="bold">Select</span>.</p>
<p>The Add pop-up reappears with added sections for Database Credential and Database Host Credential.</p>
</li>
<li>
<p>Provide database credentials, database host credentials, a Database Capture Intermediate Storage Location, then click <span class="bold">OK</span>.</p>
<ul>
<li>
<p>The capture database places the capture files in the intermediate storage location. After the capture, the files are copied to the storage location. For captures on an Oracle RAC database, Enterprise Manager only supports Oracle RAC configured with a shared file system.</p>
</li>
</ul>
<img width="793" height="428" src="img/dbr_capture_add_db.gif" alt="Description of dbr_capture_add_db.gif follows" /><br />
<a id="sthref164" href="img_text/dbr_capture_add_db.htm">Description of the illustration dbr_capture_add_db.gif</a><br />
<br />
<p>The selected target database now appears in the list of databases in the Select Production Databases table.</p>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
<p>The <span class="bold">Create Capture:</span> Options page appears.</p>
<img width="890" height="464" src="img/dbr_capture_options.gif" alt="Description of dbr_capture_options.gif follows" /><br />
<a id="sthref165" href="img_text/dbr_capture_options.htm">Description of the illustration dbr_capture_options.gif</a><br />
<br /></li>
<li>
<p>Select the workload capture options:</p>
<ul>
<li>
<p>Under the SQL Performance Analyzer section, select whether to capture SQL statements into a SQL tuning set during workload capture.</p>
<p>While Database Replay provides an analysis of how a change affects your entire system, you can use a SQL tuning set in conjunction with the SQL Performance Analyzer to gain a more SQL-centric analysis of how the change affects SQL statements and execution plans.</p>
<p>By capturing a SQL tuning set during workload capture and another SQL tuning set during workload replay, you can use the SQL Performance Analyzer to compare these SQL tuning sets to each other without having to re-execute the SQL statements. This enables you to obtain a SQL Performance Analyzer report and compare the SQL performance, before and after changes, while running Database Replay.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Capturing SQL statements into a SQL Tuning Set is the default, and is the recommended workload capture option. Capturing SQL statements into a SQL Tuning Set is not available for Oracle RAC.</div>
</li>
<li>
<p>Under the Workload Filters section, select whether to use exclusion filters by selecting <span class="bold">Exclusion</span> in the Filter Mode list, or inclusion filters by selecting <span class="bold">Inclusion</span> in the Filter Mode list.</p>
<p>To add filters, click <span class="bold">Add</span> and enter the filter name, session attribute, and value in the corresponding fields.</p>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
For more information, see <a href="#CACHIAAA">"Using Filters with Workload Capture"</a>.</div>
</li>
</ul>
<p>After selecting the desired workload capture options, click <span class="bold">Next</span>.</p>
<p>The Create Capture: Storage page appears.</p>
<img width="770" height="206" src="img/dbr_capture_storage.gif" alt="Description of dbr_capture_storage.gif follows" /><br />
<a id="sthref166" href="img_text/dbr_capture_storage.htm">Description of the illustration dbr_capture_storage.gif</a><br />
<br /></li>
<li>
<p>Click the Storage Host icon, choose a target from the list, then click <span class="bold">Select</span>.</p>
<p>The Storage page now requests Host Credentials and a Storage Location.</p>
</li>
<li>
<p>Provide Host Credentials, click <span class="bold">Browse</span> to select a Storage Location, select the location and click <span class="bold">OK</span>, then click <span class="bold">Next</span>.</p>
<p>The Create Capture: Schedule page appears.</p>
<img width="770" height="287" src="img/dbr_capture_schedule.gif" alt="Description of dbr_capture_schedule.gif follows" /><br />
<a id="sthref167" href="img_text/dbr_capture_schedule.htm">Description of the illustration dbr_capture_schedule.gif</a><br />
<br /></li>
<li>
<p>Schedule the starting time and duration for the capture, schedule the exporting of AWR data, then click <span class="bold">Next</span>.</p>
<ul>
<li>
<p>The default capture duration is 5 minutes. Change the capture duration to capture representative activity over a time period of interest that needs to be tested.</p>
</li>
</ul>
<p>The Create Capture: Review page appears.</p>
<img width="889" height="620" src="img/dbr_capture_review.gif" alt="Description of dbr_capture_review.gif follows" /><br />
<a id="sthref168" href="img_text/dbr_capture_review.htm">Description of the illustration dbr_capture_review.gif</a><br />
<br /></li>
<li>
<p>If all of the parameters appear as you have intended, click <span class="bold">Submit</span> to start the capture job.</p>
<ul>
<li>
<p>The "Capture SQL statements into a SQL Tuning Set during workload capture" option is enabled by default. Uncheck this option if you do not want to compare SQL tuning sets at the end of the Replay.</p>
</li>
</ul>
<p>The Database Replay page reappears, displays a message that the capture was created successfully, and displays the status of the capture in the Captures list, such as "Scheduled."</p>
</li>
<li>
<p>For detailed information about the capture, double-click the name of the capture.</p>
<p>The Capture Summary page appears, and displays several attributes, including the average active sessions, a workload comparison, and related concurrent captures, if any.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
After capturing a workload on the production system, you need to preprocess the captured workload, as described in <a href="dbr_preprocess.htm#CHDHCAHI">Chapter 10, "Preprocessing a Database Workload"</a>.</div>
</div>
<!-- class="sect1" -->
<a id="BABFBAIH"></a>
<div id="RATUG4124" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">9.7</span> Capturing Workloads from Multiple Databases Concurrently</h2>
<p>Concurrent capture refers to capturing the workload on multiple databases simultaneously.</p>
<p class="orderedlisttitle">To capture a concurrent database replay workload:&nbsp;</p>
<ol>
<li>
<p>From the Enterprise menu of the Enterprise Manager Cloud Control console, select <span class="bold">Quality Management</span>, then <span class="bold">Database Replay</span>.</p>
<p>If the Database Login page appears, log in as a user with administrator privileges.</p>
<p>The Database Replay page appears.</p>
</li>
<li>
<p>From the Database Replay page, click the <span class="bold">Captured</span> <span class="bold">Workloads</span> tab, then click <span class="bold">Create</span> in the toolbar.</p>
<p>The Create Capture: Plan Environment page appears.</p>
</li>
<li>
<p>Make sure that you have met both prerequisites described on this page, then enable both checkboxes and click <span class="bold">Next</span>.</p>
<p>The Create Capture: Database page appears.</p>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
For information about the prerequisites, see <a href="#CACBJJIC">"Prerequisites for Capturing a Database Workload"</a>.</div>
</li>
<li id="BABGGAGG">
<p>Click <span class="bold">Add</span>.</p>
<p>The Add pop-up appears.</p>
</li>
<li>
<p>Provide a Capture name, provide an optional description, then click the Target Database search icon.</p>
<p>The Search and Select: Targets pop-up appears.</p>
</li>
<li>
<p>Choose a target database from the list, then click <span class="bold">Select</span>.</p>
<p>The Add pop-up reappears with added sections for Database Credential and Database Host Credential.</p>
</li>
<li id="BABIDAGC">
<p>Provide database credentials, database host credentials, a Database Capture Intermediate Storage Location, then click <span class="bold">OK</span>.</p>
<ul>
<li>
<p>The Capture database places the Capture files in the intermediate storage location. After the Capture, the files are copied to the storage location.</p>
</li>
</ul>
<p>The selected target database now appears in the list of databases in the Select Production Databases table.</p>
</li>
<li>
<p>Add another database for concurrent capture:</p>
<ol>
<li>
<p>Follow the instructions in steps <a href="#BABGGAGG">4</a> through <a href="#BABIDAGC">7</a>.</p>
<p>The Create Capture: Database page reappears, and displays the additional database for capture along with the first database you specified in steps <a href="#BABGGAGG">4</a> through <a href="#BABIDAGC">7</a>.</p>
</li>
<li>
<p>Provide a name and optional description for the concurrent capture, then click <span class="bold">Next</span>.</p>
<p>The Create Capture: Options page appears.</p>
</li>
</ol>
</li>
<li>
<p>Select the workload capture options:</p>
<ul>
<li>
<p>Under the SQL Performance Analyzer section, select whether to capture SQL statements into a SQL tuning set during workload capture.</p>
<p>While Database Replay provides an analysis of how a change affects your entire system, you can use a SQL tuning set in conjunction with the SQL Performance Analyzer to gain a more SQL-centric analysis of how the change affects SQL statements and execution plans.</p>
<p>By capturing a SQL tuning set during workload capture and another SQL tuning set during workload replay, you can use the SQL Performance Analyzer to compare these SQL tuning sets to each other without having to re-execute the SQL statements. This enables you to obtain a SQL Performance Analyzer report and compare the SQL performance, before and after changes, while running Database Replay.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Capturing SQL statements into a SQL tuning set is the default and recommended workload capture option.</div>
</li>
<li>
<p>Under the Workload Filters section, select whether to use exclusion filters by selecting <span class="bold">Exclusion</span> in the Filter Mode list, or inclusion filters by selecting <span class="bold">Inclusion</span> in the Filter Mode list.</p>
<p>To add filters, click <span class="bold">Add</span> and enter the filter name, session attribute, and value in the corresponding fields.</p>
</li>
</ul>
<p>After selecting the desired workload capture options, click <span class="bold">Next</span>.</p>
<p>The Create Capture: Storage page appears.</p>
</li>
<li>
<p>Click the Storage Host icon, choose a target from the list, then click <span class="bold">Select</span>.</p>
<p>The Storage page now requests Host Credentials and a Storage Location.</p>
</li>
<li>
<p>Provide Host Credentials, click <span class="bold">Browse</span> to select a Storage Location, then click <span class="bold">Next</span>.</p>
<p>The Create Capture: Schedule page appears.</p>
</li>
<li>
<p>Schedule the starting time and duration for the capture, schedule the exporting of AWR data, then click <span class="bold">Next</span>.</p>
<ul>
<li>
<p>The default capture duration is 5 minutes. Change the capture duration to capture representative activity over a time period of interest that needs to be tested.</p>
</li>
</ul>
<p>The Create Capture: Review page appears.</p>
</li>
<li>
<p>If all of the parameters appear as you have intended, click <span class="bold">Submit</span> to start the Capture job.</p>
<ul>
<li>
<p>The "Capture SQL statements into a SQL Tuning Set during workload capture" option is enabled by default. Uncheck this option if you do not want to compare SQL tuning sets at the end of the Replay.</p>
</li>
</ul>
<p>The Database Replay page reappears, displays a message that the capture was created successfully, and displays the status of the capture in the Captures list, such as "Scheduled."</p>
</li>
<li>
<p>For detailed information about the capture, double-click the name of the capture.</p>
<p>The Capture Summary page appears, and displays several attributes, including the average active sessions, a workload comparison, and related concurrent captures.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CACFJBIE"></a>
<div id="RATUG118" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">9.8</span> Monitoring a Workload Capture Using Enterprise Manager</h2>
<p>This section describes how to monitor <a id="sthref170"></a>workload capture using Enterprise Manager. The primary tool for monitoring workload capture is Oracle Enterprise Manager. Using Enterprise Manager, you can:</p>
<ul>
<li>
<p>Monitor or stop an active workload capture</p>
</li>
<li>
<p>View a completed workload capture</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
If Oracle Enterprise Manager is unavailable, you can monitor workload capture using views, as described in <a href="#CACHJHJB">"Monitoring Workload Capture Using Views"</a>.</div>
<p>This section contains the following topics:</p>
<ul>
<li>
<p><a href="#CACGDIAF">Monitoring an Active Workload Capture</a></p>
</li>
<li>
<p><a href="#CACIHEIC">Stopping an Active Workload Capture</a></p>
</li>
<li>
<p><a href="#CACGCEEF">Viewing a Completed Workload Capture</a></p>
</li>
</ul>
<a id="CACGDIAF"></a>
<div id="RATUG119" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">9.8.1</span> Monitoring an Active Workload Capture</h3>
<p>This section describes how to monitor an active workload capture using Enterprise Manager.</p>
<p class="subhead2"><a id="RATUG257"></a>To monitor an active workload capture:</p>
<ol>
<li>
<p>From the Enterprise menu of the Enterprise Manager Cloud Control console, select <span class="bold">Quality Management</span>, then <span class="bold">Database Replay</span>.</p>
<p>If the Database Login page appears, log in as a user with administrator privileges.</p>
<p>The Database Replay page appears.</p>
</li>
<li>
<p>From the Captured Workloads tab of the Database Replay page for a capture that has a Status other than Completed, click the name of the desired capture from the Capture table.</p>
<p>The Summary tab of the Database Replay page appears, showing detailed statistics, a chart for average active sessions that updates dynamically while the capture is in progress, a comparison of data for captured elements versus the same elements not captured, and related concurrent captures, if any.</p>
<ul>
<li>
<p>The Not Captured data shown in the Active Average Sessions chart shows the database activity (database sessions) that is not being captured.</p>
</li>
<li>
<p>The values for the Total column in the Comparison section shows all of the captured and uncaptured activity in the database. Filtering, as determined by the Workload Filters you provided in the Options step of the Create Capture wizard, is primarily why some activity is captured or not. Additionally, background activities, database scheduler jobs, and unreplayable calls are not captured.</p>
</li>
<li>
<p>You can click the refresh icon in the upper right corner to update the capture while it is running.</p>
</li>
</ul>
</li>
<li>
<p>To return to the Database Replay page, click the Database Replay breadcrumb.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CACIHEIC"></a>
<div id="RATUG120" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">9.8.2</span> Stopping an Active Workload Capture</h3>
<p>This section describes how to stop an active <a id="sthref171"></a>workload capture using Enterprise Manager.</p>
<p class="subhead2"><a id="RATUG258"></a>To stop an active workload capture:</p>
<ol>
<li>
<p>From the Enterprise menu of the Enterprise Manager Cloud Control console, select <span class="bold">Quality Management</span>, then <span class="bold">Database Replay</span>.</p>
<p>If the Database Login page appears, log in as a user with administrator privileges.</p>
<p>The Database Replay page appears.</p>
</li>
<li>
<p>From the Captured Workloads tab of the Database Replay page for a capture that has a Status of Draft, click the name in the Capture table of the capture you want to stop.</p>
<p>The Capture Summary page appears.</p>
</li>
<li>
<p>Click the <span class="bold">Stop Capture</span> button.</p>
<p>The button label changes to Stopping Capture. When the process completes, the Status changes to Stopped.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CACGCEEF"></a>
<div id="RATUG121" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">9.8.3</span> Viewing a Completed Workload Capture</h3>
<p>This section describes how to manage a completed <a id="sthref172"></a>workload capture using Enterprise Manager.</p>
<p class="subhead2"><a id="RATUG259"></a>To view a completed workload capture:</p>
<ol>
<li>
<p>From the Enterprise menu of the Enterprise Manager Cloud Control console, select <span class="bold">Quality Management</span>, then <span class="bold">Database Replay</span>.</p>
<p>If the Database Login page appears, log in as a user with administrator privileges.</p>
<p>The Database Replay page appears.</p>
</li>
<li>
<p>From the Capture Workloads tab of the Database Replay page, click the name of a capture that has a Status of Completed.</p>
<p>The contents of the Summary tab of the Database Replay page appears as for a capture in progress, except the Average Active Sessions chart shows aggregated data for the capture time period, rather than dynamic data recorded during the capture.</p>
<img width="1089" height="759" src="img/dbr_capture_view.gif" alt="Description of dbr_capture_view.gif follows" /><br />
<a id="sthref173" href="img_text/dbr_capture_view.htm">Description of the illustration dbr_capture_view.gif</a><br />
<br />
<p>The Average Active Sessions chart provides a graphic display of the captured session activity compared to the uncaptured session activity (such as background activities or filtered sessions). This chart appears only when Active Session History (ASH) data is available for the capture period.</p>
<p>Under Comparison, various statistics for the workload capture are displayed:</p>
<ul>
<li>
<p>Capture column</p>
<p>Displays the statistics for the captured session activity.</p>
</li>
<li>
<p>Total column</p>
<p>Displays the statistics for the total session activity.</p>
</li>
<li>
<p>Percentage of Total column</p>
<p>Displays the percentage of total session activity that has been captured in the workload.</p>
</li>
</ul>
</li>
<li>
<p>To return to the Database Replay page, click the Database Replay breadcrumb.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
See <a href="dbr_analyze.htm#CACBHAEF">Chapter 12, "Analyzing Captured and Replayed Workloads"</a> for information about accessing workload capture reports.</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CFHEEFBJ"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">9.9</span> Importing a Workload External to Enterprise Manager</h2>
<p>You can import a workload captured through the PL/SQL interface or through a different Enterprise Manager instance into Enterprise Manager to manage it as you would for a workload originally created within Enterprise Manager. The workload can be in the process of being captured, or the Capture can be completed and the workload stored on a file system. You can also preprocess and replay the workload as you would ordinarily do for a workload created within Enterprise Manager.</p>
<p>This feature is available for Cloud Control Database plug-in 12.1.0.5 and later releases.</p>
<p class="orderedlisttitle">To import a database workload external to Enterprise Manager:&nbsp;</p>
<ol>
<li>
<p>From the Database Replay page, click the <span class="bold">Captured Workloads</span> tab, then click <span class="bold">Import</span> in the toolbar.</p>
<p>The Import Workload: Source page appears.</p>
</li>
<li id="BEIDEJGD">
<p>Select one of the three choices available to import a captured workload, then click <span class="bold">Next</span>:</p>
<ul>
<li>
<p><span class="bold">Import a completed captured workload from a directory in the file system</span></p>
<p>This option typically applies for a workload created using an API, in which you now want to import it to Enterprise Manager for subsequent processing. In this case, Enterprise Manager may not even be managing the Capture database.</p>
</li>
<li>
<p><span class="bold">Import a completed captured workload from a database target</span></p>
<p>In this case, Enterprise Manager is probably already managing the Capture database. The Capture could have been done on this database, or it could have been loaded in as would be the case for the option above.</p>
</li>
<li>
<p><span class="bold">Attach to a Capture running in a database target</span></p>
<p>This option is similar to the option above, except this a Capture that is still in progress, rather than one that has already completed.</p>
</li>
</ul>
<p>The Import Workload: Database page appears.</p>
</li>
<li>
<p>Click the search icon next to the Database Target field and select a database from the pop-up that appears.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The target version of the database loading the workload must be at least as high as the one you used to capture the workload. For instance, if you captured using Oracle Database 12x, the database you select to read the Capture must be at least version 12x.</div>
<ul>
<li>
<p>The system now requests database and host credentials.</p>
</li>
<li>
<p>In the previous step, if you chose to import a completed captured workload from a directory in the file system, the system also requires a workload location.</p>
</li>
<li>
<p>A consolidated Replay has a different directory structure in which there are at least two capture directories. Consequently, if the workload directory contains a consolidated Replay, you need to enable the check box so that Enterprise Manager can be aware of the consolidated Replay during the import operation.</p>
</li>
</ul>
</li>
<li>
<p>Provide the requisite input for the step above, then click <span class="bold">Next</span>.</p>
<p>The Import Workload: Workload page appears.</p>
<ul>
<li>
<p>If you chose "Import a completed captured workload from a directory in the file system&rdquo; in step <a href="#BEIDEJGD">2</a>, this page provides a Load Workload button.</p>
</li>
<li>
<p>If you chose &rdquo;Import a completed captured workload from a database target&rdquo; or &rdquo;Attach to a Capture running in a database target&rdquo; in step <a href="#BEIDEJGD">2</a>, this page provides a Discover Workload button.</p>
</li>
</ul>
</li>
<li>
<p>Click either <span class="bold">Load Workload</span> or <span class="bold">Discover Workload</span>, depending on which button is available in accordance with your selection in step <a href="#BEIDEJGD">2</a>.</p>
<p>The system displays workloads, if found, in the Discovered Workloads table.</p>
</li>
<li>
<p>Either click <span class="bold">Next</span> to load the workload, or select one of the workloads, then click <span class="bold">Next</span> to continue importing the workload.</p>
<p>The Import Workload: Replay page appears only under the following conditions:</p>
<ul>
<li>
<p>You chose "Import a completed captured workload from a directory in the file system&rdquo; in step <a href="#BEIDEJGD">2</a>.</p>
</li>
<li>
<p>The workload contains one or more Replays.</p>
</li>
</ul>
</li>
<li>
<p><span class="italic">Optional:</span> Select one or more Replays, if desired, provide a <span class="bold">Replay Task Name</span>, then click <span class="bold">Next</span>.</p>
<p>The Import Workload: Review page appears.</p>
</li>
<li>
<p>If everything appears as you have intended, click <span class="bold">Submit</span>.</p>
<p>The Database Replay page reappears and displays a message stating that the job was submitted successfully. The Status column for your loaded or imported workload in the Captured Workload table will show In Progress.</p>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
You can check on the job's progress by clicking on the captured workload name that you just submitted in the Review step. A Capture Summary page appears, and you can click the Database Replay Import Job link to see the progress of the job execution steps.</div>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CFHHAHBI"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">9.10</span> Creating Subsets from an Existing Workload</h2>
<p>For cases in which you have captured a large workload covering a long period of time, you may only want to replay a portion of it to accelerate testing. The Database Replay Workload Subsetting feature enables you to create new workloads by extracting portions of an existing captured workload.</p>
<p>Enterprise Manager provides a wizard to extract a subset of data from an existing workload that you can use for Replay on a test system. Each extracted subset is a legitimate workload that can be replayed on its own or with other workloads in a consolidated Replay.</p>
<p>To perform a Replay, you need to preprocess the workloads.</p>
<p>This feature is available for Cloud Control Database plug-in 12.1.0.5 and later releases.</p>
<p class="orderedlisttitle">To extract subsets from a workload:&nbsp;</p>
<ol>
<li>
<p>From the Captured Workloads tab of the Database Replay page, select a workload for which you want to extract a subset, then click <span class="bold">Subset</span>.</p>
<p>The Subset Workload: Define page appears, showing an Active Sessions History chart for the workload.</p>
</li>
<li>
<p>Select a starting and ending time for the subset you want to extract from the workload:</p>
<ol>
<li>
<p>Click <span class="bold">Add</span> above the Subsets table at the bottom of the page.</p>
<p>The Create Subset pop-up appears.</p>
</li>
<li>
<p>Select either snapshot or calendar times, provide start and end times, then click <span class="bold">OK</span>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Snapshot time is the preferred choice, because not all performance data may be available for the calendar time you select.</div>
<p>Your selected time period now appears in the Active Sessions chart as a greyed-out segment.</p>
</li>
<li>
<p><span class="italic">Optional:</span> Define one or more additional subsets with different time periods than those you selected in the step above.</p>
</li>
<li>
<p><span class="italic">Optional:</span> In the Advanced Parameters section, indicate whether you want to include incomplete calls after the subset workload ends. The default is to include incomplete calls when the subset workload begins.</p>
<ul>
<li>
<p>These parameters enable you to include the calls outside of your defined boundaries. For example, when you specify a starting and ending time as the boundaries for a transaction, the transaction may have started before your indicated start time, and may also have continued after your indicated end time.</p>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>Click <span class="bold">Next</span>.</p>
<p>The Subset Workload: Database page appears.</p>
</li>
<li>
<p>Click the search icon next to the Database Target field and select a database for subsetting from the Search and Select: Targets pop-up that appears.</p>
<p>The system now requests database and host credentials.</p>
</li>
<li>
<p>Provide the requisite input for the step above, then click <span class="bold">Next</span>.</p>
<p>The Subset Workload: Location page appears.</p>
<ul>
<li>
<p>If the source host and staged database host are the same, the location is pre-populated, so you do not need to provide the location for the source workload files.</p>
</li>
<li>
<p>If the source host and staged database host are not the same, do the following:</p>
<ol>
<li>
<p>Choose whether you want to access the workload files from the host name shown in the Host field, or whether you want to copy the files from the source host to the Destination Host shown.</p>
<p><span class="bold">Access Directly</span> means that the database to be used to subset the workload can access the original workload directly using the specified file system location. This is typically the case when the original workload is stored at a network shared location.</p>
<p><span class="bold">Access Copy</span> means that the two hosts are not in the shared network path. You need to provide the source host credentials so that Enterprise Manager can copy the original workload from its current location to the specified location on the subset database host.</p>
</li>
<li>
<p>Depending on your choice above, either provide the directory location containing the workload files, or provide the location for the destination host.</p>
</li>
</ol>
</li>
</ul>
</li>
<li>
<p>In the Subset field, specify the storage location for each subset, then click <span class="bold">Next</span>.</p>
<p>The Subset Workload: Schedule page appears.</p>
</li>
<li>
<p>Indicate when you want to start the subset job, then click <span class="bold">Next</span>.</p>
<p>The Subset Workload: Review page appears.</p>
</li>
<li>
<p>If everything appears as you have intended, click <span class="bold">Submit</span>.</p>
<p>The Database Replay page reappears and displays a message stating that the job was submitted successfully. The Status column for your subset in the Replay Tasks table will show In Progress.</p>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
You can check on the job's progress by clicking on the subset name that you just submitted in the Review step. A Capture Summary page appears, and you can click the Database Replay Subset Job link to see the progress of the job execution steps.</div>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CFHGBJFH"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">9.11</span> Copying or Moving a Workload to a New Location</h2>
<p>You can use the copy function for two purposes:</p>
<ul>
<li>
<p>Duplicate the Capture files from the source to another host and location.</p>
</li>
<li>
<p>Move the Capture files to a new host and location, and delete the source files from the original location.</p>
</li>
</ul>
<p>This feature is available for Cloud Control Database plug-in 12.1.0.5 and later releases.</p>
<p class="orderedlisttitle">To copy a workload to a new location:&nbsp;</p>
<ol>
<li>
<p>From the Captured Workloads tab of the Database Replay page, select a workload you want to copy to a new location, then click <span class="bold">Copy</span>.</p>
<p>The Copy Workload page appears, and displays the current source location of the workload directory you selected.</p>
</li>
<li>
<p>Provide or change credentials for the storage host, if necessary. The system automatically picks up the previously defined credentials for the current storage host.</p>
</li>
<li>
<p>Leave the After Copy radio button enabled, which is "Keep original workload in the source location."</p>
</li>
<li>
<p>Select the <span class="bold">Storage Host</span> for the new location of the workload directory.</p>
</li>
<li>
<p>Provide credentials for the new storage host.</p>
</li>
<li>
<p>Select the directory for the new <span class="bold">Destination Location</span> for the workload.</p>
</li>
<li>
<p>Schedule the job, then click <span class="bold">Submit</span>.</p>
<p>The Database Replay page reappears and displays a message stating that the job was submitted and that the storage location has been updated successfully.</p>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
You can check on the job's progress by going to the Job Activity page, searching for the job name that appeared in the submit message, then clicking its link to access the Job Run page.</div>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CACBCJAE"></a>
<div id="RATUG122" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">9.12</span> Capturing a Database Workload Using APIs</h2>
<p>This section describes how to <a id="sthref177"></a>capture a database workload using APIs. You can also use Oracle Enterprise Manager to capture database workloads, as described in <a href="#CACGDCEA">"Capturing a Database Workload Using Enterprise Manager"</a>.</p>
<p>Capturing a database workload using the <code>DBMS_WORKLOAD_CAPTURE</code> package involves:</p>
<ul>
<li>
<p><a href="#CACHJDHD">Defining Workload Capture Filters</a></p>
</li>
<li>
<p><a href="#CACEFJGD">Starting a Workload Capture</a></p>
</li>
<li>
<p><a href="#CACHCFEC">Stopping a Workload Capture</a></p>
</li>
<li>
<p><a href="#CACGHCHF">Exporting AWR Data for Workload Capture</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ARPLS207" href="../../appdev.112/e40758/d_workload_capture.htm#ARPLS207"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>DBMS_WORKLOAD_CAPTURE</code> package</p>
</li>
</ul>
</div>
<a id="CACHJDHD"></a>
<div id="RATUG123" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">9.12.1</span> Defining Workload Capture Filters</h3>
<p>This section describes how to add and remove <a id="sthref178"></a>workload capture filters. For information about using workload filters with workload capture, see <a href="#CACHIAAA">"Using Filters with Workload Capture"</a>.</p>
<p>To add filters to a workload capture, use the <a id="sthref179"></a><code>ADD_FILTER</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_CAPTURE.ADD_FILTER (
                           fname =&gt; 'user_ichan',
                           fattribute =&gt; 'USER',
                           fvalue =&gt; 'ICHAN');
END;
/
</pre>
<p>In this example, the <code>ADD_FILTER</code> procedure adds a filter named user_ichan, which can be used to filter out all sessions belonging to the user name ICHAN.</p>
<p>The <code>ADD_FILTER</code> procedure in this example uses the following parameters:</p>
<ul>
<li>
<p>The <code>fname</code> required parameter specifies the name of the filter that will be added.</p>
</li>
<li>
<p>The <code>fattribute</code> required parameter specifies the attribute on which the filter will be applied. Valid values include PROGRAM, MODULE, ACTION, SERVICE, INSTANCE_NUMBER, and USER.</p>
</li>
<li>
<p>The <code>fvalue</code> required parameter specifies the value for the corresponding attribute on which the filter will be applied. It is possible to use wildcards such as % with some of the attributes, such as modules and actions.</p>
</li>
</ul>
<p>To remove filters from a workload capture, use the <a id="sthref180"></a><code>DELETE_FILTER</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_CAPTURE.DELETE_FILTER (fname =&gt; 'user_ichan');
END;
/
</pre>
<p>In this example, the <code>DELETE_FILTER</code> procedure removes the filter named user_ichan from the workload capture.</p>
<p>The <code>DELETE_FILTER</code> procedure in this example uses the <code>fname</code> required parameter, which specifies the name of the filter to be removed. The <code>DELETE_FILTER</code> procedure will not remove filters that belong to completed captures; it only applies to filters of captures that have yet to start.</p>
</div>
<!-- class="sect2" -->
<a id="CACEFJGD"></a>
<div id="RATUG124" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">9.12.2</span> Starting a Workload Capture</h3>
<p>Before starting a <a id="sthref181"></a>workload capture, you must first complete the prerequisites for capturing a database workload, as described in <a href="#CACBJJIC">"Prerequisites for Capturing a Database Workload"</a>. You should also review the workload capture options, as described in <a href="#CACCGCFB">"Workload Capture Options"</a>.</p>
<p>It is important to have a well-defined starting point for the workload so that the replay system can be restored to that point before initiating a replay of the captured workload. To have a well-defined starting point for the workload capture, it is preferable not to have any active user sessions when starting a workload capture. If active sessions perform ongoing transactions, those transactions will not be replayed properly in subsequent database replays, since only that part of the transaction whose calls were executed after the workload capture is started will be replayed. To avoid this problem, consider restarting the database in restricted mode using <code>STARTUP RESTRICT</code> before starting the workload capture. Once the workload capture begins, the database will automatically switch to unrestricted mode and normal operations can continue while the workload is being captured. For more information about restarting the database before capturing a workload, see <a href="#CACHGFGI">"Restarting the Database"</a>.</p>
<p>To start the workload capture, use the <a id="sthref182"></a><code>START_CAPTURE</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_CAPTURE.START_CAPTURE (name =&gt; 'dec10_peak', 
                           dir =&gt; 'dec10',
                           duration =&gt; 600,
                           capture_sts =&gt; TRUE,
                           sts_cap_interval =&gt; 300);
END;
/
</pre>
<p>In this example, a workload named <code>dec10_peak</code> will be captured for 600 seconds and stored in the file system defined by the database directory object named <code>dec10</code>. A SQL tuning set will also be captured in parallel with the workload capture.</p>
<p>The <code>START_CAPTURE</code> procedure in this example uses the following parameters:</p>
<ul>
<li>
<p>The <code>name</code> required parameter specifies the name of the workload that will be captured.</p>
</li>
<li>
<p>The <code>dir</code> required parameter specifies a directory object pointing to the directory where the captured workload will be stored.</p>
</li>
<li>
<p>The <code>duration</code> parameter specifies the number of seconds before the workload capture will end. If a value is not specified, the workload capture will continue until the <code>FINISH_CAPTURE</code> procedure is called.</p>
</li>
<li>
<p>The <code>capture_sts</code> parameter specifies whether to capture a SQL tuning set in parallel with the workload capture. If this parameter is set to <code>TRUE</code>, you can capture a SQL tuning set during workload capture, then capture another SQL tuning set during workload replay, and use SQL Performance Analyzer to compare the SQL tuning sets without having to re-execute the SQL statements. This enables you to obtain a SQL Performance Analyzer report and compare the SQL performance&mdash;before and after the change&mdash;while running Database Replay. You can also export the resulting SQL tuning set with its AWR data using the <code>EXPORT_AWR</code> procedure, as described in <a href="#CACGHCHF">"Exporting AWR Data for Workload Capture"</a>.</p>
<p>This feature is not supported for Oracle RAC. Workload capture filters that are defined using <code>DBMS_WORKLOAD_CAPTURE</code> do not apply to the SQL tuning set capture. The default value for this parameter is <code>FALSE</code>.</p>
</li>
<li>
<p>The <code>sts_cap_interval</code> parameter specifies the duration of the SQL tuning set capture from the cursor cache in seconds. The default value is 300. Setting the value of this parameter below the default value may cause additional overhead with some workloads and is not recommended.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CACHCFEC"></a>
<div id="RATUG125" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">9.12.3</span> Stopping a Workload Capture</h3>
<p>To stop the <a id="sthref183"></a>workload capture, use the <a id="sthref184"></a><code>FINISH_CAPTURE</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_CAPTURE.FINISH_CAPTURE (); 
END;
/
</pre>
<p>In this example, the <code>FINISH_CAPTURE</code> procedure finalizes the workload capture and returns the database to a normal state.</p>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
After capturing a workload on the production system, you need to preprocess the captured workload, as described in <a href="dbr_preprocess.htm#CHDHCAHI">Chapter 10, "Preprocessing a Database Workload"</a>.</div>
</div>
<!-- class="sect2" -->
<a id="CACGHCHF"></a>
<div id="RATUG126" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">9.12.4</span> Exporting AWR Data for Workload Capture</h3>
<p>Exporting AWR data enables detailed analysis of the workload. This data is also required if you plan to run the Replay Compare Period report or the AWR Compare Period report on a pair of <a id="sthref185"></a>workload captures or replays.</p>
<p>To export AWR data, use the <a id="sthref186"></a><code>EXPORT_AWR</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_CAPTURE.EXPORT_AWR (capture_id =&gt; 2);
END;
/
</pre>
<p>In this example, the AWR snapshots that correspond to the workload capture with a capture ID of 2 are exported, along with any SQL tuning set that may have been captured during workload capture.</p>
<p>The <code>EXPORT_AWR</code> procedure uses the <code>capture_id</code> required parameter, which specifies the ID of the capture whose AWR snapshots will be exported. This procedure will work only if the corresponding workload capture was performed in the current database and the AWR snapshots that correspond to the original capture time period are still available.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CACHJHJB"></a>
<div id="RATUG127" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">9.13</span> Monitoring Workload Capture Using Views</h2>
<p>This section summarizes the views that you can display to monitor <a id="sthref187"></a>workload capture. You can also use Oracle Enterprise Manager to monitor workload capture, as described in <a href="#CACFJBIE">"Monitoring a Workload Capture Using Enterprise Manager"</a>.</p>
<p>To access these views, you need DBA privileges:</p>
<ul>
<li>
<p>The <code>DBA_WORKLOAD_CAPTURES</code> view lists all the workload captures that have been captured in the current database.</p>
</li>
<li>
<p>The <code>DBA_WORKLOAD_FILTERS</code> view lists all workload filters used for workload captures defined in the current database.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink REFRN" href="../e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a> for information about these views</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1798">
<tr>
<td class="cellalignment1805">
<table class="cellalignment1803">
<tr>
<td class="cellalignment1802"><a href="dbr_intro.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1802"><a href="dbr_preprocess.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2008, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1807">
<table class="cellalignment1801">
<tr>
<td class="cellalignment1802"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1802"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1802"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1802"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1802"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1802"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
