<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Using Consolidated Database Replay</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 740" />
<meta name="dcterms.created" content="2014-06-16T16:24:51Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Real Application Testing User's Guide" />
<meta name="dcterms.identifier" content="E41481-03" />
<meta name="dcterms.isVersionOf" content="RATUG" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2008, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="dbr_analyze.htm" title="Previous" type="text/html" />
<link rel="Next" href="part3.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e41481.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">18/23</span> <!-- End Header -->
<div id="RATUG4080" class="chapter"><a id="CHDDIBFI"></a>
<h1 class="chapter"><span class="secnum">13</span> Using Consolidated Database Replay</h1>
<p>Database Replay enables you to capture a workload on the production system and replay it on a test system. This can be very useful when evaluating or adopting new database technologies because these changes can be tested on a test system without affecting the production system. However, some situations may require you to replay multiple workloads concurrently to accurately predict how additional workloads are handled by a system.</p>
<p>For example, you may want to conduct stress testing on a system by adding workloads to an existing workload capture and replaying them together. You may also want to perform scale-up testing by folding an existing workload capture or remapping database schemas.</p>
<p><a id="sthref285"></a>Consolidated Database Replay enables you to consolidate multiple workloads captured from one or multiple systems and replay them concurrently on a test system. This enables you to perform more comprehensive testing such as stress testing and scale-up testing.</p>
<p>This chapter describes how to use Consolidated Database Replay and contains the following sections:</p>
<ul>
<li>
<p><a href="#CHDGHECD">Overview of Consolidated Database Replay</a></p>
</li>
<li>
<p><a href="#CHDBHCIB">Steps for Using Consolidated Database Replay</a></p>
</li>
<li>
<p><a href="#CIHIDDFA">Using Consolidated Database Replay with Enterprise Manager</a></p>
</li>
<li>
<p><a href="#CHDGCIFD">Using Consolidated Database Replay with APIs</a></p>
</li>
<li>
<p><a href="#CHDIABAE">Examples: Using Consolidated Database Replay</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Consolidated Database Replay is only available after applying the appropriate patches for Oracle Database 11<span class="italic">g</span> Release 2 (11.2). For information about the required patches, contact Oracle Support or refer to My Oracle Support (MOS) note 560977.1.</div>
<a id="CHDGHECD"></a>
<div id="RATUG4205" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">13.1</span> Overview of Consolidated Database Replay</h2>
<p>Consolidated Database Replay enables you to replay multiple workloads captured from one or multiple systems concurrently. During the replay, every workload capture that is consolidated will start to replay when the consolidated replay begins. Depending on the use case, you can employ various workload scale-up techniques when using Consolidated Database Replay.</p>
<p>This section contains the following topics:</p>
<ul>
<li>
<p><a href="#CHDGBEGD">Use Cases for Consolidated Database Replay</a></p>
</li>
<li>
<p><a href="#CHDECCAC">Workload Scale-Up Techniques</a></p>
</li>
</ul>
<a id="CHDGBEGD"></a>
<div id="RATUG4082" class="sect2">
<h3 class="sect2"><span class="secnum">13.1.1</span> Use Cases for Consolidated Database Replay</h3>
<p>Some typical use cases for Consolidated Database Replay include:</p>
<ul>
<li>
<p><a href="#CHDHGDBH">Stress Testing</a></p>
</li>
<li>
<p><a href="#CHDBJIJA">Scale-Up Testing</a></p>
</li>
</ul>
<a id="CHDHGDBH"></a>
<div id="RATUG4200" class="sect3">
<h4 class="sect3"><span class="secnum">13.1.1.1</span> Stress Testing</h4>
<p>One use for Consolidated Database Replay is for stress testing or capacity planning. For example, assume that you are expecting the workload for the Sales application to double during the holiday season. You can use Consolidated Database Replay to test the added stress on the system by doubling the workload and replaying the combined workload. To perform stress testing on your system, consider using time shifting.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDDGCEB">"About Time Shifting"</a></div>
</div>
<!-- class="sect3" -->
<a id="CHDBJIJA"></a>
<div id="RATUG4201" class="sect3">
<h4 class="sect3"><span class="secnum">13.1.1.2</span> Scale-Up Testing</h4>
<p>Another use for Consolidated Database Replay is for scale-up testing. For example, assume that you want to test if your system can handle captured workloads from the Financials application and the Orders application concurrently. You can use Consolidated Database Replay to test the effects of the scaled-up workload on your system by combining the workloads and replaying them simultaneously. To perform scale-up testing on your system, consider using workload folding or schema remapping.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDCGBCH">"About Workload Folding"</a></p>
</li>
<li>
<p><a href="#CHDFACII">"About Schema Remapping"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDECCAC"></a>
<div class="sect2">
<h3 class="sect2"><span class="secnum">13.1.2</span> Workload Scale-Up Techniques</h3>
<p>This section describes the following workload scale-up techniques:</p>
<ul>
<li>
<p><a href="#CHDDGCEB">About Time Shifting</a></p>
</li>
<li>
<p><a href="#CHDCGBCH">About Workload Folding</a></p>
</li>
<li>
<p><a href="#CHDFACII">About Schema Remapping</a></p>
</li>
</ul>
<a id="CHDDGCEB"></a>
<div id="RATUG4207" class="sect3">
<h4 class="sect3"><span class="secnum">13.1.2.1</span> About Time Shifting</h4>
<p>Database Replay enables you to perform time shifting when replaying captured workloads. This technique is useful in cases where you want to conduct stress testing on a system by adding workloads to an existing workload capture and replaying them together.</p>
<p>For example, assume that there are three workloads captured from three applications: Sales, CRM, and DW. In order to perform stress testing, you can align the peaks of these workload captures and replay them together using Consolidated Database Replay.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDHGDBH">"Stress Testing"</a> for information about using Consolidated Database Replay for stress testing</p>
</li>
<li>
<p><a href="#CHDFFBIH">"Using Time Shifting"</a> for an example of using time shifting</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CHDCGBCH"></a>
<div id="RATUG4208" class="sect3">
<h4 class="sect3"><span class="secnum">13.1.2.2</span> About Workload Folding</h4>
<p>Database Replay enables you to perform scale-up testing by folding an existing workload capture. For example, assume that a workload was captured from 2 a.m. to 8 p.m. You can use Database Replay to fold the original workload into three capture subsets: one from 2 a.m. to 8 a.m., a second from 8 a.m. to 2 p.m., and a third from 2 p.m. to 8 p.m. By replaying the three capture subsets together, you can fold the original capture and triple the workload during replay to perform scale-up testing.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDBJIJA">"Scale-Up Testing"</a> for information about using Consolidated Database Replay for scale-up testing</p>
</li>
<li>
<p><a href="#CHDEHHBD">"Capture Subsets"</a> for information about capture subsets</p>
</li>
<li>
<p><a href="#CHDCGCCA">"Using Workload Folding"</a> for an example of using workload folding</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CHDFACII"></a>
<div id="RATUG4209" class="sect3">
<h4 class="sect3"><span class="secnum">13.1.2.3</span> About Schema Remapping</h4>
<p>Database Replay enables you to perform scale-up testing by remapping database schemas. This technique is useful in cases when you are deploying multiple instances of the same application&mdash;such as a multi-tenet application&mdash;or adding a new geographical area to an existing application.</p>
<p>For example, assume that a single workload exists for a Sales application. To perform scale-up testing and identify possible host bottlenecks, set up the test system with multiple schemas from the Sales schema.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDBJIJA">"Scale-Up Testing"</a> for information about using Consolidated Database Replay for scale-up testing</p>
</li>
<li>
<p><a href="#CHDJBACI">"Using Schema Remapping"</a> for an example of using schema remapping</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDBHCIB"></a>
<div id="RATUG4081" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">13.2</span> Steps for Using Consolidated Database Replay</h2>
<p>This section describes the steps involved when using <a id="sthref286"></a>Consolidated Workload Replay and contains the following topics:</p>
<ul>
<li>
<p><a href="#CHDFAEFA">Capturing Database Workloads for Consolidated Database Replay</a></p>
</li>
<li>
<p><a href="#CHDBCCFJ">Setting Up the Test System for Consolidated Database Replay</a></p>
</li>
<li>
<p><a href="#CHDJFFGF">Preprocessing Database Workloads for Consolidated Database Replay</a></p>
</li>
<li>
<p><a href="#CHDJDHIB">Replaying Database Workloads for Consolidated Database Replay</a></p>
</li>
<li>
<p><a href="#CHDIJJIB">Reporting and Analysis for Consolidated Database Replay</a></p>
</li>
</ul>
<a id="CHDFAEFA"></a>
<div id="RATUG4086" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">13.2.1</span> Capturing Database Workloads for Consolidated Database Replay</h3>
<p>Consolidated Database Replay does not require any special steps for capturing database workloads. The steps for capturing database workloads are exactly the same as for capturing a single workload for Database Replay, as described in <a href="dbr_capture.htm#CACICAAC">Chapter 9, "Capturing a Database Workload"</a>.</p>
<p>This section contains the following topics for workload captures that are specific to Consolidated Database Replay:</p>
<ul>
<li>
<p><a href="#CHDBBCJH">Supported Types of Workload Captures</a></p>
</li>
<li>
<p><a href="#CHDEHHBD">Capture Subsets</a></p>
</li>
</ul>
<a id="CHDBBCJH"></a>
<div id="RATUG4087" class="sect3">
<h4 class="sect3"><span class="secnum">13.2.1.1</span> Supported Types of Workload Captures</h4>
<p><a id="sthref287"></a>Consolidated Database Replay supports multiple workloads captured from one or multiple systems running Oracle Database 9<span class="italic">i</span> Release 2 (release 9.2.0.8.0) or higher on one or multiple operating systems. For example, you can use workloads captured from one system running Oracle Database 9<span class="italic">i</span> Release 2 (release 9.2.0.8.0) on HP-UX and another system running Oracle Database 10<span class="italic">g</span> Release 2 (release 10.2.0.4.0) on AIX.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Consolidated Database Replay is only available on Oracle Database 11<span class="italic">g</span> Release 2 (release 11.2.0.2.0) and higher.</div>
</div>
<!-- class="sect3" -->
<a id="CHDEHHBD"></a>
<div id="RATUG4088" class="sect3">
<h4 class="sect3"><span class="secnum">13.2.1.2</span> Capture Subsets</h4>
<p>Consolidated Database Replay enables you to transform existing workload captures into new, smaller pieces of capture subsets. You can then generate new workload captures from the capture subsets that can be used in different use cases, as described in <a href="#CHDGBEGD">"Use Cases for Consolidated Database Replay"</a>.</p>
<p>A <span class="bold"><a id="sthref288"></a>capture subset</span> is a piece of a workload capture that is defined from an existing workload capture by applying a time range. The time range is specified as an offset from the start of the workload capture. All user workloads captured within the specified time range are included in the defined capture subset.</p>
<p>For example, assume that a workload was captured from 2 a.m. to 8 p.m. and the peak workload is identified to be from 10 a.m. to 4 p.m. You can define a capture subset to represent the peak workload by applying a time range that starts at 8 hours after the start of the workload (or 10 a.m.) and ends at 14 hours after the start of the workload (or 4 p.m.).</p>
<p>However, if a capture subset only contains recorded user workloads that satisfy the specified time range, user logins that occurred before the specified time range are not recorded. If these user logins are required for replay, then the capture subset may not be replayable. For example, if a user session starts at 9:30 a.m. and ends at 10:30 a.m. and the specified time range for the capture subset is 10:00 a.m. to 4:00 p.m., the replay may fail if the user login at 9:30 a.m. is not included in the workload. Similarly, the specified time range may also include incomplete user calls that are only partially recorded if a user sessions starts at 3:30 p.m. but does not complete until 4:30 p.m.</p>
<p>Consolidated Database Replay addresses this problem by including only incomplete user calls caused by the start time of the specified time range. To avoid including the same incomplete user calls twice if the workload capture is folded, incomplete user calls caused by the end time are <span class="italic">not</span> included by default. Therefore, a capture subset is essentially the minimal number of recorded user calls during a specified time range that are required for proper replay, including the necessary user logins, alter session statements, and incomplete user calls caused by the start time.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDJAJEB">"Generating Capture Subsets Using APIs"</a></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDBCCFJ"></a>
<div id="RATUG4090" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">13.2.2</span> Setting Up the Test System for Consolidated Database Replay</h3>
<p>Setting up the test system for <a id="sthref289"></a>Consolidated Database Replay is similar to setting up a test system for Database Replay, as described in <a href="dbr_replay.htm#CHDHHDGE">"Steps for Replaying a Database Workload"</a>. However, there are some additional considerations when setting up a replay database for Consolidated Database Replay.</p>
<p>To minimize divergence during the replay, the test system should contain the same application data and the state of the application data should be logically equivalent to that of the capture system at the start time of each workload capture. However, because a consolidated capture may contain multiple workload captures from different production systems, the test system needs to be set up for all the captures.</p>
<p>For Consolidated Database Replay, all participating workload captures must be placed under a new capture directory on the test system. You can copy all the workload captures into the new <a id="sthref290"></a>capture directory, or create symbolic links pointing to the original workload captures. Before consolidating the workload captures, ensure that the new capture directory has enough disk space to store all participating captures.</p>
<p><a href="#CHDEFCDA">Figure 13-1</a> illustrates how to set up the test system and new capture directory to consolidate three workload captures.</p>
<div id="RATUG4091" class="figure">
<p class="titleinfigure"><a id="CHDEFCDA"></a>Figure 13-1 Setting Up the Test System for Consolidated Database Replay</p>
<img width="318" height="423" src="img/ratug006.png" alt="Description of Figure 13-1 follows" /><br />
<a id="sthref291" href="img_text/ratug006.htm">Description of "Figure 13-1 Setting Up the Test System for Consolidated Database Replay"</a><br />
<br /></div>
<!-- class="figure" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDHBJDE">"Setting the Replay Directory Using APIs"</a></div>
</div>
<!-- class="sect2" -->
<a id="CHDJFFGF"></a>
<div id="RATUG4089" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">13.2.3</span> Preprocessing Database Workloads for Consolidated Database Replay</h3>
<p>Preprocessing a database workload for Consolidated Database Replay is similar to preprocessing a database workload for Database Replay, as described in <a href="dbr_preprocess.htm#CHDHCAHI">Chapter 10, "Preprocessing a Database Workload"</a>.</p>
<p>For Consolidated Database Replay, preprocess each captured workload into its own directory. Do not combine different workload captures into one directory for preprocessing. Preprocessing of captured workloads must be performed using a database running the same version of Oracle Database as that of the test system where the workloads will be replayed.</p>
</div>
<!-- class="sect2" -->
<a id="CHDJDHIB"></a>
<div id="RATUG4092" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">13.2.4</span> Replaying Database Workloads for Consolidated Database Replay</h3>
<p>Replaying consolidated workloads using Consolidated Database Replay is quite different from replaying a single database workload using Database Replay.</p>
<p>This section contains the following topics for replaying workloads that are specific to Consolidated Database Replay:</p>
<ul>
<li>
<p><a href="#CHDHDCBF">Defining Replay Schedules</a></p>
</li>
<li>
<p><a href="#CHDIDGHE">Remapping Connections for Consolidated Database Replay</a></p>
</li>
<li>
<p><a href="#CHDBDJCE">Remapping Users for Consolidated Database Replay</a></p>
</li>
<li>
<p><a href="#CHDJIEFD">Preparing for Consolidated Database Replay</a></p>
</li>
<li>
<p><a href="#CHDJCIGH">Replaying Individual Workloads</a></p>
</li>
</ul>
<a id="CHDHDCBF"></a>
<div id="RATUG4093" class="sect3">
<h4 class="sect3"><span class="secnum">13.2.4.1</span> Defining Replay Schedules</h4>
<p>A <a id="sthref292"></a><span class="bold">replay schedule</span> adds one or multiple workload captures to a consolidated replay and specifies the order in which the captures will start during replay. A replay schedule must be created before a consolidated replay can be initialized. Multiple replay schedules can be defined for a consolidated replay. During replay initialization, you can select from any of the existing replay schedules.</p>
<p>Replay schedules perform two types of operation:</p>
<ul>
<li>
<p><a href="#CHDGEJBH">Adding Workload Captures</a></p>
</li>
<li>
<p><a href="#CHDHEICI">Adding Schedule Orders</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDGJDBH">"Defining Replay Schedules Using APIs"</a></div>
<a id="CHDGEJBH"></a>
<div id="RATUG4094" class="sect4">
<h5 class="sect4"><span class="secnum">13.2.4.1.1</span> Adding Workload Captures</h5>
<p>The first type of operation performed by a replay schedule is to add the participating workload captures to a replay.</p>
<p>When a workload capture is added to a replay schedule, a unique number is returned to identify the workload capture. A workload capture can be added to a replay schedule more than once, as it will be assigned a different capture number each time it is added. The replay schedule will point to the same capture directory each time to avoid a waste of disk space by copying the capture each time it is added.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDEFAJI">"Adding Workload Captures to Replay Schedules Using APIs"</a></div>
</div>
<!-- class="sect4" -->
<a id="CHDHEICI"></a>
<div id="RATUG4095" class="sect4">
<h5 class="sect4"><span class="secnum">13.2.4.1.2</span> Adding Schedule Orders</h5>
<p>The second type of operation performed by a replay schedule is to add schedule orders that specify the order in which the participating workload captures will start during replay.</p>
<p>A <a id="sthref293"></a><span class="bold">schedule order</span> defines an order between the start of two workload captures that have been added to the replay schedule. Multiple schedule orders can be added to a replay schedule. For example, assume that a replay schedule has three workload captures added. One schedule order can be added to specify that Capture 2 must wait for Capture 1 to complete before starting. Another schedule order can be added to specify that Capture 3 must wait for Capture 1 to complete before starting. In this case, both Capture 2 and Capture 3 must wait for Capture 1 to complete before starting.</p>
<p>It is possible for a replay schedule to not contain any schedule orders. In this case, all participating workload captures in the replay schedule will start to replay simultaneously when the consolidated replay begins.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDJGAGI">"Adding Schedule Orders to Replay Schedules Using APIs"</a></div>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="CHDIDGHE"></a>
<div id="RATUG4096" class="sect3">
<h4 class="sect3"><span class="secnum">13.2.4.2</span> Remapping Connections for Consolidated Database Replay</h4>
<p>As in the case with replaying a single database workload using Database Replay, captured connection strings used to connect to the production system need to be remapped to the replay system, as described in <a href="dbr_replay.htm#CHDHHDHI">"Remapping Connections"</a>.</p>
<p>For <a id="sthref294"></a>Consolidated Database Replay, you need to remap captured connection strings from multiple workload captures to different connection strings during replay.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDJIDAG">"Remapping Connection Using APIs"</a></div>
</div>
<!-- class="sect3" -->
<a id="CHDBDJCE"></a>
<div id="RATUG4097" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">13.2.4.3</span> Remapping Users for Consolidated Database Replay</h4>
<p>As in the case with replaying a single database workload using Database Replay, usernames of database users and schemas used to connect to the production system can be remapped during replay, as described in <a href="dbr_replay.htm#CBAEAIFB">"User Remapping"</a>.</p>
<p>For <a id="sthref295"></a>Consolidated Database Replay, you can choose to remap the captured users from multiple workload captures to different users or schemas during replay.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDGDEFG">"Remapping Users Using APIs"</a></div>
</div>
<!-- class="sect3" -->
<a id="CHDJIEFD"></a>
<div id="RATUG4098" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">13.2.4.4</span> Preparing for Consolidated Database Replay</h4>
<p>As is the case with replaying a single database workload using Database Replay, replay options are defined during preparation of a replay, as described in <a href="dbr_replay.htm#CHDFAGEA">"Specifying Replay Options"</a>.</p>
<p>For <a id="sthref296"></a>Consolidated Database Replay, all participating workload captures in a consolidated replay use the same replay options during replay that are defined during replay preparation.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDEHJFI">"Preparing for Consolidated Database Replay Using APIs"</a></div>
</div>
<!-- class="sect3" -->
<a id="CHDJCIGH"></a>
<div id="RATUG4099" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">13.2.4.5</span> Replaying Individual Workloads</h4>
<p>It is recommended that each of the participating workloads be replayed individually before replaying the consolidated workload, as described in <a href="dbr_replay.htm#CHDBCADJ">Chapter 11, "Replaying a Database Workload"</a>.</p>
<p>The individual replays can establish a baseline performance for each workload capture and be used to analyze the performance of the consolidated replay.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDIJJIB"></a>
<div id="RATUG4100" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">13.2.5</span> Reporting and Analysis for Consolidated Database Replay</h3>
<p>Reporting and analysis for <a id="sthref297"></a>Consolidated Database Replay is performed using the replay compare period report, as described in <a href="dbr_analyze.htm#CHDIACHF">"Using Compare Period Reports"</a>.</p>
<p>The replay compare period report for Consolidated Database Replay identifies the Active Session History (ASH) data for each individual workload capture and compares the ASH data from the workload capture to the filtered ASH data from the consolidated replay. Use this report to compare replays of the same consolidated workload capture.</p>
<p>The replay compare period report for Consolidated Database Replay treats the consolidated replay as multiple Capture vs. Replay comparisons. The summary section of the report contains a table that summarizes all individual Capture vs. Replay comparisons. Review the information in this section to gain a general understanding of how the consolidated replay ran.</p>
<p><a href="#CHDCBGFE">Figure 13-2</a> shows the summary section of a sample replay compare period report for Consolidated Database Replay.</p>
<div id="RATUG4202" class="figure">
<p class="titleinfigure"><a id="CHDCBGFE"></a>Figure 13-2 Compare Period Report: Consolidated Replay</p>
<img width="837" height="376" src="img/dbr_rep_cons_replay.gif" alt="Description of Figure 13-2 follows" /><br />
<a id="sthref298" href="img_text/dbr_rep_cons_replay.htm">Description of "Figure 13-2 Compare Period Report: Consolidated Replay"</a><br />
<br /></div>
<!-- class="figure" -->
<p>The rest of the sections in the report resemble the ASH Data Comparison section of the replay compare period report and are formed by joining all Capture vs. Replay reports in the consolidated replay. For a description of this section, see <a href="dbr_analyze.htm#BABCFGAB">"ASH Data Comparison"</a>.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CIHIDDFA"></a>
<div id="RATUG4137" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">13.3</span> Using Consolidated Database Replay with Enterprise Manager</h2>
<p>This section describes how to use Consolidated Database Replay with Enterprise Manager.</p>
<p>The primary tool for replaying consolidated database workloads is Oracle Enterprise Manager. If Oracle Enterprise Manager is unavailable, you can also replay consolidated database workloads using APIs, as described in <a href="#CHDGCIFD">"Using Consolidated Database Replay with APIs"</a>.</p>
<p>The process for replaying a consolidated database workload is nearly identical to that of replaying a single database workload. The differences are documented in the procedures for single replays in the following sections:</p>
<ul>
<li>
<p><a href="dbr_preprocess.htm#BABHFAHG">"Creating a Database Replay Task"</a> in <a href="dbr_preprocess.htm#CHDHCAHI">Chapter 10, "Preprocessing a Database Workload"</a></p>
</li>
<li>
<p><a href="dbr_preprocess.htm#BABEAFCF">"Preprocessing the Workload and Deploying the Replay Clients"</a> in <a href="dbr_preprocess.htm#CHDHCAHI">Chapter 10, "Preprocessing a Database Workload"</a></p>
</li>
<li>
<p><a href="dbr_replay.htm#CHDEBCIC">"Replaying a Database Workload Using Enterprise Manager"</a> in <a href="dbr_replay.htm#CHDBCADJ">Chapter 11, "Replaying a Database Workload"</a></p>
</li>
</ul>
<p>The following list provides a summary of the differences between replaying a consolidated database workload versus replaying a single database workload:</p>
<ul>
<li>
<p>When creating a replay task, you need to select two or more captured workloads from the Select Captures table in the Create Task page.</p>
</li>
<li>
<p>The Preprocess Captured Workload: Copy Workload step of the wizard has more than one choice for the Capture Name drop-down, so you may need to enter multiple credentials for the current location of the workload directory.</p>
</li>
<li>
<p>The Preprocess Captured Workload: Select Directory step of the wizard does not display a Capture Summary as it does for single replays.</p>
</li>
<li>
<p>The Replay Workload: Copy Workload step of the wizard has more than one choice for the Capture Name drop-down, so you may need to enter multiple credentials for the current location of the workload directory.</p>
</li>
<li>
<p>The Replay Workload: Select Directory step of the wizard does not display a Capture Summary as it does for single replays.</p>
</li>
<li>
<p>The Replay Workload: Initialize Options step of the wizard does not display the Identify Source section.</p>
</li>
<li>
<p>The Replay Workload: Customize Options step of the wizard has more than one choice for the Capture Name drop-down in the Connection Mappings tab, so you can remap connections for each captured workload. The option to use a single connect descriptor or net service name is not available.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="CHDGCIFD"></a>
<div id="RATUG4102" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">13.4</span> Using Consolidated Database Replay with APIs</h2>
<p><a id="sthref299"></a>This section describes how to create and replay consolidated workloads using the <code>DBMS_WORKLOAD_REPLAY</code> package.</p>
<p>Creating and replay a consolidated workload using APIs is a multi-step process that involves:</p>
<ul>
<li>
<p><a href="#CHDJAJEB">Generating Capture Subsets Using APIs</a></p>
</li>
<li>
<p><a href="#CHDHBJDE">Setting the Replay Directory Using APIs</a></p>
</li>
<li>
<p><a href="#CHDGJDBH">Defining Replay Schedules Using APIs</a></p>
</li>
<li>
<p><a href="#CHDECFGF">Running Consolidated Database Replay Using APIs</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS208" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS208"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>DBMS_WORKLOAD_REPLAY</code> package</div>
<a id="CHDJAJEB"></a>
<div id="RATUG4103" class="sect2">
<h3 class="sect2"><span class="secnum">13.4.1</span> Generating Capture Subsets Using APIs</h3>
<p>This section describes how to generate <a id="sthref300"></a>capture subsets from existing workload captures using the <code>DBMS_WORKLOAD_REPLAY</code> package. For information about capture subsets, see <a href="#CHDEHHBD">"Capture Subsets"</a>.</p>
<p class="orderedlisttitle">To generate a capture subset from existing workload captures:&nbsp;</p>
<ol>
<li>
<p>Use the <a id="sthref302"></a><code>GENERATE_CAPTURE_SUBSET</code> procedure:</p>
<pre>
DBMS_WORKLOAD_REPLAY.GENERATE_CAPTURE_SUBSET (
   input_capture_dir        IN VARCHAR2,
   output_capture_dir       IN VARCHAR2,
   new_capture_name         IN VARCHAR2,
   begin_time               IN NUMBER,
   begin_include_incomplete IN BOOLEAN   DEFAULT TRUE,
   end_time                 IN NUMBER,
   end_include_incomplete   IN BOOLEAN   DEFAULT FALSE,
   parallel_level           IN NUMBER    DEFAULT NULL);
</pre></li>
<li>
<p>Set the <code>input_capture_dir</code> parameter to the name of the directory object that points to an existing workload capture.</p>
</li>
<li>
<p>Set the <code>output_capture_dir</code> parameter to the name of the directory object that points to an empty directory where the new workload capture will be stored.</p>
</li>
<li>
<p>Set the <code>new_capture_name</code> parameter to the name of the new workload capture that is to be generated.</p>
</li>
<li>
<p>Set the other parameters, which are optional, as appropriate.</p>
<p>For information about these parameters, see <a class="olink ARPLS73989" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS73989"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a>.</p>
</li>
</ol>
<p><a href="#CHDHICEA">Example 13-1</a> shows how to create a capture subset named <code>peak_wkld</code> at directory object <code>peak_capdir</code> from an existing workload capture at directory object <code>rec_dir</code>. The capture subset includes workload from 2 hours after the start of the workload capture (or 7,200 seconds) to 3 hours after the start of the workload capture (or 10,800 seconds).</p>
<div id="RATUG4104" class="example">
<p class="titleinexample"><a id="CHDHICEA"></a>Example 13-1 Generating a Capture Subset</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.GENERATE_CAPTURE_SUBSET ('rec_dir', 'peak_capdir',
     'peak_wkld', 7200, TRUE, 10800, FALSE, 1);
</pre></div>
<!-- class="example" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS73988" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS73988"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>GENERATE_CAPTURE_SUBSET</code> procedure</div>
</div>
<!-- class="sect2" -->
<a id="CHDHBJDE"></a>
<div id="RATUG4105" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">13.4.2</span> Setting the Replay Directory Using APIs</h3>
<p>This section describes how to set the <a id="sthref303"></a>replay directory on the test system using the <code>DBMS_WORKLOAD_REPLAY</code> package. Set the replay directory to a directory on the test system that contains the workload captures to be replayed. For information about setting up the test system, see <a href="#CHDBCCFJ">"Setting Up the Test System for Consolidated Database Replay"</a>.</p>
<p class="orderedlisttitle">To set the replay directory:&nbsp;</p>
<ol>
<li>
<p>Use the <a id="sthref305"></a><code>SET_REPLAY_DIRECTORY</code> procedure:</p>
<pre>
DBMS_WORKLOAD_REPLAY.SET_REPLAY_DIRECTORY (
   replay_dir IN VARCHAR2);
</pre></li>
<li>
<p>Set the <code>replay_dir</code> parameter to the name of the directory object that points to the operating system directory containing the workload captures to be used for workload consolidation.</p>
</li>
</ol>
<p><a href="#CHDDHAEB">Example 13-2</a> shows how to set the replay directory to a directory object named <code>rep_dir</code>.</p>
<div id="RATUG4106" class="example">
<p class="titleinexample"><a id="CHDDHAEB"></a>Example 13-2 Setting the Replay Directory</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.SET_REPLAY_DIRECTORY ('rep_dir');
</pre></div>
<!-- class="example" -->
<p>You can also use the <code>DBMS_WORKLOAD_REPLAY</code> package to view the current replay directory that has been set by the <code>SET_REPLAY_DIRECTORY</code> procedure.</p>
<p class="itemizedlisttitle">To view the current replay directory that has been set:&nbsp;</p>
<ul>
<li>
<p>Use the <a id="sthref307"></a><code>GET_REPLAY_DIRECTORY</code> function:</p>
<pre>
DBMS_WORKLOAD_REPLAY.GET_REPLAY_DIRECTORY RETURN VARCHAR2;
</pre>
<p>If no replay directory has been set, then the function returns <code>NULL</code>.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ARPLS73107" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS73107"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>SET_REPLAY_DIRECTORY</code> procedure</p>
</li>
<li>
<p><a class="olink ARPLS73993" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS73993"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>GET_REPLAY_DIRECTORY</code> function</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CHDGJDBH"></a>
<div id="RATUG4107" class="sect2">
<h3 class="sect2"><span class="secnum">13.4.3</span> Defining Replay Schedules Using APIs</h3>
<p>This section describes how to define <a id="sthref308"></a>replay schedules using the <code>DBMS_WORKLOAD_REPLAY</code> package. For information about replay schedules, see <a href="#CHDHDCBF">"Defining Replay Schedules"</a>.</p>
<p>Before defining replay schedules, ensure that the following prerequisites are met:</p>
<ul>
<li>
<p>All workload captures are preprocessed using the <code>PROCESS_CAPTURE</code> procedure on a system running the same database version as the replay system, as described in <a href="dbr_preprocess.htm#CHDHCAHI">Chapter 10, "Preprocessing a Database Workload"</a>.</p>
</li>
<li>
<p>All capture directories are copied to the replay directory on the replay system</p>
</li>
<li>
<p>Replay directory is set using the <code>SET_REPLAY_DIRECTORY</code> procedure, as described in <a href="#CHDHBJDE">"Setting the Replay Directory Using APIs"</a>.</p>
</li>
<li>
<p>Database state is not in replay mode</p>
</li>
</ul>
<p class="orderedlisttitle">To define replay schedules:&nbsp;</p>
<ol>
<li>
<p>Create a new replay schedule, as described in <a href="#CHDIECID">"Creating Replay Schedules Using APIs"</a>.</p>
</li>
<li>
<p>Add workload captures to the replay schedule, as described in <a href="#CHDEFAJI">"Adding Workload Captures to Replay Schedules Using APIs"</a>.</p>
</li>
<li>
<p>Add schedule orders to the replay schedule, as described in <a href="#CHDJGAGI">"Adding Schedule Orders to Replay Schedules Using APIs"</a>.</p>
</li>
<li>
<p>Save the replay schedule, as described in <a href="#CHDCEJAC">"Saving Replay Schedules Using APIs"</a>.</p>
</li>
</ol>
<a id="CHDIECID"></a>
<div id="RATUG4108" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">13.4.3.1</span> Creating Replay Schedules Using APIs</h4>
<p>This section describes how to create <a id="sthref310"></a>replay schedules using the <code>DBMS_WORKLOAD_REPLAY</code> package. For information about replay schedules, see <a href="#CHDHDCBF">"Defining Replay Schedules"</a>.</p>
<p class="orderedlisttitle">To create a replay schedule:&nbsp;</p>
<ol>
<li>
<p>Use the <a id="sthref312"></a><code>BEGIN_REPLAY_SCHEDULE</code> procedure:</p>
<pre>
DBMS_WORKLOAD_REPLAY.BEGIN_REPLAY_SCHEDULE (
   schedule_name  IN VARCHAR2);
</pre></li>
<li>
<p>Set the <code>schedule_name</code> parameter to the name of this replay schedule.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code>BEGIN_REPLAY_SCHEDULE</code> procedure initiates the creation of a reusable replay schedule. Only one replay schedule can be defined at a time. Calling this procedure again while a replay schedule is being defined will result in an error.</div>
<p><a href="#CHDHGBID">Example 13-3</a> shows how to create a replay schedule named <code>peak_schedule</code>.</p>
<div id="RATUG4109" class="example">
<p class="titleinexample"><a id="CHDHGBID"></a>Example 13-3 Creating a Replay Schedule</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.BEGIN_REPLAY_SCHEDULE ('peak_schedule');
</pre></div>
<!-- class="example" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS73985" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS73985"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>BEGIN_REPLAY_SCHEDULE</code> procedure</div>
</div>
<!-- class="sect3" -->
<a id="CHDEFAJI"></a>
<div id="RATUG4110" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">13.4.3.2</span> Adding Workload Captures to Replay Schedules Using APIs</h4>
<p>This section describes how to add <a id="sthref313"></a>workload captures to and remove workload captures from replay schedules using the <code>DBMS_WORKLOAD_REPLAY</code> package. For information about adding workload captures to replay schedules, see <a href="#CHDGEJBH">"Adding Workload Captures"</a>.</p>
<p>Before adding workload captures to a replay schedule, ensure that the following prerequisite is met:</p>
<ul>
<li>
<p>A replay schedule to which the workload captures are to be added is created.</p>
<p>For information about creating a replay schedule, see <a href="#CHDIECID">"Creating Replay Schedules Using APIs"</a>.</p>
</li>
</ul>
<p class="orderedlisttitle">To add workload captures to a replay schedule:&nbsp;</p>
<ol>
<li>
<p>Use the <a id="sthref315"></a><code>ADD_CAPTURE</code> function:</p>
<pre>
DBMS_WORKLOAD_REPLAY.ADD_CAPTURE (
   capture_dir_name    IN VARCHAR2,
   start_delay_seconds IN NUMBER  DEFAULT 0,
   stop_replay         IN BOOLEAN DEFAULT FALSE,
   take_begin_snapshot IN BOOLEAN DEFAULT FALSE,
   take_end_snapshot   IN BOOLEAN DEFAULT FALSE,
   query_only          IN BOOLEAN DEFAULT FALSE)
RETURN NUMBER;
</pre>
<pre>
DBMS_WORKLOAD_REPLAY.ADD_CAPTURE (
   capture_dir_name    IN VARCHAR2,
   start_delay_seconds IN NUMBER,
   stop_replay         IN VARCHAR2,
   take_begin_snapshot IN VARCHAR2 DEFAULT 'N',
   take_end_snapshot   IN VARCHAR2 DEFAULT 'N',
   query_only          IN VARCHAR2 DEFAULT 'N')
RETURN NUMBER;
</pre>
<p>This function returns an unique identifier that identifies the workload capture in this replay schedule.</p>
</li>
<li>
<p>Set the <code>capture_dir_name</code> parameter to the name of the directory object that points to the workload capture under the top-level replay directory.</p>
<p>The directory must contain a valid workload capture that is preprocessed on a system running the same database version as the replay system.</p>
</li>
<li>
<p>Set the other parameters, which are optional, as appropriate.</p>
<p>For information about these parameters, see <a class="olink ARPLS73982" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS73982"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a>.</p>
</li>
</ol>
<p><a href="#CHDJEJEG">Example 13-4</a> shows how to add a workload capture named <code>peak_wkld</code> to a replay schedule by using the <code>ADD_CAPTURE</code> function in a <code>SELECT</code> statement.</p>
<div id="RATUG4111" class="example">
<p class="titleinexample"><a id="CHDJEJEG"></a>Example 13-4 Adding a Workload Capture to a Replay Schedule</p>
<pre>
SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE ('peak_wkld')
  FROM dual;
</pre></div>
<!-- class="example" -->
<p>You can also use the <code>DBMS_WORKLOAD_REPLAY</code> package to remove <a id="sthref316"></a>workload captures from a replay schedule.</p>
<p class="orderedlisttitle">To remove workload captures from a replay schedule:&nbsp;</p>
<ol>
<li>
<p>Use the <a id="sthref318"></a><code>REMOVE_CAPTURE</code> procedure:</p>
<pre>
DBMS_WORKLOAD_REPLAY.REMOVE_CAPTURE (
   schedule_capture_number IN NUMBER);
</pre></li>
<li>
<p>Set the <code>schedule_capture_number</code> parameter to the unique identifier that identifies the workload capture in this replay schedule.</p>
<p>The unique identifier is the same identifier that was returned by the <code>ADD_CAPTURE</code> function when the workload capture was added to the replay schedule.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ARPLS73981" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS73981"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>ADD_CAPTURE</code> function</p>
</li>
<li>
<p><a class="olink ARPLS73998" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS73998"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>REMOVE_CAPTURE</code> procedure</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CHDJGAGI"></a>
<div id="RATUG4112" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">13.4.3.3</span> Adding Schedule Orders to Replay Schedules Using APIs</h4>
<p>This section describes how to add <a id="sthref319"></a>schedule orders to and remove schedule orders from replay schedules using the DBMS_WORKLOAD_REPLAY package. For information about adding schedule orders to replay schedules, see <a href="#CHDHEICI">"Adding Schedule Orders"</a>.</p>
<p>Before adding schedule orders to a replay schedule, ensure that the following prerequisites are met:</p>
<ul>
<li>
<p>A replay schedule to which the schedule orders are to be added is created.</p>
<p>For information about creating a replay schedule, see <a href="#CHDIECID">"Creating Replay Schedules Using APIs"</a>.</p>
</li>
<li>
<p>All workload captures participating in the schedule order are added to the replay schedule.</p>
<p>For information about adding workload captures to a replay schedule, see <a href="#CHDEFAJI">"Adding Workload Captures to Replay Schedules Using APIs"</a>.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Adding schedule orders to a replay schedule is optional. If you do not add a schedule order to a replay schedule, then all workload captures added to the replay schedule will start to replay simultaneously when the consolidated replay begins.</div>
<p class="orderedlisttitle">To add schedule orders to a replay schedule:&nbsp;</p>
<ol>
<li>
<p>Use the <a id="sthref321"></a><code>ADD_SCHEDULE_ORDERING</code> function:</p>
<pre>
DBMS_WORKLOAD_REPLAY.ADD_SCHEDULE_ORDERING (
   schedule_capture_id IN VARCHAR2,
   wait_for_capture_id IN VARCHAR2)
RETURN NUMBER;
</pre>
<p>This function adds a schedule order between two workload captures that have been added to the replay schedule. If a schedule order cannot be added, it returns a non-zero error code.</p>
</li>
<li>
<p>Set the <code>schedule_capture_id</code> parameter to the workload capture that you want to wait in this schedule order.</p>
</li>
<li>
<p>Set the <code>wait_for_capture_id</code> parameter to the workload capture that you want to be completed before the other workload capture can start in this schedule order.</p>
</li>
</ol>
<p>You can also use the DBMS_WORKLOAD_REPLAY package to remove <a id="sthref322"></a>schedule orders from a replay schedule.</p>
<p class="orderedlisttitle">To remove schedule orders from a replay schedule:&nbsp;</p>
<ol>
<li>
<p>Use the <code>REMOVE_SCHEDULE_ORDERING</code> procedure:</p>
<pre>
DBMS_WORKLOAD_REPLAY.REMOVE_SCHEDULE ORDERING (
   schedule_capture_id IN VARCHAR2,
   wait_for_capture_id IN VARCHAR2);
</pre></li>
<li>
<p>Set the <code>schedule_capture_id</code> parameter to the workload capture waiting in this schedule order.</p>
</li>
<li>
<p>Set the <code>wait_for_capture_id</code> parameter to the workload capture that needs to be completed before the other workload capture can start in this schedule order.</p>
</li>
</ol>
<p class="itemizedlisttitle">To view <a id="sthref325"></a>schedule orders:&nbsp;</p>
<ul>
<li>
<p>Use the <code>DBA_WORKLOAD_SCHEDULE_ORDERING</code> view.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ARPLS72130" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS72130"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>ADD_SCHEDULE_ORDERING</code> function</p>
</li>
<li>
<p><a class="olink ARPLS74000" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS74000"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>REMOVE_SCHEDULE_ORDERING</code> procedure</p>
</li>
<li>
<p><a class="olink REFRN23844" href="../../server.112/e40402/statviews_5098.htm#REFRN23844"><span class="italic">Oracle Database Reference</span></a> for information about the <code>DBA_WORKLOAD_SCHEDULE_ORDERING</code> view</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CHDCEJAC"></a>
<div id="RATUG4113" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">13.4.3.4</span> Saving Replay Schedules Using APIs</h4>
<p>This section describes how to save <a id="sthref326"></a>replay schedules that been defined using the <code>DBMS_WORKLOAD_REPLAY</code> package.</p>
<p>Before saving a replay schedule, ensure that the following prerequisites are met:</p>
<ul>
<li>
<p>A replay schedule that will be saved is created.</p>
<p>For information about creating a replay schedule, see <a href="#CHDIECID">"Creating Replay Schedules Using APIs"</a>.</p>
</li>
<li>
<p>All workload captures participating in the schedule order are added to the replay schedule.</p>
<p>For information about adding workload captures to a replay schedule, see <a href="#CHDEFAJI">"Adding Workload Captures to Replay Schedules Using APIs"</a>.</p>
</li>
<li>
<p>Any schedule orders that you want to use are added to the replay schedule (this step is optional).</p>
<p>For information about adding schedule orders to a replay schedule, see <a href="#CHDJGAGI">"Adding Schedule Orders to Replay Schedules Using APIs"</a>.</p>
</li>
</ul>
<p class="itemizedlisttitle">To save a replay schedule:&nbsp;</p>
<ul>
<li>
<p>Use the <a id="sthref328"></a><code>END_REPLAY_SCHEDULE</code> procedure:</p>
<pre>
DBMS_WORKLOAD_REPLAY.END_REPLAY_SCHEDULE;
</pre>
<p>This procedure completes the creation of a replay schedule. The replay schedule is saved and associated with the replay directory. Once a replay schedule is saved, you can use it for a consolidated replay.</p>
</li>
</ul>
<p class="itemizedlisttitle">To view replay schedules:&nbsp;</p>
<ul>
<li>
<p>Use the <code>DBA_WORKLOAD_REPLAY_SCHEDULES</code> view.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ARPLS73987" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS73987"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>END_REPLAY_SCHEDULE</code> procedure</p>
</li>
<li>
<p><a class="olink REFRN23843" href="../../server.112/e40402/statviews_5097.htm#REFRN23843"><span class="italic">Oracle Database Reference</span></a> for information about the <code>DBA_WORKLOAD_REPLAY_SCHEDULES</code> view</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDECFGF"></a>
<div id="RATUG4114" class="sect2">
<h3 class="sect2"><span class="secnum">13.4.4</span> Running Consolidated Database Replay Using APIs</h3>
<p>This section describes how to run <a id="sthref330"></a>Consolidated Database Replay using the <code>DBMS_WORKLOAD_REPLAY</code> package. For information about consolidated replay, see <a href="#CHDJDHIB">"Replaying Database Workloads for Consolidated Database Replay"</a>.</p>
<p>Before running Consolidated Database Replay, ensure that the following prerequisites are met:</p>
<ul>
<li>
<p>All workload captures are preprocessed using the <code>PROCESS_CAPTURE</code> procedure on a system running the same database version as the replay system, as described in <a href="dbr_preprocess.htm#CHDHCAHI">Chapter 10, "Preprocessing a Database Workload"</a>.</p>
</li>
<li>
<p>All capture directories are copied to the replay directory on the replay system</p>
</li>
<li>
<p>Replay directory is set using the <code>SET_REPLAY_DIRECTORY</code> procedure, as described in <a href="#CHDHBJDE">"Setting the Replay Directory Using APIs"</a>.</p>
</li>
<li>
<p>Database is logically restored to the same application state as that of all the capture systems at the start time of all workload captures.</p>
</li>
</ul>
<p class="orderedlisttitle">To run Consolidated Database Replay:&nbsp;</p>
<ol>
<li>
<p>Initialize the replay data, as described in <a href="#CHDIJACF">"Initializing Consolidated Database Replay Using APIs"</a>.</p>
</li>
<li>
<p>Remap connections strings, as described in <a href="#CHDJIDAG">"Remapping Connection Using APIs"</a>.</p>
</li>
<li>
<p>Remap users, as described in <a href="#CHDGDEFG">"Remapping Users Using APIs"</a>.</p>
<p>Remapping users is optional.</p>
</li>
<li>
<p>Prepare the consolidated replay, as described in <a href="#CHDEHJFI">"Preparing for Consolidated Database Replay Using APIs"</a>.</p>
</li>
<li>
<p>Set up and start the replay clients, as described in <a href="dbr_replay.htm#CHDICJHE">"Setting Up Replay Clients"</a>.</p>
</li>
<li>
<p>Start the consolidated replay, as described in <a href="#CHDBIFJC">"Starting Consolidated Database Replay Using APIs"</a>.</p>
</li>
<li>
<p>Generate reports and perform analysis, as described in <a href="#CHDIJJIB">"Reporting and Analysis for Consolidated Database Replay"</a>.</p>
</li>
</ol>
<a id="CHDIJACF"></a>
<div id="RATUG4115" class="sect3">
<h4 class="sect3"><span class="secnum">13.4.4.1</span> Initializing Consolidated Database Replay Using APIs</h4>
<p>This section describes how to <a id="sthref332"></a>initialize the replay data for a consolidated replay using the <code>DBMS_WORKLOAD_REPLAY</code> package.</p>
<p>Initializing the replay data performs the following operations:</p>
<ul>
<li>
<p>Puts the database state in initialized mode for the replay of a consolidated workload.</p>
</li>
<li>
<p>Points to the replay directory that contains all workload captures participating in the replay schedule.</p>
</li>
<li>
<p>Loads the necessary metadata into tables required for replay.</p>
<p>For example, captured connection strings are loaded into a table where they can be remapped for replay.</p>
</li>
</ul>
<p class="orderedlisttitle">To initialize Consolidated Database Replay:&nbsp;</p>
<ol>
<li>
<p>Use the <a id="sthref334"></a><code>INITIALIZED_CONSOLIDATED_REPLAY</code> procedure:</p>
<pre>
DBMS_WORKLOAD_REPLAY.INITIALIZE_CONSOLIDATED_REPLAY (
   replay_name    IN VARCHAR2,
   schedule_name  IN VARCHAR2);
</pre></li>
<li>
<p>Set the <code>replay_name</code> parameter to the name of the consolidated replay.</p>
</li>
<li>
<p>Set the <code>schedule_name</code> parameter to the name of the replay schedule to use.</p>
<p>The <code>schedule_name</code> parameter is the name of the replay schedule used during its creation, as described in <a href="#CHDIECID">"Creating Replay Schedules Using APIs"</a>.</p>
</li>
</ol>
<p><a href="#CHDFAAFB">Example 13-5</a> shows how to initialize a consolidated replay named <code>peak_replay</code> using the replay schedule named <code>peak_schedule</code>.</p>
<div id="RATUG4116" class="example">
<p class="titleinexample"><a id="CHDFAAFB"></a>Example 13-5 Initializing Consolidated Database Replay</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.INITIALIZE_CONSOLIDATED_REPLAY ('peak_replay',
     'peak_schedule');
</pre></div>
<!-- class="example" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS73994" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS73994"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>INITIALIZE_CONSOLIDATED_REPLAY</code> procedure</div>
</div>
<!-- class="sect3" -->
<a id="CHDJIDAG"></a>
<div id="RATUG4117" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">13.4.4.2</span> Remapping Connection Using APIs</h4>
<p>This section describes how to <a id="sthref335"></a>remap connection strings for a consolidated replay using the <code>DBMS_WORKLOAD_REPLAY</code> package. For information about connection remapping, see <a href="#CHDIDGHE">"Remapping Connections for Consolidated Database Replay"</a>.</p>
<p class="orderedlisttitle">To remap connection strings:&nbsp;</p>
<ol>
<li>
<p>Use the <a id="sthref337"></a><code>REMAP_CONNECTION</code> procedure:</p>
<pre>
DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (
   schedule_cap_id   IN NUMBER,
   connection_id     IN NUMBER,
   replay_connection IN VARCHAR2);
</pre>
<p>This procedure remaps the captured connection to a new connection string for all participating workload captures in the replay schedule.</p>
</li>
<li>
<p>Set the <code>schedule_capture_id</code> parameter to a participating workload capture in the current replay schedule.</p>
<p>The <code>schedule_capture_id</code> parameter is the unique identifier returned when adding the workload capture to the replay schedule, as described in <a href="#CHDEFAJI">"Adding Workload Captures to Replay Schedules Using APIs"</a>.</p>
</li>
<li>
<p>Set the <code>connection_id</code> parameter to the connection to be remapped.</p>
<p>The <code>connection_id</code> parameter is generated when replay data is initialized and corresponds to a connection from the workload capture.</p>
</li>
<li>
<p>Set the <code>replay_connection</code> parameter to the new connection string that will be used during replay.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS69093" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS69093"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>REMAP_CONNECTION</code> procedure</div>
</div>
<!-- class="sect3" -->
<a id="CHDGDEFG"></a>
<div id="RATUG4118" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">13.4.4.3</span> Remapping Users Using APIs</h4>
<p>This section describes how to <a id="sthref338"></a>remap users for a consolidated replay using the <code>DBMS_WORKLOAD_REPLAY</code> package. For information about remapping users, see <a href="#CHDBDJCE">"Remapping Users for Consolidated Database Replay"</a>.</p>
<p>Before remapping users, ensure that the following prerequisites are met:</p>
<ul>
<li>
<p>Replay data is initialized, as described in <a href="#CHDIJACF">"Initializing Consolidated Database Replay Using APIs"</a>.</p>
</li>
<li>
<p>The database state is not in replay mode.</p>
</li>
</ul>
<p class="orderedlisttitle">To remap users:&nbsp;</p>
<ol>
<li>
<p>Use the <a id="sthref340"></a><code>SET_USER_MAPPING</code> procedure:</p>
<pre>
DBMS_WORKLOAD_REPLAY.SET_USER_MAPPING (
   schedule_cap_id IN NUMBER,
   capture_user    IN VARCHAR2,
   replay_user     IN VARCHAR2);
</pre></li>
<li>
<p>Set the <code>schedule_capture_id</code> parameter to a participating workload capture in the current replay schedule.</p>
<p>The <code>schedule_capture_id</code> parameter is the unique identifier returned when adding the workload capture to the replay schedule, as described in <a href="#CHDEFAJI">"Adding Workload Captures to Replay Schedules Using APIs"</a>.</p>
</li>
<li>
<p>Set the <code>capture_user</code> parameter to the username of the user or schema captured during the time of the workload capture.</p>
</li>
<li>
<p>Set the <code>replay_user</code> parameter to the username of a new user or schema to which the captured user is remapped during replay.</p>
<p>If this parameter is set to <code>NULL</code>, then the mapping is disabled.</p>
</li>
</ol>
<p><a href="#CHDDIJAC">Example 13-6</a> shows how to remap the <code>PROD</code> user used during capture to the <code>TEST</code> user during replay for the workload capture identified as <code>1001</code>.</p>
<div id="RATUG4119" class="example">
<p class="titleinexample"><a id="CHDDIJAC"></a>Example 13-6 Remapping an User</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.SET_USER_MAPPING (1001, 'PROD', 'TEST');
</pre></div>
<!-- class="example" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS69069" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS69069"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>SET_USER_MAPPING</code> procedure</div>
</div>
<!-- class="sect3" -->
<a id="CHDEHJFI"></a>
<div id="RATUG4120" class="sect3">
<h4 class="sect3"><span class="secnum">13.4.4.4</span> Preparing for Consolidated Database Replay Using APIs</h4>
<p>This section describes how to <a id="sthref341"></a>prepare a consolidated replay using the <code>DBMS_WORKLOAD_REPLAY</code> package. For information about preparing consolidated replays, see <a href="#CHDJIEFD">"Preparing for Consolidated Database Replay"</a>.</p>
<p>Before preparing a consolidated replay, ensure that the following prerequisites are met:</p>
<ul>
<li>
<p>Replay data is initialized, as described in <a href="#CHDIJACF">"Initializing Consolidated Database Replay Using APIs"</a>.</p>
</li>
<li>
<p>Captured connections are remapped, as described in <a href="#CHDJIDAG">"Remapping Connection Using APIs"</a>.</p>
</li>
<li>
<p>Users are mapped, as described in <a href="#CHDGDEFG">"Remapping Users Using APIs"</a>.</p>
<p>Remapping users is optional. However, if you are planning to remap users during replay, then it must be completed before preparing the consolidated replay.</p>
</li>
</ul>
<p>Preparing a consolidated replay performs the following operations:</p>
<ul>
<li>
<p>Specifies the replay options, such as synchronization mode (or <code>COMMIT</code> order), session connection rate, and session request rate.</p>
</li>
<li>
<p>Puts the database state in replay mode.</p>
</li>
<li>
<p>Enables the start of replay clients.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Consolidated Database Replay only supports unsynchronized mode and <code>OBJECT_ID</code>-based synchronization. SCN-based synchronization is currently not supported.</div>
<p class="itemizedlisttitle">To prepare a consolidated replay:&nbsp;</p>
<ul>
<li>
<p>Use the <a id="sthref343"></a><code>PREPARE_CONSOLIDATED_REPLAY</code> procedure:</p>
<pre>
DBMS_WORKLOAD_REPLAY.PREPARE_CONSOLIDATED_REPLAY (
   synchronization         IN VARCHAR2 DEFAULT 'OBJECT_ID',
   connect_time_scale      IN NUMBER   DEFAULT 100,
   think_time_scale        IN NUMBER   DEFAULT 100,
   think_time_auto_correct IN BOOLEAN  DEFAULT TRUE,
   capture_sts             IN BOOLEAN  DEFAULT FALSE,
   sts_cap_interval        IN NUMBER   DEFAULT 300);
</pre>
<p>For information about these parameters and how to set them, see <a href="dbr_replay.htm#CHDFAGEA">"Specifying Replay Options"</a>.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS73996" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS73996"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>PREPARE_CONSOLIDATED_REPLAY</code> procedure</div>
</div>
<!-- class="sect3" -->
<a id="CHDBIFJC"></a>
<div id="RATUG4121" class="sect3">
<h4 class="sect3"><span class="secnum">13.4.4.5</span> Starting Consolidated Database Replay Using APIs</h4>
<p>This section describes how to <a id="sthref344"></a>start a consolidated replay using the <code>DBMS_WORKLOAD_REPLAY</code> package.</p>
<p>Before starting a consolidated replay, ensure that the following prerequisites are met:</p>
<ul>
<li>
<p>The consolidated replay is prepared, as described in <a href="#CHDEHJFI">"Preparing for Consolidated Database Replay Using APIs"</a>.</p>
</li>
<li>
<p>An adequate number of replay clients are started.</p>
<p>For information about setting up and starting replay clients, see <a href="dbr_replay.htm#CHDICJHE">"Setting Up Replay Clients"</a>.</p>
</li>
</ul>
<p class="itemizedlisttitle">To start a consolidated replay:&nbsp;</p>
<ul>
<li>
<p>Use the <a id="sthref346"></a><code>START_CONSOLIDATED_REPLAY</code> procedure:</p>
<pre>
DBMS_WORKLOAD_REPLAY.START_CONSOLIDATED_REPLAY;
</pre></li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS74454" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS74454"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>START_CONSOLIDATED_REPLAY</code> procedure</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDIABAE"></a>
<div id="RATUG4210" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">13.5</span> Examples: Using Consolidated Database Replay</h2>
<p>This section contains the following examples of using workload scale-up techniques with Consolidated Database Replay to perform stress testing and scale-up testing:</p>
<ul>
<li>
<p><a href="#CHDFFBIH">Using Time Shifting</a></p>
</li>
<li>
<p><a href="#CHDCGCCA">Using Workload Folding</a></p>
</li>
<li>
<p><a href="#CHDJBACI">Using Schema Remapping</a></p>
</li>
</ul>
<a id="CHDFFBIH"></a>
<div id="RATUG4211" class="sect2">
<h3 class="sect2"><span class="secnum">13.5.1</span> Using Time Shifting</h3>
<p>This section describes how to use time shifting with Consolidated Database Replay, and assumes a scenario where you want to use time shifting to align the peaks of workloads captured from three applications and replay them simultaneously. The scenario demonstrates how to use time shifting for stress testing. For more information about time shifting, see <a href="#CHDDGCEB">"About Time Shifting"</a>.</p>
<p>This scenario uses the following assumptions:</p>
<ul>
<li>
<p>The first workload is captured from the Sales application.</p>
</li>
<li>
<p>The second workload is captured from the CRM application and its peak time occurs 1 hour before that of the Sales workload.</p>
</li>
<li>
<p>The third workload is captured from the DW application and its peak time occurs 30 minutes before that of the Sales workload.</p>
</li>
<li>
<p>To align the peaks of these workloads, time shifting is performed by adding a delay of one hour to the CRM workload and a delay of 30 minutes to the DW workload during replay.</p>
</li>
</ul>
<p class="orderedlisttitle">To perform time shifting in this scenario:&nbsp;</p>
<ol>
<li>
<p>On the replay system which will undergo stress testing, create a directory object for the root directory where the captured workloads are stored:</p>
<pre>
CREATE OR REPLACE DIRECTORY cons_dir AS '/u01/test/cons_dir';
</pre></li>
<li>
<p>Preprocess the individual workload captures into separate directories:</p>
<ul>
<li>
<p>For the Sales workload:</p>
<ol>
<li>
<p>Create a directory object:</p>
<pre>
CREATE OR REPLACE DIRECTORY sales AS '/u01/test/cons_dir/cap_sales';
</pre></li>
<li>
<p>Ensure that the captured workload from the Sales application is stored in this directory.</p>
</li>
<li>
<p>Preprocess the workload:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE ('SALES');
</pre></li>
</ol>
</li>
<li>
<p>For the CRM workload:</p>
<ol>
<li>
<p>Create a directory object:</p>
<pre>
CREATE OR REPLACE DIRECTORY crm AS '/u01/test/cons_dir/cap_crm';
</pre></li>
<li>
<p>Ensure that the captured workload from the CRM application is stored in this directory.</p>
</li>
<li>
<p>Preprocess the workload:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE ('CRM');
</pre></li>
</ol>
</li>
<li>
<p>For the DW workload:</p>
<ol>
<li>
<p>Create a directory object:</p>
<pre>
CREATE OR REPLACE DIRECTORY DW AS '/u01/test/cons_dir/cap_dw';
</pre></li>
<li>
<p>Ensure that the captured workload from the DW application is stored in this directory.</p>
</li>
<li>
<p>Preprocess the workload:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE ('DW');
</pre></li>
</ol>
</li>
</ul>
</li>
<li>
<p>Set the replay directory to the root directory:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.SET_REPLAY_DIRECTORY ('CONS_DIR');
</pre></li>
<li>
<p>Create a replay schedule and add the workload captures:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.BEGIN_REPLAY_SCHEDULE ('align_peaks_schedule');
SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE ('SALES') FROM dual;
SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE ('CRM', 3600) FROM dual;
SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE ('DW', 1800) FROM dual;
EXEC DBMS_WORKLOAD_REPLAY.END_REPLAY_SCHEDULE;
</pre>
<p>Note that a delay of 3,600 seconds (or 1 hour) is added to the CRM workload, and a delay of 1,800 seconds (or 30 minutes) is added to the DW workload.</p>
</li>
<li>
<p>Initialize the consolidated replay:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.INITIALIZE_CONSOLIDATED_REPLAY ('align_peaks_replay',
                          'align_peaks_schedule');
</pre></li>
<li>
<p>Remap connections:</p>
<ol>
<li>
<p>Query the <code>DBA_WORKLOAD_CONNECTION_MAP</code> view for the connection mapping information:</p>
<pre>
SELECT schedule_cap_id, conn_id, capture_conn, replay_conn
  FROM dba_workload_connection_map;
</pre></li>
<li>
<p>Remap the connections:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 1,
     conn_id =&gt; 1, replay_connection =&gt; 'inst1');
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 1,
     conn_id =&gt; 2, replay_connection =&gt; 'inst1');
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 2,
     conn_id =&gt; 1, replay_connection =&gt; 'inst2');
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 2,
     conn_id =&gt; 2, replay_connection =&gt; 'inst2');
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 3,
     conn_id =&gt; 1, replay_connection =&gt; 'inst3');
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 3,
     conn_id =&gt; 2, replay_connection =&gt; 'inst3');
</pre>
<p>The <code>replay_connection</code> parameter represents the services that are defined on the test system.</p>
</li>
<li>
<p>Verify the connection remappings:</p>
<pre>
SELECT schedule_cap_id, conn_id, capture_conn, replay_conn
  FROM dba_workload_connection_map;
</pre></li>
</ol>
</li>
<li>
<p>Prepare the consolidated replay:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.PREPARE_CONSOLIDATED_REPLAY;
</pre></li>
<li>
<p>Start replay clients:</p>
<ol>
<li>
<p>Estimate the number of replay clients that are required:</p>
<pre>
wrc mode=calibrate replaydir=/u01/test/cons_dir/cap_sales
wrc mode=calibrate replaydir=/u01/test/cons_dir/cap_crm
wrc mode=calibrate replaydir=/u01/test/cons_dir/cap_dw
</pre></li>
<li>
<p>Add the output to determine the number of replay clients required.</p>
<p>You will need to start at least one replay client per workload capture contained in the consolidated workload.</p>
</li>
<li>
<p>Start the required number of replay clients by repeating this command:</p>
<pre>
wrc <span class="italic">username</span>/<span class="italic">password</span> mode=replay replaydir=/u01/test/cons_dir
</pre>
<p>The <code>replaydir</code> parameter is set to the root directory in which the workload captures are stored.</p>
</li>
</ol>
</li>
<li>
<p>Start the consolidated replay:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.START_CONSOLIDATED_REPLAY;
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CHDCGCCA"></a>
<div id="RATUG4212" class="sect2">
<h3 class="sect2"><span class="secnum">13.5.2</span> Using Workload Folding</h3>
<p>This section describes how to use workload folding with Consolidated Database Replay, and assumes a scenario where you want to use workload folding to triple a captured workload. The scenario demonstrates how to use workload folding for scale-up testing. For more information about workload folding, see <a href="#CHDCGBCH">"About Workload Folding"</a>.</p>
<p>This scenario uses the following assumptions:</p>
<ul>
<li>
<p>The original workload was captured from 2 a.m. to 8 p.m. and folded into three capture subsets.</p>
</li>
<li>
<p>The first capture subset contains part of the original workload from 2 a.m. to 8 a.m.</p>
</li>
<li>
<p>The second capture subset contains part of the original workload from 8 a.m. to 2 p.m.</p>
</li>
<li>
<p>The third capture subset contains part of the original workload from 2 p.m. to 8 p.m.</p>
</li>
<li>
<p>To triple the workload during replay, workload folding is performed by replaying the three capture subsets simultaneously.</p>
</li>
</ul>
<p class="orderedlisttitle">To perform workload folding in this scenario:&nbsp;</p>
<ol>
<li>
<p>On the replay system where you plan to perform scale-up testing, create a directory object for the root directory where the captured workloads are stored:</p>
<pre>
CREATE OR REPLACE DIRECTORY cons_dir AS '/u01/test/cons_dir';
</pre></li>
<li>
<p>Create a directory object for the directory where the original workload is stored:</p>
<pre>
CREATE OR REPLACE DIRECTORY cap_monday AS '/u01/test/cons_dir/cap_monday';
</pre></li>
<li>
<p>Create directory objects for the directories where you are planning to store the capture subsets:</p>
<ol>
<li>
<p>Create a directory object for the first capture subset:</p>
<pre>
CREATE OR REPLACE DIRECTORY cap_mon_2am_8am
                           AS '/u01/test/cons_dir/cap_monday_2am_8am';
</pre></li>
<li>
<p>Create a directory object for the second capture subset:</p>
<pre>
CREATE OR REPLACE DIRECTORY cap_mon_8am_2pm
                           AS '/u01/test/cons_dir/cap_monday_8am_2pm';
</pre></li>
<li>
<p>Create a directory object for the third capture subset:</p>
<pre>
CREATE OR REPLACE DIRECTORY cap_mon_2pm_8pm
                           AS '/u01/test/cons_dir/cap_monday_2pm_8pm';
</pre></li>
</ol>
</li>
<li>
<p>Create the capture subsets:</p>
<ol>
<li>
<p>Generate the first capture subset for the time period from 2 a.m. to 8 a.m.:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.GENERATE_CAPTURE_SUBSET ('CAP_MONDAY',
                          'CAP_MON_2AM_8AM', 'mon_2am_8am_wkld',
                          0, TRUE, 21600, FALSE, 1);
</pre></li>
<li>
<p>Generate the second capture subset for the time period from 8 a.m. to 2 p.m.:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.GENERATE_CAPTURE_SUBSET ('CAP_MONDAY',
                          'CAP_MON_8AM_2PM', 'mon_8am_2pm_wkld',
                          21600, TRUE, 43200, FALSE, 1);
</pre></li>
<li>
<p>Generate the third capture subset for the time period from 2 p.m. to 8 p.m.:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.GENERATE_CAPTURE_SUBSET ('CAP_MONDAY',
                          'CAP_MON_2PM_8PM', 'mon_2pm_8pm_wkld',
                          43200, TRUE, 0, FALSE, 1);
</pre></li>
</ol>
</li>
<li>
<p>Preprocess the capture subsets:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE ('CAP_MON_2AM_8AM');
EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE ('CAP_MON_8AM_2PM');
EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE ('CAP_MON_2PM_8PM');
</pre></li>
<li>
<p>Set the replay directory to the root directory:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.SET_REPLAY_DIRECTORY ('CONS_DIR');
</pre></li>
<li>
<p>Create a replay schedule and add the capture subsets:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.BEGIN_REPLAY_SCHEDULE ('monday_folded_schedule');
SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE ('CAP_MON_2AM_8AM') FROM dual;
SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE ('CAP_MON_8AM_2PM') FROM dual;
SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE ('CAP_MON_2PM_8PM') FROM dual;
EXEC DBMS_WORKLOAD_REPLAY.END_REPLAY_SCHEDULE;
</pre></li>
<li>
<p>Initialize the consolidated replay:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.INITIALIZE_CONSOLIDATED_REPLAY (
                          'monday_folded_replay', 'monday_folded_schedule);
</pre></li>
<li>
<p>Remap connections:</p>
<ol>
<li>
<p>Query the <code>DBA_WORKLOAD_CONNECTION_MAP</code> view for the connection mapping information:</p>
<pre>
SELECT schedule_cap_id, conn_id, capture_conn, replay_conn
  FROM dba_workload_connection_map;
</pre></li>
<li>
<p>Remap the connections:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 1,
     conn_id =&gt; 1, replay_connection =&gt; 'inst1');
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 1,
     conn_id =&gt; 2, replay_connection =&gt; 'inst1');
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 2,
     conn_id =&gt; 1, replay_connection =&gt; 'inst2');
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 2,
     conn_id =&gt; 2, replay_connection =&gt; 'inst2');
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 3,
     conn_id =&gt; 1, replay_connection =&gt; 'inst3');
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 3,
     conn_id =&gt; 2, replay_connection =&gt; 'inst3');
</pre>
<p>The <code>replay_connection</code> parameter represents the services that are defined on the test system.</p>
</li>
<li>
<p>Verify the connection remappings:</p>
<pre>
SELECT schedule_cap_id, conn_id, capture_conn, replay_conn
  FROM dba_workload_connection_map;
</pre></li>
</ol>
</li>
<li>
<p>Prepare the consolidated replay:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.PREPARE_CONSOLIDATED_REPLAY;
</pre></li>
<li>
<p>Start replay clients:</p>
<ol>
<li>
<p>Estimate the number of replay clients that are required:</p>
<pre>
wrc mode=calibrate replaydir=/u01/test/cons_dir/cap_monday_2am_8am
wrc mode=calibrate replaydir=/u01/test/cons_dir/cap_monday_8am_2pm
wrc mode=calibrate replaydir=/u01/test/cons_dir/cap_monday_2pm_8pm
</pre></li>
<li>
<p>Add the output to determine the number of replay clients required.</p>
<p>You will need to start at least one replay client per workload capture contained in the consolidated workload.</p>
</li>
<li>
<p>Start the required number of replay clients by repeating this command:</p>
<pre>
wrc <span class="italic">username</span>/<span class="italic">password</span> mode=replay replaydir=/u01/test/cons_dir
</pre>
<p>The <code>replaydir</code> parameter is set to the root directory in which the workload captures are stored.</p>
</li>
</ol>
</li>
<li>
<p>Start the consolidated replay:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.START_CONSOLIDATED_REPLAY;
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CHDJBACI"></a>
<div id="RATUG4213" class="sect2">
<h3 class="sect2"><span class="secnum">13.5.3</span> Using Schema Remapping</h3>
<p>This section describes how to use schema remapping with Consolidated Database Replay, and assumes a scenario where you want to use schema remapping to identify possible host bottlenecks when deploying multiple instances of an application. The scenario demonstrates how to use schema remapping for scale-up testing. For more information about schema remapping, see <a href="#CHDFACII">"About Schema Remapping"</a>.</p>
<p>This scenario uses the following assumptions:</p>
<ul>
<li>
<p>A single workload exists that is captured from the Sales application.</p>
</li>
<li>
<p>To set up the replay system with multiple schemas from the Sales schema, schema remapping is performed by adding the captured workload multiple times into a replay schedule and remapping the users to different schemas.</p>
</li>
</ul>
<p class="orderedlisttitle">To perform schema remapping in this scenario:&nbsp;</p>
<ol>
<li>
<p>On the replay system where you plan to perform scale-up testing, create a directory object for the root directory where the captured workloads are stored:</p>
<pre>
CREATE OR REPLACE DIRECTORY cons_dir AS '/u01/test/cons_dir';
</pre></li>
<li>
<p>Create a directory object for the directory where the captured workload is stored:</p>
<pre>
CREATE OR REPLACE DIRECTORY cap_sales AS '/u01/test/cons_dir/cap_sales';
</pre>
<p>Ensure that the captured workload from the Sales application is stored in this directory.</p>
</li>
<li>
<p>Preprocess the captured workload:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE ('CAP_SALES');
</pre></li>
<li>
<p>Set the replay directory to the root directory:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.SET_REPLAY_DIRECTORY ('CONS_DIR');
</pre></li>
<li>
<p>Create a replay schedule and add the captured workload multiple times:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.BEGIN_REPLAY_SCHEDULE ('double_sales_schedule');
SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE ('CAP_SALES') FROM dual;
SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE ('CAP_SALES') FROM dual;
EXEC DBMS_WORKLOAD_REPLAY.END_REPLAY_SCHEDULE;
</pre></li>
<li>
<p>Initialize the consolidated replay:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.INITIALIZE_CONSOLIDATED_REPLAY (
                          'double_sales_replay', 'double_sales_schedule);
</pre></li>
<li>
<p>Remap the users:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.SET_USER_MAPPING (2, 'sales_usr', 'sales_usr_2');
</pre></li>
<li>
<p>Prepare the consolidated replay:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.PREPARE_CONSOLIDATED_REPLAY;
</pre></li>
<li>
<p>Start replay clients:</p>
<ol>
<li>
<p>Estimate the number of replay clients that are required:</p>
<pre>
wrc mode=calibrate replaydir=/u01/test/cons_dir/cap_sales
</pre></li>
<li>
<p>Add the output to determine the number of replay clients required.</p>
<p>You will need to start at least one replay client per workload capture contained in the consolidated workload.</p>
</li>
<li>
<p>Start the required number of replay clients by repeating this command:</p>
<pre>
wrc <span class="italic">username</span>/<span class="italic">password</span> mode=replay replaydir=/u01/test/cons_dir
</pre>
<p>The <code>replaydir</code> parameter is set to the root directory in which the workload captures are stored.</p>
</li>
</ol>
</li>
<li>
<p>Start the consolidated replay:</p>
<pre>
EXEC DBMS_WORKLOAD_REPLAY.START_CONSOLIDATED_REPLAY;
</pre></li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1798">
<tr>
<td class="cellalignment1805">
<table class="cellalignment1803">
<tr>
<td class="cellalignment1802"><a href="dbr_analyze.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1802"><a href="part3.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2008, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1807">
<table class="cellalignment1801">
<tr>
<td class="cellalignment1802"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1802"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1802"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1802"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1802"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1802"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
