<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Replaying a Database Workload</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 740" />
<meta name="dcterms.created" content="2014-06-16T16:24:50Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Real Application Testing User's Guide" />
<meta name="dcterms.identifier" content="E41481-03" />
<meta name="dcterms.isVersionOf" content="RATUG" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2008, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="dbr_preprocess.htm" title="Previous" type="text/html" />
<link rel="Next" href="dbr_analyze.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e41481.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">16/23</span> <!-- End Header -->
<div id="RATUG131" class="chapter"><a id="CHDBCADJ"></a>
<h1 class="chapter"><span class="secnum">11</span> Replaying a Database Workload</h1>
<p>After a captured workload is preprocessed, it can be <a id="sthref213"></a>replayed repeatedly on a replay system that is running the same version of Oracle Database. Typically, the replay system where the preprocessed workload will be replayed should be a test system that is separate from the production system.</p>
<p>This chapter describes how to replay a database workload on the test system and contains the following sections:</p>
<ul>
<li>
<p><a href="#CHDHHDGE">Steps for Replaying a Database Workload</a></p>
</li>
<li>
<p><a href="#CHDEBCIC">Replaying a Database Workload Using Enterprise Manager</a></p>
</li>
<li>
<p><a href="#BGBGAEII">Setting Up the Replay Schedule and Parameters Using Enterprise Manager</a></p>
</li>
<li>
<p><a href="#CHDFDCCB">Monitoring a Workload Replay Using Enterprise Manager</a></p>
</li>
<li>
<p><a href="#BGBEJGJI">Importing a Replay External to Enterprise Manager</a></p>
</li>
<li>
<p><a href="#CHDGECHD">Replaying a Database Workload Using APIs</a></p>
</li>
<li>
<p><a href="#BABDHJJD">Monitoring Workload Replay Using APIs</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
Before you can replay a database workload, you must first:
<ul>
<li>
<p>Capture the workload on the production system, as described in <a href="dbr_capture.htm#CACICAAC">Chapter 9, "Capturing a Database Workload"</a></p>
</li>
<li>
<p>Preprocess the captured workload, as described in <a href="dbr_preprocess.htm#CHDHCAHI">Chapter 10, "Preprocessing a Database Workload"</a></p>
</li>
</ul>
</div>
<a id="CHDHHDGE"></a>
<div id="RATUG135" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">11.1</span> Steps for Replaying a Database Workload</h2>
<p>Proper planning of the workload replay and preparation of the replay system ensures that the replay will be accurate. <a id="sthref214"></a>Before replaying a database workload, review and complete the following steps as appropriate:</p>
<ul>
<li>
<p><a href="#CHDJBBFI">Setting Up the Replay Directory</a></p>
</li>
<li>
<p><a href="#CHDBFBCA">Restoring the Database</a></p>
</li>
<li>
<p><a href="#CHDBIBHI">Resolving References to External Systems</a></p>
</li>
<li>
<p><a href="#CHDHHDHI">Remapping Connections</a></p>
</li>
<li>
<p><a href="#CBAEAIFB">User Remapping</a></p>
</li>
<li>
<p><a href="#CHDFAGEA">Specifying Replay Options</a></p>
</li>
<li>
<p><a href="#BABIFBHG">Using Filters with Workload Replay</a></p>
</li>
<li>
<p><a href="#CHDICJHE">Setting Up Replay Clients</a></p>
</li>
</ul>
<a id="CHDJBBFI"></a>
<div id="RATUG136" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.1.1</span> Setting Up the Replay Directory</h3>
<p>The captured workload must have been preprocessed and copied to the replay system. A directory object for the directory to which the preprocessed workload is copied must exist in the replay system.</p>
</div>
<!-- class="sect2" -->
<a id="CHDBFBCA"></a>
<div id="RATUG133" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.1.2</span> Restoring the Database</h3>
<p>Before a workload can be replayed, the application data state of the replay system should be logically equivalent to that of the capture system at the start time of workload capture. This minimizes replay divergence during replay. The method for restoring the database depends on the backup method that was used before capturing the workload. For example, if RMAN was used to back up the capture system, you can use RMAN <code>DUPLICATE</code> capabilities to create the test database. For more information, see <a href="dbr_capture.htm#CACBJJIC">"Prerequisites for Capturing a Database Workload"</a>.</p>
<p>After the database is created with the appropriate application data on the replay system, perform the system change you want to test, such as a database or operating system upgrade. The primary purpose of Database Replay is to test the effect of system changes on a captured workload. Therefore, the system changes you make should define the test you are conducting with the captured workload.</p>
</div>
<!-- class="sect2" -->
<a id="CHDBIBHI"></a>
<div id="RATUG137" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.1.3</span> Resolving References to External Systems</h3>
<p>A captured workload may contain references to external systems, such as database links or external tables. Typically, you should reconfigure these external interactions to avoid impacting other production systems during replay. External references that need to be resolved before replaying a workload include:</p>
<ul>
<li>
<p>Database links</p>
<p>It is typically not desirable for the replay system to interact with other databases. Therefore, you should reconfigure all database links to point to an appropriate database that contains the data needed for replay.</p>
</li>
<li>
<p>External tables</p>
<p>All external files specified using directory objects referenced by external tables need to be available to the database during replay. The content of these files should be the same as during capture, and the filenames and directory objects used to define the external tables should also be valid.</p>
</li>
<li>
<p>Directory objects</p>
<p>You should reconfigure any references to directories on the production system by appropriately redefining the directory objects present in the replay system after restoring the database.</p>
</li>
<li>
<p>URLs</p>
<p>URLs/URIs that are stored in the database need to be configured so that Web services accessed during the workload capture will point to the proper URLs during replay. If the workload refers to URLs that are stored in the production system, you should isolate the test system network during replay.</p>
</li>
<li>
<p>E-mails</p>
<p>To avoid resending E-mail notifications during replay, any E-mail server accessible to the replay system should be configured to ignore requests for outgoing E-mails.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
To avoid impacting other production systems during replay, Oracle strongly recommends running the replay within an isolated private network that does not have access to the production environment hosts.</div>
</div>
<!-- class="sect2" -->
<a id="CHDHHDHI"></a>
<div id="RATUG138" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.1.4</span> Remapping Connections</h3>
<p>During workload capture, connection strings used to connect to the production system are captured. In order for the replay to succeed, you need to remap these connection strings to the replay system. The replay clients can then connect to the replay system using the remapped connections.</p>
<p>For Oracle Real Application Clusters (Oracle RAC) databases, you can map all connection strings to a load balancing connection string. This is especially useful if the number of nodes on the replay system is different from the capture system. Alternatively, if you want to direct workload to specific instances, you can use services or explicitly specify the instance identifier in the remapped connection strings.</p>
</div>
<!-- class="sect2" -->
<a id="CBAEAIFB"></a>
<div id="RATUG4204" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.1.5</span> User Remapping</h3>
<p>During workload capture, the username of the database user or schema used to connect to the production system is captured. You can choose to remap the captured username to that of a new user or schema.</p>
</div>
<!-- class="sect2" -->
<a id="CHDFAGEA"></a>
<div id="RATUG139" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.1.6</span> Specifying Replay Options</h3>
<p>After the database is restored and connections are remapped, you can set the following <a id="sthref215"></a>replay options as appropriate:</p>
<ul>
<li>
<p><a href="#CHDGJICA">Preserving COMMIT Order</a></p>
</li>
<li>
<p><a href="#CHDGJFHE">Controlling Session Connection Rate</a></p>
</li>
<li>
<p><a href="#CHDEJEAC">Controlling Request Rate Within a Session</a></p>
</li>
</ul>
<a id="CHDGJICA"></a>
<div id="RATUG140" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">11.1.6.1</span> Preserving COMMIT Order</h4>
<p>The <code>synchronization</code> parameter controls whether the <code>COMMIT</code> order in the captured workload will be preserved during replay.</p>
<p>If this parameter is set to <code>SCN</code>, the <code>COMMIT</code> order in the captured workload will be preserved during replay and all replay actions will be executed only after all dependent <code>COMMIT</code> actions have completed.</p>
<p>If this parameter is set to <code>OBJECT_ID</code>, all replay actions will be executed only after all relevant <code>COMMIT</code> actions have completed. Relevant <code>COMMIT</code> actions must meet the following criteria:</p>
<ul>
<li>
<p>Issued before the given action in the workload capture</p>
</li>
<li>
<p>Modified at least one of the database objects for which the given action is referencing, either implicitly or explicitly</p>
</li>
</ul>
<p>Setting this parameter to <code>OBJECT_ID</code> allows for more concurrency during workload replays for <code>COMMIT</code> actions that do not reference the same database objects during workload capture.</p>
<p>You can disable this option by setting the parameter to <code>OFF</code>, but the replay will likely yield significant replay divergence. However, this may be desirable if the workload consists primarily of independent transactions, and divergence during unsynchronized replay is acceptable.</p>
</div>
<!-- class="sect3" -->
<a id="CHDGJFHE"></a>
<div id="RATUG141" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">11.1.6.2</span> Controlling Session Connection Rate</h4>
<p>The <code>connect_time_scale</code> parameter enables you to scale the elapsed time between the time when the workload capture began and each session connects. You can use this option to manipulate the session connect time during replay with a given percentage value. The default value is 100, which will attempt to connect all sessions as captured. Setting this parameter to 0 will attempt to connect all sessions immediately.</p>
</div>
<!-- class="sect3" -->
<a id="CHDEJEAC"></a>
<div id="RATUG142" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">11.1.6.3</span> Controlling Request Rate Within a Session</h4>
<p>User think time is the elapsed time while the replayed user waits between issuing calls within a single session. To control replay speed, use the <code>think_time_scale</code> parameter to scale user think time during replay.</p>
<p>If user calls are being executed slower during replay than during capture, you can make the database replay attempt to catch up by setting the <code>think_time_auto_correct</code> parameter to <code>TRUE</code>. This will make the replay client shorten the think time between calls, so that the overall elapsed time of the replay will more closely match the captured elapsed time.</p>
<p>If user calls are being executed faster during replay than during capture, setting the <code>think_time_auto_correct</code> parameter to <code>TRUE</code> will not change the think time. The replay client will not increase the think time between calls to match the captured elapsed time.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BABIFBHG"></a>
<div id="RATUG261" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.1.7</span> Using Filters with Workload Replay</h3>
<p>By default, all captured database calls are replayed during workload replay. You can use <a id="sthref216"></a>workload filters to specify which database calls to include in or exclude from the workload during workload replay.</p>
<p>Workload replay filters are first defined and then added to a <a id="sthref217"></a>replay filter set so they can be used in a workload replay. There are two types of workload filters: inclusion filters and exclusion filters. <a id="sthref218"></a>Inclusion filters enable you to specify database calls that will be replayed. <a id="sthref219"></a>Exclusion filters enable you to specify database calls that will not be replayed. You can use either inclusion filters or exclusion filters in a workload replay, but not both. The workload filter is determined as an inclusion or exclusion filter when the replay filter set is created.</p>
</div>
<!-- class="sect2" -->
<a id="CHDICJHE"></a>
<div id="RATUG143" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.1.8</span> Setting Up Replay Clients</h3>
<p>The <a id="sthref220"></a>replay client is a multithreaded program (an executable named <code>wrc</code> located in the <code>$ORACLE_HOME/bin</code> directory) where each thread submits a workload from a captured session. Before replay begins, the database will wait for replay clients to connect. At this point, you need to set up and start the replay clients, which will connect to the replay system and send requests based on what has been captured in the workload.</p>
<p>Before starting <a id="sthref221"></a>replay clients, ensure that the:</p>
<ul>
<li>
<p>Replay client software is installed on the hosts where it will run</p>
</li>
<li>
<p>Replay clients have access to the replay directory</p>
</li>
<li>
<p>Replay directory contains the preprocessed workload capture</p>
</li>
<li>
<p>Replay user has the correct user ID, password, and privileges (the replay user needs the DBA role and cannot be the <code>SYS</code> user)</p>
</li>
<li>
<p>Replay clients are not started on a system that is running the database</p>
</li>
<li>
<p>Replay clients read the capture directory on a file system that is different from the one on which the database files reside</p>
<p>To do this, copy the capture directory to the system where the replay client will run. After the replay is completed, you can delete the capture directory.</p>
</li>
</ul>
<p>After these prerequisites are met, you can proceed to set up and start the replay clients using the <code>wrc</code> executable. The <code>wrc</code> executable uses the following syntax:</p>
<pre>
wrc [user/password[@server]] MODE=[value] [keyword=[value]]
</pre>
<p>The parameters <code>user</code>, <code>password</code> and <code>server</code> specify the username, password and connection string used to connect to the replay database. The parameter <code>mode</code> specifies the mode in which to run the <code>wrc</code> executable. Possible values include <code>replay</code> (the default), <code>calibrate</code>, and <code>list_hosts</code>. The parameter <code>keyword</code> specifies the options to use for the execution and is dependent on the mode selected. To display the possible keywords and their corresponding values, run the <code>wrc</code> executable without any arguments.</p>
<p>The following sections describe the modes that you can select when running the <code>wrc</code> executable:</p>
<ul>
<li>
<p><a href="#CHDFDGBD">Calibrating Replay Clients</a></p>
</li>
<li>
<p><a href="#CHDDDJDH">Starting Replay Clients</a></p>
</li>
<li>
<p><a href="#CHDBBAAE">Displaying Host Information</a></p>
</li>
</ul>
<a id="CHDFDGBD"></a>
<div id="RATUG144" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">11.1.8.1</span> Calibrating Replay Clients</h4>
<p>Since one replay client can initiate multiple sessions with the database, it is not necessary to start a replay client for each session that was captured. The number of replay clients that need to be started depends on the number of workload streams, the number of hosts, and the number of replay clients for each host.</p>
<p>To estimate the number of replay clients and hosts that are required to replay a particular workload, run the <code>wrc</code> executable in <a id="sthref222"></a>calibrate mode.</p>
<p>In calibrate mode, the <code>wrc</code> executable accepts the following keywords:</p>
<ul>
<li>
<p><code>replaydir</code> specifies the directory that contains the preprocessed workload capture you want to replay. If unspecified, it defaults to the current directory.</p>
</li>
<li>
<p><code>process_per_cpu</code> specifies the maximum number of client processes that can run per CPU. The default value is 4.</p>
</li>
<li>
<p><code>threads_per_process</code> specifies the maximum number of threads that can run within a client process. The default value is 50.</p>
</li>
</ul>
<p>The following example shows how to run the <code>wrc</code> executable in calibrate mode:</p>
<pre>
%&gt; wrc mode=calibrate replaydir=./replay
</pre>
<p>In this example, the <code>wrc</code> executable is executed to estimate the number of replay clients and hosts that are required to replay the workload capture stored in a subdirectory named <code>replay</code> under the current directory. In the following sample output, the recommendation is to use at least 21 replay clients divided among 6 CPUs:</p>
<pre>
Workload Replay Client: Release 11.2.0.0.2 - Production on Fri May 1
13:06:33 2009
 
Copyright (c) 1982, 2009, Oracle.  All rights reserved.
 
Report for Workload in: /oracle/replay/
-----------------------
 
Recommendation:
Consider using at least 21 clients divided among 6 CPU(s).
 
Workload Characteristics:
- max concurrency: 1004 sessions
- total number of sessions: 1013
 
Assumptions:
- 1 client process per 50 concurrent sessions
- 4 client process per CPU
- think time scale = 100
- connect time scale = 100
- synchronization = TRUE
</pre></div>
<!-- class="sect3" -->
<a id="CHDDDJDH"></a>
<div id="RATUG145" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">11.1.8.2</span> Starting Replay Clients</h4>
<p>After determining the number of replay clients that are needed to replay the workload, you need to start the <a id="sthref223"></a>replay clients by running the <code>wrc</code> executable in replay mode on the hosts where they are installed. Once started, each replay client will initiate one or more sessions with the database to drive the workload replay.</p>
<p>In replay mode, the <code>wrc</code> executable accepts the following keywords:</p>
<ul>
<li>
<p><code>userid</code> and <code>password</code> specify the user ID and password of a replay user for the replay client. If unspecified, these values default to the <code>system</code> user.</p>
</li>
<li>
<p><code>server</code> specifies the connection string that is used to connect to the replay system. If unspecified, the value defaults to an empty string.</p>
</li>
<li>
<p><code>replaydir</code> specifies the directory that contains the preprocessed workload capture you want to replay. If unspecified, it defaults to the current directory.</p>
</li>
<li>
<p><code>workdir</code> specifies the directory where the client logs will be written. This parameter is only used with the <code>debug</code> parameter for debugging purposes.</p>
</li>
<li>
<p><code>debug</code> specifies whether debug data will be created. Possible values include:</p>
<ul>
<li>
<p><code>on</code></p>
<p>Debug data will be written to files in the working directory</p>
</li>
<li>
<p><code>off</code></p>
<p>No debug data will be written (the default value)</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Before running the <code>wrc</code> executable in debug mode, contact Oracle Support for more information.</div>
</li>
<li>
<p><code>connection_override</code> specifies whether to override the connection mappings stored in the <code>DBA_WORKLOAD_CONNECTION_MAP</code> view. If set to <code>TRUE</code>, connection remappings stored in the <code>DBA_WORKLOAD_CONNECTION_MAP</code> view will be ignored and the connection string specified using the <code>server</code> parameter will be used. If set to <code>FALSE</code>, all replay threads will connect using the connection remappings stored in the <code>DBA_WORKLOAD_CONNECTION_MAP</code> view. This is the default setting.</p>
</li>
</ul>
<p>The following example shows how to run the <code>wrc</code> executable in replay mode:</p>
<pre>
%&gt; wrc system/password@test mode=replay replaydir=./replay
</pre>
<p>In this example, the <code>wrc</code> executable starts the replay client to replay the workload capture stored in a subdirectory named <code>replay</code> under the current directory.</p>
<p>After all replay clients have connected, the database will automatically distribute workload capture streams among all available replay clients and workload replay can begin. You can monitor the status of the replay clients using the <code>V$WORKLOAD_REPLAY_THREAD</code> view. After the replay finishes, all replay clients will disconnect automatically.</p>
</div>
<!-- class="sect3" -->
<a id="CHDBBAAE"></a>
<div id="RATUG146" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">11.1.8.3</span> Displaying Host Information</h4>
<p>You can display the hosts that participated in a workload capture and workload replay by running the <code>wrc</code> executable in list_hosts mode.</p>
<p>In list_hosts mode, the <code>wrc</code> executable accepts the keyword <code>replaydir</code>, which specifies the directory that contains the preprocessed workload capture you want to replay. If unspecified, it defaults to the current directory.</p>
<p>The following example shows how to run the <code>wrc</code> executable in list_hosts mode:</p>
<pre>
%&gt; wrc mode=list_hosts replaydir=./replay
</pre>
<p>In this example, the <code>wrc</code> executable is executed to list all hosts that participated in capturing or replaying the workload capture stored in a subdirectory named <code>replay</code> under the current directory. In the following sample output, the hosts that participated in the workload capture and three subsequent replays are shown:</p>
<pre>
Workload Replay Client: Release 11.2.0.0.2 - Production on Fri May 1 13:44:48 2009
 
Copyright (c) 1982, 2009, Oracle.  All rights reserved.
 
Hosts found:
Capture:
        prod1
        prod2
Replay 1:
        test1
Replay 2:
        test1
        test2
Replay 3:
        testwin
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDEBCIC"></a>
<div id="RATUG147" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">11.2</span> Replaying a Database Workload Using Enterprise Manager</h2>
<p>This section describes how to replay a database <a id="sthref224"></a>workload using Enterprise Manager.</p>
<p>The primary tool for replaying database workloads is Oracle Enterprise Manager. If Oracle Enterprise Manager is unavailable, you can also replay database workloads using APIs, as described in <a href="#CHDGECHD">"Replaying a Database Workload Using APIs"</a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Before proceeding, you must already have created a replay task and created a replay from the replay task. To do this, see <a href="dbr_preprocess.htm#BEIJJDFI">"Preparing a Single Database Workload Using Enterprise Manager"</a>.</div>
<p class="subhead2"><a id="RATUG262"></a>To replay a database workload using Enterprise Manager:</p>
<ol>
<li>
<p>From the Enterprise menu of the Enterprise Manager Cloud Control console, select <span class="bold">Quality Management</span>, then <span class="bold">Database Replay</span>.</p>
<p>If the Database Login page appears, log in as a user with administrator privileges.</p>
<p>The Database Replay page appears.</p>
<img width="884" height="413" src="img/dbr.gif" alt="Description of dbr.gif follows" /><br />
<a id="sthref225" href="img_text/dbr.htm">Description of the illustration dbr.gif</a><br />
<br /></li>
<li>
<p>Select the <span class="bold">Replay Tasks</span> tab, then click the link for the desired replay task in the table.</p>
<p>The Replay Task page for the replay appears.</p>
<img width="882" height="405" src="img/dbr_replay_tasks.gif" alt="Description of dbr_replay_tasks.gif follows" /><br />
<a id="sthref226" href="img_text/dbr_replay_tasks.htm">Description of the illustration dbr_replay_tasks.gif</a><br />
<br /></li>
<li>
<p>Click <span class="bold">Create</span> in the Replays section to create the replay.</p>
<p>The Create Replay pop-up appears.</p>
</li>
<li>
<p>Provide a required Name and optional description, then click the <span class="bold">Target Database</span> icon.</p>
<p>The Search and Select: Targets pop-up appears.</p>
</li>
<li>
<p>Choose the appropriate database, then click <span class="bold">Select</span>.</p>
</li>
<li>
<p>Click <span class="bold">OK</span> in the Create Replay pop-up.</p>
<p>The Database Replay page for your replay appears, which includes a Task List with a link to perform the replay.</p>
<img width="911" height="644" src="img/dbr_replay_workload.gif" alt="Description of dbr_replay_workload.gif follows" /><br />
<a id="sthref227" href="img_text/dbr_replay_workload.htm">Description of the illustration dbr_replay_workload.gif</a><br />
<br /></li>
<li>
<p>Click the link for the <span class="bold">Replay Workload</span> task.</p>
<p>The Replay Workload: Locate Workload page appears.</p>
<img width="821" height="315" src="img/dbr_replay_loc_wkload.gif" alt="Description of dbr_replay_loc_wkload.gif follows" /><br />
<a id="sthref228" href="img_text/dbr_replay_loc_wkload.htm">Description of the illustration dbr_replay_loc_wkload.gif</a><br />
<br /></li>
<li>
<p>Select the desired workload location option.</p>
<p>If you have not previously copied the workload from its storage location to the replay location where the replay clients can access it, select the option to copy the workload. Otherwise, select the option to use the existing replay directory that contains the workload to be replayed.</p>
<p>Click <span class="bold">Next</span> to display the Replay Workload: Copy Workload page.</p>
<img width="801" height="694" src="img/dbr_replay_copy_wkload.gif" alt="Description of dbr_replay_copy_wkload.gif follows" /><br />
<a id="sthref229" href="img_text/dbr_replay_copy_wkload.htm">Description of the illustration dbr_replay_copy_wkload.gif</a><br />
<br /></li>
<li>
<p>Provide the required credentials and the new location of the workload directory to which you want to copy the workload, then click <span class="bold">Next</span>.</p>
<ul>
<li>
<p>There are multiple source workloads for a consolidated replay, so multiple source credentials might be needed for the current location of the workload directory. For more information on consolidated replays, see <a href="dbr_consolidated.htm#CIHIDDFA">"Using Consolidated Database Replay with Enterprise Manager"</a> in <a href="dbr_consolidated.htm#CHDDIBFI">Chapter 13, "Using Consolidated Database Replay."</a></p>
</li>
</ul>
<p>The system responds by displaying a progress bar graph during processing, then displays the Replay Workload: Select Directory page after the copy operation concludes.</p>
<img width="819" height="230" src="img/dbr_replay_select_dir.gif" alt="Description of dbr_replay_select_dir.gif follows" /><br />
<a id="sthref230" href="img_text/dbr_replay_select_dir.htm">Description of the illustration dbr_replay_select_dir.gif</a><br />
<br /></li>
<li>
<p>Specify the Directory Object, or create a new Directory Object that points to the location that contains the workload. If you chose to copy from the workload location to a new location in the previous step, make sure that the directory object points to the exact location you specified in the New Location of the Workload Directory section.</p>
<p>The system responds by displaying a Capture Summary. You can expand the Capture Details section to see the workload profile and workload filters. You can also generate a Workload Capture Analyzer Report and Database Capture Report. The Capture Summary does not appear for consolidated replays.</p>
<p>Click <span class="bold">Next</span> to display the Replay Workload: Initialize Options page.</p>
<img width="820" height="238" src="img/dbr_replay_init_options.gif" alt="Description of dbr_replay_init_options.gif follows" /><br />
<a id="sthref231" href="img_text/dbr_replay_init_options.htm">Description of the illustration dbr_replay_init_options.gif</a><br />
<br /></li>
<li>
<p>In the SQL Performance Analyzer section, retain or disable the Capture SQL Statements option, which is enabled by default and recommended. You can disable this option if you do not want to compare SQL tuning sets at the end of the Replay.</p>
<ul>
<li>
<p>The SQL Performance Analyzer can initiate an impact analysis of environmental changes on the performance of SQL statements within a SQL Tuning Set. You can create and analyze SQL Performance Analyzer tasks to test the effects of a database upgrade, initialization parameter change, Exadata simulation, or custom experiments. A task compares the effects of before-trial changes with after-trial changes.</p>
<p>Although Database Replay provides an analysis of how a change affects your entire system, you can use a SQL tuning set in conjunction with the SQL Performance Analyzer to gain a more SQL-centric analysis of how the change affects SQL statements and execution plans.</p>
<p>By capturing a SQL tuning set during workload replay, you can use SQL Performance Analyzer to compare this SQL tuning set to another SQL tuning set captured during workload capture, without having to re-execute the SQL statements. This enables you to obtain a SQL Performance Analyzer report and compare the SQL performance, before and after change, while running Database Replay.</p>
</li>
<li>
<p>In the Identify Source section, initial replay options refer to the connection mappings and parameters on the Customize Options page. Connections are captured along with the workload.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
This section does not appear for consolidated replays or Oracle RAC.</div>
</li>
</ul>
<p>Click <span class="bold">Next</span> to display the Replay Workload: Customize Options page.</p>
<img width="820" height="561" src="img/dbr_replay_cust_options.gif" alt="Description of dbr_replay_cust_options.gif follows" /><br />
<a id="sthref232" href="img_text/dbr_replay_cust_options.htm">Description of the illustration dbr_replay_cust_options.gif</a><br />
<br /></li>
<li>
<p>Remap captured connection strings to connection strings that point to the replay system. Note that you need to remap each capture connection. For example, in the illustration above, you would need to remap the connection for both capture12_1 and capture12_adc.</p>
<p>(You can remap connections per workload for consolidated replay. There is a Capture Name drop-down to choose the workload.)</p>
<p>Click the <span class="bold">Connection Mappings</span> tab. There are several methods you can use to remap captured connection strings. You can choose to:</p>
<ul>
<li>
<p><span class="bold">Use a single connect descriptor for all client connections</span> by selecting this option and entering the connect descriptor you want to use. The connect descriptor should point to the replay system.</p>
<p>To test the connection, click <span class="bold">Test Connection</span>. If the connect descriptor is valid, an Information message is displayed to inform you that the connection was successful.</p>
</li>
<li>
<p><span class="bold">Use a single TNS net service name for all client connections</span> by selecting this option and entering the net service name you want to use. All replay clients must be able to resolve the net service name, which can be done using a local <code>tnsnames.ora</code> file.</p>
</li>
<li>
<p><span class="bold">Use a separate connect descriptor or net service name for each client connect descriptor captured in the workload</span> by selecting this option and, for each capture system value, entering a corresponding replay system value that the replay client will be use. If you selected the "Use replay options from a previous replay" option in the Initialize Options step, the "Use a separate connect descriptor" option is selected, and the previous Replay system values appear in the text field below.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
This option does not apply to consolidated replays.</div>
</li>
</ul>
<p>For more information, see <a href="#CHDHHDHI">"Remapping Connections"</a>.</p>
</li>
<li>
<p>Specify the replay options using the replay parameters, which control some aspects of the Replay.</p>
<p>To modify the replay behavior, click the <span class="bold">Replay Parameters</span> tab and enter the desired values for each replay parameter. Using the default values is recommended. For information about setting the replay parameters, see <a href="#CHDFAGEA">"Specifying Replay Options"</a>.</p>
<p>After setting the replay parameters, click <span class="bold">Next</span>.</p>
<p>The Replay Workload: Prepare Replay Clients page appears.</p>
<img width="822" height="523" src="img/dbr_replay_prep_clients.gif" alt="Description of dbr_replay_prep_clients.gif follows" /><br />
<a id="sthref233" href="img_text/dbr_replay_prep_clients.htm">Description of the illustration dbr_replay_prep_clients.gif</a><br />
<br /></li>
<li>
<p>Ensure that the replay clients are prepared for replay:</p>
<p>Before proceeding, the replay clients must be set up. For more information, see <a href="#CHDICJHE">"Setting Up Replay Clients"</a>.</p>
<ol>
<li>
<p>Click <span class="bold">Estimate</span> to determine how many Replay clients and CPUs are required for the Replay.</p>
</li>
<li>
<p>Click <span class="bold">Add Replay Client Hosts</span> to add a host or hosts for the Replay clients. (If you do not want to add any replay client hosts, you can still continue and start the replay clients from the command line outside of Enterprise Manager).</p>
<p>The Search and Select: Replay Client Host pop-up appears.</p>
<ul>
<li>
<p>Specify a Target Name and then click <span class="bold">Go</span>, or just click <span class="bold">Go</span> to display the entire list of available hosts.</p>
</li>
<li>
<p>Choose a host and then click <span class="bold">Select</span>.</p>
</li>
</ul>
</li>
<li>
<p>When the host name appears in the Target column of the Replay Client Hosts table, specify the number of Replay clients recommended from the estimate results, then make sure that the number of CPUs listed for the host satisfies the minimum recommendation in the estimate results. You should start at least one replay client per captured workload.</p>
</li>
<li>
<p>In the Configured column, click the <span class="bold">No</span> link to configure the Replay client host in the pop-up that appears.</p>
</li>
<li>
<p>Click <span class="bold">Apply</span> after you have finished providing input in the pop-up. The Configured column now displays Yes in the Replay Client Hosts table.</p>
</li>
</ol>
</li>
<li>
<p>Click <span class="bold">Next</span> to start the replay clients and display the Replay Workload: Wait for Client Connections page.</p>
<img width="815" height="284" src="img/dbr_replay_client.gif" alt="Description of dbr_replay_client.gif follows" /><br />
<a id="sthref234" href="img_text/dbr_replay_client.htm">Description of the illustration dbr_replay_client.gif</a><br />
<br />
<p>For information about starting replay clients, see <a href="#CHDICJHE">"Setting Up Replay Clients"</a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you have reached this step in the process from the Enterprise menu, you also need to enter credentials for the replay job and for the replay result storage host.</div>
<ul>
<li>
<p>As replay clients are started, the replay client connections are displayed in the Client Connections table.</p>
</li>
<li>
<p>The text below the clock changes if a replay client is connected.</p>
</li>
<li>
<p>The Client Connections table is populated when at least one replay client is connected.</p>
</li>
</ul>
<p>When all replay clients have connected, enter host credentials at the bottom of the page to start the replay job, then click <span class="bold">Next</span> to display the Replay Workload: Review page.</p>
</li>
<li>
<p>Review the options and parameters that have been defined for the workload replay.</p>
<ul>
<li>
<p>The value for Connected Replay Clients must be at least 1 in order to successfully submit the Replay Workload job.</p>
</li>
<li>
<p>The Submit button is enabled only if at least one Replay client is connected.</p>
</li>
</ul>
</li>
<li>
<p>If everything appears as you have intended, click <span class="bold">Submit</span> to submit the Replay job.</p>
<p>After the replay starts, the Home tab of the Database Replay page for this replay reappears with a system message that states "The workload replay has started."</p>
</li>
</ol>
<p>For information about monitoring an active workload replay, see <a href="#CHDBIJAA">"Monitoring an Active Workload Replay"</a>.</p>
</div>
<!-- class="sect1" -->
<a id="BGBGAEII"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">11.3</span> Setting Up the Replay Schedule and Parameters Using Enterprise Manager</h2>
<p>The Replay schedule feature enables you to scale up the instances of captured workloads to be included in a consolidated Replay, and then control the relative playback scheduling of the instances within the Replay. The relative scheduling of the captured workload instances is visually displayed by updating the alignment of the active session chart for each instance.</p>
<p>This feature is available for Cloud Control Database plug-in 12.1.0.5 and later releases.</p>
<p>This feature enables you to accomplish the following tasks:</p>
<ul>
<li>
<p><span class="bold">Offset instances so that they execute at different time intervals</span></p>
<p>You can adjust the relative replay start time of each workload instance to align the average active sessions peak times for scheduled instances of Capture workloads. This alignment of the workload peaks potentially maximizes the load on the system, so that you can experiment with how the test system responds under different workload conditions.</p>
</li>
<li>
<p><span class="bold">Scale up the Replay workload by adding instances of the Captured workload</span></p>
<p>Each added instance is replayed independently of the other instances.</p>
<p>When you scale up a workload by specifying multiple instances of it, the default and recommended configuration is to replay the DML statements in one of the instances. All of the additional instances will only replay the query (ready-only) statements.</p>
<p>For example, if a workload has a SQL Insert to an employee database, you normally would want to have only one instance that executes the Insert, and the others would bypass user calls that modify the database with this Insert. However, you can override the default setting of an instance by unchecking the Replay Query-only check box to replay all statements in the workload.</p>
</li>
</ul>
<p class="orderedlisttitle">To access the Plan Replay Schedule page:&nbsp;</p>
<ol>
<li>
<p>From the Database Replay home page, click on the <span class="bold">Replay Tasks</span> tab.</p>
</li>
<li>
<p>Click on the name of an existing Replay task with more than one workload to navigate to the Replay Task page.</p>
</li>
<li>
<p>Click <span class="bold">Create</span> to create a new Replay.</p>
</li>
<li>
<p>Provide the requisite information in the Create Replay pop-up, then click <span class="bold">OK</span>.</p>
<p>The new Replay appears in the Replays table.</p>
</li>
<li>
<p>Click the name of your new Replay in the Replays table.</p>
<p>A Task List now appears in the Replay page.</p>
</li>
<li>
<p>Click the <span class="bold">Plan Replay Schedule</span> link.</p>
<p>The Plan Replay Schedule page appears.</p>
</li>
</ol>
<p class="orderedlisttitle">To scale up a Replay:&nbsp;</p>
<ol>
<li>
<p>In the drop-down next to the Add Workload Instance button, select the Capture workload for which you want to add an instance.</p>
</li>
<li>
<p>Click <span class="bold">Add Workload Instance</span> to add the instance.</p>
</li>
</ol>
<p class="orderedlisttitle">To schedule the time intervals:&nbsp;</p>
<ol>
<li>
<p>From the Replay Delay column, either leave the default value of 0 for the first Capture instance, or adjust the number of minutes desired before the instance starts to execute.</p>
</li>
<li>
<p>Repeat the step above for each Capture instance until you have set all of the values to represent how you want the performance spikes to execute for your testing needs.</p>
</li>
</ol>
<p class="orderedlisttitle">To auto-align workload peaks:&nbsp;</p>
<ol>
<li>
<p>Click the <span class="bold">Auto-align</span> button.</p>
</li>
</ol>
<p class="orderedlisttitle">To specify query-only instances:&nbsp;</p>
<ol>
<li>
<p>For each instance that you want to be query-only, enable the <span class="bold">Replay Query-only</span> check box.</p>
</li>
</ol>
<p class="orderedlisttitle">To review the updated schedule:&nbsp;</p>
<ol>
<li>
<p>From the Replay Task tab of the Database Replay page, click the Replay task link containing your scheduled Replay.</p>
<p>The Replay Task page appears.</p>
</li>
<li>
<p>Click the scheduled Replay in the Replays table.</p>
</li>
<li>
<p>Select the Review tab in the Replay page.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CHDFDCCB"></a>
<div id="RATUG148" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">11.4</span> Monitoring a Workload Replay Using Enterprise Manager</h2>
<p>This section describes how to monitor <a id="sthref241"></a>workload replay using Enterprise Manager. The primary tool for monitoring workload replay is Oracle Enterprise Manager. Using Enterprise Manager, you can:</p>
<ul>
<li>
<p>Monitor or stop an active workload replay</p>
</li>
<li>
<p>View a completed workload replay</p>
</li>
</ul>
<p>If Oracle Enterprise Manager is unavailable, you can monitor workload replay using APIs and views, as described in <a href="#BABDHJJD">"Monitoring Workload Replay Using APIs"</a>.</p>
<p>This section contains the following topics:</p>
<ul>
<li>
<p><a href="#CHDBIJAA">Monitoring an Active Workload Replay</a></p>
</li>
<li>
<p><a href="#CHDBCAAB">Viewing a Completed Workload Replay</a></p>
</li>
</ul>
<a id="CHDBIJAA"></a>
<div id="RATUG149" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.4.1</span> Monitoring an Active Workload Replay</h3>
<p>This section describes how to monitor an active workload replay using Enterprise Manager.</p>
<p class="subhead2"><a id="RATUG263"></a>To monitor an active workload replay:</p>
<ol>
<li>
<p>From the Database Replay page, click the <span class="bold">Replay Tasks</span> tab.</p>
</li>
<li>
<p>Click the name of the replay task that contains the replay for which you want to monitor replay progress.</p>
</li>
<li>
<p>From the Replays section of the Replay Task page, click the name of the replay you have submitted for processing in the Create Replay wizard. (The Status column for this replay should show In Progress.)</p>
<p>The Home tab of the Database Replay page appears, and the Replay Summary shows a Status of Running.</p>
<ul>
<li>
<p>The replay line in the Replay Progress chart updates dynamically while the Replay is in progress. You can update the chart by clicking the Refresh button.</p>
</li>
<li>
<p>The user calls line in the Replay Progress chart indicates how much of the workload the database has serviced relative to the capture at the same time.</p>
</li>
<li>
<p>Data for the Replay Divergence Summary is not available until the Replay completes.</p>
</li>
</ul>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CHDBCAAB"></a>
<div id="RATUG150" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.4.2</span> Viewing a Completed Workload Replay</h3>
<p>This section describes how to view a completed workload replay using Enterprise Manager.</p>
<p class="subhead2"><a id="RATUG286"></a>To view a completed workload replay:</p>
<ol>
<li>
<p>From the Database Replay page, click the <span class="bold">Replay Tasks</span> tab.</p>
</li>
<li>
<p>Click the name of the replay task that contains the completed replay you want to view.</p>
</li>
<li>
<p>From the Replays section of the Replay Task page, click the name of the replay you have submitted for processing in the Create Replay wizard. (The Status column for this replay should show Completed.)</p>
<p>The Home tab of the Database Replay page appears, and the Replay Summary shows a Status of Completed.</p>
<img width="883" height="645" src="img/dbr_replay_completed.gif" alt="Description of dbr_replay_completed.gif follows" /><br />
<a id="sthref242" href="img_text/dbr_replay_completed.htm">Description of the illustration dbr_replay_completed.gif</a><br />
<br />
<ul>
<li>
<p>The replay line in the User Calls chart graphically represents the replay progress during the course of the entire replay from initiation to conclusion. The elapsed time in the Replay Progress chart equates to the number of minutes that were set up for the associated Capture.</p>
<p>The chart shows how much time it has taken to replay the same workload compared to the elapsed time during the workload capture in terms of user calls. If the Replay line is above or to the left of the Capture line, the replay system is processing the workload faster than the capture system.</p>
</li>
<li>
<p>Under the Replay Divergence Summary, any errors and data discrepancies between the replay system and the capture system are displayed as diverged database calls during replay. You can use the percentage of total calls that diverged as a measure of the replay quality.</p>
<p>To view details about the diverged calls, click the link that corresponds to the type of diverged call in the Count column to access the Diverged Calls During Replay page. The Diverged Calls During Replay page shows the most relevant set of replayed calls that diverged from the workload captured by grouping them based on common attribute values and specified filter conditions. To view details about a particular diverged call&mdash;such as the call attributes, SQL text, and bind variables&mdash;click the corresponding link in the SQL ID column to bring up the Replay Diverged Statement page.</p>
</li>
</ul>
</li>
<li>
<p>To return to the Database Replay page, click the Database Replay breadcrumb.</p>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
See <a href="dbr_analyze.htm#CACBHAEF">Chapter 12, "Analyzing Captured and Replayed Workloads"</a> for information about accessing workload replay reports.</div>
</li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BGBEJGJI"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">11.5</span> Importing a Replay External to Enterprise Manager</h2>
<p>As with importing workloads external to Enterprise Manager, you can import Replays into Enterprise Manager to manage them. To import a Replay, you import it from a Replay task, which can contain one or more workloads and one or more Replays. The Replay task is at the top of the database Replay hierarchy, and serves as the container for these other subordinate components.</p>
<p>A Replay to be imported can be running in the test database, or the Replay can be completed and the replay directory stored on a file system.</p>
<p>This feature is available for Cloud Control Database plug-in 12.1.0.5 and later releases.</p>
<p class="orderedlisttitle">To import a Replay external to Enterprise Manager:&nbsp;</p>
<ol>
<li>
<p>From the Database Replay page, click the <span class="bold">Replay Tasks</span> tab, then select the desired Replay task.</p>
<p>The Replay Task page appears.</p>
</li>
<li>
<p>Click <span class="bold">Import</span> in the Replays section.</p>
<p>The Import Replay: Source page appears</p>
</li>
<li id="BGBBEIBA">
<p>Select one of the three choices available to import a Replay, then click <span class="bold">Next</span>.</p>
<ul>
<li>
<p><span class="bold">Import one or more completed Replays from a directory in the file system</span></p>
<p>This option typically applies for a Replay created using an API, in which you now want to import it to Enterprise Manager for subsequent processing. In this case, Enterprise Manager may not be necessarily managing the Replay database.</p>
</li>
<li>
<p><span class="bold">Import one or more completed Replays from a database target</span></p>
<p>In this case, Enterprise Manager is probably already managing the Replay database. The Replay could have been done on this database, or it could have been loaded in as would be the case for the option above.</p>
</li>
<li>
<p><span class="bold">Attach to a Replay of this Replay task running in a database target</span></p>
<p>This option is similar to the option above, except this a Replay that is still in progress, rather than one that has already completed.</p>
</li>
</ul>
<p>The Import Replay: Database page appears.</p>
</li>
<li>
<p>Click the search icon next to the Database Target field and select a database from the pop-up that appears.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The target version of the database reading the Replay must be at least as high as the one you used in the Replay task. For instance, if the Replay task used Oracle Database 12x, the database you select to read the Replay must be at least version 12x.</div>
<ul>
<li>
<p>The system now requests database and host credentials.</p>
</li>
<li>
<p>In the previous step, if you chose to import one or more completed Replays from a directory in the file system, the system also requires a workload location.</p>
</li>
<li>
<p>The Replay task can determine if this is a consolidated Replay based on the number of workloads contained in the Replay task. If this is a consolidated Replay, this step asks you to enter a consolidated Replay directory for the workload location.</p>
</li>
</ul>
</li>
<li>
<p>Provide the requisite input for the step above, then click <span class="bold">Next</span>.</p>
<p>The Import Replay: Replay page appears.</p>
<ul>
<li>
<p>If you chose "Import one or more completed Replays from a directory in the file system&rdquo; in step <a href="#BGBBEIBA">3</a>, this page provides a Load Replay button.</p>
</li>
<li>
<p>If you chose &rdquo;Import one or more completed Replays from a database target&rdquo; or &rdquo;Attach to a Replay of this Replay task running in a database target&rdquo; in step <a href="#BGBBEIBA">3</a>, this page provides a Discover Replay button.</p>
</li>
</ul>
</li>
<li>
<p>Click either <span class="bold">Load Replay</span> or <span class="bold">Discover Replay</span>, depending on which button is available in accordance with your selection in step <a href="#BGBBEIBA">3</a>.</p>
<p>The system displays one or more Replays, if found, in the Discovered Replays table.</p>
</li>
<li>
<p>Either click <span class="bold">Next</span> to load the Replay, or select one or more Replays, then click <span class="bold">Next</span> to continue importing the Replays.</p>
<p>The Import Replay: Review page appears.</p>
</li>
<li>
<p>If everything appears as you have intended, click <span class="bold">Submit</span>.</p>
<p>The Database Replay page reappears and displays a message stating that the job was submitted successfully. The Status column in the table for your imported Replay will show In Progress.</p>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
You can check on the job's progress by clicking on the Replay name that you just submitted in the Review step. A Replay Summary page appears, and you can click the Database Replay Import Job link to see the progress of the job execution steps.</div>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CHDGECHD"></a>
<div id="RATUG151" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">11.6</span> Replaying a Database Workload Using APIs</h2>
<p>This section describes how to replay a <a id="sthref244"></a>database workload using the <code>DBMS_WORKLOAD_REPLAY</code> package. You can also use Oracle Enterprise Manager to replay a database workload, as described in <a href="#CHDEBCIC">"Replaying a Database Workload Using Enterprise Manager"</a>.</p>
<p>Replaying a database workload using the <code>DBMS_WORKLOAD_REPLAY</code> package is a multi-step process that involves:</p>
<ul>
<li>
<p><a href="#CHDHCJEH">Initializing Replay Data</a></p>
</li>
<li>
<p><a href="#CHDFEHJJ">Connection Remapping</a></p>
</li>
<li>
<p><a href="#CHDGDCBH">Setting Workload Replay Options</a></p>
</li>
<li>
<p><a href="#BABDBEBF">Defining Workload Replay Filters and Replay Filter Sets</a></p>
</li>
<li>
<p><a href="#CBAJEBDD">Setting the Replay Timeout Action</a></p>
</li>
<li>
<p><a href="#CHDGEDDH">Starting a Workload Replay</a></p>
</li>
<li>
<p><a href="#BABEHJAD">Pausing a Workload Replay</a></p>
</li>
<li>
<p><a href="#BABEABFI">Resuming a Workload Replay</a></p>
</li>
<li>
<p><a href="#CHDEEEBB">Cancelling a Workload Replay</a></p>
</li>
<li>
<p><a href="#CHDGEHAA">Exporting AWR Data for Workload Replay</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ARPLS208" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS208"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>DBMS_WORKLOAD_REPLAY</code> package</p>
</li>
</ul>
</div>
<a id="CHDHCJEH"></a>
<div id="RATUG152" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.6.1</span> Initializing Replay Data</h3>
<p>After the workload capture is preprocessed and the test system is properly prepared, the replay data can be initialized. Initializing replay data loads the necessary metadata into tables required by workload replay. For example, captured connection strings are loaded into a table where they can be remapped for replay.</p>
<p>To initialize replay data, use the <a id="sthref245"></a><code>INITIALIZE_REPLAY</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPLAY.INITIALIZE_REPLAY (replay_name =&gt; 'dec06_102',
                           replay_dir =&gt; 'dec06');
END;
/
</pre>
<p>In this example, the <code>INITIALIZE_REPLAY</code> procedure loads preprocessed workload data from the <code>dec06</code> directory into the database.</p>
<p>The <code>INITIALIZE_REPLAY</code> procedure in this example uses the following parameters:</p>
<ul>
<li>
<p>The <code>replay_name</code> required parameter specifies a replay name that can be used with other APIs to retrieve settings and filters of previous replays.</p>
</li>
<li>
<p>The <code>replay_dir</code> required parameter specifies the directory that contains the workload capture that will be replayed.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="dbr_preprocess.htm#CHDJIJFH">"Preprocessing a Database Workload Using APIs"</a> for information about preprocessing a workload capture</p>
</li>
<li>
<p><a href="#CHDHHDGE">"Steps for Replaying a Database Workload"</a> for information preparing the test system</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CHDFEHJJ"></a>
<div id="RATUG153" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.6.2</span> Connection Remapping</h3>
<p>After the replay data is initialized, connection strings used in the workload capture need to be remapped so that user sessions can connect to the appropriate databases and perform external interactions as captured during replay. To view connection mappings, use the <code>DBA_WORKLOAD_CONNECTION_MAP</code> view. For information about connection remapping, see <a href="#CHDHHDHI">"Remapping Connections"</a>.</p>
<p>To remap connections, use the <a id="sthref246"></a><code>REMAP_CONNECTION</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (connection_id =&gt; 101,
                           replay_connection =&gt; 'dlsun244:3434/bjava21');
END;
/
</pre>
<p>In this example, the connection that corresponds to the connection ID 101 will use the new connection string defined by the <code>replay_connection</code> parameter.</p>
<p>The <code>REMAP_CONNECTION</code> procedure in this example uses the following parameters:</p>
<ul>
<li>
<p>The <code>connection_id</code> required parameter is generated when initializing replay data and corresponds to a connection from the workload capture.</p>
</li>
<li>
<p>The <code>replay_connection</code> required parameter specifies the new connection string that will be used during workload replay.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CHDGDCBH"></a>
<div id="RATUG154" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.6.3</span> Setting Workload Replay Options</h3>
<p>After the replay data is initialized and the connections are appropriately remapped, you need to prepare the database for <a id="sthref247"></a>workload replay. For information about workload replay preparation, see <a href="#CHDHHDGE">"Steps for Replaying a Database Workload"</a>.</p>
<p>To prepare workload replay on the replay system, use the <a id="sthref248"></a><code>PREPARE_REPLAY</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPLAY.PREPARE_REPLAY (synchronization =&gt; OBJECT_ID,
                           capture_sts =&gt; TRUE,
                           sts_cap_interval =&gt; 300);
END;
/
</pre>
<p>In this example, the <code>PREPARE_REPLAY</code> procedure prepares a replay that has been previously initialized. A SQL tuning set will also be captured in parallel with the workload replay.</p>
<p>The <code>PREPARE_REPLAY</code> procedure uses the following parameters:</p>
<ul>
<li>
<p>The <code>synchronization</code> required parameter determines if synchronization will be used during workload replay.</p>
<p>If this parameter is set to <code>OBJECT_ID</code> (the default value), all replay actions will be executed only after all relevant <code>COMMIT</code> actions have completed. Relevant <code>COMMIT</code> actions must meet the following criteria:</p>
<ul>
<li>
<p>Issued before the given action in the workload capture</p>
</li>
<li>
<p>Modified at least one of the database objects for which the given action is referencing, either implicitly or explicitly</p>
</li>
</ul>
<p>Setting this parameter to <code>OBJECT_ID</code> allows for more concurrency during workload replays for <code>COMMIT</code> actions that do not reference the same database objects during workload capture.</p>
<p>If this parameter is set to <code>SCN</code>, the <code>COMMIT</code> order in the captured workload will be preserved during replay and all replay actions will be executed only after all dependent <code>COMMIT</code> actions have completed.</p>
<p>You can disable this option by setting the parameter to <code>OFF</code>, but the replay will likely yield significant replay divergence. However, this may be desirable if the workload consists primarily of independent transactions, and divergence during unsynchronized replay is acceptable.</p>
</li>
<li>
<p>The <code>connect_time_scale</code> parameter scales the elapsed time from when the workload capture started to when the session connects with the specified value and is interpreted as a % value. Use this parameter to increase or decrease the number of concurrent users during replay. The default value is 100.</p>
</li>
<li>
<p>The <code>think_time_scale</code> parameter scales the elapsed time between two successive user calls from the same session and is interpreted as a % value. Setting this parameter to 0 will send user calls to the database as fast as possible during replay. The default value is 100.</p>
</li>
<li>
<p>The <code>think_time_auto_correct</code> parameter corrects the think time (based on the <code>think_time_scale</code> parameter) between calls when user calls take longer to complete during replay than during capture. This parameter can be set to either <code>TRUE</code> or <code>FALSE</code>. Setting this parameter to <code>TRUE</code> reduces the think time if the workload replay is taking longer than the workload capture. The default value is <code>TRUE</code>.</p>
</li>
<li>
<p>The <code>scale_up_multiplier</code> parameter defines the number of times the workload is scaled up during replay. Each captured session will be replayed concurrently for as many times as specified by this parameter. However, only one session in each set of identical replay sessions will execute both queries and updates. The rest of the sessions will only execute queries.</p>
</li>
<li>
<p>The <code>capture_sts</code> parameter specifies whether to capture a SQL tuning set in parallel with the workload replay. If this parameter is set to <code>TRUE</code>, you can capture a SQL tuning set during workload replay and use SQL Performance Analyzer to compare it to another SQL tuning set without having to re-execute the SQL statements. This enables you to obtain a SQL Performance Analyzer report and compare the SQL performance&mdash;before and after the change&mdash;while running Database Replay. You can also export the resulting SQL tuning set with its AWR data using the <code>EXPORT_AWR</code> procedure, as described in <a href="#CHDGEHAA">"Exporting AWR Data for Workload Replay"</a>.</p>
<p>This feature is not supported for Oracle RAC. Workload replay filters that are defined using <code>DBMS_WORKLOAD_REPLAY</code> do not apply to the SQL tuning set capture. The default value for this parameter is <code>FALSE</code>.</p>
</li>
<li>
<p>The <code>sts_cap_interval</code> parameter specifies the duration of the SQL tuning set capture from the cursor cache in seconds. The default value is 300. Setting the value of this parameter below the default value may cause additional overhead with some workloads and is not recommended.</p>
</li>
</ul>
<p>For more information about setting these parameters, see <a href="#CHDFAGEA">"Specifying Replay Options"</a>.</p>
</div>
<!-- class="sect2" -->
<a id="BABDBEBF"></a>
<div id="RATUG264" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.6.4</span> Defining Workload Replay Filters and Replay Filter Sets</h3>
<p>This section describes how to add and remove <a id="sthref249"></a>workload replay filters, and how to create and use replay filter sets. For information about using workload filters and replay filter sets with workload replay, see <a href="#BABIFBHG">"Using Filters with Workload Replay"</a>.</p>
<p>This section contains the following topics:</p>
<ul>
<li>
<p><a href="#BABEBGIG">Adding Workload Replay Filters</a></p>
</li>
<li>
<p><a href="#BABBJCEH">Deleting Workload Replay Filters</a></p>
</li>
<li>
<p><a href="#BABDCAJB">Creating a Replay Filter Set</a></p>
</li>
<li>
<p><a href="#BABJABHC">Using a Replay Filter Set</a></p>
</li>
</ul>
<a id="BABEBGIG"></a>
<div id="RATUG265" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">11.6.4.1</span> Adding Workload Replay Filters</h4>
<p>To add a new filter to be used in a replay filter set, use the <a id="sthref250"></a><code>ADD_FILTER</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPLAY.ADD_FILTER (
                           fname =&gt; 'user_ichan',
                           fattribute =&gt; 'USER',
                           fvalue =&gt; 'ICHAN');
END;
/
</pre>
<p>In this example, the <code>ADD_FILTER</code> procedure adds a filter named user_ichan, which can be used to filter out all sessions belonging to the user name ICHAN.</p>
<p>The <code>ADD_FILTER</code> procedure in this example uses the following parameters:</p>
<ul>
<li>
<p>The <code>fname</code> required parameter specifies the name of the filter that will be added.</p>
</li>
<li>
<p>The <code>fattribute</code> required parameter specifies the attribute on which the filter will be applied. Valid values include PROGRAM, MODULE, ACTION, SERVICE, USER, and CONNECTION_STRING. You must specify a valid captured connection string that will be used during replay as the CONNECTION_STRING attribute.</p>
</li>
<li>
<p>The <code>fvalue</code> required parameter specifies the value for the corresponding attribute on which the filter will be applied. It is possible to use wildcards such as % with some of the attributes, such as modules and actions.</p>
</li>
</ul>
<p>Once all workload replay filters are added, you can create a replay filter set that can be used when replaying the workload.</p>
</div>
<!-- class="sect3" -->
<a id="BABBJCEH"></a>
<div id="RATUG266" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">11.6.4.2</span> Deleting Workload Replay Filters</h4>
<p>To delete workload replay filters, use the <a id="sthref251"></a><code>DELETE_FILTER</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPLAY.DELETE_FILTER (fname =&gt; 'user_ichan');
END;
/
</pre>
<p>In this example, the <code>DELETE_FILTER</code> procedure removes the filter named user_ichan.</p>
<p>The <code>DELETE_FILTER</code> procedure in this example uses the <code>fname</code> required parameter, which specifies the name of the filter to be removed.</p>
</div>
<!-- class="sect3" -->
<a id="BABDCAJB"></a>
<div id="RATUG267" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">11.6.4.3</span> Creating a Replay Filter Set</h4>
<p>After the workload replay filters are added, you can create a set of replay filters to use with workload replay. When creating a replay filter set, all workload replay filters that were added since the previous replay filter set was created will be used.</p>
<p>To create a replay filter set, use the <a id="sthref252"></a><code>CREATE_FILTER_SET</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPLAY.CREATE_FILTER_SET (
                           replay_dir =&gt; 'apr09',
                           filter_set =&gt; 'replayfilters',
                           default_action =&gt; 'INCLUDE');
END;
/
</pre>
<p>In this example, the <code>CREATE_FILTER_SET</code> procedure creates a replay filter set named replayfilters, which will replay all captured calls for the replay stored in the <code>apr09</code> directory, except for the part of the workload defined by the replay filters.</p>
<p>The <code>CREATE_FILTER_SET</code> procedure in this example uses the following parameters:</p>
<ul>
<li>
<p>The <code>replay_dir</code> parameter specifies the directory where the replay to be filtered is stored</p>
</li>
<li>
<p>The <code>filter_set</code> parameter specifies the name of the filter set to create</p>
</li>
<li>
<p>The <code>default_action</code> parameter determines if every captured database call should be replayed and whether the workload replay filters should be considered as inclusion or exclusion filters.</p>
<p>If this parameter is set to <code>INCLUDE</code>, all captured database calls will be replayed, except for the part of the workload defined by the replay filters. In this case, all replay filters will be treated as exclusion filters, since they will define the part of the workload that will not be replayed. This is the default behavior.</p>
<p>If this parameter is set to <code>EXCLUDE</code>, none of the captured database calls will be replayed, except for the part of the workload defined by the replay filters. In this case, all replay filters will be treated as inclusion filters, since they will define the part of the workload that will be replayed.</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<a id="BABJABHC"></a>
<div id="RATUG268" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">11.6.4.4</span> Using a Replay Filter Set</h4>
<p>Once the replay filter set is created and the replay is initialized, you can use the replay filter set to filter the replay in the <code>replay_dir</code> directory.</p>
<p>To use a replay filter set, use the <a id="sthref253"></a><code>USE_FILTER_SET</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPLAY.USE_FILTER_SET (filter_set =&gt; 'replayfilters');
END;
/
</pre>
<p>In this example, the <code>USE_FILTER_SET</code> procedure uses the filter set named replayfilters.</p>
<p>The <code>USE_FILTER_SET</code> procedure in this example uses the <code>filter_set</code> required parameter, which specifies the name of the filter set to be used in the replay.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CBAJEBDD"></a>
<div id="RATUG320" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.6.5</span> Setting the Replay Timeout Action</h3>
<p>This section describes how to set a timeout action for the workload replay. You can set a replay timeout action to abort user calls that are significantly slower during replay or cause a replay to hang. For example, you may want to set a replay timeout action to abort runaway queries caused by sub-optimal execution plans following a database upgrade.</p>
<p>When a replay timeout action is enabled, a user call will exit with an <code>ORA-15569</code> error if it is delayed beyond the conditions specified by the replay timeout action. The aborted call and its error are reported as error divergence.</p>
<p>To set a replay timeout, use the <a id="sthref254"></a><code>SET_REPLAY_TIMEOUT</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPLAY.SET_REPLAY_TIMEOUT (
                           enabled =&gt; TRUE,
                           min_delay =&gt; 20,
                           max_delay =&gt; 60,
                           delay_factor =&gt; 10);
END;
/
</pre>
<p>In this example, the <code>SET_REPLAY_TIMEOUT</code> procedure defines a replay timeout action that will abort a user call if the delay during replay is more than 60 minutes, or if the delay during replay is over 20 minutes and the elapsed time is 10 times greater than the capture elapsed time.</p>
<p>The <code>SET_REPLAY_TIMEOUT</code> procedure in this example uses the following parameters:</p>
<ul>
<li>
<p>The <code>enabled</code> parameter specifies if the replay timeout action is enabled or disabled. The default value is <code>TRUE</code>.</p>
</li>
<li>
<p>The <code>min_delay</code> parameter defines the lower bound value of call delay in minutes. The replay timeout action is only activated when the delay is over this value. The default value is 10.</p>
</li>
<li>
<p>The <code>max_delay</code> parameter defines the upper bound value of call delay in minutes. The replay timeout action is activated and issues an error when the delay is over this value. The default value is 120.</p>
</li>
<li>
<p>The <code>delay_factor</code> parameter defines a factor for the call delays that are between the values of <code>min_delay</code> and <code>max_delay</code>. The replay timeout action issues an error when the current replay elapsed time is higher than the multiplication of the capture elapsed time and this value. The default value is 8.</p>
</li>
</ul>
<p>To retrieve the replay timeout action setting, use the <code>GET_REPLAY_TIMEOUT</code> procedure:</p>
<pre>
DECLARE
  enabled        BOOLEAN;
  min_delay      NUMBER;
  max_delay      NUMBER;
  delay_factor   NUMBER;
BEGIN
  DBMS_WORKLOAD_REPLAY.GET_REPLAY_TIMEOUT(enabled, min_delay, max_delay,
                           delay_factor);
END;
/
</pre>
<p>The <code>GET_REPLAY_TIMEOUT</code> procedure in this example returns the following parameters:</p>
<ul>
<li>
<p>The <code>enabled</code> parameter returns whether the replay timeout action is enabled or disabled.</p>
</li>
<li>
<p>The <code>min_delay</code> parameter returns the lower bound value of call delay in minutes.</p>
</li>
<li>
<p>The <code>max_delay</code> parameter returns the upper bound value of call delay in minutes.</p>
</li>
<li>
<p>The <code>delay_factor</code> parameter returns the delay factor.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CHDGEDDH"></a>
<div id="RATUG155" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.6.6</span> Starting a Workload Replay</h3>
<p>Before starting a <a id="sthref255"></a>workload replay, you must first:</p>
<ul>
<li>
<p>Preprocess the captured workload, as described in <a href="dbr_preprocess.htm#CHDJIJFH">"Preprocessing a Database Workload Using APIs"</a></p>
</li>
<li>
<p>Initialize the replay data, as described in <a href="#CHDHCJEH">"Initializing Replay Data"</a></p>
</li>
<li>
<p>Specify the replay options, as described in <a href="#CHDGDCBH">"Setting Workload Replay Options"</a></p>
</li>
<li>
<p>Start the replay clients, as described in <a href="#CHDDDJDH">"Starting Replay Clients"</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Once a workload replay is started, new replay clients will not be able to connect to the database. Only replay clients that were started before the <code>START_REPLAY</code> procedure is executed will be used to replay the captured workload.</div>
<p>To start a workload replay, use the <a id="sthref256"></a><code>START_REPLAY</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPLAY.START_REPLAY ();
END;
/
</pre></div>
<!-- class="sect2" -->
<a id="BABEHJAD"></a>
<div id="RATUG269" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.6.7</span> Pausing a Workload Replay</h3>
<p>To pause a <a id="sthref257"></a>workload replay that is in progress, use the <a id="sthref258"></a><code>PAUSE_REPLAY</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPLAY.PAUSE_REPLAY ();
END;
/
</pre>
<p>Pausing a workload replay will halt all subsequent user calls issued by the replay clients until the workload replay is either resumed or cancelled. User calls that are already in progress will be allowed to complete. This option enables you to temporarily stop the replay to perform a change and observe its impact for the remainder of the replay.</p>
</div>
<!-- class="sect2" -->
<a id="BABEABFI"></a>
<div id="RATUG270" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.6.8</span> Resuming a Workload Replay</h3>
<p>To resume a <a id="sthref259"></a>workload replay that is paused, use the <a id="sthref260"></a><code>RESUME_REPLAY</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPLAY.RESUME_REPLAY ();
END;
/
</pre></div>
<!-- class="sect2" -->
<a id="CHDEEEBB"></a>
<div id="RATUG156" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.6.9</span> Cancelling a Workload Replay</h3>
<p>To cancel a <a id="sthref261"></a>workload replay, use the <a id="sthref262"></a><code>CANCEL_REPLAY</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPLAY.CANCEL_REPLAY ();
END;
/
</pre></div>
<!-- class="sect2" -->
<a id="CHDGEHAA"></a>
<div id="RATUG157" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.6.10</span> Exporting AWR Data for Workload Replay</h3>
<p>Exporting AWR data enables detailed analysis of the workload. This data is also required if you plan to run the AWR Compare Period report on a pair of workload captures or replays.</p>
<p>To <a id="sthref263"></a>export AWR data, use the <a id="sthref264"></a><code>EXPORT_AWR</code> procedure:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPLAY.EXPORT_AWR (replay_id =&gt; 1);
END;
/
</pre>
<p>In this example, the AWR snapshots that correspond to the workload replay with a replay ID of 1 are exported, along with any SQL tuning set that may have been captured during workload replay. The <code>EXPORT_AWR</code> procedure uses the <code>replay_id</code> required parameter, which specifies the ID of the replay whose AWR snapshots will be exported. This procedure will work only if the corresponding workload replay was performed in the current database and the AWR snapshots that correspond to the original replay time period are still available.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABDHJJD"></a>
<div id="RATUG302" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">11.7</span> Monitoring Workload Replay Using APIs</h2>
<p>This section describes how to monitor <a id="sthref265"></a>workload replay using APIs and views. You can also use Oracle Enterprise Manager to monitor workload replay, as described in <a href="#CHDFDCCB">"Monitoring a Workload Replay Using Enterprise Manager"</a>.</p>
<p>This section contains the following topics:</p>
<ul>
<li>
<p><a href="#BABECDIG">Retrieving Information About Diverged Calls</a></p>
</li>
<li>
<p><a href="#CHDCIFJA">Monitoring Workload Replay Using Views</a></p>
</li>
</ul>
<a id="BABECDIG"></a>
<div id="RATUG303" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">11.7.1</span> Retrieving Information About Diverged Calls</h3>
<p>During replay, any error and data discrepancies between the replay system and the capture system are recorded as diverged calls.</p>
<p>To retrieve information about a diverged call&mdash;including its SQL identifier, SQL text, and bind values&mdash;call the <a id="sthref266"></a><code>GET_DIVERGING_STATEMENT</code> function using the following parameters:</p>
<ul>
<li>
<p>Set the <code>replay_id</code> parameter to the ID of the replay in which the call diverged</p>
</li>
<li>
<p>Set the <code>stream_id</code> parameter to the stream ID of the diverged call</p>
</li>
<li>
<p>Set the <code>call_counter</code> parameter to the call counter of the diverged call</p>
</li>
</ul>
<p>To view these information about a diverged call, use the <code>DBA_WORKLOAD_REPLAY_DIVERGENCE</code> view. The following example illustrates a function call:</p>
<pre>
DECLARE
  r                   CLOB;
  ls_stream_id        NUMBER;
  ls_call_counter     NUMBER;
  ls_sql_cd           VARCHAR2(20);
  ls_sql_err          VARCHAR2(512);
  CURSOR c IS
  SELECT stream_id, call_counter
  FROM DBA_WORKLOAD_REPLAY_DIVERGENCE
  WHERE replay_id = 72;
BEGIN
  OPEN c;
  LOOP
  FETCH c INTO ls_stream_id, ls_call_counter;
  EXIT when c%notfound;
  DBMS_OUTPUT.PUT_LINE (ls_stream_id||''||ls_call_counter);
  r:=DBMS_WORKLOAD_REPLAY.GET_DIVERGING_STATEMENT(replay_id =&gt; 72,
  stream_id =&gt; ls_stream_id, call_counter =&gt; ls_call_counter);
  DBMS_OUTPUT.PUT_LINE (r);
  END LOOP;
END;
/
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ARPLS208" href="../../appdev.112/e40758/d_workload_replay.htm#ARPLS208"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>DBMS_WORKLOAD_REPLAY</code> package</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CHDCIFJA"></a>
<div id="RATUG158" class="sect2">
<h3 class="sect2"><span class="secnum">11.7.2</span> Monitoring Workload Replay Using Views</h3>
<p>This section summarizes the views that you can display to monitor workload replay. You need DBA privileges to access these views.</p>
<ul>
<li>
<p>The <code>DBA_WORKLOAD_CAPTURES</code> view lists all the workload captures that have been captured in the current database.</p>
</li>
<li>
<p>The <code>DBA_WORKLOAD_FILTERS</code> view lists all workload filters for workload captures defined in the current database.</p>
</li>
<li>
<p>The <code>DBA_WORKLOAD_REPLAYS</code> view lists all the workload replays that have been replayed in the current database.</p>
</li>
<li>
<p>The <code>DBA_WORKLOAD_REPLAY_DIVERGENCE</code> view enables you to view information about diverged calls, such as the replay identifier, stream identifier, and call counter.</p>
</li>
<li>
<p>The <code>DBA_WORKLOAD_REPLAY_FILTER_SET</code> view lists all workload filters for workload replays defined in the current database.</p>
</li>
<li>
<p>The <code>DBA_WORKLOAD_CONNECTION_MAP</code> view lists the connection mapping information for workload replay.</p>
</li>
<li>
<p>The <code>V$WORKLOAD_REPLAY_THREAD</code> view lists information about all sessions from the replay clients.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink REFRN" href="../e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a> for information about these views</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1798">
<tr>
<td class="cellalignment1805">
<table class="cellalignment1803">
<tr>
<td class="cellalignment1802"><a href="dbr_preprocess.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1802"><a href="dbr_analyze.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2008, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1807">
<table class="cellalignment1801">
<tr>
<td class="cellalignment1802"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1802"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1802"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1802"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1802"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1802"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
