<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Creating a Pre-Change SQL Trial</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 740" />
<meta name="dcterms.created" content="2014-06-16T16:24:48Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Real Application Testing User's Guide" />
<meta name="dcterms.identifier" content="E41481-03" />
<meta name="dcterms.isVersionOf" content="RATUG" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2008, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="spa_task.htm" title="Previous" type="text/html" />
<link rel="Next" href="spa_post_change.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e41481.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">8/23</span> <!-- End Header -->
<div id="RATUG180" class="chapter"><a id="CACFCGDC"></a>
<h1 class="chapter"><span class="secnum">4</span> Creating a Pre-Change SQL Trial</h1>
<p>After creating a SQL Performance Analyzer task and selecting a SQL tuning set as the input source, you need to establish the <a id="sthref48"></a>initial environment on the test system. Establishing the database environment on the test system involves manually making any necessary environmental changes that affect SQL optimization and performance. These changes may include changing initialization parameters, gathering or setting optimizer statistics, and creating indexes. It is recommended that you build a test system that is as similar to the production system as possible. The dedicated workflows in Enterprise Manager simplifies this process by creating both SQL trials automatically and performing the change restricted to the testing session. For information about setting up the database environment, see <a href="spa_intro.htm#CHDCADGG">"Setting Up the Test System"</a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can optionally run SQL trials on a remote system by providing access to a public database link. When conducting remote SQL trials, the database version of the remote database where the SQL statements are executed must be less than or equal to the database version of the database to which it connects. Starting with Oracle Database release 11.2.0.2, the remote database can be a read-only database, such as an Oracle Active Data Guard instance.</div>
<p>Once the environment on the test system is properly configured, you can build the <a id="sthref49"></a>pre-change version of performance data before performing the system change. You can build SQL trials using SQL Performance Analyzer by using one of the following methods:</p>
<ul>
<li>
<p>Executing the SQL statements in the workload</p>
</li>
<li>
<p>Generating execution plans for the SQL statements in the workload</p>
</li>
<li>
<p>Loading performance data and execution plans from a SQL tuning set (APIs only)</p>
</li>
</ul>
<p>For more information, see <a href="spa_intro.htm#CHDBDHJF">"Measuring the Pre-Change SQL Performance"</a></p>
<p>This chapter described how to create the pre-change SQL trial and contains the following topics:</p>
<ul>
<li>
<p><a href="#CACBFDFB">Creating a Pre-Change SQL Trial Using Enterprise Manager</a></p>
</li>
<li>
<p><a href="#CACCIHDA">Creating a Pre-Change SQL Trial Using APIs</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
The primary interface for creating a pre-change SQL trial is Oracle Enterprise Manager. If for some reason Oracle Enterprise Manager is unavailable, you can create a pre-change SQL trial using the <code>DBMS_SQLPA</code> PL/SQL package.</div>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
Before creating a pre-change SQL trial, you need to create a SQL Performance Analyzer task, as described in <a href="spa_task.htm#BABGCABH">Chapter 3, "Creating an Analysis Task"</a>.</div>
<a id="CACBFDFB"></a>
<div id="RATUG181" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">4.1</span> Creating a Pre-Change SQL Trial Using Enterprise Manager</h2>
<p>This section describes how to collect the <a id="sthref50"></a>pre-change SQL performance data using Oracle Enterprise Manager.</p>
<p class="subhead2"><a id="RATUG276"></a>To create a pre-change SQL trial using Enterprise Manager:</p>
<ol>
<li>
<p>On the Guided Workflow page, click the <span class="bold">Execute</span> icon for the Create SQL Trial in Initial Environment step.</p>
<p>The Create SQL Trial page appears. A summary of the selected SQL tuning set containing the SQL workload is displayed.</p>
<img width="986" height="487" src="img/spa_create_trial.gif" alt="Description of spa_create_trial.gif follows" /><br />
<a id="sthref51" href="img_text/spa_create_trial.htm">Description of the illustration spa_create_trial.gif</a><br />
<br /></li>
<li>
<p>In the SQL Trial Name field, enter the name of the SQL trial.</p>
</li>
<li>
<p>In the SQL Trial Description field, enter a description of the SQL trial.</p>
</li>
<li id="CACFCCIJ">
<p>In the Creation Method list, determine how the SQL trial is created and what contents are generated by performing one of the following actions:</p>
<ul>
<li>
<p>Select <span class="bold">Execute SQLs Locally</span>.</p>
<p>The SQL trial generates both execution plans and statistics for each SQL statement in the SQL tuning set by actually running the SQL statements locally on the test system.</p>
</li>
<li>
<p>Select <span class="bold">Execute SQLs Remotely</span>.</p>
<p>The SQL trial generates both execution plans and statistics for each SQL statement in the SQL tuning set by actually running the SQL statements remotely on another test system over a public database link.</p>
</li>
<li>
<p>Select <span class="bold">Generate Plans Locally</span>.</p>
<p>The SQL trial invokes the optimizer to create execution plans locally on the test system, after taking bind values and optimizer configuration into account, without actually running the SQL statements.</p>
</li>
<li>
<p>Select <span class="bold">Generate Plans Remotely</span>.</p>
<p>The SQL trial invokes the optimizer to create execution plans remotely on another test system, after taking bind values and optimizer configuration into account, over a public database link without actually running the SQL statements.</p>
</li>
<li>
<p>Select <span class="bold">Build From SQL Tuning Set</span>.</p>
<p>The SQL trial copies the execution plans and statistics from the SQL tuning set directly into the trial.</p>
</li>
</ul>
<p>For more information about the different methods, see <a href="spa_intro.htm#CHDBDHJF">"Measuring the Pre-Change SQL Performance"</a>.</p>
</li>
<li>
<p>In the Per-SQL Time Limit list, determine the time limit for SQL execution during the trial by performing one of the following actions:</p>
<ul>
<li>
<p>Select <span class="bold">5 minutes</span>.</p>
<p>The execution will run each SQL statement in the SQL tuning set up to 5 minutes and gather performance data.</p>
</li>
<li>
<p>Select <span class="bold">Unlimited</span>.</p>
<p>The execution will run each SQL statement in the SQL tuning set to completion and gather performance data. Collecting execution statistics provides greater accuracy in the performance analysis but takes a longer time. Using this setting is not recommended because the task may be stalled by one SQL statement for a prolonged period.</p>
</li>
<li>
<p>Select <span class="bold">Customize</span> and enter the specified number of seconds, minutes, or hours.</p>
</li>
</ul>
</li>
<li>
<p>Ensure that the database environment on the test system matches the production environment as closely as possible, and select <span class="bold">Trial environment established</span>.</p>
</li>
<li>
<p>In the Schedule section:</p>
<ol>
<li>
<p>In the Time Zone list, select your time zone code.</p>
</li>
<li>
<p>Select <span class="bold">Immediately</span> to start the task now, or <span class="bold">Later</span> to schedule the task to start at a time specified using the Date and Time fields.</p>
</li>
</ol>
</li>
<li>
<p>Click <span class="bold">Submit</span>.</p>
<p>The Guided Workflow page appears when the execution begins.</p>
<p>The status icon of this step changes to a clock while the execution is in progress. To refresh the status icon, click <span class="bold">Refresh</span>. Depending on the options selected and the size of the SQL workload, the execution may take a long time to complete. After the execution is completed, the Status icon will change to a check mark and the Execute icon for the next step is enabled.</p>
</li>
<li>
<p>Once the pre-change performance data is built, you can make the system change and build the post-change performance data by re-executing the SQL statements in the SQL tuning set on the post-change test system, as described in <a href="spa_post_change.htm#CDEFIJBB">Chapter 5, "Creating a Post-Change SQL Trial"</a>.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="CACCIHDA"></a>
<div id="RATUG182" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">4.2</span> Creating a Pre-Change SQL Trial Using APIs</h2>
<p>This section describes how to build the <a id="sthref52"></a>pre-change performance data by using the <code>DBMS_SQLPA.EXECUTE_ANALYSIS_TASK</code> procedure.</p>
<p>Call the <a id="sthref53"></a><code>EXECUTE_ANALYSIS_TASK</code> procedure using the following parameters:</p>
<ul>
<li>
<p>Set the <code>task_name</code> parameter to the name of the SQL Performance Analyzer task that you want to execute.</p>
</li>
<li>
<p>Set the <code>execution_type</code> parameter in one of the following ways:</p>
<ul>
<li>
<p>Set to <code>EXPLAIN PLAN</code> to generate execution plans for all SQL statements in the SQL tuning set without executing them.</p>
</li>
<li>
<p>Set to <code>TEST EXECUTE</code> (recommended) to execute all statements in the SQL tuning set and generate their execution plans and statistics. When <code>TEST EXECUTE</code> is specified, the procedure generates execution plans and execution statistics. The execution statistics enable SQL Performance Analyzer to identify SQL statements that have improved or regressed. Collecting execution statistics in addition to generating execution plans provides greater accuracy in the performance analysis, but takes longer.</p>
</li>
<li>
<p>Set to <code>CONVERT SQLSET</code> to refer to a SQL tuning set for the execution statistics and plans for the SQL trial. Values for the execution parameters <code>SQLSET_NAME</code> and <code>SQLSET_OWNER</code> should also be specified.</p>
</li>
</ul>
</li>
<li>
<p>Specify a name to identify the execution using the <code>execution_name</code> parameter. If not specified, then SQL Performance Analyzer automatically generates a name for the task execution.</p>
</li>
<li>
<p>Specify execution parameters using the <code>execution_params</code> parameters. The <code>execution_params</code> parameters are specified as (<span class="italic">name</span>, <span class="italic">value</span>) pairs for the specified execution. For example, you can set the following execution parameters:</p>
<ul>
<li>
<p>The <code>time_limit</code> parameter specifies the global time limit to process all SQL statements in a SQL tuning set before timing out.</p>
</li>
<li>
<p>The <code>local_time_limit</code> parameter specifies the time limit to process each SQL statement in a SQL tuning set before timing out.</p>
</li>
<li>
<p>To perform a remote test execute, set the <code>DATABASE_LINK</code> task parameter to the global name of a public database link connecting to a user with the <code>EXECUTE</code> privilege for the <code>DBMS_SQLPA</code> package and the <code>ADVISOR</code> privilege on the test system.</p>
</li>
<li>
<p>To fully execute DML statements&mdash;including acquiring row locks and modifying row&mdash;set the <code>EXECUTE_FULLDML</code> parameter to <code>TRUE</code>. SQL Performance Analyzer will issue a rollback after executing the DML statements to prevent persistent changes from being made. The default value for this parameter is <code>FALSE</code>, which executes only the query portion of the DML statement without modifying the data.</p>
</li>
<li>
<p>To restore the relevant captured <code>init.ora</code> settings during a test execute, set the <code>APPLY_CAPTURED_COMPILENV</code> parameter to <code>TRUE</code>. This is not the default behavior because typically you are running SQL trials to test changes when changing the environment. However, this method may be used in cases when the <code>init.ora</code> settings are not being changed (such as creating an index). This method is not supported for remote SQL trials.</p>
</li>
</ul>
</li>
</ul>
<p>The following example illustrates a function call made <span class="italic">before</span> a system change:</p>
<pre>
EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK(task_name =&gt; 'my_spa_task', -
       execution_type =&gt; 'TEST EXECUTE', - 
       execution_name =&gt; 'my_exec_BEFORE_change');
</pre>
<p>Once the pre-change performance data is built, you can make the system change and build the post-change performance data by re-executing the SQL statements in the SQL tuning set on the post-change test system, as described in <a href="spa_post_change.htm#CDEFIJBB">Chapter 5, "Creating a Post-Change SQL Trial"</a>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ARPLS229" href="../../appdev.112/e40758/d_sqlpa.htm#ARPLS229"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> to learn about the <code>DBMS_SQLPA.EXECUTE_ANALYSIS_TASK</code> function</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1798">
<tr>
<td class="cellalignment1805">
<table class="cellalignment1803">
<tr>
<td class="cellalignment1802"><a href="spa_task.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1802"><a href="spa_post_change.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2008, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1807">
<table class="cellalignment1801">
<tr>
<td class="cellalignment1802"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1802"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1802"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1802"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1802"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1802"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
