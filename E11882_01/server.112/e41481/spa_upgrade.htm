<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Testing a Database Upgrade</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 740" />
<meta name="dcterms.created" content="2014-06-16T16:24:49Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Real Application Testing User's Guide" />
<meta name="dcterms.identifier" content="E41481-03" />
<meta name="dcterms.isVersionOf" content="RATUG" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2008, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="spa_analyze.htm" title="Previous" type="text/html" />
<link rel="Next" href="part2.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e41481.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">11/23</span> <!-- End Header -->
<div id="RATUG210" class="chapter"><a id="CIADFIDI"></a>
<h1 class="chapter"><span class="secnum">7</span> Testing a Database Upgrade</h1>
<p>SQL Performance Analyzer supports testing <a id="sthref88"></a>database upgrades from Oracle9<span class="italic">i</span> and later releases to Oracle Database 10<span class="italic">g</span> Release 2 or newer releases. The methodology used to test a database upgrade from Oracle9<span class="italic">i</span> Database and Oracle Database 10<span class="italic">g</span> Release 1 is slightly different from the one used to test a database upgrade from Oracle Database 10<span class="italic">g</span> Release 2 and later releases, so both methodologies are described here.</p>
<p>This chapter describes how to use SQL Performance Analyzer in a database upgrade and contains the following sections:</p>
<ul>
<li>
<p><a href="#CIAIFDIJ">Upgrading from Oracle9<span class="italic">i</span> Database and Oracle Database 10<span class="italic">g</span> Release 1</a></p>
</li>
<li>
<p><a href="#CIAJDJBD">Upgrading from Oracle Database 10<span class="italic">g</span> Release 2 and Newer Releases</a></p>
</li>
<li>
<p><a href="#CIADFIIF">Tuning Regressed SQL Statements After Testing a Database Upgrade</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
For information about using SQL Performance Analyzer in other cases, see <a href="rat_intro.htm#CHDDDHBF">"SQL Performance Analyzer"</a></div>
<a id="CIAIFDIJ"></a>
<div id="RATUG211" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">7.1</span> Upgrading from Oracle9<span class="italic">i</span> Database and Oracle Database 10<span class="italic">g</span> Release 1</h2>
<p>As illustrated in <a href="#CIAHCDCE">Figure 7-1</a>, SQL Performance Analyzer supports testing database upgrades of Oracle9<span class="italic">i</span> Database and Oracle Database 10<span class="italic">g</span> Release 1 to Oracle Database 10g Release 2 and later releases by building a SQL tuning set from SQL trace files captured on the production system, executing the SQL tuning set on the upgraded database remotely over a database link, and then comparing the results to those captured on the production system. Because SQL Performance Analyzer only accepts a set of SQL statements stored in a SQL tuning set as its <a id="sthref89"></a>input source, and SQL tuning sets are not supported in Oracle9<span class="italic">i</span> Database, a SQL tuning set must be constructed so that it can be used as an input source for SQL Performance Analyzer if you are upgrading from Oracle9<span class="italic">i</span> Database.</p>
<div id="RATUG249" class="figure">
<p class="titleinfigure"><a id="CIAHCDCE"></a>Figure 7-1 SQL Performance Analyzer Workflow for Database Upgrade from Oracle9i to Oracle Database 10g Release 2</p>
<img width="582" height="366" src="img/ratug003.gif" alt="Description of Figure 7-1 follows" /><br />
<a id="sthref90" href="img_text/ratug003.htm">Description of "Figure 7-1 SQL Performance Analyzer Workflow for Database Upgrade from Oracle9i to Oracle Database 10g Release 2"</a><br />
<br /></div>
<!-- class="figure" -->
<p><a id="sthref91"></a>The <a id="sthref92"></a>production system which you are upgrading from should be running Oracle9<span class="italic">i</span> or Oracle Database 10<span class="italic">g</span> Release 1. The <a id="sthref93"></a>test system which you are upgrading to should be running Oracle Database 10<span class="italic">g</span> Release 2 or a newer release. The database version can be release 10.2.0.2 or higher. If you are upgrading to Oracle Database 10<span class="italic">g</span> release 10.2.0.2, 10.2.0.3, or 10.2.0.4, you will also need to install a one-off patch before proceeding.</p>
<p>To ensure that the analysis made by SQL Performance Analyzer is accurate, the test system should resemble the production system as closely as possible because the performance on both systems will be compared to each other. Furthermore, the hardware configurations on both systems should also be as similar as possible.</p>
<p>Next, you will need to set up a separate SQL Performance Analyzer <a id="sthref94"></a>system running Oracle Database 11<span class="italic">g</span> Release 2. You will be using this system to build a SQL tuning set and to run SQL Performance Analyzer. Neither your production data or schema need to be available on this system, since the SQL tuning set will be built using statistics stored in the SQL trace files from the production system. SQL Performance Analyzer tasks will be executed remotely on the test system to generate the execution plan and statistics for the SQL trial over a database link that you specify. The database link must be a public database link that connects to a user with the <code>EXECUTE</code> privilege for the <code>DBMS_SQLPA</code> package and the <code>ADVISOR</code> privilege on the test system. You should also drop any existing <code>PLAN_TABLE</code> from the user's schema on the test system.</p>
<p>Once the upgrade environment is configured as described, perform the steps as described in the following procedure to use SQL Performance Analyzer in a database upgrade from Oracle9<span class="italic">i</span> or Oracle Database 10<span class="italic">g</span> Release 1 to a newer release.</p>
<ol>
<li>
<p>Enable the <a id="sthref95"></a>SQL Trace facility on the production system, as described in <a href="#CIAFGCBI">"Enabling SQL Trace on the Production System"</a>.</p>
<p>To minimize the performance impact on the production system and still be able to fully capture a representative set of SQL statements, consider enabling SQL Trace for only a subset of the sessions, for as long as required, to capture all important SQL statements at least once.</p>
</li>
<li>
<p>On the production system, create a <a id="sthref96"></a>mapping table, as described in <a href="#CIADAFGC">"Creating a Mapping Table"</a>.</p>
<p>This mapping table will be used to convert the user and object identifier numbers in the SQL trace files to their string equivalents.</p>
</li>
<li>
<p>Move the <a id="sthref97"></a>SQL trace files and the <a id="sthref98"></a>mapping table from the production system to the SQL Performance Analyzer system, as described in <a href="#CIADAFGC">"Creating a Mapping Table"</a>.</p>
</li>
<li>
<p>On the SQL Performance Analyzer system, construct a <a id="sthref99"></a>SQL tuning set using the SQL trace files, as described in <a href="#CIAIFAFC">"Building a SQL Tuning Set"</a>.</p>
<p>The SQL tuning set will contain the SQL statements captured in the SQL trace files, along with their relevant execution context and statistics.</p>
</li>
<li>
<p>On the SQL Performance Analyzer system, use SQL Performance Analyzer to create a <a id="sthref100"></a>SQL Performance Analyzer task and convert the contents in the <a id="sthref101"></a>SQL tuning set into a pre-upgrade <a id="sthref102"></a>SQL trial that will be used as a baseline for comparison, then remotely test execute the SQL statements on the test system over a database link to build a post-upgrade <a id="sthref103"></a>SQL trial, as described in <a href="#CHDGIEJE">"Testing Database Upgrades from Oracle9<span class="italic">i</span> Database and Oracle Database 10<span class="italic">g</span> Release 1"</a>.</p>
</li>
<li>
<p>Compare <a id="sthref104"></a>SQL performance and fix <a id="sthref105"></a>regressed SQL.</p>
<p>SQL Performance Analyzer compares the performance of SQL statements read from the SQL tuning set during the pre-upgrade SQL trial to those captured from the remote test execution during the post-upgrade SQL trial. A report is produced to identify any changes in execution plans or performance of the SQL statements.</p>
<p>If the report reveals any regressed SQL statements, you can make further changes to fix the regressed SQL, as described in <a href="#CIADFIIF">"Tuning Regressed SQL Statements After Testing a Database Upgrade"</a>.</p>
<p>Repeat the process of executing the SQL tuning set and comparing its performance to a previous execution to test any changes made until you are satisfied with the outcome of the analysis.</p>
</li>
</ol>
<a id="CIAFGCBI"></a>
<div id="RATUG212" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">7.1.1</span> Enabling SQL Trace on the Production System</h3>
<p>Oracle9<span class="italic">i</span> uses the <a id="sthref106"></a>SQL Trace facility to collect performance data on individual SQL statements. The information generated by SQL Trace is stored in <a id="sthref107"></a>SQL trace files. SQL Performance Analyzer consumes the following information from these files:</p>
<ul>
<li>
<p>SQL text and username under which parse occurred</p>
</li>
<li>
<p>Bind values for each execution</p>
</li>
<li>
<p>CPU and elapsed times</p>
</li>
<li>
<p>Physical reads and logical reads</p>
</li>
<li>
<p>Number of rows processed</p>
</li>
<li>
<p>Execution plan for each SQL statement (only captured if the cursor for the SQL statement is closed)</p>
</li>
</ul>
<p>Although it is possible to enable <a id="sthref108"></a>SQL Trace for an instance, it is recommended that you enable SQL Trace for a subset of sessions instead. When the SQL Trace facility is enabled for an instance, performance statistics for all SQL statements executed in the instance are stored into SQL trace files. Using SQL Trace in this way can have a severe performance impact and may result in increased system overhead, excessive CPU usage, and inadequate disk space. It is required that <a id="sthref109"></a>trace level be set to 4 to capture bind values, along with the execution plans.</p>
<p>For production systems running Oracle Database 10<span class="italic">g</span> Release 1, use the <code>DBMS_MONITOR</code>.<code>SESSION_TRACE_ENABLE</code> procedure to enable SQL Trace transparently in another session. You should also enable binds explicitly by setting the <code>binds</code> procedure parameter to <code>TRUE</code> (its default value is <code>FALSE</code>).</p>
<p>After enabling SQL Trace, identify the SQL trace files containing statistics for a representative set of SQL statements that you want to use with SQL Performance Analyzer. You can then copy the <a id="sthref110"></a>SQL trace files to the SQL Performance Analyzer system. Once the SQL workload is captured in the SQL trace files, disable SQL Trace on the production system.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink PFGRF010" href="../../server.112/e41573/sqltrace.htm#PFGRF010"><span class="italic">Oracle Database Performance Tuning Guide</span></a> for additional considerations when using SQL Trace, such as setting initialization parameters to manage SQL trace files</p>
</li>
<li>
<p><a class="olink ARPLS091" href="../../appdev.112/e40758/d_monitor.htm#ARPLS091"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>DBMS_MONITOR</code> package</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CIADAFGC"></a>
<div id="RATUG213" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">7.1.2</span> Creating a Mapping Table</h3>
<p><a id="sthref111"></a>To convert the user and object identifier numbers stored in the SQL trace files to their respective names, you need to provide a table that specifies each mapping. The SQL Performance Analyzer system will read this mapping table when converting the trace files into a SQL tuning set.</p>
<p>To create a <a id="sthref112"></a>mapping table, run the following SQL statements on the production database:</p>
<pre>
CREATE TABLE mapping AS
    SELECT object_id id, owner, SUBSTR(object_name, 1, 30) name FROM dba_objects
    WHERE object_type NOT IN ('CONSUMER GROUP', 'EVALUATION CONTEXT', 'FUNCTION',
                              'INDEXTYPE', 'JAVA CLASS', 'JAVA DATA',
                              'JAVA RESOURCE', 'LIBRARY', 'LOB', 'OPERATOR',
                              'PACKAGE', 'PACKAGE BODY', 'PROCEDURE', 'QUEUE',
                              'RESOURCE PLAN', 'SYNONYM', 'TRIGGER', 'TYPE',
                              'TYPE BODY')
    UNION ALL
    SELECT user_id id, username owner, null name FROM dba_users;
</pre>
<p>Once the <a id="sthref113"></a>mapping table is created, you can use Data Pump to transport it to the SQL Performance Analyzer system.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SUTIL100" href="../../server.112/e22490/dp_overview.htm#SUTIL100"><span class="italic">Oracle Database Utilities</span></a> for information about using Data Pump</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CIAIFAFC"></a>
<div id="RATUG214" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">7.1.3</span> Building a SQL Tuning Set</h3>
<p>Once the SQL trace files and mapping table are moved to the SQL Performance Analyzer system, you can build a SQL tuning set using the <code>DBMS_SQLTUNE</code> package.</p>
<p>To build a <a id="sthref114"></a>SQL tuning set:</p>
<ol>
<li>
<p>Copy the SQL trace files to a directory on the SQL Performance Analyzer system.</p>
</li>
<li>
<p>Create a directory object for this directory.</p>
</li>
<li>
<p>Use the <code>DBMS_SQLTUNE</code>.<a id="sthref115"></a><code>SELECT_SQL_TRACE</code> function to read the SQL statements from the SQL trace files.</p>
<p>For each SQL statement, only information for a single execution is collected. The execution frequency of each SQL statement is not captured. Therefore, when performing a comparison analysis for a production system running Oracle Database 10<span class="italic">g</span> Release 1 and older releases, you should ignore the workload-level statistics in the SQL Performance Analyzer report and only evaluate performance changes on an execution level.</p>
<p>The following example reads the contents of SQL trace files stored in the <code>sql_trace_prod</code> directory object and loads them into a SQL tuning set.</p>
<pre>
DECLARE
  cur sys_refcursor;
BEGIN
  DBMS_SQLTUNE.CREATE_SQLSET('my_sts_9i');
  OPEN cur FOR
    SELECT VALUE (P) 
    FROM table(DBMS_SQLTUNE.SELECT_SQL_TRACE('sql_trace_prod', '%ora%')) P;
  DBMS_SQLTUNE.LOAD_SQLSET('my_sts_9i', cur);
  CLOSE cur;
END;
/
</pre></li>
</ol>
<p>The syntax for the <code>SELECT_SQL_TRACE</code> function is as follows:</p>
<pre>
  DBMS_SQLTUNE.SELECT_SQL_TRACE ( 
    directory              IN VARCHAR2,
    file_name              IN VARCHAR2 := NULL,
    mapping_table_name     IN VARCHAR2 := NULL,
    mapping_table_owner    IN VARCHAR2 := NULL,
    select_mode            IN POSITIVE := SINGLE_EXECUTION,
    options                IN BINARY_INTEGER := LIMITED_COMMAND_TYPE,
    pattern_start          IN VARCHAR2 := NULL,
    parttern_end           IN VARCHAR2 := NULL,
    result_limit           IN POSITIVE := NULL)
  RETURN sys.sqlset PIPELINED;
</pre>
<p><a href="#CIAHBDDF">Table 7-1</a> describes the available parameters for the <code>SELECT_SQL_TRACE</code> function.</p>
<div id="RATUG250" class="tblformal">
<p class="titleintable"><a id="sthref116"></a><a id="CIAHBDDF"></a>Table 7-1 DBMS_SQLTUNE.SELECT_SQL_TRACE Function Parameters</p>
<table class="cellalignment1812" title="DBMS_SQLTUNE.SELECT_SQL_TRACE Function Parameters" summary="Lists the parameters and descriptions of each parameter for the DBMS_SQLTUNE.SELECT_SQL_TRACE function" dir="ltr">
<thead>
<tr class="cellalignment1799">
<th class="cellalignment1809" id="r1c1-t5">Parameter</th>
<th class="cellalignment1809" id="r1c2-t5">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1799">
<td class="cellalignment1805" id="r2c1-t5" headers="r1c1-t5">
<p><code>directory</code></p>
</td>
<td class="cellalignment1805" headers="r2c1-t5 r1c2-t5">
<p>Specifies the directory object pointing to the directory where the SQL trace files are stored.</p>
</td>
</tr>
<tr class="cellalignment1799">
<td class="cellalignment1805" id="r3c1-t5" headers="r1c1-t5">
<p><code>file_name</code></p>
</td>
<td class="cellalignment1805" headers="r3c1-t5 r1c2-t5">
<p>Specifies all or part of the name of the SQL trace files to process. If unspecified, the current or most recent trace file in the specified directory will be used. % wildcards are supported for matching trace file names.</p>
</td>
</tr>
<tr class="cellalignment1799">
<td class="cellalignment1805" id="r4c1-t5" headers="r1c1-t5">
<p><code>mapping_table_name</code></p>
</td>
<td class="cellalignment1805" headers="r4c1-t5 r1c2-t5">
<p>Specifies the name of the mapping table. If set to the default value of <code>NULL</code>, mappings from the current database will be used. Note that the mapping table name is not case-sensitive.</p>
</td>
</tr>
<tr class="cellalignment1799">
<td class="cellalignment1805" id="r5c1-t5" headers="r1c1-t5">
<p><code>mapping_table_owner</code></p>
</td>
<td class="cellalignment1805" headers="r5c1-t5 r1c2-t5">
<p>Specifies the schema where the mapping table resides. If set to <code>NULL</code>, the current schema will be used.</p>
</td>
</tr>
<tr class="cellalignment1799">
<td class="cellalignment1805" id="r6c1-t5" headers="r1c1-t5">
<p><code>select_mode</code></p>
</td>
<td class="cellalignment1805" headers="r6c1-t5 r1c2-t5">
<p>Specifies the mode for selecting SQL statements from the trace files. The default value is <code>SINGLE_EXECUTION</code>. In this mode, only statistics for a single execution per SQL statement will be loaded into the SQL tuning set. The statistics are not cumulative, as is the case with other SQL tuning set data source table functions.</p>
</td>
</tr>
<tr class="cellalignment1799">
<td class="cellalignment1805" id="r7c1-t5" headers="r1c1-t5">
<p><code>options</code></p>
</td>
<td class="cellalignment1805" headers="r7c1-t5 r1c2-t5">
<p>Specifies the options for the operation. The default value is <code>LIMITED_COMMAND_TYPE</code>, only SQL types that are meaningful to SQL Performance Analyzer (such as <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code>) are returned from the SQL trace files.</p>
</td>
</tr>
<tr class="cellalignment1799">
<td class="cellalignment1805" id="r8c1-t5" headers="r1c1-t5">
<p><code>pattern_start</code></p>
</td>
<td class="cellalignment1805" headers="r8c1-t5 r1c2-t5">
<p>Specifies the opening delimiting pattern of the trace file sections to consider. This parameter is currently not used.</p>
</td>
</tr>
<tr class="cellalignment1799">
<td class="cellalignment1805" id="r9c1-t5" headers="r1c1-t5">
<p><code>pattern_end</code></p>
</td>
<td class="cellalignment1805" headers="r9c1-t5 r1c2-t5">
<p>Specifies the closing delimiting pattern of the trace file sections to process. This parameter is currently not used.</p>
</td>
</tr>
<tr class="cellalignment1799">
<td class="cellalignment1805" id="r10c1-t5" headers="r1c1-t5">
<p><code>result_limit</code></p>
</td>
<td class="cellalignment1805" headers="r10c1-t5 r1c2-t5">
<p>Specifies the top SQL from the (filtered) source. The default value is 2<sup>31</sup>, which represents unlimited.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ARPLS220" href="../../appdev.112/e40758/d_sqltun.htm#ARPLS220"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>DBMS_SQLTUNE</code> package</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CHDGIEJE"></a>
<div id="RATUG296" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">7.1.4</span> Testing Database Upgrades from Oracle9<span class="italic">i</span> Database and Oracle Database 10<span class="italic">g</span> Release 1</h3>
<p>Once the SQL tuning set is built, you can use SQL Performance Analyzer to build a pre-upgrade SQL trial from the execution plans and run-time statistics in the SQL tuning set. <a id="sthref117"></a>After the pre-upgrade SQL trial is built, you need to perform a test execute or generate plans of SQL statements in the SQL tuning set on the test system to build a post-upgrade <a id="sthref118"></a>SQL trial. SQL Performance Analyzer test executes the SQL statements using a public database link that you specify by connecting to the test system remotely and generating the execution plans and statistics for the SQL trial. The database link should exist on the SQL Performance Analyzer system and connect to a remote user with privileges to execute the SQL tuning set on the test system.</p>
<p>You can run SQL Performance Analyzer to test a database upgrade from Oracle9<span class="italic">i</span> Database or Oracle Database 10<span class="italic">g</span> Release 1 using Oracle Enterprise Manager or APIs, as described in the following sections:</p>
<ul>
<li>
<p><a href="#CHDDICIH">Testing Database Upgrades from Oracle9<span class="italic">i</span> Database and Oracle Database 10<span class="italic">g</span> Release 1 Using Enterprise Manager</a></p>
</li>
<li>
<p><a href="#CHDIBBEG">Testing Database Upgrades from Oracle9<span class="italic">i</span> Database and Oracle Database 10<span class="italic">g</span> Release 1 Using APIs</a></p>
</li>
</ul>
<a id="CHDDICIH"></a>
<div id="RATUG297" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">7.1.4.1</span> Testing Database Upgrades from Oracle9<span class="italic">i</span> Database and Oracle Database 10<span class="italic">g</span> Release 1 Using Enterprise Manager</h4>
<p>To test a database upgrade from Oracle9<span class="italic">i</span> Database or Oracle Database 10<span class="italic">g</span> Release 1 using SQL Performance Analyzer:</p>
<ol>
<li>
<p>On the Software and Support page, under Real Application Testing, click <span class="bold">SQL Performance Analyzer</span>.</p>
<p>The SQL Performance Analyzer page appears.</p>
</li>
<li>
<p>Under SQL Performance Analyzer Workflows, click <span class="bold">Upgrade from 9i or 10.1</span>.</p>
<p>The Upgrade from 9i or 10.1 page appears.</p>
<img width="541" height="699" src="img/spa_upgrade_9i_101.gif" alt="Description of spa_upgrade_9i_101.gif follows" /><br />
<a id="sthref119" href="img_text/spa_upgrade_9i_101.htm">Description of the illustration spa_upgrade_9i_101.gif</a><br />
<br /></li>
<li>
<p>Under Task Information:</p>
<ol>
<li>
<p>In the Task Name field, enter the name of the task.</p>
</li>
<li>
<p>In the SQL Tuning Set field, enter the name of the SQL tuning set that was built.</p>
<p>Alternatively, click the search icon to search for the SQL tuning set using the Search and Select: SQL Tuning Set window.</p>
<p>The selected SQL tuning set now appears in the SQL Tuning Set field.</p>
</li>
<li>
<p>In the Description field, optionally enter a description of the task.</p>
</li>
</ol>
</li>
<li>
<p>In the Creation Method field, select:</p>
<ul>
<li>
<p><span class="bold">Execute SQLs</span> to generate both execution plans and statistics for each SQL statement in the SQL tuning set by actually running the SQL statements remotely on the test system over a public database link.</p>
</li>
<li>
<p><span class="bold">Generate Plans</span> to create execution plans remotely on the test system over a public database link without actually running the SQL statements.</p>
</li>
</ul>
</li>
<li>
<p>In the Per-SQL Time Limit list, determine the time limit for SQL execution during the trial by performing one of the following actions:</p>
<ul>
<li>
<p>Select <span class="bold">5 minutes</span>.</p>
<p>The execution will run each SQL statement in the SQL tuning set up to 5 minutes and gather performance data.</p>
</li>
<li>
<p>Select <span class="bold">Unlimited</span>.</p>
<p>The execution will run each SQL statement in the SQL tuning set to completion and gather performance data. Collecting execution statistics provides greater accuracy in the performance analysis but takes a longer time. Using this setting is not recommended because the task may be stalled by one SQL statement for a prolonged time period.</p>
</li>
<li>
<p>Select <span class="bold">Customize</span> and enter the specified number of seconds, minutes, or hours.</p>
</li>
</ul>
</li>
<li>
<p>In the Database Link field, enter the global name of a public database link connecting to a user with the <code>EXECUTE</code> privilege for the <code>DBMS_SQLPA</code> package and the <code>ADVISOR</code> privilege on the test system.</p>
<p>Alternatively, click the search icon to search for and select a database link, or click <span class="bold">Create Database Link</span> to create a database link using the Create Database Link page.</p>
</li>
<li>
<p>In the Comparison Metric list, select the comparison metric to use for the comparison analysis:</p>
<ul>
<li>
<p><span class="bold">Elapsed Time</span></p>
</li>
<li>
<p><span class="bold">CPU Time</span></p>
</li>
<li>
<p><span class="bold">User I/O Time</span></p>
</li>
<li>
<p><span class="bold">Buffer Gets</span></p>
</li>
<li>
<p><span class="bold">Physical I/O</span></p>
</li>
<li>
<p><span class="bold">Optimizer Cost</span></p>
</li>
<li>
<p><span class="bold">I/O Interconnect Bytes</span></p>
</li>
</ul>
<p>Optimizer Cost is the only comparison metric available if you generated execution plans only in the SQL trials.</p>
<p>To perform the comparison analysis by using more than one comparison metric, perform separate comparison analyses by repeating this procedure with different metrics.</p>
</li>
<li>
<p>Under Schedule:</p>
<ol>
<li>
<p>In the Time Zone list, select your time zone code.</p>
</li>
<li>
<p>Select <span class="bold">Immediately</span> to start the task now, or <span class="bold">Later</span> to schedule the task to start at a time specified using the Date and Time fields.</p>
</li>
</ol>
</li>
<li>
<p>Click <span class="bold">Submit</span>.</p>
<p>The SQL Performance Analyzer page appears.</p>
<p>In the SQL Performance Analyzer Tasks section, the status of this task is displayed. To refresh the status icon, click <span class="bold">Refresh</span>. After the task completes, the Status field changes to Completed.</p>
</li>
<li>
<p>Under SQL Performance Analyzer Tasks, select the task and click the link in the Name column.</p>
<p>The SQL Performance Analyzer Task page appears.</p>
<p>This page contains the following sections:</p>
<ul>
<li>
<p>SQL Tuning Set</p>
<p>This section summarizes information about the SQL tuning set, including its name, owner, description, and the number of SQL statements it contains.</p>
</li>
<li>
<p>SQL Trials</p>
<p>This section includes a table that lists the SQL trials used in the SQL Performance Analyzer task.</p>
</li>
<li>
<p>SQL Trial Comparisons</p>
<p>This section contains a table that lists the results of the SQL trial comparisons</p>
</li>
</ul>
</li>
<li>
<p>Click the icon in the Comparison Report column.</p>
<p>The SQL Performance Analyzer Task Result page appears.</p>
</li>
<li>
<p>Review the results of the performance analysis, as described in <a href="spa_analyze.htm#CACHAFHE">"Reviewing the SQL Performance Analyzer Report Using Oracle Enterprise Manager"</a>.</p>
<p>If regressed SQL statements are found following the database upgrade, tune them as described in <a href="#CIADFIIF">"Tuning Regressed SQL Statements After Testing a Database Upgrade"</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDIBBEG"></a>
<div id="RATUG298" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">7.1.4.2</span> Testing Database Upgrades from Oracle9<span class="italic">i</span> Database and Oracle Database 10<span class="italic">g</span> Release 1 Using APIs</h4>
<p>After creating a SQL Performance Analyzer task on the SQL Performance Analyzer system, you can use <a id="sthref120"></a>APIs to build the pre-upgrade <a id="sthref121"></a>SQL trial from the execution plans and run-time statistics in the SQL tuning set. To do so, call the <a id="sthref122"></a><code>EXECUTE_ANALYSIS_TASK</code> procedure using the following parameters:</p>
<ul>
<li>
<p>Set the <code>task_name</code> parameter to the name of the SQL Performance Analyzer task that you want to execute.</p>
</li>
<li>
<p>Set the <code>execution_type</code> parameter to <code>CONVERT SQLSET</code> to direct SQL Performance Analyzer to treat the statistics in the SQL tuning set as a trial execution.</p>
</li>
<li>
<p>Specify a name to identify the execution using the <code>execution_name</code> parameter. If not specified, then SQL Performance Analyzer automatically generates a name for the task execution.</p>
</li>
</ul>
<p>The following example executes the SQL Performance Analyzer task named <code>my_spa_task</code> as a trial execution:</p>
<pre>
EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK(task_name =&gt; 'my_spa_task', -
       execution_type =&gt; 'CONVERT SQLSET', - 
       execution_name =&gt; 'my_trial_9i');
</pre>
<p>To build the post-upgrade SQL trial using APIs, perform an explain plan or test execute using the SQL Performance Analyzer system by calling the <code>EXECUTE_ANALYSIS_TASK</code> procedure. Set the <code>DATABASE_LINK</code> task parameter to the global name of a public database link connecting to a user with the <code>EXECUTE</code> privilege for the <code>DBMS_SQLPA</code> package and the <code>ADVISOR</code> privilege on the test system.</p>
<p>If you choose to use <code>EXPLAIN PLAN</code>, only execution plans will be generated. Subsequent comparisons will only be able to yield a list of changed plans without making any conclusions about performance changes. If you choose to use <code>TEST EXECUTE</code>, the SQL workload will be executed to completion. This effectively builds the post-upgrade SQL trial using the statistics and execution plans generated from the test system. Using <code>TEST EXECUTE</code> is recommended to capture the SQL execution plans and performance data at the source, thereby resulting in a more accurate analysis.</p>
<p>The following example performs a test execute of the SQL statements remotely over a database link:</p>
<pre>
EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK(task_name =&gt; 'my_spa_task', -
       execution_type =&gt; 'TEST EXECUTE', - 
       execution_name =&gt; 'my_remote_trial_10g', -
       execution_params =&gt; dbms_advisor.arglist('database_link',
                                                'LINK.A.B.C.BIZ.COM'));
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CIAJDJBD"></a>
<div id="RATUG221" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">7.2</span> Upgrading from Oracle Database 10<span class="italic">g</span> Release 2 and Newer Releases</h2>
<p>You can use SQL Performance Analyzer to test the impact on SQL response time of a database upgrade from Oracle Database 10<span class="italic">g</span> Release 2 or a newer release to any later release by capturing a SQL tuning set on the production system, then executing it twice remotely over a database link on a test system&mdash;first to create a pre-change SQL trial, then again to create a post-change SQL trial.</p>
<p><a id="sthref123"></a>The <a id="sthref124"></a>production system which you are upgrading from should be running Oracle Database 10<span class="italic">g</span> Release 2 or a newer release. Initially, the <a id="sthref125"></a>test system should also be running the same release. To ensure that the analysis made by SQL Performance Analyzer is accurate, the test system should contain an exact copy of the production data found on the production system. Furthermore, the hardware configuration should also be as similar to the production system as possible.</p>
<p>Next, you will need to set up a separate SQL Performance Analyzer <a id="sthref126"></a>system running Oracle Database 11<span class="italic">g</span> Release 2. You will be using this system to run SQL Performance Analyzer. Neither your production data or schema need to be available on this system, since the SQL tuning set will be built using statistics stored in the SQL trace files from the production system. SQL Performance Analyzer tasks will be executed remotely on the test system to generate the execution plan and statistics for the SQL trial over a database link that you specify. The database link must be a public database link that connects to a user with the <code>EXECUTE</code> privilege for the <code>DBMS_SQLPA</code> package and the <code>ADVISOR</code> privilege on the test system. You should also drop any existing <code>PLAN_TABLE</code> from the user's schema on the test system.</p>
<p>Once the upgrade environment is configured as described, perform the steps as described in the following procedure to use SQL Performance Analyzer in a database upgrade from Oracle Database 10<span class="italic">g</span> Release 2 or a newer release to any later release.</p>
<ol>
<li>
<p>On the production system, capture the SQL workload that you intend to analyze and store it in a SQL tuning set, as described in <a href="spa_intro.htm#CHDFCBDC">"Capturing the SQL Workload"</a>.</p>
</li>
<li>
<p>Set up the test system so that it matches the production environment as closely as possible, as described in <a href="spa_intro.htm#CHDCADGG">"Setting Up the Test System"</a>.</p>
</li>
<li>
<p>Transport the SQL tuning set to the SQL Performance Analyzer system.</p>
<p>For information about transporting SQL tuning sets using:</p>
<ul>
<li>
<p>Oracle Enterprise Manager, see <a class="olink TDPPT159" href="../../server.112/e10822/tdppt_sqltune.htm#TDPPT159"><span class="italic">Oracle Database 2 Day + Performance Tuning Guide</span></a></p>
</li>
<li>
<p>APIs, see <a class="olink PFGRF02604" href="../../server.112/e41573/sql_tune.htm#PFGRF02604"><span class="italic">Oracle Database Performance Tuning Guide</span></a></p>
</li>
</ul>
</li>
<li>
<p>On the SQL Performance Analyzer system, create a <a id="sthref127"></a>SQL Performance Analyzer task using the SQL tuning set as its input source.</p>
<p>Remotely test execute the SQL statements in the SQL tuning set on the test system over a database link to build a pre-upgrade <a id="sthref128"></a>SQL trial that will be used as a baseline for comparison, as described in <a href="#CHDBHIHH">"Testing Database Upgrades from Oracle Database 10<span class="italic">g</span> Release 2 and Newer Releases"</a>.</p>
</li>
<li>
<p>Upgrade the test system.</p>
</li>
<li>
<p>Remotely test execute the SQL statements a second time on the upgraded test system over a database link to build a post-upgrade <a id="sthref129"></a>SQL trial, as described in <a href="#CHDBHIHH">"Testing Database Upgrades from Oracle Database 10<span class="italic">g</span> Release 2 and Newer Releases"</a>.</p>
</li>
<li>
<p>Compare <a id="sthref130"></a>SQL performance and fix <a id="sthref131"></a>regressed SQL.</p>
<p>SQL Performance Analyzer compares the performance of SQL statements read from the SQL tuning set during the pre-upgrade SQL trial to those captured from the remote test execution during the post-upgrade SQL trial. A report is produced to identify any changes in execution plans or performance of the SQL statements.</p>
<p>If the report reveals any regressed SQL statements, you can make further changes to fix the regressed SQL, as described in <a href="#CIADFIIF">"Tuning Regressed SQL Statements After Testing a Database Upgrade"</a>.</p>
<p>Repeat the process of executing the SQL tuning set and comparing its performance to a previous execution to test any changes made until you are satisfied with the outcome of the analysis.</p>
</li>
</ol>
<a id="CHDBHIHH"></a>
<div id="RATUG299" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">7.2.1</span> Testing Database Upgrades from Oracle Database 10<span class="italic">g</span> Release 2 and Newer Releases</h3>
<p><a id="sthref132"></a>Once the SQL tuning set is transported to the SQL Performance Analyzer system, you can use SQL Performance Analyzer to build a pre-upgrade SQL trial by executing or generating plans of SQL statements in the SQL tuning set on the test system. SQL Performance Analyzer test executes the SQL statements using a database link that you specify by connecting to the test system remotely and generating the execution plans and statistics for the SQL trial. The database link should exist on the SQL Performance Analyzer system and connect to a remote user with privileges to execute the SQL tuning set on the test system.</p>
<p><a id="sthref133"></a>After the pre-upgrade SQL trial is built, you need to upgrade the test system. Once the database has been upgraded, SQL Performance Analyzer will need to execute or generate plans of SQL statements in the SQL tuning set a second time on the upgraded test system to build a post-upgrade SQL trial. Alternatively, if hardware resources are available, you can use another upgraded test system to execute the second remote SQL trial. This method can be useful in helping you investigate issues identified by SQL Performance Analyzer.</p>
<p>You can run SQL Performance Analyzer to test a database upgrade from Oracle Database 10<span class="italic">g</span> Release 2 or a newer release using Oracle Enterprise Manager or APIs, as described in the following sections:</p>
<ul>
<li>
<p><a href="#CHDJFGGD">Testing Database Upgrades from Oracle Database 10<span class="italic">g</span> Release 2 and Newer Releases Using Enterprise Manager</a></p>
</li>
<li>
<p><a href="#CHDBGFAC">Testing Database Upgrades from Oracle Database 10<span class="italic">g</span> Release 2 and Newer Releases Using APIs</a></p>
</li>
</ul>
<a id="CHDJFGGD"></a>
<div id="RATUG300" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">7.2.1.1</span> Testing Database Upgrades from Oracle Database 10<span class="italic">g</span> Release 2 and Newer Releases Using Enterprise Manager</h4>
<p>To test a database upgrade from Oracle Database 10<span class="italic">g</span> Release 2 or a newer release using SQL Performance Analyzer:</p>
<ol>
<li>
<p>On the Software and Support page, under Real Application Testing, click <span class="bold">SQL Performance Analyzer</span>.</p>
<p>The SQL Performance Analyzer page appears.</p>
</li>
<li>
<p>Under SQL Performance Analyzer Workflows, click <span class="bold">Upgrade from 10.2 or 11g</span>.</p>
<p>The Upgrade from 10.2 or 11g page appears.</p>
<img width="540" height="762" src="img/spa_upgrade_102_11g.gif" alt="Description of spa_upgrade_102_11g.gif follows" /><br />
<a id="sthref134" href="img_text/spa_upgrade_102_11g.htm">Description of the illustration spa_upgrade_102_11g.gif</a><br />
<br /></li>
<li>
<p>Under Task Information:</p>
<ol>
<li>
<p>In the Task Name field, enter the name of the task.</p>
</li>
<li>
<p>In the SQL Tuning Set field, enter the name of the SQL tuning set that was built.</p>
<p>Alternatively, click the search icon to search for the SQL tuning set using the Search and Select: SQL Tuning Set window.</p>
<p>The selected SQL tuning set now appears in the SQL Tuning Set field.</p>
</li>
<li>
<p>In the Description field, optionally enter a description of the task.</p>
</li>
</ol>
</li>
<li>
<p>In the Creation Method field, select:</p>
<ul>
<li>
<p><span class="bold">Execute SQLs</span> to generate both execution plans and statistics for each SQL statement in the SQL tuning set by actually running the SQL statements remotely on the test system over a public database link.</p>
</li>
<li>
<p><span class="bold">Generate Plans</span> to create execution plans remotely on the test system over a public database link without actually running the SQL statements.</p>
</li>
</ul>
</li>
<li>
<p>In the Per-SQL Time Limit list, determine the time limit for SQL execution during the trial by performing one of the following actions:</p>
<ul>
<li>
<p>Select <span class="bold">5 minutes</span>.</p>
<p>The execution will run each SQL statement in the SQL tuning set up to 5 minutes and gather performance data.</p>
</li>
<li>
<p>Select <span class="bold">Unlimited</span>.</p>
<p>The execution will run each SQL statement in the SQL tuning set to completion and gather performance data. Collecting execution statistics provides greater accuracy in the performance analysis but takes a longer time. Using this setting is not recommended because the task may be stalled by one SQL statement for a prolonged time period.</p>
</li>
<li>
<p>Select <span class="bold">Customize</span> and enter the specified number of seconds, minutes, or hours.</p>
</li>
</ul>
</li>
<li>
<p>In the Database Link field, enter the global name of a public database link connecting to a user with the <code>EXECUTE</code> privilege for the <code>DBMS_SQLPA</code> package and the <code>ADVISOR</code> privilege on the pre-upgrade system.</p>
<p>Alternatively, click the search icon to search for and select a database link, or click <span class="bold">Create Database Link</span> to create a database link using the Create Database Link page.</p>
</li>
<li>
<p>Under Post-upgrade Trial:</p>
<ol>
<li>
<p>Select <span class="bold">Use the same system as in the pre-upgrade trial</span> to use the same system for executing both the pre-upgrade and post-upgrade trials.</p>
<p>Oracle recommends using this option to avoid possible errors due to different system configurations. When using this option, you will need to upgrade the test database to the higher database version before the post-upgrade trial is executed.</p>
</li>
<li>
<p>In the Database Link field, enter the global name of a public database link connecting to a user with the <code>EXECUTE</code> privilege for the <code>DBMS_SQLPA</code> package and the <code>ADVISOR</code> privilege on the post-upgrade system.</p>
</li>
</ol>
</li>
<li>
<p>In the Comparison Metric list, select the comparison metric to use for the comparison analysis:</p>
<ul>
<li>
<p><span class="bold">Elapsed Time</span></p>
</li>
<li>
<p><span class="bold">CPU Time</span></p>
</li>
<li>
<p><span class="bold">User I/O Time</span></p>
</li>
<li>
<p><span class="bold">Buffer Gets</span></p>
</li>
<li>
<p><span class="bold">Physical I/O</span></p>
</li>
<li>
<p><span class="bold">Optimizer Cost</span></p>
</li>
<li>
<p><span class="bold">I/O Interconnect Bytes</span></p>
</li>
</ul>
<p>Optimizer Cost is the only comparison metric available if you generated execution plans only in the SQL trials.</p>
<p>To perform the comparison analysis by using more than one comparison metric, perform separate comparison analyses by repeating this procedure with different metrics.</p>
</li>
<li>
<p>Under Schedule:</p>
<ol>
<li>
<p>In the Time Zone list, select your time zone code.</p>
</li>
<li>
<p>Select <span class="bold">Immediately</span> to start the task now, or <span class="bold">Later</span> to schedule the task to start at a time specified using the Date and Time fields.</p>
</li>
</ol>
</li>
<li>
<p>Click <span class="bold">Submit</span>.</p>
<p>The SQL Performance Analyzer page appears.</p>
<p>In the SQL Performance Analyzer Tasks section, the status of this task is displayed. To refresh the status icon, click <span class="bold">Refresh</span>.</p>
<p>If you are using the same system to execute both the pre-upgrade and post-upgrade trials, you will need to upgrade the database after the pre-upgrade trial step is completed. After the database is upgraded, the post-upgrade trial can be executed. After the task completes, the Status field changes to Completed.</p>
</li>
<li>
<p>Under SQL Performance Analyzer Tasks, select the task and click the link in the Name column.</p>
<p>The SQL Performance Analyzer Task page appears.</p>
<p>This page contains the following sections:</p>
<ul>
<li>
<p>SQL Tuning Set</p>
<p>This section summarizes information about the SQL tuning set, including its name, owner, description, and the number of SQL statements it contains.</p>
</li>
<li>
<p>SQL Trials</p>
<p>This section includes a table that lists the SQL trials used in the SQL Performance Analyzer task.</p>
</li>
<li>
<p>SQL Trial Comparisons</p>
<p>This section contains a table that lists the results of the SQL trial comparisons</p>
</li>
</ul>
</li>
<li>
<p>Click the icon in the Comparison Report column.</p>
<p>The SQL Performance Analyzer Task Result page appears.</p>
</li>
<li>
<p>Review the results of the performance analysis, as described in <a href="spa_analyze.htm#CACHAFHE">"Reviewing the SQL Performance Analyzer Report Using Oracle Enterprise Manager"</a>.</p>
<p>If regressed SQL statements are found following the database upgrade, tune them as described in <a href="#CIADFIIF">"Tuning Regressed SQL Statements After Testing a Database Upgrade"</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDBGFAC"></a>
<div id="RATUG301" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">7.2.1.2</span> Testing Database Upgrades from Oracle Database 10<span class="italic">g</span> Release 2 and Newer Releases Using APIs</h4>
<p>After creating a SQL Performance Analyzer task on the SQL Performance Analyzer system, you can use APIs to build the pre-upgrade <a id="sthref135"></a>SQL trial by performing an explain plan or test execute of SQL statements in the SQL tuning set. To do so, call the <a id="sthref136"></a><code>EXECUTE_ANALYSIS_TASK</code> procedure using the following parameters:</p>
<ul>
<li>
<p>Set the <code>task_name</code> parameter to the name of the SQL Performance Analyzer task that you want to execute.</p>
</li>
<li>
<p>Set the <code>execution_type</code> parameter to <code>EXPLAIN PLAN</code> or <code>TEST EXECUTE</code>.</p>
<p>If you choose to use <code>EXPLAIN PLAN</code>, only execution plans will be generated. Subsequent comparisons will only be able to yield a list of changed plans without making any conclusions about performance changes. If you choose to use <code>TEST EXECUTE</code>, the SQL workload will be executed to completion. This effectively builds the pre-upgrade SQL trial using the statistics and execution plans generated from the test system. Using <code>TEST EXECUTE</code> is recommended to capture the SQL execution plans and performance data at the source, thereby resulting in a more accurate analysis.</p>
</li>
<li>
<p>Specify a name to identify the execution using the <code>execution_name</code> parameter. If not specified, then SQL Performance Analyzer automatically generates a name for the task execution.</p>
</li>
<li>
<p>Set the <code>DATABASE_LINK</code> task parameter to the global name of a public database link connecting to a user with the <code>EXECUTE</code> privilege for the <code>DBMS_SQLPA</code> package and the <code>ADVISOR</code> privilege on the test system.</p>
</li>
</ul>
<p>The following example executes the SQL Performance Analyzer task named <code>my_spa_task</code> and performs a test execute of the SQL statements remotely over a database link:</p>
<pre>
EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK(task_name =&gt; 'my_spa_task', -
       execution_type =&gt; 'TEST EXECUTE', - 
       execution_name =&gt; 'my_remote_trial_10g', -
       execution_params =&gt; dbms_advisor.arglist('database_link',
                                                'LINK.A.B.C.BIZ.COM'));
</pre>
<p>To build the post-upgrade SQL trial using APIs, perform an explain plan or test execute using the SQL Performance Analyzer system by calling the <code>EXECUTE_ANALYSIS_TASK</code> procedure with the <code>DATABASE_LINK</code> task parameter set to the global name of a public database link connecting to a user with the <code>EXECUTE</code> privilege for the <code>DBMS_SQLPA</code> package and the <code>ADVISOR</code> privilege on the test system. If you choose to use <code>EXPLAIN PLAN</code>, only execution plans will be generated. Subsequent comparisons will only be able to yield a list of changed plans without making any conclusions about performance changes. If you choose to use <code>TEST EXECUTE</code>, the SQL workload will be executed to completion. This effectively builds the post-upgrade SQL trial using the statistics and execution plans generated from the test system. Using <code>TEST EXECUTE</code> is recommended to capture the SQL execution plans and performance data at the source, thereby resulting in a more accurate analysis.</p>
<p>The following example performs a test execute of the SQL statements remotely over a database link:</p>
<pre>
EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK(task_name =&gt; 'my_spa_task', -
       execution_type =&gt; 'TEST EXECUTE', - 
       execution_name =&gt; 'my_remote_trial_11g', -
       execution_params =&gt; dbms_advisor.arglist('database_link',
                                                'LINK.A.B.C.BIZ.COM'));
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CIADFIIF"></a>
<div id="RATUG228" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">7.3</span> Tuning Regressed SQL Statements After Testing a Database Upgrade</h2>
<p>In some cases, SQL Performance Analyzer may identify SQL statements whose performance regressed after you upgrade the database on the test system.</p>
<p>You can tune the regressed <a id="sthref137"></a>SQL statements by using the SQL Tuning Advisor or SQL plan baselines, as described in <a href="spa_analyze.htm#CACCDGAG">Chapter 6, "Comparing SQL Trials"</a>. This involves using APIs to build a subset of a SQL tuning set with only the regressed SQL statements, transport this subset of regressed SQL statements to the remote database, and running the SQL Tuning Advisor on the remote database.</p>
<p>Oracle Enterprise Manager does not provide support for fixing regressions after running SQL Performance Analyzer involving one or more remote SQL trials. For more information, see <a href="spa_analyze.htm#CHDHGFEH">"Tuning Regressed SQL Statements From a Remote SQL Trial Using APIs"</a>.</p>
<p>If you are upgrading from Oracle Database 10<span class="italic">g</span> Release 2 and newer releases, you can also create SQL plan baselines to instruct the optimizer to select existing execution plans in the future. For more information, see <a href="spa_analyze.htm#CHDBFJIE">"Creating SQL Plan Baselines Using APIs"</a>.</p>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1798">
<tr>
<td class="cellalignment1805">
<table class="cellalignment1803">
<tr>
<td class="cellalignment1802"><a href="spa_analyze.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1802"><a href="part2.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2008, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1807">
<table class="cellalignment1801">
<tr>
<td class="cellalignment1802"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1802"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1802"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1802"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1802"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1802"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
