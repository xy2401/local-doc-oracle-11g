<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Automatic Performance Statistics</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1023" />
<meta name="dcterms.created" content="2014-06-30T4:25:5Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Database Performance Tuning Guide" />
<meta name="dcterms.identifier" content="E41573-04" />
<meta name="dcterms.isVersionOf" content="PFGRF" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2000, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="build_db.htm" title="Previous" type="text/html" />
<link rel="Next" href="diag.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e41573.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">12/31</span> <!-- End Header -->
<div id="PFGRF027" class="chapter"><a id="g42587"></a> <a id="i35168"></a>
<h1 class="chapter"><span class="secnum">5</span> Automatic Performance Statistics</h1>
<p>This chapter discusses the gathering of performance statistics. This chapter contains the following topics:</p>
<ul>
<li>
<p><a href="#i29253">Overview of Data Gathering</a></p>
</li>
<li>
<p><a href="#i27008">Overview of the Automatic Workload Repository</a></p>
</li>
<li>
<p><a href="#CHDGCJJJ">Managing the Automatic Workload Repository</a></p>
</li>
</ul>
<a id="i29253"></a>
<div id="PFGRF94162" class="sect1">
<h2 class="sect1"><span class="secnum">5.1</span> Overview of Data Gathering</h2>
<p><a id="sthref238"></a><a id="sthref239"></a>To effectively diagnose performance problems, statistics must be available. Oracle Database generates many types of cumulative statistics for the system, sessions, and individual SQL statements. Oracle Database also tracks cumulative statistics on segments and services. When analyzing a performance problem in any of these scopes, you typically look at the change in statistics (delta value) over the period you are interested in. Specifically, you look at the difference between the cumulative value of a statistic at the start of the period and the cumulative value at the end.</p>
<p>Cumulative values for statistics are generally available through dynamic performance views, such as the <code>V$SESSTAT</code> and <code>V$SYSSTAT</code> views. Note that the cumulative values in dynamic views are reset when the database instance is shutdown. The <a id="sthref240"></a>Automatic Workload Repository (AWR) automatically persists the cumulative and delta values for most of the statistics at all levels except the session level. This process is repeated on a regular time period and the result is called an AWR snapshot. The delta values captured by the snapshot represent the changes for each statistic over the time period. See <a href="#i27008">"Overview of the Automatic Workload Repository"</a>.</p>
<p>A <span class="bold">metric</span> is another type of statistic collected by Oracle Database. A <a id="sthref241"></a>metric is defined as the rate of change in some cumulative statistic. That rate can be measured against a variety of units, including time, transactions, or database calls. For example, the number database calls per second is a metric. Metric values are exposed in some <code>V$</code> views, where the values are the average over a fairly small time interval, typically 60 seconds. A history of recent metric values is available through <code>V$</code> views, and some data is also persisted by AWR snapshots.</p>
<p>A third type of statistical data collected by Oracle is sampled data. The active session history (ASH) sampler performs the sampling. ASH samples the current state of all active sessions. The database collects this data into memory, where you can access it with a <code>V$</code> view. AWR snapshot processing also writes it to persistent storage. See <a href="#i35568">"Active Session History"</a>.</p>
<p>A powerful tool for diagnosing performance problems is the use of statistical <a id="sthref242"></a><a id="sthref243"></a>baselines. A statistical baseline is collection of statistic rates usually taken over time period where the system is performing well at peak load. Comparing statistics captured during a period of bad performance to a baseline helps discover specific statistics that have increased significantly and could be the cause of the problem.</p>
<p>AWR supports the capture of baseline data by enabling you to specify and preserve a pair or range of AWR snapshots as a baseline. Carefully consider the time period you choose as a baseline; the baseline should be a good representation of the peak load on the system. In the future, you can compare these baselines with snapshots captured during periods of poor performance.</p>
<p>Oracle Enterprise Manager is the recommended tool for viewing both real time data in the dynamic performance views and historical data from the AWR history tables. Enterprise Manager can also be used to capture operating system and network statistical data that can be correlated with AWR data. For more information, see <a class="olink TDPPT033" href="../../server.112/e10822/tdppt_realtime.htm#TDPPT033"><span class="italic">Oracle Database 2 Day + Performance Tuning Guide</span></a>.</p>
<p>This section covers the following topics:</p>
<ul>
<li>
<p><a href="#CHDCBCEF">Database Statistics</a></p>
</li>
<li>
<p><a href="#i35653">Operating System Statistics</a></p>
</li>
<li>
<p><a href="#i35626">Interpreting Statistics</a></p>
</li>
</ul>
<a id="CHDCBCEF"></a>
<div id="PFGRF94163" class="sect2">
<h3 class="sect2"><span class="secnum">5.1.1</span> Database Statistics</h3>
<p><a id="sthref244"></a><a id="sthref245"></a>Database statistics provide information on the type of load on the database and the internal and external resources used by the database. This section describes some of the more important statistics.</p>
<a id="CHDBCADD"></a>
<div id="PFGRF94164" class="sect3">
<h4 class="sect3"><span class="secnum">5.1.1.1</span> Wait Events</h4>
<p><a id="sthref246"></a>Wait events are statistics that are incremented by a server process or thread to indicate that it had to wait for an event to complete before being able to continue processing. Wait event data reveals various symptoms of problems that might be impacting performance, such as latch contention, buffer contention, and <a id="sthref247"></a>I/O contention.</p>
<p>To enable easier high-level analysis of the wait events, events are grouped into classes. The <a id="sthref248"></a><a id="sthref249"></a>classes include: Administrative, Application, Cluster, Commit, Concurrency, Configuration, Idle, Network, Other, Scheduler, System I/O, and User I/O.</p>
<p>The wait classes are based on a common solution that usually applies to fixing a problem with the wait event. For example, exclusive TX locks are generally an application level issue and HW locks are generally a configuration issue.</p>
<p>The following list includes common examples of the waits in some of the classes:</p>
<ul>
<li>
<p>Application: locks waits caused by row level locking or explicit lock commands</p>
</li>
<li>
<p>Commit: waits for redo log write confirmation after a commit</p>
</li>
<li>
<p>Idle: wait events that signify the session is inactive, such as <code>SQL*Net</code> <code>message</code> <code>from</code> <code>client</code></p>
</li>
<li>
<p>Network: waits for data to be sent over the network</p>
</li>
<li>
<p>User I/O: wait for blocks to be read off a disk</p>
</li>
</ul>
<p>Wait event statistics for an instance include statistics for both background and foreground processes. Because you would typically focus your effort in tuning foreground activities, overall instance activity is broken down into foreground and background statistics in the relevant <code>V$</code> views to facilitate tuning.</p>
<p>The <code>V$SYSTEM_EVENT</code> view shows wait event statistics for the foreground activities of an instance and the wait event statistics for the instance. The <code>V$SYSTEM_WAIT_CLASS</code> view shows these foreground and wait event instance statistics after aggregating to wait classes. <code>V$SESSION_EVENT</code> and <code>V$SESSION_WAIT_CLASS</code> show wait event and wait class statistics at the session level.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN101" href="../../server.112/e40402/waitevents.htm#REFRN101"><span class="italic">Oracle Database Reference</span></a> for more information about Oracle wait events</div>
</div>
<!-- class="sect3" -->
<a id="i37457"></a>
<div id="PFGRF94165" class="sect3">
<h4 class="sect3"><span class="secnum">5.1.1.2</span> Time Model Statistics</h4>
<p><a id="sthref250"></a><a id="sthref251"></a>When tuning an Oracle database, each component has its own set of statistics. To look at the system as a whole, it is necessary to have a common scale for comparisons. For this reason, most Oracle Database advisories and reports describe statistics in terms of time. In addition, the <code><a id="sthref252"></a>V$SESS_TIME_MODEL</code> and <code><a id="sthref253"></a>V$SYS_TIME_MODEL</code> views provide time model statistics. Using the common time instrumentation helps to identify quantitative effects on the database operations.</p>
<p>The most important of the time model statistics is <code><a id="sthref254"></a>DB</code> <code>time</code>. This statistics represents the total time spent in database calls and is an indicator of the total instance workload. It is calculated by aggregating the CPU and wait times of all sessions not waiting on idle wait events (non-idle user sessions).</p>
<p><code>DB</code> <code>time</code> is measured cumulatively from the time of instance startup. Because <code>DB</code> <code>time</code> it is calculated by combining the times from all non-idle user sessions, it is possible that the <code>DB</code> <code>time</code> can exceed the actual time elapsed after the instance started. For example, an instance that has been running for 30 minutes could have four active user sessions whose cumulative <code>DB</code> <code>time</code> is approximately 120 minutes.</p>
<p>The objective for tuning an Oracle system could be stated as reducing the time that users spend in performing some action on the database, or simply reducing <code>DB</code> <code>time</code>. Other time model statistics provide quantitative effects (in time) on specific actions, such as logon operations and hard and soft parses.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN30340" href="../../server.112/e40402/dynviews_3015.htm#REFRN30340"><span class="italic">Oracle Database Reference</span></a> to learn about the <code>V$SESS_TIME_MODEL</code> and <code>V$SYS_TIME_MODEL</code> views</div>
</div>
<!-- class="sect3" -->
<a id="i35568"></a>
<div id="PFGRF94166" class="sect3">
<h4 class="sect3"><span class="secnum">5.1.1.3</span> Active Session History</h4>
<p><a id="sthref255"></a><a id="sthref256"></a>The <code>V$ACTIVE_SESSION_HISTORY</code> view provides sampled session activity in the instance. Active sessions are sampled every second and are stored in a circular buffer in SGA. Any session that is connected to the database and is waiting for an event that does not belong to the Idle wait class is considered as an active session. This includes any session that was on the CPU at the time of sampling.</p>
<p>Each session sample is a set of rows and the <code>V$ACTIVE_SESSION_HISTORY</code> view returns one row for each active session per sample, returning the latest session sample rows first. Because the active session samples are stored in a circular buffer in SGA, the greater the system activity, the smaller the number of seconds of session activity that can be stored in the circular buffer. This means that the duration for which a session sample appears in the <code>V$</code> view, or the number of seconds of session activity that is displayed in the <code>V$</code> view, is completely dependent on the database activity.</p>
<p>As part of the AWR snapshots, the content of <code>V$ACTIVE_SESSION_HISTORY</code> is also flushed to disk. Because the content of this <code>V$</code> view can get quite large during heavy system activity, only a portion of the session samples is written to disk.</p>
<p>By capturing only active sessions, a manageable set of data is represented with the size being directly related to the work being performed rather than the number of sessions allowed on the system. Using ASH enables you to examine and perform detailed analysis on both current data in the <code>V$ACTIVE_SESSION_HISTORY</code> view and historical data in the <code>DBA_HIST_ACTIVE_SESS_HISTORY</code> view, often avoiding the need to replay the workload to gather additional performance tracing information. ASH also contains execution plan information for each captured SQL statement. You can use this information to identify which part of SQL execution contributed most to the SQL elapsed time. The data present in ASH can be rolled up on various dimensions that it captures, including the following:</p>
<ul>
<li>
<p>SQL identifier of SQL statement</p>
</li>
<li>
<p>SQL plan identifier and hash value of the SQL plan used to execute the SQL statement</p>
</li>
<li>
<p>SQL execution plan information</p>
</li>
<li>
<p>Object number, file number, and block number</p>
</li>
<li>
<p>Wait event identifier and parameters</p>
</li>
<li>
<p>Session identifier and session serial number</p>
</li>
<li>
<p>Module and action name</p>
</li>
<li>
<p>Client identifier of the session</p>
</li>
<li>
<p>Service hash identifier</p>
</li>
<li>
<p>Consumer group identifier</p>
</li>
</ul>
<p>You can gather ASH information over a specified duration into a report. For more information, see <a href="#CHDIDEDG">"Generating Active Session History Reports"</a>.</p>
<p>Active session history sampling is also available for Active Data Guard physical standby instances and Oracle Automatic Storage Management (Oracle ASM) instances. On these instances, the current session activity is collected and displayed in the <code>V$ACTIVE_SESSION_HISTORY</code> view, but not written to disk.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink REFRN30299" href="../../server.112/e40402/dynviews_1007.htm#REFRN30299"><span class="italic">Oracle Database Reference</span></a> for more information about the <code>V$ACTIVE_SESSION_HISTORY</code> view</p>
</li>
<li>
<p><a class="olink HAOVW197" href="../../server.112/e17157/manageability.htm#HAOVW197"><span class="italic">Oracle Database High Availability Overview</span></a> for more information about using ASH in an Active Data Guard physical standby environment</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CHDCFGEG"></a>
<div id="PFGRF94167" class="sect3">
<h4 class="sect3"><span class="secnum">5.1.1.4</span> System and Session Statistics</h4>
<p>A large number of cumulative database statistics are available on a system and session level through the <code>V$SYSSTAT</code> and <code>V$SESSTAT</code> views.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN003" href="../../server.112/e40402/dynviews_part.htm#REFRN003"><span class="italic">Oracle Database Reference</span></a> to learn about the <code>V$SYSSTAT</code> and <code>V$SESSTAT</code> views</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i35653"></a>
<div id="PFGRF94168" class="sect2">
<h3 class="sect2"><span class="secnum">5.1.2</span> Operating System Statistics</h3>
<p><a id="sthref257"></a><a id="sthref258"></a>Operating system statistics provide information on the usage and performance of the main hardware components of the system, and the performance of the operating system itself. This information is crucial for detecting potential resource exhaustion, such as CPU cycles and physical memory, and for detecting bad performance of peripherals, such as disk drives.</p>
<p>Operating system statistics are an indication of how the hardware and operating system are working. Many system analysts react to a hardware resource shortage by installing more hardware. This is a reactionary response to a series of symptoms shown in the operating system statistics. It is best to consider operating system statistics as a diagnostic tool, similar to the way doctors use body temperature, pulse rate, and patient pain when making a diagnosis. To help identify bottlenecks, gather operating system statistics for all servers in the system under performance analysis.</p>
<p>Operating system statistics include the following:</p>
<ul>
<li>
<p><a href="#i35675">CPU Statistics</a></p>
</li>
<li>
<p><a href="#i35686">Virtual Memory Statistics</a></p>
</li>
<li>
<p><a href="#i35691">Disk I/O Statistics</a></p>
</li>
<li>
<p><a href="#i35695">Network Statistics</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#i36098">"Operating System Data Gathering Tools"</a> for information about tools for gathering operating statistics</div>
<a id="i35675"></a>
<div id="PFGRF94169" class="sect3">
<h4 class="sect3"><span class="secnum">5.1.2.1</span> CPU Statistics</h4>
<p><a id="sthref259"></a><a id="sthref260"></a>CPU utilization is the most important operating system statistic in the tuning process. Get CPU utilization for the entire system and for each individual CPU on multi-processor environments. Utilization for each CPU can detect single-threading and scalability issues.</p>
<p>Most operating systems report CPU usage as time spent in user space or mode and time spent in kernel space or mode. These additional statistics allow better analysis of what is actually being executed on the CPU.</p>
<p>On a system running Oracle Database, where only one application is typically running, the system runs database activity in user space. Activities required to service database requests (such as scheduling, synchronization, I/O, memory management, and process/thread creation and tear down) run in kernel mode. In a system where CPU is fully utilized, a healthy Oracle database runs between 65% and 95% in user space.</p>
<p>The <code><a id="sthref261"></a>V$OSSTAT</code> view captures machine-level information in the database, making it easier for you to determine if hardware-level resource issues exist. The <a id="sthref262"></a><code>V$SYSMETRIC_HISTORY</code> view shows a one-hour history of the Host CPU Utilization metric, a representation of percentage of CPU usage at each one-minute interval. The <a id="sthref263"></a><code>V$SYS_TIME_MODEL</code> view supplies statistics on the CPU usage by the Oracle database. Using both sets of statistics enable you to determine whether the Oracle database or other system activity is the cause of the CPU problems.</p>
</div>
<!-- class="sect3" -->
<a id="i35686"></a>
<div id="PFGRF94170" class="sect3">
<h4 class="sect3"><span class="secnum">5.1.2.2</span> Virtual Memory Statistics</h4>
<p>V<a id="sthref264"></a><a id="sthref265"></a>irtual memory statistics should mainly be used as a check to validate that there is very little paging or swapping activity on the system. System performance degrades rapidly and unpredictably when paging or swapping occurs.</p>
<p>Individual process memory statistics can detect memory leaks due to a programming failure to deallocate memory taken from the process heap. These statistics are necessary to validate that memory usage does not increase after the system has reached a steady state after startup. This problem is particularly acute on shared server applications on middle tier computers where session state may persist across user interactions, and on completion state information that is not fully deallocated.</p>
</div>
<!-- class="sect3" -->
<a id="i35691"></a>
<div id="PFGRF94171" class="sect3">
<h4 class="sect3"><span class="secnum">5.1.2.3</span> Disk I/O Statistics</h4>
<p><a id="sthref266"></a><a id="sthref267"></a>Because the database resides on a set of disks, the performance of the I/O subsystem is very important to the performance of the database. Most operating systems provide extensive statistics on disk performance. The most important disk statistics are the current response time and the length of the disk queues. These statistics show if the disk is performing optimally or if the disk is being overworked.</p>
<p>Measure the normal performance of the I/O system; typical values for a single block read range from 5 to 20 milliseconds, depending on the hardware used. If the hardware shows response times much higher than the normal performance value, then it is performing badly or is overworked. This is your bottleneck. If disk queues start to exceed two, then the disk is a potential bottleneck of the system.</p>
<p>Oracle Database also maintains a consistent set of I/O statistics for the I/O calls it issues. These statistics are captured for both single and multi block read and write operations in the following dimensions:</p>
<ul>
<li>
<p>Consumer group</p>
<p>When Oracle Database Resource Manager is enabled, the <code>V$IOSTAT_CONSUMER_GROUP</code> view captures I/O statistics for all consumer groups that are part of the currently enabled resource plan. The database samples cumulative statistics every hour and stores them as historical statistics in the AWR.</p>
</li>
<li>
<p>Database file</p>
<p>I/O statistics of database files that are or have been accessed are captured in the <code>V$IOSTAT_FILE</code> view.</p>
</li>
<li>
<p>Database function</p>
<p>I/O statistics for database functions (such as the LGWR and DBWR) are captured in the <code>V$IOSTAT_FUNCTION</code> view.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="instance_tune.htm#CACGBHBD">"Identifying I/O Problems Using V$ Views"</a> to learn how to use views in Oracle Database to identify I/O problems</div>
</div>
<!-- class="sect3" -->
<a id="i35695"></a>
<div id="PFGRF94172" class="sect3">
<h4 class="sect3"><span class="secnum">5.1.2.4</span> Network Statistics</h4>
<p><a id="sthref268"></a><a id="sthref269"></a>You can use network statistics in much the same way as disk statistics to determine if a network or network interface is overloaded or not performing optimally. In today's networked applications, network latency can be a large portion of the actual user response time. For this reason, these statistics are a crucial debugging tool.</p>
<p>Oracle Database maintains a set of network I/O statistics in the <code>V$IOSTAT_NETWORK</code> view.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="instance_tune.htm#CACIHHJC">"Identifying Network Issues"</a> to learn how to use the <code>V$IOSTAT_NETWORK</code> view to identify network issues</div>
</div>
<!-- class="sect3" -->
<a id="i36098"></a>
<div id="PFGRF94173" class="sect3">
<h4 class="sect3"><span class="secnum">5.1.2.5</span> Operating System Data Gathering Tools</h4>
<p><a href="#g38599">Table 5-1</a> shows the various tools for gathering operating statistics on UNIX. For Windows, use the Performance Monitor tool.</p>
<div id="PFGRF94174" class="tblformal">
<p class="titleintable"><a id="sthref270"></a><a id="g38599"></a>Table 5-1 UNIX Tools for Operating Statistics</p>
<table class="cellalignment1686" title="UNIX Tools for Operating Statistics" summary="This table lists the UNIX tools for gathering operating statistics." dir="ltr">
<thead>
<tr class="cellalignment1680">
<th class="cellalignment1687" id="r1c1-t9">Component</th>
<th class="cellalignment1687" id="r1c2-t9"><span class="bold">UNIX Tool</span></th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1680">
<td class="cellalignment1688" id="r2c1-t9" headers="r1c1-t9">
<p>CPU</p>
</td>
<td class="cellalignment1688" headers="r2c1-t9 r1c2-t9">
<p>sar, vmstat, mpstat, iostat</p>
</td>
</tr>
<tr class="cellalignment1680">
<td class="cellalignment1688" id="r3c1-t9" headers="r1c1-t9">
<p>Memory</p>
</td>
<td class="cellalignment1688" headers="r3c1-t9 r1c2-t9">
<p>sar, vmstat</p>
</td>
</tr>
<tr class="cellalignment1680">
<td class="cellalignment1688" id="r4c1-t9" headers="r1c1-t9">
<p>Disk</p>
</td>
<td class="cellalignment1688" headers="r4c1-t9 r1c2-t9">
<p>sar, iostat</p>
</td>
</tr>
<tr class="cellalignment1680">
<td class="cellalignment1688" id="r5c1-t9" headers="r1c1-t9">
<p>Network</p>
</td>
<td class="cellalignment1688" headers="r5c1-t9 r1c2-t9">
<p>netstat</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i35626"></a>
<div id="PFGRF94175" class="sect2">
<h3 class="sect2"><span class="secnum">5.1.3</span> Interpreting Statistics</h3>
<p>When initially examining performance data, you can formulate potential theories by examining your statistics. One way to ensure that your interpretation of the statistics is correct is to perform cross-checks with other data. This establishes whether a statistic or event is really of interest. Also, because foreground activities are tunable, it is better to first analyze the statistics from foreground activities before analyzing the statistics from background activities.</p>
<p>Some pitfalls are discussed in the following sections:</p>
<ul>
<li>
<p>Hit ratios</p>
<p>When tuning, it is common to compute a ratio that helps determine whether there is a problem. Such ratios include the buffer cache hit ratio, the soft-parse ratio, and the latch hit ratio. Do not use these ratios as definitive identifiers of whether a performance bottleneck exists. Rather, use them as indicators. To identify whether a bottleneck exists, examine other related evidence. See <a href="memory.htm#i56283">"Calculating the Buffer Cache Hit Ratio"</a>.</p>
</li>
<li>
<p>Wait events with timed statistics</p>
<p>Setting <code>TIMED_STATISTICS</code> to <code>true</code> at the instance level directs the database to gather wait time for events, in addition to available wait counts. This data is useful for comparing the total wait time for an event to the total elapsed time between the data collections. For example, if the wait event accounts for only 30 seconds out of a 2-hour period, then little is to be gained by investigating this event, although it may be the highest ranked wait event when ordered by time waited. However, if the event accounts for 30 minutes of a 45-minute period, then the event is worth investigating. See <a href="instance_tune.htm#i37997">"Wait Events"</a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Timed statistics are automatically collected for the database if the initialization parameter <code><a id="sthref271"></a>STATISTICS_LEVEL</code> is set to <code>TYPICAL</code> or <code>ALL</code>. If <code>STATISTICS_LEVEL</code> is set to <code>BASIC</code>, then you must set <code>TIMED_STATISTICS</code> to <code>TRUE</code> to enable collection of timed statistics. Note that setting <code>STATISTICS_LEVEL</code> to <code>BASIC</code> disables many automatic features and is not recommended.
<p>If you explicitly set <code>DB_CACHE_ADVICE</code>, <code>TIMED_STATISTICS</code>, or <code>TIMED_OS_STATISTICS</code>, either in the initialization parameter file or by using <code>ALTER_SYSTEM</code> or <code>ALTER</code> <code>SESSION</code>, then the explicitly set value overrides the value derived from <code>STATISTICS_LEVEL</code>.</p>
</div>
</li>
<li>
<p>Comparing Oracle Database statistics with other factors</p>
<p>When looking at statistics, it is important to consider other factors that influence whether the statistic is of value. Such factors include the user load and the hardware capability. Even an event that had a wait of 30 minutes in a 45-minute period might not be indicative of a problem if you discover that there were 2000 users on the system, and the host hardware was a 64-node computer.</p>
</li>
<li>
<p>Wait events without timed statistics</p>
<p>If <code>TIMED_STATISTICS</code> is false, then the amount of time waited for an event is not available. Therefore, it is only possible to order wait events by the number of times each event was waited for. Although the events with the largest number of waits might indicate the potential bottleneck, they might not be the main bottleneck. This can happen when an event is waited for a large number of times, but the total time waited for that event is small. The converse is also true: an event with fewer waits might be a problem if the wait time is a significant proportion of the total wait time. Without having the wait times to use for comparison, it is difficult to determine whether a wait event is really of interest.</p>
</li>
<li>
<p>Idle wait events</p>
<p>Oracle Database uses some wait events to indicate if the Oracle server process is idle. Typically, these events are of no value when investigating performance problems, and they should be ignored when examining the wait events. See <a href="instance_tune.htm#i37678">"Idle Wait Events"</a>.</p>
</li>
<li>
<p>Computed statistics</p>
<p>When interpreting computed statistics (such as rates, statistics normalized over transactions, or ratios), it is important to cross-verify the computed statistic with the actual statistic counts. This confirms whether the derived rates are really of interest: small statistic counts usually can discount an unusual ratio. For example, on initial examination, a soft-parse ratio of 50% generally indicates a potential tuning area. If, however, there was only one hard parse and one soft parse during the data collection interval, then the soft-parse ratio would be 50%, even though the statistic counts show this is not an area of concern. In this case, the ratio is not of interest due to the low raw statistic counts.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="instance_tune.htm#i34268">"Setting the Level of Statistics Collection"</a> to learn about the <code>STATISTICS_LEVEL</code> settings</p>
</li>
<li>
<p><a class="olink REFRN10214" href="../../server.112/e40402/initparams254.htm#REFRN10214"><span class="italic">Oracle Database Reference</span></a> for information about the <code>STATISTICS_LEVEL</code> initialization parameter</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i27008"></a>
<div id="PFGRF02601" class="sect1">
<h2 class="sect1"><span class="secnum">5.2</span> Overview of the Automatic Workload Repository</h2>
<p>The <a id="sthref272"></a>Automatic Workload Repository (AWR) collects, processes, and maintains performance statistics for problem detection and self-tuning purposes. This data is both in memory and stored in the database. The gathered data can be displayed in both reports and views.</p>
<p><a id="sthref273"></a>The statistics collected and processed by AWR include:</p>
<ul>
<li>
<p>Object statistics that determine both access and usage statistics of database segments</p>
</li>
<li>
<p>Time model statistics based on time usage for activities, displayed in the <code>V$SYS_TIME_MODEL</code> and <code>V$SESS_TIME_MODEL</code> views</p>
</li>
<li>
<p>Some of the system and session statistics collected in the <code>V$SYSSTAT</code> and <code>V$SESSTAT</code> views</p>
</li>
<li>
<p>SQL statements that are producing the highest load on the system, based on criteria such as elapsed time and CPU time</p>
</li>
<li>
<p>ASH statistics, representing the history of recent sessions activity</p>
</li>
</ul>
<p><a id="sthref274"></a>Gathering database statistics using the AWR is enabled by default and is controlled by the <code>STATISTICS_LEVEL</code> initialization parameter. The <code><a id="sthref275"></a>STATISTICS_LEVEL</code> parameter should be set to the <code>TYPICAL</code> or <code>ALL</code> to enable statistics gathering by the AWR. The default setting is <code>TYPICAL</code>. Setting <code>STATISTICS_LEVEL</code> to <code>BASIC</code> disables many Oracle Database features, including the AWR, and is not recommended. If <code>STATISTICS_LEVEL</code> is set to <code>BASIC</code>, you can still manually capture AWR statistics using the <code>DBMS_WORKLOAD_REPOSITORY</code> package. However, because in-memory collection of many system statistics&mdash;such as segments statistics and memory advisor information&mdash;will be disabled, the statistics captured in these snapshots may not be complete. For information about the <code>STATISTICS_LEVEL</code> initialization parameter, see <a class="olink REFRN10214" href="../../server.112/e40402/initparams254.htm#REFRN10214"><span class="italic">Oracle Database Reference</span></a>.</p>
<a id="CHDJEFJA"></a>
<div id="PFGRF94176" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.2.1</span> Snapshots</h3>
<p><a id="sthref276"></a>Snapshots are sets of historical data for specific time periods that are used for performance comparisons by ADDM. By default, Oracle Database automatically generates snapshots of the performance data once every hour and retains the statistics in the workload repository for 8 days. You can also manually create snapshots, but this is usually not necessary. The data in the snapshot interval is then analyzed by the Automatic Database Diagnostic Monitor (ADDM). For information about ADDM, see <a href="diag.htm#i37241">"Overview of the Automatic Database Diagnostic Monitor"</a>.</p>
<p>AWR compares the difference between snapshots to determine which SQL statements to capture based on the effect on the system load. This reduces the number of SQL statements that must be captured over time.</p>
<p>For information about managing snapshots, see <a href="#i26958">"Managing Snapshots"</a>.</p>
</div>
<!-- class="sect2" -->
<a id="CHDEJAJA"></a>
<div id="PFGRF94177" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.2.2</span> Baselines</h3>
<p>A <a id="sthref277"></a>baseline contains performance data from a specific time period that is preserved for comparison with other similar workload periods when performance problems occur. The snapshots contained in a baseline are excluded from the automatic AWR purging process and are retained indefinitely.</p>
<p>There are several types of available baselines in Oracle Database:</p>
<ul>
<li>
<p><a href="#CHDIFIIB">Fixed Baselines</a></p>
</li>
<li>
<p><a href="#CHDDBEDI">Moving Window Baseline</a></p>
</li>
<li>
<p><a href="#CHDGFGEG">Baseline Templates</a></p>
</li>
</ul>
<a id="CHDIFIIB"></a>
<div id="PFGRF94178" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.2.2.1</span> Fixed Baselines</h4>
<p>A fixed baseline corresponds to a fixed, contiguous time period in the past that you specify. Before creating a fixed baseline, carefully consider the time period you choose as a baseline, because the baseline should represent the system operating at an optimal level. In the future, you can compare the baseline with other baselines or snapshots captured during periods of poor performance to analyze performance degradation over time.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDHBGJD">"Managing Baselines"</a> for information about managing fixed baselines</div>
</div>
<!-- class="sect3" -->
<a id="CHDDBEDI"></a>
<div id="PFGRF94179" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.2.2.2</span> Moving Window Baseline</h4>
<p>A moving window baseline corresponds to all AWR data that exists within the AWR retention period. This is useful when using adaptive thresholds because the database can use AWR data in the entire AWR retention period to compute metric threshold values.</p>
<p>Oracle Database automatically maintains a system-defined moving window baseline. The default window size for the system-defined moving window baseline is the current AWR retention period, which by default is 8 days. If you are planning to use adaptive thresholds, consider using a larger moving window&mdash;such as 30 days&mdash;to accurately compute threshold values. You can resize the moving window baseline by changing the number of days in the moving window to a value that is equal to or less than the number of days in the AWR retention period. Therefore, to increase the size of a moving window, you must first increase the AWR retention period accordingly.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDICJHJ">"Modifying the Window Size of the Default Moving Window Baseline"</a> for information about resizing the moving window baseline</div>
</div>
<!-- class="sect3" -->
<a id="CHDGFGEG"></a>
<div id="PFGRF94180" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.2.2.3</span> Baseline Templates</h4>
<p>You can also create baselines for a contiguous time period in the future using baseline templates. There are two types of baseline templates: single and repeating.</p>
<p>You can use a single baseline template to create a baseline for a single contiguous time period in the future. This technique is useful if you know beforehand of a time period that you intend to capture in the future. For example, you may want to capture the AWR data during a system test that is scheduled for the upcoming weekend. In this case, you can create a single baseline template to automatically capture the time period when the test occurs.</p>
<p>You can use a repeating baseline template to create and drop baselines based on a repeating time schedule. This is useful if you want Oracle Database to automatically capture a contiguous time period on an ongoing basis. For example, you may want to capture the AWR data during every Monday morning for a month. In this case, you can create a repeating baseline template to automatically create baselines on a repeating schedule for every Monday, and automatically remove older baselines after a specified expiration interval, such as one month.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDHJADB">"Managing Baseline Templates"</a> for information about managing baseline templates</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDDEACC"></a>
<div id="PFGRF94181" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.2.3</span> Adaptive Thresholds<a id="sthref278"></a><a id="sthref279"></a></h3>
<p>Adaptive thresholds enable you to monitor and detect performance issues while minimizing administrative overhead. Adaptive thresholds can automatically set warning and critical alert thresholds for some system metrics using statistics derived from metric values captured in the moving window baseline. The statistics for these thresholds are recomputed weekly and might result in new thresholds as system performance evolves over time. In addition to recalculating thresholds weekly, adaptive thresholds might compute different thresholds values for different times of the day or week based on periodic workload patterns.</p>
<p>For example, many databases support an online transaction processing (OLTP) workload during the day and batch processing at night. The performance metric for response time per transaction can be useful for detecting degradation in OLTP performance during the day. However, a useful OLTP threshold value is almost certainly too low for batch workloads, where long-running transactions might be common. As a result, threshold values appropriate to OLTP might trigger frequent false performance alerts during batch processing. Adaptive thresholds can detect such a workload pattern and automatically set different threshold values for the daytime and nighttime.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
In Oracle Database 11<span class="italic">g</span> Release 2 (11.2), Oracle Database automatically determines the appropriate time groupings for a database. However, before Oracle Database 11<span class="italic">g</span> Release 2 (11.2), time groupings were specified manually by the database administrator.</div>
<p>There are two types of adaptive thresholds:</p>
<ul>
<li>
<p><span class="bold">Percentage of maximum:</span> The threshold value is computed as a percentage multiple of the maximum value observed for the data in the moving window baseline.</p>
</li>
<li>
<p><span class="bold">Significance level:</span> The threshold value is set to a statistical percentile that represents how unusual it is to observe values above the threshold value based the data in the moving window baseline. Specify one of the following percentiles:</p>
<ul>
<li>
<p><span class="bold">High (.95):</span> Only 5 in 100 observations are expected to exceed this value.</p>
</li>
<li>
<p><span class="bold">Very High (.99):</span> Only 1 in 100 observations are expected to exceed this value.</p>
</li>
<li>
<p><span class="bold">Severe (.999):</span> Only 1 in 1,000 observations are expected to exceed this value.</p>
</li>
<li>
<p><span class="bold">Extreme (.9999):</span> Only 1 in 10,000 observations are expected to exceed this value.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
When you specify Severe (.999) or Extreme (.9999), Oracle Database performs an internal calculation to set the threshold value. In some cases, Oracle Database cannot establish the threshold value at these levels using the data in the baseline, and the significance level threshold is not set.
<p>If you are not receiving alerts as expected, and you specified a Severe (.999) or Extreme (.9999) significance level threshold, then you can try setting the significance level threshold to a lower value, such as Very High (.99) or High (.95). Alternatively, you can set a percentage of maximum threshold instead of a significance level threshold. If you change the threshold and find that you are receiving too many alerts, then you can try increasing the number of occurrences to cause an alert.</p>
</div>
</li>
</ul>
<p>Percentage of maximum thresholds are most useful when a system is sized for peak workloads, and you want to be alerted when the current workload volume is approaching or exceeding previous high values. Metrics that have an unknown but definite limiting value are good candidates for these settings. For example, the redo generated per second metric is typically a good candidate for a percentage of maximum threshold.</p>
<p>Significance level thresholds are most useful for metrics that should exhibit statistically stable behavior when the system is operating normally, but might vary over a wide range when the system is performing poorly. For example, the response time per transaction metric should be stable for a well-tuned OLTP system, but may fluctuate widely when performance issues arise. Significance level thresholds are meant to generate alerts when conditions produce both unusual metric values and unusual system performance.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The primary interface for managing baseline metrics is Oracle Enterprise Manager. To create an adaptive threshold for a baseline metric, use Oracle Enterprise Manager, as described in <a class="olink TDPPT334" href="../../server.112/e10822/tdppt_degrade.htm#TDPPT334"><span class="italic">Oracle Database 2 Day + Performance Tuning Guide</span></a>.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDDBEDI">"Moving Window Baseline"</a></div>
</div>
<!-- class="sect2" -->
<a id="CHDCBHED"></a>
<div id="PFGRF94182" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.2.4</span> Space Consumption</h3>
<p><a id="sthref280"></a>The space consumed by the AWR is determined by several factors:</p>
<ul>
<li>
<p>Number of active sessions in the system at any given time</p>
</li>
<li>
<p>Snapshot interval</p>
<p>The snapshot interval determines the frequency at which snapshots are captured. A smaller snapshot interval increases the frequency, which increases the volume of data collected by the AWR.</p>
</li>
<li>
<p>Historical data retention period</p>
<p>The retention period determines how long this data is retained before being purged. A longer retention period increases the space consumed by the AWR.</p>
</li>
</ul>
<p><a id="sthref281"></a><a id="sthref282"></a><a id="sthref283"></a>By default, snapshots are captured once every hour and are retained in the database for 8 days. With these default settings, a typical system with an average of 10 concurrent active sessions can require approximately 200 to 300 MB of space for its AWR data. It is possible to change the default values for both snapshot interval and retention period. See <a href="#i37982">"Modifying Snapshot Settings"</a> to learn how to modify AWR settings.</p>
<p><a id="sthref284"></a>The AWR space consumption can be reduced by the increasing the snapshot interval and reducing the retention period. When reducing the retention period, note that several Oracle Database self-managing features depend on AWR data for proper functioning. Not having enough data can affect the validity and accuracy of these components and features, including:</p>
<ul>
<li>
<p>Automatic Database Diagnostic Monitor</p>
</li>
<li>
<p>SQL Tuning Advisor</p>
</li>
<li>
<p>Undo Advisor</p>
</li>
<li>
<p>Segment Advisor</p>
</li>
</ul>
<p><a id="sthref285"></a>If possible, Oracle recommends that you set the AWR retention period large enough to capture at least one complete workload cycle. If your system experiences weekly workload cycles, such as OLTP workload during weekdays and batch jobs during the weekend, you do not need to change the default AWR retention period of 8 days. However if your system is subjected to a monthly peak load during month end book closing, you may have to set the retention period to one month.</p>
<p><a id="sthref286"></a>Under exceptional circumstances, you can turn off automatic snapshot collection by setting the snapshot interval to 0. Under this condition, the automatic collection of the workload and statistical data is stopped and much of the Oracle Database self-management functionality is not operational. In addition, you cannot manually create snapshots. For this reason, Oracle strongly recommends that you do not turn off automatic snapshot collection.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDGCJJJ"></a>
<div id="PFGRF94183" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">5.3</span> Managing the Automatic Workload Repository</h2>
<p>This section describes how to manage the AWR and contains the following topics:</p>
<ul>
<li>
<p><a href="#i26958">Managing Snapshots</a></p>
</li>
<li>
<p><a href="#CHDHBGJD">Managing Baselines</a></p>
</li>
<li>
<p><a href="#CHDHJADB">Managing Baseline Templates</a></p>
</li>
<li>
<p><a href="#CHDCGJFA">Transporting Automatic Workload Repository Data</a></p>
</li>
<li>
<p><a href="#i35169">Using Automatic Workload Repository Views</a></p>
</li>
<li>
<p><a href="#i35176">Generating Automatic Workload Repository Reports</a></p>
</li>
<li>
<p><a href="#CHDBBEFB">Generating Automatic Workload Repository Compare Periods Reports</a></p>
</li>
<li>
<p><a href="#CHDIDEDG">Generating Active Session History Reports</a></p>
</li>
<li>
<p><a href="#CHDJIEFE">Using Active Session History Reports</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#i27008">"Overview of the Automatic Workload Repository"</a> for a description of the AWR</div>
<a id="i26958"></a>
<div id="PFGRF94184" class="sect2">
<h3 class="sect2"><span class="secnum">5.3.1</span> Managing Snapshots</h3>
<p>By default, Oracle Database generates snapshots once every hour, and retains the statistics in the workload repository for 8 days. When necessary, you can use <code>DBMS_WORKLOAD_REPOSITORY</code> procedures to manually create, drop, and modify the snapshots. To invoke these procedures, a user must be granted the DBA role.</p>
<p>The primary interface for managing snapshots is Oracle Enterprise Manager. Whenever possible, you should manage snapshots using Oracle Enterprise Manager, as described in <a class="olink TDPPT025" href="../../server.112/e10822/tdppt_auto.htm#TDPPT025"><span class="italic">Oracle Database 2 Day + Performance Tuning Guide</span></a>. If Oracle Enterprise Manager is unavailable, you can manage snapshots using the <code><a id="sthref287"></a><a id="sthref288"></a><a id="sthref289"></a>DBMS_WORKLOAD_REPOSITORY</code> package, as described in the following sections:</p>
<ul>
<li>
<p><a href="#CHDHFAED">Creating Snapshots</a></p>
</li>
<li>
<p><a href="#CHDHEDAH">Dropping Snapshots</a></p>
</li>
<li>
<p><a href="#i37982">Modifying Snapshot Settings</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDJEFJA">"Snapshots"</a> for more information about snapshots</p>
</li>
<li>
<p><a class="olink ARPLS093" href="../../appdev.112/e40758/d_workload_repos.htm#ARPLS093"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for detailed information on the <code>DBMS_WORKLOAD_REPOSITORY</code> package</p>
</li>
</ul>
</div>
<a id="CHDHFAED"></a>
<div id="PFGRF94185" class="sect3">
<h4 class="sect3"><span class="secnum">5.3.1.1</span> Creating Snapshots</h4>
<p>You can manually create snapshots with the <code>CREATE_SNAPSHOT</code> procedure to capture statistics at times different than those of the automatically generated snapshots. For example:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPOSITORY.CREATE_SNAPSHOT ();
END;
/
</pre>
<p>In this example, a snapshot for the instance is created immediately with the flush level specified to the default flush level of <code>TYPICAL</code>. You can view this snapshot in the <code>DBA_HIST_SNAPSHOT</code> view.</p>
</div>
<!-- class="sect3" -->
<a id="CHDHEDAH"></a>
<div id="PFGRF94186" class="sect3">
<h4 class="sect3"><span class="secnum">5.3.1.2</span> Dropping Snapshots</h4>
<p>You can drop a range of snapshots using the <code>DROP_SNAPSHOT_RANGE</code> procedure. To view a list of the snapshot IDs along with database IDs, check the <code>DBA_HIST_SNAPSHOT</code> view. For example, you can drop the following range of snapshots:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPOSITORY.DROP_SNAPSHOT_RANGE (low_snap_id =&gt; 22, 
                           high_snap_id =&gt; 32, dbid =&gt; 3310949047);
END;
/
</pre>
<p>In the example, the range of snapshot IDs to drop is specified from 22 to 32. The optional database identifier is <code>3310949047</code>. If you do not specify a value for <code>dbid</code>, the local database identifier is used as the default value.</p>
<p>Active Session History data (ASH) that belongs to the time period specified by the snapshot range is also purged when the <code>DROP_SNAPSHOT_RANGE</code> procedure is called.</p>
</div>
<!-- class="sect3" -->
<a id="i37982"></a>
<div id="PFGRF94187" class="sect3">
<h4 class="sect3"><span class="secnum">5.3.1.3</span> Modifying Snapshot Settings</h4>
<p>You can adjust the interval, retention, and captured Top SQL of snapshot generation for a specified database ID, but note that this can affect the precision of the Oracle Database diagnostic tools.</p>
<p>The <code>INTERVAL</code> setting affects how often the database automatically generates snapshots. The <code>RETENTION</code> setting affects how long the database stores snapshots in the workload repository. The <code>TOPNSQL</code> setting affects the number of Top SQL to flush for each SQL criteria (Elapsed Time, CPU Time, Parse Calls, sharable Memory, and Version Count). The value for this setting is not affected by the statistics/flush level and will override the system default behavior for the AWR SQL collection. It is possible to set the value for this setting to <code>MAXIMUM</code> to capture the complete set of SQL in the shared SQL area, though by doing so (or by setting the value to a very high number) may lead to possible space and performance issues because there will more data to collect and store. To adjust the settings, use the <code>MODIFY_SNAPSHOT_SETTINGS</code> procedure. For example:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPOSITORY.MODIFY_SNAPSHOT_SETTINGS( retention =&gt; 43200, 
                 interval =&gt; 30, topnsql =&gt; 100, dbid =&gt; 3310949047);
END;
/
</pre>
<p>In this example, the retention period is specified as 43200 minutes (30 days), the interval between each snapshot is specified as 30 minutes, and the number of Top SQL to flush for each SQL criteria as 100. If NULL is specified, the existing value is preserved. The optional database identifier is <code>3310949047</code>. If you do not specify a value for <code>dbid</code>, the local database identifier is used as the default value. You can check the current settings for your database instance with the <code><a id="sthref290"></a><a id="sthref291"></a>DBA_HIST_WR_CONTROL</code> view.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDHBGJD"></a>
<div id="PFGRF94188" class="sect2">
<h3 class="sect2"><span class="secnum">5.3.2</span> Managing Baselines</h3>
<p>This section describes how to manage baselines. The primary interface for managing baselines is Oracle Enterprise Manager. Whenever possible, you should manage baselines using Oracle Enterprise Manager, as described in <a class="olink TDPPT230" href="../../server.112/e10822/tdppt_degrade.htm#TDPPT230"><span class="italic">Oracle Database 2 Day + Performance Tuning Guide</span></a>. If Oracle Enterprise Manager is unavailable, you can manage baselines using the <code><a id="sthref292"></a><a id="sthref293"></a><a id="sthref294"></a>DBMS_WORKLOAD_REPOSITORY</code> package, as described in the following sections:</p>
<ul>
<li>
<p><a href="#CHDCBAIH">Creating a Baseline</a></p>
</li>
<li>
<p><a href="#CHDGFJIA">Dropping a Baseline</a></p>
</li>
<li>
<p><a href="#CHDJEHJI">Renaming a Baseline</a></p>
</li>
<li>
<p><a href="#CHDJJGAI">Displaying Baseline Metrics</a></p>
</li>
<li>
<p><a href="#CHDICJHJ">Modifying the Window Size of the Default Moving Window Baseline</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDEJAJA">"Baselines"</a> for more information about baselines</p>
</li>
<li>
<p><a class="olink ARPLS093" href="../../appdev.112/e40758/d_workload_repos.htm#ARPLS093"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for detailed information on the <code>DBMS_WORKLOAD_REPOSITORY</code> package</p>
</li>
</ul>
</div>
<a id="CHDCBAIH"></a>
<div id="PFGRF94189" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.2.1</span> Creating a Baseline</h4>
<p>This section describes how to create a baseline using an existing range of snapshots.</p>
<p>To create a baseline:</p>
<ol>
<li>
<p>Review the existing snapshots in the <code>DBA_HIST_SNAPSHOT</code> view to determine the range of snapshots to use.</p>
</li>
<li>
<p>Use the <code>CREATE_BASELINE</code> procedure to create a baseline using the desired range of snapshots:</p>
<pre>
BEGIN
    DBMS_WORKLOAD_REPOSITORY.CREATE_BASELINE (start_snap_id =&gt; 270, 
                   end_snap_id =&gt; 280, baseline_name =&gt; 'peak baseline', 
                   dbid =&gt; 3310949047, expiration =&gt; 30);
END;
/
</pre>
<p>In this example, <code>270</code> is the start snapshot sequence number and <code>280</code> is the end snapshot sequence. The name of baseline is <code>peak baseline</code>. The optional database identifier is <code>3310949047</code>. If you do not specify a value for <code>dbid</code>, then the local database identifier is used as the default value. The optional <code>expiration</code> parameter is set to <code>30</code>, so the baseline will expire and be dropped automatically after 30 days. If you do not specify a value for <code>expiration</code>, the baseline will never expire.</p>
</li>
</ol>
<p>The system automatically assign a unique baseline ID to the new baseline when the baseline is created. The baseline ID and database identifier are displayed in the <code>DBA_HIST_BASELINE</code> view.</p>
</div>
<!-- class="sect3" -->
<a id="CHDGFJIA"></a>
<div id="PFGRF94190" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.2.2</span> Dropping a Baseline</h4>
<p>This section describes how to drop an existing baseline. Periodically, you may want to drop a baseline that is no longer used to conserve disk space. The snapshots associated with a baseline are retained indefinitely until you explicitly drop the baseline or the baseline has expired.</p>
<p>To drop a baseline:</p>
<ol>
<li>
<p>Review the existing baselines in the <code>DBA_HIST_BASELINE</code> view to determine the baseline to drop.</p>
</li>
<li>
<p>Use the <code>DROP_BASELINE</code> procedure to drop the desired baseline:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPOSITORY.DROP_BASELINE (baseline_name =&gt; 'peak baseline',
                  cascade =&gt; FALSE, dbid =&gt; 3310949047);
END;
/
</pre>
<p>In the example, the name of baseline is <code>peak baseline</code>. The <code>cascade</code> parameter is set to <code>FALSE</code>, which specifies that only the baseline is dropped. Setting this parameter to <code>TRUE</code> specifies that the drop operation will also remove the snapshots associated with the baseline. The optional <code>dbid</code> parameter specifies the database identifier, which in this example is <code>3310949047</code>. If you do not specify a value for <code>dbid</code>, then the local database identifier is used as the default value.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDJEHJI"></a>
<div id="PFGRF94191" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.2.3</span> Renaming a Baseline</h4>
<p>This section describes how to rename a baseline.</p>
<p>To rename a baseline:</p>
<ol>
<li>
<p>Review the existing baselines in the <code>DBA_HIST_BASELINE</code> view to determine the baseline to rename.</p>
</li>
<li>
<p>Use the <code>RENAME_BASELINE</code> procedure to rename the desired baseline:</p>
<pre>
BEGIN
    DBMS_WORKLOAD_REPOSITORY.RENAME_BASELINE (
                   old_baseline_name =&gt; 'peak baseline', 
                   new_baseline_name =&gt; 'peak mondays', 
                   dbid =&gt; 3310949047);
END;
/
</pre>
<p>In this example, the name of the baseline is renamed from <code>peak baseline</code>, as specified by the <code>old_baseline_name</code> parameter, to <code>peak mondays</code>, as specified by the <code>new_baseline_name</code> parameter. The optional <code>dbid</code> parameter specifies the database identifier, which in this example is <code>3310949047</code>. If you do not specify a value for <code>dbid</code>, then the local DBID is the default value.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDJJGAI"></a>
<div id="PFGRF94192" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.2.4</span> Displaying Baseline Metrics</h4>
<p>This section describes how to display metric threshold settings during the time period captured in a baseline. When used with adaptive thresholds, a baseline contains AWR data that the database can use to compute metric threshold values. The <code>SELECT_BASELINE_METRICS</code> function enables you to display the summary statistics for metric values in a baseline period.</p>
<p>To display metric information in a baseline:</p>
<ol>
<li>
<p>Review the existing baselines in the <code>DBA_HIST_BASELINE</code> view to determine the baseline for which you want to display metric information.</p>
</li>
<li>
<p>Use the <code>SELECT_BASELINE_METRICS</code> function to display the metric information for the desired baseline:</p>
<pre>
BEGIN
    DBMS_WORKLOAD_REPOSITORY.SELECT_BASELINE_METRICS (
                   baseline_name =&gt; 'peak baseline', 
                   dbid =&gt; 3310949047,
                   instance_num =&gt; '1');
END;
/
</pre>
<p>In this example, the name of baseline is <code>peak baseline</code>. The optional <code>dbid</code> parameter specifies the database identifier, which in this example is <code>3310949047</code>. If you do not specify a value for <code>dbid</code>, then the local database identifier is used as the default value. The optional <code>instance_num</code> parameter specifies the instance number, which in this example is <code>1</code>. If you do not specify a value for <code>instance_num</code>, then the local instance is used as the default value.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDICJHJ"></a>
<div id="PFGRF94193" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.2.5</span> Modifying the Window Size of the Default Moving Window Baseline</h4>
<p>This section describes how to modify the window size of the default moving window baseline. For information about the default moving window baseline, see <a href="#CHDDBEDI">"Moving Window Baseline"</a>.</p>
<p>To resize the default moving window baseline, use the <code>MODIFY_BASELINE_WINDOW_SIZE</code> procedure:</p>
<pre>
BEGIN
    DBMS_WORKLOAD_REPOSITORY.MODIFY_BASELINE_WINDOW_SIZE (
                   window_size =&gt; 30, 
                   dbid =&gt; 3310949047);
END;
/
</pre>
<p>The <code>window_size</code> parameter is used to specify the new window size, in number of days, for the default moving window size. In this example, the <code>window_size</code> parameter is set to 30. The window size must be set to a value that is equal to or less than the value of the AWR retention setting. To set a window size that is greater than the current AWR retention period, you must first increase the value of the <code>retention</code> parameter, as described in <a href="#i37982">"Modifying Snapshot Settings"</a>.</p>
<p>In this example, the optional <code>dbid</code> parameter specifies the database identifier is <code>3310949047</code>. If you do not specify a value for <code>dbid</code>, then the local database identifier is used as the default value.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDHJADB"></a>
<div id="PFGRF94194" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.3.3</span> Managing Baseline Templates</h3>
<p>This section describes how to manage baseline templates. You can automatically create baselines to capture specified time periods in the future using baseline templates. For information about baseline templates, see <a href="#CHDGFGEG">"Baseline Templates"</a>.</p>
<p>The primary interface for managing baseline templates is Oracle Enterprise Manager. Whenever possible, you should manage baseline templates using Oracle Enterprise Manager, as described in <a class="olink TDPPT230" href="../../server.112/e10822/tdppt_degrade.htm#TDPPT230"><span class="italic">Oracle Database 2 Day + Performance Tuning Guide</span></a>. If Oracle Enterprise Manager is unavailable, you can manage baseline templates using the <code><a id="sthref295"></a><a id="sthref296"></a><a id="sthref297"></a>DBMS_WORKLOAD_REPOSITORY</code> package, as described in the following sections:</p>
<ul>
<li>
<p><a href="#CHDHABDG">Creating a Single Baseline Template</a></p>
</li>
<li>
<p><a href="#CHDIAADC">Creating a Repeating Baseline Template</a></p>
</li>
<li>
<p><a href="#CHDDBBCJ">Dropping a Baseline Template</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS093" href="../../appdev.112/e40758/d_workload_repos.htm#ARPLS093"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for detailed information on the <code>DBMS_WORKLOAD_REPOSITORY</code> package</div>
<a id="CHDHABDG"></a>
<div id="PFGRF94195" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.3.1</span> Creating a Single Baseline Template</h4>
<p>This section describes how to create a single baseline template. You can use a single baseline template to create a baseline during a single, fixed time interval in the future. For example, you can create a single baseline template to generate a baseline that is captured on April 2, 2009 from 5:00 p.m. to 8:00 p.m.</p>
<p>To create a single baseline template, use the <code>CREATE_BASELINE_TEMPLATE</code> procedure:</p>
<pre>
BEGIN
    DBMS_WORKLOAD_REPOSITORY.CREATE_BASELINE_TEMPLATE (
                   start_time =&gt; '2009-04-02 17:00:00 PST', 
                   end_time =&gt; '2009-04-02 20:00:00 PST', 
                   baseline_name =&gt; 'baseline_090402', 
                   template_name =&gt; 'template_090402', expiration =&gt; 30, 
                   dbid =&gt; 3310949047);
END;
/
</pre>
<p>The <code>start_time</code> parameter specifies the start time for the baseline to be created. The <code>end_time</code> parameter specifies the end time for the baseline to be created. The <code>baseline_name</code> parameter specifies the name of the baseline to be created. The <code>template_name</code> parameter specifies the name of the baseline template. The optional <code>expiration</code> parameter specifies the expiration, in number of days, for the baseline. If unspecified, then the baseline never expires. The optional <code>dbid</code> parameter specifies the database identifier. If unspecified, then the local database identifier is used as the default value.</p>
<p>In this example, a baseline template named <code>template_090402</code> is created that will generate a baseline named <code>baseline_090402</code> for the time period from 5:00 p.m. to 8:00 p.m. on April 2, 2009 on the database with a database ID of <code>3310949047</code>. The baseline will expire after 30 days.</p>
</div>
<!-- class="sect3" -->
<a id="CHDIAADC"></a>
<div id="PFGRF94196" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.3.2</span> Creating a Repeating Baseline Template</h4>
<p>This section describes how to create a repeating baseline template. A repeating baseline template can be used to automatically create baselines that repeat during a particular time interval over a specific period in the future. For example, you can create a repeating baseline template to generate a baseline that repeats every Monday from 5:00 p.m. to 8:00 p.m. for the year 2009.</p>
<p>To create a repeating baseline template, use the <code>CREATE_BASELINE_TEMPLATE</code> procedure:</p>
<pre>
BEGIN
    DBMS_WORKLOAD_REPOSITORY.CREATE_BASELINE_TEMPLATE (
                   day_of_week =&gt; 'monday', hour_in_day =&gt; 17,
                   duration =&gt; 3, expiration =&gt; 30,
                   start_time =&gt; '2009-04-02 17:00:00 PST', 
                   end_time =&gt; '2009-12-31 20:00:00 PST', 
                   baseline_name_prefix =&gt; 'baseline_2009_mondays_', 
                   template_name =&gt; 'template_2009_mondays',
                   dbid =&gt; 3310949047);
END;
/
</pre>
<p>The <code>day_of_week</code> parameter specifies the day of the week on which the baseline will repeat. The <code>hour_in_day</code> parameter specifies the hour in the day when the baseline will start. The <code>duration</code> parameter specifies the duration, in number of hours, that the baseline will last. The <code>expiration</code> parameter specifies the number of days to retain each created baseline. If set to <code>NULL</code>, then the baselines never expires. The <code>start_time</code> parameter specifies the start time for the baseline to be created. The <code>end_time</code> parameter specifies the end time for the baseline to be created. The <code>baseline_name_prefix</code> parameter specifies the name of the baseline prefix that will be appended to the data information when the baseline is created. The <code>template_name</code> parameter specifies the name of the baseline template. The optional <code>dbid</code> parameter specifies the database identifier. If unspecified, then the local database identifier is used as the default value.</p>
<p>In this example, a baseline template named <code>template_2009_mondays</code> is created that will generate a baseline on every Monday from 5:00 p.m. to 8:00 p.m. beginning on April 2, 2009 at 5:00 p.m. and ending on December 31, 2009 at 8:00 p.m. on the database with a database ID of <code>3310949047</code>. Each of the baselines will be created with a baseline name with the prefix <code>baseline_2009_mondays_</code> and will expire after 30 days.</p>
</div>
<!-- class="sect3" -->
<a id="CHDDBBCJ"></a>
<div id="PFGRF94197" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.3.3</span> Dropping a Baseline Template</h4>
<p>This section describes how to drop an existing baseline template. Periodically, you may want to remove baselines templates that are no longer used to conserve disk space.</p>
<p>To drop a baseline template:</p>
<ol>
<li>
<p>Review the existing baselines in the <code>DBA_HIST_BASELINE_TEMPLATE</code> view to determine the baseline template you want to drop.</p>
</li>
<li>
<p>Use the <code>DROP_BASELINE_TEMPLATE</code> procedure to drop the desired baseline template:</p>
<pre>
BEGIN
  DBMS_WORKLOAD_REPOSITORY.DROP_BASELINE_TEMPLATE (
                   template_name =&gt; 'template_2009_mondays',
                   dbid =&gt; 3310949047);
END;
/
</pre>
<p>The <code>template_name</code> parameter specifies the name of the baseline template that will be dropped. In the example, the name of baseline template that will be dropped is <code>template_2009_mondays</code>. The optional <code>dbid</code> parameter specifies the database identifier, which in this example is <code>3310949047</code>. If you do not specify a value for <code>dbid</code>, then the local database identifier is used as the default value.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDCGJFA"></a>
<div id="PFGRF94198" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.3.4</span> Transporting Automatic Workload Repository Data</h3>
<p>Oracle Database enables you to transport AWR data between systems. This is useful in cases where you want to use a separate system to perform analysis of the AWR data. To transport AWR data, you must first extract the AWR snapshot data from the database on the source system, then load the data into the database on the target system, as described in the following sections:</p>
<ul>
<li>
<p><a href="#CHDHFBAI">Extracting AWR Data</a></p>
</li>
<li>
<p><a href="#CHDFEFHE">Loading AWR Data</a></p>
</li>
</ul>
<a id="CHDHFBAI"></a>
<div id="PFGRF94199" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.4.1</span> Extracting AWR Data</h4>
<p>The <code>awrextr.sql</code> script extracts the AWR data for a range of snapshots from the database into a Data Pump export file. After it is created, you can transport this dump file to another database where you can load the extracted data. To run the <code>awrextr.sql</code> script, you must be connected to the database as the <code>SYS</code> user.</p>
<p>To extract AWR data:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/awrextr.sql
</pre>
<p>A list of the databases in the AWR schema is displayed.</p>
</li>
<li>
<p>Specify the database from which the AWR data will be extracted:</p>
<pre>
Enter value for db_id: 1377863381
</pre>
<p>In this example, the database with the database identifier of <code>1377863381</code> is selected.</p>
</li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs.</p>
<pre>
Enter value for num_days: 2
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the last 2 days are displayed.</p>
</li>
<li>
<p>Define the range of snapshots for which AWR data will be extracted by specifying a beginning and ending snapshot ID:</p>
<pre>
Enter value for begin_snap: 30
Enter value for end_snap: 40
</pre>
<p>In this example, the snapshot with a snapshot ID of 30 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 40 is selected as the ending snapshot.</p>
</li>
<li>
<p>A list of directory objects is displayed.</p>
<p>Specify the directory object pointing to the directory where the export dump file will be stored:</p>
<pre>
Enter value for directory_name: DATA_PUMP_DIR
</pre>
<p>In this example, the directory object <code>DATA_PUMP_DIR</code> is selected.</p>
</li>
<li>
<p>Specify the prefix for name of the export dump file (the <code>.dmp</code> suffix will be automatically appended):</p>
<pre>
Enter value for file_name: awrdata_30_40
</pre>
<p>In this example, an export dump file named <code>awrdata_30_40</code> will be created in the directory corresponding to the directory object you specified:</p>
<pre>
Dump file set for SYS.SYS_EXPORT_TABLE_01 is:
C:\ORACLE\PRODUCT\11.1.0.5\DB_1\RDBMS\LOG\AWRDATA_30_40.DMP
Job "SYS"."SYS_EXPORT_TABLE_01" successfully completed at 08:58:20
</pre>
<p>Depending on the amount of AWR data that must be extracted, the AWR extract operation may take a while to complete. After the dump file is created, you can use Data Pump to transport the file to another system.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SUTIL100" href="../../server.112/e22490/dp_overview.htm#SUTIL100"><span class="italic">Oracle Database Utilities</span></a> for information about using Data Pump</div>
</div>
<!-- class="sect3" -->
<a id="CHDFEFHE"></a>
<div id="PFGRF94200" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.4.2</span> Loading AWR Data</h4>
<p>After the export dump file is transported to the target system, you can load the extracted AWR data using the <code>awrload.sql</code> script. The <code>awrload.sql</code> script will first create a staging schema where the snapshot data is transferred from the Data Pump file into the database. The data is then transferred from the staging schema into the appropriate AWR tables. To run the <code>awrload.sql</code> script, you must be connected to the database as the <code>SYS</code> user.</p>
<p>To load AWR data:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/awrload.sql
</pre>
<p>A list of directory objects is displayed.</p>
</li>
<li>
<p>Specify the directory object pointing to the directory where the export dump file is located:</p>
<pre>
Enter value for directory_name: DATA_PUMP_DIR
</pre>
<p>In this example, the directory object <code>DATA_PUMP_DIR</code> is selected.</p>
</li>
<li>
<p>Specify the prefix for name of the export dump file (the <code>.dmp</code> suffix will be automatically appended):</p>
<pre>
Enter value for file_name: awrdata_30_40
</pre>
<p>In this example, the export dump file named <code>awrdata_30_40</code> is selected.</p>
</li>
<li>
<p>Specify the name of the staging schema where the AWR data will be loaded:</p>
<pre>
Enter value for schema_name: AWR_STAGE
</pre>
<p>In this example, a staging schema named <code>AWR_STAGE</code> will be created where the AWR data will be loaded.</p>
</li>
<li>
<p>Specify the default tablespace for the staging schema:</p>
<pre>
Enter value for default_tablespace: SYSAUX
</pre>
<p>In this example, the <code>SYSAUX</code> tablespace is selected.</p>
</li>
<li>
<p>Specify the temporary tablespace for the staging schema:</p>
<pre>
Enter value for temporary_tablespace: TEMP
</pre>
<p>In this example, the <code>TEMP</code> tablespace is selected.</p>
</li>
<li>
<p>A staging schema named <code>AWR_STAGE</code> will be created where the AWR data will be loaded. After the AWR data is loaded into the <code>AWR_STAGE</code> schema, the data will be transferred into the AWR tables in the <code>SYS</code> schema:</p>
<pre>
Processing object type TABLE_EXPORT/TABLE/CONSTRAINT/CONSTRAINT
Completed 113 CONSTRAINT objects in 11 seconds
Processing object type TABLE_EXPORT/TABLE/CONSTRAINT/REF_CONSTRAINT
Completed 1 REF_CONSTRAINT objects in 1 seconds
Job "SYS"."SYS_IMPORT_FULL_03" successfully completed at 09:29:30
... Dropping AWR_STAGE user
End of AWR Load
</pre>
<p>Depending on the amount of AWR data that must be loaded, the AWR load operation may take a while to complete. After the AWR data is loaded, the staging schema will be dropped automatically.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i35169"></a>
<div id="PFGRF94201" class="sect2">
<h3 class="sect2"><span class="secnum">5.3.5</span> Using Automatic Workload Repository Views</h3>
<p><a id="sthref298"></a>Typically, you would view the AWR data through Oracle Enterprise Manager or AWR reports. However, you can also view the statistics using the following views:</p>
<ul>
<li>
<p><code>V$ACTIVE_SESSION_HISTORY</code></p>
<p>This view displays active database session activity, sampled once every second. See <a href="#i35568">"Active Session History"</a>.</p>
</li>
<li>
<p><code>V$</code> metric views provide metric data to track the performance of the system</p>
<p>The metric views are organized into various groups, such as event, event class, system, session, service, file, and tablespace metrics. These groups are identified in the <code>V$METRICGROUP</code> view.</p>
</li>
<li>
<p><code>DBA_HIST</code> views</p>
<p>The <code><a id="sthref299"></a><a id="sthref300"></a>DBA_HIST</code> views displays historical data stored in the database. This group of views includes:</p>
<ul>
<li>
<p><code>DBA_HIST_ACTIVE_SESS_HISTORY</code> displays the history of the contents of the in-memory active session history for recent system activity</p>
</li>
<li>
<p><code>DBA_HIST_BASELINE</code> displays information about the baselines captured on the system, such as the time range of each baseline and the baseline type</p>
</li>
<li>
<p><code>DBA_HIST_BASELINE_DETAILS</code> displays details about a specific baseline</p>
</li>
<li>
<p><code>DBA_HIST_BASELINE_TEMPLATE</code> displays information about the baseline templates used by the system to generate baselines</p>
</li>
<li>
<p><code>DBA_HIST_DATABASE_INSTANCE</code> displays information about the database environment</p>
</li>
<li>
<p><code>DBA_HIST_DB_CACHE_ADVICE</code> displays historical predictions of the number of physical reads for the cache size corresponding to each row</p>
</li>
<li>
<p><code>DBA_HIST_DISPATCHER</code> displays historical information for each dispatcher process at the time of the snapshot</p>
</li>
<li>
<p><code>DBA_HIST_DYN_REMASTER_STATS</code> displays statistical information about the dynamic remastering process</p>
</li>
<li>
<p><code>DBA_HIST_IOSTAT_DETAIL</code> displays historical I/O statistics aggregated by file type and function</p>
</li>
<li>
<p><code>DBA_HIST_SHARED_SERVER_SUMMARY</code> displays historical information for shared servers, such as shared server activity, common queues and dispatcher queues</p>
</li>
<li>
<p><code>DBA_HIST_SNAPSHOT</code> displays information on snapshots in the system</p>
</li>
<li>
<p><code>DBA_HIST_SQL_PLAN</code> displays the SQL execution plans</p>
</li>
<li>
<p><code>DBA_HIST_WR_CONTROL</code> displays the settings for controlling AWR</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN" href="../e40402/toc.htm"><span class="italic">Oracle Database Reference</span></a> for information about dynamic and static data dictionary views</div>
</li>
</ul>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="i35176"></a>
<div id="PFGRF94202" class="sect2">
<h3 class="sect2"><span class="secnum">5.3.6</span> Generating Automatic Workload Repository Reports</h3>
<p>An AWR report shows data captured between two snapshots (or two points in time). The AWR reports are divided into multiple sections. The HTML report includes links that can be used to navigate quickly between sections. The content of the report contains the workload profile of the system for the selected range of snapshots.</p>
<p>The primary interface for generating AWR reports is Oracle Enterprise Manager. Whenever possible, you should generate AWR reports using Oracle Enterprise Manager, as described in <a class="olink TDPPT032" href="../../server.112/e10822/tdppt_auto.htm#TDPPT032"><span class="italic">Oracle Database 2 Day + Performance Tuning Guide</span></a>. If Oracle Enterprise Manager is unavailable, you can generate AWR reports by running SQL scripts<a id="sthref301"></a><a id="sthref302"></a>, as described in the following sections:</p>
<ul>
<li>
<p><a href="#i30137">Generating an AWR Report</a></p>
</li>
<li>
<p><a href="#CHDCFBJC">Generating an Oracle RAC AWR Report</a></p>
</li>
<li>
<p><a href="#CHDCBGFG">Generating an AWR Report on a Specific Database Instance</a></p>
</li>
<li>
<p><a href="#CHDIBIBF">Generating an Oracle RAC AWR Report on Specific Database Instances</a></p>
</li>
<li>
<p><a href="#CHDBCHHG">Generating an AWR Report for a SQL Statement</a></p>
</li>
<li>
<p><a href="#CHDHDIAA">Generating an AWR Report for a SQL Statement on a Specific Database Instance</a></p>
</li>
</ul>
<p>To run these scripts, you must be granted the DBA role.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
<a id="sthref303"></a>If you run a report on a database that does not have any workload activity during the specified range of snapshots, calculated percentages for some report statistics can be less than 0 or greater than 100. This result simply means that there is no meaningful value for the statistic.</div>
<a id="i30137"></a>
<div id="PFGRF94203" class="sect3">
<h4 class="sect3"><span class="secnum">5.3.6.1</span> Generating an AWR Report</h4>
<p>The <code>awrrpt.sql</code> SQL script generates an HTML or text report that displays statistics for a range of snapshot IDs.</p>
<p>To generate an AWR report:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/awrrpt.sql
</pre></li>
<li>
<p>Specify whether you want an HTML or a text report:</p>
<pre>
Enter value for report_type: text
</pre>
<p>In this example, a text report is chosen.</p>
</li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs.</p>
<pre>
Enter value for num_days: 2
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the last 2 days are displayed.</p>
</li>
<li>
<p>Specify a beginning and ending snapshot ID for the workload repository report:</p>
<pre>
Enter value for begin_snap: 150
Enter value for end_snap: 160
</pre>
<p>In this example, the snapshot with a snapshot ID of 150 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 160 is selected as the ending snapshot.</p>
</li>
<li>
<p>Enter a report name, or accept the default report name:</p>
<pre>
Enter value for report_name: 
Using the report name awrrpt_1_150_160
</pre>
<p>In this example, the default name is accepted and an AWR report named <code>awrrpt_1_150_160</code> is generated.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDCFBJC"></a>
<div id="PFGRF95087" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.6.2</span> Generating an Oracle RAC AWR Report</h4>
<p>The <code>awrgrpt.sql</code> SQL script generates an HTML or text report that displays statistics for a range of snapshot IDs using the current database identifier and all available database instances in an Oracle Real Application Clusters (Oracle RAC) environment.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
In an Oracle RAC environment, you should always try to generate an HTML report (instead of a text report) because they are much easier to read.</div>
<p>To generate an AWR report in an Oracle RAC environment:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/awrgrpt.sql
</pre></li>
<li>
<p>Specify whether you want an HTML or a text report:</p>
<pre>
Enter value for report_type: html
</pre>
<p>In this example, an HTML report is chosen.</p>
</li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs.</p>
<pre>
Enter value for num_days: 2
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the last day are displayed.</p>
</li>
<li>
<p>Specify a beginning and ending snapshot ID for the workload repository report:</p>
<pre>
Enter value for begin_snap: 150
Enter value for end_snap: 160
</pre>
<p>In this example, the snapshot with a snapshot ID of 150 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 160 is selected as the ending snapshot.</p>
</li>
<li>
<p>Enter a report name, or accept the default report name:</p>
<pre>
Enter value for report_name: 
Using the report name awrrpt_rac_150_160.html
</pre>
<p>In this example, the default name is accepted and an AWR report named <code>awrrpt_rac_150_160.html</code> is generated.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDCBGFG"></a>
<div id="PFGRF94204" class="sect3">
<h4 class="sect3"><span class="secnum">5.3.6.3</span> Generating an AWR Report on a Specific Database Instance</h4>
<p>The <code>awrrpti.sql</code> SQL script generates an HTML or text report that displays statistics for a range of snapshot IDs using a specific database and instance. This script enables you to specify a database identifier and instance for which the AWR report will be generated.</p>
<p>To generate an AWR report on a specific database instance:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/awrrpti.sql
</pre></li>
<li>
<p>Specify whether you want an HTML or a text report:</p>
<pre>
Enter value for report_type: text
</pre>
<p>In this example, a text report is chosen.</p>
<p>A list of available database identifiers and instance numbers are displayed:</p>
<pre>
Instances in this Workload Repository schema
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   DB Id    Inst Num DB Name      Instance     Host
----------- -------- ------------ ------------ ------------
 3309173529        1 MAIN         main         examp1690
 3309173529        1 TINT251      tint251      samp251
</pre></li>
<li>
<p>Enter the values for the database identifier (<code>dbid)</code> and instance number (<code>inst_num)</code>:</p>
<pre>
Enter value for dbid: 3309173529
Using 3309173529 for database Id
Enter value for inst_num: 1
</pre></li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs.</p>
<pre>
Enter value for num_days: 2
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the last 2 days are displayed.</p>
</li>
<li>
<p>Specify a beginning and ending snapshot ID for the workload repository report:</p>
<pre>
Enter value for begin_snap: 150
Enter value for end_snap: 160
</pre>
<p>In this example, the snapshot with a snapshot ID of 150 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 160 is selected as the ending snapshot.</p>
</li>
<li>
<p>Enter a report name, or accept the default report name:</p>
<pre>
Enter value for report_name: 
Using the report name awrrpt_1_150_160
</pre>
<p>In this example, the default name is accepted and an AWR report named <code>awrrpt_1_150_160</code> is generated on the database instance with a database ID value of <code>3309173529</code>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDIBIBF"></a>
<div id="PFGRF95088" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.6.4</span> Generating an Oracle RAC AWR Report on Specific Database Instances</h4>
<p>The <code>awrgrpti.sql</code> SQL script generates an HTML or text report that displays statistics for a range of snapshot IDs using specific databases and instances running in an Oracle RAC environment. This script enables you to specify database identifiers and a comma-delimited list of database instances for which the AWR report will be generated.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
In an Oracle RAC environment, you should always try to generate an HTML report (instead of a text report) because they are much easier to read.</div>
<p>To generate an AWR report on a specific database instance in an Oracle RAC environment:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/awrgrpti.sql
</pre></li>
<li>
<p>Specify whether you want an HTML or a text report:</p>
<pre>
Enter value for report_type: html
</pre>
<p>In this example, an HTML report is chosen.</p>
<p>A list of available database identifiers and instance numbers are displayed:</p>
<pre>
Instances in this Workload Repository schema
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   DB Id    Inst Num DB Name      Instance     Host
----------- -------- ------------ ------------ ------------
 3309173529        1 MAIN         main         examp1690
 3309173529        1 TINT251      tint251      samp251
 3309173529        2 TINT251      tint252      samp252
</pre></li>
<li>
<p>Enter the value for the database identifier (<code>dbid)</code>:</p>
<pre>
Enter value for dbid: 3309173529
Using 3309173529 for database Id
</pre></li>
<li>
<p>Enter the value for the instance numbers (<code>instance_numbers_or_all</code>) of the Oracle RAC instances you want to include in the report:</p>
<pre>
Enter value for instance_numbers_or_all: 1,2
</pre></li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs.</p>
<pre>
Enter value for num_days: 2
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the last 2 days are displayed.</p>
</li>
<li>
<p>Specify a beginning and ending snapshot ID for the workload repository report:</p>
<pre>
Enter value for begin_snap: 150
Enter value for end_snap: 160
</pre>
<p>In this example, the snapshot with a snapshot ID of 150 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 160 is selected as the ending snapshot.</p>
</li>
<li>
<p>Enter a report name, or accept the default report name:</p>
<pre>
Enter value for report_name: 
Using the report name awrrpt_rac_150_160.html
</pre>
<p>In this example, the default name is accepted and an AWR report named <code>awrrpt_rac_150_160.html</code> is generated on the database instance with a database ID value of <code>3309173529</code>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDBCHHG"></a>
<div id="PFGRF94205" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.6.5</span> Generating an AWR Report for a SQL Statement</h4>
<p>The <code>awrsqrpt.sql</code> SQL script generates an HTML or text report that displays statistics of a particular SQL statement for a range of snapshot IDs. Run this report to inspect or debug the performance of a SQL statement.</p>
<p>To generate an AWR report for a particular SQL statement:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/awrsqrpt.sql
</pre></li>
<li>
<p>Specify whether you want an HTML or a text report:</p>
<pre>
Enter value for report_type: html
</pre>
<p>In this example, an HTML report is chosen.</p>
</li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs.</p>
<pre>
Enter value for num_days: 1
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the previous day are displayed.</p>
</li>
<li>
<p>Specify a beginning and ending snapshot ID for the workload repository report:</p>
<pre>
Enter value for begin_snap: 146
Enter value for end_snap: 147
</pre>
<p>In this example, the snapshot with a snapshot ID of 146 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 147 is selected as the ending snapshot.</p>
</li>
<li>
<p>Specify the SQL ID of a particular SQL statement to display statistics:</p>
<pre>
Enter value for sql_id: 2b064ybzkwf1y
</pre>
<p>In this example, the SQL statement with a SQL ID of <code>2b064ybzkwf1y</code> is selected.</p>
</li>
<li>
<p>Enter a report name, or accept the default report name:</p>
<pre>
Enter value for report_name: 
Using the report name awrrpt_1_146_147.html
</pre>
<p>In this example, the default name is accepted and an AWR report named <code>awrrpt_1_146_147</code> is generated.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDHDIAA"></a>
<div id="PFGRF94206" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.6.6</span> Generating an AWR Report for a SQL Statement on a Specific Database Instance</h4>
<p>The <code>awrsqrpi.sql</code> SQL script generates an HTML or text report that displays statistics of a particular SQL statement for a range of snapshot IDs using a specific database and instance.This script enables you to specify a database identifier and instance for which the AWR report will be generated. Run this report to inspect or debug the performance of a SQL statement on a specific database and instance.</p>
<p>To generate an AWR report for a particular SQL statement on a specified database instance:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/awrsqrpi.sql
</pre></li>
<li>
<p>Specify whether you want an HTML or a text report:</p>
<pre>
Enter value for report_type: html
</pre>
<p>In this example, an HTML report is chosen.</p>
<p>A list of available database identifiers and instance numbers are displayed:</p>
<pre>
Instances in this Workload Repository schema
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   DB Id    Inst Num DB Name      Instance     Host
----------- -------- ------------ ------------ ------------
 3309173529        1 MAIN         main         examp1690
 3309173529        1 TINT251      tint251      samp251
</pre></li>
<li>
<p>Enter the values for the database identifier (<code>dbid)</code> and instance number (<code>inst_num)</code>:</p>
<pre>
Enter value for dbid: 3309173529
Using 3309173529 for database Id
Enter value for inst_num: 1
Using 1 for instance number
</pre></li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs.</p>
<pre>
Enter value for num_days: 1
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the previous day are displayed.</p>
</li>
<li>
<p>Specify a beginning and ending snapshot ID for the workload repository report:</p>
<pre>
Enter value for begin_snap: 146
Enter value for end_snap: 147
</pre>
<p>In this example, the snapshot with a snapshot ID of 146 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 147 is selected as the ending snapshot.</p>
</li>
<li>
<p>Specify the SQL ID of a particular SQL statement to display statistics:</p>
<pre>
Enter value for sql_id: 2b064ybzkwf1y
</pre>
<p>In this example, the SQL statement with a SQL ID of <code>2b064ybzkwf1y</code> is selected.</p>
</li>
<li>
<p>Enter a report name, or accept the default report name:</p>
<pre>
Enter value for report_name: 
Using the report name awrrpt_1_146_147.html
</pre>
<p>In this example, the default name is accepted and an AWR report named <code>awrrpt_1_146_147</code> is generated on the database instance with a database ID value of <code>3309173529</code>.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDBBEFB"></a>
<div id="PFGRF94207" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.3.7</span> Generating Automatic Workload Repository Compare Periods Reports</h3>
<p>While an AWR report shows AWR data between two snapshots (or two points in time), the AWR Compare Periods report shows the difference between two periods (or two AWR reports, which equates to four snapshots). Using the AWR Compare Periods report helps you to identify detailed performance attributes and configuration settings that differ between two time periods.</p>
<p>For example, if the application workload is known to be stable between 10:00 p.m. and midnight every night, but the performance on a particular Thursday was poor between 10:00 p.m. and 11:00 p.m., generating an AWR Compare Periods report for Thursday from 10:00 p.m. to 11:00 p.m. and Wednesday from 10:00 p.m. to 11:00 p.m. should identify configuration settings, workload profile, and statistics that were different in these time periods. Based on the differences, you can more easily diagnose the cause of the performance degradation. The two time periods selected for the AWR Compare Periods Report can be of different durations because the report normalizes the statistics by the amount of time spent on the database for each time period, and presents statistical data ordered by the largest difference between the periods.</p>
<p>The AWR Compare Periods reports are divided into multiple sections. The HTML report includes links that can be used to navigate quickly between sections. The content of the report contains the workload profile of the system for the selected range of snapshots.</p>
<p>The primary interface for generating AWR Compare Periods reports is Oracle Enterprise Manager. Whenever possible, you should generate AWR Compare Periods reports using Oracle Enterprise Manager, as described in <a class="olink TDPPT091" href="../../server.112/e10822/tdppt_degrade.htm#TDPPT091"><span class="italic">Oracle Database 2 Day + Performance Tuning Guide</span></a>. If Oracle Enterprise Manager is unavailable, you can generate AWR Compare Periods reports by running SQL scripts<a id="sthref304"></a><a id="sthref305"></a>, as described in the following sections:</p>
<ul>
<li>
<p><a href="#CHDFACCA">Generating an AWR Compare Periods Report</a></p>
</li>
<li>
<p><a href="#CHDJGBEF">Generating an Oracle RAC AWR Compare Periods Report</a></p>
</li>
<li>
<p><a href="#CHDEFCAE">Generating an AWR Compare Periods Report on a Specific Database Instance</a></p>
</li>
<li>
<p><a href="#CHDBIAAD">Generating an Oracle RAC AWR Compare Periods Report on Specific Database Instances</a></p>
</li>
</ul>
<p>To run these scripts, you must be granted the DBA role.</p>
<a id="CHDFACCA"></a>
<div id="PFGRF94208" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.7.1</span> Generating an AWR Compare Periods Report</h4>
<p>The <code>awrddrpt.sql</code> SQL script generates an HTML or text report that compares detailed performance attributes and configuration settings between two selected time periods.</p>
<p>To generate an AWR Compare Periods report:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/awrddrpt.sql
</pre></li>
<li>
<p>Specify whether you want an HTML or a text report:</p>
<pre>
Enter value for report_type: html
</pre>
<p>In this example, an HTML report is chosen.</p>
</li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs in the first time period.</p>
<pre>
Enter value for num_days: 2
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the last 2 days are displayed.</p>
</li>
<li>
<p>Specify a beginning and ending snapshot ID for the first time period:</p>
<pre>
Enter value for begin_snap: 102
Enter value for end_snap: 103
</pre>
<p>In this example, the snapshot with a snapshot ID of 102 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 103 is selected as the ending snapshot for the first time period.</p>
</li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs in the second time period.</p>
<pre>
Enter value for num_days2: 1
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the previous day are displayed.</p>
</li>
<li>
<p>Specify a beginning and ending snapshot ID for the second time period:</p>
<pre>
Enter value for begin_snap2: 126
Enter value for end_snap2: 127
</pre>
<p>In this example, the snapshot with a snapshot ID of 126 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 127 is selected as the ending snapshot for the second time period.</p>
</li>
<li>
<p>Enter a report name, or accept the default report name:</p>
<pre>
Enter value for report_name: 
Using the report name awrdiff_1_102_1_126.txt
</pre>
<p>In this example, the default name is accepted and an AWR report named <code>awrdiff_1_102_126</code> is generated.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDJGBEF"></a>
<div id="PFGRF95089" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.7.2</span> Generating an Oracle RAC AWR Compare Periods Report</h4>
<p>The <code>awrgdrpt.sql</code> SQL script generates an HTML or text report that compares detailed performance attributes and configuration settings between two selected time periods using the current database identifier and all available database instances in an Oracle RAC environment.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
In an Oracle RAC environment, you should always try to generate an HTML report (instead of a text report) because they are much easier to read.</div>
<p>To generate an AWR Compare Periods report in an Oracle RAC environment:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/awrgdrpt.sql
</pre></li>
<li>
<p>Specify whether you want an HTML or a text report:</p>
<pre>
Enter value for report_type: html
</pre>
<p>In this example, an HTML report is chosen.</p>
</li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs in the first time period.</p>
<pre>
Enter value for num_days: 2
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the last 2 days are displayed.</p>
</li>
<li>
<p>Specify a beginning and ending snapshot ID for the first time period:</p>
<pre>
Enter value for begin_snap: 102
Enter value for end_snap: 103
</pre>
<p>In this example, the snapshot with a snapshot ID of 102 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 103 is selected as the ending snapshot for the first time period.</p>
</li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs in the second time period.</p>
<pre>
Enter value for num_days2: 1
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the previous day are displayed.</p>
</li>
<li>
<p>Specify a beginning and ending snapshot ID for the second time period:</p>
<pre>
Enter value for begin_snap2: 126
Enter value for end_snap2: 127
</pre>
<p>In this example, the snapshot with a snapshot ID of 126 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 127 is selected as the ending snapshot for the second time period.</p>
</li>
<li>
<p>Enter a report name, or accept the default report name:</p>
<pre>
Enter value for report_name: 
Using the report name awrracdiff_1st_1_2nd_1.html
</pre>
<p>In this example, the default name is accepted and an AWR report named <code>awrrac_1st_1_2nd_1.html</code> is generated.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDEFCAE"></a>
<div id="PFGRF94209" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.7.3</span> Generating an AWR Compare Periods Report on a Specific Database Instance</h4>
<p>The <code>awrddrpi.sql</code> SQL script generates an HTML or text report that compares detailed performance attributes and configuration settings between two selected time periods on a specific database and instance. This script enables you to specify a database identifier and instance for which the AWR Compare Periods report will be generated.</p>
<p>To generate an AWR Compare Periods report on a specified database instance:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/awrddrpi.sql
</pre></li>
<li>
<p>Specify whether you want an HTML or a text report:</p>
<pre>
Enter value for report_type: text
</pre>
<p>In this example, a text report is chosen.</p>
</li>
<li>
<p>A list of available database identifiers and instance numbers are displayed:</p>
<pre>
Instances in this Workload Repository schema
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   DB Id    Inst Num DB Name      Instance     Host
----------- -------- ------------ ------------ ------------
 3309173529        1 MAIN         main         examp1690
 3309173529        1 TINT251      tint251      samp251
</pre>
<p>Enter the values for the database identifier (<code>dbid)</code> and instance number (<code>inst_num)</code> for the first time period:</p>
<pre>
Enter value for dbid: 3309173529
Using 3309173529 for Database Id for the first pair of snapshots
Enter value for inst_num: 1
Using 1 for Instance Number for the first pair of snapshots
</pre></li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs in the first time period.</p>
<pre>
Enter value for num_days: 2
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the last 2 days are displayed.</p>
</li>
<li>
<p>Specify a beginning and ending snapshot ID for the first time period:</p>
<pre>
Enter value for begin_snap: 102
Enter value for end_snap: 103
</pre>
<p>In this example, the snapshot with a snapshot ID of 102 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 103 is selected as the ending snapshot for the first time period.</p>
</li>
<li>
<p>Enter the values for the database identifier (<code>dbid)</code> and instance number (<code>inst_num)</code> for the second time period:</p>
<pre>
Enter value for dbid2: 3309173529
Using 3309173529 for Database Id for the second pair of snapshots
Enter value for inst_num2: 1
Using 1 for Instance Number for the second pair of snapshots
</pre></li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs in the second time period.</p>
<pre>
Enter value for num_days2: 1
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the previous day are displayed.</p>
</li>
<li>
<p>Specify a beginning and ending snapshot ID for the second time period:</p>
<pre>
Enter value for begin_snap2: 126
Enter value for end_snap2: 127
</pre>
<p>In this example, the snapshot with a snapshot ID of 126 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 127 is selected as the ending snapshot for the second time period.</p>
</li>
<li>
<p>Enter a report name, or accept the default report name:</p>
<pre>
Enter value for report_name: 
Using the report name awrdiff_1_102_1_126.txt
</pre>
<p>In this example, the default name is accepted and an AWR report named <code>awrdiff_1_102_126</code> is generated on the database instance with a database ID value of <code>3309173529</code>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDBIAAD"></a>
<div id="PFGRF95090" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.7.4</span> Generating an Oracle RAC AWR Compare Periods Report on Specific Database Instances</h4>
<p>The <code>awrgdrpi.sql</code> SQL script generates an HTML or text report that compares detailed performance attributes and configuration settings between two selected time periods using specific databases and instances in an Oracle RAC environment. This script enables you to specify database identifiers and a comma-delimited list of database instances for which the AWR Compare Periods report will be generated.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
In an Oracle RAC environment, you should always try to generate an HTML report (instead of a text report) because they are much easier to read.</div>
<p>To generate an AWR Compare Periods report on a specified database instance in an Oracle RAC environment:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/awrgdrpi.sql
</pre></li>
<li>
<p>Specify whether you want an HTML or a text report:</p>
<pre>
Enter value for report_type: html
</pre>
<p>In this example, an HTML report is chosen.</p>
</li>
<li>
<p>A list of available database identifiers and instance numbers are displayed:</p>
<pre>
Instances in this Workload Repository schema
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   DB Id    Inst Num DB Name      Instance     Host
----------- -------- ------------ ------------ ------------
 3309173529        1 MAIN         main         examp1690
 3309173529        1 TINT251      tint251      samp251
 3309173529        2 TINT251      tint252      samp252
 3309173529        3 TINT251      tint253      samp253
 3309173529        4 TINT251      tint254      samp254
</pre>
<p>Enter the values for the database identifier (<code>dbid)</code> and instance number (<code>instance_numbers_or_all)</code> for the first time period:</p>
<pre>
Enter value for dbid: 3309173529
Using 3309173529 for Database Id for the first pair of snapshots
Enter value for inst_num: 1,2
Using instances 1 for the first pair of snapshots
</pre></li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs in the first time period.</p>
<pre>
Enter value for num_days: 2
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the last 2 days are displayed.</p>
</li>
<li>
<p>Specify a beginning and ending snapshot ID for the first time period:</p>
<pre>
Enter value for begin_snap: 102
Enter value for end_snap: 103
</pre>
<p>In this example, the snapshot with a snapshot ID of 102 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 103 is selected as the ending snapshot for the first time period.</p>
</li>
<li>
<p>A list of available database identifiers and instance numbers are displayed:</p>
<pre>
Instances in this Workload Repository schema
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   DB Id    Inst Num DB Name      Instance     Host
----------- -------- ------------ ------------ ------------
 3309173529        1 MAIN         main         examp1690
 3309173529        1 TINT251      tint251      samp251
 3309173529        2 TINT251      tint252      samp252
 3309173529        3 TINT251      tint253      samp253
 3309173529        4 TINT251      tint254      samp254
INSTNUM1
-----------------------------------------------------
1,2
</pre>
<p>Enter the values for the database identifier (<code>dbid2)</code> and instance numbers (<code>instance_numbers_or_all2</code>) for the second time period:</p>
<pre>
Enter value for dbid2: 3309173529
Using 3309173529 for Database Id for the second pair of snapshots
Enter value for instance_numbers_or_all2: 3,4
</pre></li>
<li>
<p>Specify the number of days for which you want to list snapshot IDs in the second time period.</p>
<pre>
Enter value for num_days2: 1
</pre>
<p>A list of existing snapshots for the specified time range is displayed. In this example, snapshots captured in the previous day are displayed.</p>
</li>
<li>
<p>Specify a beginning and ending snapshot ID for the second time period:</p>
<pre>
Enter value for begin_snap2: 126
Enter value for end_snap2: 127
</pre>
<p>In this example, the snapshot with a snapshot ID of 126 is selected as the beginning snapshot, and the snapshot with a snapshot ID of 127 is selected as the ending snapshot for the second time period.</p>
</li>
<li>
<p>Enter a report name, or accept the default report name:</p>
<pre>
Enter value for report_name: 
Using the report name awrracdiff_1st_1_2nd_1.html
</pre>
<p>In this example, the default name is accepted and an AWR report named <code>awrrac_1st_1_2nd_1.html</code> is generated.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDIDEDG"></a>
<div id="PFGRF02606" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.3.8</span> Generating Active Session History Reports</h3>
<p>Use Active Session History (ASH) reports to perform analysis of:</p>
<ul>
<li>
<p>Transient performance problems that typically last for a few minutes</p>
</li>
<li>
<p>Scoped or targeted performance analysis by various dimensions or their combinations, such as time, session, module, action, or <code>SQL_ID</code></p>
</li>
</ul>
<p>Transient performance problems<a id="sthref306"></a><a id="sthref307"></a> are short-lived and do not appear in the Automatic Database Diagnostics Monitor (ADDM) analysis. ADDM tries to report the most significant performance problems during an analysis period in terms of their impact on DB time. If a particular problem lasts for a very short duration, then its severity might be averaged out or minimized by other performance problems in the analysis period. Therefore, the problem may not appear in the ADDM findings. Whether a performance problem is captured by ADDM depends on its duration compared to the interval between the AWR snapshots.</p>
<p>If a performance problem lasts for a significant portion of the time between snapshots, it will be captured by ADDM. For example, if the snapshot interval is set to one hour, a performance problem that lasts for 30 minutes should not be considered as a transient performance problem because its duration represents a significant portion of the snapshot interval and will likely be captured by ADDM.</p>
<p>However, a performance problem that lasts for only 2 minutes could be a transient performance problem because its duration represents a small portion of the snapshot interval and will likely not show up in the ADDM findings. For example, if the user notifies you that the system was slow between 10:00 p.m. and 10:10 p.m., but the ADDM analysis for the time period between 10:00 p.m. and 11:00 p.m. does not show a performance problem, a transient performance problem probably occurred that lasted for only a few minutes of the 10-minute interval reported by the user.</p>
<p>The ASH reports are divided into multiple sections. The HTML report includes links that can be used to navigate quickly between sections. The content of the report contains ASH information used to identify blocker and waiter identities and their associated transaction identifiers and SQL for a specified duration. For more information on ASH, see <a href="#i35568">"Active Session History"</a>.</p>
<p>The primary interface for generating ASH reports is Oracle Enterprise Manager. Whenever possible, you should generate ASH reports using Oracle Enterprise Manager, as described in <a class="olink TDPPT066" href="../../server.112/e10822/tdppt_transient.htm#TDPPT066"><span class="italic">Oracle Database 2 Day + Performance Tuning Guide</span></a>. If Oracle Enterprise Manager is unavailable, you can generate ASH reports by running SQL scripts<a id="sthref308"></a><a id="sthref309"></a>, as described in the following sections:</p>
<ul>
<li>
<p><a href="#CHDJBFBJ">Generating an ASH Report</a></p>
</li>
<li>
<p><a href="#CHDEEBDG">Generating an ASH Report on a Specific Database Instance</a></p>
</li>
<li>
<p><a href="#CHDJCGGD">Generating an Oracle RAC ASH Report</a></p>
</li>
</ul>
<a id="CHDJBFBJ"></a>
<div id="PFGRF94210" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.8.1</span> Generating an ASH Report</h4>
<p>The <code>ashrpt.sql</code> SQL script generates an HTML or text report that displays ASH information for a specified duration.</p>
<p>To generate an ASH report:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/ashrpt.sql
</pre></li>
<li>
<p>Specify whether you want an HTML or a text report:</p>
<pre>
Enter value for report_type: text
</pre>
<p>In this example, a text report is chosen.</p>
</li>
<li>
<p>Specify the begin time in minutes before the system date:</p>
<pre>
Enter value for begin_time: -10
</pre>
<p>In this example, 10 minutes before the current time is selected.</p>
</li>
<li>
<p>Enter the duration in minutes that the report for which you want to capture ASH information from the begin time.</p>
<pre>
Enter value for duration:
</pre>
<p>In this example, the default duration of system date minus begin time is accepted.</p>
</li>
<li>
<p>Enter a report name, or accept the default report name:</p>
<pre>
Enter value for report_name: 
Using the report name ashrpt_1_0310_0131.txt
</pre>
<p>In this example, the default name is accepted and an ASH report named <code>ashrpt_1_0310_0131</code> is generated. The report will gather ASH information beginning from 10 minutes before the current time and ending at the current time.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDEEBDG"></a>
<div id="PFGRF94211" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.8.2</span> Generating an ASH Report on a Specific Database Instance</h4>
<p>The <code>ashrpti.sql</code> SQL script generates an HTML or text report that displays ASH information for a specified duration for a specified database and instance. This script enables you to specify a database and instance before setting the time frame to collect ASH information.</p>
<p>To generate an ASH report on a specified database instance:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/ashrpti.sql
</pre></li>
<li>
<p>Specify whether you want an HTML or a text report:</p>
<pre>
Enter value for report_type: html
</pre>
<p>In this example, an HTML report is chosen.</p>
</li>
<li>
<p>A list of available database IDs and instance numbers are displayed:</p>
<pre>
Instances in this Workload Repository schema
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   DB Id    Inst Num DB Name      Instance     Host
----------- -------- ------------ ------------ ------------
 3309173529        1 MAIN         main         examp1690
 3309173529        1 TINT251      tint251      samp251
</pre>
<p>Enter the values for the database identifier (<code>dbid)</code> and instance number (<code>inst_num)</code>:</p>
<pre>
Enter value for dbid: 3309173529
Using 3309173529 for database id
Enter value for inst_num: 1
</pre></li>
<li>
<p>This step is applicable only if you are generating an ASH report on an Active Data Guard physical standby instance. If this is not the case, you may skip this step.</p>
<p>To generate an ASH report on a physical standby instance, the standby database must be opened read-only. The ASH data on disk represents activity on the primary database and the ASH data in memory represents activity on the standby database.</p>
<p>Specify whether to generate the report using data sampled from the primary or standby database:</p>
<pre>
You are running ASH report on a Standby database.
To generate the report over data sampled on the Primary database, enter 'P'.
Defaults to 'S' - data sampled in the Standby database.
Enter value for stdbyflag:
Using Primary (P) or Standby (S): S
</pre>
<p>In this example, the default value of Standby (S) is selected.</p>
</li>
<li>
<p>Specify the begin time in minutes before the system date:</p>
<pre>
Enter value for begin_time: -10
</pre>
<p>In this example, 10 minutes before the current time is selected.</p>
</li>
<li>
<p>Enter the duration in minutes that the report for which you want to capture ASH information from the begin time.</p>
<pre>
Enter value for duration:
</pre>
<p>In this example, the default duration of system date minus begin time is accepted.</p>
</li>
<li>
<p>Specify the slot width in seconds that will be used in the Activity Over Time section of the report:</p>
<pre>
Enter value for slot_width: 
</pre>
<p>In this example, the default value is accepted. For more information about the Activity Over Time section and how to specify the slot width, see <a href="#CHDJBGHG">"Activity Over Time"</a>.</p>
</li>
<li>
<p>Follow the instructions as explained in the subsequent prompts and enter values for the following report targets:</p>
<ul>
<li>
<p><code>target_session_id</code></p>
</li>
<li>
<p><code>target_sql_id</code></p>
</li>
<li>
<p><code>target_wait_class</code></p>
</li>
<li>
<p><code>target_service_hash</code></p>
</li>
<li>
<p><code>target_module_name</code></p>
</li>
<li>
<p><code>target_action_name</code></p>
</li>
<li>
<p><code>target_client_id</code></p>
</li>
<li>
<p><code>target_plsql_entry</code></p>
</li>
</ul>
</li>
<li>
<p>Enter a report name, or accept the default report name:</p>
<pre>
Enter value for report_name: 
Using the report name ashrpt_1_0310_0131.txt
</pre>
<p>In this example, the default name is accepted and an ASH report named <code>ashrpt_1_0310_0131</code> is generated. The report will gather ASH information on the database instance with a database ID value of <code>3309173529</code> beginning from 10 minutes before the current time and ending at the current time.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDJCGGD"></a>
<div id="PFGRF95149" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.8.3</span> Generating an Oracle RAC ASH Report</h4>
<p>The <code>ashrpti.sql</code> SQL script generates an HTML or text report that displays ASH information for a specified duration for specified databases and instances in an Oracle RAC environment. Only ASH data that is written to disk will be used to generate the report. This report will only use ASH samples from the last 10 minutes that are found in the <code>DBA_HIST_ACTIVE_SESS_HISTORY</code> table.</p>
<p>To generate an ASH report in an Oracle RAC environment:</p>
<ol>
<li>
<p>At the SQL prompt, enter:</p>
<pre>
@$ORACLE_HOME/rdbms/admin/ashrpti.sql
</pre></li>
<li>
<p>Specify whether you want an HTML or a text report:</p>
<pre>
Enter value for report_type: html
</pre>
<p>In this example, an HTML report is chosen.</p>
</li>
<li>
<p>A list of available database IDs and instance numbers are displayed:</p>
<pre>
Instances in this Workload Repository schema
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   DB Id    Inst Num DB Name      Instance     Host
----------- -------- ------------ ------------ ------------
 3309173529        1 MAIN         main         examp1690
 3309173529        1 TINT251      tint251      samp251
 3309173529        2 TINT251      tint252      samp252
 3309173529        3 TINT251      tint253      samp253
 3309173529        4 TINT251      tint254      samp254
</pre>
<p>Enter the values for the database identifier (<code>dbid)</code> and instance number (<code>inst_num)</code>:</p>
<pre>
Enter value for dbid: 3309173529
Using database id: 3309173529
Enter instance numbers. Enter 'ALL' for all instances in an Oracle
RAC cluster or explicitly specify list of instances (e.g., 1,2,3).
Defaults to current instance.
Enter value for inst_num: ALL
Using instance number(s): ALL
</pre></li>
<li>
<p>Specify the begin time in minutes before the system date:</p>
<pre>
Enter value for begin_time: -1:10
</pre>
<p>In this example, 1 hour and 10 minutes before the current time is selected.</p>
</li>
<li>
<p>Enter the duration in minutes that the report for which you want to capture ASH information from the begin time:</p>
<pre>
Enter value for duration: 10
</pre>
<p>In this example, the duration is set to 10 minutes.</p>
</li>
<li>
<p>Specify the slot width in seconds that will be used in the Activity Over Time section of the report:</p>
<pre>
Enter value for slot_width: 
</pre>
<p>In this example, the default value is accepted. For more information about the Activity Over Time section and how to specify the slot width, see <a href="#CHDJBGHG">"Activity Over Time"</a>.</p>
</li>
<li>
<p>Follow the instructions as explained in the subsequent prompts and enter values for the following report targets:</p>
<ul>
<li>
<p><code>target_session_id</code></p>
</li>
<li>
<p><code>target_sql_id</code></p>
</li>
<li>
<p><code>target_wait_class</code></p>
</li>
<li>
<p><code>target_service_hash</code></p>
</li>
<li>
<p><code>target_module_name</code></p>
</li>
<li>
<p><code>target_action_name</code></p>
</li>
<li>
<p><code>target_client_id</code></p>
</li>
<li>
<p><code>target_plsql_entry</code></p>
</li>
</ul>
</li>
<li>
<p>Enter a report name, or accept the default report name:</p>
<pre>
Enter value for report_name: 
Using the report name ashrpt_rac_0310_0131.txt
</pre>
<p>In this example, the default name is accepted and an ASH report named <code>ashrpt_rac_0310_0131</code> is generated. The report will gather ASH information on all instances belonging to the database with a database ID value of <code>3309173529</code> beginning from 1 hour and 10 minutes before the current time and ending at 1 hour before the current time.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDJIEFE"></a>
<div id="PFGRF94212" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">5.3.9</span> Using Active Session History Reports</h3>
<p>After generating an ASH report<a id="sthref310"></a>, you can review the contents to identify transient performance problems.</p>
<p>The contents of the ASH report are divided into the following sections:</p>
<ul>
<li>
<p><a href="#CHDFAJEG">Top Events</a></p>
</li>
<li>
<p><a href="#CHDBADHB">Load Profile</a></p>
</li>
<li>
<p><a href="#CHDEJCGF">Top SQL</a></p>
</li>
<li>
<p><a href="#CHDDBHJG">Top PL/SQL</a></p>
</li>
<li>
<p><a href="#CHDEGAFD">Top Java</a></p>
</li>
<li>
<p><a href="#CHDEFJHG">Top Sessions</a></p>
</li>
<li>
<p><a href="#CHDGGJBC">Top Objects/Files/Latches</a></p>
</li>
<li>
<p><a href="#CHDJBGHG">Activity Over Time</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RACAD987" href="../../rac.112/e41960/monitor.htm#RACAD987"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for information about sections in the ASH report that are specific to Oracle Real Application Clusters (Oracle RAC)</div>
<a id="CHDFAJEG"></a>
<div id="PFGRF94213" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.9.1</span> Top Events</h4>
<p>The Top Events section<a id="sthref311"></a> describes the top wait events of the sampled session activity categorized by user, background, and priority. Use the information in this section to identify the wait events that may be the cause of the transient performance problem.</p>
<p>The Top Events section contains the following subsections:</p>
<ul>
<li>
<p>Top User Events</p>
<p>This subsection lists the top wait events from user processes that accounted for the highest percentages of sampled session activity.</p>
</li>
<li>
<p>Top Background Events</p>
<p>This subsection lists the top wait events from backgrounds that accounted for the highest percentages of sampled session activity.</p>
</li>
<li>
<p>Top Event P1/P2/P3</p>
<p>This subsection lists the wait event parameter values of the top wait events that accounted for the highest percentages of sampled session activity, ordered by the percentage of total wait time (% Event). For each wait event, values in the P1 Value, P2 Value, P3 Value column correspond to wait event parameters displayed in the Parameter 1, Parameter 2, and Parameter 3 columns.</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<a id="CHDBADHB"></a>
<div id="PFGRF94217" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.9.2</span> Load Profile</h4>
<p>The Load Profile section<a id="sthref312"></a> describes the load analyzed in the sampled session activity. Use the information in this section to identify the service, client, or SQL command type that may be the cause of the transient performance problem.</p>
<p>The Load Profile section contains the following subsections:</p>
<ul>
<li>
<p>Top Service/Module</p>
<p>This subsection lists the services and modules that accounted for the highest percentages of sampled session activity.</p>
</li>
<li>
<p>Top Client IDs</p>
<p>This subsection lists the clients that accounted for the highest percentages of sampled session activity based on their client ID, which is the application-specific identifier of the database session.</p>
</li>
<li>
<p>Top SQL Command Types</p>
<p>This subsection lists the SQL command types, such as <code>SELECT</code> or <code>UPDATE</code>, that accounted for the highest percentages of sampled session activity.</p>
</li>
<li>
<p>Top Phases of Execution</p>
<p>This subsection lists the phases of execution, such as SQL, PL/SQL, and Java compilation and execution, that accounted for the highest percentages of sampled session activity.</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<a id="CHDEJCGF"></a>
<div id="PFGRF94222" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.9.3</span> Top SQL</h4>
<p>The Top SQL section<a id="sthref313"></a><a id="sthref314"></a> describes the top SQL statements of the sampled session activity. Use this information to identify high-load SQL statements that may be the cause of the transient performance problem.</p>
<p>The Top SQL section contains the following subsections:</p>
<ul>
<li>
<p><a href="#CHDHJFFF">Top SQL with Top Events</a></p>
</li>
<li>
<p><a href="#CHDBCCBA">Top SQL with Top Row Sources</a></p>
</li>
<li>
<p><a href="#CHDIICJB">Top SQL Using Literals</a></p>
</li>
<li>
<p><a href="#CHDIGCAH">Top Parsing Module/Action</a></p>
</li>
<li>
<p><a href="#CHDHJBDJ">Complete List of SQL Text</a></p>
</li>
</ul>
<a id="CHDHJFFF"></a>
<div id="PFGRF94223" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">5.3.9.3.1</span> Top SQL with Top Events</h5>
<p>The Top SQL with Top Events subsection lists the SQL statements that accounted for the highest percentages of sampled session activity and the top wait events that were encountered by these SQL statements. The Sampled # of Executions column shows how many distinct executions of a particular SQL statement were sampled.</p>
</div>
<!-- class="sect4" -->
<a id="CHDBCCBA"></a>
<div id="PFGRF94224" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">5.3.9.3.2</span> Top SQL with Top Row Sources</h5>
<p>The Top SQL with Top Row Sources subsection lists the SQL statements that accounted for the highest percentages of sampled session activity and their detailed execution plan information. You can use this information to identify which part of the SQL execution contributed significantly to the SQL elapsed time.</p>
</div>
<!-- class="sect4" -->
<a id="CHDIICJB"></a>
<div id="PFGRF94225" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">5.3.9.3.3</span> Top SQL Using Literals</h5>
<p>The Top SQL Using Literals subsection lists the SQL statements using literals that accounted for the highest percentages of sampled session activity. You should review the statements listed in this report to determine whether the literals can be replaced with bind variables.</p>
</div>
<!-- class="sect4" -->
<a id="CHDIGCAH"></a>
<div id="PFGRF94226" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">5.3.9.3.4</span> Top Parsing Module/Action</h5>
<p>The Top Parsing Module/Action subsection lists the module and action that accounted for the highest percentages of sampled session activity while parsing the SQL statement.</p>
</div>
<!-- class="sect4" -->
<a id="CHDHJBDJ"></a>
<div id="PFGRF94227" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">5.3.9.3.5</span> Complete List of SQL Text</h5>
<p>The Complete List of SQL Text subsection displays the entire text of the Top SQL statements shown in this section.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="CHDDBHJG"></a>
<div id="PFGRF94228" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.9.4</span> Top PL/SQL</h4>
<p>The Top PL/SQL<a id="sthref315"></a><a id="sthref316"></a> section lists the PL/SQL procedures that accounted for the highest percentages of sampled session activity. The PL/SQL Entry Subprogram column lists the application's top-level entry point into PL/SQL. The PL/SQL Current Subprogram column lists the PL/SQL subprogram being executed at the point of sampling. If the value of this column is <code>SQL</code>, then the % Current column shows the percentage of time spent executing SQL for this subprogram.</p>
</div>
<!-- class="sect3" -->
<a id="CHDEGAFD"></a>
<div id="PFGRF94229" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.9.5</span> Top Java</h4>
<p>The Top Java<a id="sthref317"></a><a id="sthref318"></a> section describes the top Java programs in the sampled session activity.</p>
</div>
<!-- class="sect3" -->
<a id="CHDEFJHG"></a>
<div id="PFGRF94230" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.9.6</span> Top Sessions</h4>
<p>The Top Sessions section<a id="sthref319"></a><a id="sthref320"></a> describes the sessions that were waiting for a particular wait event. Use this information to identify the sessions that accounted for the highest percentages of sampled session activity, which may be the cause of the transient performance problem.</p>
<p>The Top Sessions section contains the following subsections:</p>
<ul>
<li>
<p><a href="#CHDJEBDE">Top Sessions</a></p>
</li>
<li>
<p><a href="#CHDICAJB">Top Blocking Sessions</a></p>
</li>
<li>
<p><a href="#CHDGDBBF">Top Sessions Running PQs</a></p>
</li>
</ul>
<a id="CHDJEBDE"></a>
<div id="PFGRF94231" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">5.3.9.6.1</span> Top Sessions</h5>
<p>The Top Session subsection lists the sessions that were waiting for a particular wait event that accounted for the highest percentages of sampled session activity.</p>
</div>
<!-- class="sect4" -->
<a id="CHDICAJB"></a>
<div id="PFGRF94232" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">5.3.9.6.2</span> Top Blocking Sessions</h5>
<p>The Top Blocking Sessions subsection lists the blocking sessions that accounted for the highest percentages of sampled session activity.</p>
</div>
<!-- class="sect4" -->
<a id="CHDGDBBF"></a>
<div id="PFGRF94233" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">5.3.9.6.3</span> Top Sessions Running PQs</h5>
<p>The Top Sessions Running PQs subsection lists the sessions running parallel queries (PQs) that were waiting for a particular wait event, which accounted for the highest percentages of sampled session activity.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="CHDGGJBC"></a>
<div id="PFGRF94234" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.9.7</span> Top Objects/Files/Latches</h4>
<p>The Top Objects/Files/Latches section<a id="sthref321"></a><a id="sthref322"></a><a id="sthref323"></a> provides additional information about the most commonly-used database resources and contains the following subsections:</p>
<ul>
<li>
<p><a href="#CHDBCEGJ">Top DB Objects</a></p>
</li>
<li>
<p><a href="#CHDECGHF">Top DB Files</a></p>
</li>
<li>
<p><a href="#CHDDDGBJ">Top Latches</a></p>
</li>
</ul>
<a id="CHDBCEGJ"></a>
<div id="PFGRF94235" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">5.3.9.7.1</span> Top DB Objects</h5>
<p>The Top DB Objects subsection lists the database objects (such as tables and indexes) that accounted for the highest percentages of sampled session activity.</p>
</div>
<!-- class="sect4" -->
<a id="CHDECGHF"></a>
<div id="PFGRF94236" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">5.3.9.7.2</span> Top DB Files</h5>
<p>The Top DB Files subsection lists the database files that accounted for the highest percentages of sampled session activity.</p>
</div>
<!-- class="sect4" -->
<a id="CHDDDGBJ"></a>
<div id="PFGRF94237" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">5.3.9.7.3</span> Top Latches</h5>
<p>The Top Latches subsection lists the latches that accounted for the highest percentages of sampled session activity.</p>
<p>Latches<a id="sthref324"></a> are simple, low-level serialization mechanisms to protect shared data structures in the System Global Area (SGA). For example, latches protect the list of users currently accessing the database and the data structures describing the blocks in the buffer cache. A server or background process acquires a latch for a very short time while manipulating or looking at one of these structures. The implementation of latches is operating system-dependent, particularly regarding whether and how long a process waits for a latch.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="CHDJBGHG"></a>
<div id="PFGRF94238" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">5.3.9.8</span> Activity Over Time</h4>
<p>The Activity Over Time section<a id="sthref325"></a> is one of the most informative sections of the ASH report. This section is particularly useful for longer time periods because it provides in-depth details about activities and workload profiles during the analysis period. The Activity Over Time section is divided into 10 time slots. The size of each time slot varies based on the duration of the analysis period. The first and last slots are usually odd-sized. All inner slots are equally sized and can be compared to each other. For example, if the analysis period lasts for 10 minutes, then all time slots will 1 minute each. However, if the analysis period lasts for 9 minutes and 30 seconds, then the outer slots may be 15 seconds each and the inner slots will be 1 minute each.</p>
<p>Each of the time slots contains information regarding that particular time slot, as described in <a href="#CIHDIBFJ">Table 5-2</a>.</p>
<div id="PFGRF94239" class="tblformal">
<p class="titleintable"><a id="sthref326"></a><a id="CIHDIBFJ"></a>Table 5-2 Activity Over Time</p>
<table class="cellalignment1686" title="Activity Over Time" summary="Describes the columns in the Activity Over Time section of the ASH report" dir="ltr">
<thead>
<tr class="cellalignment1680">
<th class="cellalignment1687" id="r1c1-t31">Column</th>
<th class="cellalignment1687" id="r1c2-t31">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1680">
<td class="cellalignment1688" id="r2c1-t31" headers="r1c1-t31">
<p>Slot Time (Duration)</p>
</td>
<td class="cellalignment1688" headers="r2c1-t31 r1c2-t31">
<p>Duration of the slot</p>
</td>
</tr>
<tr class="cellalignment1680">
<td class="cellalignment1688" id="r3c1-t31" headers="r1c1-t31">
<p>Slot Count</p>
</td>
<td class="cellalignment1688" headers="r3c1-t31 r1c2-t31">
<p>Number of sampled sessions in the slot</p>
</td>
</tr>
<tr class="cellalignment1680">
<td class="cellalignment1688" id="r4c1-t31" headers="r1c1-t31">
<p>Event</p>
</td>
<td class="cellalignment1688" headers="r4c1-t31 r1c2-t31">
<p>Top three wait events in the slot</p>
</td>
</tr>
<tr class="cellalignment1680">
<td class="cellalignment1688" id="r5c1-t31" headers="r1c1-t31">
<p>Event Count</p>
</td>
<td class="cellalignment1688" headers="r5c1-t31 r1c2-t31">
<p>Number of ASH samples waiting for the wait event</p>
</td>
</tr>
<tr class="cellalignment1680">
<td class="cellalignment1688" id="r6c1-t31" headers="r1c1-t31">
<p>% Event</p>
</td>
<td class="cellalignment1688" headers="r6c1-t31 r1c2-t31">
<p>Percentage of ASH samples waiting for wait events in the entire analysis period</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p>When comparing the inner slots, perform a skew analysis by identifying spikes in the Event Count and Slot Count columns. A spike in the Event Count column indicates an increase in the number of sampled sessions waiting for a particular event. A spike in the Slot Count column indicates an increase in active sessions, because ASH data is sampled from active sessions only and a relative increase in database workload. Typically, when the number of active session samples and the number of sessions associated with a wait event increases, the slot may be the cause of the transient performance problem.</p>
<p>To generate the ASH report with a user-defined slot size, run the <code>ashrpti.sql</code> script, as described in <a href="#CHDEEBDG">"Generating an ASH Report on a Specific Database Instance"</a>.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1679">
<tr>
<td class="cellalignment1688">
<table class="cellalignment1684">
<tr>
<td class="cellalignment1683"><a href="build_db.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1683"><a href="diag.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2000, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1690">
<table class="cellalignment1682">
<tr>
<td class="cellalignment1683"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1683"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1683"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1683"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1683"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1683"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
