<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>CATSEARCH Query Application</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 748" />
<meta name="dcterms.created" content="2014-02-11T12:39:54Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Text Application Developer's Guide" />
<meta name="dcterms.identifier" content="E24435-03" />
<meta name="dcterms.isVersionOf" content="CCAPP" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2004, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="txtgloss.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="acase.htm" title="Previous" type="text/html" />
<link rel="Next" href="txtgloss.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e24435.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">19/21</span> <!-- End Header -->
<div id="CCAPP3100" class="appendix"><a id="g636412"></a><a id="i633623"></a>
<h1 class="appendix"><span class="secnum">B</span> CATSEARCH Query Application</h1>
<p><a id="sthref955"></a><a id="sthref956"></a><a id="sthref957"></a><a id="sthref958"></a>This appendix describes how to build a simple Web-search application using the <code>CATSEARCH</code> index type, either by writing your own code or by using the Oracle Text Wizard. The following topics are covered:</p>
<ul>
<li>
<p><a href="#i634445">CATSEARCH Web Query Application Overview</a></p>
</li>
<li>
<p><a href="#i634453">The JSP Web Application</a></p>
</li>
</ul>
<a id="i634445"></a>
<div id="CCAPP9384" class="sect1">
<h2 class="sect1"><span class="secnum">B.1</span> CATSEARCH Web Query Application Overview</h2>
<p>The <code>CTXCAT</code> index type is well suited for merchandise catalogs that have short descriptive text fragments and associated structured data. This appendix describes how to build a browser based bookstore catalog that users can search to find titles and prices.</p>
<p>This application is written in Java Server Pages (JSP).</p>
<p>The application can be produced by using a catalog query application wizard, which produces the necessary code automatically. You can view and download the JSP application code, as well as the catalog query application wizard, at the Oracle Technology Network Web site:</p>
<pre>
<a href="http://www.oracle.com/technology/products/text/">http://www.oracle.com/technology/products/text</a>
</pre>
<p>This Web site also has complete instructions on how to use the catalog query wizard.</p>
</div>
<!-- class="sect1" -->
<a id="i634453"></a>
<div id="CCAPP9385" class="sect1">
<h2 class="sect1"><span class="secnum">B.2</span> The JSP Web Application<a id="sthref959"></a></h2>
<p>This application is based on Java Server pages and has the following requirements:</p>
<ul>
<li>
<p>Your Oracle Database (version 8.1.7 or higher) is up and running.</p>
</li>
<li>
<p>You have a Web server such as Apache up and running and correctly configured to send requests to Oracle Database.</p>
</li>
</ul>
<a id="i634804"></a>
<div id="CCAPP9386" class="sect2">
<h3 class="sect2"><span class="secnum">B.2.1</span> Building the JSP Web Application</h3>
<p>This application models an online bookstore where you can look up book titles and prices.</p>
<dl>
<dd><a id="sthref960"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Create Your Table</dt>
<dd>
<p>You must create the table to store book information such as title, publisher, and price. From SQL*Plus:</p>
<pre>
sqlplus&gt;create table book_catalog (
          id        numeric,
          title     varchar2(80),
          publisher varchar2(25),
          price     numeric )
</pre></dd>
<dd><a id="sthref961"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Load data using SQL*Loader</dt>
<dd>
<p>Load the book data from the operating system command-line with SQL*Loader:</p>
<pre>
% sqlldr userid=ctxdemo/ctxdemo control=loader.ctl
</pre></dd>
<dd><a id="sthref962"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Create index set</dt>
<dd>
<p>You can create the index set from SQL*Plus:</p>
<pre>
sqlplus&gt;begin
          ctx_ddl.create_index_set('bookset');
          ctx_ddl.add_index('bookset','price');
          ctx_ddl.add_index('bookset','publisher');
        end;
/
</pre></dd>
<dd><a id="sthref963"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Index creation</dt>
<dd>
<p>You can create the <code>CTXCAT</code> index from SQL*Plus as follows:</p>
<pre>
sqlplus&gt;create index book_idx on book_catalog (title) 
        indextype is ctxsys.ctxcat
        parameters('index set bookset');
</pre></dd>
<dd><a id="sthref964"></a></dd>
<dt class="seghead">Step 5&nbsp;&nbsp;&nbsp;Try a simple search using CATSEARCH</dt>
<dd>
<p>You can test the newly created index in SQL*Plus as follows:</p>
<pre>
sqlplus&gt;select id, title from book_catalog 
        where catsearch(title,'Java','price &gt; 10 order by price') &gt; 0
</pre></dd>
<dd><a id="sthref965"></a></dd>
<dt class="seghead">Step 6&nbsp;&nbsp;&nbsp;Copy the catalogSearch.jsp file to your Web site JSP directory.</dt>
<dd>
<p>When you do so, you can access the application from a browser. The URL should be <code>http://</code><span class="italic">localhost</span><code>:</code><span class="italic">port</span><code>/</code><span class="italic">path</span><code>/catalogSearch.jsp</code></p>
<p>The application displays a query entry box in your browser and returns the query results as a list of HTML links. See <a href="#i634494">Figure B-1</a>.</p>
</dd>
</dl>
<div id="CCAPP9531" class="figure">
<p class="titleinfigure"><a id="i634494"></a>Figure B-1 Screen shot of Web Query Application</p>
<img width="500" height="504" src="img/qcatwiz1_newb.gif" alt="Description of Figure B-1 follows" /><br />
<a id="sthref966" href="img_text/qcatwiz1_newb.htm">Description of "Figure B-1 Screen shot of Web Query Application"</a><br />
<br /></div>
<!-- class="figure" --></div>
<!-- class="sect2" -->
<a id="i634501"></a>
<div id="CCAPP9387" class="sect2">
<h3 class="sect2"><span class="secnum">B.2.2</span> JSP Sample Code</h3>
<p>This section lists the code used to build the example Web application. It includes the following files:</p>
<ul>
<li>
<p><a href="#i634523">loader.ctl</a></p>
</li>
<li>
<p><a href="#i634531">loader.dat</a></p>
</li>
<li>
<p><a href="#i634557">catalogSearch.jsp</a></p>
<div class="infoboxnotealso">
<p class="notep1"><span class="bold">See Also</span>:</p>
<code><a href="http://www.oracle.com/technology/products/text/">http://www.oracle.com/technology/products/text/</a></code></div>
</li>
</ul>
<a id="i634523"></a>
<div id="CCAPP9388" class="sect3">
<h4 class="sect3"><span class="secnum">B.2.2.1</span> loader.ctl</h4>
<pre>
      LOAD DATA
        INFILE 'loader.dat'
        INTO TABLE book_catalog 
        REPLACE 
        FIELDS TERMINATED BY ';'
        (id, title, publisher, price)
</pre></div>
<!-- class="sect3" -->
<a id="i634531"></a>
<div id="CCAPP9389" class="sect3">
<h4 class="sect3"><span class="secnum">B.2.2.2</span> loader.dat</h4>
<pre>
1; A History of Goats; SPINDRIFT BOOKS;50
2; Robust Recipes Inspired by Eating Too Much;SPINDRIFT BOOKS;28
3; Atlas of Greenland History; SPINDRIFT BOOKS; 35
4; Bed and Breakfast Guide to Greenland; SPINDRIFT BOOKS; 37
5; Quitting Your Job and Running Away; SPINDRIFT BOOKS;25
6; Best Noodle Shops of Omaha ;SPINDRIFT BOOKS; 28
7; Complete Book of Toes; SPINDRIFT BOOKS;16
8; Complete Idiot's Guide to Nuclear Technology;SPINDRIFT BOOKS; 28
9; Java Programming for Woodland Animals; LOW LIFE BOOK CO; 10
10; Emergency Surgery Tips and Tricks;SPOT-ON PUBLISHING;10
11; Programming with Your Eyes Shut; KLONDIKE BOOKS; 10
12; Forest Fires of North America, 1858-1882; CALAMITY BOOKS; 11
13; Spanish in Twelve Minutes; WRENCH BOOKS 11
14; Better Sex and Romance Through C++; CALAMITY BOOKS; 12
15; Oracle Internet Application Server Enterprise Edition; KANT BOOKS; 12
16; Oracle Internet Developer Suite; SPAMMUS BOOK CO;13
17; Telling the Truth to Your Pets; IBEX BOOKS INC; 13
18; Go Ask Alice's Restaurant;HUMMING BOOKS;    13
19; Life Begins at 93;  CALAMITY BOOKS;   17
20; Dating While Drunk;  BALLAST BOOKS;  14
21; The Second-to-Last Mohican; KLONDIKE BOOKS;  14
22; Eye of Horus; An Oracle of Ancient Egypt; BIG LITTLE BOOKS;     15
23; Introduction to Sitting Down; IBEX BOOKS INC;  15
</pre></div>
<!-- class="sect3" -->
<a id="i634557"></a>
<div id="CCAPP9390" class="sect3">
<h4 class="sect3"><span class="secnum">B.2.2.3</span> catalogSearch.jsp</h4>
<pre>
&lt;%@ page import="java.sql.* , oracle.jsp.dbutil.*" %&gt;
&lt;jsp:useBean id="name" class="oracle.jsp.jml.JmlString" scope="request" &gt;
&lt;jsp:setProperty name="name" property="value" param="v_query" /&gt;
&lt;/jsp:useBean&gt;

&lt;%
  String connStr="jdbc:oracle:thin:@machine-domain-name:1521:betadev";

  java.util.Properties info = new java.util.Properties();

  Connection conn = null;
  ResultSet  rset = null;
  Statement  stmt = null;


       if (name.isEmpty() ) { 

%&gt;
           &lt;html&gt;
             &lt;title&gt;Catalog Search&lt;/title&gt;
             &lt;body&gt;
             &lt;center&gt;
               &lt;form method=post&gt;
               Search for book title:
               &lt;input type=text name="v_query" size=10&gt;
               where publisher is
               &lt;select name="v_publisher"&gt;
                  &lt;option value="ADDISON WESLEY"&gt;ADDISON WESLEY
                  &lt;option value="HUMMING BOOKS"&gt;HUMMING BOOKS
                  &lt;option value="WRENCH BOOKS"&gt;WRENCH BOOKS
                  &lt;option value="SPOT-ON PUBLISHING"&gt;SPOT-ON PUBLISHING
                  &lt;option value="SPINDRIFT BOOKS"&gt;SPINDRIFT BOOKS
                  &lt;option value="LOW LIFE BOOK CO"&gt;LOW LIFE BOOK CO
                  &lt;option value="KLONDIKE BOOKS"&gt;KLONDIKE BOOKS
                  &lt;option value="CALAMITY BOOKS"&gt;CALAMITY BOOKS
                  &lt;option value="IBEX BOOKS INC"&gt;IBEX BOOKS INC
                  &lt;option value="BIG LITTLE BOOKS"&gt;BIG LITTLE BOOKS
               &lt;/select&gt;
               and price is 
               &lt;select name="v_op"&gt;
                 &lt;option value="="&gt;=
                 &lt;option value="&amp;lt;"&gt;&amp;lt;
                 &lt;option value="&amp;gt;"&gt;&amp;gt;
               &lt;/select&gt;
               &lt;input type=text name="v_price" size=2&gt;
               &lt;input type=submit value="Search"&gt;
               &lt;/form&gt;
             &lt;/center&gt;
             &lt;hr&gt;
             &lt;/body&gt;
           &lt;/html&gt;

&lt;%
      }
      else {

         String v_query = request.getParameter("v_query");
         String v_publisher = request.getParameter("v_publisher");
         String v_price = request.getParameter("v_price");
         String v_op    = request.getParameter("v_op");
%&gt;

         &lt;html&gt;
           &lt;title&gt;Catalog Search&lt;/title&gt;
           &lt;body&gt;
           &lt;center&gt;
            &lt;form method=post action="catalogSearch.jsp"&gt;
            Search for book title:
            &lt;input type=text name="v_query" value= 
            &lt;%= v_query %&gt;
            size=10&gt;
            where publisher is
            &lt;select name="v_publisher"&gt;
                  &lt;option value="ADDISON WESLEY"&gt;ADDISON WESLEY
                  &lt;option value="HUMMING BOOKS"&gt;HUMMING BOOKS
                  &lt;option value="WRENCH BOOKS"&gt;WRENCH BOOKS
                  &lt;option value="SPOT-ON PUBLISHING"&gt;SPOT-ON PUBLISHING
                  &lt;option value="SPINDRIFT BOOKS"&gt;SPINDRIFT BOOKS
                  &lt;option value="LOW LIFE BOOK CO"&gt;LOW LIFE BOOK CO
                  &lt;option value="KLONDIKE BOOKS"&gt;KLONDIKE BOOKS
                  &lt;option value="CALAMITY BOOKS"&gt;CALAMITY BOOKS
                  &lt;option value="IBEX BOOKS INC"&gt;IBEX BOOKS INC
                  &lt;option value="BIG LITTLE BOOKS"&gt;BIG LITTLE BOOKS
            &lt;/select&gt;
            and price is 
            &lt;select name="v_op"&gt;
               &lt;option value="="&gt;=
               &lt;option value="&amp;lt;"&gt;&amp;lt;
               &lt;option value="&amp;gt;"&gt;&amp;gt;
            &lt;/select&gt;
            &lt;input type=text name="v_price" value=
            &lt;%= v_price %&gt; size=2&gt;
            &lt;input type=submit value="Search"&gt;
            &lt;/form&gt;
            &lt;/center&gt;
          
&lt;%
     try {

       DriverManager.registerDriver(new oracle.jdbc.driver.OracleDriver() );
       info.put ("user", "ctxdemo");
       info.put ("password","ctxdemo");
       conn = DriverManager.getConnection(connStr,info);

         stmt = conn.createStatement();
         String theQuery = request.getParameter("v_query");
         String thePrice = request.getParameter("v_price");

 // select id,title 
 // from book_catalog 
 // where catsearch (title,'Java','price &gt;10 order by price') &gt; 0

 // select title 
 // from book_catalog 
 // where catsearch(title,'Java','publisher = ''CALAMITY BOOKS'' 
          and price &lt; 40 order by price' )&gt;0

         String myQuery = "select title, publisher, price from book_catalog
             where catsearch(title, '"+theQuery+"', 
             'publisher = ''"+v_publisher+"'' and price "+v_op+thePrice+" 
             order by price' ) &gt; 0";
         rset = stmt.executeQuery(myQuery);

         String color = "ffffff";

         String myTitle = null;
         String myPublisher = null;
         int myPrice = 0;
         int items = 0;

         while (rset.next()) {
            myTitle     = (String)rset.getString(1);
            myPublisher = (String)rset.getString(2);
            myPrice     = (int)rset.getInt(3);
            items++;

            if (items == 1) {
%&gt;
               &lt;center&gt;
                  &lt;table border="0"&gt;
                     &lt;tr bgcolor="#6699CC"&gt;
                       &lt;th&gt;Title&lt;/th&gt;
                       &lt;th&gt;Publisher&lt;/th&gt;
                       &lt;th&gt;Price&lt;/th&gt;
                     &lt;/tr&gt;
&lt;%
            }
%&gt; 
            &lt;tr bgcolor="#&lt;%= color %&gt;"&gt;
             &lt;td&gt; &lt;%= myTitle %&gt;&lt;/td&gt;
             &lt;td&gt; &lt;%= myPublisher %&gt;&lt;/td&gt;
             &lt;td&gt; $&lt;%= myPrice %&gt;&lt;/td&gt;
            &lt;/tr&gt;
&lt;%
            if (color.compareTo("ffffff") == 0)
               color = "eeeeee";
             else
               color = "ffffff";

      }
      
   } catch (SQLException e) {

%&gt;

      &lt;b&gt;Error: &lt;/b&gt; &lt;%= e %&gt;&lt;p&gt;

&lt;%

  } finally {
       if (conn != null) conn.close();
       if (stmt != null) stmt.close();
       if (rset != null) rset.close();
   }
   
%&gt;
    &lt;/table&gt;
    &lt;/center&gt;
   &lt;/body&gt;
   &lt;/html&gt;
&lt;%
 }
%&gt;
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="appendix" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment105">
<tr>
<td class="cellalignment112">
<table class="cellalignment110">
<tr>
<td class="cellalignment109"><a href="acase.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment109"><a href="txtgloss.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2004, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment114">
<table class="cellalignment108">
<tr>
<td class="cellalignment109"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment109"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment109"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment109"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment109"><a href="../../nav/mindx.htm"><img width="24" height="24" src="../../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment109"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
